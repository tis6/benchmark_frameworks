Id,PostTypeId,AcceptedAnswerId,ParentId,CreationDate,DeletionDate,Score,ViewCount,Body,OwnerUserId,OwnerDisplayName,LastEditorUserId,LastEditorDisplayName,LastEditDate,LastActivityDate,Title,Tags,AnswerCount,CommentCount,FavoriteCount,ClosedDate,CommunityOwnedDate,PostId,TagId,Id,TagName,Count,ExcerptPostId,WikiPostId
"56706485","1","56707530","","2019-06-21 15:34:20","","1","376","<p>I am using <a href=""https://api.ktor.io/1.2.2/"" rel=""nofollow noreferrer"">Ktor 1.2.2</a> and I have an InputStream object that I want to use as the body for an HttpClient request I make down the line. Up until Ktor 0.95 there was this <a href=""https://api.ktor.io/0.9.5/io.ktor.webjars/-input-stream-content/index.html"" rel=""nofollow noreferrer"">InputStreamContent</a> object that seemed to do just that but it has been removed from Ktor at version 1.0.0 (couldn't figure out why unfortunately). </p>

<p>I can make it work using a ByteArrayContent (see code below) but I'd rather find a solution that does not require loading the entire InputStream into memory...</p>

<pre><code>ByteArrayContent(input.readAllBytes())
</code></pre>

<p>This code is a simple test case that emulate what I'm trying to achieve:</p>

<pre><code>val file = File(""c:\\tmp\\foo.pdf"")
val inputStream = file.inputStream()
val client = HttpClient(CIO)
client.call(url) {
      method = HttpMethod.Post
      body = inputStream // TODO: Make this work :(
    }
// [... other code that uses the response below]
</code></pre>

<p>Let me know if I missed any relevant information,</p>

<p>Thanks!</p>
","7490030","","2318632","","2020-02-23 14:32:00","2020-02-23 14:32:00","In Ktor, how can I stream an InputStream into a HttpClient Request's body?","<kotlin><ktor><ktor-client>","2","0","","","","56706485","141923","141923","ktor-client","6","",""
"59470764","1","","","2019-12-24 15:22:05","","1","80","<p>I need to make a GET request using a Ktor client. The URL I'm using is passed to me as a string from a source I have no control over. The URL string contains commas that are encoded by the Ktor client to <code>%2C</code> which is breaking the backend logic. Is there a way to prevent Ktor from encoding the URL?</p>

<p>Example to clarify:</p>

<pre><code>client.get {
    url(url)
    accept(ContentType.Application.Json)
    method = HttpMethod.Get
}
</code></pre>

<p>In the following code, the value of <code>url</code> is <code>https://my.domain/someData,someMoreData</code> but the outgoing request URL is <code>https://my.domain/someData%2CsomeMoreData</code>.</p>
","2318632","","2318632","","2019-12-24 15:29:26","2019-12-25 11:12:48","Encode URL in Ktor Client","<kotlin><urlencode><ktor><ktor-client>","1","0","","","","59470764","141923","141923","ktor-client","6","",""
"60399933","1","60495656","","2020-02-25 17:11:13","","0","35","<p>I am trying out <code>Ktor</code> by converting some existing project that's currently using <code>Retrofit</code>.</p>

<p>Although I could easily convert the request into something like:</p>

<pre><code>client.get {
    url(""$BASE_URL/something/somepage/another"")
}
</code></pre>

<p>It seems very tedious to always add the <code>$BASE_URL</code> to all paths every time. In retrofit, we could simply do something like:</p>

<pre><code>Retrofit.Builder()
    .baseUrl(BASE_URL)
    .create(SomeServiceClass::class.java)
</code></pre>

<p>I've triede using <code>defaultRequest</code> and setting the <code>BASE_URL</code> there but apparently you could only set the <code>url.host</code> and not the whole <code>basePath</code>.</p>

<p>Is there a way to do the same thing in <code>Ktor</code>? or if there is none, what's the best practice to handle this?</p>
","9291997","","","","","2020-03-02 19:49:48","How to set a basePath in Ktor similar to Retrofit's `Retrofit.Builder().baseUrl(baseUrl)?","<android><kotlin><ktor><kotlin-multiplatform><ktor-client>","1","0","","","","60399933","141923","141923","ktor-client","6","",""
"60523776","1","","","2020-03-04 10:19:04","","0","9","<p>Using the ktor client to make an HTTP request, I want to change the HTTP Protocol Version to 1.0.</p>

<p>The documentation on the different Engines, e.g. Apache or CIO, mentions that they support 1.X, but not how to change the version.</p>

<p>I have the following code, which initialized the client, but I could not find configuration options for setting the protocol version for client or the request.</p>

<pre><code>val client = HttpClient(Apache){
        engine {
            ...
        }
    }
val result = client.post&lt;HttpResponse&gt;(""http://127.0.0.1:8080/handler"") {
   body = MultiPartContent.build {
       add(""user"", ""myuser"")
       add(""password"", ""password"")
       add(""file"", byteArrayOf(1, 2, 3, 4), filename = ""binary.bin"")
   }
}
</code></pre>

<p>The HTTPProtocolVersion class exists, but I could only find one reference to it for getting the version of a request, but not for setting it.
<a href=""https://api.ktor.io/0.9.5/io.ktor.http/-http-protocol-version/index.html"" rel=""nofollow noreferrer"">https://api.ktor.io/0.9.5/io.ktor.http/-http-protocol-version/index.html</a></p>
","1375822","","","","","2020-03-04 10:19:04","Setting HttpProtocolVersion for Ktor Http Client Request","<kotlin><ktor><ktor-client>","0","0","","","","60523776","141923","141923","ktor-client","6","",""
"60652474","1","","","2020-03-12 10:46:25","","1","13","<p>I have a ktor server that exposes an API to my android client. It has its own database, some signup structure, and all the standard stuff. But now, a part of my database is getting filled with data from an 3rd party database, which I can only reach via it's own API. That means my server is a client on itself. I know this might not be the best structure, but that's how it is right now. So I need an HTTPClient for my server I think. For that I need to use an engine, but should I use the same engine as the one that I use for my server? How do I set it up in my DI, Koin, so that my services have access to the HTTPClient (factory or single)
Right now I set up the server part like this:</p>

<pre class=""lang-kotlin prettyprint-override""><code>fun main(args: Array&lt;String&gt;): Unit = io.ktor.server.netty.EngineMain.main(args)

@Suppress(""unused"") // Referenced in application.conf
@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {
    install(ContentNegotiation) {
        serialization()
    }
    install(Koin) {
        modules(
            KoinModules.exposedModule,
            KoinModules.repositoryModule
        )
    }

    val userRepository by inject&lt;UserRepository&gt;()

    routing {
    ...
</code></pre>

<p>application.conf</p>

<pre><code>ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ com.kvw.letsgo.server.ApplicationKt.module ]
    }
}
</code></pre>

<p>Should I change my main(), lose application.conf and code it by hand so that I use the same engine?</p>
","6849045","","","","","2020-03-12 10:46:25","How to connect to external api on ktor server","<ktor><koin><ktor-client>","0","0","1","","","60652474","141923","141923","ktor-client","6","",""
"61362485","1","61434078","","2020-04-22 10:11:37","","1","50","<p>I am trying to use <strong>ktor</strong> <a href=""https://ktor.io/clients/http-client/quick-start/client.html"" rel=""nofollow noreferrer"">client</a> in Kotlin/MPP (Multiplatform) project and on JVM target feature <a href=""https://ktor.io/clients/http-client/features/auth.html#basic"" rel=""nofollow noreferrer"">basic authentication</a> does not seem to have an effect.</p>

<h3>Here is an example to reproduce:</h3>

<pre class=""lang-kotlin prettyprint-override""><code>import io.ktor.client.HttpClient
import io.ktor.client.features.ResponseException
import io.ktor.client.features.auth.Auth
import io.ktor.client.features.auth.providers.basic
import io.ktor.client.features.json.JsonFeature
import io.ktor.client.features.json.serializer.KotlinxSerializer
import io.ktor.client.features.logging.DEFAULT
import io.ktor.client.features.logging.LogLevel
import io.ktor.client.features.logging.Logger
import io.ktor.client.features.logging.Logging
import io.ktor.client.request.get
import io.ktor.client.request.header
import kotlinx.coroutines.runBlocking
import java.util.*

fun main() = runBlocking {
    val client = HttpClient {
        install(Logging) {
            logger = Logger.DEFAULT
            level = LogLevel.HEADERS
        }
        install(JsonFeature) {
            serializer = KotlinxSerializer()
        }
        install(Auth) {
            basic {
                username = ""user""
                password = ""pass""
            }
        }
    }
    val url = ""https://en.wikipedia.org/wiki/Main_Page""

    val failing = try {
        client.get&lt;String&gt;(url)
    } catch (e: ResponseException) {
        ""failed""
    }

    val succeeding = try {
        client.get&lt;String&gt;(url) {
            header(""Authorization"", ""Basic ${Base64.getEncoder().encodeToString(""user:pass"".toByteArray())}"")
        }
    } catch (e: ResponseException) {
        ""failed""
    }
}
</code></pre>

<h3>Observation</h3>

<p>From the logger output, you can see that client does not send <code>Authorization</code> header but I experience no problems when I provide such header manually:</p>

<p>First request (failing example:)</p>

<pre><code>[main] INFO io.ktor.client.HttpClient - REQUEST: https://en.wikipedia.org/wiki/Main_Page
[main] INFO io.ktor.client.HttpClient - METHOD: HttpMethod(value=GET)
[main] INFO io.ktor.client.HttpClient - COMMON HEADERS
[main] INFO io.ktor.client.HttpClient - -&gt; Accept: application/json
[main] INFO io.ktor.client.HttpClient - -&gt; Accept-Charset: UTF-8
[main] INFO io.ktor.client.HttpClient - CONTENT HEADERS
</code></pre>

<p>Second request (succeeding example:)</p>

<pre><code>[main] INFO io.ktor.client.HttpClient - REQUEST: https://en.wikipedia.org/wiki/Main_Page
[main] INFO io.ktor.client.HttpClient - METHOD: HttpMethod(value=GET)
[main] INFO io.ktor.client.HttpClient - COMMON HEADERS
[main] INFO io.ktor.client.HttpClient - -&gt; Authorization: Basic dXNlcjpwYXNz
[main] INFO io.ktor.client.HttpClient - -&gt; Accept: application/json
[main] INFO io.ktor.client.HttpClient - -&gt; Accept-Charset: UTF-8
[main] INFO io.ktor.client.HttpClient - CONTENT HEADERS

</code></pre>

<h3>Environment</h3>

<ul>
<li>Kotlin: 1.4-M1</li>
</ul>

<p>Ktor Artifacts version 1.3.1:</p>

<ul>
<li>ktor-client-core</li>
<li>ktor-client-logging</li>
<li>ktor-client-json</li>
<li>ktor-client-serialization</li>
<li>ktor-client-auth-basic</li>
</ul>

<h3>Did I miss something?</h3>
","7598113","","","","","2020-04-26 01:08:35","Ktor client Auth feature does not sending Authorization header","<kotlin><ktor><kotlin-multiplatform><ktor-client>","1","3","","","","61362485","141923","141923","ktor-client","6","",""
"16823387","1","16839578","","2013-05-29 20:39:26","","1","647","<p>I am using Projekktor to display video, but if someone is using, say, an iPhone I want to send out a smaller video than the full 1080p that might be sent to a browser.</p>

<p>Is there a built-in way to do this, or do I need to do a user-agent check and create a playlist based on the device manually?</p>
","722","","","","","2013-05-30 15:01:42","Projekktor: supporting multiple video sizes","<html5-video><projekktor>","1","0","","","","16823387","92386","92386","projekktor","18","17010138","17010137"
"16827572","1","","","2013-05-30 03:43:15","","0","206","<p>I have been looking for a media player for a project that I am working on and I stumbled upon Speakker (<a href=""http://www.speakker.com/"" rel=""nofollow noreferrer"">http://www.speakker.com/</a>) today.  Speakker seems to offer exactly what I am looking for, however, there are a couple of buttons on the interface that I just can not have (see below in red).</p>

<p><img src=""https://i.stack.imgur.com/ZfPi3.png"" alt=""Player""></p>

<p>Has anyone else used this player before, and if so, how can I get rid of these buttons?</p>
","1282430","","","","","2013-05-30 15:06:28","Speakker Hide Social Media Buttons","<html5-audio><projekktor>","1","0","","","","16827572","92386","92386","projekktor","18","17010138","17010137"
"16908465","1","","","2013-06-04 01:32:48","","0","150","<p>Is there a way to allow the user to remove items from the speakker playlist?  I don't want to have to write a separate page that manages the playlist.</p>
","1282430","","","","","2013-06-04 02:44:49","Speakker - Allow user to remove items from playlist","<html5-audio><projekktor>","1","0","","","","16908465","92386","92386","projekktor","18","17010138","17010137"
"19639983","1","19656451","","2013-10-28 16:21:53","","0","192","<p>I'm using the <code>projekktor</code> player and I have some logic that will trigger the player to play:</p>

<p><code>player.setPlay();</code> when another song is complete. This works flawlessly on Chrome and Firefox, but on Safari, if I switch to another tab, it doesn't work until I switch back to the tab I'm on. This is for Safari on the Desktop on a Mac.</p>

<p>The relevant code is:</p>

<pre><code>function loopSong(){
    var idSong = player.getItemIdSong();
    $timeout(function(){
        player.setActiveItem(idSong);
        player.setPlay();
    }, 100);    
};
</code></pre>

<p>Any help would be greatly appreciated.</p>
","239879","","","","","2013-10-29 11:04:23","Looping in projekktor with Safari not working","<javascript><projekktor>","1","0","","","","19639983","92386","92386","projekktor","18","17010138","17010137"
"20194141","1","","","2013-11-25 13:20:05","","1","460","<p>I am trying to buffer / cache large video streams whenever the HTML5  tag is present.  The reason I am doing this is to have the ability ""scrub"" (i.e. move the playhead back-and-forth) the video frame-by-frame without having to request that individual part of the video from the server each time (doing that will cause jumpy frame scrubbing and also negatively impact people viewing over slower connections).  Its worth mentioning that I am attempting ultimately presenting the videos through Projekktor.  So far I have tried:</p>

<p>Using preload but to no success i.e.:</p>

<pre><code>$(""video"").on(""load"", function() {
   $(""video"").attr(""preload"", ""auto"");
});
</code></pre>

<p>I have also tried to specify video data with in the source itself, however, for large pages this causes performance issues (brings the Javascript engine to its knees) i.e. something like (projekktor aside):</p>

<pre><code>&lt;video&gt;&lt;source type=""video/mp4""; src=""base64,""/&gt;&lt;/video&gt;
...
...
&lt;script type=""text/javascript""&gt;
...
var vidData = myLargVideo;
$(""video"").attr(""src"", ""base64,"" + myLargeVideo);
...
&lt;/script&gt;
</code></pre>

<p>I have tried to manipulate the client browser using cache directives (i.e. Expires and Cache-Control) to no real effect, Chrome only caches the first 9 or so megabytes at its discretion.</p>

<p>I feel as if I am not on the right track any more but also feel there must be a more elegant approach out there which involves roughly what I am doing.  Any ideas? am I asking the impossible? Thoughts and suggestions would be much appreciated! Thank you!</p>

<p>In the meantime will continue to try out various things and will post here if I find anything noteworthy.</p>
","2065974","","","","","2013-11-25 13:20:05","Buffering and Caching a video in HTML5","<javascript><html><google-chrome><caching><projekktor>","0","2","","","","20194141","92386","92386","projekktor","18","17010138","17010137"
"45522470","1","45522613","","2017-08-05 13:28:34","","3","190","<p>I am trying to understand the HTML builder in Kotlin / Ktor. 
The <a href=""https://github.com/Kotlin/ktor/blob/5902c5d393bbab4171e5f92b48a9aa21f4d4d524/ktor-samples/ktor-samples-html/src/org/jetbrains/ktor/samples/html/HtmlApplication.kt#L14"" rel=""nofollow noreferrer"">example here</a> uses the HTML builder to build the result:</p>

<pre><code>call.respondHtml {
    head {
        title { +""HTML Application"" }
    }
    body {
        h1 { +""Sample application with HTML builders"" }
        widget {
            +""Widgets are just functions""
        }
    }
}
</code></pre>

<p>I am trying to extract the body into a variable like this:</p>

<pre><code>val block: HTML.() -&gt; Unit = {
    head {
        title { +""HTML Application"" }
    }
    body {
        h1 { +""Sample application with HTML builders"" }
    }
}
call.respondHtml(block)
</code></pre>

<p>Now I get the following compile error:</p>

<pre><code>Error:(37, 22) Kotlin: None of the following functions can be called with the arguments supplied: 
public suspend fun ApplicationCall.respondHtml(status: HttpStatusCode = ..., versions: List&lt;Version&gt; = ..., cacheControl: CacheControl? = ..., block: HTML.() -&gt; Unit): Unit defined in org.jetbrains.ktor.html
public suspend fun ApplicationCall.respondHtml(status: HttpStatusCode = ..., block: HTML.() -&gt; Unit): Unit defined in org.jetbrains.ktor.html
</code></pre>

<p>When I add the first (optional) argument it works again: <code>call.respondHtml(HttpStatusCode.OK, block)</code>.</p>

<p>Why does it not work, when I simply try to extract the body into a variable?</p>
","303637","","303637","","2017-11-28 17:59:19","2017-11-28 17:59:19","How do I extract parts of code into local variables in Kotlin when using Ktor's HTML builder?","<kotlin><extension-methods><dsl><ktor>","2","0","","","","45522470","128262","128262","ktor","265","45915935","45915934"
"45907278","1","45916074","","2017-08-27 16:57:55","","0","2091","<p>This is my code:</p>

<pre><code>package com.example.ktordemo

import org.jetbrains.ktor.application.Application
import org.jetbrains.ktor.application.install
import org.jetbrains.ktor.application.log
import org.jetbrains.ktor.auth.UserHashedTableAuth
import org.jetbrains.ktor.features.CallLogging
import org.jetbrains.ktor.features.ConditionalHeaders
import org.jetbrains.ktor.features.DefaultHeaders
import org.jetbrains.ktor.features.PartialContentSupport
import org.jetbrains.ktor.locations.*
import org.jetbrains.ktor.response.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.util.decodeBase64
import org.slf4j.Logger

@location(""/login"")
data class Login(val userId: String = """", val password: String = """", val error: String = """")

@location(""/userTable"") class SimpleUserTable

val hashedUserTable = UserHashedTableAuth(table = mapOf(
        ""test"" to decodeBase64(""VltM4nfheqcJSyH887H+4NEOm2tDuKCl83p5axYXlF0="")
))


fun Application.basicAuth() {
    install(DefaultHeaders)
    install(CallLogging)
    install(ConditionalHeaders)
    install(PartialContentSupport)
    install(Locations)
    install(Routing) {
        manual(log)
    }
}

fun Route.manual(log: Logger) {
    post&lt;Login&gt; {
        log.info(it.toString())
        call.respond(it.userId) // get nothing
    }
    get { login: Login -&gt;
        call.respond(""login page"")
    }
}
</code></pre>

<p>i use insomnia test the request, this is result:</p>

<pre><code>&gt; POST /login HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: insomnia/5.6.3
&gt; Accept: */*
&gt; Accept-Encoding: deflate, gzip
&gt; Content-Type: application/x-www-form-urlencoded
&gt; Content-Length: 33
| userId=username&amp;password=password


&lt; HTTP/1.1 200 OK
&lt; Date: Sun, 27 Aug 2017 16:52:20 GMT
&lt; Server: ktor-core/0.4.0 ktor-core/0.4.0
&lt; Content-Type: text/plain; charset=UTF-8
&lt; Content-Length: 0
</code></pre>

<p>Anyone can help me?</p>
","1994161","","147024","","2017-08-28 09:35:12","2017-08-28 09:44:45","Kotlin Ktor can't get post data with location data class","<kotlin><web-frameworks><ktor>","1","0","","","","45907278","128262","128262","ktor","265","45915935","45915934"
"46185168","1","","","2017-09-12 20:53:38","","5","2403","<p>The documentation talks about dependency injection but does not really show how it is being done.</p>

<p>Documentation is not completed as well and has a bunch of place holders:
<a href=""http://ktor.io/getting-started.html"" rel=""nofollow noreferrer"">http://ktor.io/getting-started.html</a></p>

<p>I tried to create my main function in a way that it accepts parameter (which is my dependency) but that failed on the test side when I call <code>withTestApplication</code>.
I looked into the application code and saw that Application accepts a configuration object but I have no idea how I can change that configuration object to inject some dependencies inside of it.</p>

<pre><code>package org.jetbrains.ktor.application

/**
 * Represents configured and running web application, capable of handling requests
 */
class Application(val environment: ApplicationEnvironment) : ApplicationCallPipeline() {
    /**
     * Called by host when [Application] is terminated
     */
    fun dispose() {
        uninstallAllFeatures()
    }
}

/**
 * Convenience property to access log from application
 */
val Application.log get() = environment.log
</code></pre>

<p>In the test code using <code>withTestApplication</code> I have something similar to the below:</p>

<pre><code>@Test
internal fun myTest() = withTestApplication (Application::myMain)
</code></pre>

<p>The above <code>withTestApplication</code> would fail if I call <code>myMain</code> with parameters (parameters that I need to mock and inject.)</p>

<p><strong>Update:</strong></p>

<p>The issue is that in my request handling, I am using a dependency class that connects to other web services outside and does some requests, I need a way to be able to inject this so in my tests I can stub/mock it and change its behavior based on my test cases.</p>
","1634695","","1634695","","2017-11-06 15:48:25","2019-01-11 00:53:12","How to inject dependencies in a ktor Application","<java><unit-testing><dependency-injection><kotlin><ktor>","2","0","2","","","46185168","128262","128262","ktor","265","45915935","45915934"
"23149075","1","","","2014-04-18 07:00:44","","0","231","<p>Hi I am using html5 video tag.
I am using -webkit to use pinterest kind of layout.
i have a problem in showing the videos.
The videos are showed only in the first column, no videos shown in the 2nd and 3rd columns.
But i can hear the audio which confirm the video is working fine but something blocks.
I tried removing the webkit and tried the layout changed but all videos are working fine.</p>

<p>here is my css.</p>

<pre><code>&lt;style type=""text/css""&gt;
    #wrapper1 {
        width: 90%;
        max-width: 1100px;
        min-width: 800px;
        margin: 50px auto;
    }

    .pin1 {
        display: inline-block;
        background: #FEFEFE;
        border: 2px solid #FAFAFA;
        box-shadow: 0 1px 2px rgba(34, 25, 25, 0.4);
        margin: 0 2px 15px;
        -webkit-column-break-inside: avoid;
        -moz-column-break-inside: avoid;
        column-break-inside: avoid;
        padding: 15px;
        padding-bottom: 5px;
        background: -webkit-linear-gradient(45deg, #FFF, #F9F9F9);
        opacity: 1;
        -webkit-transition: all .2s ease;
        -moz-transition: all .2s ease;
        -o-transition: all .2s ease;
        transition: all .2s ease;
        z-index: 10;
    }

        .pin1:hover {
            background-color: #F3F5D5;
        }

    #columns1 {
        -webkit-column-count: 3;
        -webkit-column-gap: 10px;
        -webkit-column-fill: auto;
        -webkit-backface-visibility: hidden;
        -webkit-transform: translateZ(0);
        -moz-column-count: 3;
        -moz-column-gap: 10px;
        -moz-column-fill: auto;
        column-count: 3;
        column-gap: 15px;
        column-fill: auto;
        z-index: 10;
    }
&lt;/style&gt;


  &lt;div id=""wrapper1""&gt;
        &lt;div id=""column1""&gt;
            &lt;div class=""pin1""&gt;
                &lt;video id=""Video1"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""240"" style=""vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;

            &lt;div class=""pin1""&gt;
                &lt;video id=""Video2"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""540"" style=""z-index: 2; vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;

            &lt;div class=""pin1""&gt;
                &lt;video id=""Video3"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""340"" style=""vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;

            &lt;div class=""pin1""&gt;
                &lt;video id=""Video4"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""240"" style=""vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;

            &lt;div class=""pin1""&gt;
                &lt;video id=""Video5"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""240"" style=""vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;

            &lt;div class=""pin1""&gt;
                &lt;video id=""Video6"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""300"" height=""240"" style=""vertical-align: top;"" &gt;
                    &lt;source src=""Projekktor/media/intro.mp4"" type=""video/mp4"" /&gt;
                &lt;/video&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;``
</code></pre>

<p>can someone help me in this.</p>
","3547956","","","","","2014-09-23 15:25:53","-webkit-column-count 3, only Video working in 1st column, no video in nd and 3rd column","<css><webkit><projekktor>","1","0","1","","","23149075","92386","92386","projekktor","18","17010138","17010137"
"23851401","1","23856074","","2014-05-25 02:15:09","","1","385","<p>Given this example:</p>

<pre><code> &lt;video width=""320"" height=""240"" controls&gt;
  &lt;source src=""movie.mp4"" type=""video/mp4""&gt;
  &lt;source src=""movie.ogg"" type=""video/ogg""&gt;
  Your browser does not support the video tag.
&lt;/video&gt;
</code></pre>

<p>how do you get the ""controls"" attribute working with XPages?  The DDE editor doesn't seem to like that.  I believe it's expecting it on the format of name=""value"".</p>

<p>I'm not sure how to do this.</p>

<p>thanks!</p>
","1167559","","785061","","2014-05-25 05:08:33","2016-02-19 08:29:33","Using html5 video tag with XPages","<html><video><xpages><projekktor>","2","0","","","","23851401","92386","92386","projekktor","18","17010138","17010137"
"23975133","1","","","2014-05-31 22:45:10","","0","588","<p>I'm trying to create some Json from an XPages ""XAgent"" using Java.  There's a particular format I'm trying to it and it uses an Integer as a key and I keep getting some errors that I don't understand.</p>

<p>Here's an example error:
Caused by: java.lang.ClassCastException: java.lang.Integer incompatible with java.lang.String
at com.ibm.commons.util.io.json.JsonGenerator$Generator.outObject(JsonGenerator.java:202)
at com.ibm.commons.util.io.json.JsonGenerator$Generator.outLiteral(JsonGenerator.java:163)
at com.ibm.commons.util.io.json.JsonGenerator$Generator.outLiteral(JsonGenerator.java:142)
at com.ibm.commons.util.io.json.JsonGenerator$Generator.toJson(JsonGenerator.java:138)
at com.ibm.commons.util.io.json.JsonGenerator.toJson(JsonGenerator.java:64)
at com.ibm.commons.util.io.json.JsonGenerator.toJson(JsonGenerator.java:49)</p>

<p>I'm trying to create JSon output like this:</p>

<pre><code>[
  {
     // minimum 
     0:{src:'item_one_format_one.ext', type: 'video/...'}     
  },
  {
     // one content, multiple formats
     0:{src:'item_two_format_one.ext', type: 'video/...'},
     1:{src:'item_two_format_two.ext', type: 'video/...'}
  },
  {
     // one content, multiple formats, item specific config
     0:{src:'item_three_format_one.ext', type: 'video/...'},
     1:{src:'item_three_format_two.ext', type: 'video/...'},
     3:{src:'item_three_format_three.ext', type: 'video/...'},
     4:{src:'item_three_format_four.ext', type: 'video/...'},          
     config: {
        option1: value1,
        option2: value2
     }

]      
</code></pre>

<p>Not it is multiple ""objects"" and the last one seems to be a combination of Integer and String for the key value.</p>

<p>Here is some code I tried and got working kinda of:</p>

<pre><code>public String testList() throws JsonException, IOException {

        Integer count = 0;

        Map&lt;String, Object&gt; containerMap = new TreeMap&lt;String, Object&gt;();
        System.out.println(""A"");


        TreeMap&lt;String, String&gt; stringMap = new TreeMap&lt;String, String&gt;();
        System.out.println(""B"");
        stringMap.put(""One"", ""Value1"");
        stringMap.put(""Two"", ""Value2"");
        System.out.println(""C"");

        containerMap.put(""1"", ""One"");
        count++;
        containerMap.put(""2"", ""Two"");
        count++;
        containerMap.put(""3"", ""Three"");

        System.out.println(""D"");

        String json = JsonGenerator.toJson(new JsonJavaFactory(), containerMap);
        System.out.println(""E"");
        return json;

    }
</code></pre>

<p>this code produces: </p>

<pre><code>{
    ""1"": ""Zero"",
    ""2"": ""One"",
    ""3"": ""Two""
}
</code></pre>

<p>Note the quotes for the key value.  I assume that's going to be a problem.  I was enable to get Integers in for the key. And I'm not sure how to mix Integers with String as seen in the 3rd object example.</p>

<p>Any advice would be appreciated.  Thanks!</p>
","1167559","","","","","2014-06-01 07:33:49","Creating Json from XAgent","<java><json><xpages><projekktor>","2","3","0","","","23975133","92386","92386","projekktor","18","17010138","17010137"
"46208543","1","46213784","","2017-09-14 00:06:14","","4","1343","<p>Trying to utilise the automatic module reloading feature (as described <a href=""http://ktor.io/application/autoreload.html"" rel=""nofollow noreferrer"">here</a>), but the documentation is unfortunately not too helpful.</p>

<p>It says to use configuration, but the configuration <a href=""http://ktor.io/application/configuration.html"" rel=""nofollow noreferrer"">page</a> is empty.</p>

<p>I believe you can pass in the ""watch"" list of modules into the <code>embeddedServer()</code> call from <a href=""http://ktor.io/getting-started.html"" rel=""nofollow noreferrer"">this page</a>, but when I do, I get the following exception: <code>Module function provided as lambda cannot be unlinked for reload</code>.</p>

<p>So it won't let you pass in a lambda as an application module, but then I'm not sure how to avoid doing that while getting access to the <code>Application</code> methods (e.g. <code>routing()</code>).</p>

<p>Has anyone been able to get automatic reloading working lately?
If so, how?</p>
","2117581","","","","","2017-09-14 08:09:18","How can we use automatic reloading?","<kotlin><ktor>","1","0","1","","","46208543","128262","128262","ktor","265","45915935","45915934"
"46363539","1","46363818","","2017-09-22 11:20:26","","1","545","<p>I'm very new to Kotlin and Ktor and Gradle, wanted to try Ktor, so gone through the steps explained <a href=""http://ktor.io/getting-started-idea#start-a-project"" rel=""nofollow noreferrer"">here</a>, and ended up with this code, and structure shown in the screenshot:</p>

<p>As seen there are lots of error, how to fix them?</p>

<pre><code>package blog

import org.jetbrains.ktor.netty.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.host.*
import org.jetbrains.ktor.http.*
import org.jetbrains.ktor.response.*

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080) {
        routing {
            get(""/"") {
                call.respondText(""My Example Blog"", ContentType.Text.Html)
            }
        }
    }.start(wait = true)
}
</code></pre>

<p>The <code>build.gradle</code> file is auto generated as:</p>

<pre><code>group 'Example'
version '1.0-SNAPSHOT'

buildscript {
    ext.kotlin_version = '1.1.4-3'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
</code></pre>

<p><a href=""https://i.stack.imgur.com/iTueo.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/iTueo.png"" alt=""enter image description here""></a></p>
","2441637","","542270","","2017-09-22 11:34:34","2017-09-22 12:36:54","Ktor startup example errors","<gradle><kotlin><ktor>","1","0","","","","46363539","128262","128262","ktor","265","45915935","45915934"
"46365605","1","46365802","","2017-09-22 13:08:43","","6","1296","<p>I'm very new to Kotlin and Ktor and Gradle. Was able to create embedded server as explained in Ktor site, with the following code:</p>

<p><strong>BlogApp.kt</strong>:</p>

<pre><code>package blog

import org.jetbrains.ktor.netty.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.features.*
import org.jetbrains.ktor.host.*
import org.jetbrains.ktor.http.*
import org.jetbrains.ktor.response.*

fun Application.module() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        get(""/"") {
            call.respondText(""My Example Blog  sfs 122"", ContentType.Text.Html)
        }
    }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""BlogAppKt""), module = Application::module).start()
}
</code></pre>

<p>and <strong>build.gradle</strong>:</p>

<pre><code>group 'Example'
version '1.0-SNAPSHOT'

buildscript {
    ext.kotlin_version = '1.1.4-3'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'

sourceCompatibility = 1.8
ext.ktor_version = '0.4.0'

repositories {
    mavenCentral()
    maven { url  ""http://dl.bintray.com/kotlin/ktor"" }
    maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
}

dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version""
    compile ""org.jetbrains.ktor:ktor-core:$ktor_version""
    compile ""org.jetbrains.ktor:ktor-netty:$ktor_version""
    compile ""ch.qos.logback:logback-classic:1.2.1""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
kotlin {
    experimental {
        coroutines ""enable""
    }
}
</code></pre>

<p>The server run fine at: <code>localhost:8080</code></p>

<p>and the I can see the below files in the <code>out</code> folder:</p>

<p><code>C:\Users\Home\IdeaProjects\Example\out\production\classes\blog</code></p>

<p>How can I know create an executable file .jar of this server, so I can distribute it to the user? </p>

<p><a href=""https://i.stack.imgur.com/uzawJ.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/uzawJ.png"" alt=""enter image description here""></a></p>
","2441637","","542270","","2017-09-22 13:20:46","2017-09-23 09:22:34","How to create .jar (Create Executable) of the Ktor embedded Server","<java><gradle><kotlin><ktor>","1","0","","","","46365605","128262","128262","ktor","265","45915935","45915934"
"24416392","1","","","2014-06-25 18:54:32","","0","1961","<p>Hi im trying to make the video player responsive heres my code:</p>

<pre><code>    &lt;!-- Load projekktor css --&gt;
    &lt;link rel=""stylesheet"" href=""themes/maccaco/projekktor.style.css"" type=""text/css"" media=""screen"" /&gt;

    &lt;!-- Load jquery --&gt;
    &lt;script src=""http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js""&gt;&lt;/script&gt;

    &lt;!-- load projekktor js --&gt;
    &lt;script type=""text/javascript"" src=""projekktor-1.4.00-test.js""&gt;&lt;/script&gt;    &lt;/head&gt;
&lt;body&gt;

    &lt;div id=""player_a"" class=""projekktor""&gt;
        &lt;noscript&gt;&lt;p&gt;No JavaScript support.&lt;/p&gt;&lt;/noscript&gt;
    &lt;/div&gt;
    &lt;script type=""text/javascript""&gt;
        $(document).ready(function() {
            projekktor('#player_a', {

              controls: true,
              autoplay: true,
              title: 'Projekktor - Inline HLS video support',
              playerFlashMP4: 'swf/StrobeMediaPlayback/StrobeMediaPlayback_hls_mss.swf',
                playerFlashMP3: 'swf/StrobeMediaPlayback /StrobeMediaPlayback_hls_mss.swf',
                width: 640,
                height: 385,
                platforms: ['browser', 'ios', 'android', 'flash', 'native'],
                playlist: [     
                    {
                    0: {src: ""http://ip:1935/videostreaming/videostreaming/playlist.m3u8"", type: ""application/mpegURL"", streamType: ""httpVideo""}, // your HLS manifest goes here
                    1: {src: """", type: ""video/mp4"", streamType: ""http""} // you can even add progressive fallback
                    }
          ]    
            }
            );
        });
    &lt;/script&gt;
&lt;/body&gt;
</code></pre>

<p></p>

<p>when i put width : 100% and height 100% the video dissapears but i have sound how i can fix this.</p>

<p>thank you.</p>
","626611","","","","","2014-06-25 19:14:09","responsive live streaming player projekktor","<html><streaming><projekktor>","1","0","","","","24416392","92386","92386","projekktor","18","17010138","17010137"
"28095772","1","","","2015-01-22 18:08:13","","0","92","<p>I'm using projekktor for streaming my videos on browsers. I have many listeners attached on the event <code>state</code>.</p>

<pre><code>video.addListener('state', listener1);
video.addListener('state', listener2);
video.addListener('state', listener3);
</code></pre>

<p>Inside the function listener3 and when <code>state === 'COMPLETED'</code> I need to remove the listener <code>listener3</code>. The thing is that to remove a listener you need the variable video.
Given that listener3 is a callback, <strong>How do I pass the variable video to the function listener3?</strong></p>
","1507546","","211627","","2015-01-22 18:28:28","2015-01-22 18:31:32","How to pass a variable to a listener/handler function","<javascript><jquery><callback><projekktor>","1","2","","","","28095772","92386","92386","projekktor","18","17010138","17010137"
"30097843","1","30098351","","2015-05-07 10:04:43","","0","2682","<p>On my website, I'd like to be able to stop the video loading. Can I do it with jquery? What're my options?</p>

<p>The need is that my website has many videos, when a user with a limited internet connection wanna see a one-hour video then decides that he wants quit the video page (ajax only is performed), the video continues its loading anyway, so if does this with two or three videos his browser will freeze to death. So unless he refreshes the page, the video loading goes on til it's done.</p>

<p>Given that my web's based on apache2, symfony2/php5, projekktor/jquery</p>
","1507546","","1507546","","2015-05-07 15:25:16","2015-05-07 15:25:16","stop loading/buffering the video with projekktor/jquery/javascript","<javascript><jquery><ajax><apache2><projekktor>","3","4","","","","30097843","92386","92386","projekktor","18","17010138","17010137"
"31748319","1","","","2015-07-31 14:14:34","","1","1602","<p>I need to embed Youtube videos on the site... But without the YouTube logo...</p>

<p>I suppose I need to use a custom web player, like <a href=""http://www.projekktor.com/"" rel=""nofollow noreferrer"">projekktor</a>...</p>

<p>But in its <a href=""http://www.projekktor.com/demos/javascript/"" rel=""nofollow noreferrer"">online example</a> of adding youtube (to the playlist in their case) this feature does not work (the mp4 video plays normally, then Youtube video fails to play - invalid stream)...</p>

<p>Is the example or projekktor problem?
What are other ways to (freely) embed YouTube in a customized player (witout youtube logo) ?</p>

<p>Here is another <a href=""https://stackoverflow.com/questions/16245023/unable-to-get-projekktor-to-play-more-than-one-youtube-video-in-my-playlist"">related question</a>, but I have the same ""output"" - invalid stream for YouTube links...</p>
","961631","","-1","","2017-05-23 12:30:12","2015-08-12 16:31:41","Play YouTube video with custom web player","<html><video><youtube><projekktor>","1","1","","","","31748319","92386","92386","projekktor","18","17010138","17010137"
"34621952","1","34639152","","2016-01-05 21:57:03","","1","265","<p>I am trying to install Lektor on a MacbookPro with OS X 10.6.8.</p>

<p>Imagemagick and Python2.7 are already installed.</p>

<p>When I run the installation command:</p>

<pre><code>curl -sf https://www.getlektor.com/install.sh | sh
</code></pre>

<p>The build process runs until it gets an error when building '_watchdog_fsevents' extension. The error is: </p>

<blockquote>
  <p>cc1: error: -Werror=unused-command-line-argument-hard-error-in-future: No option -Wunused-command-line-argument-hard-error-in-future</p>
</blockquote>

<p>I've cut and pasted the output just prior to the error into the following code section.</p>

<p>How should I overcome this?</p>

<pre class=""lang-none prettyprint-override""><code>  running build_ext
  building '_watchdog_fsevents' extension
  creating build/temp.macosx-10.6-x86_64-2.7
  creating build/temp.macosx-10.6-x86_64-2.7/src
  gcc-4.2 -fno-strict-aliasing -fno-common -dynamic -I/usr/local/include -I/usr/local/opt/sqlite/include -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -Wno-error=unused-command-line-argument-hard-error-in-future -DWATCHDOG_VERSION_STRING=""0.8.3"" -DWATCHDOG_VERSION_MAJOR=0 -DWATCHDOG_VERSION_MINOR=8 -DWATCHDOG_VERSION_BUILD=3 -I/usr/local/Cellar/python/2.7.9/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c src/watchdog_fsevents.c -o build/temp.macosx-10.6-x86_64-2.7/src/watchdog_fsevents.o -std=c99 -pedantic -Wall -Wextra -fPIC -Wno-error=unused-command-line-argument-hard-error-in-future
  cc1: error: -Werror=unused-command-line-argument-hard-error-in-future: No option -Wunused-command-line-argument-hard-error-in-future
  cc1: error: -Werror=unused-command-line-argument-hard-error-in-future: No option -Wunused-command-line-argument-hard-error-in-future
  error: command 'gcc-4.2' failed with exit status 1

  ----------------------------------------
  Failed building wheel for watchdog
Failed to build watchdog
</code></pre>
","5749578","","1591669","","2017-10-17 23:37:31","2017-10-17 23:37:31","Lektor installation fails on MacBookPro OS X 10.6.8","<macos><install><lektor>","2","0","","","","34621952","116940","116940","lektor","40","34631336","34631335"
"34631288","1","34631289","","2016-01-06 10:51:41","","2","336","<p>I am trying to develop a reStructuredText plugin and doing some basic mistake.</p>

<p>My plugin object looks like this:</p>

<pre><code>class RSTPlugin(Plugin):
    name = 'RST'
    description = 'RST plugin'

    def on_setup_env(self, **extra):
        self.env.jinja_env.filters['markdown'] = \
            jinja2.contextfilter(lambda ctx, *a, **kw: RST(*a, **kw))
</code></pre>

<p>Now: the <code>on_setup_env</code> function is called. Notice that I am replacing the markdown dict entry (for now). But when I run lektor the original Markdown class is called and not my RST one.</p>
","19990","","","","","2016-01-06 10:51:41","Plugin Development for Lektor","<python><lektor>","1","0","","","","34631288","116940","116940","lektor","40","34631336","34631335"
"34828600","1","","","2016-01-16 15:19:25","","3","259","<p>I have checked the CMS. The programme looks very nice.</p>

<p>Instead of markdown I would like to use rather restructured text.</p>

<p>Is RST markup also supported?</p>
","5678299","","","","","2016-01-16 16:21:58","Support RST markup in lektor?","<markdown><markup><restructuredtext><lektor>","1","0","","","","34828600","116940","116940","lektor","40","34631336","34631335"
"34830092","1","34831517","","2016-01-16 17:45:33","","-2","97","<p>The video on 
<a href=""https://www.getlektor.com/docs/deployment/travisci/"" rel=""nofollow"">https://www.getlektor.com/docs/deployment/travisci/</a></p>

<p>describes the set-up nicely.</p>

<p>Is there an option to make run the whole local git committing &amp; pushing via the publish link in the admin interface?</p>
","5678299","","","","","2016-01-16 20:03:00","GH pages deploy via admin interface","<github><deployment><publishing><github-pages><lektor>","1","0","","2016-01-17 11:32:13","","34830092","116940","116940","lektor","40","34631336","34631335"
"34979831","1","35020790","","2016-01-24 18:39:55","","6","718","<p>I am currently using Nikola as page generator. </p>

<p>But depending on the page scope and users, Lektor seems to be easier and more streamlined for the end-user. This fits well for a new page I plan.</p>

<p>Nikola also embedds media (youtube, vimeo, soundcloud, etc.)
<a href=""https://getnikola.com/handbook.html#restructuredtext-extensions"">https://getnikola.com/handbook.html#restructuredtext-extensions</a></p>

<p>How is such functionality provided by Lektor?</p>
","5678299","","","","","2016-02-11 00:47:35","Embed media content in lektor pages?","<markdown><media><markup><nikola><lektor>","3","0","3","","","34979831","116940","116940","lektor","40","34631336","34631335"
"46384446","1","52468291","","2017-09-23 21:28:32","","1","2956","<p>I'm new to Java and Kotlin, trying to build a contact form with <code>Ktor</code>, so I enabled the insecure connection of my gmail from <a href=""https://myaccount.google.com/lesssecureapps?pli=1"" rel=""nofollow noreferrer"">here</a>, and built the app below:</p>

<p><code>blogApp.kt</code>:</p>

<pre><code>package blog

import org.jetbrains.ktor.netty.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.features.*
import org.jetbrains.ktor.host.*
import org.jetbrains.ktor.http.*
import org.jetbrains.ktor.response.*

import org.apache.commons.mail.*

fun Application.module() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        get(""/"") {
            call.respondText(""""""
            My Example Blog2
                &lt;form action=""/contact-us"" method=""post""&gt;
                    &lt;input name=""subject"" placeholder=""Subject""&gt;
                    &lt;br&gt;
                    &lt;textarea name=""message"" placeholder=""Your message ...""&gt;&lt;/textarea&gt;
                    &lt;br&gt;
                    &lt;button&gt;Submit&lt;/button&gt;
                &lt;/form&gt;
            """""", ContentType.Text.Html)
        }
        post(""/contact-us"") {
            SimpleEmail().apply {
                setHostName(""smtp.gmail.com"")
                setSmtpPort(465)
                setAuthenticator(DefaultAuthenticator(""my_alias@gmail.com"", ""my_gmil_passoword""))
                setSSLOnConnect(true)
                setFrom(""my_alias@gmail.com"")
                setSubject(""subject"")        // I need to use formParam
                setMsg(""message"")            // I need to use formParam
                addTo(""my_alias@gmail.com"")
            }.send() // will throw email-exception if something is wrong
            call.respondRedirect(""/contact-us/success"")
        }
        get(""/contact-us/success"") { 
            call.respondText(""Your message was sent"", ContentType.Text.Html) 
        }
    }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""BlogAppKt""), module = Application::module).start()
}
</code></pre>

<p><code>build.gradle</code>:</p>

<pre><code>group 'Example'

version 'alpha'

buildscript {
    ext.kotlin_version = '1.1.4-3'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'

sourceCompatibility = 1.8
ext.ktor_version = '0.4.0'

repositories {
    mavenCentral()
    maven { url  ""http://dl.bintray.com/kotlin/ktor"" }
    maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
}

dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version""
    compile ""org.jetbrains.ktor:ktor-core:$ktor_version""
    compile ""org.jetbrains.ktor:ktor-netty:$ktor_version""
    compile ""org.apache.commons:commons-email:1.4""
    compile ""org.slf4j:slf4j-simple:1.7.25""
    compile ""ch.qos.logback:logback-classic:1.2.1""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
kotlin {
    experimental {
        coroutines ""enable""
    }
}


jar {
    baseName 'abc'
    manifest {
        attributes 'Main-Class': 'blog.BlogAppKt'
    }

    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
}
</code></pre>

<p>and things gone smoothly with it, I was able to send an email to myself then redirect to the success page, but the message got sent is with pre-set data:</p>

<pre><code>        setSubject(""subject"")        // I need to use formParam
        setMsg(""message"")            // I need to use formParam
</code></pre>

<p>how can I make the <code>Ktor</code> receive the data the user really entered in the form, how can I read the form params?</p>
","2441637","","2441637","","2017-09-24 11:46:51","2018-09-23 16:53:32","Receiving form params to Ktor server","<kotlin><ktor>","2","0","","","","46384446","128262","128262","ktor","265","45915935","45915934"
"46390023","1","46393611","","2017-09-24 12:26:44","","4","1236","<p>I'm new to <code>Kotlin</code> and <code>Ktor</code> the below is working fine with me as startup, now I need to add more <code>Routes</code> how can I split the routes in multiple files?</p>

<pre><code>package blog

import org.jetbrains.ktor.netty.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.features.*
import org.jetbrains.ktor.host.*
import org.jetbrains.ktor.http.*
import org.jetbrains.ktor.response.*
import org.jetbrains.ktor.request.*     // for recieve
import org.jetbrains.ktor.util.*       // for ValuesMap

import org.apache.commons.mail.*

fun Application.module() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        get(""/"") {
            call.respondText(""""""
            My Example Blog2
                &lt;form action=""/contact-us"" method=""post""&gt;
                    &lt;input name=""subject"" placeholder=""Subject""&gt;
                    &lt;br&gt;
                    &lt;textarea name=""message"" placeholder=""Your message ...""&gt;&lt;/textarea&gt;
                    &lt;br&gt;
                    &lt;button&gt;Submit&lt;/button&gt;
                &lt;/form&gt;
            """""", ContentType.Text.Html)
        }
        post(""/contact-us"") {
            val post = call.receive&lt;ValuesMap&gt;() 
            SimpleEmail().apply {
                setHostName(""smtp.gmail.com"")
                setSmtpPort(465)
                setAuthenticator(DefaultAuthenticator(""my_alias@gmail.com"", ""my_gmil_passoword""))
                setSSLOnConnect(true)
                setFrom(""my_alias@gmail.com"")
                setSubject(post[""subject""])        
                setMsg(post[""message""])            
                addTo(""my_alias@gmail.com"")
            }.send() // will throw email-exception if something is wrong
            call.respondRedirect(""/contact-us/success"")
        }
        get(""/contact-us/success"") { 
            call.respondText(""Your message was sent"", ContentType.Text.Html) 
        }
    }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""BlogAppKt""), module = Application::module).start()
}
</code></pre>
","2441637","","","","","2017-09-24 18:44:42","Splitting Routes into multiple files","<kotlin><ktor>","1","0","2","","","46390023","128262","128262","ktor","265","45915935","45915934"
"46394185","1","46394339","","2017-09-24 19:47:34","","2","1219","<p>I'm trying to test the HTML Application, my <code>build.gradle</code> dependencies are:</p>

<pre><code>dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version""
    compile ""org.jetbrains.ktor:ktor-core:$ktor_version""
    compile 'org.jetbrains.kotlinx:kotlinx-html:0.6.4'
    compile ""org.jetbrains.ktor:ktor-netty:$ktor_version""
    compile ""org.apache.commons:commons-email:1.4""
    compile ""org.slf4j:slf4j-simple:1.7.25""
    compile ""ch.qos.logback:logback-classic:1.2.1""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}
</code></pre>

<p>I got the below error while running gradle build:</p>

<blockquote>
  <p>Could not find org.jetbrains.kotlinx:kotlinx-html:0.6.4</p>
</blockquote>

<p>what is the error here?</p>
","2441637","","2441637","","2017-09-25 19:25:05","2017-09-25 19:31:16","Could not find org.jetbrains.kotlinx:kotlinx-html:0.6.4","<gradle><kotlin><ktor><kotlinx-html>","2","0","","","","46394185","128262","128262","ktor","265","45915935","45915934"
"46455185","1","46496586","","2017-09-27 18:49:24","","2","2299","<p>I'm very new to <code>Kotlin</code> (and Java), as well as <code>Ktor</code> and <code>FreeMaker</code>, trying to make an app combining all of them, but looks I'm doing something wrong related to the <code>FreeMaker</code> templates manipulating.</p>

<p>My app structure is:</p>

<p><a href=""https://i.stack.imgur.com/qIFhN.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/qIFhN.png"" alt=""enter image description here""></a></p>

<p><code>template.ftl</code>:</p>

<pre><code>&lt;#macro mainLayout title=""Welcome""&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv=""Content-Type"" content=""text/html; charset=UTF-8""&gt;

    &lt;title&gt;${title} | Kweet&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
HI
&lt;/body&gt;
&lt;/html&gt;
&lt;/#macro&gt;
</code></pre>

<p><code>index.ftl</code>:</p>

<pre><code>&lt;#import ""template.ftl"" as layout /&gt;
imported title: ${title}
&lt;@layout.mainLayout title=""Welcome""&gt;
&lt;div class=""posts""&gt;
    &lt;h3 class=""content-subhead""&gt;Top 10&lt;/h3&gt;
&lt;/div&gt;
&lt;/@layout.mainLayout&gt;
</code></pre>

<p><code>BlogApp.kt</code>:</p>

<p>package blog</p>

<pre><code>import kotlinx.html.*
import org.jetbrains.ktor.freemarker.*
import org.jetbrains.ktor.host.*   // for embededServer
import org.jetbrains.ktor.netty.*  // for Netty
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.features.*
import org.jetbrains.ktor.html.*
import org.jetbrains.ktor.routing.*
import org.jetbrains.ktor.response.*

fun Application.module() {   
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        get(""/"") {
           val model = mapOf(""id"" to 1, ""title"" to ""Hello, World!"")
           call.respond(FreeMarkerContent(""index.ftl"", model, ""e""))
        }
    }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""BlogAppKt""), module = Application::module).start()
}
</code></pre>

<p><code>build.gradle</code>:</p>

<pre><code>group 'Example'

version 'alpha'

buildscript {
    ext.kotlin_version  = '1.1.4-3'
    ext.ktor_version    = '0.4.0'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'


sourceCompatibility = 1.8

repositories {
    jcenter()
    mavenCentral()
    maven { url  ""http://dl.bintray.com/kotlin/ktor"" }
    maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
}

dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version""
    compile ""org.jetbrains.ktor:ktor-core:$ktor_version""
    compile ""org.jetbrains.ktor:ktor-netty:$ktor_version""
    compile ""org.jetbrains.ktor:ktor-html-builder:$ktor_version""

    compile ""org.jetbrains.ktor:ktor-freemarker:$ktor_version""

    compile ""org.apache.commons:commons-email:1.4""
    compile ""org.slf4j:slf4j-simple:1.7.25""
    compile ""ch.qos.logback:logback-classic:1.2.1""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
kotlin {
    experimental {
        coroutines ""enable""
    }
}


jar {
    baseName 'abc'
    manifest {
        attributes 'Main-Class': 'blog.BlogAppKt'
    }

    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
}
</code></pre>

<p>I got the below output upon starting the server:</p>

<p><a href=""https://i.stack.imgur.com/1F8kv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/1F8kv.png"" alt=""enter image description here""></a></p>
","2441637","","2441637","","2017-09-29 21:19:54","2017-09-29 21:19:54","Handling FreeMaker template with Ktor Kotlin","<kotlin><freemarker><ktor>","1","0","1","","","46455185","128262","128262","ktor","265","45915935","45915934"
"35411692","1","35439896","","2016-02-15 14:16:13","","-2","351","<p>The Lektor server is running on port 5000 on localhost. I want to make it accessible via an Apache URL at <a href=""http://myhost.org/lektor"" rel=""nofollow"">http://myhost.org/lektor</a>. Therefore, I've tried the httpd config snippet</p>

<pre><code>ProxyPass        /lektor http://127.0.0.1:5000
ProxyPassReverse /lektor http://127.0.0.1:5000
</code></pre>

<p>The HTML for the welcome page is found, but the static pages referenced there (e.g., <a href=""http://myhost.org/static/style.css"" rel=""nofollow"">http://myhost.org/static/style.css</a>) are not. How can I make the changed URL known to Lektor?</p>
","4193363","","","","","2016-04-12 14:12:51","Reverse proxy for Lektor CMS","<lektor>","2","0","","","","35411692","116940","116940","lektor","40","34631336","34631335"
"35560505","1","","","2016-02-22 17:52:48","","0","113","<p>I've written my language switcher as below.</p>

<p>It works from <code>/</code> or from <code>/blog/&lt;blog-post&gt;</code> but it does not work from the <code>/blog</code> page even if <code>/en/blog</code> is available.</p>

<pre><code>&lt;a href=""{{ '.'|url(alt='jp') }}""&gt;Japanese&lt;/a&gt; | &lt;a href=""{{ '.'|url(alt='en') }}""&gt; English &lt;/a&gt;
</code></pre>

<p>Is it bug or should I fix something?</p>

<p>Below is my web site language switcher is available on top-right of the page.</p>

<ul>
<li>Working (top level page): <a href=""http://www.socoka.com/"" rel=""nofollow"">http://www.socoka.com/</a>  </li>
<li>Not working (Blog page): <a href=""http://www.socoka.com/blog/"" rel=""nofollow"">http://www.socoka.com/blog/</a></li>
</ul>
","5964382","","1591669","","2017-10-17 23:42:05","2017-10-17 23:42:05","My language switcher does not work only from the blog page","<lektor><language-switching>","2","1","","","","35560505","116940","116940","lektor","40","34631336","34631335"
"35685899","1","","","2016-02-28 17:37:18","","1","354","<p>I can not figure out how to get the flow field working in admin, </p>

<p>I would like example shown at shown <a href=""https://raw.githubusercontent.com/lektor/lektor-assets/master/screenshots/admin.png"" rel=""nofollow"">https://raw.githubusercontent.com/lektor/lektor-assets/master/screenshots/admin.png</a>  When I then click through to localhost:5000/admin/root/edit and get the <a href=""http://i.imgur.com/EPCrBRC.png"" rel=""nofollow"">http://i.imgur.com/EPCrBRC.png</a></p>

<p>Got I feel I am doing something simple wrong. But cutting it down to basic here is what I tried:-</p>

<pre><code>$ cd /tmp/
$ lektor quickstart
Lektor Quickstart
=================

This wizard will generate a new basic project with some sensible defaults for
getting started quickly.  We jsut need to go through a few questions so that
the project is set up correctly for you.

Step 1:
| A project needs a name.  The name is primarily used for the admin UI and
| some other places to refer to your project to not get confused if multiple
| projects exist.  You can change this at any later point.
&gt; Project Name: flow-example

Step 2:
| This is the path where the project will be located.  You can move a
| project around later if you do not like the path.  If you provide a
| relative path it will be relative to the working directory.
&gt; Project Path [/tmp/flow-example]: 

Step 3:
| Do you want to generate a basic blog module?  If you enable this the
| models for a very basic blog will be generated.
&gt; Add Basic Blog [Y/n]: n

Step 4:
| Your name.  This is used in a few places in the default template to refer
| to in the default copyright messages.
&gt; Author Name [Brendan M. Sleight,,,]:   

That's all. Create project? [Y/n] Y
$ cd flow-example/
$ echo ""[fields.extra]
&gt; label = Extra
&gt; type = flow
&gt; flow_blocks = text"" &gt;&gt;./models/page.ini
$ cat ./models/page.ini 
[model]
name = Page
label = {{ this.title }}

[fields.title]
label = Title
type = string

[fields.body]
label = Body
type = markdown
[fields.extra]
label = Extra
type = flow
flow_blocks = text
$ lektor server
 * Project path: /tmp/flow-example/flow-example.lektorproject
 * Output path: /home/bms/.cache/lektor/builds/76682e6a8f99116f0da91bcf96203e94
Started source info update
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
Finished source info update in 0.05 sec
Started build
U index.html
U about/index.html
U projects/index.html
Finished build in 0.12 sec
Started prune
Finished prune in 0.00 sec
```
</code></pre>
","5860978","","","","","2016-11-20 07:00:53","Lektor: No Admin for flow fields","<lektor>","3","0","","","","35685899","116940","116940","lektor","40","34631336","34631335"
"32014766","1","36474102","","2015-08-14 16:33:53","","0","52","<p>I need to get the position pointed by the user's mouse cursor when he's hovering the control bar. How do I do it ?</p>
","1507546","","1507546","","2015-08-17 08:14:40","2016-04-07 10:55:46","Get position of the cursor when it's over the video control bar","<javascript><html5-video><projekktor>","1","4","","","","32014766","92386","92386","projekktor","18","17010138","17010137"
"34138001","1","","","2015-12-07 16:06:57","","0","88","<p>Friends,
I am using Projekktor web player for my project.So I want to load videos to this player from external XML playlist.my script is below.</p>

<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""false"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>$(document).ready(function () {
    projekktor('#player_a', {
        poster: '/media/intro.jpg',
        title: 'Projekktor - Playlist',
        volume: 0.1,
        playerFlashMP4: 'swf/StrobeMediaPlayback/StrobeMediaPlayback.swf',
        playerFlashMP3: 'swf/StrobeMediaPlayback/StrobeMediaPlayback.swf',
        width: 768,
        height: 432,
        platforms: ['browser', 'android', 'ios', 'native', 'flash', 'vlc'],
        // platforms: ['browser', 'ios', 'android', 'flash', 'native'],
        playlist: [
            {
                0: {src: ""media/Kashmir Main tu Kanyakumari.mp4"", type: ""video/mp4""}
            },
            {
                0: {src: ""media/Dedunnai Adare.mp4"", type: ""video/mp4""}
            },
            {
                0: {src: ""media/Heer Toh Badi Sad Hai.mp4"", type: ""video/mp4""}
            },
            {
                0: {src: ""media/Dheere Dheere Se Meri Zindagi REMIX.mp4"", type: ""video/mp4""}
            },
            {
                0: {src: ""media/Matargashti.mp4"", type: ""video/mp4""}
            }
            
            
        ]
    },</code></pre>
</div>
</div>

Edited -
 Actually I want to maintain external playlist for songs list and need to connect with player. So how can I do it.</p>
","5219758","","5219758","","2018-08-26 14:56:49","2018-08-26 14:56:49","XML play list for projekktor player","<xml><projekktor>","0","3","","","","34138001","92386","92386","projekktor","18","17010138","17010137"
"35140026","1","","","2016-02-01 20:48:31","","0","490","<p>I am using Kweb3 in kiosk mode with projekktor on raspberry pi to play html5 mp4 video files. The time I play 5-6 files, it keeps on increasing virtual memory &amp; hence the time it reaches 500mb, browser start showing loader &amp; nothing happens (basically goes out of memory/memory leak is happening). How can this memory issue be fixed? it is not removing the older video from memory. I also tried the iframe way of doing it. no luck. Please help.</p>
","4199793","","","","","2016-06-21 10:06:17","kweb3 projeckktor raspberry pi memory leak","<raspberry-pi><html5-video><virtual-memory><kiosk-mode><projekktor>","1","0","","","","35140026","92386","92386","projekktor","18","17010138","17010137"
"41865310","1","","","2017-01-26 03:07:20","","1","592","<p>I have this <code>html</code> file, downloaded from <a href=""http://www.projekktor.com/doc/"" rel=""nofollow noreferrer"">Projekktor</a>:</p>

<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Projekktor Version 8 Test&lt;/title&gt;
&lt;link rel=""stylesheet"" href=""theme/style.css"" type=""text/css"" media=""screen"" /&gt;

&lt;script type=""text/javascript"" src=""projekktor/jquery.min.js""&gt;&lt;/script&gt; &lt;!-- Load jquery --&gt;
&lt;script type=""text/javascript"" src=""projekktor/projekktor.min.js""&gt;&lt;/script&gt; &lt;!-- load projekktor --&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;video id=""player_a"" class=""projekktor"" poster=""intro.png"" title=""this is projekktor"" width=""640"" height=""360"" controls&gt;

         &lt;source src="""" /&gt;

&lt;/video&gt;

&lt;script type=""text/javascript""&gt;
$(document).ready(function() {
    projekktor('#player_a', {
    volume: 0.8,
    playerFlashMP4: 'http://www.localhost:8000/StrobeMediaPlayback.swf',
    playerFlashMP3: 'http://www.localhost:8000/StrobeMediaPlayback.swf'
    });
});
&lt;/script&gt; 


&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Then I am obtaining the url for an youtube video via an API call (I have credentials), in order to replace <code>src=''</code>with the result form the following code</p>

<pre><code>import lxml.html as LH

link = youtube_call(id)

def parse_html(link):

    filename = 'projekktor.html'
    f = LH.parse(filename)

    for el in f.iter('video'):
        el.attrib['src'] = link
        # have also tried
        # el.attrib['src'] = link.replace('amp;', '')

    new_html = LH.tostring(f, pretty_print=True)
    print (new_html)
</code></pre>

<p>but when I print it, a nasty <code>amp;</code> is added to <code>src=</code>, and access to link is denied. ( I broke the link here into newlines for readability purposes)</p>

<pre><code>https://r3---sn-oxunxg8pjvn-bpbs.googlevideo.com/videoplayback?expire=1485418386&amp;
amp;mv=m&amp;
amp;mt=1485396620&amp;
amp;ms=au&amp;
amp;clen=13475559&amp;
amp;mn=sn-oxunxg8pjvn-bpbs&amp;
amp;mm=31&amp;
amp;ipbits=0&amp;
amp;requiressl=yes&amp;
amp;itag=18&amp;amp;id=o-AG-dux-Jvtia_DsWZcyRfNpbMlzulsNn6I3SXyi0SI1B&amp;
amp;lmt=1458188966300704&amp;
amp;signature=BDC946187F74386CE00C5452CD703F9B13E4E30F.766549AB6A7C1811899CCC04742353B5BD0153D7&amp;amp;dur=266.448&amp;amp;key=yt6&amp;
amp;ip=177.142.138.140&amp;
amp;sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cupn%2Cexpire&amp;
amp;ei=MluJWO_aEIr_-AXHx6GwDA&amp;
amp;mime=video%2Fmp4&amp;
amp;upn=aFGwEwwIS1o&amp;amp;pl=20&amp;amp;source=youtube&amp;
amp;ratebypass=yes&amp;amp;initcwndbps=1178750&amp;
amp;gir=yes
</code></pre>

<p>Remove all <code>amp;</code> and the link is valid, but I've tried <code>link.replace('amp;', '')</code> does not work. </p>

<p>Is there any workaround this?</p>
","3451339","","","","","2017-01-26 03:35:20","Access to valid youtube link is denied after being parsed with Projekktor","<python><youtube-api><html-parsing><projekktor>","0","0","","","","41865310","92386","92386","projekktor","18","17010138","17010137"
"35753101","1","35917032","","2016-03-02 16:38:43","","1","734","<p>Using Lektor, I have created a model <code>book</code> as a child of <code>books</code> model(analogous to <code>blog-post</code> &amp; <code>blog</code> models).</p>

<p><code>/books/</code> page is generating correctly with pagination at bottom. When i goto 2nd page, it is throwing this weird error.</p>

<pre><code>Build Failure :'(

Building of the artifact “books/page/2/index.html” failed. This is what we know about the problem:

Traceback (most recent call last):
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/builder.py"", line 702, in update
    yield ctx
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/builder.py"", line 924, in build_artifact
    build_func(artifact)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/build_programs.py"", line 169, in build_artifact
    self.source['_template'], this=self.source)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/builder.py"", line 592, in render_template_into
    this=this, **extra)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/environment.py"", line 466, in render_template
    return self.jinja_env.get_or_select_template(name).render(ctx)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/environment.py"", line 851, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/environment.py"", line 812, in get_template
    return self._load_template(name, self.make_globals(globals))
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/lektor/environment.py"", line 194, in _load_template
    rv = jinja2.Environment._load_template(self, name, globals)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/environment.py"", line 786, in _load_template
    template = self.loader.load(self, name, globals)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/loaders.py"", line 125, in load
    code = environment.compile(source, name, filename)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/environment.py"", line 565, in compile
    self.handle_exception(exc_info, source_hint=source_hint)
  File ""/home/anand/.virtualenvs/exp/lib/python2.7/site-packages/jinja2/environment.py"", line 754, in handle_exception
    reraise(exc_type, exc_value, tb)
  File ""/home/anand/projects/python/projectchalam/templates/books.html"", line 13, in template
    {% endblock %}
TemplateSyntaxError: Encountered unknown tag 'endblock'.    
</code></pre>

<p>Here is books.html</p>

<pre><code>{% extends ""base.html"" %}

{% from ""macros/pagination.html"" import render_pagination %}

{% block title %}Books{% endblock %}


{% block content %}

    &lt;ul class=""blog-index""&gt;
        {% for post in this.pagination.items %}
            &lt;h2&gt;
                &lt;a href=""{{ post|url }}""&gt;
                    {{ post.title }}
                &lt;/a&gt;
            &lt;/h2&gt;
        {% endfor %}
    &lt;/ul&gt;

    &lt;div style=""padding-left: 45px;""&gt;
        {% if this.pagination.pages &gt; 1 %}
            {{ render_pagination(this.pagination) }}
        {% endif %}
    &lt;/div&gt;
{% endblock %}
</code></pre>

<p>I don't have <code>{% endblock %}</code> in line 13 of books.html as shown in traceback.</p>
","2698552","","","","","2016-03-10 12:51:32","Lektor Pagination - TemplateSyntaxError: Encountered unknown tag 'endblock'","<python><pagination><jinja2><static-site><lektor>","1","4","","","","35753101","116940","116940","lektor","40","34631336","34631335"
"36071410","1","36073402","","2016-03-17 20:49:50","","0","169","<p>I am using <a href=""http://getlektor.com"" rel=""nofollow"">Lektor CMS</a> for my blog. I want to implement a categories functionality as said in <a href=""https://www.getlektor.com/docs/guides/categories/"" rel=""nofollow"">docs</a>. I have a <code>blog-post</code> model with <code>categories</code> field:</p>

<pre><code>[fields.categories]
label = Категории
type = checkboxes
source = site.query('/categories')
</code></pre>

<p>As you notice, I'm using Russian language, so the category name maybe <code>Кодинг</code> and slug (directory name) may be <code>Coding</code>.</p>

<p>The problem is that when i access to the categories of blog-post I get plain list: <code>[u'Coding']</code> instead of list of objects which I can use to output the name in Russian and generate an url in English, something like <code>/blog/category/coding</code>. </p>

<p>I expect to be able to get such html:</p>

<pre><code>{% for category in post.categories %}
    &lt;a href=""{{ category|url }}""&gt;{{ category.name }}&lt;/a&gt;
{% endif %}
</code></pre>

<p>But it is not working. How can I fix this?</p>
","6079347","","1601291","","2016-03-17 21:20:37","2016-03-17 23:19:47","Lektor CMS how to get related objects of a model instead of plain list?","<python><lektor>","1","0","","","","36071410","116940","116940","lektor","40","34631336","34631335"
"46500030","1","47120544","","2017-09-30 05:59:41","","2","1987","<p>I'm new to <code>Kotlin</code> and <code>Ktor</code> trying to see the authentication part, so I got the below code.</p>

<p>Routes ""/"" and ""/bye"" are working fine, but route ""login"" given blank page!</p>

<pre><code>package blog

import kotlinx.html.*
import kotlinx.html.stream.*    // for createHTML
import org.jetbrains.ktor.application.*
import org.jetbrains.ktor.auth.*
import org.jetbrains.ktor.features.*
import org.jetbrains.ktor.http.*
import org.jetbrains.ktor.response.*
import org.jetbrains.ktor.routing.*

import org.jetbrains.ktor.request.*   // for request.uri

import org.jetbrains.ktor.html.*
import org.jetbrains.ktor.pipeline.*

import org.jetbrains.ktor.host.*   // for embededServer
import org.jetbrains.ktor.netty.*  // for Netty

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""BlogAppKt""), module = Application::module).start()
}

fun Application.module() {
    install(DefaultHeaders)
    install(CallLogging)

    intercept(ApplicationCallPipeline.Call) { 
        if (call.request.uri == ""/hi"")
            call.respondText(""Test String"")
    }

    install(Routing) {
        get(""/"") {
            call.respondText(""""""Hello, world!&lt;br&gt;&lt;a href=""/bye""&gt;Say bye?&lt;/a&gt;"""""", ContentType.Text.Html)
        }
        get(""/bye"") {
            call.respondText(""""""Good bye! &lt;br&gt;&lt;a href=""/login""&gt;Login?&lt;/a&gt; """""", ContentType.Text.Html)
        }
        route(""/login"") {
            authentication {
                formAuthentication { up: UserPasswordCredential -&gt;
                    when {
                        up.password == ""ppp"" -&gt; UserIdPrincipal(up.name)
                        else -&gt; null
                    }
                }
            }

            handle {
                val principal = call.authentication.principal&lt;UserIdPrincipal&gt;()
                if (principal != null) {
                    call.respondText(""Hello, ${principal.name}"")
                } else {
                        val html = createHTML().html {
                        body {
                            form(action = ""/login"", encType = FormEncType.applicationXWwwFormUrlEncoded, method = FormMethod.post) {
                                p {
                                    +""user:""
                                    textInput(name = ""user"") {
                                        value = principal?.name ?: """"
                                    }
                                }

                                p {
                                    +""password:""
                                    passwordInput(name = ""pass"")
                                }

                                p {
                                    submitInput() { value = ""Login"" }
                                }
                            }
                        }
                    }
                    call.respondText(html, ContentType.Text.Html)
                }
            }
        }
    }
}
</code></pre>

<p>When I disabled the authentication part below, the route '/login' displayed the required form, which means the error is most likely in this part or in the way of calling it? I guess.</p>

<pre><code>            authentication {
                formAuthentication { up: UserPasswordCredential -&gt;
                    when {
                        up.password == ""ppp"" -&gt; UserIdPrincipal(up.name)
                        else -&gt; null
                    }
                }
            }
</code></pre>
","2441637","","","","","2017-11-06 19:21:59","Form Authentication in Ktor","<kotlin><ktor>","1","0","","","","46500030","128262","128262","ktor","265","45915935","45915934"
"46783858","1","48151101","","2017-10-17 06:33:33","","2","1052","<p>I'm having a bit of trouble understanding the proper way to use Ktor's DSL for <a href=""https://github.com/Kotlin/ktor-wiki/blob/master/Feature-Routing.md"" rel=""nofollow noreferrer"">request routing</a>.
The problem is that when I test my API and try to <code>GET /nomenclature/articles/categories</code> which should return a list of all article categories, I get instead <code>Invalid article specified</code> which a message I return for the <code>/nomenclature/articles/{articleId}</code> route when the <code>articleId</code> parameter is invalid.</p>

<p>Here's my code: 
</p>

<pre><code>route(""/nomenclature"") {
    method(HttpMethod.Get) {
        handle { call.respondText(""The resource you accessed is not a valid REST resource, but a parent node. Children nodes include articles, categories, subcategories and so on."") }
    }
    route(""articles"") {
        route(""categories"") {
            get(""{categoryId?}"") {
                val categoryIdParam = call.parameters[""categoryId""]
                if (categoryIdParam != null) {
                    val categoryId = categoryIdParam.toIntOrNull()
                    if (categoryId != null) {
                        val category = articlesDAO.findCategoryById(categoryId)
                        if (category != null) call.respond(category)
                        else call.respondText(""Category not found"", status = HttpStatusCode.NotFound)
                    } else call.respondText(""Invalid category ID specified"", status = HttpStatusCode.BadRequest)
                } else {
                    val categories = articlesDAO.getCategories()
                    if (categories != null) call.respond(categories)
                    else call.respondText(""No categories found"", status = HttpStatusCode.NotFound)
                }
            }
        }
        route(""subcategories"") {
            get(""{subcategoryId?}"") {
                val subcategoryIdParam = call.parameters[""subcategoryId""]
                if (subcategoryIdParam != null) {
                    val subcategoryId = subcategoryIdParam.toIntOrNull()
                    if (subcategoryId != null) {
                        val subcategory = articlesDAO.findSubcategoryById(subcategoryId)
                        if (subcategory != null) call.respond(subcategory)
                        else call.respondText(""Subcategory not found"", status = HttpStatusCode.NotFound)
                    } else call.respondText(""Invalid subcategory ID specified"", status = HttpStatusCode.BadRequest)
                } else {
                    val subcategories = articlesDAO.getCategories()
                    if (subcategories != null) call.respond(subcategories)
                    else call.respondText(""No subcategories found"", status = HttpStatusCode.NotFound)
                }
            }
        }
        get(""types"") {
            val articleTypes = articlesDAO.getArticleTypes()
            if (articleTypes != null) call.respond(articleTypes)
            else call.respondText(""No article types found"", status = HttpStatusCode.NotFound)
        }
        get(""wholePackagings"") {
            val wholePackagings = articlesDAO.getWholePackagings()
            if (wholePackagings != null) call.respond(wholePackagings)
            else call.respondText(""No whole packagings found"", status = HttpStatusCode.NotFound)
        }
        get(""fractionsPackagings"") {
            val fractionsPackagings = articlesDAO.getFractionPackagings()
            if (fractionsPackagings != null) call.respond(fractionsPackagings)
            else call.respondText(""No fractions packagings found"", status = HttpStatusCode.NotFound)
        }
        get(""{articleId?}"") {
            val articleIdParam = call.parameters[""articleId""]
            if (articleIdParam != null) {
                val articleId = articleIdParam.toIntOrNull()
                if (articleId != null) {
                    val article = articlesDAO.findArticleById(articleId)
                    if (article != null) call.respond(article) else call.respondText(""No article found"", status = HttpStatusCode.NotFound)
                } else call.respondText(""Invalid article ID specified"", status = HttpStatusCode.BadRequest)
            } else {
                val articles = articlesDAO.getArticles()
                if (articles != null) call.respond(articles) else call.respondText(""No articles found"", status = HttpStatusCode.NotFound)
            }
        }
    }
}
</code></pre>

<p>It would be really great if someone could help me by providing a basic but somewhat comprehensive example of how to use all Ktor route matchers and handlers, including in a nested resource manner.</p>

<p><strong>EDIT:</strong> I've rewritten the routing using a different approach but I would still like to know why my previous version didn't work as expected.
Here's my second approach that seems to work as expected (I've tested it):</p>

<pre><code>routing {
    route(""/v1"") {
        route(""stock"") {
            get {
                val stock = stockDAO.getAllStock()
                if (stock != null) call.respond(stock) else call.respondText(""No stock found"", status = HttpStatusCode.NotFound)
            }
            get(""{locationId}"") {
                val locationIdParam = call.parameters[""locationId""]
                if (locationIdParam != null) {
                    val locationId = locationIdParam.toIntOrNull()
                    if (locationId != null) {
                        val stock = stockDAO.getStockByLocationId(locationId)
                        if (stock != null) call.respond(stock) else call.respondText(""No stock found"", status = HttpStatusCode.NotFound)
                    } else call.respondText(""ERROR: Invalid location ID specified."", status = HttpStatusCode.BadRequest)
                }
            }
        }

        route(""nomenclature"") {
            get {
                call.respondText(""The resource you accessed is not a valid REST resource, but a parent node. Children nodes include articles, categories, subcategories and so on."")
            }

            route(""articles"") {
                get {
                    val articles = articlesDAO.getArticles()
                    if (articles != null) call.respond(articles) else call.respondText(""No articles found"", status = HttpStatusCode.NotFound)
                }
                get(""{articleId}"") {
                    val articleIdParam = call.parameters[""articleId""]
                    if (articleIdParam != null) {
                        val articleId = articleIdParam.toIntOrNull()
                        if (articleId != null) {
                            val article = articlesDAO.findArticleById(articleId)
                            if (article != null) call.respond(article) else call.respondText(""No article found"", status = HttpStatusCode.NotFound)
                        } else call.respondText(""Invalid article ID specified"", status = HttpStatusCode.BadRequest)
                    }
                }

                route(""categories"") {
                    get {
                        val categories = articlesDAO.getCategories()
                        if (categories != null) call.respond(categories)
                        else call.respondText(""No categories found"", status = HttpStatusCode.NotFound)
                    }
                    get(""{categoryId}"") {
                        val categoryIdParam = call.parameters[""categoryId""]
                        if (categoryIdParam != null) {
                            val categoryId = categoryIdParam.toIntOrNull()
                            if (categoryId != null) {
                                val category = articlesDAO.findCategoryById(categoryId)
                                if (category != null) call.respond(category)
                                else call.respondText(""Category not found"", status = HttpStatusCode.NotFound)
                            } else call.respondText(""Invalid category ID specified"", status = HttpStatusCode.BadRequest)
                        }
                    }
                }

                route(""subcategories"") {
                    get {
                        val subcategories = articlesDAO.getSubcategories()
                        if (subcategories != null) call.respond(subcategories)
                        else call.respondText(""No subcategories found"", status = HttpStatusCode.NotFound)
                    }
                    get(""{subcategoryId}"") {
                        val subcategoryIdParam = call.parameters[""subcategoryId""]
                        if (subcategoryIdParam != null) {
                            val subcategoryId = subcategoryIdParam.toIntOrNull()
                            if (subcategoryId != null) {
                                val subcategory = articlesDAO.findSubcategoryById(subcategoryId)
                                if (subcategory != null) call.respond(subcategory)
                                else call.respondText(""Subcategory not found"", status = HttpStatusCode.NotFound)
                            } else call.respondText(""Invalid subcategory ID specified"", status = HttpStatusCode.BadRequest)
                        }
                    }
                }

                get(""types"") {
                    val articleTypes = articlesDAO.getArticleTypes()
                    if (articleTypes != null) call.respond(articleTypes)
                    else call.respondText(""No article types found"", status = HttpStatusCode.NotFound)
                }
                get(""wholePackagings"") {
                    val wholePackagings = articlesDAO.getWholePackagings()
                    if (wholePackagings != null) call.respond(wholePackagings)
                    else call.respondText(""No whole packagings found"", status = HttpStatusCode.NotFound)
                }
                get(""fractionsPackagings"") {
                    val fractionsPackagings = articlesDAO.getFractionPackagings()
                    if (fractionsPackagings != null) call.respond(fractionsPackagings)
                    else call.respondText(""No fractions packagings found"", status = HttpStatusCode.NotFound)
                }
            }
        }
    }
}
</code></pre>
","267874","","267874","","2017-10-17 22:09:07","2018-01-08 13:15:59","What's the correct way to nest Ktor route matchers and handlers for a typical REST implementation?","<kotlin><url-routing><ktor>","1","0","1","","","46783858","128262","128262","ktor","265","45915935","45915934"
"47021672","1","47048411","","2017-10-30 18:11:39","","1","56","<p>As mentioned <a href=""http://ktor.io/features/status-pages.html"" rel=""nofollow noreferrer"">here</a>, I tried to use <code>Status Files</code> with the below code:</p>

<pre><code>install(StatusPages) {
    statusFile(HttpStatusCode.NotFound, HttpStatusCode.Unauthorized, filePattern = ""#.html"")
}
</code></pre>

<p>and saved the file as below:</p>

<p><a href=""https://i.stack.imgur.com/iCGmK.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/iCGmK.png"" alt=""enter image description here""></a></p>

<p>But after running it, I got the standard 404 error, which means the file are not seen, do I need to add some thing, or I'm saving them in wrong place?</p>
","2441637","","","","","2017-11-01 04:47:07","Where the statusFiles should be saved?","<kotlin><ktor>","1","0","","","","47021672","128262","128262","ktor","265","45915935","45915934"
"59238966","1","","","2019-12-08 19:11:32","","0","7","<p>on my website the links are all protected by a middleware and when a user does not have a account or is not connected it is redirected to the login page after a click.
what I want to do is to be able to redirect the user on the view of where he had click after he is authenticated.
thank you for helping me i'm a beginner with laravel</p>
","12501329","","","","","2019-12-08 19:11:32","redirection after authentication on the link that the user clicked","<projekktor>","0","1","","","","59238966","92386","92386","projekktor","18","17010138","17010137"
"59663420","1","","","2020-01-09 11:54:08","","0","81","<p>I have a problem, I have already generated OpenApi Swagger files (swagger.json and swagger.yaml) Is it possible somehow in Ktor (kotlin) import this files and start swagger-ui server on specific route ?
I have visited <a href=""https://github.com/nielsfalk/ktor-swagger"" rel=""nofollow noreferrer"">ktor-swagger project</a> but could get how just to add json file to display swagger-ui.
Any suggestions ?   </p>
","5687795","","","","","2020-01-09 11:54:08","Swagger-UI and Ktor how to import swagger.json or .yaml file and start Swagger-UI?","<kotlin><swagger><swagger-ui><ktor><projekktor>","0","0","","","","59663420","92386","92386","projekktor","18","17010138","17010137"
"36453899","1","","","2016-04-06 14:18:28","","0","109","<p>While trying to deploy to a github page i get the error below:</p>

<p><strong>Project file</strong></p>

<pre><code>[project]
name = andresperezcera

[servers.production]
target = ghpages://andresperezcera/andresperezcera.github.io?cname=andresperezcera.xyz
</code></pre>

<p><strong>Error</strong></p>

<pre><code>λ lektor deploy
Deploying to production
  Build cache: C:\Users\aperez\AppData\Roaming\Lektor\Cache\builds\75d505d25f90dec1e1ee1c5a3f9da1a3
  Target: ghpages://andresperezcera/andresperezcera.github.io?cname=andresperezcera.xyz
Traceback (most recent call last):
  File ""C:\Python27\Lib\runpy.py"", line 162, in _run_module_as_main
    ""__main__"", fname, loader, pkg_name)
  File ""C:\Python27\Lib\runpy.py"", line 72, in _run_code
    exec code in run_globals
  File ""C:\Users\aperez\AppData\Local\lektor-cli\lib\Scripts\lektor.exe\__main__.py"", line 9, in &lt;module&gt;
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 716, in __call__
    return self.main(*args, **kwargs)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 696, in main
    rv = self.invoke(ctx)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 534, in invoke
    return callback(*args, **kwargs)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\decorators.py"", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\click\core.py"", line 534, in invoke
    return callback(*args, **kwargs)
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\lektor\cli.py"", line 282, in deploy_cmd
    for line in event_iter:
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\lektor\publisher.py"", line 583, in publish
    for line in git(['init']):
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\lektor\publisher.py"", line 152, in safe_iter
    for line in self:
  File ""c:\users\aperez\appdata\local\lektor-cli\lib\lib\site-packages\lektor\publisher.py"", line 141, in __iter__
    for l in select.select(streams, [], streams):
select.error: (10038, 'Se intent\xf3 realizar una operaci\xf3n en un elemento que no es un socket')
</code></pre>

<p>There must be something missing in my project file. Perhaps the connection string doesn't work in windows or perhaps something else.</p>
","1879609","","","","","2016-04-16 14:42:56","Error while deploying a lektor project to hithub on windows dual python install","<python><publish><github-pages><lektor>","1","0","","","","36453899","116940","116940","lektor","40","34631336","34631335"
"37473790","1","37558059","","2016-05-27 02:18:38","","5","360","<p>I'm trying to use Lektor as my blog platform, but I am running into a few issues.</p>

<p>Following the <a href=""https://www.getlektor.com/docs/guides/blog/"" rel=""nofollow noreferrer"">guide</a> I can make everything work. My problem begin when I try to make the blog the first page, without the ""/blog"".</p>

<p>If I query in the page template the blogs children, the pagination don't work.</p>

<p>If I make the blog-post children of the page using ""replaced_with = site.query('/blog')"" the initial page renders fine, but if I try to access any page, appears a Not Found message.</p>

<p>My goal is show my posts in the first page and have other folders, like ""/about"" or ""/projects"" in the root folder.</p>
","6388767","","1033581","","2017-08-20 15:55:31","2017-08-20 15:55:31","How to show my posts in the first page and not in the ""/blog"" and maintaining other sub folders working like ""/about"" and ""/projects""","<lektor>","3","0","","","","37473790","116940","116940","lektor","40","34631336","34631335"
"37555961","1","","","2016-05-31 21:30:47","","2","111","<p>I am randomly (my perception) getting the following error : ""sqlite3.OperationalError OperationalError: database is locked"" when I update a record in Lektor through the Admin interface. I have tried with several projects (quickstart, lektor-website), and I am still getting this ""random"" error. My config : Mac OS 10.11, latest version of Lektor (2.3), Python 2.7. Here is the traceback :</p>

<pre><code>File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 2000, in __call__
return self.wsgi_app(environ, start_response)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1991, in wsgi_app
response = self.make_response(self.handle_exception(e))
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1567, in handle_exception
reraise(exc_type, exc_value, tb)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1988, in wsgi_app
response = self.full_dispatch_request()
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1641, in full_dispatch_request
rv = self.handle_user_exception(e)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1544, in handle_user_exception
reraise(exc_type, exc_value, tb)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1639, in full_dispatch_request
rv = self.dispatch_request()
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/flask/app.py"", line 1625, in dispatch_request
return self.view_functions[rule.endpoint](**req.view_args)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/admin/modules/serve.py"", line 150, in serve_artifact
return serve_up_artifact(path)
File ""/usr/local/lib/lektor/lib/python2.7/site- packages/lektor/admin/modules/serve.py"", line 129, in serve_up_artifact
artifact_name, filename = li.resolve_artifact('/' + path, pad)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/admin/webui.py"", line 60, in resolve_artifact
prog, _ = builder.build(source)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/builder.py"", line 1080, in build
self.update_source_info(prog, build_state)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/builder.py"", line 1047, in update_source_info
build_state.write_source_info(info)
File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/builder.py"", line 240, in write_source_info
Open an interactive python shell in this frame''', [info.path, info.alt, lang, info.type, source, title]) 
</code></pre>

<p>Any advice on how this can be prevented ?</p>

<p>Thanks in advance !</p>
","6399441","","","","","2016-05-31 21:30:47","Lektor : Error When Saving a Record in Admin : sqlite3.OperationalError OperationalError: database is locked","<sqlite><lektor>","0","0","","","","37555961","116940","116940","lektor","40","34631336","34631335"
"47290924","1","","","2017-11-14 16:40:28","","3","495","<p>I'm having problems deleting a cookie set by a Ktor 0.9.0 server side application. Maybe I don't know how to do it the right way, or there's an omission in the Ktor framework.</p>

<p>Cookie creation and deletion is not the problem per se, but in order to delete a cookie I've to use the same path that is stored with the cookie on the client browser. Ktor let me control the path with cookie creation. Here's my configuration:</p>

<pre><code>install(Sessions) {
    cookie&lt;MySession&gt;(sessionMarker) {
        cookie.duration = cookieDuration
        cookie.path = ""/myWebapp""
        transform(SessionTransportTransformerMessageAuthentication(sessionKey))
    }
}
</code></pre>

<p>On the login page <code>/myWebapp/page/login</code>, I create the cookie that is then sent to the client and it travels back and forth for the rest of the requests sent to the web application:</p>

<pre><code>call.sessions.set(MySession([some data class arguments]))
</code></pre>

<p>The cookie shows the path <code>/myWebapp</code> when inspected on the client. The default would be <code>/myWebapp/page</code> because that's the path of the login page, but the path is taken from the cookie configuration shown above. All is well until now.</p>

<p>Eventually the user wants to log out via a POST request to the login page:</p>

<pre><code>call.sessions.clear&lt;MySession&gt;()
</code></pre>

<p>The problem here is that I've not found a way of controlling the cookie's path. Because the login page <code>/myWebapp/page/login</code> is sending the expired cookie back to the client for another path (its own <code>/myWebapp/page</code>), the original cookie is not deleted (<code>/myWebapp/page</code> != <code>/myWebapp</code>).</p>

<p>How can I control the cookie's path in Ktor 0.9.0 when trying to delete it?</p>

<p>I know how to work around it: by creating the cookie with the same path from where I'll delete it. But that's not what I want (there're other paths within the web applications like <code>/myWebapp/others</code> were the cookie should be used). Having the ability to control the cookie's path during creation makes no sense then.</p>
","188291","","","","","2017-12-18 10:53:31","Controlling cookie lifecycle in Ktor 0.9.0 servlet","<web-applications><kotlin><ktor>","1","0","1","","","47290924","128262","128262","ktor","265","45915935","45915934"
"47589646","1","47673530","","2017-12-01 08:49:23","","0","182","<p>I am trying to move Ktor backend to Heroku postgres db. Here whole application code:</p>

<p><a href=""https://github.com/MarcinMoskala/KotlinAcademyApp/tree/master/backend"" rel=""nofollow noreferrer"">https://github.com/MarcinMoskala/KotlinAcademyApp/tree/master/backend</a></p>

<p>To move to Heroku postgres, I based on this example project:</p>

<p><a href=""https://github.com/orangy/ktor-heroku-start"" rel=""nofollow noreferrer"">https://github.com/orangy/ktor-heroku-start</a></p>

<p>I changed my database configuration to following:</p>

<pre><code>private val config = application.environment.config.config(""database"")

private val poolSize = config.property(""poolSize"").getString().toInt()

private val hikariConfig = HikariConfig().apply {
    val url = System.getenv(""JDBC_DATABASE_URL"") ?: config.property(""connection"").getString()
    application.log.info(""DB url is $url"")
    jdbcUrl = url
    maximumPoolSize = poolSize
    validate()
}

private val dataSource = HikariDataSource(hikariConfig)

private val connection: DatabaseConnection = H2Connection { dataSource.connection }

private val dispatcher = newFixedThreadPoolContext(poolSize, ""database-pool"")

init {
    connection.transaction {
        databaseSchema().create(listOf(NewsTable, FeedbackTable, TokensTable))
    }
}
</code></pre>

<p>And I added postgressql dependency:</p>

<pre><code>compile ""org.postgresql:postgresql:9.4-1201-jdbc4""
</code></pre>

<p>Locally it is still creating SQLite database, but when I push it to Heroku then I have following result: </p>

<pre><code>DEBUG com.zaxxer.hikari.HikariConfig - jdbc4ConnectionTest.............false
DEBUG com.zaxxer.hikari.HikariConfig - jdbcUrl.........................jdbc:postgresql://ec7-77-77-777-77.compute-1.amazonaws.com:7777/7777777?user=aaaaaaaaaaaa&amp;password=&lt;masked&gt;&amp;sslmode=require
DEBUG com.zaxxer.hikari.HikariConfig - leakDetectionThreshold..........0
DEBUG com.zaxxer.hikari.HikariConfig - maximumPoolSize.................20
DEBUG com.zaxxer.hikari.HikariConfig - maxLifetime.....................1800000
DEBUG com.zaxxer.hikari.HikariConfig - metricRegistry..................none
DEBUG com.zaxxer.hikari.HikariConfig - metricsTrackerFactory...........none
DEBUG com.zaxxer.hikari.HikariConfig - minimumIdle.....................20
DEBUG com.zaxxer.hikari.HikariConfig - password........................&lt;masked&gt;
 [main] DEBUG com.zaxxer.hikari.HikariConfig - poolName........................""HikariPool-1""
DEBUG com.zaxxer.hikari.HikariConfig - registerMbeans..................false
DEBUG com.zaxxer.hikari.HikariConfig - readOnly........................false
DEBUG com.zaxxer.hikari.HikariConfig - scheduledExecutor...............none
DEBUG com.zaxxer.hikari.HikariConfig - scheduledExecutorService........internal
DEBUG com.zaxxer.hikari.HikariConfig - schema..........................none
DEBUG com.zaxxer.hikari.HikariConfig - threadFactory...................internal
DEBUG com.zaxxer.hikari.HikariConfig - transactionIsolation............default
DEBUG com.zaxxer.hikari.HikariConfig - username........................none
DEBUG com.zaxxer.hikari.HikariConfig - validationTimeout...............5000
DEBUG com.zaxxer.hikari.HikariConfig - allowPoolSuspension.............false
DEBUG com.zaxxer.hikari.HikariConfig - autoCommit......................true
DEBUG com.zaxxer.hikari.HikariConfig - HikariPool-1 - configuration:
DEBUG com.zaxxer.hikari.HikariConfig - connectionInitSql...............none
DEBUG com.zaxxer.hikari.HikariConfig - catalog.........................none
DEBUG com.zaxxer.hikari.HikariConfig - connectionTestQuery.............none
DEBUG com.zaxxer.hikari.HikariConfig - connectionTimeout...............30000
DEBUG com.zaxxer.hikari.HikariConfig - dataSource......................none
DEBUG com.zaxxer.hikari.HikariConfig - dataSourceClassName.............none
DEBUG com.zaxxer.hikari.HikariConfig - dataSourceJNDI..................none
DEBUG com.zaxxer.hikari.HikariConfig - dataSourceProperties............{password=&lt;masked&gt;}
DEBUG com.zaxxer.hikari.HikariConfig - driverClassName.................none
DEBUG com.zaxxer.hikari.HikariConfig - healthCheckProperties...........{}
DEBUG com.zaxxer.hikari.HikariConfig - healthCheckRegistry.............none
DEBUG com.zaxxer.hikari.HikariConfig - idleTimeout.....................600000
DEBUG com.zaxxer.hikari.HikariConfig - initializationFailFast..........true
DEBUG com.zaxxer.hikari.HikariConfig - initializationFailTimeout.......1
DEBUG com.zaxxer.hikari.HikariConfig - isolateInternalQueries..........false
DEBUG com.zaxxer.hikari.HikariConfig - jdbc4ConnectionTest.............false
DEBUG com.zaxxer.hikari.HikariConfig - jdbcUrl.........................jdbc:postgresql://ec2-23-21-155-53.compute-1.amazonaws.com:5432/d1bj65rb5gi9qt?user=ufwvhxlvfjopkm&amp;password=&lt;masked&gt;&amp;sslmode=require
DEBUG com.zaxxer.hikari.HikariConfig - maxLifetime.....................1800000
DEBUG com.zaxxer.hikari.HikariConfig - leakDetectionThreshold..........0
DEBUG com.zaxxer.hikari.HikariConfig - maximumPoolSize.................20
DEBUG com.zaxxer.hikari.HikariConfig - metricRegistry..................none
DEBUG com.zaxxer.hikari.HikariConfig - metricsTrackerFactory...........none
DEBUG com.zaxxer.hikari.HikariConfig - minimumIdle.....................20
DEBUG com.zaxxer.hikari.HikariConfig - password........................&lt;masked&gt;
DEBUG com.zaxxer.hikari.HikariConfig - poolName........................""HikariPool-1""
DEBUG com.zaxxer.hikari.HikariConfig - readOnly........................false
DEBUG com.zaxxer.hikari.HikariConfig - registerMbeans..................false
DEBUG com.zaxxer.hikari.HikariConfig - scheduledExecutorService........internal
DEBUG com.zaxxer.hikari.HikariConfig - scheduledExecutor...............none
DEBUG com.zaxxer.hikari.HikariConfig - schema..........................none
DEBUG com.zaxxer.hikari.HikariConfig - threadFactory...................internal
DEBUG com.zaxxer.hikari.HikariConfig - transactionIsolation............default
DEBUG com.zaxxer.hikari.HikariConfig - username........................none
DEBUG com.zaxxer.hikari.HikariConfig - validationTimeout...............5000
INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
Process exited with status 1
2017-12-01 08:38:27.783 [main] INFO  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Driver does not support get/set network timeout for connections. (Method org.postgresql.jdbc4.Jdbc4Connection.getNetworkTimeout() is not yet implemented.)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
2017-12-01 08:38:27.832 [main] DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc4.Jdbc4Connection@49c66ade
2017-12-01 08:38:27.834 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
Exception in thread ""main"" java.lang.reflect.InvocationTargetException
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at kotlin.reflect.jvm.internal.KCallableImpl.call(KCallableImpl.kt:107)
    at kotlin.reflect.jvm.internal.FunctionCaller$Method.callMethod(FunctionCaller.kt:98)
    at kotlin.reflect.jvm.internal.FunctionCaller$StaticMethod.call(FunctionCaller.kt:108)
    at kotlin.reflect.jvm.internal.KCallableImpl.callDefaultMethod(KCallableImpl.kt:149)
    at kotlin.reflect.jvm.internal.KCallableImpl.callBy(KCallableImpl.kt:111)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.executeModuleFunction(ApplicationEngineEnvironmentReloading.kt:270)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.instantiateAndConfigureApplication(ApplicationEngineEnvironmentReloading.kt:247)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.callFunctionWithInjection(ApplicationEngineEnvironmentReloading.kt:314)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.createApplication(ApplicationEngineEnvironmentReloading.kt:118)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.start(ApplicationEngineEnvironmentReloading.kt:227)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:43)
    at com.marcinmoskala.kotlinacademy.backend.ServerKt.main(Server.kt:8)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:15)
    at io.ktor.server.engine.ApplicationEngine$DefaultImpls.start$default(ApplicationEngine.kt:29)
Caused by: org.postgresql.util.PSQLException: ERROR: relation ""information_schema.session_state"" does not exist
  Position: 15
    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:420)
    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2270)
    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:305)
    at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:52)
    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1998)
    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255)
    at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:570)
    at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java)
    at org.jetbrains.squash.schema.DatabaseSchemaBase.createStatements(DatabaseSchemaBase.kt:23)
    at org.jetbrains.squash.dialects.h2.H2DatabaseSchema.currentSchema(H2DatabaseSchema.kt:8)
    at org.jetbrains.squash.drivers.JDBCDatabaseSchema.tables(JDBCDatabaseSchema.kt:12)
    at com.marcinmoskala.kotlinacademy.backend.db.Database$1.invoke(Database.kt:25)
    at com.marcinmoskala.kotlinacademy.backend.db.Database.&lt;init&gt;(Database.kt:46)
    at org.jetbrains.squash.schema.DatabaseSchemaBase.create(DatabaseSchemaBase.kt:10)
    at com.marcinmoskala.kotlinacademy.backend.MainKt.main(Main.kt:39)
    at com.marcinmoskala.kotlinacademy.backend.db.Database$1.invoke(Database.kt:47)
    at org.jetbrains.squash.connection.DatabaseConnectionKt.transaction(DatabaseConnection.kt:25)
    ... 18 more
State changed from starting to crashed
</code></pre>
","3739366","","","","","2017-12-06 11:46:34","Heroku postgres relation ""information_schema.session_state"" does not exist","<postgresql><heroku><kotlin><heroku-postgres><ktor>","1","1","","","","47589646","128262","128262","ktor","265","45915935","45915934"
"48040613","1","","","2017-12-31 06:54:59","","3","1776","<p>Ktor (kotlin web framework) has an awesome testable mode where http requests can be wrapped in unit tests. They give a nice example of how to test a GET endpoint <a href=""https://github.com/ktorio/ktor/blob/master/ktor-samples/ktor-samples-testable/test/io/ktor/samples/testable/tests/ApplicationTest.kt"" rel=""nofollow noreferrer"">here</a>,
however I'm having trouble with an http POST. </p>

<p>I tried this but the post params don't seem to be added to the request:</p>

<pre><code>    @Test
fun testSomePostThing() = withTestApplication(Application::myModule) {
    with(handleRequest(HttpMethod.Post, ""/api/v2/processing"") {
        addHeader(""content-type"", ""application/x-www-form-urlencoded"")
        addHeader(""Accept"", ""application/json"")
        body = ""param1=cool7&amp;param2=awesome4""
    }) {
        assertEquals(HttpStatusCode.OK, response.status())
        val resp = mapper.readValue&lt;TriggerResponse&gt;(response.content ?: """")
        assertEquals(TriggerResponse(""cool7"", ""awesome4"", true), resp)
    }
}
</code></pre>

<p>Anyone have any ideas?</p>
","4819099","","","","","2019-07-01 10:16:39","Testing Post requests in Ktor","<http><kotlin><ktor>","3","0","","","","48040613","128262","128262","ktor","265","45915935","45915934"
"48280230","1","48283518","","2018-01-16 11:29:43","","1","58","<p>To allow video to be played in element from my website, but not allowing it through direct link, I created .htaccess in a sub-directory with the source videos, and nothing else. with the below code:</p>

<pre><code>RewriteEngine On
RewriteCond %{REQUEST_URI} \.(mp4|mp3|avi)$ [NC]
RewriteCond %{HTTP_REFERER} !^http://sample.com/.*$ [NC]
RewriteRule ^.* - [F,L]
</code></pre>

<p>I need to do the same with <a href=""http://ktor.io/"" rel=""nofollow noreferrer"">ktor</a> server, but do not know how?</p>

<p>Any help. thanks.</p>
","2441637","","","","","2018-01-16 14:28:32",".htaccess equivalent in KTOR","<ktor>","1","0","","","","48280230","128262","128262","ktor","265","45915935","45915934"
"38193922","1","38216821","","2016-07-05 01:12:53","","4","380","<p>I've got a Lektor site that I'm trying to deploy automatically in response to pull requests and commits, using the <a href=""https://www.getlektor.com/docs/deployment/travisci/"" rel=""nofollow"">Travis CI trigger approach from the Lektor docs</a>. </p>

<p>The Lektor configuration works fine from the command line. </p>

<p>The Travis build starts, and appears to build the site without problem - but when it gets to deployment, the log says the following:</p>

<pre><code>Installing deploy dependencies
!!! Script support is experimental !!!

Preparing deploy
Cleaning up git repository with `git stash --all`. If you need build artifacts for deployment, set `deploy.skip_cleanup: true`. See https://docs.travis-ci.com/user/deployment/#Uploading-Files.
No local changes to save

Deploying application
Deploying to ghpages-https
  Build cache: /home/travis/.cache/lektor/builds/d3a411e13041731555222b901cff4248
  Target: ghpages+https://pybee/pybee.github.io?cname=pybee.org
  Initialized empty Git repository in /home/travis/build/pybee/pybee.github.io/temp/.deploytemp9xhRDc/scratch/.git/
  Fetching origin
  fatal: repository 'https://github.com/pybee/pybee.github.io/' not found
  error: Could not fetch origin
  fatal: repository 'https://github.com/pybee/pybee.github.io/' not found
Done!
</code></pre>

<p>For a full log, <a href=""https://travis-ci.org/pybee/pybee.github.io/builds/142337896"" rel=""nofollow"">see here</a>.</p>

<p>I've checked the credentials in the Travis CI configuration for the repository; I'm as certain as I can be that they're correct. I've tried using the same configuration (exporting <code>LEKTOR_DEPLOY_USERNAME</code> and <code>LEKTOR_DEPLOY_PASSWORD</code> locally), and it works fine.</p>

<pre><code>hammer:pybee.org rkm$ lektor deploy ghpages-https
Deploying to ghpages-https
  Build cache: /Users/rkm/Library/Caches/Lektor/builds/a269cf944d4302f15f78a1dfb1602486
  Target: ghpages+https://pybee/pybee.github.io?cname=pybee.org
  Initialized empty Git repository in /Users/rkm/projects/beeware/pybee.org/temp/.deploytempOh4p98/scratch/.git/
  Fetching origin
  From https://github.com/pybee/pybee.github.io
   * [new branch]      master     -&gt; origin/master
  On branch master
  Your branch is up-to-date with 'origin/master'.
  nothing to commit, working directory clean
  Everything up-to-date
Done!
</code></pre>

<p>Any suggestions on the cause of this error?</p>
","218383","","","","","2016-07-06 05:23:46","Error when deploying Lektor site to Github Pages using Travis CI","<travis-ci><github-pages><lektor>","1","2","","","","38193922","116940","116940","lektor","40","34631336","34631335"
"38305321","1","","","2016-07-11 11:04:17","","3","130","<p>We are creating a multilingual site with Lektor using Alternatives. Besides the localized content, we have few images containing some text which needs to be localized as well. Which would be the smartest way to create links to images depending on the locale?</p>
","615095","","","","","2016-07-11 11:04:17","Best practice to manage localized images with Lektor","<lektor>","0","0","","","","38305321","116940","116940","lektor","40","34631336","34631335"
"39591537","1","","","2016-09-20 10:18:25","","1","344","<p>I am using the CMS Lektor. I need to include a contact form. </p>

<p>What is the best method to include it?</p>
","4029338","","1591669","","2017-10-17 23:39:01","2017-10-17 23:39:01","Best way to include a contact form in Lektor?","<contact-form><static-site><lektor>","1","0","","","","39591537","116940","116940","lektor","40","34631336","34631335"
"39640741","1","40701392","","2016-09-22 13:40:45","","0","167","<p>I've just installed Lektor desktop app for OS X on two computers, and when I select ""Install Shell Command"", it prompts for admin credentials (my default user account is not admin in either case) and after I've entered the admin details it then responds with:</p>

<blockquote>
  <p>Error<br>
  Failed to install shell commands</p>
</blockquote>

<p>A search for 'lektor' in the console revealed no log entries.</p>

<p>Both machines have XCode 8.0 installed (don't know if this makes a difference).</p>

<p>(FYI, but not part of this question, subsequent attempts to install the Command Line App via the bash script succeeded on one and failed on the other computer.)</p>
","96553","","1591669","","2017-10-17 23:32:45","2017-10-17 23:32:45","Lektor command-line installation fails on OS X 10.11.6","<macos><install><lektor>","1","0","","","","39640741","116940","116940","lektor","40","34631336","34631335"
"48463721","1","48464613","","2018-01-26 14:48:34","","4","1300","<p>I have been trying to create an executable JAR for my Kotlin/Java Ktor project. Creating the actual JAR with my gradle script has been simple, but for whatever reason I can't for the life of me figure out how to get past the error message: ""JAR file: cannot find main class routing.MainKt"". My Kotlin main function is located in a file named Main.kt in the package routing. Below is my gradle file. What am I doing wrong?</p>

<pre><code>buildscript {
   ext.kotlin_version = '1.2.21'
   ext.ktorVersion = '0.9.0'

repositories {
    mavenCentral()
}
dependencies {
    classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
  }
}

apply plugin: 'java'
apply plugin: 'kotlin'

sourceCompatibility = 1.8
compileKotlin {
  kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
  kotlinOptions.jvmTarget = ""1.8""
}

kotlin {
  experimental {
     coroutines ""enable""
  }
}

jar {
  manifest {
     attributes 'Main-Class': ""routing.MainKt""
  }

  from {
     configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
  }
}

repositories {
  mavenCentral()
  jcenter()
  maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
  maven { url ""https://dl.bintray.com/kotlin/ktor"" }
  maven { url ""http://repository.jetbrains.com/kotlin-nosql"" }
  maven { url ""https://oss.sonatype.org/content/repositories/snapshots"" }
}

dependencies {
  //Core Ktor libs
  compile ""org.jetbrains.kotlin:kotlin-stdlib-jdk8""
  compile ""io.ktor:ktor-server-core:$ktorVersion""
  compile ""io.ktor:ktor-server-netty:$ktorVersion""
  compile ""io.ktor:ktor-freemarker:$ktorVersion""
  compile ""io.ktor:ktor-locations:$ktorVersion""
  ...Other libs
}
</code></pre>

<p>Edit: When I run jar tf on the generated jar I get the following pertinent information:</p>

<pre><code>routing/MainKt$chartsxyzApplication$5.class
routing/MainKt$chartsxyzApplication$5$1.class
routing/MainKt$chartsxyzApplication$4.class
routing/MainKt$chartsxyzApplication$4$1.class
routing/MainKt.class
routing/MainKt$redirect$1.class
routing/MainKt$chartsxyzApplication$5$2.class
routing/MainKt$chartsxyzApplication$2.class
routing/MainKt$chartsxyzApplication$1.class
routing/MainKt$chartsxyzApplication$3.class
routing/MainKt$main$1.class
</code></pre>

<p>Edit2: Here are the basics of Main.kt</p>

<pre><code>package routing

import io.ktor.application.*
...

@location(""/"")
class Index
... A bunch of other locations

fun main(args: Array&lt;String&gt;) {
   embeddedServer(Netty, 8080, module = Application::chartsApplication).start()
}

fun Application.chartsApplication(){
   ...
}

suspend fun ApplicationCall.redirect(location: Any) {
   ...
}

fun ApplicationCall.refererHost() = request.header(HttpHeaders.Referrer)?.let { URI.create(it).host }
</code></pre>
","7117772","","627727","","2018-02-01 17:01:03","2018-05-16 06:44:40","How to build valid JAR file with gradle from Ktor Kotlin/Java app","<java><gradle><jar><kotlin><ktor>","2","4","","","","48463721","128262","128262","ktor","265","45915935","45915934"
"48636944","1","48698984","","2018-02-06 06:41:30","","5","986","<p>I am running my Ktor web app via an embedded Jetty server. The app works just fine inside the IDE. However, once I package it up with shadowJar and run the resulting fat jar, the Jetty server runs into a NoClassDefFoundError. I believe the NoClassDefFoundError is caused by an ExceptionInInitializerError that is occurring because of an ArrayIndexOutOfBoundsException inside of Jetty's static intialization inside of PreEncodedHttpField. How is it that this error doesn't occur inside the IDE? How can I avoid it when running the Ktor app from the fat jar?</p>

<pre><code>02-06-2018 00:27:59.093 [qtp859617558-17] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128)
at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:126)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.093 [qtp859617558-24] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.099 [qtp859617558-26] DEBUG org.eclipse.jetty.io.IdleTimeout - SocketChannelEndPoint@2d8b0948{/0:0:0:0:0:0:0:1:50406&lt;-&gt;/0:0:0:0:0:0:0:1:9000,OPEN,fill=-,flush=-,to=10/30000}{io=0/0,kio=0,kro=0}-&gt;&lt;null&gt; idle timeout check, elapsed: 6 ms, remaining: 29994 ms
02-06-2018 00:27:59.099 [qtp859617558-17] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128)
at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:126)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.099 [qtp859617558-24] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.099 [qtp859617558-26] DEBUG o.eclipse.jetty.io.AbstractEndPoint - onOpen SocketChannelEndPoint@2d8b0948{/0:0:0:0:0:0:0:1:50406&lt;-&gt;/0:0:0:0:0:0:0:1:9000,OPEN,fill=-,flush=-,to=15/30000}{io=0/0,kio=0,kro=0}-&gt;&lt;null&gt;
02-06-2018 00:27:59.099 [qtp859617558-17] DEBUG o.e.j.u.t.Invocable$InvocableExecutor - org.eclipse.jetty.util.thread.Invocable$InvocableExecutor@4dfc073a invoked org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@543935e4
02-06-2018 00:27:59.099 [qtp859617558-24] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@5689f60
02-06-2018 00:27:59.099 [qtp859617558-17] DEBUG o.e.j.u.t.strategy.EatWhatYouKill - EatWhatYouKill@707b1a44/org.eclipse.jetty.io.ManagedSelector$SelectorProducer@7132a9dc/PRODUCING/1/1 produce exit
02-06-2018 00:27:59.099 [qtp859617558-26] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.099 [qtp859617558-17] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$$Lambda$26/86506638@2c7106d9
02-06-2018 00:27:59.100 [qtp859617558-26] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.100 [qtp859617558-26] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@5ce56a5a
02-06-2018 00:27:59.093 [qtp859617558-20] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.095 [qtp859617558-22] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.ExceptionInInitializerError: null
at org.eclipse.jetty.server.HttpConnection.&lt;clinit&gt;(HttpConnection.java:54)
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.ArrayIndexOutOfBoundsException: 1
at org.eclipse.jetty.http.PreEncodedHttpField.&lt;clinit&gt;(PreEncodedHttpField.java:71)
... 9 common frames omitted
02-06-2018 00:27:59.094 [qtp859617558-23] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.102 [qtp859617558-23] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.102 [qtp859617558-23] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@752bc090
02-06-2018 00:27:59.102 [qtp859617558-20] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.102 [qtp859617558-20] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@1985be4c
02-06-2018 00:27:59.103 [qtp859617558-22] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.ExceptionInInitializerError: null
at org.eclipse.jetty.server.HttpConnection.&lt;clinit&gt;(HttpConnection.java:54)
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.ArrayIndexOutOfBoundsException: 1
at org.eclipse.jetty.http.PreEncodedHttpField.&lt;clinit&gt;(PreEncodedHttpField.java:71)
... 9 common frames omitted
02-06-2018 00:27:59.103 [qtp859617558-22] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@3416caab
02-06-2018 00:27:59.103 [qtp859617558-18-acceptor-0@178f268a-ServerConnector@cfbc8e8{HTTP/1.1,[http/1.1, h2c]}{0.0.0.0:9000}] DEBUG org.eclipse.jetty.io.ManagedSelector - Queued change org.eclipse.jetty.io.ManagedSelector$Accept@6cf5cd13 on org.eclipse.jetty.io.ManagedSelector@440e3ce6 id=0 keys=1 selected=0
02-06-2018 00:27:59.108 [qtp859617558-16] DEBUG org.eclipse.jetty.io.ManagedSelector - Selector loop woken up from select, 0/0 selected
02-06-2018 00:27:59.108 [qtp859617558-16] DEBUG org.eclipse.jetty.io.ManagedSelector - Running action org.eclipse.jetty.io.ManagedSelector$Accept@6cf5cd13
02-06-2018 00:27:59.108 [qtp859617558-16] DEBUG org.eclipse.jetty.io.ManagedSelector - Queued change org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@44ae85a2 on org.eclipse.jetty.io.ManagedSelector@440e3ce6 id=0 keys=1 selected=0
02-06-2018 00:27:59.108 [qtp859617558-16] DEBUG o.e.j.u.t.strategy.EatWhatYouKill - EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.ManagedSelector$SelectorProducer@fd53053/PRODUCING/1/1-&gt;IDLE/0/1 EPC! org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@44ae85a2
02-06-2018 00:27:59.109 [qtp859617558-19] DEBUG o.e.j.u.t.strategy.EatWhatYouKill - EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.ManagedSelector$SelectorProducer@fd53053/PRODUCING/0/1 produce non-blocking
02-06-2018 00:27:59.109 [qtp859617558-19] DEBUG org.eclipse.jetty.io.ManagedSelector - Selector loop waiting on select
02-06-2018 00:27:59.109 [qtp859617558-16] DEBUG o.e.j.util.thread.QueuedThreadPool - queue EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.ManagedSelector$SelectorProducer@fd53053/PRODUCING/0/1
02-06-2018 00:27:59.109 [qtp859617558-16] DEBUG o.e.j.u.t.Invocable$InvocableExecutor - org.eclipse.jetty.util.thread.Invocable$InvocableExecutor@5ba4a467 invoke  org.eclipse.jetty.io.ManagedSelector$CreateEndPoint@44ae85a2
02-06-2018 00:27:59.109 [qtp859617558-16] DEBUG org.eclipse.jetty.io.IdleTimeout - SocketChannelEndPoint@56d0b70c{/0:0:0:0:0:0:0:1:50414&lt;-&gt;/0:0:0:0:0:0:0:1:9000,OPEN,fill=-,flush=-,to=0/30000}{io=0/0,kio=0,kro=0}-&gt;&lt;null&gt; idle timeout check, elapsed: 0 ms, remaining: 30000 ms
02-06-2018 00:27:59.110 [qtp859617558-16] DEBUG o.eclipse.jetty.io.AbstractEndPoint - onOpen SocketChannelEndPoint@56d0b70c{/0:0:0:0:0:0:0:1:50414&lt;-&gt;/0:0:0:0:0:0:0:1:9000,OPEN,fill=-,flush=-,to=0/30000}{io=0/0,kio=0,kro=0}-&gt;&lt;null&gt;
02-06-2018 00:27:59.110 [qtp859617558-16] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128)
at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:126)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.113 [qtp859617558-26] DEBUG o.e.j.util.thread.QueuedThreadPool - run EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.Man053/PRODUCING/0/1
02-06-2018 00:27:59.113 [qtp859617558-26] DEBUG o.e.j.u.t.strategy.EatWhatYouKill - EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.ManagedSRODUCING/0/1 run
02-06-2018 00:27:59.116 [qtp859617558-16] DEBUG org.eclipse.jetty.io.ManagedSelector -
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.server.HttpConnection
at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:85)
at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:482)
at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:424)
at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:61)
at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:603)
at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128)
at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294)
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:126)
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673)
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591)
at java.lang.Thread.run(Thread.java:748)
02-06-2018 00:27:59.119 [qtp859617558-16] DEBUG o.e.j.u.t.Invocable$InvocableExecutor - org.eclipse.jetty.util.thread.Invocable$Invocablepse.jetty.io.ManagedSelector$CreateEndPoint@44ae85a2
02-06-2018 00:27:59.119 [qtp859617558-16] DEBUG o.e.j.u.t.strategy.EatWhatYouKill - EatWhatYouKill@3e67f5f2/org.eclipse.jetty.io.ManagedSRODUCING/1/1 produce exit
02-06-2018 00:27:59.119 [qtp859617558-16] DEBUG o.e.j.util.thread.QueuedThreadPool - ran org.eclipse.jetty.io.ManagedSelector$$Lambda$26/
</code></pre>

<p>My gradle file:</p>

<pre><code>buildscript {
    ext.kotlin_version = '1.2.21'
    ext.ktorVersion = '0.9.1'

    repositories {
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
        classpath ""com.github.jengelman.gradle.plugins:shadow:2.0.2""
    }
}

apply plugin: 'com.github.johnrengelman.shadow'
apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'application'

mainClassName = 'routing.MainKt'
shadowJar {
    baseName = 'baseName'
    classifier = null
    version = null
}

sourceCompatibility = 1.8
compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}

kotlin {
    experimental {
        coroutines ""enable""
    }
}

repositories {
    mavenCentral()
    jcenter()
    maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
    maven { url ""https://dl.bintray.com/kotlin/ktor"" }
    maven { url ""https://oss.sonatype.org/content/repositories/snapshots"" }
}

dependencies {
    // Core Kotlin libs
    implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    implementation ""org.jetbrains.kotlin:kotlin-reflect:$kotlin_version""

    // Core Ktor libs
    def withoutKotlin = {
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jdk8'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jdk7'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-reflect'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jre8'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jre7'
    }
    implementation ""io.ktor:ktor-server-core:$ktorVersion"", withoutKotlin
    implementation ""io.ktor:ktor-server-netty:$ktorVersion"", withoutKotlin
    implementation ""io.ktor:ktor-freemarker:$ktorVersion"", withoutKotlin
    implementation ""io.ktor:ktor-locations:$ktorVersion"", withoutKotlin

    .... More dependencies
}
</code></pre>
","7117772","","7117772","","2018-02-07 15:05:36","2018-02-09 04:58:17","How to avoid a java.lang.ExceptionInInitializerError when trying to run a Ktor app via an embedded Jetty server?","<java><kotlin><jetty><ktor>","1","2","0","","","48636944","128262","128262","ktor","265","45915935","45915934"
"48760620","1","","","2018-02-13 06:21:07","","0","770","<p>I'm new to Ktor, and I'm trying to build a backend that processes login credentials. I'm attempting to use the content negotiation feature to convert JSON into a native Kotlin object, but I keep getting an unsupported media type exception. Here is my code:</p>

<pre><code>fun Application.main() {
    install(CallLogging)
    install(DefaultHeaders)
    install(ContentNegotiation) {
        register(ContentType.Application.Json, GsonConverter())
    }
    routing {
        get(""/"") {
            call.respondHtml {
                head {
                    title(""Kotlin Webapp"")
                    script {
                        type = ScriptType.textJScript
                        src = ""main.bundle.js""
                    }
                }
                body {
                    div {
                        id = ""root""
                    }
                }
            }
        }
        post(""/login"") {
            val credentials = call.receive&lt;Credentials&gt;()
            println(credentials)
        }
    }
}

data class Credentials(val username: String, val password: String)
</code></pre>

<p>And here is the incoming Json I am trying to convert, which I am sending via XMLHttpRequest:</p>

<pre><code>{""username"":""Jamdan2"",""password"":""sometext""}
</code></pre>

<p>I have searched the web for answers, but could not find what I am doing wrong. Can anybody help?</p>
","8738243","","","","","2018-02-14 06:54:14","How do I convert json into a kotlin object in ktor using content negotiation?","<json><xmlhttprequest><kotlin><ktor>","1","2","","","","48760620","128262","128262","ktor","265","45915935","45915934"
"39941130","1","39941457","","2016-10-09 07:32:09","","1","89","<p>Python version: 2.7</p>

<p>Showing the following error on <code>lektor server</code> command:</p>

<pre class=""lang-none prettyprint-override""><code>Traceback (most recent call last):
  File ""/Users/item4/Projects/lektor/lektor/devserver.py"", line 49, in build
    builder.prune()
  File ""/Users/item4/Projects/lektor/lektor/builder.py"", line 1062, in prune
    for aft in build_state.iter_unreferenced_artifacts(all=all):
  File ""/Users/item4/Projects/lektor/lektor/builder.py"", line 371, in iter_unreferenced_artifacts
    and is_primary_source''', [artifact_name])
ProgrammingError: You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings.
</code></pre>
","4029338","","1591669","","2017-10-17 23:34:59","2017-10-17 23:34:59","Issue while running ""lektor server"" command on Windows","<python><windows><lektor>","1","0","","","","39941130","116940","116940","lektor","40","34631336","34631335"
"40263599","1","","","2016-10-26 13:27:41","","1","770","<p>a hopefully simple question:  how can I insert an image in a markdown section in lektor.  In particular, does the url filter work inside markdown, or who else to I reference the image location inside assets/static/?</p>

<p>Many thanks in advance for any help!
kind regards
-bud</p>
","1268478","","","","","2017-01-11 00:08:31","How to insert images in lektor markdown sections?","<lektor>","2","1","","","","40263599","116940","116940","lektor","40","34631336","34631335"
"40504793","1","","","2016-11-09 10:30:07","","2","388","<p>I'm attempting to run lektor within a docker container and have hit a problem.</p>

<p>If I 'ADD' (or 'COPY') my source code folder within my Dockerfile, everything works perfectly but, of course, the container is then not dynamic and doesn't respond to changes in the code.</p>

<p>If, instead, I use a volume, the container becomes dynamic and lektor successfully rebuilds and serves my site as I make changes.</p>

<p>However, when I come to publish the site, an error appears in the container's log and it enters a never-ending loop:</p>

<p><code>
Started build
Debugging middleware caught exception in streamed response at a point where response headers were already sent.
Traceback (most recent call last):
  File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/admin/utils.py"", line 18, in generate
    for event in chain(f(*args, **kwargs), (None,)):
  File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/admin/modules/api.py"", line 309, in generator
    for event in event_iter:
  File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/publisher.py"", line 639, in publish
    self.link_artifacts(path)
  File ""/usr/local/lib/lektor/lib/python2.7/site-packages/lektor/publisher.py"", line 602, in link_artifacts
    link(full_path, dst)
OSError: [Errno 18] Invalid cross-device link
</code></p>

<p><strong>Minimal Dockerfile:</strong></p>

<pre><code>FROM python:2.7.11

RUN curl -sf https://www.getlektor.com/install.sh | \
  sed '/stdin/d;s/input = .*/return/' | \
  sh
</code></pre>

<p>I'm actually using docker-compose.</p>

<p><strong>Minimal docker-compose.yml:</strong>
<code>
version: '2'
services:
  web:
    build: .
    ports:
      - ""5000:5000""
    volumes:
      - .:/project
    working_dir: /project/source
    command: ['lektor', 'server', '--host', '0.0.0.0.']
</code></p>

<p>(My project folder is structured such that the lektor project file and all the expected lektor folders are in the 'source' sub-folder).</p>
","2115404","","2115404","","2016-11-09 11:58:44","2019-10-07 21:56:13","How can I run Lektor within a Docker container?","<python><docker><lektor>","1","7","","","","40504793","116940","116940","lektor","40","34631336","34631335"
"40532125","1","","","2016-11-10 16:10:45","","0","81","<p>I tried inserting a definition list in my contents.lr file.</p>

<p>Tables are working fine but the definition lists are not handled correctly.</p>

<p><strong>Example</strong> taken from <a href=""https://pythonhosted.org/Markdown/extensions/index.html"" rel=""nofollow noreferrer"">https://pythonhosted.org/Markdown/extensions/index.html</a></p>

<pre><code>Apple
:   Pomaceous fruit of plants of the genus Malus in
    the family Rosaceae.
Orange
:   The fruit of an evergreen tree of the genus Citrus.
</code></pre>

<p>Rendering the string directly with <code>markdown</code> works:</p>

<pre><code>markdown.markdown(s, extensions=['markdown.extensions.def_list'])
</code></pre>
","7142269","","1371853","","2016-11-14 08:17:37","2016-11-14 08:17:37","`markdown.extensions.def_list` not rendering correctly","<markdown><lektor>","1","0","","","","40532125","116940","116940","lektor","40","34631336","34631335"
"48761539","1","48796263","","2018-02-13 07:30:05","","2","1955","<p>I have a simple hello world Ktor app: </p>

<pre><code>fun Application.testMe() {
  intercept(ApplicationCallPipeline.Call) {
    if (call.request.uri == ""/"")
      call.respondText(""Hello"")
    }
}
</code></pre>

<p>With JUnit test class I can write the test for it, as given in its documentation; as following: </p>

<pre><code>class ApplicationTest {
    @Test fun testRequest() = withTestApplication(Application::testMe) {
        with(handleRequest(HttpMethod.Get, ""/"")) {
            assertEquals(HttpStatusCode.OK, response.status())
            assertEquals(""Hello"", response.content)
        }
        with(handleRequest(HttpMethod.Get, ""/index.html"")) {
            assertFalse(requestHandled)
        }
    }
}
</code></pre>

<p>However, I want to do a unit test in Spek or KotlinTest, without the help of JUnit, similar to the way I do it in ScalaTest/Play; in a more declarative way: </p>

<ol>
<li>Send a FakeRequest to the route (i.e., <code>/</code>) during a test.  </li>
<li>Get the content of the page, and check for the string ""hello"". </li>
</ol>

<p>The question is can I write the above test in a more declarative way in KotlinTest or Spek? </p>
","3848320","","3848320","","2018-02-13 08:19:09","2018-02-14 21:09:50","Ktor: testing REST endpoints using Spek/KotlinTest instad of JUnit Test Class","<ktor><spek><kotlintest>","1","0","","","","48761539","128262","128262","ktor","265","45915935","45915934"
"48919809","1","48924086","","2018-02-22 04:44:13","","4","2942","<p>My question is about the big picture behind routing functionality in Ktor; and scalability when it comes to design an API with large number of routes. </p>

<p>If I create an app like this: </p>

<pre><code>import io.ktor.application.*
import io.ktor.response.*
import io.ktor.request.*
import io.ktor.server.engine.embeddedServer
import io.ktor.server.netty.Netty

fun Application.routingExample() {
 intercept(ApplicationCallPipeline.Call){
   if (call.request.uri == ""/"") call.respondText(""User call for /"")
 }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080, watchPaths = listOf(""Routing""), module = Application::routingExample).start()
}
</code></pre>

<p>Which is ok if I have an api/app with low number of routes. However in what style I should scale this approach for 
large number of routes (e.g., 30 routes and controller functions). </p>

<p>I would have a number of choices: </p>

<p><strong>A large routing function</strong>: I would have a large <code>Application.routingExample</code> function that would hold all the routes, so I don't need to update the main.</p>

<p><strong>A large main function</strong>:  Would have a large function that would hold the calls to different smaller functions; but it would be repetitive; as for an API I want to 
serve them in the same port.  </p>

<p>So my question is about the coding style: is there a way to to factorize the routing controller relationship?</p>
","3848320","","","","","2018-02-22 09:43:17","Ktor Routing: How to factorize the routing functionality in an application/api?","<kotlin><ktor>","1","0","1","","","48919809","128262","128262","ktor","265","45915935","45915934"
"48923406","1","","","2018-02-22 09:09:07","","2","972","<p>I don't find a way to use a ktor application inside an AWS lambda...</p>

<p>That is, instead of starting an embedded server or using an external server as described in <a href=""http://ktor.io/servers/engine.html"" rel=""nofollow noreferrer"">http://ktor.io/servers/engine.html</a>, I just need to ""execute"" the pipeline.</p>

<p>I suppose this is more or less like the TestEngine but I am not so familiar with the ktor framework to be sure</p>

<p>Note :</p>

<p>I have already found examples to run one kotlin function per lambda (the best tutorial IMHO being <a href=""https://aws.amazon.com/fr/blogs/machine-learning/use-amazon-rekognition-to-build-an-end-to-end-serverless-photo-recognition-system/"" rel=""nofollow noreferrer"">https://aws.amazon.com/fr/blogs/machine-learning/use-amazon-rekognition-to-build-an-end-to-end-serverless-photo-recognition-system/</a>).</p>

<p>The problem is I dont want to manage one lambda per function (I want one microservice per lambda, the microservice being responsible for multiple tightly coupled operations)</p>
","1545567","","","","","2018-02-22 10:31:54","How to run a ktor application inside AWS lambda?","<amazon-web-services><aws-lambda><ktor>","1","0","","","","48923406","128262","128262","ktor","265","45915935","45915934"
"40940937","1","40960209","","2016-12-02 21:15:35","","1","119","<p>The <a href=""https://www.getlektor.com/docs/content/paths/#alternatives-and-paths"" rel=""nofollow noreferrer"">Lektor docs clearly state</a>:</p>

<blockquote>
  <p>If you have a page that exists in both German and English alternative then they will have the same path.</p>
</blockquote>

<p>If you need localized paths, what would be the easiest / best way to get them? Anything better than solving it on the webserver level?</p>
","201743","","201743","","2016-12-03 12:23:27","2017-02-18 13:25:27","Localized / translated paths in Lektor","<python><path><localization><internationalization><lektor>","1","0","","","","40940937","116940","116940","lektor","40","34631336","34631335"
"41452144","1","","","2017-01-03 20:51:22","","3","205","<p>I am attempting to use bootstrap with lektor.</p>

<p>Following the instructions found <a href=""https://www.getlektor.com/docs/guides/webpack/"" rel=""nofollow noreferrer"">here</a>, everything worked as expected. I then used <code>npm</code> to install <code>jquery</code> and <code>bootstrap</code>.</p>

<p>""Requiring"" jquery and bootstrap in <code>webpack/js/main.js</code> works without a hitch. However when I attempted to </p>

<pre><code>@import ""bootstrap""; 
</code></pre>

<p>in <code>webpack/scss/main.scss</code> I got the following:</p>

<pre><code>ERROR in ./~/css-loader!./~/sass-loader!./scss/main.scss
    Module build failed: 
    @import ""bootstrap"";
    ^
          File to import not found or unreadable: bootstrap.
    Parent style sheet: stdin
          in /home/lysdexia/Projects/thing/webpack/scss/main.scss (line 4, column 1)
</code></pre>

<p>This lead me to a bunch of not-very-helpful reading vis the node search path. I found that all three of the the following:</p>

<pre><code>@import ""/home/lysdexia/Projects/thing/webpack/node_modules/bootstrap/dist/css/bootsrap.css"";
@import ""/bootstrap/dist/css/boostrap.css"";
@import ""/bootstrap.css"";
</code></pre>

<p>. . . all <em>seem</em> to import without errors. All the scss examples show a simple <code>@import whatever;</code> which I now suspect may be shorthand for something, or an assumption of a different configuration.</p>

<p>Unfortunately, upon attempting to <code>@extend</code> a class with a bootstrap class gives me a <code>The selector "".row"" was not found.</code>, which says to me that the import didn't actually work, and failed without an error.</p>

<p>I must admit some embarrassment and confusion here. Is there a way to examine node's search paths? It seems somewhat logical (if a bit wishy-washy) that ""/"" can mean ""full path from root"" or ""my paths start in node_modules"", but why <code>/bootstrap.css</code> would even appear to work is just bizarre.</p>
","218732","","218732","","2017-01-03 21:17:02","2017-01-03 21:17:02","webpack lektor bootstrap scss @import paths","<node.js><sass><webpack><lektor>","0","0","","","","41452144","116940","116940","lektor","40","34631336","34631335"
"42035674","1","","","2017-02-04 01:55:18","","0","193","<p>I've been relentlessly trying to solve the following problem while deploying a webpage for a friend to ghpages using <a href=""https://www.getlektor.com/docs/deployment/ghpages/"" rel=""nofollow noreferrer"">lektor</a>. Yet i'm always getting an error similar to:</p>

<pre><code>λ lektor deploy production
Deploying to production
  Build cache: C:\Users\user\AppData\Roaming\Lektor\Cache\builds\6edf4ce4c35ce53180e6c7f3b6a081ae
  Target: ghpages+https://user/user.github.io
  Initialized empty Git repository in C:/Users/user/repos/repo/temp/.deploytempswkcet/scratch/.git/
  Fetching origin
  fatal: Couldn't find remote ref refs/heads/master
  error: Could not fetch origin
  warning: LF will be replaced by CRLF in about/index.html.
  The file will have its original line endings in your working directory.
  warning: LF will be replaced by CRLF in blog/first-post/index.html.
  The file will have its original line endings in your working directory.
  warning: LF will be replaced by CRLF in blog/index.html.
  The file will have its original line endings in your working directory.
  warning: LF will be replaced by CRLF in index.html.
  The file will have its original line endings in your working directory.
  warning: LF will be replaced by CRLF in projects/index.html.
  The file will have its original line endings in your working directory.
  bash: /dev/tty: No such device or address
  error: failed to execute prompt script (exit code 1)
  fatal: could not read Username for 'https://github.com': Invalid argument
Done!
</code></pre>

<hr>

<p>My configuration is currently set as follows:</p>

<pre><code>[project]
name = repo

[servers.production]
target = ghpages+https://user/user.github.io
user = user
password = pass
</code></pre>

<hr>

<p>Another attempt to solve this is typing the following:</p>

<pre><code>lektor deplot --username user --password password production
</code></pre>

<p>rendering the following result:</p>

<pre><code>Deploying to production
  Build cache: C:\Users\Aperez\AppData\Roaming\Lektor\Cache\builds\6edf4ce4c35ce53180e6c7f3b6a081ae
  Target: ghpages+https://johnmanruz/johnmanruz.github.io
  Initialized empty Git repository in C:/Users/Aperez/repos/profejohnruz/temp/.deploytempcvsfya/scratch/.git/
  fatal: bad config line 12 in file .git/config
  fatal: bad config line 12 in file .git/config
  fatal: bad config line 12 in file .git/config
  fatal: bad config line 12 in file .git/config
Done!
</code></pre>

<p>If there is something wrong with my setup please let me know.</p>
","1879609","","1879609","","2017-02-04 13:32:08","2017-02-04 13:32:08","How to deploy using ""ghpages+https"" lektor method on windows? Getting the dollowing error:","<windows><github><deployment><lektor>","1","1","2","","","42035674","116940","116940","lektor","40","34631336","34631335"
"49140821","1","49144339","","2018-03-06 22:08:22","","0","1621","<p>I've successfully included a jwt auth token in my application and able to restrict access to the endpoints.  I want to embed the user's ID in the jwt token, but I'm struggling how to implement the jwt verifier in Ktor.</p>

<p>I create a token for the client something like this:</p>

<pre><code>val token = JWT.create().withAudience(audience).withIssuer(issuer).withClaim(""userId"", ""XXX"").sign(algorithm)
</code></pre>

<p>The route is setup like this.  The authentication {} block is run on server startup and does not allow creating a verifier with the userId.  </p>

<p>This was derived from the jwt sample:</p>

<pre><code>route(""/api"") {
    authentication {
        val jwtVerifier = makeJwtVerifier(issuer, audience)
        jwtAuthentication(jwtVerifier, realm) { credential -&gt;
        if (credential.payload.audience.contains(audience))
            JWTPrincipal(credential.payload)
        else
            null
    }

    handle {
       // Handle jwt succcess here
    }
}

private fun makeJwtVerifier(issuer: String, audience: String): JWTVerifier = JWT
        .require(algorithm)
        .withAudience(audience)
        .withIssuer(issuer)
        .build()
</code></pre>

<p>What is the correct way to do this?  I understand I'd need to create a verifier for each request, but don't really know where to do this nor if that is desirable. </p>
","1155415","","","","","2018-03-07 04:48:40","Using JWT with Ktor and including user info in claim","<kotlin><jwt><ktor>","1","0","","","","49140821","128262","128262","ktor","265","45915935","45915934"
"49372329","1","49394971","","2018-03-19 21:03:15","","1","215","<p>I have the following structure:</p>

<pre><code>/             -&gt; root
/react-app    -&gt; Reason app (initialized using cli)
/webapp       -&gt; gradle app, maven structure with Gradle build file
</code></pre>

<p>I am not sure how to build everything so I can:</p>

<ol>
<li>run server locally so I can debug</li>
<li>make production tar (using the <code>application</code> plugin for example)</li>
</ol>

<h3>Production</h3>

<p>The production should look like this:</p>

<ul>
<li>ktor as a main server</li>
<li>ktor app has API</li>
<li>all react JS/HTML files are also served by ktor</li>
</ul>

<p>In other words, I would like to serve everything from single web app.</p>

<p>I am aware that I could make 2 separate services - one for react, one for API. But I want to bundle this together into single app.</p>

<h3>Local development</h3>

<p>Local development should be quick. I was thinking in having separate React and API part for the local purpose only, as that is easier to run locally. But for production I need those two to be served from single app.</p>

<h3>What I would like to have</h3>

<p>is a single Gradle in the root and having modules. While ktor can be a module, I am not sure how to operate with react module.</p>
","511837","","511837","","2018-03-20 08:27:59","2018-03-20 22:11:14","How to pack Reason and Ktor apps together in a bundle with Gradle?","<reactjs><kotlin><reason><ktor>","1","2","","","","49372329","128262","128262","ktor","265","45915935","45915934"
"49574426","1","","","2018-03-30 12:26:17","","2","380","<p>Info about technologies available here:</p>

<p><a href=""https://docs.spring.io/spring-restdocs/docs/current/reference/html5/"" rel=""nofollow noreferrer"">Spring REST Docs link</a></p>

<p><a href=""http://rest-assured.io/"" rel=""nofollow noreferrer"">Rest Assured link</a></p>

<p><a href=""https://ktor.io/"" rel=""nofollow noreferrer"">Ktor backend link</a></p>

<p><strong>Main question is:</strong> 
Can I generate documentation with <code>json payloads</code> for <em>ktor</em> backend like I did it for <em>Spring</em> backend using <em>Spring Rest Docs</em> </p>

<p><em>Spring Rest Docs</em> uses unit tests technique to generate json payload and descriptions snippets. This snippets in asciidoctor style used later for including to handwritten documentation.</p>
","1438218","","","","","2018-03-30 12:26:17","Is it possible to use REST Docs, REST Assured and kotlin ktor together?","<spring><kotlin><rest-assured><spring-restdocs><ktor>","0","2","","","","49574426","128262","128262","ktor","265","45915935","45915934"
"49895169","1","49923995","","2018-04-18 08:47:50","","0","1769","<p>I have the following Server and Client code:</p>

<p>Server:</p>

<pre><code>fun Application.main() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        post(""/"") {
            val requestBody = call.receiveText()
            println(""Received $requestBody"")
            call.respond(""Hello from server - received $requestBody"")
        }
    }
}

fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, 8080) {
        main()
    }.start(wait = true)
}
</code></pre>

<p>Client:</p>

<pre><code>fun main(args: Array&lt;String&gt;) = runBlocking {
    HttpClient(CIO).use {
        val postResult = it.post&lt;String&gt;(""http://localhost:8080/"") {
            body = ""Client Hello""
        }
        println(postResult)
    }
}
</code></pre>

<p>So, the client just sends ""Client Hello"" to the server in the POST-body, and the Server responds to that.
But I didn't see the content of the body on the server-side. What am I doing wrong? </p>

<p>The <code>call.receiveText()</code> is always empty.</p>
","5247292","","","","","2018-09-21 18:17:58","Ktor unable to receive POST body on Server","<kotlin><ktor>","2","2","","","","49895169","128262","128262","ktor","265","45915935","45915934"
"42108315","1","","","2017-02-08 08:40:27","","0","114","<p>I'm on my first JinJa2 project.
I want to display cars. A car can have one or more options.
If a car has one option, show that. If it has more, hide it for the moment.
Here's my code:</p>

<pre><code>//...
{% set products = ['Audi', 'BMW', 'Mercedes', 'Porsche'] %}
{% set options = ['Small', 'Sport', 'Coupe', 'Jeep'] %}

{% for product in products %}
    {% include '../car-product-item.html' with context %}
{% endfor %}

{% if options|length &gt; 1 %}
    //If a car has more options, hide this options for the moment
    &lt;div class=""order-more-options"" style=""display: none; background: green""&gt;
        {% for product in options %}
        {% include '../car-product-item.html' with context %}
        {% endfor %}
    &lt;/div&gt;

{% elif  options|length == 1 %}
    //If a car has one option, show this option
    &lt;div class=""order-more-options"" style=""display: block; background: orange""&gt;
        {% for product in options %}
        {% include '../car-product-item.html' with context %}
        {% endfor %}
    &lt;/div&gt;
{% endif %}
//...
</code></pre>

<p>For some reason its not working. The options are always hidden.
What am I doing wrong?</p>

<p>I checked a <a href=""http://flask.pocoo.org/docs/0.12/tutorial/templates/"" rel=""nofollow noreferrer"">Tutorial</a>, the <a href=""http://jinja.pocoo.org/docs/2.9/templates/"" rel=""nofollow noreferrer"">Docu</a> and another <a href=""https://stackoverflow.com/questions/22024661/jinja2-template-not-rendering-if-elif-else-statement-properly"">SO-Question</a> but nothing helped.</p>
","3157317","","-1","","2017-05-23 12:00:07","2017-02-17 13:25:10","Display different <div> depending on arrays length","<python><html><python-2.7><jinja2><lektor>","1","2","","","","42108315","116940","116940","lektor","40","34631336","34631335"
"42297541","1","","","2017-02-17 12:04:56","","4","176","<p>In a <strong>model</strong> I am using a field of the type <em>select</em> to let the user choose a link among all children of the root of my site:  </p>

<pre><code>[fields.link]
label = Link
type = select
source = site.get('/').children
</code></pre>

<p>To offer a list of these children in my model I use the following command </p>

<pre><code>site.get('/').children
</code></pre>

<p>in the according <strong>model</strong>.</p>

<p>In the <strong>template</strong> I use the following jina2 code to create a link:</p>

<pre><code>&lt;a href=""{{ '/' + this.link|url }}""&gt;my link&lt;/a&gt;
</code></pre>

<p>This lets the user choose a link-address among all children of <em>'/'</em> of my page.
This is limited to children of the root directory. Now I want to expand this functionality to <strong>a list of all created pages available</strong> in my lektor project, but I do not know how to do this.</p>

<p>Is there a possibility to create a list of all pages in my lektor project? (with the limited possibility to use code in a model)</p>
","2411372","","2411372","","2017-02-18 12:20:37","2017-02-18 12:20:37","How to create a list of all pages of lektor project?","<python><templates><model><jinja2><lektor>","0","0","","","","42297541","116940","116940","lektor","40","34631336","34631335"
"43028075","1","","","2017-03-26 11:22:59","","2","262","<p>I see that <a href=""https://github.com/lektor/lektor/pull/207"" rel=""nofollow noreferrer"">it has been merged</a> already an year ago but the install.sh script still install with python 2.7 and all the docs still refers to python 2.7
I wonder what's the correct steps to have it working on python 3 and what's holds back for an official support?</p>

<p><em>EDIT:</em> for the first part of my question on how to install, I solved by installing from git but I'm still curious to know about any plan on official support and if is possible to describe the implication of the pip installation warning on being <em>heavily discouraged</em>. what that means in practice? In travis also get deployed using pip.</p>
","1911518","","1911518","","2017-03-26 14:10:26","2017-07-11 03:29:32","support python 3 on installing script for lektor","<lektor>","1","0","","","","43028075","116940","116940","lektor","40","34631336","34631335"
"44972297","1","51437587","","2017-07-07 13:40:42","","2","217","<p>the problem:
we are porting a wordpress blog to lektor. The slugs in wordpress of the post are directly under the main domain e.g. <code>www.mypage.com/my-blogpost-about-food/</code> not <code>www.mypage.com/blog/my-blogpost-about-food/</code>. </p>

<p>Now the owner is not ready to accept any broken links. Broken links from the outside, e.g. some random internet page links to <code>www.mypage.com/my-blogpost-about-food/</code>. This link will not work in lektor. This will decrease the page rank of the redesign of the page with lektor. What can I do to avoid this?</p>

<p>Again, in our current wordpress website</p>

<p>the main blog page sits under:</p>

<pre><code>www.mypage.com/blog/
</code></pre>

<p>each blog post has a unique slug, NOT under <code>/blog/</code> but directly in the main.
e.g.</p>

<pre><code>www.mypage.com/my-blogpost-about-food/
</code></pre>

<p>What can I do, to make these URLs be valid for lektor as well? that e.g. <code>mypage.com/my-blogpost-about-food</code> is a blog post.</p>

<p><strong>EDIT: this is what lektor does not support. Blog posts in lektor must sit in <code>www.mypage.com/blog/SINGLE-BLOG-POSTS-MUSTBEHERE</code> but I want the blog posts to be here <code>www.mypage.com/SINGLE-BLOG-POSTS-MUSTBEHERE</code></strong></p>

<p>reading here
<a href=""https://www.getlektor.com/docs/content/urls/"" rel=""nofollow noreferrer"">https://www.getlektor.com/docs/content/urls/</a></p>

<p>if I go to the system fields and enter <code>my-blogpost-about-food</code> it will still appear in <code>/blog/my-blogpost-about-food/</code></p>

<p>reading <a href=""https://www.getlektor.com/docs/guides/blog/"" rel=""nofollow noreferrer"">here</a> it becomes clear that I cannot change the slug in the parent model neither:</p>

<blockquote>
  <p>With the above settings the blog will live at blog/ and the posts at
  blog/. But what if you want to put the date of the blog
  post into the URL? That's thankfully very easy. All you need to do is
  to set up a new URL format for the children. Just edit blog.ini and
  add this to the [children] section:</p>

<pre><code>slug_format = {{ (this.pub_date|dateformat('YYYY/M/') if this.pub_date) ~ this._id }}
</code></pre>
  
  <p>What this does is that it will prepend the year (YYYY) and month (M)
  to the ID of the page if the publication date is configured. Otherwise
  it will just use the ID of the page. With this change our blog post
  will move from for instance blog/hello/ to blog/2015/12/hello/.</p>
</blockquote>

<p>now how would I achieve a behaviour similar to this?</p>

<p>this is the formal of the perma links of our wordpress installation:
<a href=""https://i.stack.imgur.com/etHMG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/etHMG.png"" alt=""enter image description here""></a></p>
","533426","","533426","","2017-07-07 22:41:48","2018-07-20 07:45:43","changing the URL structure of lektor for blog posts to be in the parent directory","<lektor>","2","1","1","","","44972297","116940","116940","lektor","40","34631336","34631335"
"49945584","1","51483875","","2018-04-20 15:57:22","","3","2081","<p>I'm trying to embed Ktor in an Android Service in order to check remotely some assets on an app at some point.</p>

<p>I'm following the code in this <a href=""https://proandroiddev.com/kotlin-backend-yes-its-possible-953388acffc3"" rel=""nofollow noreferrer"">tutorial</a></p>

<p>I get this error when I attempt to access the link for example on ""192.168.2.105:7070"":</p>

<pre><code>04-20 14:50:58.523 29389-29389 E/AndroidRuntime: FATAL EXCEPTION: main
    Process: com.mypackage.fetchingservice, PID: 29389
    java.lang.NoClassDefFoundError:io.ktor.application.ApplicationEvents$subscribe$1
        at io.ktor.application.ApplicationEvents.subscribe(ApplicationEvents.kt:18)
        at io.ktor.server.engine.BaseApplicationEngine.&lt;init&gt;(BaseApplicationEngine.kt:29)
        at io.ktor.server.engine.BaseApplicationEngine.&lt;init&gt;(BaseApplicationEngine.kt:15)
        at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:16)
        at io.ktor.server.netty.Netty.create(Embedded.kt:10)
        at io.ktor.server.netty.Netty.create(Embedded.kt:8)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer(EmbeddedServer.kt:50)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer(EmbeddedServer.kt:40)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer$default(EmbeddedServer.kt:27)
        at com.hirschandmann.magickservice.KtorFetchService.onCreate(KtorFetchService.kt:30)
        at android.app.ActivityThread.handleCreateService(ActivityThread.java:2761)
        at android.app.ActivityThread.access$1800(ActivityThread.java:151)
        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1386)
        at android.os.Handler.dispatchMessage(Handler.java:102)
        at android.os.Looper.loop(Looper.java:135)
        at android.app.ActivityThread.main(ActivityThread.java:5254)
        at java.lang.reflect.Method.invoke(Native Method)
        at java.lang.reflect.Method.invoke(Method.java:372)
        at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:935)
        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:730)
</code></pre>

<p>Here's the code. Service is registered in the manifest and I launch it from adb using: 
<code>adb shell am startservice com.mypackage.service/.KtorFetchService</code></p>

<pre><code>class KtorFetchService : Service() {
    override fun onBind(intent: Intent?): IBinder {
    TODO(""not implemented"") //To change body of created functions use File | Settings | File Templates.
    }
    private val HTTP_PORT = 7070
    override fun onCreate() {
        embeddedServer(Netty, HTTP_PORT) {
            routing {
                get(""/"") {
                    call.respondText(""My Example Fetch"", ContentType.Text.Html)
                }
            }
        }.start(wait = true)
        super.onCreate()
    }
}
</code></pre>

<p>Here's the module gradle file:</p>

<pre><code>apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'

android {
    compileSdkVersion 27
    defaultConfig {
        applicationId ""com.hirschandmann.magickservice""
        minSdkVersion 21
        targetSdkVersion 27
        versionCode 1
        versionName ""1.0""
        testInstrumentationRunner ""android.support.test.runner.AndroidJUnitRunner""
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    packagingOptions {
        pickFirst 'META-INF/*'
    }
}

repositories {
    jcenter()
    mavenCentral()
    maven { url ""http://dl.bintray.com/kotlin/ktor"" }
    maven { url ""https://dl.bintray.com/kotlin/kotlinx"" }
}

configurations {
    ktlint
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    implementation'com.android.support:appcompat-v7:27.1.1'
    testImplementation'junit:junit:4.12'
    androidTestImplementation'com.android.support.test:runner:1.0.1'
    androidTestImplementation'com.android.support.test.espresso:espresso-core:3.0.1'

    // AutoValue
    compileOnly ""com.google.auto.value:auto-value:1.5.2""
    annotationProcessor ""com.google.auto.value:auto-value:1.5.2""

    // ktlint
    ktlint ""com.github.shyiko:ktlint:0.15.0""

    implementation'com.github.hkk595:Resizer:v1.5'
    implementation'com.jrummyapps:android-shell:1.0.1'
    implementation'org.nanohttpd:nanohttpd:2.3.1'
    implementation""io.ktor:ktor:$ktor_version"" // ktor dependency
    implementation""io.ktor:ktor-server-netty:$ktor_version""

}
task ktlint(type: JavaExec, group: ""verification"") {
    description = ""Check Kotlin code style.""
    classpath = configurations.ktlint
    main = ""com.github.shyiko.ktlint.Main""
    args ""src/**/*.kt""
    //args ""--reporter=checkstyle,output=${buildDir}/ktlint.xml""
}
check.dependsOn ktlint

androidExtensions {
    experimental = true
}
</code></pre>

<p>Here's the project's gradle file:</p>

<pre><code>buildscript {
    ext.kotlin_version = '1.2.40'
    ext.ktor_version = '0.9.1'

    repositories {
        google()
        jcenter()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.1.1'
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

plugins {
    id ""io.gitlab.arturbosch.detekt"" version ""1.0.0.RC6-3""
}

allprojects {
    repositories {
        google()
        jcenter()
        maven { url 'https://jitpack.io' }
    }
}

detekt {
    version = ""1.0.0.RC6-3""
    profile(""main"") {
        input = ""$projectDir/app/src/main/java""
        config = ""$projectDir/default-detekt-config.yml""
        filters = "".*test.*,.*/resources/.*,.*/tmp/.*""
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</code></pre>

<p>The device is an Odroid C2 with Android 5.1.1 (API 22)
I'm using Android studio 3.1 and JRE 1.8 running on a MacOS 10.13.3. </p>
","3253213","","3253213","","2018-07-24 10:48:23","2018-07-24 10:48:23","Attempting to run an embedded Ktor HTTP Server on Android","<android><kotlin><ktor>","1","6","","","","49945584","128262","128262","ktor","265","45915935","45915934"
"50322967","1","","","2018-05-14 04:08:00","","0","1145","<p>I am Trying to create table (postgres + exposed + ktor + JDBC), I got that error.</p>

<p>Find bellow the configuration I have: </p>

<p><strong>build.gradle</strong></p>

<pre><code>compile group: 'postgresql', name: 'postgresql', version: '9.0-801.jdbc4'
</code></pre>

<p><strong>Hello.kt</strong></p>

<pre><code>object Pays : Table() {
val id = integer(""id"").autoIncrement().primaryKey() // Column
val name = varchar(""name"", 50) // Column
}

fun main(args: Array) {
Database.connect(""jdbc:postgresql://localhost/my_db"", driver = ""org.postgresql.Driver"", user = ""user"", password = ""password"")
</code></pre>

<p><strong>HERE IS THE ERROR I GOT</strong></p>

<pre><code>Caused by: org.postgresql.util.PSQLException: Transaction isolation level 4 not supported.
at org.postgresql.jdbc2.AbstractJdbc2Connection.setTransactionIsolation(AbstractJdbc2Connection.java:826)
at org.jetbrains.exposed.sql.transactions.ThreadLocalTransactionManager$ThreadLocalTransaction$connectionLazy$1.invoke(ThreadLocalTransactionManager.kt:25)
at org.jetbrains.exposed.sql.transactions.ThreadLocalTransactionManager$ThreadLocalTransaction$connectionLazy$1.invoke(ThreadLocalTransactionManager.kt:20)
at kotlin.UnsafeLazyImpl.getValue(Lazy.kt:154)
at org.jetbrains.exposed.sql.transactions.ThreadLocalTransactionManager$ThreadLocalTransaction.getConnection(ThreadLocalTransactionManager.kt:29)
at org.jetbrains.exposed.sql.Transaction.getConnection(Transaction.kt)
at org.jetbrains.exposed.sql.Database.getMetadata$exposed(Database.kt:17)
at org.jetbrains.exposed.sql.Database$url$2.invoke(Database.kt:26)
at org.jetbrains.exposed.sql.Database$url$2.invoke(Database.kt:15)
at kotlin.SynchronizedLazyImpl.getValue(Lazy.kt:131)
at org.jetbrains.exposed.sql.Database.getUrl(Database.kt)
at org.jetbrains.exposed.sql.Database$dialect$2.invoke(Database.kt:29)
at org.jetbrains.exposed.sql.Database$dialect$2.invoke(Database.kt:15)
at kotlin.SynchronizedLazyImpl.getValue(Lazy.kt:131)
at org.jetbrains.exposed.sql.Database.getDialect$exposed(Database.kt)
at org.jetbrains.exposed.sql.vendors.DefaultKt.getCurrentDialect(Default.kt:319)
at org.jetbrains.exposed.sql.vendors.DefaultKt.getCurrentDialectIfAvailable(Default.kt:323)
at org.jetbrains.exposed.sql.Column.getOnDelete$exposed(Column.kt:14)
</code></pre>
","5618911","","1033581","","2018-07-18 03:03:36","2019-10-07 12:12:38","postgresql Transaction isolation level 4 not supported","<postgresql><transactions><kotlin><ktor><kotlin-exposed>","2","2","","","","50322967","128262","128262","ktor","265","45915935","45915934"
"50708255","1","50725807","","2018-06-05 20:15:05","","2","1873","<p>I'm using ktor v0.9.2 and I want to send diferent content for the same route, based if the user is authenticated or not.</p>

<p>The problem I'm having is that I'm not being able to access the principal outside the <code>authenticate { }</code> block.</p>

<p>My setup is like this:</p>

<pre><code>data class User(
    val userId: Int
) : io.ktor.auth.Principal

fun Application.myApp() {
    install(Authentication) {
        jwt {
            verifier(JwtConfig.verifier)
            validate { credential -&gt;
                val userId = credential.payload.getClaim(""userId"").asInt()
                when {
                    userId &gt; 0 -&gt; User(userId)
                    else -&gt; null
                }
            }
        }
    }
    install(DefaultHeaders)
    install(CallLogging)
    install(ContentNegotiation) {
        jackson { }
    }
    install(Routing) {
        authenticate {
            get(""/protected"") {
                // This works fine!!
                val user = call.authentication.principal&lt;User&gt;()
                call.respond(user)
            }
        }

        get(""/"") {
            val user = call.authentication.principal&lt;User&gt;() // -&gt; User is always null here
            if (user == null) {
                call.respondText(""Not Logged User"")
            } else {
                call.respondText(""Logged User"")
            }
        }
    }
}
</code></pre>

<p>The <code>/protected</code> route works fine, but in the <code>/</code> route the principal is always null. I thinks this is some pipeline thing, but I am a little lost. Could someone give some insights? Thanks!</p>
","2770111","","2770111","","2018-06-07 18:35:07","2018-08-07 08:18:47","Ktor: How to check authentication inside a route handler?","<kotlin><ktor>","1","0","1","","","50708255","128262","128262","ktor","265","45915935","45915934"
"45199844","1","45253354","","2017-07-19 19:52:26","","0","93","<p>Downloading, installing and running the desktop app works as expected. When I go to the Lektor menu and select ""Install Shell Command"" there is a popup notifying me that installing the shell command requires admin rights. No matter if I click no or yes, nothing happens, no password request, nothing. </p>

<p>In the terminal, when I type</p>

<pre><code>lektor quickstart
</code></pre>

<p>I get</p>

<pre><code>-bash: lektor: command not found
</code></pre>

<p>macOS 10.12.5, Python 2.7 and 3.4 (Anaconda)</p>
","7836374","","7836374","","2017-07-22 10:17:45","2017-07-22 10:17:45","Lektor OS X desktop app install shell command fails when Anaconda is installed","<lektor>","1","2","","","","45199844","116940","116940","lektor","40","34631336","34631335"
"46021761","1","56819642","","2017-09-03 08:52:28","","0","69","<p>my first attemp in lektor: I want to create my own Data Model for architectural works record.
I have a wierd ouput for <code>checkboxes</code> and <code>lists</code> like:</p>

<pre><code>    [u'corporate &amp; commercial', u'interiors']
</code></pre>

<p>Where the  <code>poject.ini</code> is</p>

<pre><code>[fields.type]
label = Project type
type = checkboxes
choices = corporate &amp; commercial, residential, interiors, public,hotel/tourism, university, art gallery, restoration, spa, auditorium,  installations, landscape
choice_labels = corporate &amp; commercial, residential, interiors, public, hotel/tourism, university, art gallery, restoration, spa, auditorium,  installations, landscape
</code></pre>

<p>and the <code>project.html</code> has:</p>

<pre><code>{% if this.type %}
&lt;tr&gt;
&lt;th scope=""row""&gt;Type&lt;/th&gt;
&lt;td&gt;{{ this.type}}&lt;/td&gt;
&lt;/tr&gt;
{% endif %} 
</code></pre>

<p>Where are those <code>[u'</code> in the ouput coming from? What am I missing?</p>

<p>Thank you</p>

<p>AR
(running lektor 3.0.1 on win 7/64)</p>
","8554188","","","","","2019-06-30 10:36:06","lektor checkboxes `[u'` ouput error?","<list><checkbox><lektor>","2","0","","","","46021761","116940","116940","lektor","40","34631336","34631335"
"46097259","1","","","2017-09-07 13:08:53","","0","132","<p>I want to build a website, maybe similar to a movie database, where every page has, say, actors, director, year (it seems that Lektor can deal very well with such structured metadata), and I am thinking about how to realize internal links between pages on that site.</p>

<p>Say I have a text such as</p>

<blockquote>
  <p><code>just like in [his previous movie](link), he shows again ...</code></p>
</blockquote>

<p>then I guess I could use the absolute path of the linked page as link target, but that makes me very inflexible with respect to changing URL structure. Can I somehow just use the ID of the target content?</p>

<p>Or, better yet, can I somehow automatically obtain the title of the linked page?</p>

<blockquote>
  <p><code>just like in his previous movie &lt;&lt;link:title&gt;&gt;, he shows again ...</code></p>
</blockquote>

<p>Can I use the standard Markdown blocks for that or would I have to add some handcrafted database lookup logic?</p>
","3663881","","","","","2017-11-06 03:57:38","internal links in Lektor's markdown blocks","<content-management-system><markdown><lektor>","1","1","","","","46097259","116940","116940","lektor","40","34631336","34631335"
"48359074","1","","","2018-01-20 17:29:00","","0","96","<p>I need to generate a menu that lists all pages (like the <a href=""https://www.getlektor.com/docs/guides/sitemap/"" rel=""nofollow noreferrer"">sitemap sample</a>) but if a page has childs it should become only a toggle for its submenu, not linking to any page. Only the innermost childs will be pages.
E.G.:</p>

<ul>
<li>about (link)</li>
<li>portfolio (no link - only toggle)

<ul>
<li>work01 (link)</li>
<li>work02 (link)</li>
</ul></li>
<li>contacts (link)</li>
</ul>

<p>As I said, the summentioned sample creates and links a page also for ""portfolio"".
My site is here <a href=""http://andrearicci.it/projects/fendi-velabro/"" rel=""nofollow noreferrer"">andrearicci.it</a> (subpage) and the menu item ""projects"" now toggles the submenu, but I can't get rid of its link - so I had to format an unwanted 'projects summary' page.
On that page the menu is </p>

<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-html lang-html prettyprint-override""><code>&lt;nav&gt;
  &lt;ul class=""projlist""&gt;
    {% for project in site.get('/projects').children %}
      &lt;li{% if this == project %} class=""active""{% endif
        %}&gt;&lt;a href=""{{ project|url }}""&gt;{{ project.name }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
  &lt;/ul&gt;
&lt;/nav&gt;</code></pre>
</div>
</div>
</p>

<p>I wish an automatic solution, that could work also adding other page groups (e.g. paintings/web design/whatever) without the need of changing it every time.</p>

<p>Is it maybe more a question about Jinja other than Lektor?</p>

<p>Thank you for any help.</p>

<p>A.R.</p>
","8554188","","8554188","","2018-01-20 17:36:39","2018-02-09 12:48:29","lektor menu with links to child pages only, parents toggle submenu, without links","<menu><jinja2><submenu><lektor>","1","0","","","","48359074","116940","116940","lektor","40","34631336","34631335"
"50835601","1","","","2018-06-13 11:02:59","","1","201","<p>I tried to do unit test with Hoverfly to mock external API.</p>

<pre><code>companion object {
    @ClassRule @JvmField
    val hoverflyRule: HoverflyRule = HoverflyRule.inSimulationMode(dsl(
            service(""people.zoho.com"")
                    .get(""/people/api/forms/P_EmployeeView/records"").queryParam(""authtoken"",""TOKEN"")
                        .willReturn(success(""{test:test}"", ""application/json""))
    ))
}
</code></pre>

<p>When I use the Apache client with ktor, that doesn't work. But with another  client like khttp, it works. Any ideas why?</p>
","8186877","","6296561","","2018-06-13 11:05:09","2018-06-13 14:40:48","Hoverfly Ktor client Apache Kotlin","<kotlin><ktor><hoverfly>","1","1","","","","50835601","128262","128262","ktor","265","45915935","45915934"
"50901472","1","50965188","","2018-06-18 00:29:45","","5","2742","<p>I would love to understand better how Ktor is handling the routing for static content. I have the following hierarchy in my static folder (working directory):</p>

<pre><code>- static
 - index.html
 - (some files)
 - static
  - css (directory)
  - js (directory)
  - (some files)
</code></pre>

<p>I'd like to serve all of them. So I was using directly this code in <code>routing</code>:</p>

<pre><code>static {
  defaultResource(""index.html"", ""static"")
  resources(""static"")
}
</code></pre>

<p>Which works very well, but the issue is that it's taking the hand on all requests including my small <code>get</code>:</p>

<pre><code>get(""/smoketest""){
  call.respondText(""smoke test!"", ContentType.Text.Plain)
}
</code></pre>

<p>What would be the best to handle in general the static content in Ktor?</p>

<p><a href=""https://github.com/vpasquier/sprint-review/blob/feature-34-reactjs/sprint-review-server/src/main/kotlin/com/sprintreview/Server.kt#L34-L54"" rel=""noreferrer"">Here is the code</a></p>

<p>Thank you</p>
","4528920","","4528920","","2018-06-21 01:56:12","2018-07-12 06:50:49","Ktor - Static content routing","<kotlin><ktor>","1","4","1","","","50901472","128262","128262","ktor","265","45915935","45915934"
"51271993","1","51284560","","2018-07-10 18:32:45","","1","525","<p>Am building an API and using <code>intercept(ApplicationCallPipeline.Call){}</code> to run some logic before each route execution. I need to pass  data from the intercept() method to the called route and
am setting data by using <code>call.attributes.put()</code> in the intercept() like this:</p>

<p><code>val userKey= AttributeKey&lt;User&gt;(""userK"")
 call.attributes.put(userKey, userData)</code></p>

<p>And retrieve <strong>userData</strong> with <code>call.attributes[userKey]</code> .
What happens is that <code>call.attributes[userKey]</code> only works in the intercept() method where I have set the attribute. It doesn't work in the route where I need it.
It throws me 
<code>java.lang.IllegalStateException: No instance for key AttributeKey: userK</code></p>

<p>I wonder if am doing things in the right way</p>
","5324912","","1055395","","2018-07-10 18:36:14","2018-07-11 11:38:29","How to pass data between various parts of the pipeline in Ktor (Kotlin)","<kotlin><ktor>","1","0","","","","51271993","128262","128262","ktor","265","45915935","45915934"
"51449280","1","51454661","","2018-07-20 19:32:50","","4","3827","<p>I have data class defined, configured gson and created rout to handle post request as follows:</p>

<pre><code>data class PurchaseOrder(val buyer: String, val seller: String, 
val poNumber: String, val date: String,
                     val vendorReference: String)

 install(ContentNegotiation) {
    gson {
        setDateFormat(DateFormat.LONG)
        setPrettyPrinting()
    }


    post(""/purchaseOrder""){
        val po = call.receive&lt;PurchaseOrder&gt;()
        println(""purchase order: ${po.toString()}"")
        call.respondText(""post received"", contentType = 
        ContentType.Text.Plain)
</code></pre>

<p>the following JSON is sent in POST request</p>

<pre><code>{
""PurchaseOrder"" : {
""buyer"": ""buyer a"",
""seller"": ""seller A"",
""poNumber"": ""PO1234"",
""date"": ""27-Jun-2018"",
""vendorReference"": ""Ref1234""
}
}
</code></pre>

<p>The output shows all nulls.</p>

<pre><code>purchase order: PurchaseOrder(buyer=null, seller=null, poNumber=null, 
date=null, vendorReference=null)
</code></pre>

<p>Reading data from call.request.receiveChannel() does show correct JSON. So I am receiving the data but call.receive() does not seem to produce expected results.</p>

<p>Got JSON manually and tried to create PurchaseOrder as follows bu no luck:</p>

<pre><code>val channel = call.request.receiveChannel()
        val ba = ByteArray(channel.availableForRead)
        channel.readFully(ba)
        val s = ba.toString(Charset.defaultCharset())

        println(s) // prints JSON

        val gson = Gson()
        val po = gson.fromJson(s, PurchaseOrder::class.java)

        println(""buyer = ${po.buyer}""  //prints null
</code></pre>
","1848653","","5335131","","2018-07-21 16:53:20","2018-07-21 16:53:20","How to receive JSON object in Ktor?","<kotlin><gson><ktor>","1","0","","","","51449280","128262","128262","ktor","265","45915935","45915934"
"49383350","1","49383351","","2018-03-20 11:44:56","","1","127","<p>Installing Lektor using the curl command from getlektor.com appears to work and appropriate files are present in the <code>/usr/local/bin/</code> directory after the process completes. </p>

<p>However, <code>which lektor</code> shows nothing despite <code>/usr/local/bin</code> being in the path. </p>
","2244798","","","","","2018-03-20 11:44:56","Lektor installation fails on Mac OSX","<macos><installation><lektor>","1","0","","","","49383350","116940","116940","lektor","40","34631336","34631335"
"49674672","1","","","2018-04-05 14:19:17","","1","56","<p>In my Lektor website I create thumbnails of images attached to a content and would like to avoid the original images being copied to the output directory as well. Is there any way I can copy <em>only</em> the thumbnails?</p>
","3663881","","","","","2018-04-05 14:19:17","How to avoid copying original (unscaled) attached images?","<lektor>","0","0","","","","49674672","116940","116940","lektor","40","34631336","34631335"
"50497451","1","","","2018-05-23 21:05:42","","1","98","<p>I try to get started with Lektor CMS internals and would like to run it under the great Pycharm debugger. In particular I want to run </p>

<pre><code>$ lektor server
</code></pre>

<p>I followed the steps </p>

<pre><code>$ git clone https://github.com/lektor/lektor
$ cd lektor
$ virtualenv venv
$ . venv/bin/activate
$ pip install --editable .
$ make build-js
$ make install-git-hooks
$ export LEKTOR_DEV=1
$ lektor quickstart --path example-project
$ lektor --project example-project server
</code></pre>

<p>in the Github readme about development and they work just fine in the terminal. Then I created the following Pycharm debug-config:</p>

<p><a href=""https://i.stack.imgur.com/C3wCA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/C3wCA.png"" alt=""""></a></p>

<p>However this throws the following RuntimeException:</p>

<pre><code>Traceback (most recent call last):
  File ""/home/barrios/IDEs/pycharm-community-2018.1.1/helpers/pydev/pydevd.py"", line 1664, in &lt;module&gt;
    main()
  File ""/home/barrios/IDEs/pycharm-community-2018.1.1/helpers/pydev/pydevd.py"", line 1658, in main
    globals = debugger.run(setup['file'], None, None, is_module)
  File ""/home/barrios/IDEs/pycharm-community-2018.1.1/helpers/pydev/pydevd.py"", line 1085, in run
    runpy._run_module_as_main(module_name, alter_argv=False)
  File ""/usr/lib/python2.7/runpy.py"", line 174, in _run_module_as_main
    ""__main__"", fname, loader, pkg_name)
  File ""/usr/lib/python2.7/runpy.py"", line 72, in _run_code
    exec code in run_globals
  File ""/home/barrios/code/lektor/lektor/__main__.py"", line 3, in &lt;module&gt;
    main(as_module=True)
  File ""/home/barrios/code/lektor/lektor/cli.py"", line 627, in main
    cli.main(args=args, prog_name=name)
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/core.py"", line 697, in main
    rv = self.invoke(ctx)
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/core.py"", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/core.py"", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/core.py"", line 535, in invoke
    return callback(*args, **kwargs)
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/decorators.py"", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File ""/home/barrios/code/lektor/venv/local/lib/python2.7/site-packages/click/core.py"", line 535, in invoke
    return callback(*args, **kwargs)
  File ""/home/barrios/code/lektor/lektor/cli.py"", line 387, in server_cmd
    browse=browse)
  File ""/home/barrios/code/lektor/lektor/devserver.py"", line 124, in run_server
    dt.start()
  File ""/home/barrios/code/lektor/lektor/devserver.py"", line 75, in start
    portable_popen(['npm', 'install', '.'], cwd=admin).wait()
  File ""/home/barrios/code/lektor/lektor/utils.py"", line 486, in portable_popen
    raise RuntimeError('Could not locate executable ""%s""' % cmd[0])
RuntimeError: Could not locate executable ""npm""

Process finished with exit code 1
</code></pre>

<p>Obviously it can't find npm to init the Web-UI. When replacing the parameter 'server' with 'build', debugging works fine. Is it impossible to run this Javascript code via subprocess from inside Pycharm debugger?</p>

<p>Or what else am I doing wrong? Any ideas how to fix this? TNX in advance.</p>

<p>EDIT: I read in some other SO-thread Pycharm is probably running a subprocess under the system Python interpreter outside the virtualenv?!? This would explain why it messes up dependencies, but the npm command IS available anywhere on the system... So why is it not found???</p>
","3374676","","3374676","","2018-05-23 21:25:00","2018-12-20 19:58:22","Running 'lektor server' under Pycharm Debugger?","<python><debugging><pycharm><lektor>","0","0","1","","","50497451","116940","116940","lektor","40","34631336","34631335"
"51460977","1","51463145","","2018-07-21 23:59:48","","0","288","<p>I'm running unit tests with ktor testing engine and everything is perfect locally. However, once I deploy on Travis, tests are failing and it seems the test engine is not running properly:</p>

<ul>
<li><p><a href=""https://travis-ci.org/vpasquier/sprint-review/builds/406708799"" rel=""nofollow noreferrer"">https://travis-ci.org/vpasquier/sprint-review/builds/406708799</a> (see down the logs).</p></li>
<li><p>(<a href=""https://github.com/vpasquier/sprint-review/blob/master/sprint-review-server/src/test/kotlin/com/sprintreview/test/SmokeTestServer.kt#L18-L27"" rel=""nofollow noreferrer"">here is my simple test</a>)</p></li>
</ul>

<p>There is not enough info in trace mode unfortunately. (<code>&lt;logger name=""io.ktor.server.testing"" level=""TRACE""/&gt;</code>) </p>

<p>Do you know how we can activate more logs for investigating? Or if you have any other idea to fix it?</p>

<p>If you tell me that Travis is not out dated, not recommended, I can switch too.</p>

<p>Thank you </p>
","4528920","","","","","2018-07-22 08:03:16","Ktor Test Engine - Logging","<kotlin><ktor>","1","2","","","","51460977","128262","128262","ktor","265","45915935","45915934"
"51497715","1","","","2018-07-24 11:42:37","","0","115","<p>I'm using ktor for create rest api with kotlin but when i change api and run again response won't change. </p>

<p>This is my code</p>

<pre><code>fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, port = 8080) {
        routing {
            get(""/"") {
                call.respondText(""Hi"", ContentType.Text.Plain)
            }
        }
    }.start(wait = true)
}
</code></pre>

<p>When run it for the first time work correct and show in localhost:8080 </p>

<blockquote>
  <p>Hi</p>
</blockquote>

<p>But if i change </p>

<p><code>call.respondText(""Hi"", ContentType.Text.Plain)</code></p>

<p>to </p>

<p><code>call.respondText(""Hello"", ContentType.Text.Plain)</code></p>

<p>And run it again response no change and steel show <strong>Hi</strong> in localhost:8080 </p>

<p><strong>Update</strong></p>

<p>If i close android studio and open it again and run its work and show <strong>Hello</strong>  but again if i change anything nothing will be change</p>

<p>i don't have any idea to why this is happening.</p>
","6401241","","1235698","","2018-07-30 08:01:29","2018-07-30 08:01:29","Ktor api won't change and refresh","<android><kotlin><ktor>","1","1","","","","51497715","128262","128262","ktor","265","45915935","45915934"
"51703262","1","","","2018-08-06 08:15:01","","0","134","<p>I made a custom feature that should check the user's permissions to use the request. Can I monitor request LocationInfo?
Can this looks like that?</p>

<pre><code>if (!User.accessTo.contains(CALL_LOCATION_INFO)){
call.respond(HttpStatusCode.BadRequest) }
</code></pre>

<p>That`s my feature code:</p>

<pre><code>data class UserRights(
        val haveFullAccess:Boolean,
        val accessTo:List&lt;String&gt;,
        val canUpdate:Boolean,
        val canDelete:Boolean,
        val canBan:Boolean,
        val canMute:Boolean)

var User = UserRights(false, listOf(""""),false,false,false,false)

class RightsChecker(configuration: Configuration) {
    val prop = configuration.prop // get snapshot of config into immutable property
    class Configuration {
        var prop = ""value""
    }
    companion object Feature : ApplicationFeature&lt;ApplicationCallPipeline, Configuration, RightsChecker&gt; {
        override val key = AttributeKey&lt;RightsChecker&gt;(""RightsChecker"")
        override fun install(pipeline: ApplicationCallPipeline, configure: Configuration.() -&gt; Unit): RightsChecker {
            val configuration = RightsChecker.Configuration().apply(configure)
            val feature = RightsChecker(configuration)

            val FilterPhase = PipelinePhase(""CallFilter"")
            pipeline.insertPhaseAfter(ApplicationCallPipeline.Infrastructure, FilterPhase)

            pipeline.intercept(FilterPhase) {
                val session = call.sessions.get&lt;SessionData&gt;() ?: SessionData(0, ""Guest"")
                when (session.role) {
                    ""Guest"" -&gt; User = UserRights(
                            haveFullAccess = false,
                            accessTo = listOf(""""),
                            canUpdate = false,
                            canDelete = false,
                            canBan = false,
                            canMute = false)
                    ""User"" -&gt; User = UserRights(
                            haveFullAccess = false,
                            accessTo = listOf(""lUsers""),
                            canUpdate = false,
                            canDelete = false,
                            canBan = false,
                            canMute = false)                       
                    ""Admin"" -&gt; User = UserRights(
                            haveFullAccess = true,
                            accessTo = listOf(""lUsers""),
                            canUpdate = true,
                            canDelete = true,
                            canBan = true,
                            canMute = true)
                }
                if (!User.accessTo.contains(CALL_LOCATION_INFO)){
                    call.respond(HttpStatusCode.BadRequest)
                }
            }
            return feature
        }
    }
}
</code></pre>

<p>How you can see, I`m using UserRights data class with rights in it. ""accesTo"" - is list of location names (format can be changed) what user can use. Feature must just check location name contain in ""accesTo"" list before request processing.</p>

<p>Thank you for help! </p>

<p>UPD: Locations code:</p>

<pre><code>@Location(""/login"") data class lLoginData(val email:String, val password: String)
@Location(""/users"") data class lGetUsers(val page:Int, val limit:Int)
@Location(""/users/user"") data class lUser(val email: String)
@Location(""/users"") data class lUpdateData(val userID: Int, val datatype:String, val newData:String)
@Location(""/users"") data class lRegData(val email: String, val username:String, val userpass:String)
</code></pre>
","10185438","","10185438","","2018-08-08 09:05:08","2018-08-08 09:05:08","KTOR: How I can find Location Info before call processing?","<ktor>","1","0","","","","51703262","128262","128262","ktor","265","45915935","45915934"
"51092740","1","51119438","","2018-06-29 00:25:48","","2","107","<p>Using Lektor, trying to determine how to list the most recent three blogs by published date on the main landing (root) page. I'm feeling like I should be using a macro, but I don't understand how to pass the Blogs to the page template, or if this is an example of a flowblock? I've added a section like the following to the page.ini:</p>

<pre><code>[children]
model = blog-post
order_by = -pub_date, title
</code></pre>

<p>but can't seem to loop through them in the template (no error is thrown but doesn't iterate). Quite lost, but still consuming the documentation.</p>
","4872140","","","","","2018-07-01 00:03:14","Show recent blog activity on main page","<lektor>","1","0","","","","51092740","116940","116940","lektor","40","34631336","34631335"
"52163362","1","","","2018-09-04 09:41:46","","0","80","<p>I'm new to Lektor and I've been using this snippet in my layout to dynamically generate menus</p>

<pre><code>{% for content in site.get('/').children %}
    &lt;li&gt;&lt;a href=""{{ content|url(alt=alt) }}""&gt;{{ content.title }}&lt;/a&gt;&lt;/li&gt;
{% endfor %}
</code></pre>

<p>It works fine to produce the <code>alt</code> url accordingly to the alternative (language) selected, but the <code>title</code> is still shown only in the primary language of the content instead of the translated one.</p>

<p>That means that when a say french <code>alt</code> is selected (and present in the url), menus are still i.e. <code>Main</code>, <code>Contact</code> instead of the french translated version.</p>

<p>I know I can work around this using a databag to hold a language mapping for the menus, but that would require to duplicate the title information in the databag and then make sure it stays in sync with whatever is in <code>content.title</code>.</p>

<p>Ideally what I'm missing is a filter for <code>title</code> where you can specify the <code>alt</code> you want to use, or some other method that I'm not aware of?</p>
","2428196","","2428196","","2018-09-04 13:25:03","2018-09-10 05:43:22","Using alternative (translated) titles in dynamic menus in Lektor","<python-3.6><lektor>","1","0","","","","52163362","116940","116940","lektor","40","34631336","34631335"
"52695056","1","","","2018-10-08 03:33:51","","0","57","<p>My site is meant to be published by the continuous integration hook in my git server. The continuous integration script runs <code>lektor deploy</code>.</p>

<p>As such, I need the publish settings in my project file, but I don't like the peril of having an easily-acessible publish button that can be fat-fingered.</p>

<p>I don't see anything like that in the <a href=""https://www.getlektor.com/docs/cli/server/"" rel=""nofollow noreferrer"">command-line docs</a>. Is that not possible?</p>
","98029","","98029","","2018-10-30 20:07:31","2018-10-30 20:07:31","Hide ""publish"" button from dev server","<lektor>","1","0","","","","52695056","116940","116940","lektor","40","34631336","34631335"
"53439493","1","53439564","","2018-11-23 00:50:20","","1","187","<p>Lektor crashes on installation on Linux (Mint 19 and Raspbian-armv7l 2018-10) with a 'File not found error'</p>

<p><em>Python 2.7 and 3.5 are installed.<br>
    sudo apt-get install python-dev libssl-dev libffi-dev OK<br>
    sudo apt-get install imagemagick OK</em>  </p>

<pre><code>curl -sf https://www.getlektor.com/install.sh | sudo sh
This script will install Lektor on your computer.
Installing at:
  bin: /usr/local/bin
  app: /usr/local/lib/lektor
Continue? [Yn] y -&gt; CRASH !
/usr/bin/python: can't open file './virtualenv.py': [Errno 2] No such file or directory  
Traceback (most recent call last):   
File ""&lt;stdin&gt;"", line 148, in &lt;module&gt;  
File ""&lt;stdin&gt;"", line 143, in main
File ""&lt;stdin&gt;"", line 107, in install
File ""/usr/lib/python2.7/subprocess.py"", line 390, in __init__
errread, errwrite)
File ""/usr/lib/python2.7/subprocess.py"", line 1024, in _execute_child
raise child_exception
</code></pre>

<p>OSError: [Errno 2] No such file or directory</p>
","10693316","","14167","","2019-06-03 14:22:20","2019-06-03 14:22:20","Lektor installation fails on Linux","<pip><lektor>","1","1","","","","53439493","116940","116940","lektor","40","34631336","34631335"
"58224853","1","","","2019-10-03 18:20:51","","0","133","<p>When running lektor server to deploy and see my website, it reports markdown is absent, while it is installed.</p>

<pre><code>/usr/local/lib/lektor/lib/python3.7/site-packages/watchdog/utils/bricks.py:175: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working

  class OrderedSet(collections.MutableSet):
Traceback (most recent call last):

...

  File ""/home/nick/swingrock.be/lektor/packages/tipue-content-file-generator/lektor_tipue_content_file_generator.py"", line 7, in &lt;module&gt;
    import markdown

ModuleNotFoundError: No module named 'markdown'
</code></pre>

<p>but markdown is installed, you can see the version here</p>

<pre><code>nick@nick-VirtualBox:~/swingrock.be/lektor$ markdown --version

This is Markdown, version 1.0.1.
Copyright 2004 John Gruber
http://daringfireball.net/projects/markdown/

</code></pre>

<p>Are there any steps I'm missing?</p>
","11566377","","","","","2019-10-03 20:28:43","ModuleNotFoundError: No module named 'markdown' when running lektor server","<python><python-3.x><markdown><lektor>","1","0","","","","58224853","116940","116940","lektor","40","34631336","34631335"
"51798894","1","51816524","","2018-08-11 10:47:51","","0","439","<p>In a Ktor 0.9.3 application, I want to have different <code>.conf</code> files for different environments, where I extend one main <code>.conf</code> file. However, I am getting the following exception:</p>

<pre><code>Exception in thread ""main"" com.typesafe.config.ConfigException$NotResolved: called valueType() on value with unresolved substitutions, need to Config#resolve() first, see API docs
    at com.typesafe.config.impl.ConfigDelayedMerge.valueType(ConfigDelayedMerge.java:46)
    at com.typesafe.config.impl.SimpleConfig.hasPath(SimpleConfig.java:96)
    at io.ktor.config.HoconApplicationConfigKt.tryGetString(HoconApplicationConfig.kt:33)
    at io.ktor.server.engine.CommandLineKt$commandLineEnvironment$environment$1.invoke(CommandLine.kt:64)
    at io.ktor.server.engine.CommandLineKt$commandLineEnvironment$environment$1.invoke(CommandLine.kt)
    at io.ktor.server.engine.ApplicationEngineEnvironmentBuilder.build(ApplicationEngineEnvironment.kt:55)
    at io.ktor.server.engine.ApplicationEngineEnvironmentKt.applicationEngineEnvironment(ApplicationEngineEnvironment.kt:38)
    at io.ktor.server.engine.CommandLineKt.commandLineEnvironment(CommandLine.kt:50)
    at io.ktor.server.netty.DevelopmentEngine.main(DevelopmentEngine.kt:13)
    at ApplicationKt.main(application.kt:24)
</code></pre>

<p>This is my <code>application.conf</code> file:</p>

<pre><code>ktor {
    deployment {
        port = 8080
        port = ${?PORT}
        watch = [ website ]
    }
    application {
        modules = [ ApplicationKt.module ]
    }
}

ui {
  hotreload {
    enabled = false
    path-prefix = ""http://localhost:3000""
  }
}
</code></pre>

<p>And the one extending it that I want to use:</p>

<pre><code>include ""application.conf""

ui.hotreload.enabled = true
</code></pre>

<p>Any ideas what is going wrong and how to fix it?</p>
","1392623","","","","","2018-08-13 06:44:28","Importing another configuration file in Ktor 0.9.3 throws exception","<kotlin><typesafe-config><ktor>","1","0","","","","51798894","128262","128262","ktor","265","45915935","45915934"
"52260009","1","","","2018-09-10 14:26:20","","1","1113","<p>How can i make Ktor feature to get content from ApplicationCall context before routing feature?
Main goal is to get, but not consume, so that all next interceptors can use it.</p>

<p>If we are going something like this in :</p>

<pre><code>pipeline.intercept(ApplicationCallPipeline.Call) {
                feature.intercept(this)
                val content = call.receiveText()
                proceed()
            }
</code></pre>

<p>or like this </p>

<pre><code>pipeline.intercept(ApplicationCallPipeline.Call) {
            val params = this.call.receiveParameters().entries()
            proceed()
        }
</code></pre>

<p>We will have this next step:</p>

<pre><code>java.io.IOException: Broken delimiter occurred
at kotlinx.coroutines.experimental.io.DelimitedKt$skipDelimiterSuspend$2.doResume(Delimited.kt:57)
at kotlinx.coroutines.experimental.io.DelimitedKt$skipDelimiterSuspend$2.invoke(Delimited.kt)
at kotlinx.coroutines.experimental.io.DelimitedKt$skipDelimiterSuspend$2.invoke(Delimited.kt)
at kotlinx.coroutines.experimental.io.ByteBufferChannel.lookAheadSuspend(ByteBufferChannel.kt:1746)
at kotlinx.coroutines.experimental.io.DelimitedKt.skipDelimiterSuspend(Delimited.kt:55)
at kotlinx.coroutines.experimental.io.DelimitedKt.skipDelimiter(Delimited.kt:50)
at io.ktor.http.cio.MultipartKt.boundary(Multipart.kt:89)
at io.ktor.http.cio.MultipartKt$parseMultipart$1.doResume(Multipart.kt:158)
at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resume(CoroutineImpl.kt:42)
at kotlinx.coroutines.experimental.DispatchedKt.resumeCancellable(Dispatched.kt:209)
at kotlinx.coroutines.experimental.intrinsics.CancellableKt.startCoroutineCancellable(Cancellable.kt:35)
at kotlinx.coroutines.experimental.CoroutineStart.invoke(CoroutineStart.kt:111)
at kotlinx.coroutines.experimental.AbstractCoroutine.start(AbstractCoroutine.kt:165)
at kotlinx.coroutines.experimental.channels.ProduceKt.produce(Produce.kt:95)
at kotlinx.coroutines.experimental.channels.ProduceKt.produce$default(Produce.kt:88)
at io.ktor.http.cio.MultipartKt.parseMultipart(Multipart.kt:145)
at io.ktor.http.cio.MultipartKt.parseMultipart(Multipart.kt:138)
at io.ktor.http.cio.CIOMultipartDataBase.&lt;init&gt;(CIOMultipartData.kt:33)
at io.ktor.http.cio.CIOMultipartDataBase.&lt;init&gt;(CIOMultipartData.kt:31)
at io.ktor.server.engine.DefaultTransformKt.multiPartData(DefaultTransform.kt:70)
at io.ktor.server.engine.DefaultTransformKt.access$multiPartData(DefaultTransform.kt:1)
at io.ktor.server.engine.DefaultTransformKt$installDefaultTransformations$2.doResume(DefaultTransform.kt:44)
at io.ktor.server.engine.DefaultTransformKt$installDefaultTransformations$2.invoke(DefaultTransform.kt)
at io.ktor.server.engine.DefaultTransformKt$installDefaultTransformations$2.invoke(DefaultTransform.kt)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.pipeline.Pipeline.execute(Pipeline.kt:22)
at io.ktor.request.ApplicationReceiveFunctionsKt.receive(ApplicationReceiveFunctions.kt:64)
at accreditation.controller.RequisitesRoutingKt$requisites$1$1.doResume(RequisitesRouting.kt:54)
at accreditation.controller.RequisitesRoutingKt$requisites$1$1.invoke(RequisitesRouting.kt)
at accreditation.controller.RequisitesRoutingKt$requisites$1$1.invoke(RequisitesRouting.kt)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.pipeline.Pipeline.execute(Pipeline.kt:22)
at io.ktor.routing.Routing.executeResult(Routing.kt:100)
at io.ktor.routing.Routing.interceptor(Routing.kt:25)
at io.ktor.routing.Routing$Feature$install$1.doResume(Routing.kt:66)
at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt:51)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at accreditation.utils.logging.RequestLogger$Feature$install$1.doResume(RequestLogger.kt:80)
at accreditation.utils.logging.RequestLogger$Feature$install$1.invoke(RequestLogger.kt)
at accreditation.utils.logging.RequestLogger$Feature$install$1.invoke(RequestLogger.kt:66)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.features.ContentNegotiation$Feature$install$1.doResume(ContentNegotiation.kt:60)
at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt:50)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.features.StatusPages.intercept(StatusPages.kt:55)
at io.ktor.features.StatusPages$Feature$install$1.doResume(StatusPages.kt:84)
at io.ktor.features.StatusPages$Feature$install$1.invoke(StatusPages.kt)
at io.ktor.features.StatusPages$Feature$install$1.invoke(StatusPages.kt:78)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.features.CallLogging$Feature$install$1.doResume(CallLogging.kt:69)
at io.ktor.features.CallLogging$Feature$install$1.invoke(CallLogging.kt)
at io.ktor.features.CallLogging$Feature$install$1.invoke(CallLogging.kt:61)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.pipeline.Pipeline.execute(Pipeline.kt:22)
at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.doResume(DefaultEnginePipeline.kt:66)
at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invoke(DefaultEnginePipeline.kt)
at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invoke(DefaultEnginePipeline.kt)
at io.ktor.pipeline.PipelineContext.proceed(PipelineContext.kt:49)
at io.ktor.pipeline.Pipeline.execute(Pipeline.kt:22)
at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.doResume(NettyApplicationCallHandler.kt:31)
at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invoke(NettyApplicationCallHandler.kt)
at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invoke(NettyApplicationCallHandler.kt:10)
at kotlinx.coroutines.experimental.intrinsics.UndispatchedKt.startCoroutineUndispatched(Undispatched.kt:44)
at kotlinx.coroutines.experimental.CoroutineStart.invoke(CoroutineStart.kt:113)
at kotlinx.coroutines.experimental.AbstractCoroutine.start(AbstractCoroutine.kt:165)
at kotlinx.coroutines.experimental.BuildersKt__Builders_commonKt.launch(Builders.common.kt:72)
at kotlinx.coroutines.experimental.BuildersKt.launch(Unknown Source)
at kotlinx.coroutines.experimental.BuildersKt__Builders_commonKt.launch$default(Builders.common.kt:64)
at kotlinx.coroutines.experimental.BuildersKt.launch$default(Unknown Source)
at io.ktor.server.netty.NettyApplicationCallHandler.handleRequest(NettyApplicationCallHandler.kt:22)
at io.ktor.server.netty.NettyApplicationCallHandler.channelRead(NettyApplicationCallHandler.kt:16)
at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:38)
at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:353)
at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)
at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)
at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:463)
at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884)
at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
at java.lang.Thread.run(Thread.java:748)
</code></pre>

<p>Main idea is to log request content (if it is Json or UrlEncoded) before it is processed in routing feature and to log every response content too.</p>
","7419749","","7419749","","2018-09-10 14:49:40","2020-01-01 10:36:09","Get content of Ktor http request","<kotlin><request><ktor>","2","2","1","","","52260009","128262","128262","ktor","265","45915935","45915934"
"52544123","1","52544927","","2018-09-27 19:46:02","","0","779","<p>I want to use library <code>kotlin-html</code> to produce html instead of kotlinx.html. 
This library produces just a html-text:</p>

<pre><code>p(""A paragraph"").render()
// =&gt; &lt;p&gt;A paragraph&lt;/p&gt;
</code></pre>

<p>but I can't find how to respond html instead of text using Ktor</p>

<pre><code>fun Routing.root() {
    get(""/"") {
        call.respondText {""&lt;p&gt;A paragraph&lt;/p&gt;""}
    }
}
</code></pre>

<p>This code will produce a page with text <code>&lt;p&gt;A paragraph&lt;/p&gt;</code> instead of html-page. And it seems that <code>call.respondHtml</code> only works with kotlinx.html DSL. How can I do this using plain text?</p>
","5008606","","5008606","","2018-09-28 04:48:32","2018-09-28 04:48:32","Kotlin: Ktor how to respond text as html","<kotlin><ktor>","2","0","","","","52544123","128262","128262","ktor","265","45915935","45915934"
"52623482","1","","","2018-10-03 09:07:46","","3","185","<p>When using ktor CIO ws it works as expected, but when using wss it gets closed immediately. Any help is greatly appreciated. been stuck for a day now.</p>

<p>This is the stack trace I'm getting for wss</p>

<pre><code>kotlinx.coroutines.experimental.channels.ClosedReceiveChannelException: Channel was closed
    at kotlinx.coroutines.experimental.channels.Closed.getReceiveException(AbstractChannel.kt:1067)
    at kotlinx.coroutines.experimental.channels.AbstractChannel$ReceiveElement.resumeReceiveClosed(AbstractChannel.kt:907)
    at kotlinx.coroutines.experimental.channels.AbstractSendChannel.helpClose(AbstractChannel.kt:317)
    at kotlinx.coroutines.experimental.channels.AbstractSendChannel.close(AbstractChannel.kt:254)
    at kotlinx.coroutines.experimental.channels.ChannelCoroutine.close(ChannelCoroutine.kt)
    at kotlinx.coroutines.experimental.channels.SendChannel$DefaultImpls.close$default(Channel.kt:84)
    at io.ktor.network.tls.TLSClientHandshake$input$1.doResume(TLSClientHandshake.kt:96)
    at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resumeWithException(CoroutineImpl.kt:48)
    at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resumeWithException(CoroutineImpl.kt:47)
    at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resume(CoroutineImpl.kt:41)
    at kotlinx.coroutines.experimental.DispatchedTask$DefaultImpls.run(Dispatched.kt:149)
    at kotlinx.coroutines.experimental.io.internal.MutableDelegateContinuation.run(MutableDelegateContinuation.kt:14)
    at io.ktor.network.util.IOCoroutineDispatcher$IODispatchedTask.run(IOCoroutineDispatcher.kt)
    at io.ktor.network.util.IOCoroutineDispatcher$IOThread$run$1.doResume(IOCoroutineDispatcher.kt:73)
    at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resume(CoroutineImpl.kt:42)
    at kotlinx.coroutines.experimental.DispatchedTask$DefaultImpls.run(Dispatched.kt:149)
    at kotlinx.coroutines.experimental.DispatchedContinuation.run(Dispatched.kt:13)
    at kotlinx.coroutines.experimental.EventLoopBase.processNextEvent(EventLoop.kt:140)
    at kotlinx.coroutines.experimental.BlockingCoroutine.joinBlocking(Builders.kt:70)
    at kotlinx.coroutines.experimental.BuildersKt__BuildersKt.runBlocking(Builders.kt:46)
    at kotlinx.coroutines.experimental.BuildersKt.runBlocking(Unknown Source)
    at io.ktor.network.util.IOCoroutineDispatcher$IOThread.run(IOCoroutineDispatcher.kt:68)
</code></pre>

<p>here's the code:</p>

<pre><code>httpClient.ws(host = ""echo.websocket.org"") {
  send(Frame.Text(""Hello World""))

  for (message in incoming.map { it as? Frame.Text }.filterNotNull()) {
    println(message.readText())
  }
}

httpClient.wss(host = ""echo.websocket.org"") {
  send(Frame.Text(""Hello World""))

  for (message in incoming.map { it as? Frame.Text }.filterNotNull()) {
    println(message.readText())
  }
}
</code></pre>
","7994539","","7994539","","2018-10-03 22:55:12","2018-10-03 22:55:12","Ktor CIO wss socket closes immediately","<websocket><kotlin><ktor>","0","0","","","","52623482","128262","128262","ktor","265","45915935","45915934"
"52651601","1","","","2018-10-04 16:33:06","","1","512","<p>I have table song and table genre. Song can contains more genres. So I want reference genreIds from table genre. How I can reference to array of foreign keys in jetbrains.exposed.sql? 
For single reference is syntax <code>(integer(""genre_id"") references GenreTable.id)</code>. Any idea?</p>

<pre><code>object SongTable : Table() {
    val id       = integer(""id"").primaryKey().autoIncrement()
    val name     = text(""name"")
    val genreIds = (integer(""genre_id"") references GenreTable.id) //THERE I WANT MORE IDS 
}

object GenreTable : Table() {
    val id    = integer(""id"").primaryKey().autoIncrement()
    val logo  = text(""logo"")
}
</code></pre>
","2244495","","","","","2018-10-05 12:24:17","Reference to array of foreign keys jetbrains.exposed.sql","<sql><kotlin><jetbrains-ide><ktor><kotlin-exposed>","0","2","","","","52651601","128262","128262","ktor","265","45915935","45915934"
"52652549","1","","","2018-10-04 17:39:41","","0","268","<p>I'm using ktor 0.9.5. I'm trying a simple example. But when a try to connect to the server i get ERR_EMPTY_RESPONSE. This is my code.</p>

<pre><code>fun main(args: Array&lt;String&gt;) {
    embeddedServer(Netty, port = 8080, host = ""localhost"") {
        install(DefaultHeaders)
        install(CallLogging)
        routing {
            get(path = ""/"") {
                call.respondText(""Hello World!!"")
            }

        }
    }.start()
}
</code></pre>

<p>Doing some research I found that changing the project to Maven fix the problem, but because of rules of my organization I can't do it. Any other solution... Thanks before hand.</p>

<p>I have added a <code>println(""sometext"")</code> before <code>call.respondText(""Hello World!!"")</code> and it's never executed. </p>
","10386231","","10386231","","2018-10-05 18:35:48","2018-10-22 10:26:47","Ktor Netty Server sending an empty response","<kotlin><netty><ktor>","1","3","","","","52652549","128262","128262","ktor","265","45915935","45915934"
"52654215","1","52854883","","2018-10-04 19:54:13","","3","1988","<p>Ktor's HttpClient allows <a href=""http://ktor.io/clients/http-client/calls/requests.html#specifying-a-body-for-requests"" rel=""nofollow noreferrer"">installing a Json feature</a>.  Does anyone know if this feature can use <a href=""https://github.com/Kotlin/kotlinx.serialization"" rel=""nofollow noreferrer"">kotlinx.serialization library</a> or is it only limited to Gson?  I'm interested in enabling the Json feature for <a href=""https://kotlinlang.org/docs/reference/multiplatform.html"" rel=""nofollow noreferrer"">MPP</a> projects.  </p>
","1224600","","1000551","","2019-12-19 08:02:03","2019-12-19 08:02:03","Can Ktor HttpClient JsonFeature use kotlinx.serialization","<kotlin><ktor><kotlinx.serialization>","1","1","2","","","52654215","128262","128262","ktor","265","45915935","45915934"
"52813746","1","","","2018-10-15 09:35:49","","0","238","<p>I am following instructions on this help page: <a href=""https://ktor.io/advanced/pipeline/route.html"" rel=""nofollow noreferrer"">https://ktor.io/advanced/pipeline/route.html</a></p>

<p>They give this example:</p>

<pre><code>fun Route.routeTimeout(time: Long, unit: TimeUnit = TimeUnit.SECONDS, callback: Route.() -&gt; Unit): Route {
    // With createChild, we create a child node for this received Route  
    val routeWithTimeout = this.createChild(object : RouteSelector(1.0) {
        override fun evaluate(context: RoutingResolveContext, segmentIndex: Int): RouteSelectorEvaluation =
            RouteSelectorEvaluation.Constant
    })

    // Intercepts calls from this route at the features step
    routeWithTimeout.intercept(ApplicationCallPipeline.Features) {
        withTimeout(time, unit) {
            proceed() // With proceed we can define code to be executed before and after the call
        }
    }

    // Configure this route with the block provided by the user
    callback(routeWithTimeout)

    return routeWithTimeout
}
</code></pre>

<p>I want to modify it so that is could hold state. For example, each next caller gets a bigger timeout. Where do I put my state?</p>
","3144601","","3144601","","2018-10-15 09:43:50","2018-10-17 19:21:19","State in Ktor Intercepters","<kotlin><ktor>","1","0","","","","52813746","128262","128262","ktor","265","45915935","45915934"
"52844194","1","","","2018-10-16 21:20:37","","1","218","<p>I have a Ktor application (in Kotlin) and would like the endpoints to be exposed according to the JSON:API specification. I understand my library options are between the Java server libraries for JSON:API, i.e. <a href=""https://katharsis-jsonapi.readthedocs.io/en/latest/"" rel=""nofollow noreferrer"">Katharsis</a> (which gives code examples for Dropwizard, Spring Boot etc.) and <a href=""http://www.crnk.io/"" rel=""nofollow noreferrer"">Crnk</a> (which gives example for Spring Boot). I have tried a bit with Katharsis but it's not clear to me how the ResourceRepositoryV2 class should be registered/exposed by the Ktor application.</p>

<p>Any examples or pointers?</p>
","6169266","","","","","2018-10-16 21:20:37","Using a JSON-API server library in a Ktor application","<kotlin><json-api><ktor>","0","0","","","","52844194","128262","128262","ktor","265","45915935","45915934"
"52899531","1","","","2018-10-19 20:32:32","","0","121","<p>We're currently using <a href=""https://github.com/jasync-sql/jasync-sql"" rel=""nofollow noreferrer"">jasync-sql</a> PostgreSQL async library in a Ktor service and we're getting:</p>

<pre><code>14:02:20.005 [DefaultDispatcher-worker-1] ERROR com.github.jasync.sql.db.postgresql.PostgreSQLConnection - Can't run query because there is one query pending already
14:02:20.008 [nettyCallPool-4-1] ERROR Application - Unhandled: GET - /api/customer_book_list
com.github.jasync.sql.db.exceptions.ConnectionStillRunningQueryException: &lt;1&gt; - There is a query still being run here - race -&gt; false
        at com.github.jasync.sql.db.postgresql.PostgreSQLConnection.notReadyForQueryError(PostgreSQLConnection.kt:297)
        at com.github.jasync.sql.db.postgresql.PostgreSQLConnection.validateIfItIsReadyForQuery(PostgreSQLConnection.kt:305)
        at com.github.jasync.sql.db.postgresql.PostgreSQLConnection.validateQuery(PostgreSQLConnection.kt:312)
        at com.github.jasync.sql.db.postgresql.PostgreSQLConnection.sendPreparedStatement(PostgreSQLConnection.kt:133)
        at util.PostgresClient$sendPreparedStatement$2.doResume(PostgresClient.kt:19)
        at kotlin.coroutines.experimental.jvm.internal.CoroutineImpl.resume(CoroutineImpl.kt:42)
        at kotlinx.coroutines.experimental.DispatchedTask$DefaultImpls.run(Dispatched.kt:168)
        at kotlinx.coroutines.experimental.DispatchedContinuation.run(Dispatched.kt:13)
        at kotlinx.coroutines.experimental.scheduling.Task.run(Tasks.kt:94)
        at kotlinx.coroutines.experimental.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:567)
        at kotlinx.coroutines.experimental.scheduling.CoroutineScheduler.access$runSafely(CoroutineScheduler.kt:60)
        at kotlinx.coroutines.experimental.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:713)
</code></pre>

<p>Do we have to open a connection for each request? Or maybe the configuration is wrong?</p>
","411965","","","","","2018-10-19 20:32:32","Error when executing query with jasync-sql: ""Can't run query because there is one query pending already""","<java><kotlin><ktor><jasync-sql>","1","0","","","","52899531","128262","128262","ktor","265","45915935","45915934"
"52910776","1","52910984","","2018-10-20 22:59:04","","2","148","<h2>Issue</h2>

<p>I've followed this clear and concise <a href=""https://cloud.google.com/community/tutorials/kotlin-ktor-app-engine-java8"" rel=""nofollow noreferrer"">Ktor tutorial</a>. Now that I have successfully deployed to AppEngine <strong>I would like to manually set the version of future deploys</strong>. </p>

<p>Google's documentation of the <a href=""https://cloud.google.com/appengine/docs/standard/java/config/appref"" rel=""nofollow noreferrer"">appengine-web.xml</a> file indicates the <code>&lt;version&gt;</code> tag can be utilized for this purpose, but also states that the <code>&lt;version&gt;</code> tag is <em>unused for Cloud SDK based tooling</em>. I attempted to set the tag and confirmed this value is not being used when deployed to AppEngine.</p>

<h2>Attempted Solutions</h2>

<p>Looked for way to define AppEngine version in the following files:</p>

<ol>
<li><em>web.xml</em></li>
<li><em>application.conf</em></li>
</ol>

<p>Setting <strong>id:</strong>       </p>

<pre><code>ktor {    
    application {
        modules = [InitializationKt.main]
        id = ""coinverse-price-staging""
    }
}
</code></pre>

<ol start=""3"">
<li>Searching for way to define in AppEngine deploy command.</li>
</ol>

<p><a href=""https://i.stack.imgur.com/gkbft.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/gkbft.png"" alt=""enter image description here""></a></p>
","2253682","","2253682","","2018-10-20 23:26:32","2018-10-20 23:45:34","Deploying With Ktor: How To Set AppEngine Version?","<google-app-engine><kotlin><google-cloud-platform><ktor>","1","0","1","","","52910776","128262","128262","ktor","265","45915935","45915934"
"52917703","1","","","2018-10-21 16:53:07","","2","207","<pre><code>import io.ktor.application.call
import io.ktor.http.ContentType
import io.ktor.response.respondText
import io.ktor.routing.get
import io.ktor.routing.routing
import io.ktor.server.engine.embeddedServer
import io.ktor.server.netty.Netty

fun main(args: Array&lt;String&gt;) {
    val server = embeddedServer(Netty, port = 8080) {
        routing {
            get(""/"") {
                call.respondText(""Hello World!"", ContentType.Text.Plain)
            }
            get(""/demo"") {
                call.respondText(""HELLO WORLD!"")
            }
        }
    }
    server.start(wait = true)
}
</code></pre>

<hr>

<pre><code>Error:Kotlin: [Internal Error] java.lang.IllegalStateException: Backend Internal error: Exception during code generation
Cause: Back-end (JVM) Internal error: Error type encountered: [ERROR : For SuccessOrFailure] (ErrorType).
Cause: Error type encountered: [ERROR : For SuccessOrFailure] (ErrorType).
File being compiled at position: (12,22) in /Users/mac/Downloads/xoxoxo-server/src/main/kotlin/Main.kt
The root cause was thrown at: KotlinTypeMapper.java:114
File being compiled at position: file:///Users/mac/Downloads/xoxoxo-server/src/main/kotlin/Main.kt
</code></pre>
","2179276","","6296561","","2018-10-21 16:53:31","2018-10-21 16:53:31","kotlin ktor sample not starting","<kotlin><ktor>","0","3","1","","","52917703","128262","128262","ktor","265","45915935","45915934"
"52922552","1","53575063","","2018-10-22 04:45:41","","3","392","<h1>Issue</h1>

<p>When deploying a <strong>Ktor</strong> Kotlin application to AppEngine per the <a href=""https://cloud.google.com/community/tutorials/kotlin-ktor-app-engine-java8"" rel=""nofollow noreferrer"">Ktor tutorial</a>, the Firestore server authentication is not working, thus data is not being written to the specified Firestore database. </p>

<p>Data is written as expected to Firestore both when the app is run directly in the IntelliJ IDE as well as when it is run with <strong>ktor</strong>'s implementation via the <code>gradle appengineRun</code> command.</p>

<p>There are two sets of AppEngine/Firebase projects for both a <em>staging</em> and <em>production</em> environment. Prior to deploying with the <code>gradle appengineDeploy</code> command the correct SDK configuration been activated and verified via the command <code>gcloud config configurations list.</code></p>

<p><a href=""https://i.stack.imgur.com/5stVc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/5stVc.png"" alt=""enter image description here""></a></p>

<p>The strange part is that a few of the apps deployed with these strategies did write to Firestore, however upon deploying the app again Firestore did not show new data being written to it.</p>

<h1>Implementation</h1>

<h2>Ktor Setup</h2>

<p>I have the standard <strong>ktor</strong> required files. I also have an old <em>MANIFEST.MF</em> file from an older implementation. Could that be causing issues?</p>

<p><em>src/main/resources/application.conf</em></p>

<pre><code>ktor {
  application {
  modules = [ Initialization.main ]
  }
}
</code></pre>

<p><em>src/main/resources/webapp/WEB-INF/</em></p>

<p><em>appengine-web.xml</em></p>

<pre><code>&lt;?xml version=""1.0"" encoding=""utf-8""?&gt;
&lt;appengine-web-app xmlns=""http://appengine.google.com/ns/1.0""&gt;
    &lt;threadsafe&gt;true&lt;/threadsafe&gt;
    &lt;runtime&gt;java8&lt;/runtime&gt;
&lt;/appengine-web-app&gt;
</code></pre>

<p><em>web.xml</em></p>

<pre><code>&lt;?xml version=""1.0"" encoding=""ISO-8859-1"" ?&gt;
&lt;web-app xmlns=""http://java.sun.com/xml/ns/javaee"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"" version=""3.0""&gt;
&lt;servlet&gt;
    &lt;display-name&gt;KtorServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;KtorServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;io.ktor.server.servlet.ServletApplicationEngine&lt;/servlet-class&gt;
    &lt;!-- path to application.conf file, required --&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;io.ktor.config&lt;/param-name&gt;
        &lt;param-value&gt;application.conf&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;KtorServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

<p></p>

<p><em>logging.properties</em></p>

<p><code>.level = INFO</code></p>

<p><em>src/main/META-INF/MANIFEST>MF</em></p>

<pre><code>Manifest-Version: 1.0
Main-Class: Initialization
</code></pre>

<h2>Dependencies</h2>

<p>For authentication strategies outlined below <strong>#1-3</strong> the Firebase Admin library is used: <code>compile 'com.google.firebase:firebase-admin:6.5.0'</code></p>

<p>For authentication strategy <strong>#4</strong> the Google Cloud Firestore library is used: <code>compile 'com.google.cloud:google-cloud-firestore:0.58.0-beta'</code></p>

<p><strong>build.gradle</strong></p>

<pre><code>group 'coinverse'
version '1.0-SNAPSHOT'

buildscript {
    ext.kotlin_version = '1.2.61'
    ext.junitJupiterVersion  = '5.0.3'
    ext.ktor_version = '0.9.4'
    ext.appengine_version = '1.9.60'
    ext.appengine_plugin_version = '1.3.4'

repositories {
    mavenCentral()
    jcenter()
}
dependencies {
    classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.3'
    classpath ""com.google.cloud.tools:appengine-gradle-plugin:$appengine_plugin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'war'
apply plugin: 'com.google.cloud.tools.appengine'

sourceSets {
    main.kotlin.srcDirs = [ 'src/main/kotlin' ]
}

sourceCompatibility = 1.8

repositories {
mavenCentral()
jcenter()
maven { url ""https://kotlin.bintray.com/ktor"" }
}

dependencies {
    implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    testCompile group: 'junit', name: 'junit', version: '4.12'
    testCompile(""org.junit.jupiter:junit-jupiter-api:${junitJupiterVersion}"")
        testRuntime(""org.junit.jupiter:junit-jupiter-engine:${junitJupiterVersion}"")
        testCompile(""org.assertj:assertj-core:3.10.0"")
        testCompileOnly('org.apiguardian:apiguardian-api:1.0.0')
        compile 'com.squareup.retrofit2:retrofit:2.3.0'
        compile 'com.squareup.retrofit2:converter-gson:2.3.0'
        compile 'com.squareup.retrofit2:adapter-rxjava:2.3.0'
        compile 'io.reactivex.rxjava2:rxjava:2.2.0'
        compile 'com.google.cloud:google-cloud-firestore:0.58.0-beta'
        // Or compile 'com.google.cloud:google-cloud-firestore:0.58.0-beta'
        compile 'com.google.firebase:firebase-admin:6.5.0'
        compile ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
        compile ""io.ktor:ktor-server-servlet:$ktor_version""
        compile ""io.ktor:ktor-html-builder:$ktor_version""
        providedCompile ""com.google.appengine:appengine:$appengine_version""
}

kotlin.experimental.coroutines = 'enable'

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}

task run(dependsOn: appengineRun)

appengine {
    deploy {
        version = 'price-staging-1021653pm'
        stopPreviousVersion = false
    }
}
</code></pre>

<h2>Initializing Firebase Strategies</h2>

<p><strong>1. <a href=""https://firebase.google.com/docs/firestore/quickstart#initialize"" rel=""nofollow noreferrer"">Initialize on Google Cloud Platform</a></strong></p>

<p>This method is promising as credentials are managed automatically.</p>

<pre><code>// Use the application default credentials
GoogleCredentials credentials = GoogleCredentials.getApplicationDefault();
FirebaseOptions options = new FirebaseOptions.Builder()
    .setCredentials(credentials)
    .setProjectId(projectId)
    .build();
FirebaseApp.initializeApp(options);

Firestore db = FirestoreClient.getFirestore();
</code></pre>

<p><strong>2. <a href=""https://firebase.google.com/docs/firestore/quickstart#initialize"" rel=""nofollow noreferrer"">Initialize on your own server</a></strong></p>

<p>I've confirmed in GCPs <em>IAM &amp; admin</em> > <em>Service accounts</em> that the key id's match with the Json object being used to authenticate.</p>

<p>I'm using this strategy successfully in another Firestore connected app deployed to AppEngine. The working app is built as a <strong>.Jar</strong> and deployed directly to AppEngine without using <strong>ktor</strong>, but rather with the steps outlined <a href=""https://medium.com/r/?url=https%3A%2F%2Fhackernoon.com%2Fdeploy-a-backend-app-as-an-android-engineer-49bd94b4c367"" rel=""nofollow noreferrer"">here</a>.</p>

<pre><code>// Use a service account
InputStream serviceAccount = new FileInputStream(""path/to/serviceAccount.json"");
GoogleCredentials credentials = GoogleCredentials.fromStream(serviceAccount);
FirebaseOptions options = new FirebaseOptions.Builder()
    .setCredentials(credentials)
    .build();
FirebaseApp.initializeApp(options);

Firestore db = FirestoreClient.getFirestore();
</code></pre>

<p>In my working <strong>.Jar</strong> built app I'm passing in the <strong>Json</strong> object programmatically to avoid issues with the file not being found. I tried the same programmatic implementation for this <strong>ktor</strong> application. It worked with <code>gradle appengineRun</code> but not when deployed.</p>

<pre><code>val credentials = GoogleCredentials.fromStream(Gson().toJson(FirebaseCredentials(
            ""service_account"",
            ""project-name"",
            ""asdfghjkl"",
            ""keyStringHere"",
            ""firebase-adminsdk-dhr30@project-name.iam.gserviceaccount.com"",
            ""1234567890"",
            ""https://accounts.google.com/o/oauth2/auth"",
            ""https://oauth2.googleapis.com/token"",
            ""https://www.googleapis.com/oauth2/v1/certs"",
           ""https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-dhr30%40project-name-staging.iam.gserviceaccount.com""
    )).byteInputStream())
    val options = FirebaseOptions.Builder()
            .setCredentials(credentials)
            .setDatabaseUrl(""https://project-name-staging.firebaseio.com"")
            .build()

    FirebaseApp.initializeApp(options)
</code></pre>

<p><strong>3. Initialize on your own server (Firebase console setup)</strong></p>

<p>The only difference between <strong>#2</strong> is this setup adds <code>.setDatabaseUrl(""https://yourProjectName.firebaseio.com"")</code>.</p>

<p><a href=""https://i.stack.imgur.com/kQIF8.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/kQIF8.png"" alt=""enter image description here""></a></p>

<p><strong>4. <a href=""https://cloud.google.com/firestore/docs/quickstart-servers"" rel=""nofollow noreferrer"">Initialize cloud Firestore</a></strong></p>

<pre><code>FirestoreOptions firestoreOptions =
FirestoreOptions.getDefaultInstance().toBuilder()
    .setProjectId(projectId)
    .build();
Firestore db = firestoreOptions.getService();
</code></pre>

<h2>Accessing Firestore Object</h2>

<p>For <strong>#1-3</strong> the Firebase app is initialized right away in the application's <strong>main()</strong> method. Then, the <strong>Firestore</strong> object is accessed from an object.  </p>

<p><strong>FirebaseClient.Kt</strong></p>

<pre><code>object FirebaseClient {
    val firestore: Firestore
    init {
        firestore = FirestoreClient.getFirestore()
    }
}
</code></pre>

<p>For <strong>#4</strong> the Firestore object is created in the Kotlin object's <code>init{...}</code> and stored in the object as a value.</p>

<p><strong>FirebaseClient.Kt</strong></p>

<pre><code>object FirebaseClient {
    val firestore: Firestore

    init {
        val firestoreOptions = FirestoreOptions.getDefaultInstance().toBuilder()
            .setTimestampsInSnapshotsEnabled(true)
            .setProjectId(""project-name"")
            .build()
        firestore = firestoreOptions.service
    }
}
</code></pre>

<h2>Writing to Firestore</h2>

<p><code>FirebaseClient.firestore.collection(someCollection).document(someDocument).collection(anotherCollection).add(someObject)</code></p>
","2253682","","2253682","","2018-10-22 05:25:57","2018-12-01 21:55:47","Firebase Auth Not Working With Ktor App On AppEngine","<firebase><google-app-engine><google-cloud-firestore><ktor>","1","0","","","","52922552","128262","128262","ktor","265","45915935","45915934"
"52971069","1","53021695","","2018-10-24 14:05:47","","7","3057","<p>How can we use kotlin.serialize with Ktor's HttpClient to deserialize/serialize JSON with lists as root?  I am creating the HttpClient as follows:</p>

<pre><code>HttpClient {
       install(JsonFeature) {
           serializer = KotlinxSerializer().apply {
               setMapper(MyClass::class, MyClass.serializer())
               setMapper(AnotherClass::class, AnotherClass.serializer())
           }
       }
       install(ExpectSuccess)
   }
</code></pre>

<p>Appears I need to setMapper for List, however that is not possible with generics.  I see I can get the serializer for it with MyClass.serializer().list, but registering it to deserialize/serialize on http requests is not straight forward.  Anyone know of a good solution?</p>
","751581","","4433326","","2019-03-15 10:28:38","2020-02-28 14:59:01","Ktor: Serialize/Deserialize JSON with List as root in Multiplatform","<json><serialization><kotlin><ktor><kotlin-multiplatform>","4","2","1","","","52971069","128262","128262","ktor","265","45915935","45915934"
"53026828","1","","","2018-10-27 22:30:00","","0","4406","<p>I'm trying to connect to MySQL database in Ktor application:</p>

<pre><code>fun initDB() {
    val url = ""jdbc:mysql://user:pass@localhost:3306/databasename?useUnicode=true&amp;serverTimezone=UTC""
    val driver = ""com.mysql.cj.jdbc.Driver""
    Database.connect(url, driver)
}
</code></pre>

<p>...</p>

<pre><code>fun getUsers(): String {
    var json = """"
    transaction {
        val dbResult = Users.selectAll().orderBy(Users.lastName, true).limit(10)
        ...
        json = Gson().toJson(users);
    }
    return json
}
</code></pre>

<p>But I receive the following error:</p>

<blockquote>
  <p>java.sql.SQLException: Unable to load authentication plugin
  'caching_sha2_password'</p>
</blockquote>

<p>Why does it happen? And how to fix it?</p>

<p><strong>UPD</strong></p>

<p>Eventually I've found a way to fix it: I've created new user in MySQL by command</p>

<pre><code>CREATE USER 'nativeuser'@'localhost'
IDENTIFIED WITH mysql_native_password BY 'password';
</code></pre>

<p>then granted him all privileges and reconnected with new credentials. But the first question is still actual, because I don't have any settings like</p>

<pre><code>default_authentication_plugin=caching_sha2_password
</code></pre>

<p>in my <em>my.ini</em> file.</p>
","4898850","","4898850","","2018-10-27 22:50:34","2018-10-27 22:50:34","java.sql.SQLException: Unable to load authentication plugin 'caching_sha2_password'","<mysql><jdbc><kotlin><ktor>","0","4","","","","53026828","128262","128262","ktor","265","45915935","45915934"
"53165701","1","53167463","","2018-11-06 04:22:43","","0","41","<p>Looking at this code that imitates how <a href=""https://ktor.io/servers/features.html#installing"" rel=""nofollow noreferrer"">features</a> are installed in <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">Ktor</a> applications.</p>

<pre><code>fun main(args: Array&lt;String&gt;) {
    val app = App()
    app.installFeature(Authentication)
}

interface AppFeature {
    fun install()
}

class Authentication {

    companion object Feature : AppFeature {
        override fun install() = println(""Authentication Installed"")
    }
}

class App {

    fun installFeature(appFeature: AppFeature) {
        println(""Installing appFeature `${appFeature::class.simpleName}`"")
        appFeature.install()
    }
}
</code></pre>

<p>What doesn't make sense to me in the above snippet is this line <code>app.installFeature(Authentication)</code></p>

<p>Can anyone explain to me why using the <code>class</code> name instead of the <code>companion object</code> name works just like the more obvious way <code>app.installFeature(Authentication.Feature)</code></p>
","6801937","","","","","2018-11-06 07:27:23","Kotlin syntax: Difference between using the class name instead of the companion object name","<kotlin><ktor>","1","0","","","","53165701","128262","128262","ktor","265","45915935","45915934"
"53168116","1","","","2018-11-06 08:18:50","","6","3096","<p>I got something like this:</p>

<pre><code>private val client = HttpClient {
    install(JsonFeature) {
        serializer = GsonSerializer()
    }
    install(ExpectSuccess)
}
</code></pre>

<p>and make request like</p>

<pre><code>  private fun HttpRequestBuilder.apiUrl(path: String, userId: String? = null) {
    header(HttpHeaders.CacheControl, ""no-cache"")
    url {
        takeFrom(endPoint)
        encodedPath = path
    }
}
</code></pre>

<p>but I need to check request and response body, is there any way to do it? in console/in file?  </p>
","2319278","","","","","2019-11-16 11:58:48","How to log requests in ktor http client?","<kotlin><okhttp><ktor>","4","0","1","","","53168116","128262","128262","ktor","265","45915935","45915934"
"53221219","1","","","2018-11-09 07:07:10","","0","46","<p>While experimenting with ktor I tried to do the following:</p>

<pre><code>fun main() {
    embeddedServer(Netty, port = 8080) {
        routing {
            get(""/"") {
                call.respondTextWriter(ContentType.Text.Html) {
                    appendHTML().html {
                        head {}
                        body {
                            pre {
                                (1..10).forEach {
                                    text(""counting: $it\n"")
                                    flush()
                                    // delay(1000)   &lt;-   I wish...
                                    Thread.sleep(50) // that works
                                }
                            }
                        }
                    }
                }
            }
        }
    }.start()
}
</code></pre>

<p>Unfortunately the kotlinx.html library is not suspendable. The delay method call fails to compile with this error: Suspension functions can be called only within coroutine body.</p>

<p>All this is according to the documentation and makes sense. It would be great though if it were possible.</p>

<p>One possible solution would be a tool that converts the library to CPS at the bytecode level. Does such a tool exist?</p>
","593736","","","","","2018-11-09 07:07:10","JVM cps transformation","<kotlinx.coroutines><ktor>","0","5","","","","53221219","128262","128262","ktor","265","45915935","45915934"
"53229775","1","53233184","","2018-11-09 16:35:51","","0","473","<p>Currently working on a module with gRPC/gNMI + Kotlin with Ktor HTTP.
Stucked with the secured dependency library tc-native netty-tcnative-boringssl-static 2.0.19-Final</p>

<p>Ktor is in 1.0.0-beta3</p>

<pre><code>  // ktor
    implementation ""io.ktor:ktor-server-core:${ktor_version}""
    implementation ""io.ktor:ktor-server-netty:${ktor_version}""
    implementation ""io.ktor:ktor-html-builder:${ktor_version}""
    implementation ""io.ktor:ktor-gson:${ktor_version}""
    implementation ""io.ktor:ktor-metrics:${ktor_version}""
    implementation ""io.ktor:ktor-locations:${ktor_version}""
    implementation ""ch.qos.logback:logback-classic:${logback_version}""

    // tpl
    implementation ""io.ktor:ktor-freemarker:${ktor_version}""
    implementation ""org.freemarker:freemarker:${freemarker_version}""

    // Security
    //implementation ""io.netty:netty-tcnative:${netty_tcnative_version}""
    implementation ""io.netty:netty-tcnative-boringssl-static:${netty_tcnative_version}"".
</code></pre>

<p>When using gRPC request</p>

<pre><code>fun Route.routeFilesystem() {
get(""/test"") {
    call.respondHtml {
        head {
            title { +""gRPC/gNMI"" }
        }
        body {
            p {
                +""[ Capabilities Test ] ""
                TLSConnection(""xxx.xxx.xxx.xxx"",8448).capabilities()
            }
        }
    }
}
</code></pre>

<p>it gives the following error (stacktrace):</p>

<pre><code>[DEBUG] 2018-11-09 16:50:36.789 [nettyCallPool-4-4] DEBUG i.n.u.internal.NativeLibraryLoader - netty_tcnative_linux_x86_64 cannot be loaded from java.libary.path, now trying export to -Dio.netty.native.workdir: /tmp
java.lang.UnsatisfiedLinkError: no netty_tcnative_linux_x86_64 in java.library.path
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1867)
        at java.lang.Runtime.loadLibrary0(Runtime.java:870)
        at java.lang.System.loadLibrary(System.java:1122)
        at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
        at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:243)
        at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:124)
        at io.netty.util.internal.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:85)
        at io.netty.handler.ssl.OpenSsl.loadTcNative(OpenSsl.java:440)
        at io.netty.handler.ssl.OpenSsl.&lt;clinit&gt;(OpenSsl.java:97)
        at io.grpc.netty.GrpcSslContexts.defaultSslProvider(GrpcSslContexts.java:244)
        at io.grpc.netty.GrpcSslContexts.configure(GrpcSslContexts.java:171)
        at io.grpc.netty.GrpcSslContexts.forClient(GrpcSslContexts.java:120)
        at sdn.client.cli.console.TLSConnection.&lt;init&gt;(TLSConnection.kt:38)
        at sdn.client.ui.ApplicationKt$routeFilesystem$1$1$2$1.invoke(Application.kt:125)
        at sdn.client.ui.ApplicationKt$routeFilesystem$1$1$2$1.invoke(Application.kt)
        at kotlinx.html.ApiKt.visit(api.kt:80)
        at kotlinx.html.Gen_tag_groupsKt.p(gen-tag-groups.kt:125)
        at kotlinx.html.Gen_tag_groupsKt.p$default(gen-tag-groups.kt:125)
        at .sdn.client.ui.ApplicationKt$routeFilesystem$1$1$2.invoke(Application.kt:123)
        at .sdn.client.ui.ApplicationKt$routeFilesystem$1$1$2.invoke(Application.kt)
        at kotlinx.html.ApiKt.visit(api.kt:80)
        at kotlinx.html.Gen_tags_hKt.body(gen-tags-h.kt:164)
        at kotlinx.html.Gen_tags_hKt.body$default(gen-tags-h.kt:164)
        at .sdn.client.ui.ApplicationKt$routeFilesystem$1$1.invoke(Application.kt:122)
        at sdn.client.ui.ApplicationKt$routeFilesystem$1$1.invoke(Application.kt)
        at kotlinx.html.ApiKt.visit(api.kt:80)
        at kotlinx.html.ApiKt.visitAndFinalize(api.kt:93)
        at kotlinx.html.Gen_consumer_tagsKt.html(gen-consumer-tags.kt:317)
        at kotlinx.html.Gen_consumer_tagsKt.html$default(gen-consumer-tags.kt:317)
        at io.ktor.html.HtmlContent.writeTo(RespondHtml.kt:32)
        at io.ktor.server.engine.BaseApplicationResponse$respondWriteChannelContent$2.invokeSuspend(BaseApplicationResponse.kt:155)
        at io.ktor.server.engine.BaseApplicationResponse$respondWriteChannelContent$2.invoke(BaseApplicationResponse.kt)
        at io.ktor.util.cio.ReadersKt.use(Readers.kt:33)
        at io.ktor.server.engine.BaseApplicationResponse.respondWriteChannelContent$suspendImpl(BaseApplicationResponse.kt:149)
        at io.ktor.server.engine.BaseApplicationResponse.respondWriteChannelContent(BaseApplicationResponse.kt)
        at io.ktor.server.engine.BaseApplicationResponse.respondOutgoingContent$suspendImpl(BaseApplicationResponse.kt:119)
        at io.ktor.server.engine.BaseApplicationResponse.respondOutgoingContent(BaseApplicationResponse.kt)
        at io.ktor.server.netty.NettyApplicationResponse.respondOutgoingContent$suspendImpl(NettyApplicationResponse.kt:37)
        at io.ktor.server.netty.NettyApplicationResponse.respondOutgoingContent(NettyApplicationResponse.kt)
        at io.ktor.server.engine.BaseApplicationResponse$$special$$inlined$apply$lambda$1.invokeSuspend(BaseApplicationResponse.kt:36)
        at io.ktor.server.engine.BaseApplicationResponse$$special$$inlined$apply$lambda$1.invoke(BaseApplicationResponse.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.util.pipeline.PipelineContext.proceedWith(PipelineContext.kt:39)
        at io.ktor.server.engine.DefaultTransformKt$installDefaultTransformations$1.invokeSuspend(DefaultTransform.kt:26)
        at io.ktor.server.engine.DefaultTransformKt$installDefaultTransformations$1.invoke(DefaultTransform.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:24)
        at io.ktor.html.RespondHtmlKt.respondHtml(RespondHtml.kt:37)
        at io.ktor.html.RespondHtmlKt.respondHtml$default(RespondHtml.kt:15)
        at sdn.client.ui.ApplicationKt$routeFilesystem$1.invokeSuspend(Application.kt:116)
        at .sdn.client.ui.ApplicationKt$routeFilesystem$1.invoke(Application.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:24)
        at io.ktor.routing.Routing.executeResult(Routing.kt:110)
        at io.ktor.routing.Routing.interceptor(Routing.kt:29)
        at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:75)
        at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:60)
        at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.features.StatusPages$intercept$3.invokeSuspend(StatusPages.kt:88)
        at io.ktor.features.StatusPages$intercept$3.invoke(StatusPages.kt)
        at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:82)
        at kotlinx.coroutines.CoroutineScopeKt.coroutineScope(CoroutineScope.kt:162)
        at io.ktor.features.StatusPages.intercept(StatusPages.kt:87)
        at io.ktor.features.StatusPages$Feature$install$1.invokeSuspend(StatusPages.kt:121)
        at io.ktor.features.StatusPages$Feature$install$1.invoke(StatusPages.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.features.CallLogging$Feature$install$2.invokeSuspend(CallLogging.kt:124)
        at io.ktor.features.CallLogging$Feature$install$2.invoke(CallLogging.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:24)
        at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invokeSuspend(DefaultEnginePipeline.kt:80)
        at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invoke(DefaultEnginePipeline.kt)
        at io.ktor.util.pipeline.PipelineContext.proceed(PipelineContext.kt:53)
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:24)
        at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invokeSuspend(NettyApplicationCallHandler.kt:31)
        at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invoke(NettyApplicationCallHandler.kt)
        at kotlinx.coroutines.intrinsics.UndispatchedKt.startCoroutineUndispatched(Undispatched.kt:54)
        at kotlinx.coroutines.CoroutineStart.invoke(CoroutineStart.kt:111)
        at kotlinx.coroutines.AbstractCoroutine.start(AbstractCoroutine.kt:160)
        at kotlinx.coroutines.BuildersKt__Builders_commonKt.launch(Builders.common.kt:54)
        at kotlinx.coroutines.BuildersKt.launch(Unknown Source)
        at io.ktor.server.netty.NettyApplicationCallHandler.handleRequest(NettyApplicationCallHandler.kt:22)
        at io.ktor.server.netty.NettyApplicationCallHandler.channelRead(NettyApplicationCallHandler.kt:16)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
        at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:38)
        at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:353)
        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)
        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)
        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:464)
        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:748)
        Suppressed: java.lang.UnsatisfiedLinkError: no netty_tcnative_linux_x86_64 in java.library.path
                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1867)
                at java.lang.Runtime.loadLibrary0(Runtime.java:870)
                at java.lang.System.loadLibrary(System.java:1122)
                at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
                at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
                at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
                at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
                at java.lang.reflect.Method.invoke(Method.java:498)
                at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:263)
                at java.security.AccessController.doPrivileged(Native Method)
                at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:255)
                at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:233)
                ... 90 common frames omitted
</code></pre>

<p>Please any idea to solve the problem ?
Thanks</p>
","2115767","","3679676","","2018-11-12 08:30:39","2018-11-12 08:30:39","gRPC over TLS using Netty/Kortlin/Ktor raises error and prevents gNMI to work","<kotlin><netty><grpc><ktor>","1","0","","","","53229775","128262","128262","ktor","265","45915935","45915934"
"53299937","1","53302114","","2018-11-14 12:10:26","","0","57","<p><br>
I have a <a href=""https://jsonplaceholder.typicode.com/posts"" rel=""nofollow noreferrer"">url</a> that i want to display as the content of my webpage using <strong>Ktor</strong> framework.</p>

<pre><code>fun Application.module() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {

        get(""/"") {
            call.respondText(/*Content of that url in the output ?*/, ContentType.Text.Any)
        }
    }
}
</code></pre>

<p>Thanks in advance.</p>
","6678991","","","","","2018-11-14 14:07:55","Add content of a url to respondText in Ktor","<kotlin><ktor>","1","0","","","","53299937","128262","128262","ktor","265","45915935","45915934"
"53315271","1","","","2018-11-15 08:35:17","","0","208","<p>I'm looking for a way to register a javax.servlet.http.HttpServlet in ktor, but can't find any.</p>

<p>Do I need to install a feature? Register it in Routing? Can I enable scanning of <code>@WebServlet</code> annotations?</p>

<p>Example servlet:</p>

<pre><code>import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet(""/foo"")
public class MyServlet extends HttpServlet {

    @Override
    protected void doGet(final HttpServletRequest req, final HttpServletResponse resp) {
        // ...
    }
}
</code></pre>
","60518","","60518","","2018-11-15 10:41:33","2020-04-06 15:57:58","How to register a servlet in Ktor?","<servlets><ktor>","1","2","","","","53315271","128262","128262","ktor","265","45915935","45915934"
"53350924","1","53351360","","2018-11-17 11:47:37","","0","429","<p>I am trying to register the <code>PubicKey</code> interface for data conversion in KTor so I can easily receive a public key like this:</p>

<pre><code>data class StoreRequest(
    val publicKey: PublicKey
)
...
val publicKey: PublicKey = call.receive&lt;StoreRequest&gt;().publicKey
</code></pre>

<p>To achieve this I used this page: <a href=""https://ktor.io/servers/features/data-conversion.html"" rel=""nofollow noreferrer"">https://ktor.io/servers/features/data-conversion.html</a><br>
I registered this data converter:</p>

<pre><code>convert&lt;PublicKey&gt; {
    decode { values, _ -&gt;
        // When I add a breakpoint here it won't be reached.
        values.singleOrNull()?.let { key -&gt;
            val encryptedKey = Base64.getDecoder().decode(key.split("" "")[1])
            val inputStream = DataInputStream(ByteArrayInputStream(encryptedKey))

            val format = String(ByteArray(inputStream.readInt()).also(inputStream::readFully))

            if (format != ""ssh-rsa"") throw RuntimeException(""Unsupported format"")

            val publicExponent = ByteArray(inputStream.readInt()).also(inputStream::readFully)
            val modulus = ByteArray(inputStream.readInt()).also(inputStream::readFully)

            val spec = RSAPublicKeySpec(BigInteger(modulus), BigInteger(publicExponent))
            val keyFactory = KeyFactory.getInstance(""RSA"")

            keyFactory.generatePublic(spec)
        }
    }
}
</code></pre>

<p>But for some reason Gson is complaining because I'm using an interface: </p>

<pre><code>java.lang.RuntimeException: Unable to invoke no-args constructor for interface java.security.PublicKey. Register an InstanceCreator with Gson for this type may fix this problem`
</code></pre>

<p>So I'm guessing that I need to create an <code>InstanceCreator</code> for an initial value.
This is the initial <code>PublicKey</code> class I created: </p>

<pre><code>class PkTest : PublicKey {
    override fun getAlgorithm(): String = """"
    override fun getEncoded(): ByteArray = ByteArray(0)
    override fun getFormat(): String = """"
}
...
install(ContentNegotiation) {
    gson {
        setPrettyPrinting()
        registerTypeAdapter(PublicKey::class.java, InstanceCreator&lt;PublicKey&gt; { PkTest() // This is called when I add a breakpoint })
    }
}
</code></pre>

<p>But this also doesn't work! This is the exception I am getting:</p>

<pre><code>com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was STRING at line 2 column 16 path $.publicKey
</code></pre>

<p>For some reason it's expecting the provided key to be a JSON object while I'm providing this:</p>

<pre><code>{
    ""publicKey"": ""ssh-rsa AAAAB3NzaC1yc2EABAADAQABAAACAQDBPL2s+25Ank3zS6iHUoVk0tS63dZM0LzAaniiDon0tdWwq4vcL4+fV8BsAEcpMeijS92JhDDc9FccXlHbdDcmd6c4ITOt9h9xxhIefGsi1FTVJ/EjVtbqF5m0bu7ruIMGvuP1p5s004roHx9y0UdHvD/yNWLISMhy4nio6jLailIj3FS53Emj1WRNsOrpja3LzPXzhuuj6YnD9yfByT7iGZipxkmleaXrknChPClLI9uhcqtAzBLdd0NVTJLOt/3+d1cSNwdBw9e53wJvpEmH+P8UOZd+oV/y7cHIej4jQpBXVvpJR1Yaluh5RuxY90B0hSescUAj5g/3HVPpR/gE7op6i9Ab//0iXF15uWGlGzipI4lA2/wYEtv8swTjmdCTMNcTDw/1huTDEzZjghIKVpskHde/Lj416c7eSByLqsMg2OhlZGChKznpIjhuNRXz93DwqKuIKvJKSnhqaJDxmDGfG7nlQ/eTwGeAZ6VR50yMPiRTIpuYd767+Nsg486z7p0pnKoBlL6ffTbfeolUX2b6Nb9ZIOxJdpCSNTQRKQ50p4Y3S580cUM1Y2EfjlfIQG1JdmTQYB75AZXi/cB2PvScmF0bXRoj7iHg4lCnSUvRprWA0xbwzCW/wjNqw6MyRX42FFlvSRrmfaxGZxKYbmk3TzBv+Fp+CADPqQm3OQ== dynmem@memmen.frl""
}
</code></pre>

<p>How can I 'trick' GSON in accepting a string for <code>PublicKey</code>? Or is there something else I'm doing wrong?</p>

<p>I think GSON wants to serialize a JSON object to a <code>PublicKey</code>. But I want it to accept a <code>String</code>. I think this should be possible because classes like <code>UUID</code> and <code>Date</code> work just fine...</p>
","2735398","","2735398","","2018-11-17 12:03:55","2018-11-17 12:41:38","KTor Gson DataConversion with interface","<java><kotlin><gson><ktor>","1","0","","","","53350924","128262","128262","ktor","265","45915935","45915934"
"53394491","1","","","2018-11-20 13:50:05","","0","224","<p>I need to integrate sabre API into SOAP xml using Ktor framework(Kotlin), I'm not able to find any documentation regarding this.I'm looking for help regarding KTOR with SOAP XML API integration. </p>
","4575332","","1699210","","2018-11-20 17:31:22","2018-11-20 17:31:22","Need to integrate sabre API into SOAP xml using Ktor framework","<xml><soap><kotlin><sabre><ktor>","0","3","","","","53394491","128262","128262","ktor","265","45915935","45915934"
"53430129","1","","","2018-11-22 11:37:00","","0","511","<p>i'm new to Ktor and i am currently using the <a href=""https://ktor.io/quickstart/guides/api.html"" rel=""nofollow noreferrer"">quick start</a> http api but i receive the error:</p>

<p>ERROR Application - Unhandled: GET - /snippets
com.fasterxml.jackson.databind.JsonMappingException: kotlin.reflect.jvm.internal.KClassImpl cannot be cast to kotlin.reflect.jvm.internal.KClassImpl (through reference chain: java.util.Collections$Singleton
Map[""snippets""]->java.util.ArrayList[0])</p>

<p>CODE:</p>

<pre><code>import com.fasterxml.jackson.databind.SerializationFeature
import io.ktor.application.*
import io.ktor.features.CallLogging
import io.ktor.features.ContentNegotiation
import io.ktor.features.DefaultHeaders
import io.ktor.jackson.jackson
import io.ktor.request.receive
import io.ktor.response.respond
import io.ktor.response.respondText
import io.ktor.routing.Routing
import io.ktor.routing.get
import io.ktor.routing.post
import io.ktor.routing.routing
import java.util.*

data class Snippet(val text: String)

val snippets = Collections.synchronizedList(mutableListOf(
    Snippet(""hello""),
    Snippet(""world"")
))

fun Application.main() {
    install(ContentNegotiation) {
        jackson {
            enable(SerializationFeature.INDENT_OUTPUT)
        }
    }
    routing {
        get(""/snippets"") {
            call.respond(mapOf(""snippets"" to synchronized(snippets) { snippets.toList() }))
        }
    }
}
</code></pre>

<p>If i use this instead:</p>

<pre><code> call.respond(mapOf(""snippets"" to synchronized(snippets) { snippets.toString() }))
</code></pre>

<p>it returns:</p>

<pre><code>   {
  ""snippets"" : ""[Snippet(text=hello), Snippet(text=world)]""
   }
</code></pre>

<p>but now it's using toString() rather than toList(), any idea how i can get it to work as in the quick start using toList()?</p>
","9199681","","3679676","","2018-11-22 18:35:47","2018-11-22 18:35:47","Ktor QUICK START HTTP API - ERROR Application - Unhandled: GET - /snippets","<kotlin><jackson><ktor>","1","0","","","","53430129","128262","128262","ktor","265","45915935","45915934"
"53487260","1","","","2018-11-26 18:47:54","","0","304","<p>Has someone successfully deployed a Ktor project in a remote Tomcat server?</p>

<p>I am working on a project, and when i try it in local deployment for testing everything is ok, but when i try to generate the .war and deploy on my remote tomcat server, i always get a 404 when trying to access the servlet.</p>

<p>The deployment seems to be ok, everything works without errors, bu i can't communicate with my servlet.</p>

<p>I have read a lot of guides, but all the people try it in local.</p>

<p>Regards</p>
","2573467","","","","","2019-03-27 09:55:48","Ktor and remote tomcat deploying","<tomcat><kotlin><ktor>","1","1","","","","53487260","128262","128262","ktor","265","45915935","45915934"
"53508564","1","","","2018-11-27 21:37:29","","6","2474","<p>I have a kotlin-multiplatform project targeting iOS and Android.
Ktor http client is used in common module.</p>

<p>Everything works great with Android app.
But when building project with iOS lib, I receive following exceptions:</p>

<pre><code>&gt; Task :app:compileKotlinIos FAILED
src/commonMain/kotlin/com/ottamotta/mozoli/api/MozoliApiKtor.kt:4:8: error: unresolved reference: io
import io.ktor.client.HttpClient
       ^
src/commonMain/kotlin/com/ottamotta/mozoli/api/MozoliApiKtor.kt:5:8: error: unresolved reference: io
import io.ktor.client.features.feature
</code></pre>

<p>...and other ones, saying none of the ktor dependencies have been resolved.</p>

<p>Here is build.gradle:</p>

<pre><code>plugins {
    id 'kotlin-multiplatform' version '1.3.10'
}
repositories {
    google()
    jcenter()
    mavenCentral()
    maven { url ""https://kotlin.bintray.com/kotlinx"" }
}

ext {
    support_lib_version = '28.0.0'
    ktor_version = '1.0.0'
}

def keystorePropertiesFile = rootProject.file(""./app/secret.properties"");
def keystoreProperties = new Properties()
keystoreProperties.load(new FileInputStream(keystorePropertiesFile))

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android-extensions'

android {
    compileSdkVersion 28
    buildToolsVersion '28.0.3'
    defaultConfig {
        applicationId ""com.ottamotta.mozoli""
        minSdkVersion 21
        targetSdkVersion 28
        versionCode 1
        versionName ""1.0""
        testInstrumentationRunner ""android.support.test.runner.AndroidJUnitRunner""
        manifestPlaceholders = [auth0Domain: ""@string/com_auth0_domain"", auth0Scheme: ""https""]
    }
    buildTypes {

        debug {
            resValue ""string"", ""com_auth0_client_id"", keystoreProperties['com_auth0_client_id']
        }
        release {
            resValue ""string"", ""com_auth0_client_id"", keystoreProperties['com_auth0_client_id']
            minifyEnabled false
        }
    }

    lintOptions {
        abortOnError false
    }


}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation ""com.android.support:recyclerview-v7:${support_lib_version}""
    implementation ""com.android.support:appcompat-v7:${support_lib_version}""
    implementation 'com.squareup.picasso:picasso:2.71828'

    implementation ""com.fasterxml.jackson.module:jackson-module-kotlin:2.9.7""

    implementation(""org.jetbrains.kotlinx:kotlinx-coroutines-core:1.0.1"")
    implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.0.1'

    implementation ""com.auth0.android:auth0:1.14.1""

    androidTestImplementation 'com.android.support.test:runner:1.0.2'
}

kotlin {
    targets {
        fromPreset(presets.android, 'android')
        // This preset is for iPhone emulator
        // Switch here to presets.iosArm64 (or iosArm32) to build library for iPhone device
        fromPreset(presets.iosX64, 'ios') {
            compilations.main.outputKinds('FRAMEWORK')
        }
    }
    sourceSets {
        commonMain {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib-common'
                implementation ""io.ktor:ktor-client:$ktor_version""
                implementation ""io.ktor:ktor-client-json:$ktor_version""
                implementation ""io.ktor:ktor-client-jackson:$ktor_version""
            }
        }
        commonTest {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test-common'
                implementation 'org.jetbrains.kotlin:kotlin-test-annotations-common'
            }
        }
        androidMain {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib'
                implementation ""io.ktor:ktor-client-android:$ktor_version""
            }
        }
        androidTest {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test'
                implementation 'org.jetbrains.kotlin:kotlin-test-junit'
            }
        }
        iosMain {
            dependencies {
                implementation(""io.ktor:ktor-client-ios:$ktor_version"")
            }
        }
        iosTest {
        }
    }
}

task copyFramework {
    def buildType = project.findProperty(""kotlin.build.type"") ?: ""DEBUG""
    def target = project.findProperty(""kotlin.target"") ?: ""ios""
    dependsOn ""link${buildType.toLowerCase().capitalize()}Framework${target.capitalize()}""

    doLast {
        def srcFile = kotlin.targets.""$target"".compilations.main.getBinary(""FRAMEWORK"", buildType)
        def targetDir = getProperty(""configuration.build.dir"")
        copy {
            from srcFile.parent
            into targetDir
            include 'app.framework/**'
            include 'app.framework.dSYM'
        }
    }
}
</code></pre>

<p>Here is the code of the file from common module which generates errors:</p>

<pre><code>package com.ottamotta.mozoli.api

import com.ottamotta.mozoli.*
import io.ktor.client.HttpClient
import io.ktor.client.features.feature
import io.ktor.client.features.json.JsonFeature
import io.ktor.client.features.json.JsonSerializer
import io.ktor.client.features.json.defaultSerializer
import io.ktor.client.request.header
import io.ktor.client.request.request
import io.ktor.client.request.url
import io.ktor.http.HttpMethod


class MozoliApiKtor(
    private val serverUrl: String,
    private var jsonSerializer: JsonSerializer? = null,
    private val tokenProvider: suspend () -&gt; String?
) : MozoliApi {

    private val client: HttpClient

    private val AUTH_HEADER = ""Authorization"";
    private val TOKEN_PREFIX = ""Bearer ""

    init {
        client = HttpClient {
            install(JsonFeature) {
                serializer = jsonSerializer ?: defaultSerializer()
            }
        }
        jsonSerializer = client.feature(JsonFeature)?.serializer
    }

    override suspend fun getUserProfile(): User {
        return client.request {
            url(""${serverUrl}/user/"")
            method = HttpMethod.Get
            header(AUTH_HEADER, TOKEN_PREFIX + tokenProvider())
        }
    }

    override suspend infix fun getEventsByCity(cityId: String): List&lt;Event&gt; {
        return client.request {
                url(""${serverUrl}/event/city/${cityId}"")
                method = HttpMethod.Get
                header(AUTH_HEADER, TOKEN_PREFIX + tokenProvider())
            }

    }

}
</code></pre>
","1894927","","","","","2018-12-06 22:29:21","ktor dependencies not resolved in ios module of multiplatform project","<android><ios><ktor><kotlin-multiplatform>","1","4","","","","53508564","128262","128262","ktor","265","45915935","45915934"
"53537182","1","53537517","","2018-11-29 10:44:34","","0","313","<p>I'm trying to setup ktor http client in commonMain module of Kotlin Multiplatform project (as described here <a href=""https://ktor.io/clients/http-client/features/json-feature.html"" rel=""nofollow noreferrer"">https://ktor.io/clients/http-client/features/json-feature.html</a>), but cannot resolve dependency to it:</p>

<pre><code>    val client = HttpClient {
        install(JsonFeature) {
            serializer = JacksonSerializer()
        }
    }
</code></pre>

<p>Gradle version: 4.7.</p>

<p>Here is build.gradle for common module:</p>

<pre><code>apply plugin: 'kotlin-multiplatform'
apply plugin: 'kotlinx-serialization'

    kotlin {
        targets {
            // Change to `presets.iosArm64` to deploy the app to iPhone
            fromPreset(presets.iosX64, 'ios') {
                compilations.main.outputKinds('FRAMEWORK')
            }
        }
        sourceSets {
            commonMain.dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib'
                implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-common:$coroutines_version""
                implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime-common:$serialization_version""

                implementation ""io.ktor:ktor-client-core:$ktor_version""
                implementation ""io.ktor:ktor-client-json:$ktor_version""
                implementation ""io.ktor:ktor-client-jackson:$ktor_version""
            }
            commonTest {
                dependencies {
                    implementation ""org.jetbrains.kotlin:kotlin-test-common""
                    implementation ""org.jetbrains.kotlin:kotlin-test-annotations-common""
                }
            }
            iosMain {
                dependencies {
                    implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-native:$coroutines_version""
                    implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime-native:$serialization_version""

                    implementation ""io.ktor:ktor-client-ios:$ktor_version""
                    implementation ""io.ktor:ktor-client-core-ios:$ktor_version""
                    implementation ""io.ktor:ktor-client-json-ios:$ktor_version""
                }
            }
        }
    }
</code></pre>
","1894927","","","","","2018-11-29 11:01:47","Ktor: cannot resolve JacksonSerializer","<kotlin><ktor><kotlin-native><kotlin-multiplatform>","1","0","","","","53537182","128262","128262","ktor","265","45915935","45915934"
"5745718","1","5789096","","2011-04-21 14:47:41","","0","1298","<p>I have  a view defined as:</p>

<pre><code>function(doc) 
{ 
    if (doc.type=""user"")
    {
        emit([doc.uid, doc.groupid], null);
    } 
}
</code></pre>

<p>In Java code, I have written </p>

<pre><code>List&lt;String&gt; keys = new ArrayList&lt;String&gt;();
keys.add(""93"");
keys.add(""23"");
ViewQuery q = createQuery(""getProfileInfo"").descending(true).keys(keys).includeDocs(true);
ViewResult vr = db.queryView(q);
List&lt;Row&gt; rows = vr.getRows();
for (Row row : rows) {
  System.out.println(""Key---&gt;""+row.getKey());
  System.out.println(""Value---&gt;""+key);
}
</code></pre>

<p>My code always returns 0 rows - what have I missed?</p>
","718654","","327466","","2012-10-05 18:52:30","2012-10-05 18:52:43","Query View doesn't return any values in couchdb","<java><couchdb><ektorp>","2","3","","","","5745718","73833","73833","ektorp","71","7739352","7739351"
"7739334","1","7749813","","2011-10-12 11:27:07","","0","1153","<p>I am examining example Blog example of CouchDB. I use Ektorp at Spring for CouchDB. I wanted to implement it into my application. I have users at my couch db when I use that:</p>

<pre><code>@GenerateView
@Override
public List&lt;User&gt; getAll() {
  ViewQuery q = createQuery(""all"")
    .descending(true)
    .includeDocs(true);
  return db.queryView(q, User.class);
}
</code></pre>

<p>However it returns just last record. Any ideas to get all users?</p>
","453596","","453596","","2011-10-13 05:24:48","2011-10-13 05:26:07","CouchDB Ektorp Select Query","<java><spring><couchdb><ektorp>","1","1","0","","","7739334","73833","73833","ektorp","71","7739352","7739351"
"7741047","1","9135982","","2011-10-12 13:45:02","","0","789","<p>I have a simple database with couch db. I have users have that fields:</p>

<pre><code>String userName
String password
String mail
boolean admin
</code></pre>

<p>I keep my users at db. However I am so new to Couch DB and NoSql. How can I implement map reduce on it with an example (or does it do it internally and I don't need to do anything?)</p>

<p>I use Spring 3 and Ekorp for my application.</p>
","453596","","","","","2014-11-25 21:45:04","Map Reduce Couch Db","<java><spring><nosql><mapreduce><ektorp>","2","0","","","","7741047","73833","73833","ektorp","71","7739352","7739351"
"7741129","1","7742447","","2011-10-12 13:49:51","","0","1837","<p>I use Couch DB with Ektorp at Spring 3. I read the document and have tried to implement examples. I am so new to these technologies. This is the point where I didn't understand:</p>

<pre><code>@View( name = ""all"", map = ""function(doc) { if (doc.type == 'Sofa' ) emit( null, doc._id )}"")
public class SofaRepository extends CouchDbRepositorySupport&lt;Sofa&gt; {

    @View( name = ""avg_sofa_size"", map = ""function(doc) {...}"", reduce = ""function(doc) {...}"")
    public int getAverageSofaSize() {
        ViewResult r = db.queryView(createQuery(""avg_sofa_size""));
        return r.getRows().get(0).getValueAsInt();
    }

}
</code></pre>

<p>How does that wievs work and how to define them, what happens at that lines?</p>
","453596","","-1","","2016-08-18 18:20:09","2016-08-18 18:20:09","In-line View Definitions Couch Db Ektorp","<java><spring><nosql><couchdb><ektorp>","1","0","","","","7741129","73833","73833","ektorp","71","7739352","7739351"
"7923326","1","7931598","","2011-10-27 22:47:12","","7","9399","<p>I have a class that has more than a dozen properties.  For most of the properties of primitive type, I hope to use the default BeanSerializer and BeanDeserializer or whatever to reduce the cumbersome code I need to write.  For other properties of custom and array types, I want to do some custom serializer/deserializer.  Note that I am not able to change the underlying JSON string.  But I have full access to the android code.  I am using Jackson 1.7.9/Ektorp 1.1.1.</p>

<p>shall I subclass BeanDeserializer?  I am having trouble with that.  It expects a default constructor with no parameters but I don't know how to call the super constructor.</p>

<pre><code>class MyType{
    // a dozen properties with primitive types String, Int, BigDecimal
    public Stirng getName();
    public void setName(String name);

    // properties that require custom deserializer/serializer
    public CustomType getCustom();
    public void setCustom(CustomType ct);
}

class MyDeserializer extends BeanDeserialzer{
    // an exception is throw if I don't have default constructor.
    // But BeanDeserializer doesn't have a default constructor
    // It has the below constructor that I don't know how to fill in the parameters
    public MyDeserializer(AnnotatedClass forClass, JavaType type,
        BeanProperty property, CreatorContainer creators,
        BeanPropertyMap properties,
        Map&lt;String, SettableBeanProperty&gt; backRefs,
        HashSet&lt;String&gt; ignorableProps, boolean ignoreAllUnknown,
        SettableAnyProperty anySetter) {
    super(forClass, type, property, creators, properties, backRefs, ignorableProps,
            ignoreAllUnknown, anySetter);
}
    @Override
    public Object deserialize(JsonParser jp, DeserializationContext dc, Object bean)
        throws IOException, JsonProcessingException {
    super.deserialize(jp, dc, bean);
        MyType c = (MyType)bean;        

            ObjectMapper mapper = new ObjectMapper();

            JsonNode rootNode = mapper.readValue(jp, JsonNode.class);
            // Use tree model to construct custom
            // Is it inefficient because it needs a second pass to the JSON string to construct the tree?
            c.setCustom(custom);
            return c;
}
}
</code></pre>

<p>I searched Google but couldn't find any helpful examples/tutorial.  If anyone can send me some working examples that would be great!  Thanks!</p>
","433292","","","","","2013-09-15 03:43:44","How to write custom serializer and deserializer in Jackson?","<json><serialization><deserialization><jackson><ektorp>","1","0","1","","","7923326","73833","73833","ektorp","71","7739352","7739351"
"53547437","1","","","2018-11-29 20:55:53","","4","1566","<p>I'm trying to initialize Ktor http client and setup json serialization. I need to allow non-strict deserialization which <strong>JSON.nonstrict</strong> object allows. Just can't get how to apply this setting to serializer.</p>

<pre><code> val client = HttpClient {
                install(JsonFeature) {
                    serializer = KotlinxSerializer()                    
                }
        }
</code></pre>
","1894927","","","","","2020-02-21 15:00:35","ktor with kotlinx serialization: how to use JSON.nonstrict","<kotlin><ktor><kotlinx.serialization>","3","0","2","","","53547437","128262","128262","ktor","265","45915935","45915934"
"53558215","1","53558325","","2018-11-30 13:08:32","","2","1258","<p>I'm using Guava's <a href=""https://github.com/google/guava/wiki/CachesExplained"" rel=""nofollow noreferrer""><code>Loading Cache</code></a> to cache the results of HTTP requests. Kotlin / KTOR provides an <a href=""https://ktor.io/clients/http-client.html#parallel-requests"" rel=""nofollow noreferrer"">HTTP Client Library</a> based on coroutines (i.e. non-blocking HTTP requests).</p>

<p>My problem is that the Loading Cache has no idea about <code>suspend</code>ing functions. The <code>load</code> function that I pass to the loading cache <strong>cannot</strong> suspend. So I am forced to do the HTTP requests inside a <code>runBlocking</code> call, eliminating the benefit of non-blocking calls completely.</p>

<p>My question is: is there a better way? How would you implement caching of coroutine results?</p>
","3094906","","","","","2018-11-30 13:16:38","Guava LoadingCache with Kotlin Coroutines","<rest><caching><kotlin><guava><ktor>","1","2","","","","53558215","128262","128262","ktor","265","45915935","45915934"
"53575270","1","","","2018-12-01 21:35:15","","2","419","<h1>Issue</h1>

<p>The Ktor application's <strong>main</strong> method is not called when deployed to AppEngine. In the applications's main method is logic to retrieve content from an API request based on a <strong>Timer</strong> and save that information to a Firestore database which a client consumes.</p>

<p>This logic currently works when deployed in a <em>Jar</em> to AppEngine. However, implementing this with <em>Ktor</em> would save deploy time and help future proof the backend service if endpoints are required.</p>

<h1>Expected</h1>

<p>The Ktor application's <strong>main</strong> method is called once the app is deployed to AppEngine similar to how an application's main method is called when ran in IntelliJ. </p>

<h1>Actual</h1>

<p>The <strong>main</strong> method is only called once the app's hosted route is called. </p>

<p>ie: <code>https://[yourProjectName].appspot.com</code></p>

<h1>Setup</h1>

<p><em>Main Method</em></p>

<pre><code>import io.ktor.application.Application
fun Application.main() {
    // App logic here.
}
</code></pre>

<p><em>build.gradle</em></p>

<pre><code>buildscript {
ext.kotlin_version = '1.3.10'
ext.ktor_version = '1.0.0'
ext.appengine_version = '1.9.60'
ext.appengine_plugin_version = '1.3.4'
ext.junitJupiterVersion  = '5.0.3'

repositories {
    jcenter()
    mavenCentral()
}
dependencies {
    classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    classpath ""com.google.cloud.tools:appengine-gradle-plugin:$appengine_plugin_version""
    classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.3'
    }
}

plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.2.51'
}

apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'war'
apply plugin: 'com.google.cloud.tools.appengine'

sourceSets {
    main.kotlin.srcDirs = [ 'src/main/kotlin' ]
}

sourceCompatibility = 1.8

repositories {
    jcenter()
    mavenCentral()
    maven { url ""https://kotlin.bintray.com/ktor"" }
}

dependencies {
    implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    implementation ""io.ktor:ktor-server-servlet:$ktor_version""
    implementation ""io.ktor:ktor-html-builder:$ktor_version""
    providedCompile ""com.google.appengine:appengine:$appengine_version""
    implementation 'com.squareup.retrofit2:retrofit:2.3.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.3.0'
    implementation 'com.squareup.retrofit2:adapter-rxjava:2.3.0'
    implementation 'io.reactivex.rxjava2:rxjava:2.1.1'
    implementation 'com.google.firebase:firebase-admin:6.3.0'
    implementation 'com.google.apis:google-api-services-youtube:v3-rev204-1.23.0'
    testCompile group: 'junit', name: 'junit', version: '4.12'
    // JUnit Jupiter API and TestEngine implementation
    testCompile(""org.junit.jupiter:junit-jupiter-api:${junitJupiterVersion}"")
    testRuntime(""org.junit.jupiter:junit-jupiter-engine:${junitJupiterVersion}"")
    testCompile(""org.assertj:assertj-core:3.10.0"")
    // To avoid compiler warnings about @API annotations in JUnit code
    testCompileOnly('org.apiguardian:apiguardian-api:1.0.0')
}

kotlin.experimental.coroutines = 'enable'

compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}

task run(dependsOn: appengineRun)

appengine {
    deploy {
    version = 'media-staging-1201181257pm'
    }
}
</code></pre>

<p><em>src/main/resources/application.conf</em></p>

<pre><code>ktor {
    application {
        modules = [ InitializationKt.main ]
    }
}
</code></pre>

<p><em>src/main/webapp/WEB-INF/</em></p>

<p><em>appengine-web.xml</em></p>

<pre><code>&lt;?xml version=""1.0"" encoding=""utf-8""?&gt;
&lt;appengine-web-app xmlns=""http://appengine.google.com/ns/1.0""&gt;
    &lt;threadsafe&gt;true&lt;/threadsafe&gt;
    &lt;runtime&gt;java8&lt;/runtime&gt;
&lt;/appengine-web-app&gt;
</code></pre>

<p><em>web.xml</em></p>

<pre><code>&lt;?xml version=""1.0"" encoding=""ISO-8859-1"" ?&gt;
&lt;web-app xmlns=""http://java.sun.com/xml/ns/javaee"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"" version=""3.0""&gt;
    &lt;servlet&gt;
        &lt;display-name&gt;KtorServlet&lt;/display-name&gt;
        &lt;servlet-name&gt;KtorServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;io.ktor.server.servlet.ServletApplicationEngine&lt;/servlet-class&gt;
        &lt;!-- path to application.conf file, required --&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;io.ktor.config&lt;/param-name&gt;
            &lt;param-value&gt;application.conf&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;KtorServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre>
","2253682","","2253682","","2018-12-02 20:03:56","2019-12-29 02:26:31","Ktor App's Main Method Not Called When Deployed to AppEngine","<google-app-engine><kotlin><ktor>","2","0","1","","","53575270","128262","128262","ktor","265","45915935","45915934"
"53591057","1","","","2018-12-03 09:45:15","","0","47","<p>How to handle the output of a StreamObserver in freemarker ? 
I have the following controller code so as to subscribe to a stream channel. </p>

<pre><code>else -&gt; {
                try {
                    //jsonResponse = gnhc.getRequestJsonOutput(pathlist,pretty = true)
                    jsonResponseRaw =  gnhc.subscribev1(pathlist, subId, writer).toString()
                    jsonResponse = jsonResponseRaw
                    application.log.debug(""SDN_JSON_PROCESSOR: ${jsonResponse}"")
                } catch (e: Exception) {
                    jsonResponse = e.toString()
                    application.log.error(""Failed to set channel"", e)
                } finally {
                    gnhc.shutdownNow()
                }
            }
        }
        call.respond(FreeMarkerContent(""subscribe.ftl"", mapOf(""hostname"" to hostname, ""port"" to port, ""cmd"" to cmd, ""result"" to jsonResponse,""rawresult"" to jsonResponseRaw, ""pathlist"" to pathlist, ""error"" to error), etag = ""e""))
    }
</code></pre>

<p>The Observer is declared here:</p>

<pre><code>try {
            // simple observer without writer and subId
            val sr: StreamObserver&lt;Gnmi.SubscribeRequest&gt; = stub.subscribe(GnmiStreamObserver(this))

            // Writer + Id
            //val sr: StreamObserver&lt;Gnmi.SubscribeRequest&gt; = stub.subscribe(StreamResponseWriter(_path,_id,_writer))

            sr.onNext(subRequest)
            waitCompleted()
            sr.onCompleted()

        } 
</code></pre>
","2115767","","","","","2018-12-03 09:45:15","How to render a StreamObserver in WebUI (ktor + freemarker)","<kotlin><freemarker><ktor>","0","2","","","","53591057","128262","128262","ktor","265","45915935","45915934"
"53595544","1","","","2018-12-03 14:10:15","","5","965","<p>I can't figure out how to send a <code>application/x-www-form-urlencoded</code> <code>POST</code> request in Ktor. I see some <code>submitForm</code> helpers in  Ktor's documentation but they don't send the request as expected.</p>

<p>What I want is to replicate this curl line behavior:</p>

<pre><code>curl -d ""param1=lorem&amp;param2=ipsum"" \
     -H ""Content-Type: application/x-www-form-urlencoded; charset=UTF-8"" \
     https://webservice/endpoint
</code></pre>

<p>My dependency is on <code>io.ktor:ktor-client-cio:1.0.0</code>.</p>
","625581","","","","","2018-12-03 14:10:15","Send application/x-www-form-urlencoded in Ktor","<kotlin><urlencode><ktor>","1","0","1","","","53595544","128262","128262","ktor","265","45915935","45915934"
"53639980","1","","","2018-12-05 20:09:02","","2","660","<p>I'm writing wrapper for telegram-bot-api using <code>kotlin</code> and <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">ktor</a>.
I have a problem - can't find working way to upload files.</p>

<p>(from tg bot api <a href=""https://core.telegram.org/bots/api#sending-files"" rel=""nofollow noreferrer"">docs</a>)<br>
<strong>There are three ways to send files (photos, stickers, audio, media, etc.):</strong></p>

<ol>
<li>If the file is already stored somewhere on the Telegram servers, you don't need to reupload it: each file object has a file_id field, simply pass this file_id as a parameter instead of uploading. There are no limits for files sent this way.</li>
<li>Provide Telegram with an HTTP URL for the file to be sent. Telegram will download and send the file. 5 MB max size for photos and 20 MB max for other types of content.</li>
<li>Post the file using multipart/form-data in the usual way that files are uploaded via the browser. 10 MB max size for photos, 50 MB for other files.  </li>
</ol>

<p>With 1-st and 2-nd ways I haven't  any problems.</p>

<p>For now I have that ugly function that makes request to tg and parse answer:</p>

<pre><code>internal suspend inline fun &lt;reified T&gt; makeRequest(token: String, method: TelegramMethod, vararg params: Pair&lt;String, Any?&gt;, files: Map&lt;String, String&gt; = emptyMap()): T {
    try {
        val data: List&lt;PartData&gt; = formData {
            files.forEach { key, fileName -&gt;
                append(key, Files.newInputStream(Paths.get(fileName)).asInput())
            }
        }
        val response = client.submitFormWithBinaryData&lt;HttpResponse&gt;(data) {
            this.method = HttpMethod.Post
            url {
                protocol = URLProtocol(""https"", 42)
                host = API_HOST
                encodedPath = API_PATH_PATTERN.format(token, method.methodName)
                params.forEach { (name, value) -&gt;
                    if (value != null) { this.parameters[name] = value as String }
                }
            }
        }
        val result = response.receive&lt;String&gt;()
        return parseTelegramAnswer&lt;T&gt;(response, result)
    } catch (e: BadResponseStatusException) {
        val answer = mapper.readValue&lt;TResult&lt;T&gt;&gt;(e.response.content.readUTF8Line()!!)
        throw checkTelegramError(e.response.status, answer)
    }
}
</code></pre>

<p>Without files it works, with files - it doesn't. (I think that I doing everything wrong)</p>

<p>Usage example:</p>

<pre><code>suspend fun getUpdates(offset: Long? = null, limit: Int? = null, timeout: Int? = null, allowedUpdates: List&lt;String&gt;? = null): List&lt;Update&gt; =
        api.makeRequest(
            token,
            TelegramMethod.getUpdates,
            ""offset"" to offset?.toString(),
            ""limit"" to limit?.toString(),
            ""timeout"" to timeout?.toString(),
            ""allowed_updates"" to allowedUpdates
        )
</code></pre>

<p>I have test it on different files and I find that:</p>

<ol>
<li><p>if I send files between <code>17,9 KiB</code> and <code>56,6 KiB</code> I get from tg following error: <code>Bad Request: wrong URL host</code></p></li>
<li><p>if I send files between <code>75,6 KiB</code> and <code>913,2 KiB</code> I get error <code>413 Request Entity Too Large</code></p></li>
</ol>

<p><em>* I were using <code>sendDocument</code> method</em></p>

<p>What is true way to send files using <code>ktor</code>?</p>
","10751410","","","","","2018-12-11 09:18:19","Uploading files to telegram bot api using ktor","<kotlin><telegram-bot><ktor>","1","2","1","","","53639980","128262","128262","ktor","265","45915935","45915934"
"53683252","1","53683435","","2018-12-08 13:58:52","","1","175","<p>I've added the dependency for <em><a href=""https://ktor.io/clients/http-client/testing.html"" rel=""nofollow noreferrer"">Ktor client mock</a></em></p>

<pre><code>testImplementation ""io.ktor:ktor-client-mock:$ktor_version""
</code></pre>

<p>But still the MockEngine is not resolved. </p>
","4907678","","4907678","","2018-12-11 23:00:02","2019-03-01 15:18:12","Ktor client MockEngine not resolved in android","<android><kotlin><ktor>","2","0","1","","","53683252","128262","128262","ktor","265","45915935","45915934"
"53717450","1","53721453","","2018-12-11 04:38:01","","2","116","<p>Does anyone know whats the correct way to document Ktor routes, aiming to show it on KDoc?
Example:</p>

<pre><code>route(DogoBot.data.API.ROUTE){
    route(""token""){
        route(""add""){
            get(""fromdiscord"") { ... }
            get { ... }
        }
    }
    route(""user""){
        route(""{id}"") {
            get { ... }
        }
    }
    route(""guild""){
        route(""{id}"") {
            get { ... }
        }
     }
}
</code></pre>

<p>Well, if is it possible, how do I do this? Which type of information should I put in it? How do I implement that Ktor compatibility in other things? (I have another router made by my own for other things)</p>
","9893963","","7366707","","2018-12-11 09:25:36","2018-12-11 09:52:05","Documenting Ktor routes with KDoc","<kotlin><documentation><ktor><kdoc>","1","0","","","","53717450","128262","128262","ktor","265","45915935","45915934"
"53739245","1","53741893","","2018-12-12 08:53:57","","2","1538","<p>I have a Ktor server application (rest api) running with a self signed certificate. </p>

<p>It works fine from a browser (after a warning and a confirmation) port 80 is redirected to 8443. </p>

<p>But if I try this from a Ktor Apache Client:</p>

<pre><code>fun main(args: Array&lt;String&gt;) = runBlocking {

    val client = HttpClient(Apache) {
        install(JsonFeature) {
            serializer = GsonSerializer()
        }
    }

    val job = GlobalScope.launch {
        try {
            //self-signed certificate
            val resultWillFail = client.get&lt;String&gt;(""https://10.0.0.11:8443/get-my-services"")
            println(""${resultWillFail}"")
            val resultOk = client.get&lt;String&gt;(""https://en.wikipedia.org/wiki/Main_Page"") //ok
            println(""${resultOk}"")
        } catch (e: Exception) {
            println(""Error: ${e.message}"")
        }
    }

    job.join()
}
</code></pre>

<p>My request to <a href=""https://10.0.0.11:8443/get-my-services"" rel=""nofollow noreferrer"">https://10.0.0.11:8443/get-my-services</a> will fail:</p>

<blockquote>
  <p><strong>Error: General SSLEngine problem</strong></p>
</blockquote>

<p>I also tried the same using curl:</p>

<blockquote>
  <p><strong>curl: (77) schannel: next InitializeSecurityContext failed: SEC_E_UNTRUSTED_ROOT (0x80090325) - The certificate chain was issued
  by an authority that is not trusted.</strong></p>
</blockquote>

<p>So my question would be: How to use a self signed certificate with ktor client (Apache) ?</p>

<p>Thanks,
J</p>
","10779793","","2734276","","2018-12-12 09:08:18","2018-12-12 21:46:01","ktor client https request with self-signed certificate","<kotlin><ktor>","2","0","","","","53739245","128262","128262","ktor","265","45915935","45915934"
"53755214","1","53772266","","2018-12-13 04:56:00","","3","574","<p>I am trying to build a simple Kotlin Multiplatform app that calls to the internet to fetch some Strings from the internet with ktor. I took some functions from <a href=""https://github.com/JetBrains/kotlinconf-app"" rel=""nofollow noreferrer"">Kotlin conference app</a> which I compiled and it works fine on both Android and iOS. </p>

<p>However, in my sample app, it only works on Android, but on iOS it returns </p>

<p><code>kotlin.native.concurrent.InvalidMutabilityException: mutation attempt of frozen &lt;object&gt;@c422ffe8</code></p>

<p>Here is the <a href=""https://github.com/LiewJunTung/Kotlin-Multiplatform-Example-App"" rel=""nofollow noreferrer"">GitHub repository</a> and below is my code:</p>

<pre><code>// src/commonMain/CoroutinePresenter.kt

open class CoroutinePresenter(
    private val mainContext: CoroutineContext, // TODO: Use Dispatchers.Main instead when it will be supported on iOS
    private val baseView: BaseView
): CoroutineScope {

    private val job = Job()
    private val exceptionHandler = CoroutineExceptionHandler { _, throwable -&gt;
        baseView.showError(throwable)
    }

    override val coroutineContext: CoroutineContext
        get() = mainContext + job + exceptionHandler

    open fun onDestroy() {
        job.cancel()
    }
}
</code></pre>

<p>--</p>

<pre><code>// src/commonMain/SamplePresenter.kt

class SamplePresenter(
    val uiContext: CoroutineContext,
    baseView: BaseView,
    val sampleView: SampleView
) : CoroutinePresenter(uiContext, baseView) {
    private val client = HttpClient()

    fun callSimpleApi() {
        try {
            GlobalScope.launch(uiContext) {
                getToolString()
            }
        } catch (e: Exception) {
            sampleView.returnString(e.toString())
        }
    }

    suspend fun getToolString() = client.get&lt;String&gt; {
        url(""https://tools.ietf.org/rfc/rfc1866.txt"")
    }

    override fun onDestroy() {
        super.onDestroy()
    }
}
</code></pre>

<p>--</p>

<pre><code>// src/iosMain/SampleIos.kt
object MainLoopDispatcher: CoroutineDispatcher() {
    override fun dispatch(context: CoroutineContext, block: Runnable) {
        NSRunLoop.mainRunLoop().performBlock {
            block.run()
        }
    }
}
</code></pre>

<p>--</p>

<pre><code>// iosApp/iosApp/ViewController.swift
import app

class ViewController: UIViewController, SampleView, BaseView {
    private lazy var presenter: SamplePresenter = { SamplePresenter(
        uiContext: MainLoopDispatcher(),
        baseView: self,
        sampleView: self
        )
    }()
    @IBOutlet weak var label: UILabel!

    func showError(error: KotlinThrowable) {
        print(error.message)
    }

    func returnString(result: String) {
        label.text = result
        print(result)
    }

    override func viewDidLoad() {
        super.viewDidLoad()
        print(""helo"")
        presenter.callSimpleApi()
    }
}
</code></pre>
","3809541","","3809541","","2018-12-13 05:07:55","2019-01-20 11:18:40","kotlin.native.concurrent.InvalidMutabilityException: mutation attempt of frozen <object> when using ktor in Kotlin Multiplatform (iOS)","<ios><kotlin><ktor><kotlin-native><kotlin-multiplatform>","1","0","","","","53755214","128262","128262","ktor","265","45915935","45915934"
"8067668","1","8096683","","2011-11-09 15:54:08","","3","1455","<p>I'm having trouble dealing with what I thought would be a simple problem. Basically, I need a <code>java.util.Map&lt;String, String&gt;</code>, where ids end up being the map keys, and <code>someField</code> of my document ends up in the values.</p>

<p>I'm really really stuck on this, which greatly surprises me. I've tried writing a separate view:</p>

<pre><code>@View(map=""function(d) { if (d.someField) { emit(d.someField, null); } }"", name = ""someField"")
</code></pre>

<p>and then use the following Java:</p>

<pre><code>public Map&lt;String, String&gt; getSomeFields() throws JsonParseException, JsonMappingException, IOException {
    ViewQuery q = new ViewQuery().designDocId(""_design/"" + entity.getSimpleName()).viewName(""someField"");
    String result = StreamUtils.inputStreamAsString(db.queryForStream(q), false);
    TypeReference&lt;Map&lt;String, String&gt;&gt; mapTypeRef = new TypeReference&lt;Map&lt;String,String&gt;&gt;() {};
    // mapper is a Jackson ObjectMapper
    return mapper.readValue(result, mapTypeRef);
} 
</code></pre>

<p>This is already really ugly, but it also doesn't actually work, as it seems the JSON results that <code>queryForStream</code> returns includes random other stuff, rather than just the result of the query. This causes the <code>readValue</code> call to throw an <code>IOException</code>.</p>

<p>I've also tried using <code>reduce</code> to generate a single object containing all these values, but the result of that is that Couch complains the reduce doesn't reduce enough...</p>
","713326","","","","","2011-11-11 16:03:39","How to get a java.util.Map from id to string prop in couchdb using ektorp","<java><couchdb><jackson><ektorp>","2","0","","","","8067668","73833","73833","ektorp","71","7739352","7739351"
"8282461","1","8357107","","2011-11-26 23:36:44","","0","590","<p>I had the following 2 questions on couchbase on android:</p>

<ul>
<li>When the couchdb is replicated to the android device, are the attachments in the document downloaded and saved to the SDCard or only the plain document(json) is saved?</li>
<li>is it possible to perform selective replication. Basically if a couchdb contains a chunk of documents, Can I replicate only a subset of the documents? I am using the Ektorp Client library.</li>
</ul>

<p><strong>Update</strong> : For the second question the answer by ""<a href=""https://stackoverflow.com/a/8357107/500865"">I dropped out of a java school</a>"" is good. The right term is Filtered Replication. </p>

<p>I'm looking for an answer for the first question with evidence.</p>
","500865","","-1","","2017-05-23 12:03:37","2011-12-03 01:40:56","Android - Couchbase attachments storage and selective pull replication","<android><couchdb><couchbase><ektorp>","2","0","1","","","8282461","73833","73833","ektorp","71","7739352","7739351"
"8515245","1","8515388","","2011-12-15 04:48:56","","0","684","<p>I have simple item model with name and quantity:</p>

<pre><code>public class Item  extends CouchDbDocument{
private static final long serialVersionUID = -3645214415410443346L;
private String name;
private int quantity;

public Item (String name, int qty){
    this.name = name;
    this.quantity = qty;
}
public String getName() {
    return name;
}
public void setName(String name) {
    this.name = name;
}
public int getQuantity() {
    return quantity;
}
public void setQuantity(int quantity) {
    this.quantity = quantity;
}
}
</code></pre>

<p>and an Item Repository class</p>

<pre><code>public class ItemRepository extends CouchDbRepositorySupport&lt;Item&gt;{

public ItemRepository(CouchDbConnector db) {
        super(Item.class, db);
        initStandardDesignDocument();
}
@GenerateView @Override
public List&lt;Item&gt; getAll() {
    ViewQuery q = createQuery(""all"").descending(true);
    return db.queryView(q, Item.class);
}
</code></pre>

<p>and an Item Controller</p>

<pre><code>public class ItemController {
ItemRepository itemRepository;

public String viewAll() {
    List&lt;Item&gt; items = itemRepository.getAll();        
    return items.toString();
}
}
</code></pre>

<p>I have a CouchDBConnector class which is added as javascript interface:</p>

<pre><code>public class CouchDBConnector {
private WebView webView;
private DroidGap droidGap;
private CouchDbConnector db ;
private CouchDbInstance dbInstance;
private ItemController itemController;
private ItemRepository repo;

public CouchDBConnector(DroidGap gap, WebView view) {
    this.webView = view;
    this.droidGap = gap;
}

public void init(){
    HttpClient httpClient = new StdHttpClient.Builder()
            .host(""localhost"")
            .port(5984)
            .build();

    dbInstance = new StdCouchDbInstance(httpClient);
    db = new StdCouchDbConnector(""itemdatabase"", dbInstance);
    repo = new ItemRepository(db);
    itemController = new ItemController();
}

public String getAllItems(){
    String prefix = ""Items \n"";

    return prefix + repo.getAll().toString();
}

public void add(String item_name, String qty){
    repo.add(new Item(item_name, Integer.parseInt(qty)));
    return;
}
public void update(String item_name, String qty){
    repo.update(new Item(item_name, Integer.parseInt(qty)));
    return;
}
public void delete(String item_name, String qty){
    repo.remove(new Item(item_name, Integer.parseInt(qty)));
    return;
}
}
</code></pre>

<p>From the HTML page of the PhoneGap app, I am trying to call <code>CouchDBConnector</code> class to get all the documents or a string ""No Items found"" but I get null pointer exceptions. Here's the stack trace:</p>

<pre><code>`12-14 16:12:45.273: I/dalvikvm(675): java.lang.NullPointerException:
12-14 16:12:45.273: I/dalvikvm(675):    at com.phonegap.TestDB.CouchDBConnector.getAllItems(CouchDBConnector.java:44)
12-14 16:12:45.273: I/dalvikvm(675):    at android.webkit.JWebCoreJavaBridge.nativeServiceFuncPtrQueue(Native Method)
12-14 16:12:45.273: I/dalvikvm(675):    at android.webkit.JWebCoreJavaBridge.nativeServiceFuncPtrQueue(Native Method)
12-14 16:12:45.273: I/dalvikvm(675):    at android.webkit.JWebCoreJavaBridge.handleMessage(JWebCoreJavaBridge.java:115)
12-14 16:12:45.273: I/dalvikvm(675):    at android.os.Handler.dispatchMessage(Handler.java:99)
12-14 16:12:45.273: I/dalvikvm(675):    at android.os.Looper.loop(Looper.java:137)
12-14 16:12:45.273: I/dalvikvm(675):    at android.webkit.WebViewCore$WebCoreThread.run(WebViewCore.java:722)
12-14 16:12:45.283: I/dalvikvm(675):    at java.lang.Thread.run(Thread.java:856)
12-14 16:12:45.293: I/dalvikvm(675): ""WebViewCoreThread"" prio=5 tid=11 NATIVE
12-14 16:12:45.303: I/dalvikvm(675):   | group=""main"" sCount=0 dsCount=0 obj=0x41381ca0 self=0x1dbf90
12-14 16:12:45.303: I/dalvikvm(675):   | sysTid=688 nice=0 sched=0/0 cgrp=default handle=1748120
12-14 16:12:45.312: I/dalvikvm(675):   | schedstat=( 3460347960 1824920390 1206 ) utm=321 stm=24 core=0
12-14 16:12:45.312: I/dalvikvm(675):   at android.webkit.JWebCoreJavaBridge.nativeServiceFuncPtrQueue(Native Method)
12-14 16:12:45.312: I/dalvikvm(675):   at android.webkit.JWebCoreJavaBridge.nativeServiceFuncPtrQueue(Native Method)
12-14 16:12:45.323: I/dalvikvm(675):   at android.webkit.JWebCoreJavaBridge.handleMessage(JWebCoreJavaBridge.java:115)
12-14 16:12:45.323: I/dalvikvm(675):   at android.os.Handler.dispatchMessage(Handler.java:99)
12-14 16:12:45.323: I/dalvikvm(675):   at android.os.Looper.loop(Looper.java:137)
12-14 16:12:45.333: I/dalvikvm(675):   at android.webkit.WebViewCore$WebCoreThread.run(WebViewCore.java:722)
12-14 16:12:45.343: I/dalvikvm(675):   at java.lang.Thread.run(Thread.java:856)
</code></pre>
","490131","","211563","","2011-12-15 04:54:35","2011-12-15 05:08:03","Null pointer exception when trying to fetch all documents from CouchDB database using ektorp on Android","<android><cordova><couchdb><ektorp>","1","0","","","","8515245","73833","73833","ektorp","71","7739352","7739351"
"8718360","1","8719139","","2012-01-03 20:45:38","","2","1385","<p>I'm working on an application acts as an event service bus for integrating various legacy components....The application utilizes a data store to audit all events and requests sent between systems as well as to store metadata about bus-subscribing endpoints...etc. I want to utilize CouchDB as the data store since it already has many of my application's requirements built-in (REST API, replication, versioning metadata documents...etc). Now here's how my app stack looks like:</p>

<pre><code>  [spring-integration filters/routers/service activators]
  [service layer]
  [dao layer]
  [database]
</code></pre>

<p>With the database being CouchDB, I guess the the DAO layer would be either Ektorp Java library or  a simple REST client. Here's my question though: isn't building a DAO layer with Ektorp kind of redundant? I mean, why not just use a RestTemplate in the service layer that talks to the views and design documents in CouchDB and save me some coding effort? </p>

<p>Am I missing something?</p>

<p>Thanks,</p>
","86857","","","","","2012-01-04 01:37:49","Java data access to CouchDB: ORM or REST?","<java><couchdb><ektorp>","2","0","","","","8718360","73833","73833","ektorp","71","7739352","7739351"
"53756223","1","","","2018-12-13 06:35:15","","1","256","<p>I was trying to follow the ktor documentation for Raw Sockets and in specific the part related to secured sockets (<a href=""https://ktor.io/servers/raw-sockets.html"" rel=""nofollow noreferrer"">https://ktor.io/servers/raw-sockets.html</a>):</p>

<pre><code>runBlocking {
    val socket = aSocket(ActorSelectorManager(ioCoroutineDispatcher)).tcp().connect(InetSocketAddress(""google.com"", 443)).tls()
    val w = socket.openWriteChannel(autoFlush = false)
    w.write(""GET / HTTP/1.1\r\n"")
    w.write(""Host: google.com\r\n"")
    w.write(""\r\n"")
    w.flush()
    val r = socket.openReadChannel()
    println(r.readUTF8Line())
}

You can adjust a few optional parameters for the TLS connection:

suspend fun Socket.tls(
        trustManager: X509TrustManager? = null,
        randomAlgorithm: String = ""NativePRNGNonBlocking"",
        serverName: String? = null,
        coroutineContext: CoroutineContext = ioCoroutineDispatcher
): Socket
</code></pre>

<p>But the <strong>NativePRNGNonBlocking</strong> SecureRandom algorithm is not available on Windows, so my only option was to use <strong>SHA1PRNG</strong> (<a href=""https://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html#SecureRandomImp"" rel=""nofollow noreferrer"">https://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html#SecureRandomImp</a>)</p>

<p><strong>This is the code I'm running to connect to a listening socket :</strong></p>

<pre><code>socket = aSocket(ActorSelectorManager(Dispatchers.IO)).tcp().connect(InetSocketAddress(host, port))
    .tls(Dispatchers.IO, randomAlgorithm = ""SHA1PRNG"")
</code></pre>

<p>Unfortunately, I always receive the same error: ""<strong>Channel was closed</strong>""</p>

<p>If I remove tls, keeping only the raw socket:</p>

<pre><code>socket = aSocket(ActorSelectorManager(Dispatchers.IO)).tcp().connect(InetSocketAddress(host, port))
</code></pre>

<p>Everything works as expected.</p>

<p>Does anyone has used Ktor Secure Sockets in Windows ? (Unfortunately, Ktor's documentation still has a long way to go).</p>

<p>Thanks, 
J</p>
","10779793","","","","","2018-12-13 06:35:15","Ktor Secure Sockets (SSL/TLS) windows example?","<sockets><ssl><kotlin><ktor>","0","0","1","","","53756223","128262","128262","ktor","265","45915935","45915934"
"53757532","1","53773516","","2018-12-13 08:12:47","","1","888","<p>I use <a href=""https://github.com/JetBrains/Exposed"" rel=""nofollow noreferrer"">kotlin exposed sql</a> in my project I created kotlin object for my table also I created DAO as is in <a href=""https://github.com/JetBrains/Exposed/wiki/DAO"" rel=""nofollow noreferrer"">example</a> all working as should, but when I want return List of my DAO objects I get:</p>

<pre><code>com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError) (through reference chain: org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]-&gt;java.util.ArrayList[0]-&gt;org.jetbrains.exposed.sql.Column[""table""]-&gt;org.domcek.dto.Page[""columns""]....
</code></pre>

<p>I use jackson in my KTOR aplication </p>

<p>myDao:</p>

<pre><code>class PageDao(id: EntityID&lt;Int&gt;) : IntEntity(id) {
    companion object : IntEntityClass&lt;PageDao&gt;(Page)

    var title by Page.title
    var body by Page.body
    var parentId by Page.parentId
    var active by Page.active
    var order by Page.order
    var slug by Page.slug

    var children: List&lt;PageDao&gt;? = null

    fun isMyParent(pageId: Int): Boolean {
        return pageId == this.parentId
    }
}
</code></pre>

<p>myHandler:</p>

<pre><code>suspend fun findAll(call: ApplicationCall) {
        val pages = pageRepository.getMainPages()

        call.respond(pages)
    }
</code></pre>

<p>Repository:</p>

<pre><code>fun getMainPages(): List&lt;PageDao&gt; {
        return transaction {
            addLogger(StdOutSqlLogger)

            return@transaction PageDao.find {
                Page.active.eq(true)
                Page.parentId.isNull()
            }.toList()
        }
    }
</code></pre>
","3556049","","","","","2018-12-14 04:27:45","How can I serialize kotlin exposed sql dao","<kotlin><ktor><kotlin-exposed>","1","0","","","","53757532","128262","128262","ktor","265","45915935","45915934"
"53787542","1","","","2018-12-14 22:12:00","","13","2636","<p>while trying to build a Kotlin/Ktor application in IntelliJ, multiple warnings of the form</p>

<pre><code>Warning:(276, 6) Kotlin: This class can only be used with the compiler argument '-Xuse-experimental=kotlin.Experimental'
</code></pre>

<p>are output.  The warnings refer to</p>

<pre><code>@UseExperimental(KtorExperimentalLocationsAPI::class)
</code></pre>

<p>so I expected to satisfy the warning by setting <em>Settings -> Build -> Compiler -> Kotlin Compiler -> Additional command line parameters</em> to <strong>-version -Xuse-experimental=kotlin.Experimental</strong>.  (<strong>-version</strong> was already there).  But the warning is still generated.  How do I satisfy it?  Thanks in expectation.</p>
","2155544","","","","","2019-04-16 14:51:04","How to set '-Xuse-experimental=kotlin.experimental' in IntelliJ","<intellij-idea><kotlin><compiler-warnings><ktor>","1","1","1","","","53787542","128262","128262","ktor","265","45915935","45915934"
"53891189","1","54500767","","2018-12-21 21:54:29","","1","549","<p>I'm digging the built-in configuration support, and want to use it (instead of just rolling my own alongside Ktor's), but I'm having a hard time figuring out how to do it in a clean way. I've got this, and it's working, but it's really ugly and I feel like there has to be a better way:</p>

<pre><code>val myBatisConfig = MyBatisConfig(
        environment.config.property(""mybatis.url"").getString(),
        environment.config.property(""mybatis.driver"").getString(),
        environment.config.property(""mybatis.poolSize"").getString().toInt())

installKoin(listOf(mybatisModule(myBatisConfig), appModule), logger = SLF4JLogger())
</code></pre>

<p>Thanks for any help!</p>
","131854","","","","","2020-04-12 10:16:45","How do I use custom configuration in Ktor?","<ktor><koin>","3","0","","","","53891189","128262","128262","ktor","265","45915935","45915934"
"53920392","1","","","2018-12-25 07:48:52","","1","317","<p>I have Ktor-based ultra-simple udp server:</p>

<pre><code>fun main() = runBlocking {
    val server = aSocket(ActorSelectorManager(Dispatchers.IO))
                                  .udp()
                                  .bind(InetSocketAddress(""localhost"",9090))
    while (true) {
        println(server.incoming.receive().packet.readText())
    }
}
</code></pre>

<p>And I don't have problems with it on host/my-pc, but it just not working on docker. It's running, but it don`t receive UDP-packets.</p>

<p>That's my Dockerfile:</p>

<blockquote>
  <p>FROM phusion/baseimage</p>
  
  <p>MAINTAINER cayzerok@gmail.com</p>
  
  <p>EXPOSE 9090/udp</p>
  
  <p>RUN apt-get update &amp;&amp; apt-get install -y default-jre-headless</p>
  
  <p>VOLUME /data</p>
  
  <p>COPY *.jar /app/server.jar</p>
  
  <p>RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*</p>
  
  <p>CMD [""java"", ""-jar"", ""/app/server.jar""] </p>
</blockquote>

<p>And that's my ""docker run"" command:</p>

<blockquote>
  <p>docker run -p 9090:9090/udp cayzerok/sample</p>
</blockquote>

<p>What am I doing wrong? Reason must be in the server, I tested a client with docker-udp-listener.</p>

<p>Thanks for attention!</p>
","10185438","","10185438","","2018-12-25 10:52:29","2018-12-25 10:52:29","Kotlin ktor UDP server + docker issue","<java><docker><kotlin><udp><ktor>","0","1","1","","","53920392","128262","128262","ktor","265","45915935","45915934"
"54158403","1","","","2019-01-12 09:47:06","","1","162","<p>I use Kotlin native for our project, I created a native class for https method for get response from <code>REST API</code> by <code>ktor</code> library, I implemented my code on <code>Common</code> layer I use it in <code>Android</code> &amp; <code>iOS</code> , on <code>Android</code> all of the things is OK and get response but on <code>iOS</code> don't receive any response while don't get any <code>Exception</code>.
I did try and Implemented by 2 diff patterns that first way was used <code>observer</code> and second way is <code>closure</code> but none of the ways don't work on <code>iOS</code></p>

<p>where is my problem?</p>

<p>in <code>common</code> :</p>

<pre><code>fun createRequest(bar: (m: String) -&gt; Unit) {
    val client = HttpClient()
    val call = client.call(""https://google.com"") {
        method = HttpMethod.Get
    }
    bar(call.response.readText())
}
</code></pre>

<p>on <code>iOS</code> project when use :</p>

<pre><code>APICoreKt.createRequest(callback: self) { (s) -&gt; Nothing in
 let lbl = UILabel(frame: CGRect(x: 100, y: 100, width: 100, height: 100));
 lbl.text = s;
 lbl.textColor = UIColor.black;
 self.view.addSubview(lbl);
 return KotlinUnit();

}
</code></pre>
","7149385","","","","","2019-01-12 09:47:06","don't get Http response on Swift by Kotlin Native","<android><ios><ktor><kotlin-native><kotlin-multiplatform>","0","3","","","","54158403","128262","128262","ktor","265","45915935","45915934"
"8816781","1","8817984","","2012-01-11 09:19:05","","2","361","<p>I have to change the structure of all existing documents in one of my CouchDB databases that contain a certain field.
Right now, the field is just a simple String, for example:</p>

<pre><code>{
  // some other fields
  ""parameters"": {
     ""typeId"": ""something"",
     ""otherField"": ""dont_care""
  }
}
</code></pre>

<p>In this example, the field I'm interested is ""typeId"".
I want to make it an array of Strings because the requirements for this was modified :(
But I obviously need to keep the current value of the field in all documents! So, from the example above, the result would be:</p>

<pre><code>{
  // some other fields
  ""parameters"": {
     ""typeId"": [ ""something"" ] // now we can have more items here
     ""otherField"": ""dont_care""
  }
}
</code></pre>

<p>Any ideas how this can be achieved??</p>

<p>Just in case this helps: my Java web-application communicates with CouchDB through the Ektorp library.</p>
","1007991","","","","","2012-01-11 10:49:28","How can I change the structure of all documents in a CouchDB database?","<java><couchdb><ektorp>","1","0","","","","8816781","73833","73833","ektorp","71","7739352","7739351"
"9831628","1","","","2012-03-22 22:41:49","","0","297","<p>Its been a while since i've worked with Java especially exceptions. I'm in the process of adding ektorp couchdb intergration into something i'm working on. However i'm encountering content consumed exceptions.</p>

<p>The program in question uses twitter4j and i'm getting my statuses and writing them to a couchdb instance.</p>

<pre><code>public void putTweet(Status status)
{
    Map&lt;String, Object&gt; newTweetDoc = new HashMap&lt;String, Object&gt;();
    String docname = status.getUser().getName() + "" ""
            + status.getCreatedAt().toString();
    newTweetDoc.put(""_id"", docname);
    newTweetDoc.put(""User"", status.getUser().getName());
    newTweetDoc.put(""Contents"", status.getText());
    newTweetDoc.put(""Created"", status.getCreatedAt().toString());
    newTweetDoc.put(""RetweetCount"", status.getRetweetCount());
    UserMentionEntity[] mentions = status.getUserMentionEntities();
    Map&lt;String, HashMap&lt;String, String&gt;&gt; formattedMentions = formatMentions(mentions);
    newTweetDoc.put(""Mentions"", formattedMentions);
    db.addToBulkBuffer(newTweetDoc);
}
</code></pre>

<p>At first i tried db.create(newTweetDoc) as well. Does the couchdbConnector need to be recreated every time i try this?</p>

<p>db is a global CouchDbConnector:
    public CouchDbConnector db = null;</p>

<pre><code>public CouchTwitter()
{
    //create the db connection etc
}
</code></pre>

<p>It's the db.create(doc) or flushBulkBuffer that results in the error. Here is the stacktrace:</p>

<pre><code>Exception in thread ""main"" java.lang.IllegalStateException: Content has been consumed
at org.apache.http.entity.BasicHttpEntity.getContent(BasicHttpEntity.java:84)
at org.apache.http.conn.BasicManagedEntity.getContent(BasicManagedEntity.java:88)
at org.ektorp.http.StdHttpResponse.releaseConnection(StdHttpResponse.java:82)
at org.ektorp.http.RestTemplate.handleResponse(RestTemplate.java:111)
at org.ektorp.http.RestTemplate.post(RestTemplate.java:66)
at org.ektorp.impl.StdCouchDbConnector.executeBulk(StdCouchDbConnector.java:638)
at org.ektorp.impl.StdCouchDbConnector.executeBulk(StdCouchDbConnector.java:596)
at org.ektorp.impl.StdCouchDbConnector.flushBulkBuffer(StdCouchDbConnector.java:617)
</code></pre>

<p>I see in the above that two seperate Entity classes both call .getContent(), i've been playing around with my referenced libraries recently is it possible that its calling an old apache Http lib as well as the current?</p>
","1076860","","1076860","","2012-03-23 07:41:11","2012-03-23 08:35:07","ektorp couchdb IllegalStateException content consumed","<java><couchdb><illegalstateexception><ektorp>","1","0","","","","9831628","73833","73833","ektorp","71","7739352","7739351"
"10608021","1","10611318","","2012-05-15 20:05:56","","6","3443","<p>I am trying to extend the following class with constructor (from the Ektorp library): </p>

<pre><code>public class CouchDbRepositorySupport&lt;T extends CouchDbDocument&gt; implements GenericRepository&lt;T&gt; {

...

protected CouchDbRepositorySupport(Class&lt;T&gt; type, CouchDbConnector db) {
...

}
</code></pre>

<p>Here's my implementation:</p>

<pre><code>public class OrderRepository extends CouchDbRepositorySupport&lt;Order&lt;MenuItem&gt;&gt; {

    public OrderRepository(CouchDbConnector db) {
        super(Order&lt;MenuItem&gt;.class, db);
</code></pre>

<p>The problem is with the <code>Order&lt;MenuItem&gt;.class</code> part. The Java compiler tells me: </p>

<pre><code> Syntax error on token ""&gt;"", void expected after this 
</code></pre>

<p>I tried with <code>(Order&lt;MenuItem&gt;).class</code>, <code>Order.class</code> and <code>new Order&lt;MenuItem&gt;().getClass()</code> with no better luck.</p>

<p>What can I do to retrieve the .class attribute of a generic class?</p>
","175113","","","","","2012-05-16 02:39:28","Retrieve the .class attribute of a generic class","<java><generics><ektorp>","2","2","","","","10608021","73833","73833","ektorp","71","7739352","7739351"
"54204190","1","","","2019-01-15 17:39:52","","4","1870","<p>I already know how to receive a JSON object and automatically deserialize it into the required format (e.g. with a data class). Also look here: <a href=""https://stackoverflow.com/questions/51449280/how-to-receive-json-object-in-ktor"">How to receive JSON object in Ktor?</a></p>

<p>My problem now is that I want to validate the JSON request and return <code>BadRequest</code> if it's not in the desired format, something like that in Django: <a href=""https://stackoverflow.com/a/44085405/5005715"">https://stackoverflow.com/a/44085405/5005715</a></p>

<p>How can I do that in Ktor/Kotlin? Unfortunately, I couldn't find a solution in the docs. Also, required/optional fields would be nice.</p>
","5005715","","5005715","","2019-01-15 17:45:36","2020-03-22 10:45:27","Ktor: How can I validate JSON request?","<json><kotlin><ktor>","4","2","","","","54204190","128262","128262","ktor","265","45915935","45915934"
"54222268","1","","","2019-01-16 17:24:10","","1","282","<p>I am trying to link my Kotlin/Native project as a framework for iOS. The Kotlin code compiles just fine, but when the linker is run, I get the following error:</p>

<pre><code>Undefined symbols for architecture x86_64:
  ""_kfun:kotlinx.coroutines.AbstractContinuation.getResult$kotlinx-coroutines-core-native()kotlin.Any?"", referenced from:
      _kfun:io.ktor.client.engine.ios.IosClientEngine.execute(io.ktor.client.call.HttpClientCall;io.ktor.client.request.HttpRequestData)io.ktor.client.call.HttpEngineCall in combined.o
ld: symbol(s) not found for architecture x86_64
error: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld invocation reported errors
</code></pre>

<p>I have tried changing the platform from <code>iosX64</code> to <code>iosArm64</code> but it results in the same error. Here is my gradle file for reference just in case I'm missing a dependency.</p>

<pre><code>plugins {
    id 'kotlin-multiplatform' version '1.3.11'
    id 'kotlinx-serialization' version '1.3.0'
}

ext {
    ktor_version = '1.0.1'
    coroutines_version = '1.1.0'
    serialization_version = '0.9.1'
}

repositories {
    maven { url ""https://kotlin.bintray.com/ktor"" }
    maven { url ""https://kotlin.bintray.com/kotlinx"" }
    google()
    jcenter()
    mavenCentral()
}

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android-extensions'

configurations {
    compilerPlugin
}

android {
    compileSdkVersion 27
    defaultConfig {
        applicationId ""org.jetbrains.kotlin.mpp_app_android""
        minSdkVersion 15
        targetSdkVersion 27
        versionCode 1
        versionName ""1.0""
        testInstrumentationRunner ""android.support.test.runner.AndroidJUnitRunner""
    }
    buildTypes {
        release {
            minifyEnabled false
        }
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:27.1.1'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'

}

kotlin {
    targets {
        fromPreset(presets.android, 'android')
        // This preset is for iPhone emulator
        // Switch here to presets.iosArm64 (or iosArm32) to build library for iPhone device
        fromPreset(presets.iosX64, 'ios') {
            compilations.main.outputKinds('FRAMEWORK')
        }
    }
    sourceSets {
        commonMain {
            dependencies {
                implementation 'commons-codec:commons-codec:1.10'
                implementation 'org.jetbrains.kotlin:kotlin-stdlib-common'
                implementation(""io.ktor:ktor-client:$ktor_version"")
                implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-common:$coroutines_version""
                implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime-common:$serialization_version""
            }
        }
        commonTest {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test-common'
                implementation 'org.jetbrains.kotlin:kotlin-test-annotations-common'
            }
        }
        androidMain {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib'
                implementation(""io.ktor:ktor-client-android:$ktor_version"")
                implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-android:$coroutines_version""
                implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime:$serialization_version""
            }
        }
        androidTest {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test'
                implementation 'org.jetbrains.kotlin:kotlin-test-junit'
            }
        }
        iosMain {
            dependencies {
                implementation ""io.ktor:ktor-client-ios_debug_ios_x64:$ktor_version""

                implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-native:$coroutines_version""
                implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime-native:$serialization_version""
            }
        }
        iosTest {
        }
        configure([ios_x86_64Main, ios_arm64Main]) {
            dependsOn iosMain
        }
    }
}

// This task attaches native framework built from ios module to Xcode project
// (see iosApp directory). Don't run this task directly,
// Xcode runs this task itself during its build process.
// Before opening the project from iosApp directory in Xcode,
// make sure all Gradle infrastructure exists (gradle.wrapper, gradlew).
task copyFramework {
    def buildType = project.findProperty(""kotlin.build.type"") ?: ""DEBUG""
    def target = project.findProperty(""kotlin.target"") ?: ""ios""
    dependsOn ""link${buildType.toLowerCase().capitalize()}Framework${target.capitalize()}""

    doLast {
        def srcFile = kotlin.targets.""$target"".compilations.main.getBinary(""FRAMEWORK"", buildType)
        def targetDir = getProperty(""configuration.build.dir"")
        copy {
            from srcFile.parent
            into targetDir
            include 'app.framework/**'
            include 'app.framework.dSYM'
        }
    }
}
</code></pre>

<p>Any help would be greatly appreciated, thanks!</p>
","8338783","","","","","2019-01-24 06:55:47","Linking ktor and kotlinx.coroutines results in undefined symbols","<ios><kotlinx.coroutines><ktor><kotlin-native><kotlin-multiplatform>","1","3","","","","54222268","128262","128262","ktor","265","45915935","45915934"
"54282790","1","","","2019-01-21 02:23:31","","1","250","<p>Below is the basic ktor file which is running properly from IDE but I created a fat jar file with ""mvn install"" and running it throws below exception:</p>

<p>Exception in thread ""main"" java.lang.UnsupportedOperationException: Packages and file facades are not yet supported in Kotlin reflection. Meanwhile please use Java reflection to inspect this class: class com.tech.ApplicationKt</p>

<pre><code>fun main(args: Array&lt;String&gt;){
    embeddedServer(Netty, 8080){
        routing{
            get(""/demo""){
                call.respondText(""Hello demo"")
            }
        }
    }.start(wait = true)
}
</code></pre>

<p>I tried executing jar on Java 11 and 8 but I am getting same exception.</p>
","743191","","","","","2019-01-21 12:55:28","ktor running fat jar throws java.lang.UnsupportedOperationException::Packages and file facades are not yet supported in Kotlin reflection","<kotlin><ktor>","1","1","","","","54282790","128262","128262","ktor","265","45915935","45915934"
"54292222","1","","","2019-01-21 14:37:01","","1","839","<p>I'm attempting to consume Kotlin multiplatform code (that uses Ktor and Kotlin Coroutines) on iOS.  The framework is generated correctly and can invoke some of the classes/methods exposed without any problem.  However if I try to add following (as is done in <a href=""https://github.com/JetBrains/kotlinconf-app/blob/master/konfios/konfswift/ui/UI.swift"" rel=""nofollow noreferrer"">https://github.com/JetBrains/kotlinconf-app/blob/master/konfios/konfswift/ui/UI.swift</a> for example).  I get ""Use of undeclared type 'KotlinCoroutineContext"" (and I see in <code>SharedCode.h</code> that it's not present)</p>

<pre><code>import Foundation
import UIKit
import SharedCode


public class CoroutineDispatcher: Kotlinx_coroutines_core_nativeCoroutineScope {
    override public func dispatch(context: KotlinCoroutineContext, block: Kotlinx_coroutines_core_nativeRunnable) {
        DispatchQueue.main.async {
            block.run()
        }
    }
}
</code></pre>

<p>The gradle file for share code includes following (am using Kotlin 1.3.11, Ktor 1.0.1 and Coroutines 1.0.1 along with Gradle 4.7)</p>

<pre><code>    commonMain.dependencies {
        implementation ""org.jetbrains.kotlin:kotlin-stdlib-common:${Versions.kotlin}""
        implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-common:${Versions.kotlinCoroutines}""
        implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime:${Versions.kotlinxSerialization}""

        implementation ""io.ktor:ktor-client-core:${Versions.ktor}""
        implementation ""io.ktor:ktor-client-json:${Versions.ktor}""

    }

    androidMain.dependencies {
        implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:${Versions.kotlin}""
        implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-android:${Versions.kotlinCoroutines}""

        implementation ""io.ktor:ktor-client-core-jvm:${Versions.ktor}""
        implementation ""io.ktor:ktor-client-json-jvm:${Versions.ktor}""
    }

    iOSMain.dependencies {
        implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-native:${Versions.kotlinCoroutines}""
        implementation ""org.jetbrains.kotlinx:kotlinx-serialization-runtime-native:${Versions.kotlinxSerialization}""

        implementation ""io.ktor:ktor-client-ios:${Versions.ktor}""
        implementation ""io.ktor:ktor-client-core-ios:${Versions.ktor}""
        implementation ""io.ktor:ktor-client-json-ios:${Versions.ktor}""
    }
</code></pre>

<p>I'm suspecting that issue might be that those symbols aren't explicitly exposed (also tried using <code>api</code> instead of <code>implementation</code> for coroutine dependencies but that didn't help).</p>

<p>This is what I have so far: <a href=""https://github.com/joreilly/galway-bus-android/tree/kotlin_native"" rel=""nofollow noreferrer"">https://github.com/joreilly/galway-bus-android/tree/kotlin_native</a></p>

<p><strong>UPDATE</strong>:</p>

<p>Tried newly released Kotlin v1.3.20 but now getting following</p>

<pre><code>&gt; Task :SharedCode:linkMainDebugFrameworkIOS
warning: skipping /Users/jooreill/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-ios_debug_ios_x64/1.0.1/7ac4ac71743dbff041cc51a117e1732a9133d3b8/ktor-client-ios.klib. The abi versions don't match. Expected '[5]', found '2'
warning: the compiler versions don't match either. Expected '[1.1.1]', found '1.0.2-release-4769'
error: compilation failed: Could not find ""/Users/jooreill/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-ios_debug_ios_x64/1.0.1/7ac4ac71743dbff041cc51a117e1732a9133d3b8/ktor-client-ios.klib"" in [/Users/jooreill/devroot/github/galway-bus-android/SharedCode, /Users/jooreill/.konan/klib, /Users/jooreill/.konan/kotlin-native-macos-1.1.1/klib/common, /Users/jooreill/.konan/kotlin-native-macos-1.1.1/klib/platform/ios_x64].
``
</code></pre>
","793861","","793861","","2019-01-24 19:23:21","2019-02-02 05:22:35","Kotlin Multiplatform with iOS: ""Use of undeclared type 'KotlinCoroutineContext'""","<kotlin><ktor><kotlin-multiplatform>","1","2","1","","","54292222","128262","128262","ktor","265","45915935","45915934"
"54327270","1","54981962","","2019-01-23 12:26:54","","3","2090","<p>I am building a simple REST API using ktor and used cors but when i send a simple get request with no headers data the server works fine but if i want the client to have say key:1 the server doesn`t respond me correctly, it says the problem is </p>

<pre><code>Failed to load http://127.0.0.1:8080/test: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access. The response had HTTP status code 403.
</code></pre>

<p>so here is my ktor code     </p>

<pre><code>install(ContentNegotiation) {
        gson {
        }
    }
    install(ForwardedHeaderSupport)
    install(DefaultHeaders)
    install(CORS)
    {
        method(HttpMethod.Options)
        method(HttpMethod.Get)
        method(HttpMethod.Post)
        method(HttpMethod.Put)
        method(HttpMethod.Delete)
        method(HttpMethod.Patch)
        header(HttpHeaders.AccessControlAllowHeaders)
        header(HttpHeaders.ContentType)
        header(HttpHeaders.AccessControlAllowOrigin)
        allowCredentials = true
        anyHost()
        maxAge = Duration.ofDays(1)
    }
...
 get(""test""){
            val a =  call.request.headers[""key""]
            println(a)
            call.respond(Product(name = a))
        }
</code></pre>

<p>and my javascript code looks like this....</p>

<pre><code>fetch('http://shop-ix.uz:8080/test', {
 headers: {
 ""key"": ""1"" 
})
   .then(response =&gt; response.json())
   .then(json =&gt; {    
     console.log(json);
   })
</code></pre>

<p>please help me  </p>
","10955597","","","","","2019-03-04 11:06:16","Access-Control-Allow-Origin issue in ktor cors header","<javascript><kotlin><ktor>","1","4","0","","","54327270","128262","128262","ktor","265","45915935","45915934"
"54374067","1","54379975","","2019-01-25 23:18:36","","0","191","<p>How do you achieve the following using Koin DI:</p>

<pre><code>single { AValidator() } bind IValidator::class
single { BValidator() } bind IValidator::class
single { CValidator() } bind IValidator::class
single { DValidator() } bind IValidator::class
</code></pre>

<p>In the class where I want to have all validators injected I use the following:</p>

<pre><code>val validators: List&lt;IValidator&gt; by inject()
</code></pre>

<p>Expecting that all different implementations of interface <code>IValidator</code> are injected automatically.</p>

<p>I know that is actually supported in Kodein, where you would simply do:</p>

<p><code>val validators: List&lt;IValidator&gt; by kodein.allInstances()</code></p>

<p>Would love to know whether this is possible within Koin.</p>

<p>Thanks!</p>
","6607073","","","","","2020-03-03 13:57:00","How to retrieve all instances that matches a given type using Koin Dependency Injection (Kotlin)","<kotlin><ktor><koin>","2","0","","","","54374067","128262","128262","ktor","265","45915935","45915934"
"54391632","1","54393558","","2019-01-27 18:43:34","","1","541","<p>I'm new in kotlin world. So I have some problem.  I'm using ktor framework and try to use ktor-locations (<a href=""https://ktor.io/servers/features/locations.html#route-classes"" rel=""nofollow noreferrer"">https://ktor.io/servers/features/locations.html#route-classes</a>)
And as example </p>

<pre><code>@Location(""/show/{id}"")
data class Show(val id: Int)

routing {
    get&lt;Show&gt; { show -&gt;
        call.respondText(show.id)
    }
}
</code></pre>

<p>Everything is good, when I try to get <code>/show/1</code>
But if route will be <code>/show/test</code> there is <code>NumberFormatException</code>, cause <code>DefaultConversionService</code> try to convert id to Int and can't do it. 
So my question is, how can I catch this exception and return Json with some error data. For example, if not using locations I can do smt like this</p>

<pre><code>    routing {
        get(""/{id}"") {
            val id = call.parameters[""id""]!!.toIntOrNull()
            call.respond(when (id) {
                null -&gt; JsonResponse.failure(HttpStatusCode.BadRequest.value, ""wrong id parameter"")
                else -&gt; JsonResponse.success(id)
            })
        }
    }
</code></pre>

<p>Thx for help!</p>
","1451189","","","","","2019-01-28 20:45:05","Catch exception in Ktor-locations if non valid route parameter","<kotlin><ktor>","1","0","0","","","54391632","128262","128262","ktor","265","45915935","45915934"
"10672115","1","10680575","","2012-05-20 08:59:08","","0","234","<p>In jcouchdb I used to extend BaseDocument and then, in a transparent manner, mix Annotations and not declared fields.
Example:</p>

<pre><code>import org.jcouchdb.document.BaseDocument;

public class SiteDocument extends BaseDocument {
    private String site;

    @org.svenson.JSONProperty(value = ""site"", ignoreIfNull = true)
    public String getSite() {
        return site;
    }

    public void setSite(String name) {
        site = name;
    }
}
</code></pre>

<p>and then use it:</p>

<pre><code>// Create a SiteDocument
SiteDocument site2 = new SiteDocument();
site2.setProperty(""site"", ""http://www.starckoverflow.com/index.html"");
// Set value using setSite
site2.setSite(""www.stackoverflow.com"");
// and using setProperty
site2.setProperty(""description"", ""Questions &amp; Answers"");
db.createOrUpdateDocument(site2);
</code></pre>

<p>Where I use both a document field (site) that is defined via annotation and a property field (description) not defined, both get serialized when I save document. </p>

<p>This is convenient for me since I can work with semi-structured documents.</p>

<p>When I try to do the same with Ektorp I have documents using annotations and Documents using HashMap BUT I couldn't find an easy way of getting the mix of both (I've tried using my own serializers but this seems to much work for something that I get for free in jcouchdb). Also tried to annotate a HashMap field but then is serialized as an object and I get the fields automatically saved BUT inside an object with the name of the HashMap field.</p>

<p>Is it possible to do (easily/for free) using Ektorp?</p>
","1802671","","","","","2012-05-21 06:45:04","ektorp / CouchDB mix HashMap and Annotations","<couchdb><ektorp>","1","0","","","","10672115","73833","73833","ektorp","71","7739352","7739351"
"10710907","1","10714968","","2012-05-22 22:10:33","","0","430","<p>In jcouchdb there is an util class org.jcouchdb.util.CouchDBUpdater that allows to update documents from your local file system into CouchDB (used for example for copying design documents into CouchDB). Is there anything similar in ektorp?</p>
","1802671","","","","","2012-05-23 07:00:26","ektorp / CouchDB update / synchronize folder","<couchdb><ektorp>","1","0","0","","","10710907","73833","73833","ektorp","71","7739352","7739351"
"10768709","1","10772414","","2012-05-26 18:23:37","","1","906","<p>I have a class which derives from org.ektorp.support.CouchDbDocument:</p>

<pre><code>@TypeDiscriminator( value=""doc.type == 'TYPE_PRODUCT' )
public class Product extends CouchDbDocument { 
....
</code></pre>

<p>There is also a repository class:</p>

<pre><code>public class ProductRepo extends CouchDbRepositorySupport&lt;Product&gt; { ....
</code></pre>

<p>The repository class has a method:</p>

<pre><code>public List&lt;DocumentOperationResult&gt; executeBulk( Set&lt;Product&gt; bulk ) {
    return db.executeBulk( bulk );
}
</code></pre>

<p>The method is used for creating and updating items. Creation goes well. But on update, Ektorp throws this exception:</p>

<pre><code>Caused by: java.lang.IllegalStateException: cannot set id, id already set
    at org.ektorp.support.CouchDbDocument.setId(CouchDbDocument.java:39)
... 18 more
</code></pre>

<p>What I'm doing is sending a set of objects that were initially fetched by a view in the same repository - and of course the objects do have a not-null Id. This of course should not happen, since the object does have an id and must be updated, not created. According to Ektorp documentation, the db.executeBulk should handle both creating and updating documents.</p>

<p>The exception is being thrown in CouchDbDocument.setId:</p>

<pre><code>@JsonProperty(""_id"")
public void setId(String s) {
  Assert.hasText(s, ""id must have a value"");
  if (id != null &amp;&amp; id.equals(s)) {
    return;
  }
  if (id != null) {
    throw new IllegalStateException(""cannot set id, id already set"");
  }
  id = s;
}
</code></pre>

<p>But why ? The object sent do indeed have the Id set (revision is set too), so Ektorp should detect that we're talking about existing objects and not try to generate a new id for them. Anyone know how to this can be fix, or is the solution to ditch Ektorp and go for pure json over http in this case ?</p>

<p>(Project running on Jboss 7.1.1.Final, CouchDB 1.2.0, Ektorp 1.2.2)</p>
","849102","","6731958","","2016-08-26 15:00:36","2016-08-26 15:00:36","BulkUpdate in CouchDB using Java with Ektorp","<java><couchdb><bulk><ektorp>","1","0","0","","","10768709","73833","73833","ektorp","71","7739352","7739351"
"54598173","1","","","2019-02-08 18:19:07","","1","263","<p>I am currently experimenting with app-events in ktor using Netty. However the only hook that is being called is ""ApplicationStarted"". What am i doing wrong here?</p>

<p>I set breakpoints in all of the functions, the subscriptions are being made but not all of the event-listeners are invoked.
Also I tried to find some explanation in the ktor docs but that was not successful.</p>

<pre><code>import io.ktor.application.*

fun Application.events(){
    environment.monitor.subscribe(ApplicationStarting, ::onStarting)
    environment.monitor.subscribe(ApplicationStarted, ::onStarted)
    environment.monitor.subscribe(ApplicationStopping, ::onStopping)
    environment.monitor.subscribe(ApplicationStopped, ::onStopped)
    environment.monitor.subscribe(ApplicationStopPreparing, ::onPrepareStop)
}

private fun onStarting(app: Application){
    app.log.info(""Application starting"")
}
private fun onStarted(app: Application){
    app.log.info(""Application started"")
}
private fun onStopping(app: Application){
    app.log.info(""Application stopping"")
}
private fun onStopped(app: Application){
    app.log.info(""Application stopped"")
}
private fun onPrepareStop(env: ApplicationEnvironment){
    env.log.info(""Preparing App Stop"")
}
</code></pre>

<p>""Application started"" appears in the log messages but no other output.</p>

<p>How bad am I doing, or is this a bug?</p>
","11034691","","","","","2019-02-10 11:38:26","application-level events in ktor not invoked","<kotlin><netty><ktor>","1","0","","","","54598173","128262","128262","ktor","265","45915935","45915934"
"54607219","1","","","2019-02-09 14:35:04","","1","200","<p>I'm trying to build an Android project and am getting this error <em>with</em> Multidex enabled:</p>

<p><code>Caused by: org.gradle.api.tasks.TaskExecutionException: Execution failed for task ':android-simple-host:transformDexArchiveWithDexMergerForDebug'.</code></p>

<p>Here is the build file:</p>

<pre><code>plugins {
    id(""com.android.application"")
    kotlin(""android"")
    kotlin(""android.extensions"")
}

android {
    compileSdkVersion(28)
    defaultConfig {
        applicationId = ""org.tenkiv.kuantify.simple_host""

        minSdkVersion(26)
        targetSdkVersion(28)
        versionCode = 1
        versionName = ""1.0""
        multiDexEnabled = true
        testInstrumentationRunner = ""android.support.test.runner.AndroidJUnitRunner""
    }
    buildTypes {
        getByName(""release"") {
            isMinifyEnabled = false
        }
    }

    sourceSets {
        getByName(""main"").java.srcDirs(""src/main/kotlin"")
        getByName(""test"").java.srcDirs(""src/test/kotlin"")
    }

    packagingOptions {
        pickFirst(""META-INF/**"")
        pickFirst(""tec/units/indriya/format/messages.properties"")
    }
}

dependencies {
    implementation(fileTree(mapOf(""dir"" to ""libs"", ""include"" to listOf(""*.jar""))))
    implementation(project("":android-local""))
    implementation(group = ""io.ktor"", name = ""ktor-server-netty"", version = Vof.ktor)
    testImplementation(group = ""junit"", name = ""junit"", version = Vof.junit)
}
</code></pre>

<p>and I did a build scan that you can view <a href=""https://scans.gradle.com/s/qte6bm2unidg2/dependencies?focusedDependencyView=dependents&amp;toggled=W1s1XSxbNSwwXSxbNSwwLFsyNF1dLFs0XSxbMl0sWzQsMF1d"" rel=""nofollow noreferrer"">here</a> (because the project is quite large).</p>

<p>I am seriously confused as to why this is happening when multiDex is already enabled. My best guess is that there is some sort of library conflict due to the chain of gradle dependencies, but as far as I know, gradle will remove duplicate dependencies when building by default, no?</p>

<p>Any help would be appreciated! </p>

<p><strong>EDIT:</strong> Disabling Android D8 in gradle.properties made the build able to compile, but this isn't a long-term solution. Narrows down the problem a tiny bit, however! (But is still very confusing)</p>
","10365888","","10365888","","2019-02-09 18:13:45","2019-02-09 18:13:45","transformDexArchiveWithDexMergerForDebug error WITH multidex enabled","<android><gradle><netty><ktor><android-d8>","0","0","2","","","54607219","128262","128262","ktor","265","45915935","45915934"
"54679592","1","54685123","","2019-02-13 21:20:08","","0","1306","<p>I have written a common code in a common module as below and tested in JS environment </p>

<pre><code>val response = client.post&lt;HttpResponse&gt;(url) {
    body = TextContent(""""""{""a"":1,""b"":2}"""""", ContentType.Application.Json)
}
if (response.status != HttpStatusCode.OK) {
    logger.error(""Error, this one failed bad?"")
}

</code></pre>

<p>But my code ends at client.post with a canceled corutineException on no network. How do I handle this and any other exception? If there is an internet connection. Nothing fails, I want to be able to handle the exceptions. How? </p>

<p>Note: try, catch doesn't work</p>
","9775278","","","","","2019-02-14 07:24:15","Handling Exception in HttpClient Ktor","<kotlin><ktor><kotlin-multiplatform>","1","0","","","","54679592","128262","128262","ktor","265","45915935","45915934"
"54862859","1","","","2019-02-25 09:16:52","","1","372","<p>I'm trying to build a network module for Multiplatform project with <code>ktor</code>.
My code for <code>GET</code> request is something like this:</p>

<pre><code>val result = httpClient.get&lt;HttpResponse&gt; {
                    url {
                        protocol = baseProtocol
                        host = baseUrl
                        encodedPath = urlPath

                    }
}
</code></pre>

<p>In some point my path contain a user id like this <code>/users/{user_id}</code>.
I can do a search and replace in string and replace this <code>user_id</code> with actual value, BUT is there any other way to do this? any <code>ktor</code> specific way.</p>

<p>For example with <code>Retrofit</code> we have this:</p>

<pre><code>@GET(""users/{user_id}/"")
SomeData getUserData(@Path(""user_id"") String userId);
</code></pre>

<p>EDIT: adding more code</p>

<pre><code>val result = httpClient.get&lt;HttpResponse&gt; {
                    url {
                        protocol = baseProtocol
                        host = baseUrl

                        var requestPath = request.requestPath.value
                        request.path?.forEach {
                            requestPath = requestPath.replace(it.first, it.second)
                        }
                        encodedPath = requestPath

                        if (request.parameters != null) {
                            parameters.appendAll(getParametersFromList(request.parameters))
                        }
                    }
</code></pre>

<p>the <code>request.path?.forEach { requestPath = requestPath.replace(it.first, it.second)}</code> replacing any runtime path value.</p>
","884076","","884076","","2019-02-25 12:15:29","2019-02-25 12:15:29","KTor URLBuilder encodedPath with dynamic path","<android><kotlin><ktor><kotlin-multiplatform>","0","7","","","","54862859","128262","128262","ktor","265","45915935","45915934"
"54919717","1","","","2019-02-28 06:32:06","","3","421","<p>So, I'm build an API System. I want to use KeyCloak for authentication as well as user management because it has a nice access control. I'm integrating it with Ktor and I want my user to use their own UI. Or at least, I want to make the UI.</p>

<p>I've read about Theme Customization but that's not what I want. I also come to know that the KeyCloak UI is tightly integrated within their code. I was just hoping to know if at least when one of the client app is a mobile app, would I be able to use for example android UI for the whole login flow?</p>

<p>If it's not possible which I think it's unlikely to be possible, is there any other library or framework for access control, prefereably one that work with Ktor?</p>
","8843528","","","","","2019-08-15 11:03:24","Is there any way to use KeyCloak authentication without using its UI?","<authentication><kotlin><keycloak><rbac><ktor>","1","2","","","","54919717","128262","128262","ktor","265","45915935","45915934"
"55024144","1","","","2019-03-06 13:22:19","","1","173","<p>I'm having issues integrating with Firestore in the Google App Engine Standard environment (using Java8, Kotlin and Ktor). The Firestore client hangs when I attempt to perform any operation. It works fine when running in the dev appserver but doesn't when running in production.</p>

<p>I'm running:</p>

<ul>
<li>Ktor 1.1.2</li>
<li>Kotlin 1.3.21</li>
<li>com.google.cloud:google-cloud-firestore (version 0.81.0-beta)</li>
<li>Firestore in native mode</li>
</ul>

<p>I've tested with this simple route:</p>

<pre><code>get(""/test"") {
    try {
        val firestore = FirestoreOptions.getDefaultInstance().service
        val user = firestore.collection(""user"").document(""testusername"").get().get()
        call.respond(user.getString(""name"")!!)
    } catch (ex: Exception) {
        call.respond(""Exception: "" + ex)
    }
}
</code></pre>

<p>Visiting <code>/test</code> in a web browser causes the site to hang for a minute before a 500 error is returned.</p>

<p>The following exception is logged in Google Cloud Platform:</p>

<pre><code>[e~website/20190306t125554.416577836925362605].&lt;stdout&gt;: 2019-03-06 13:01:31.306 [RequestEDA5B9B5] ERROR Application - Unhandled: GET - /test
java.lang.InterruptedException: null
    at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:506)
    at com.google.common.util.concurrent.AbstractFuture$TrustedFuture.get(AbstractFuture.java:83)
    at com.google.common.util.concurrent.ForwardingFuture.get(ForwardingFuture.java:62)
    at com.example.MainApplicationKt$run$4$2.invokeSuspend(MainApplication.kt:93)
    at com.example.MainApplicationKt$run$4$2.invoke(MainApplication.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.routing.Routing.executeResult(Routing.kt:148)
    at io.ktor.routing.Routing.interceptor(Routing.kt:29)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:93)
    at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:63)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.CallLogging$Feature$install$2.invokeSuspend(CallLogging.kt:130)
    at io.ktor.features.CallLogging$Feature$install$2.invoke(CallLogging.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invokeSuspend(DefaultEnginePipeline.kt:106)
    at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invoke(DefaultEnginePipeline.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.servlet.KtorServlet$blockingService$1.invokeSuspend(KtorServlet.kt:125)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:32)
    at kotlinx.coroutines.DispatchedKt.resumeCancellable(Dispatched.kt:410)
    at kotlinx.coroutines.intrinsics.CancellableKt.startCoroutineCancellable(Cancellable.kt:25)
    at kotlinx.coroutines.CoroutineStart.invoke(CoroutineStart.kt:109)
    at kotlinx.coroutines.AbstractCoroutine.start(AbstractCoroutine.kt:160)
    at kotlinx.coroutines.BuildersKt__BuildersKt.runBlocking(Builders.kt:52)
    at kotlinx.coroutines.BuildersKt.runBlocking(Unknown Source)
    at io.ktor.server.servlet.KtorServlet.blockingService(KtorServlet.kt:96)
    at io.ktor.server.servlet.KtorServlet.service(KtorServlet.kt:57)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)
    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:848)
    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1772)
    at com.google.apphosting.utils.servlet.JdbcMySqlConnectionCleanupFilter.doFilter(JdbcMySqlConnectionCleanupFilter.java:60)
    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)
    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)
    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)
    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524)
    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)
    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)
    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)
    at com.google.apphosting.runtime.jetty9.ParseBlobUploadHandler.handle(ParseBlobUploadHandler.java:119)
    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1182)
    at com.google.apphosting.runtime.jetty9.AppEngineWebAppContext.doHandle(AppEngineWebAppContext.java:183)
    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)
    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)
    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
    at com.google.apphosting.runtime.jetty9.AppVersionHandlerMap.handle(AppVersionHandlerMap.java:296)
    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)
    at org.eclipse.jetty.server.Server.handle(Server.java:539)
    at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:333)
    at com.google.apphosting.runtime.jetty9.RpcConnection.handle(RpcConnection.java:202)
    at com.google.apphosting.runtime.jetty9.RpcConnector.serviceRequest(RpcConnector.java:81)
    at com.google.apphosting.runtime.jetty9.JettyServletEngineAdapter.serviceRequest(JettyServletEngineAdapter.java:123)
    at com.google.apphosting.runtime.JavaRuntime$RequestRunnable.dispatchServletRequest(JavaRuntime.java:695)
    at com.google.apphosting.runtime.JavaRuntime$RequestRunnable.dispatchRequest(JavaRuntime.java:658)
    at com.google.apphosting.runtime.JavaRuntime$RequestRunnable.run(JavaRuntime.java:628)
    at com.google.apphosting.runtime.JavaRuntime$NullSandboxRequestRunnable.run(JavaRuntime.java:820)
    at com.google.apphosting.runtime.ThreadGroupPool$PoolEntry.run(ThreadGroupPool.java:269)
    at java.lang.Thread.run(Thread.java:748)
</code></pre>

<p>Here are the contents of my application.conf file:</p>

<pre><code>ktor {
    application {
        modules = [com.example.MainApplicationKt.main]
    }
}
</code></pre>

<p>I've tested:</p>

<ul>
<li>Enabling billing</li>
<li>Creating a new project from scratch</li>
<li>Using the com.google.firebase:firebase-admin package (version 6.7.0) instead (with the same result)</li>
<li>Using Datastore instead (which seems to work fine but switching from Firestore would require me to move the whole project and rewrite a lot of code)</li>
</ul>
","981348","","981348","","2019-03-09 10:19:01","2019-11-05 14:13:41","Firestore client hangs when attempting to read data running on App Engine Standard with Ktor/Java8","<firebase><google-app-engine><kotlin><google-cloud-firestore><ktor>","1","4","","","","55024144","128262","128262","ktor","265","45915935","45915934"
"55120675","1","55149200","","2019-03-12 11:43:52","","0","432","<p><strong>I'm using Ktor with KMongo</strong>. I have a problem when I start the server in localhost and I make a simple <strong>'get' request</strong>. The references aren't  very clear and complete - <a href=""https://litote.org/kmongo/"" rel=""nofollow noreferrer"">https://litote.org/kmongo/</a> - regarding the configuration of the database on the server.
Does anyone know how to solve the problem? I think it's a simple configuration problem, but I do not know how to solve it. <strong>I'm not using Spring.</strong></p>

<p>This is the code for the connection to the KmongoDB :</p>

<pre><code>package com.progettoetere.Routes

import io.ktor.application.
import io.ktor.response.respondText
import io.ktor.routing.*
import kotlinx.coroutines.runBlocking

import org.litote.kmongo.eq
import org.litote.kmongo.reactivestreams.*
import org.litote.kmongo.coroutine.*

fun Route.survey(){

    //ramo per i survey
    route(""/survey""){

        //ritorno tutti i questionari
        get(""/""){



                        val client = KMongo.createClient().coroutine //client whit Kotli coroutines
                        val database = client.getDatabase(""test"") //get a test database
                        val colSurvey = database.getCollection&lt;Survey&gt;() //get the collection of surveys

                        //start coroutine
                        runBlocking {

                            //get one survey for DEBUG with id == 1023
                            val dato: Survey? = colSurvey.findOne(Survey::id_survey eq 1023)

                            //check the survey
                            if (dato != null) {
                                call.respondText { ""The survey is present"" }
                            } else {
                                call.respondText { ""The survey is not present"" }
                            }
                        }

}
</code></pre>

<p>The error occurs when I create the client instance :</p>

<blockquote>
  <p>val client = KMongo.createClient().coroutine</p>
</blockquote>

<p>This is the stack error :</p>

<pre><code>2019-03-11 20:58:22.334 [main] INFO  Application - Responding at http://0.0.0.0:8080
2019-03-11 20:58:27.633 [nettyCallPool-4-1] INFO  org.mongodb.driver.cluster - Cluster created with settings {hosts=[localhost:27017], mode=SINGLE, requiredClusterType=UNKNOWN, serverSelectionTimeout='30000 ms', maxWaitQueueSize=500}
2019-03-11 20:58:27.655 [nettyCallPool-4-1] DEBUG org.mongodb.driver.cluster - Updating cluster description to  {type=UNKNOWN, servers=[{address=localhost:27017, type=UNKNOWN, state=CONNECTING}]
2019-03-11 20:58:27.666 [cluster-ClusterId{value='5c86bde3cad88d4f128ae82c', description='null'}-localhost:27017] DEBUG org.mongodb.driver.connection - Closing connection connectionId{localValue:1}
2019-03-11 20:58:27.668 [cluster-ClusterId{value='5c86bde3cad88d4f128ae82c', description='null'}-localhost:27017] INFO  org.mongodb.driver.cluster - Exception in monitor thread while connecting to server localhost:27017
com.mongodb.MongoSocketOpenException: Exception opening socket
    at com.mongodb.internal.connection.AsynchronousSocketChannelStream$OpenCompletionHandler.failed(AsynchronousSocketChannelStream.java:117)
    at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:128)
    at sun.nio.ch.Invoker$2.run(Invoker.java:218)
    at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    at java.lang.Thread.run(Thread.java:748)
Caused by: java.net.ConnectException: Connessione rifiutata
    at sun.nio.ch.UnixAsynchronousSocketChannelImpl.checkConnect(Native Method)
    at sun.nio.ch.UnixAsynchronousSocketChannelImpl.finishConnect(UnixAsynchronousSocketChannelImpl.java:252)
    at sun.nio.ch.UnixAsynchronousSocketChannelImpl.finish(UnixAsynchronousSocketChannelImpl.java:198)
    at sun.nio.ch.UnixAsynchronousSocketChannelImpl.onEvent(UnixAsynchronousSocketChannelImpl.java:213)
    at sun.nio.ch.EPollPort$EventHandlerTask.run(EPollPort.java:293)
</code></pre>
","5892343","","5892343","","2019-03-12 17:34:23","2019-03-13 18:43:54","Problem with the configuration of the Ktor server for Kmongo (Kotlin Server + Mongo)","<mongodb><kotlin><ktor><kmongo>","1","0","0","","","55120675","128262","128262","ktor","265","45915935","45915934"
"10773515","1","","","2012-05-27 11:10:56","","3","794","<p>How can I create an Eclipe Run Configuration that exclude some jars from the classpath?!</p>

<p>BACKGROUND EXPLANATION:</p>

<p>I'm working on webapp that uses Embedded Jetty as Web Server, Ektorp library to fetch data from a CouchDB database, Jersey to provide REST service and GWT for the frontend.</p>

<p>All these four libraries are imported in the same Eclipse project:
- Ektorp, Embedded Jetty and Jersey imported through Maven
- GWT imported with jars</p>

<p>Unfortunately Ektorp and GWT somehow enters in conflict using a different version of the class: org.apache.http.conn.scheme.Scheme</p>

<p>I've tried moving the GWT packages to another project and importing the Jetty/Ektorp/Jersey project but then GWT wasn't able to find the Jersey resources...</p>

<p>So reformulating the question for this specific project:</p>

<p>How can I create an Eclipe Run Configuration that runs the Embedded Jetty server and excludes the GWT jars from the classpath?!</p>

<p>Thanks!</p>
","373542","","","","","2017-01-08 13:52:37","Eclipse run configuration that excludes jars from classpath","<eclipse><gwt><jar><jersey><ektorp>","1","0","0","","","10773515","73833","73833","ektorp","71","7739352","7739351"
"11174266","1","11180728","","2012-06-24 01:07:16","","4","2046","<p>I am struggling to differentiate between all of the different couch* technologies that are out there. I've been flip-flopping between using CouchDB and using Couchbase Server for an Android game that I'm developing and the lack of documentation is frustrating.</p>

<p><strong>My understanding of the technologies:</strong></p>

<ul>
<li><p><em>CouchDB</em> - A no-SQL database that has been under development for the last few years and is communicated with using a RESTful API. It has
been abandoned by its chief developers in favor of working on
Couchbase Server.</p></li>
<li><p><em>Couchbase Server</em> - An enterprise solution to a large database where low-latency is paramount. It keeps 'hot' data in memory using
memcached but data is persisted to a CouchDB database.</p></li>
<li><p><em>Couchbase Mobile</em> - A mobile implementation of CouchDB  <strong>&lt;--Legacy</strong></p></li>
<li><p><em>TouchDB</em> - A mobile implementation of CouchDB.</p></li>
<li><p><em>Ektorp</em> - A framework that allows a developer to talk to and sync with a CouchDB instance from Java.</p></li>
</ul>

<p>What's missing in my list is a framework to talk to <strong>Couchbase Server</strong> from <strong>Android</strong> (and eventually iOS).</p>

<p>Does such a framework exist?</p>
","719919","","","","","2012-10-01 07:51:00","How do I sync my Android application with Couchbase Server?","<android><couchdb><couchbase><ektorp><touchdb>","2","0","2","","","11174266","73833","73833","ektorp","71","7739352","7739351"
"11218816","1","","","2012-06-27 03:00:31","","0","526","<p>I have been using the Ektorp (1.3.0) framework to connect to my CouchDB databases.
There is a problem when there's update conflicts though.
I am using the method  <code>executeAllOrNothing</code> for bulk updates. As documented, this method (as well as the HTTP API equivalent  <code>_bulk_docs?all_or_nothing"":true</code> does not make any checks for conflicts. From the <a href=""http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Transactional_Semantics_with_Bulk_Updates"" rel=""nofollow"">HTTP API docs</a>:</p>

<blockquote>
  <p>However if the document with id 0 had a conflict, both versions will
  be present in the database, with an arbitrary choice made as to which
  appears in views. You can check for this status using a GET with
  ?conflicts=true</p>
</blockquote>

<p>Also:</p>

<blockquote>
  <p>Applications that rely on this functionality should be able to
  tolerate some documents missing or being in a conflicted state until
  conflict resolution can occur.</p>
</blockquote>

<p>However, the Ektorp's javadocs for the method say that:</p>

<blockquote>
  <p>The list (returned) will only contain entries for documents that has any kind of error code returned from CouchDB. i.e. the list will be empty if everything was completed successfully.</p>
</blockquote>

<p>I have found that this is not the case. When conflicts occur, Ektorp still returns an empty list. The only way I found to get the list of failed operations was by using <code>executeBulk</code> rather than <code>executeAllOrNothing</code>, but this is not satisfactory as I need this to be a transaction.</p>

<p>Is there any way I can get to know whether the call to <code>executeAllOrNothing</code> succeeded, and if it didn't, what documents had conflict problems (without recurring to using <code>GET with conflicts=true</code> for each doc as I can potentially attempt to save thousands of documents at once, so this would be impractical)?</p>
","1007991","","","","","2012-06-27 23:09:51","Bulk updates in CouchDB-Ektorp - shouldn't update conflicts be returned?","<couchdb><ektorp>","1","0","","","","11218816","73833","73833","ektorp","71","7739352","7739351"
"55161180","1","","","2019-03-14 11:19:22","","0","178","<p>Now I have ktor server is based on netty.
When I do to long GET request (about 9300 characters (mostly in query params)), ktor answers <code>Unhandled: GET - /bad-request</code>.
If I reduce length of url, it works fine.</p>
","8067254","","","","","2019-03-14 14:06:11","How to increase max length of acceptable url for ktor?","<kotlin><netty><ktor>","1","0","","","","55161180","128262","128262","ktor","265","45915935","45915934"
"55290508","1","55382538","","2019-03-21 23:03:28","","1","319","<p>I have a kotlin multiplatform project targeting Android and iOS and recently integrated ktor so that the shared library can load web resources. It's working on iOS, but on Android I get this error:</p>

<p><code>java.lang.NoClassDefFoundError: Failed resolution of: Lio/ktor/client/HttpClientJvmKt</code></p>

<p>I'm guessing my build pipeline is creating a jar that doesn't contain all the dependencies that ktor needs. So I'm trying to make a fat jar using the gradle shadow plugin (<code>com.github.jengelman.gradle.plugins:shadow:2.0.4</code>). Here is my task:</p>

<pre><code>task shadowJar(type: com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
    from kotlin.targets.android.compilations.main.output
    def runtimeClasspath = kotlin.targets.android.compilations.main.runtimeDependencyFiles
    configurations = [runtimeClasspath]
    baseName = 'myproject-android-shadow'
    exclude 'META-INF/*'
    exclude '*.kotlin_metadata'
}
</code></pre>

<p>The jar jumped up from 300Kb to 8.5Mb.</p>

<p>The result is a new error: <code>More than one file was found with OS independent path 'kotlinx/coroutines/CoroutineExceptionHandler.kotlin_metadata'</code></p>

<p>You'll notice I've tried excluding files from the <code>shadowJar</code>, but it's not working.</p>
","1804727","","","","","2019-03-27 16:49:36","Fat jar problem with Ktor and Kotlin multiplatform","<gradle><ktor><kotlin-multiplatform><gradle-shadow-plugin>","1","0","","","","55290508","128262","128262","ktor","265","45915935","45915934"
"55292244","1","","","2019-03-22 02:55:09","","0","278","<p>For my study I have an small API to developp using Kotlin and Ktor.
The goal is to show JSON informations when launching the application. The information should be seen when we have <a href=""http://127.0.0.1:8080/course/"" rel=""nofollow noreferrer"">http://127.0.0.1:8080/course/</a>{id} in our web browser. The id is some course id which can only be egal to 1,2,3 if the id is different than an error message is shown on the browser.</p>

<p>My code today is </p>

<pre><code>fun main(args: Array&lt;String&gt;): Unit = 
io.ktor.server.netty.EngineMain.main(args)

@Suppress(""unused"") // Referenced in application.conf
@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {


install(ContentNegotiation) {
    jackson {
        enable(SerializationFeature.INDENT_OUTPUT)
    }
}

routing {
    get(""/"") {
        call.respondText(""Welcome to OpenClassrooms brand new server !"", contentType = ContentType.Text.Plain)
    }

    get(""/course/top"") {
        call.respond(mapOf(""id"" to courses[0].id, ""title"" to courses[0].title, ""level"" to courses[0].level, ""isActive"" to courses[0].isActive))
    }

    for (i in 0..2){
        get(""/course/${i.addOneToInt()}"") {
            call.respond(mapOf(""id"" to courses[i].id, ""title"" to courses[i].title, ""level"" to courses[i].level, ""isActive"" to courses[i].isActive))
        }
    }
}
}

data class Course(val id: Int, val title: String, val level: Int, val isActive: Boolean)

val courses = Collections.synchronizedList(listOf(
Course(1, ""How to troll a Troll?"",5,true),
Course(2, ""Kotlin for Troll"",1,true),
Course(3, ""Kotlin vs Java"",3,true))
)
</code></pre>

<p>I am not very friendly with kotlin and ktor. The application is working for the moment but I do not know how to cover the error message when id is not egal to 1,2,3.
if I have <a href=""http://127.0.0.1:8080/course/4"" rel=""nofollow noreferrer"">http://127.0.0.1:8080/course/4</a> for example i have an error saying that the website page is invalid. I would like to show instead :</p>

<pre><code>call.respond(mapOf(""status"" to ""404"", ""message: no course found!""))
</code></pre>

<p>Could someone help me ?</p>

<p>Thanks</p>
","9957478","","","","","2019-04-22 18:37:20","Kotlin Ktor API","<kotlin><ktor>","2","0","","","","55292244","128262","128262","ktor","265","45915935","45915934"
"55326700","1","","","2019-03-24 17:46:56","","0","690","<p>I'm trying to create Server-client connection using sockets. Server is just an Echo-server. I want to send different types of data there. I've started with Images. What I want to achieve is :</p>

<ol>
<li>Parse image stored in the assets folder to appropriate data type</li>
<li>Send it to Echo Server</li>
<li>Receive data back on the mobile (client) site</li>
<li>Display an image send that way (to be sure, data was send correctly)</li>
</ol>

<p>I've implemented both Client and Server. Client is in Flutter, Server in Ktor. 
Server implementation was copied from tutorial: <a href=""https://ktor.io/servers/raw-sockets.html"" rel=""nofollow noreferrer"">https://ktor.io/servers/raw-sockets.html</a>.
What I can see, is that my server is receiving an image and sending it back correctly, but I am not able to show it.</p>

<p>Server code : </p>

<pre><code>fun main() {
    runBlocking {
        val server = aSocket(ActorSelectorManager(Dispatchers.IO)).tcp().bind(InetSocketAddress(""localhost"", 8080))
        println(""Started echo telnet server at ${server.localAddress}"")

        while (true) {
            val socket = server.accept()

            launch {
                println(""Socket accepted: ${socket.remoteAddress}"")

                val input = socket.openReadChannel()
                val output = socket.openWriteChannel(autoFlush = true)

                try {
                    while (true) {
                        val line = input.readUTF8Line()

                        line?.let {
                            println(""Client sent: $line"")
                            output.writeStringUtf8(it)
                        }
                    }
                } catch (e: Throwable) {
                    println(""Closing socket"")
                    e.printStackTrace()
                    socket.close()
                }
            }
        }
    }
}
</code></pre>

<p>and Client:</p>

<pre><code>class MyHomePage extends StatefulWidget {
  final String title;

  MyHomePage({Key key, @required this.title}) : super(key: key);

  @override
  _MyHomePageState createState() =&gt; _MyHomePageState();
}

class _MyHomePageState extends State&lt;MyHomePage&gt; {
  Socket _socket;
  List&lt;int&gt; _connectionTimes = [];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
          child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        crossAxisAlignment: CrossAxisAlignment.center,
        children: &lt;Widget&gt;[
          RaisedButton(
            child: const Text('Connect to socket'),
            color: Theme.of(context).accentColor,
            elevation: 4.0,
            onPressed: () {
              closeSocket();
              _connectToSocket().then((createdSocket) {
                setState(() {
                  _socket = createdSocket;
                });
              });
            },
          ),
          RaisedButton(
            child: const Text('Send to socket'),
            color: Theme.of(context).accentColor,
            elevation: 4.0,
            onPressed: () {
              _sendMessage();
            },
          ),
          StreamBuilder(
            stream: _socket,
            builder: (context, snapshot) {
              if(snapshot.hasData) {
                final bytes = base64Decode(utf8.decode(snapshot.data));
                return Image.memory(bytes);
              } else {
                return Text(""no image"");
              }
            },
          ),
        ],
      )),
    );
  }

  Future&lt;Socket&gt; _connectToSocket() async {
    final stopwatch = Stopwatch()..start();
    Socket sock = await Socket.connect('10.0.2.2', 8080);
    print(""Connection time was ${stopwatch.elapsedMilliseconds}"");
    return sock;
  }

  void _sendMessage() async{
    final imageBytes = await rootBundle.load('assets/images/dog.jpeg');
    final bytesAsString = base64Encode(imageBytes.buffer.asUint8List(imageBytes.offsetInBytes, imageBytes.lengthInBytes));
    print(bytesAsString);
    _socket.write(bytesAsString+""\n"");
  }

  void closeSocket() {
    if (_socket != null) {
      _socket.close();
    }
  }

  @override
  void dispose() {
    _socket.close();
    super.dispose();
  }
}
</code></pre>

<p>The error i receive is :</p>

<pre><code>E/flutter ( 8235): [ERROR:flutter/lib/ui/painting/codec.cc(97)] Failed decoding image. Data is either invalid, or it is encoded using an unsupported format.
I/flutter ( 8235): ══╡ EXCEPTION CAUGHT BY IMAGE RESOURCE SERVICE ╞════════════════════════════════════════════════════
I/flutter ( 8235): The following _Exception was thrown resolving an image codec:
I/flutter ( 8235): Exception: operation failed
I/flutter ( 8235): ════════════════════════════════════════════════════════════════════════════════════════════════════
</code></pre>

<p>And in addition I have some more questions:</p>

<ol>
<li><p>Is there a better way to parse image from assets in Flutter?</p></li>
<li><p>Is there a way to send this data without adding <code>\n</code> at the end of an image data?</p></li>
<li><p>Is it possible that image would be too large, and I wouldn't be able to send it in one request? If yes, what should I change in code to make it work? Divide it to several calls and use buffer on both client and server?</p></li>
<li><p>What should I change in server code, that would allow me to run it once, and connect and disconnect with single client multiple times? (It's annoying, that with every change I make to the Flutter code, I have to rerun server so it works correctly?</p></li>
</ol>

<p>I'm open for changing server implementation to another framework / language. I want to use Flutter, but it doesn't have to be Ktor on Server site. Just wanted to check it in action.</p>
","8713068","","","","","2019-03-25 02:13:50","Displaying image in Flutter, send through socket connection","<sockets><dart><flutter><base64><ktor>","1","3","","","","55326700","128262","128262","ktor","265","45915935","45915934"
"55337508","1","","","2019-03-25 12:10:43","","3","725","<p>I'm having trouble sending an http request which has a File as one of the parameters in the body. The response returned by the API is not what I'm expecting so I figure something is wrong with the code.</p>

<pre><code>suspend fun post(url: String, bodyParameters: MutableMap&lt;String, Any&gt;, headerParameters:
    MutableMap&lt;String, String&gt;? = null): HttpResponse?{

        val client = HttpClient()

        try {
            val call = client.call(url) {
                method = HttpMethod.Post
                body = MultiPartFormDataContent(
                    formData {
                        bodyParameters.forEach{(key, value) -&gt;
                            when(value) {
                                is String -&gt; {
                                    append(key, value)
                                }

                                is File -&gt; {
                                    append(key, value.inputStream().asInput())
                                }
                            }
                        }
                    }
                )
            }
            if(call.response.status.value == 500) {
                return null
            }
            return call.response

</code></pre>

<p>The response status that is being returned is what is expected when no File is being sent. Any ideas on why this doesn't work?
Are there any other ways to do this with Ktor?</p>
","11254711","","","","","2019-03-25 12:10:43","Post request with an image using Ktor client","<kotlin><ktor>","0","4","1","","","55337508","128262","128262","ktor","265","45915935","45915934"
"55373266","1","","","2019-03-27 09:01:26","","0","89","<p>I'm building a microservice in Ktor. While we are working within the application module, Ktor provides access to the <code>call</code> object which contains authorization data.</p>

<p>My problem is that I need to access the <code>call</code> object from a service-level class. In Spring, you would do this by accessing the <code>SecurityContext</code> which is globally available via a <code>ThreadLocal</code>. Ktor, being coroutine-driven, does not have that option.</p>

<p>Do I really need to pass down the <code>call</code> object through my service layer methods, or is there a way in Ktor to have some sort of ""call context"" object that you can access from anywhere?</p>
","3094906","","","","","2019-03-27 09:01:26","How to make request-bound data globally available in Ktor?","<kotlin><kotlin-coroutines><ktor>","0","2","","","","55373266","128262","128262","ktor","265","45915935","45915934"
"55405519","1","","","2019-03-28 19:29:55","","0","238","<p>I am using <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">Ktor</a> in my Koltin/Java class after requiring the Netty framework.</p>

<p>My current WebServer.kt class looks like this:</p>

<pre><code>fun init(serviceProperties: ServerProperties) {

    val route = Routing(serviceProperties)

    val env = applicationEngineEnvironment {
        module {
            main()
        }

        connector {
            host = route.getInternalAddress()
            port = route.getPort()
        }

        connector {
            host = route.getExternalAddress()
            port = route.getPort()
        }
    }

    embeddedServer(Netty, env)
        .start(wait = true)
}
</code></pre>

<p>My method to handle all of the requests looks like this:</p>

<pre><code>private fun Application.main() {
    install(CORS)
    routing {
        get(""/"") {
            call.respondText (""Test"", ContentType.Text.Plain)
        }
    }
}
</code></pre>

<p>Extra information:</p>

<pre><code>route.getInternalAddress() // 192.168.0.18 &lt;-- (IPV4 IP) trying to test
route.getExternalAddress() // 0.0.0.0 &lt;-- not yet needed
route.getPort() // 8080
</code></pre>

<p>My output looks like this:</p>

<pre><code>WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by io.netty.util.internal.PlatformDependent0 (file:/C:/Users/Kye/.gradle/caches/modules-2/files-2.1/io.netty/netty-all/4.0.34.Final/e1e53fb0283cc6fbc0f3631e60f658ddebcf005/netty-all-4.0.34.Final.jar) to field java.nio.Buffer.address
WARNING: Please consider reporting this to the maintainers of io.netty.util.internal.PlatformDependent0
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
[19:18:46.084 INFO ] Application          | No ktor.deployment.watch patterns specified, automatic reload is not active
[19:18:46.256 INFO ] Application          | Responding at http://192.168.0.18:8080
[19:18:46.256 INFO ] Application          | Responding at http://0.0.0.0:8080
</code></pre>

<p>When I head over to <code>http://192.168.0.18:8080/</code> I get</p>

<blockquote>
  <p>192.168.0.18 didn’t send any data <br />
  ERR_EMPTY_RESPONSE</p>
</blockquote>

<p>What am I doing wrong?</p>
","5897602","","502381","","2019-03-28 21:09:47","2019-03-28 21:09:47","REST API is returning an empty response in Ktor","<java><gradle><kotlin><netty><ktor>","0","17","","","","55405519","128262","128262","ktor","265","45915935","45915934"
"55412555","1","","","2019-03-29 07:37:45","","0","151","<p>The below snippet is taken from the <a href=""https://ktor.io/quickstart/index.html"" rel=""nofollow noreferrer"">quick start</a> on the Ktor website.</p>

<pre><code>val server = embeddedServer(Netty, port = 8080) {
    routing {
        get(""/"") {
             call.respondText(""Hello World!"", ContentType.Text.Plain)
        }
        get(""/demo"") {
             call.respondText(""HELLO WORLD!"")
        }
}
server.start(wait = true)
</code></pre>

<p>My console output looks like this</p>

<pre><code>[07:32:13.144 INFO ] application          | No ktor.deployment.watch patterns specified, automatic reload is not active
[07:32:13.308 INFO ] application          | Responding at http://0.0.0.0:8080
</code></pre>

<p>I looked at <a href=""https://stackoverflow.com/questions/52652549/ktor-netty-server-sending-an-empty-response"">this question</a> and tried adding <code>host = localhost</code> but this did not fix my issue. I am accessing the link <code>http://127.0.0.1:8080/demo</code> like the quick start page directs but am getting <code>ERR_EMPTY_RESPONSE</code>.</p>

<p>I have also tried to send a <code>curl -i http://127.0.0.1/demo</code> request from the same machine but receive <code>(52) Empty reply from server</code>.</p>
","5897602","","","","","2019-03-29 07:37:45","Ktor Netty Server is returning empty response","<java><netty><ktor>","0","2","","","","55412555","128262","128262","ktor","265","45915935","45915934"
"55441531","1","55441720","","2019-03-31 13:43:02","","1","362","<p>I'm establishing a websocket connection from the client like this:</p>

<pre><code>val client = HttpClient(CIO).config {
    install(WebSockets)
}

client.webSocket(
        method = HttpMethod.Get,
        host = ""127.0.0.1"",
        port = 8080,
        path = ""/api"") {

    // Send and receive messages
}
</code></pre>

<p>What I would like to do is add http headers to this request.</p>

<p>Ktor has a pretty length documentation, but despite this I am not able to locate how to do this.</p>
","723090","","","","","2019-03-31 14:04:57","Set custom headers to websocket request (ktor)","<kotlin><websocket><http-headers><ktor>","1","0","","","","55441531","128262","128262","ktor","265","45915935","45915934"
"55693847","1","55697043","","2019-04-15 16:46:59","","1","186","<p>I am trying to receive an image using a Ktor server, and process it, all the Android libraries aren't working as they use things like BitmapFactory, java.awt.* , Buffered images and etc.
Does Ktor have any set of tools to process images? 
What I am trying to achieve is to receive an image and resize it.</p>
","7480451","","","","","2020-03-07 18:52:51","Process Images and resize them on a Ktor server","<kotlin><ktor>","1","0","","","","55693847","128262","128262","ktor","265","45915935","45915934"
"55735909","1","","","2019-04-17 21:02:01","","1","56","<p>I am working on some code where I create a HikariDataSource as a by lazy value. I did apply the mode LazyThreadSafetyMode.SYNCHRONIZED, so I am confused as to why the initialization is done twice when I spin up a new thread that reads that value</p>

<pre><code>// in module database
val dataSource: HikariDataSource by lazy(LazyThreadSafetyMode.SYNCHRONIZED) {
    HikariDataSource(dataSourceConfig(databaseConfig))
}

fun initDatabase() {
  dataSource.connect().let { //do stuff}
}

// in main module
fun main() {
  initDatabase()
  thread {
    dataSource.connect().let { // initializes a new data source... }
  }
}
</code></pre>

<p>I would expect the HikariDataSource to be initialized once, but for some reason its called twice...
I think the fact that I am exposing that variable to another gradle project might affect it, but not sure why..</p>
","5066424","","5066424","","2019-04-17 21:11:31","2019-04-17 21:11:31","Why is lazy variable initialised multiple times per thread","<kotlin><ktor>","1","0","","","","55735909","128262","128262","ktor","265","45915935","45915934"
"55747196","1","55771250","","2019-04-18 13:34:53","","2","256","<p>In ktor, it appears the way to do customized permissions checks is through interceptors, like so:</p>

<pre><code>route(""/portal"") {
   route(""articles"") { … }
   route(""admin"") {


    intercept(ApplicationCallPipeline.Features) { … } // verify admin privileges
      route(""article/{id}"") { … } // manage article with {id}
      route(""profile/{id}"") { … } // manage profile with {id}
   }
}
</code></pre>

<p>What is the best way to extract the interceptor logic for reuse for other routes elsewhere in the codebase?</p>
","4043633","","","","","2019-04-20 12:32:50","How to create reusable interceptors in ktor?","<kotlin><routing><ktor>","1","0","0","","","55747196","128262","128262","ktor","265","45915935","45915934"
"11516713","1","","","2012-07-17 05:52:17","","2","1064","<p>I am using a simple batched fetch and update on couchdb.</p>

<pre><code>    int batchSize = 5000;
    String startKey = """";
    List&lt;FrontLineWorker&gt; frontLineWorkers;

    while (true) {
        frontLineWorkers = allFrontLineWorkers.getMsisdnsFrom(startKey, batchSize);

        if (frontLineWorkers.size() &lt; batchSize) break;

        for (FrontLineWorker frontLineWorker : frontLineWorkers) {
            // process record, only updates record
        }

        startKey = frontLineWorkers.get(frontLineWorkers.size() - 1).getMsisdn();
    }
</code></pre>

<p>The getMsisdnsFrom is a couch query, and it starts to time out after a few times. I know that couch indexes views only when a read is done, but since I only update the records it should not affect indexes. Also since this is an expected use, get a set of records, modify and get the next set, I don't expect it to time out.</p>

<p>I've tried with both batch times 1000 and 5000.</p>

<p>Exception message is : Exception in thread ""main"" org.ektorp.DbAccessException: java.net.SocketTimeoutException: Read timed out</p>

<p>EDIT: It worked after I reduced the batch size to 100, but I would have preferred a higher batch size.</p>
","1383699","","1383699","","2012-07-17 12:08:13","2012-07-17 16:54:52","couchdb query timing out when run in a batch with continuous updates","<java><database><nosql><couchdb><ektorp>","2","0","","","","11516713","73833","73833","ektorp","71","7739352","7739351"
"11527674","1","12589366","","2012-07-17 17:25:09","","2","856","<p>For client requests to ektorp / couchdb I would like to pass JSON back to the client.
(Why not use couchdb direktly? Because I have to do some tweeks to the data on a Java layer inbetween.)</p>

<p>So is there for example a way to get JSON data from a CouchDbRepositorySupport queryView?</p>
","512183","","","","","2012-09-25 18:56:55","JSON response from ektorp / couchdb","<json><couchdb><ektorp>","2","0","","","","11527674","73833","73833","ektorp","71","7739352","7739351"
"11620483","1","11620526","","2012-07-23 21:03:31","","2","337","<p>I am using <a href=""https://github.com/helun/Ektorp"" rel=""nofollow"">Ektorp</a> (Java API for CouchDB) to store documents in my CouchDB instance.  I am having trouble attaching images to documents. Every time I call <code>createAttachment()</code> it throws an <code>ClientProtocolException</code>.</p>

<p>Code Sample:</p>

<pre><code>AttachmentInputStream attachment =
    new AttachmentInputStream(attachmentId,
                              fileInputStream,
                              contentType,
                              file.length());
String rev = db.createAttachment(doc.getId(), attachment));
</code></pre>

<p>Does anyone know what's going wrong?</p>
","1546871","","418183","","2012-07-23 21:48:12","2012-07-23 21:48:12","ClientProtocolException when calling createAttachment using Ektorp to interface with CouchDB","<java><couchdb><ektorp>","1","0","","","","11620483","73833","73833","ektorp","71","7739352","7739351"
"12415211","1","","","2012-09-13 21:43:36","","0","232","<p>how can I instantiate a Pojo from a couchdb document even if fields are missing in the document - how can I tell ektorp to ignore the field it in this case?</p>
","512183","","","","","2012-09-14 06:58:41","using couchdb from java through ektorp resiliently","<java><couchdb><pojo><ektorp>","1","0","","","","12415211","73833","73833","ektorp","71","7739352","7739351"
"12550873","1","","","2012-09-23 08:37:53","","1","199","<p>I have been getting an error with DocumentReferences in a small JSF project i created to learn CouchDB/Ektorp .
I belive everything is working as is should in the CRUD, the id of the parent document is stored as a string, similar to the tutorial project.
But when I retrieve the parent object from the database I get this error:</p>

<pre><code>org.codehaus.jackson.map.JsonMappingException: Can not instantiate value of type 
[simple type, class com.pro.documents.Apple] from JSON String; no single-String 
constructor/factory method (through reference chain: com.pro.documents.Eiere[""apple""]) 
</code></pre>

<p>Here is the rest of the code:</p>

<pre><code>{
   ""_id"": ""_design/Eiere"",
   ""_rev"": ""17-ebb06b0d3102622a3d9849b9399cd94f"",
   ""language"": ""javascript"",
   ""views"": {
       ""all"": {
           ""map"": ""function(doc){if (doc.type == 'eiere') {emit(doc._id, doc);}}""
       },
       ""ektorp_docrefs_apple"": {
           ""map"": ""function(doc){ if(doc.eiere){emit([doc.eiere, 'apple', doc.kategori], null);}}""
       }
   } 
}

{
   ""_id"": ""_design/Apple"",
   ""_rev"": ""8-e04d8b5633776545b9eacdc998db4aea"",
   ""language"": ""javascript"",
   ""views"": {
       ""all"": {
           ""map"": ""function(doc){ if(doc.type == 'apple'){emit(doc._id, doc);}}""
       }
   } 
}


public class Eiere extends CouchDbDocument {

    @TypeDiscriminator
    private String type;
    private String navn;
    private String telefon;
    @DocumentReferences(backReference = ""eiere"", fetch = FetchType.LAZY, descendingSortOrder = true)
    private Set&lt;Apple&gt; apple;
    private Date dateCreated;

    public Set&lt;Apple&gt; getApple() {
        return apple;
    }

    public void setApple(Set&lt;Apple&gt; apples) {
        this.apple = apples;
    }

    public void addApple(Apple c) {
        Assert.notNull(c, ""Apple may not be null"");
        if (getApple() == null) {
            apple = new TreeSet&lt;Apple&gt;();
        }
        c.setEiere(this.getId());
        apple.add(c);
    }

    public String getType() {
        if (type == null) {
            type = ""eiere"";
        }
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public String getNavn() {
        return navn;
    }

    public void setNavn(String navn) {
        this.navn = navn;
    }

    public String getTelefon() {
        return telefon;
    }

    public void setTelefon(String telefon) {
        this.telefon = telefon;
    }

    public Date getDateCreated() {
        return dateCreated;
    }

    public void setDateCreated(Date dateCreated) {
        this.dateCreated = dateCreated;
    }
}

public class Apple extends CouchDbDocument implements Comparable&lt;Apple&gt;{

    private static final long serialVersionUID = 1L;
    @TypeDiscriminator
    private String type;
    private List&lt;String&gt; prices;
    private String kategori;
    private String eiere;
    private Date dateCreated;

    public String getType() {
        if(type == null){
            type = ""apple"";
        }
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public List&lt;String&gt; getPrices() {
        if(prices == null){
            prices = new ArrayList&lt;String&gt;();
            prices.add(0, "" "");
            prices.add(1, "" "");
            prices.add(2, "" "");
        }
        return prices;
    }

    public void setPrices(List&lt;String&gt; prices) {
        this.prices = prices;
    }

    public String getKategori() {
        return kategori;
    }

    public void setKategori(String kategori) {
        this.kategori = kategori;
    }

    public String getEiere() {
        return eiere;
    }

    public void setEiere(String eiere) {
        this.eiere = eiere;
    }

    @Override
    public String toString() {
        return prices.toString();
    }

    public Date getDateCreated() {
        return dateCreated;
    }

    public void setDateCreated(Date dateCreated) {
        this.dateCreated = dateCreated;
    }

    @Override
    public int compareTo(Apple other) {
        if (other == this) return 0;
        if (dateCreated != null) {
            return - dateCreated.compareTo(other.dateCreated);  
        }
        return 0;
    }
}
</code></pre>

<p>Any help or advice to help me understand what I'm doing wrong will be much appreciated.</p>

<p>Edit: If there is any information that I could add that would make my problem clearer or help in determining the cause of it please let me know.</p>

<p>Br. </p>
","1659264","","1659264","","2012-09-24 10:10:56","2012-09-24 10:10:56","Error when using DocumentReferences with Ektorp and JSF","<java><jsf-2><couchdb><jackson><ektorp>","0","2","","","","12550873","73833","73833","ektorp","71","7739352","7739351"
"12914769","1","","","2012-10-16 12:30:49","","3","716","<p>I am facing an issue with Bulk Update on a list of documents in Cloudant DB (CouchDB) using Ektorp executeBulk &amp; ExecuteAllOrNothing functions.</p>

<p>For <code>couchDbConnector.executeAllOrNothing(List&lt;?&gt; list)</code>, I am getting error as follows:</p>

<pre><code>org.ektorp.DbAccessException: 417:Expectation Failed
URI: /let-ut-app/_bulk_docs
Response Body: 
null
    at org.ektorp.http.StdResponseHandler.createDbAccessException(StdResponseHandler.java:44)
    at org.ektorp.http.StdResponseHandler.error(StdResponseHandler.java:62)
    at org.ektorp.http.RestTemplate.handleResponse(RestTemplate.java:98)
    at org.ektorp.http.RestTemplate.post(RestTemplate.java:61)
    at org.ektorp.impl.StdCouchDbConnector.executeBulk(StdCouchDbConnector.java:536)
    at org.ektorp.impl.StdCouchDbConnector.executeAllOrNothing(StdCouchDbConnector.java:494)
</code></pre>

<p>and if I change the same logic to use executeBulk as
<code>couchDbConnector.executeBulk(List&lt;?&gt; list)</code> the error message became like the following:</p>

<pre><code>org.ektorp.DbAccessException: 500:Internal Server Error
URI: /let-ut-app/_bulk_docs
Response Body: 
{
  ""error"" : ""case_clause"",
  ""reason"" : ""{12,11}"",
  ""stack"" : [ ""fabric_doc_update:handle_message/3"", ""rexi_utils:process_mailbox/6"", ""rexi_utils:recv/6"", ""fabric_doc_update:go/3"", ""fabric:update_docs/3"", ""chttpd_db:db_req/2"", ""chttpd:handle_request/1"", ""mochiweb_http:headers/5"" ]
}
    at org.ektorp.http.StdResponseHandler.createDbAccessException(StdResponseHandler.java:44)
    at org.ektorp.http.StdResponseHandler.error(StdResponseHandler.java:62)
    at org.ektorp.http.RestTemplate.handleResponse(RestTemplate.java:98)
    at org.ektorp.http.RestTemplate.post(RestTemplate.java:61)
    at org.ektorp.impl.StdCouchDbConnector.executeBulk(StdCouchDbConnector.java:536)
    at org.ektorp.impl.StdCouchDbConnector.executeBulk(StdCouchDbConnector.java:498)
</code></pre>

<p>Please let me know if anyone of you has come accross this issue and how you have solved it.</p>

<p>Appreciate your help.</p>

<p>Thanx much!</p>
","1183477","","","","","2014-10-05 06:41:36","Error in executing bulk Update in Cloudant CouchDB using Ektorp ExecuteBulk () and ExecuteAllOrNothing () API","<couchdb><bulkinsert><bulk><ektorp><cloudant>","1","0","","","","12914769","73833","73833","ektorp","71","7739352","7739351"
"55811989","1","55812147","","2019-04-23 13:08:09","","4","575","<p>I'm posting json array of objects. I'm trying to parse it in code like this</p>

<pre><code>val objs = call.receive&lt;List&lt;MyClass&gt;&gt;() // this work fine
val name objs[0].name // this throw exception LinkedTreeMap cannot be cast to MyClass
</code></pre>

<p>In above code second line throws exception <code>com.google.gson.internal.LinkedTreeMap cannot be cast to MyClass</code></p>

<p>If i post simple object and parse it in ktor with  <code>call.receive&lt;MyClass&gt;()</code> then it will work fine. So issue is only when parsing list of objects.</p>
","5232184","","","","","2019-08-15 18:04:42","How parse raw json list of data posted in ktor","<kotlin><ktor>","2","0","1","","","55811989","128262","128262","ktor","265","45915935","45915934"
"55934676","1","55934719","","2019-05-01 10:14:21","","0","98","<p>When starting a basic Ktor app, I get:</p>

<pre><code>Exception in thread ""main"" java.lang.UnsupportedOperationException: Packages and file facades are not yet supported in Kotlin reflection. Meanwhile please use Java reflection to inspect this class: class com.example.ApplicationKt
    at kotlin.reflect.jvm.internal.KClassImpl.reportUnresolvedClass(KClassImpl.kt:301)
    at kotlin.reflect.jvm.internal.KClassImpl.access$reportUnresolvedClass(KClassImpl.kt:43)
    at kotlin.reflect.jvm.internal.KClassImpl$Data$descriptor$2.invoke(KClassImpl.kt:53)
    at kotlin.reflect.jvm.internal.KClassImpl$Data$descriptor$2.invoke(KClassImpl.kt:44)
    at kotlin.reflect.jvm.internal.ReflectProperties$LazySoftVal.invoke(ReflectProperties.java:92)
    at kotlin.reflect.jvm.internal.ReflectProperties$Val.getValue(ReflectProperties.java:31)
    at kotlin.reflect.jvm.internal.KClassImpl$Data.getDescriptor(KClassImpl.kt)
    at kotlin.reflect.jvm.internal.KClassImpl$Data$objectInstance$2.invoke(KClassImpl.kt:106)
    at kotlin.reflect.jvm.internal.ReflectProperties$LazyVal.invoke(ReflectProperties.java:62)
    at kotlin.reflect.jvm.internal.ReflectProperties$Val.getValue(ReflectProperties.java:31)
    at kotlin.reflect.jvm.internal.KClassImpl$Data.getObjectInstance(KClassImpl.kt)
    at kotlin.reflect.jvm.internal.KClassImpl.getObjectInstance(KClassImpl.kt:239)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.createModuleContainer(ApplicationEngineEnvironmentReloading.kt:328)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.executeModuleFunction(ApplicationEngineEnvironmentReloading.kt:317)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.instantiateAndConfigureApplication(ApplicationEngineEnvironmentReloading.kt:275)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.createApplication(ApplicationEngineEnvironmentReloading.kt:127)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.start(ApplicationEngineEnvironmentReloading.kt:247)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:106)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:18)
    at io.ktor.server.engine.ApplicationEngine$DefaultImpls.start$default(ApplicationEngine.kt:52)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:17)
    at com.example.ApplicationKt.main(Application.kt:10)
</code></pre>

<p>The app is just:</p>

<pre><code>fun main(args: Array&lt;String&gt;): Unit = EngineMain.main(args)

fun Application.demoModule() {
    routing {
        get(""/"") {
            call.respondText(""Hello ${call.parameters[""name""]}"")
        }
    }
}
</code></pre>
","819651","","","","","2019-05-01 10:18:12","java.lang.UnsupportedOperationException: Packages and file facades are not yet supported in Kotlin reflection","<kotlin><ktor>","1","0","","","","55934676","128262","128262","ktor","265","45915935","45915934"
"55940883","1","","","2019-05-01 18:28:14","","0","161","<p>The main idea is to have a sort of ""serialization / deserialization module"" that could be shared between a backend (using Ktor) and an Android application. </p>

<p>I don't know how ""far"" this can go, but I would imagine that the routes are ""exposed"" for the frontend app to consume (like Retrofit does with its interface with annotations) and the (de-)serialization logic is shared too. </p>

<p>So basicaly, is it possible to ""share"" not only the ""POJO / POKO"" representations of API responses, but also the possible endpoints with the expected parameters, between a server (I guess using Ktor) and an Android application (Java / Kotlin) ?</p>
","4342335","","","","","2019-05-02 06:15:48","Is it possible to use Ktor and / or Kotlin multiplatform to ""share"" the exposed data between a Rest API and an Android Application?","<android><kotlin><ktor>","1","0","","","","55940883","128262","128262","ktor","265","45915935","45915934"
"55967906","1","","","2019-05-03 10:25:01","","2","127","<p>I just started a simple Ktor app and set a breakpoint. But it seems I cannot debug or evaluate the interesting items:</p>

<p><a href=""https://i.stack.imgur.com/Fh2ko.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Fh2ko.png"" alt=""enter image description here""></a></p>

<p>Seems like the Kotlin Debugger just has no idea what is going on and totally messes up the Scope (Kotlin 1.3, IntelliJ 2019.1.1)?</p>

<p>If I am not able to debug my code and evaluate expressions (like inspecting the headers of the request or something) this is an instant no-go for me :(</p>

<p>Is there any special setting needed to make this work?</p>
","2787886","","147024","","2019-05-03 10:28:58","2019-05-03 10:28:58","Why is Kotlin unable to debug Ktor?","<debugging><intellij-idea><kotlin><ktor>","0","3","","","","55967906","128262","128262","ktor","265","45915935","45915934"
"55973493","1","56116035","","2019-05-03 16:03:05","","1","177","<p>I need to do some initialization of my Ktor app, but I want to do it only after Netty is ready to accept connections. From the other hand, I don't want such initialization to happen if Netty failed to start (with the typical ""address already in use"", for example).</p>

<p>I implemented the straightforward approach (see below), but I wonder if it possible to make it <strong>the less ugly way</strong>?</p>

<p>First I save the reference to NettyApplicationEngine:</p>

<pre><code>embeddedServer = embeddedServer(Netty, port, module)
</code></pre>

<p>Then I use the <code>channels</code> field from NettyApplicationEngine to determine its state:</p>

<pre><code>private fun NettyApplicationEngine.channelsReady(): Boolean {
    val channelsField = this::class.members.find { it.name == ""channels"" }!!
    channelsField.isAccessible = true
    val channels = channelsField.call(this) as List&lt;Channel&gt;?
    return !channels.isNullOrEmpty() &amp;&amp; channels.all { it.isActive }
}
</code></pre>

<p>And, finally, I catch the ApplicationStarted event and spin until channels are ready:</p>

<pre><code>environment.monitor.subscribe(ApplicationStarted) {
        thread(start = true, name = ""real netty postinit"") {
            for (i in 1..100) {
                TimeUnit.MILLISECONDS.sleep(100)
                if (embeddedServer.channelsReady()) break
            }

            if (embeddedServer.channelsReady()) {
                // Initialization here
            } else {
                // Server didn't start
                embeddedServer.stop(1, 1, TimeUnit.SECONDS)
            }
        }
    }
</code></pre>
","10763322","","10763322","","2019-05-03 16:08:40","2019-05-13 16:02:53","How to check inside Ktor that the Netty is actually started?","<kotlin><netty><ktor>","1","0","","","","55973493","128262","128262","ktor","265","45915935","45915934"
"56043677","1","","","2019-05-08 15:02:19","","0","446","<p>I want to make a test for a Ktor route that uses Koin to inject a service.  I am struggling to mock the service used by the Ktor route in my test.   </p>

<p>Here is the Ktor <strong>Application.kt</strong> file</p>

<pre><code>@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {
    install(Locations) {
    }
    // Suppressed code
    installKoin(listOf(dependencyInjectionModule))

    routing {

        val eventService by inject&lt;EventService&gt;()

        get(""/issues/{issueNumber}/events"") {

            val issue = call.parameters[""issueNumber""]
            val issueNumber = parseInt(issue)
            call.respond(eventService.getEventsByIssueNumber(issueNumber))
        }      
    }
    // Suppressed code
}
</code></pre>

<p>Koin is working here above, the problem is when I need to mock instead of using Koin.</p>

<p>Here is the <strong>AplicationTest.kt</strong> file</p>

<pre><code>class ApplicationTest {

    private val eventDtoList = listOfNotNull(
        EventDto(1, ""opened"", ""2019-03-24T21:40:18Z"", 1 ),
        EventDto(2, ""closed"", ""2019-03-28T21:40:18Z"", 1 )
    )

    @Test
    fun testGettingEventsByExistingIssueNumber() {

        withTestApplication({ module(testing = true) }) {

            stopKoin()

            handleRequest(HttpMethod.Get, ""/issues/1/events"").apply {
                val eventService:EventService = mock {
                    onBlocking { getEventsByIssueNumber(any()) } doReturn eventDtoList
                }

                val resultList = Gson().fromJson(response.content, Array&lt;EventDto&gt;::class.java).asList()

                assertEquals(response.status(), HttpStatusCode.OK)
                assertThat(resultList).hasSize(2)

            }
        }
    }
}
</code></pre>

<p>I want to mock the eventList which is returned by the service, but I when I get to this line:</p>

<pre><code>withTestApplication({ module(testing = true) })
</code></pre>

<p>I get this exception:</p>

<pre><code>2019-05-08 11:51:40:881 (KOIN)::[e] Error while resolving instance for class 'com.service.EventService' - error: org.koin.error.NoBeanDefFoundException: No compatible definition found for type 'EventService'. Check your module definition 

org.koin.error.NoBeanDefFoundException: No compatible definition found for type 'EventService'. Check your module definition

    at org.koin.core.bean.BeanRegistry.retrieveDefinition(BeanRegistry.kt:113)
    at org.koin.core.instance.InstanceRegistry$proceedResolution$$inlined$synchronized$lambda$1.invoke(InstanceRegistry.kt:87)
    at org.koin.core.instance.InstanceRegistry$proceedResolution$$inlined$synchronized$lambda$1.invoke(InstanceRegistry.kt:36)
    at org.koin.core.time.DurationKt.measureDuration(Duration.kt:8)
    at org.koin.core.instance.InstanceRegistry.proceedResolution(InstanceRegistry.kt:84)
    at org.koin.core.instance.InstanceRegistry.resolve(InstanceRegistry.kt:63)
    at org.koin.core.instance.InstanceRegistry.resolve$default(InstanceRegistry.kt:48)
    at com.jaya.octovevent.ApplicationKt$module$4$$special$$inlined$inject$1.invoke(KtorRoutingExt.kt:112)
    at kotlin.SynchronizedLazyImpl.getValue(LazyJVM.kt:74)
    at com.jaya.octovevent.ApplicationKt$module$4$2.invokeSuspend(Application.kt:76)
    at com.ApplicationKt$module$4$2.invoke(Application.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.StatusPages$interceptCall$2.invokeSuspend(StatusPages.kt:94)
    at io.ktor.features.StatusPages$interceptCall$2.invoke(StatusPages.kt)
    at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:91)
    at kotlinx.coroutines.CoroutineScopeKt.coroutineScope(CoroutineScope.kt:180)
    at io.ktor.features.StatusPages.interceptCall(StatusPages.kt:93)
    at io.ktor.features.StatusPages$Feature$install$2.invokeSuspend(StatusPages.kt:133)
    at io.ktor.features.StatusPages$Feature$install$2.invoke(StatusPages.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.routing.Routing.executeResult(Routing.kt:148)
    at io.ktor.routing.Routing.interceptor(Routing.kt:29)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:93)
    at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:63)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.testing.TestApplicationEngine$2.invokeSuspend(TestApplicationEngine.kt:265)
    at io.ktor.server.testing.TestApplicationEngine$2.invoke(TestApplicationEngine.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.testing.TestApplicationEngine$handleRequest$pipelineJob$1.invokeSuspend(TestApplicationEngine.kt:263)
    at |b|b|b(Coroutine boundary.|b(|b)
    at io.ktor.features.StatusPages.interceptCall(StatusPages.kt:93)
    at io.ktor.features.StatusPages$Feature$install$2.invokeSuspend(StatusPages.kt:133)
    at io.ktor.routing.Routing.executeResult(Routing.kt:148)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:93)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:63)
    at io.ktor.server.testing.TestApplicationEngine$2.invokeSuspend(TestApplicationEngine.kt:265)
    at io.ktor.server.testing.TestApplicationEngine$handleRequest$pipelineJob$1.invokeSuspend(TestApplicationEngine.kt:263)
    at kotlinx.coroutines.DeferredCoroutine.await$suspendImpl(Builders.common.kt:98)
    at io.ktor.server.testing.TestApplicationEngine$handleRequest$1.invokeSuspend(TestApplicationEngine.kt:129)
Caused by: org.koin.error.NoBeanDefFoundException: No compatible definition found for type 'EventService'. Check your module definition
    at org.koin.core.bean.BeanRegistry.retrieveDefinition(BeanRegistry.kt:113)
    at org.koin.core.instance.InstanceRegistry$proceedResolution$$inlined$synchronized$lambda$1.invoke(InstanceRegistry.kt:87)
    at org.koin.core.instance.InstanceRegistry$proceedResolution$$inlined$synchronized$lambda$1.invoke(InstanceRegistry.kt:36)
    at org.koin.core.time.DurationKt.measureDuration(Duration.kt:8)
    at org.koin.core.instance.InstanceRegistry.proceedResolution(InstanceRegistry.kt:84)
    at org.koin.core.instance.InstanceRegistry.resolve(InstanceRegistry.kt:63)
    at org.koin.core.instance.InstanceRegistry.resolve$default(InstanceRegistry.kt:48)
    at com.ApplicationKt$module$4$$special$$inlined$inject$1.invoke(KtorRoutingExt.kt:112)
    at kotlin.SynchronizedLazyImpl.getValue(LazyJVM.kt:74)
    at com.ApplicationKt$module$4$2.invokeSuspend(Application.kt:76)
    at com.ApplicationKt$module$4$2.invoke(Application.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.StatusPages$interceptCall$2.invokeSuspend(StatusPages.kt:94)
    at io.ktor.features.StatusPages$interceptCall$2.invoke(StatusPages.kt)
    at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:91)
    at kotlinx.coroutines.CoroutineScopeKt.coroutineScope(CoroutineScope.kt:180)
    at io.ktor.features.StatusPages.interceptCall(StatusPages.kt:93)
    at io.ktor.features.StatusPages$Feature$install$2.invokeSuspend(StatusPages.kt:133)
    at io.ktor.features.StatusPages$Feature$install$2.invoke(StatusPages.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.routing.Routing.executeResult(Routing.kt:148)
    at io.ktor.routing.Routing.interceptor(Routing.kt:29)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:93)
    at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:63)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.testing.TestApplicationEngine$2.invokeSuspend(TestApplicationEngine.kt:265)
    at io.ktor.server.testing.TestApplicationEngine$2.invoke(TestApplicationEngine.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
    at io.ktor.server.testing.TestApplicationEngine$handleRequest$pipelineJob$1.invokeSuspend(TestApplicationEngine.kt:263)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
    at kotlinx.coroutines.DispatchedTask.run(Dispatched.kt:238)
    at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:594)
    at kotlinx.coroutines.scheduling.CoroutineScheduler.access$runSafely(CoroutineScheduler.kt:60)
    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:742)
</code></pre>

<p>I am aware that Koin can not find the EventService implementation because I have stopped it (Koin). So how can I replace Koin injection by my mocked service?</p>

<p>Thanks in advance</p>
","1856814","","","","","2019-05-08 18:11:36","How to replace Koin service injection in a Ktor route test by a mocked service","<kotlin><mocking><mockito><ktor><koin>","1","2","","","","56043677","128262","128262","ktor","265","45915935","45915934"
"56089071","1","","","2019-05-11 09:40:58","","1","687","<p>I'm trying to build a Kotlin Multiplatform command line application targeting linuxX64 in a first step. Therefore I wanted to build a client based on Ktor which is used in the common module.</p>

<h3>Here my fairly simple setup:</h3>

<p><strong>Version overview</strong></p>

<ul>
<li>Ktor 1.1.5</li>
<li>Kotlin Multiplatform 1.3.31</li>
<li>Gradle 5.3.1</li>
</ul>

<p><strong>build.gradle.kts</strong></p>

<pre><code>plugins {
    kotlin(""multiplatform"") version ""1.3.31""
}

repositories {
    mavenCentral()
    maven { url = uri(""https://kotlin.bintray.com/ktor"") }
}

kotlin {
    linuxX64(""linux"") {
        binaries {
            executable()
        }
    }

    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(kotlin(""stdlib-common""))
                api(""io.ktor:ktor-client-core:1.1.5"")
            }
        }

        val linuxMain by getting {
            dependsOn(commonMain)
            dependencies {
                api(""io.ktor:ktor-client-curl:1.1.5"")
            }
        }
    }
}
</code></pre>

<p><strong>src/linuxMain/kotlin/Main.kt</strong></p>

<pre><code>fun main(){
    val client = MyClient()
    client.execute()
}
</code></pre>

<p><strong>src/commonMain/kotlin/MyClient.kt</strong></p>

<pre><code>import io.ktor.client.*

class MyClient {

    private val client = HttpClient()

    fun execute() {
        //do something with Ktor client
    }
}
</code></pre>

<p>When I build the project I get the following build issue:</p>

<pre><code>11:15:21: Executing task 'build'...


&gt; Configure project :
Kotlin Multiplatform Projects are an experimental feature.

&gt; Task :wrapper

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed

&gt; Configure project :
Kotlin Multiplatform Projects are an experimental feature.

&gt; Task :compileKotlinLinux FAILED
e: .../src/commonMain/kotlin/MyClient.kt: (1, 8): Unresolved reference: io
e: .../src/commonMain/kotlin/MyClient.kt: (5, 26): Unresolved reference: HttpClient
</code></pre>

<p>I'm new to Kotlin Native/Mutliplatform and Ktor. So bear with me if this my setup is wrong...</p>
","5348201","","","","","2019-05-11 10:40:15","How to fix 'Unresolved reference: HttpClient' with ktor-client-core targeting linuxX64","<kotlin><ktor><kotlin-multiplatform>","1","1","","","","56089071","128262","128262","ktor","265","45915935","45915934"
"56188676","1","","","2019-05-17 14:38:25","","2","64","<p>I'm trying to run a simple Ktor server on Google App Engine Standard. If I run <a href=""https://github.com/ktorio/ktor-samples/tree/master/deployment/google-appengine-standard"" rel=""nofollow noreferrer"">their sample code on github</a> it works well, but fails as soon as I call any App Engine API with the following message:</p>

<blockquote>
  <p>Can't make API call memcache.Set in a thread that is neither the original request thread nor a thread created by ThreadManager</p>
</blockquote>

<p>All App Engine APIs trigger similar error messages. Is this related to how Ktor handles requests, and is there a way to make them work?</p>

<p>I think that the <a href=""https://github.com/googleapis/google-cloud-java"" rel=""nofollow noreferrer"">Google Cloud java library</a> doesn't have this threading limitation, but unfortunately I can't use it. I need to access the App Engine Memcache service, which is only available through the App Engine APIs.</p>
","533552","","","","","2019-05-17 14:38:25","Ktor: Can't call App Engine Standard APIs","<google-app-engine><kotlin><google-cloud-platform><ktor>","0","0","","","","56188676","128262","128262","ktor","265","45915935","45915934"
"56188839","1","57125955","","2019-05-17 14:48:57","","0","66","<p>I'm working on a web app written with a Kotlin backend and React frontend, that uses Ktor to set up a web server. I'm currently trying to add functionality that requires a WebSocket connection, and to maintain state across the WebSocket session, using the custom session model from the Ktor example chat app here: <a href=""https://github.com/ktorio/ktor-samples/tree/master/app/chat/src"" rel=""nofollow noreferrer"">https://github.com/ktorio/ktor-samples/tree/master/app/chat/src</a>. </p>

<p>However, I'm getting an issue with the reflection Ktor is doing to create these sessions.</p>

<p>The custom session is defined as follows: </p>

<pre><code>data class THavalonUserSession(val id: String,
 var name: String, var socket: DefaultWebSocketSession?)
</code></pre>

<p>And is initialized in the following block:</p>

<pre><code>      intercept(ApplicationCallPipeline.Features) {
          if (call.sessions.get&lt;THavalonUserSession&gt;() == null) {
              call.sessions.set(THavalonUserSession(generateNonce(), """", null))
            }
        }
</code></pre>

<p>When I run the application on Chrome, either with built React or in React development mode, I get the following server side error:</p>

<pre><code>java.lang.IllegalArgumentException: Couldn't instantiate type class main.THavalonUserSession for parameters [id, name]

</code></pre>

<p>When I run it on Firefox, it works, until I change the socket parameter name from socket to mySocket, at which point it gives the error:</p>

<pre><code>java.lang.IllegalArgumentException: Couldn't instantiate type class main.THavalonUserSession for parameters [id, name, socket]
</code></pre>

<p>The only thing I can think of is that it's somehow caching class names in the browser, but that makes no sense to me.</p>
","11516648","","","","","2019-07-20 15:09:13","Ktor reflection to create custom WebSocket session doesn't update constructor parameters","<kotlin><websocket><ktor>","1","0","","","","56188839","128262","128262","ktor","265","45915935","45915934"
"56251286","1","56309875","","2019-05-22 07:17:46","","3","1028","<p>I am using:</p>

<ul>
<li>Kotlin 1.3.3 </li>
<li>Ktor plugin 1.2.0</li>
<li>IntelliJ IDEA 2019.1.3 (Ultimate Edition) Build #IU-191.7479.7, built
on May 21, 2019</li>
<li>openjdk version ""11.0.2"" 2019-01-15 - OpenJDK Runtime Environment
18.9 (build 11.0.2+9)</li>
<li>macOS Mojave 10.14.5</li>
</ul>

<p>Also tried with 'jdk1.8.0_202.jdk/'</p>

<p>I follow the QuickStart from <a href=""https://ktor.io/quickstart/index.html"" rel=""nofollow noreferrer"">https://ktor.io/quickstart/index.html</a></p>

<p>When I run the generated code from inside IntelliJ I get: </p>

<pre><code>/Library/Java/JavaVirtualMachines/jdk-11.0.2.jdk/Contents/Home/bin/java ""-javaagent:/Applications/IntelliJ IDEA 2019.1 EAP.app/Contents/lib/idea_rt.jar=50192:/Applications/IntelliJ IDEA 2019.1 EAP.app/Contents/bin"" -Dfile.encoding=UTF-8 -classpath /Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/classes:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-netty/1.2.0/c30ea7f287343d3007a0794dbfeb3f69aad76ca8/ktor-server-netty-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-html-builder/1.2.0/53ef376dc21a1f404a5154096708fc104092ec77/ktor-html-builder-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-host-common/1.2.0/a4335b06f785b39d976e70a00a988bd077beacd1/ktor-server-host-common-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-core/1.2.0/4ba64df7deeb3b3cc81b66f005962edfaf63e554/ktor-server-core-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains/kotlin-css-jvm/1.0.0-pre.31-kotlin-1.2.41/718c1d40ec10699ee0ab086e2e9d4d1ebe95646d/kotlin-css-jvm-1.0.0-pre.31-kotlin-1.2.41.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-jetty/1.2.0/3dd4fd4541dd7c85564c65162117a2dd60933f0b/ktor-client-jetty-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-core-jvm/1.2.0/f88e71cffbb49bdba1f1e93131cdee2e2bae0eaa/ktor-client-core-jvm-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-cio-jvm/1.2.0/d37a4df9617f49378780554421a3744ab5ceb1d9/ktor-http-cio-jvm-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-jvm/1.2.0/aab3e7e34ba1c1947fe362f899d308d97622cfb8/ktor-http-jvm-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-network/1.2.0/bbaefc8c4d66d3707b0a247a341a2f3ea7bd0c5/ktor-network-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-utils-jvm/1.2.0/9d79aff946644c0f489e75f315fcb396f5b4581e/ktor-utils-jvm-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk8/1.3.31/21edc5a6b2e39bc4dc2860346fd778e27503d6cb/kotlin-stdlib-jdk8-1.3.31.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-classic/1.2.1/706a8b8206ead3683ec639dd270d11fd948fbb0e/logback-classic-1.2.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-core/1.2.0/5788736ce2795078281e5eeb4523e0c81cf8d06/ktor-client-core-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk7/1.3.31/e652770b6416c6d85934086899ffed3eccd35813/kotlin-stdlib-jdk7-1.3.31.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-reflect/1.3.31/5a426a5ada97967ca60fba495eeaa66cfa7c9e2f/kotlin-reflect-1.3.31.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-io-jvm/0.1.8/591b0489ce565c32d4874610ef64c948e6a5c627/kotlinx-coroutines-io-jvm-0.1.8.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-io-jvm/0.1.8/595d4772d0600272bac6a2dcec2646b037285863/kotlinx-io-jvm-0.1.8.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-html-jvm/0.6.12/95dfe9d85947c8dd57c16dced385a37280166e56/kotlinx-html-jvm-0.6.12.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-jdk8/1.2.1/4d891cee198626c08ac30028afdd743558507ad9/kotlinx-coroutines-jdk8-1.2.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core/1.2.1/3839faf625f4197acaeceeb6da000f011a2acb49/kotlinx-coroutines-core-1.2.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib/1.3.31/11289d20fd95ae219333f3456072be9f081c30cc/kotlin-stdlib-1.3.31.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-cio/1.2.0/9dc1ab0d309da3a03b4e4435b9dc52afbc78c580/ktor-http-cio-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http/1.2.0/c160a65dea5200650efd8db738fa157d8e7c3f8/ktor-http-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-utils/1.2.0/67edd57c63978974769e6ab6792713d9253c1db9/ktor-utils-1.2.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/atomicfu/0.12.6/2840b58706d9ef8df7c8aee2e8b6e1444d09df60/atomicfu-0.12.6.jar:/Users/NOTiFY/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/com.typesafe/config/1.3.1/2cf7a6cc79732e3bdf1647d7404279900ca63eb0/config-1.3.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http2/4.1.24.Final/c0c0d9d20402e4493083447052b59d5680e88b2e/netty-codec-http2-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-openjdk8-client/9.4.15.v20190215/d46fbf9d9c37f75e621a30bf8a192fe2ade30963/jetty-alpn-openjdk8-client-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.alpn/alpn-api/1.1.3.v20160715/a1bf3a937f91b4c953acd13e8c9552347adc2198/alpn-api-1.1.3.v20160715.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-core/1.2.1/378913dfc3c6c71e7e2a2853eff2c3e8ac27599/logback-core-1.2.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains/kotlin-css/1.0.0-pre.31-kotlin-1.2.41/c40316f81304348a9983ce15a53c81130b16b36a/kotlin-css-1.0.0-pre.31-kotlin-1.2.41.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-io/0.1.8/ab4c5ab04fe13e78ab0d55d71909b22b6f52f658/kotlinx-coroutines-io-0.1.8.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core-common/1.2.1/5806e3dd5e8dff59fec96747795353f3ba2bfd60/kotlinx-coroutines-core-common-1.2.1.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-io/0.1.8/59bcca58d0dae17790c96a775664267ff8492356/kotlinx-io-0.1.8.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-common/1.3.31/20c34a04ea25cb1ef0139598bd67c764562cb170/kotlin-stdlib-common-1.3.31.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-client/9.4.15.v20190215/dea5744484dbb7e192b6eb061e46d3e53a7edd95/http2-client-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-java-client/9.4.15.v20190215/9e513ee27c5ea1fa4d97186e46f613b44e3a7795/jetty-alpn-java-client-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains/annotations/13.0/919f0dfe192fb4e063e7dacadee7f8bb9a2672a9/annotations-13.0.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/atomicfu-common/0.12.3/b09ed1e1b1a0996e0a3b6c454797d44788a21747/atomicfu-common-0.12.3.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http/4.1.24.Final/8f20009953b2c7c3d860cef928007bc01aa58ac/netty-codec-http-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-handler/4.1.24.Final/bad56e7da211c5ebe031ae155cb648b1065c7bb6/netty-handler-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-common/9.4.15.v20190215/8983928afb3064fe41b449cabcb827c1024dfba/http2-common-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-alpn-client/9.4.15.v20190215/1b215197407fdf8582711e32b187ce458c6097d9/jetty-alpn-client-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec/4.1.24.Final/290857e5103956bbda11836e33245f2439226b77/netty-codec-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport/4.1.24.Final/d37292c94d3a4cba48d9b6cfb6e8e55282035d0d/netty-transport-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-buffer/4.1.24.Final/e354bed2e60b568307138e403f55ba241c1c16d2/netty-buffer-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.http2/http2-hpack/9.4.15.v20190215/1a2b990e51ea38fb742f7cdec24064c32596edb8/http2-hpack-9.4.15.v20190215.jar:/Users/NOTiFY/.m2/repository/org/eclipse/jetty/jetty-http/9.4.15.v20190215/jetty-http-9.4.15.v20190215.jar:/Users/NOTiFY/.m2/repository/org/eclipse/jetty/jetty-io/9.4.15.v20190215/jetty-io-9.4.15.v20190215.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver/4.1.24.Final/dbc1e5b50d31aed883ea3beeb6489e1977d0687f/netty-resolver-4.1.24.Final.jar:/Users/NOTiFY/.gradle/caches/modules-2/files-2.1/io.netty/netty-common/4.1.24.Final/7eeecd7906543214c3c1c984d275d3c6de10b99d/netty-common-4.1.24.Final.jar:/Users/NOTiFY/.m2/repository/org/eclipse/jetty/jetty-util/9.4.15.v20190215/jetty-util-9.4.15.v20190215.jar com.example.ApplicationKt
2019-05-22 08:08:07.394 [main] TRACE Application - {
    # application.conf @ file:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources/application.conf: 6
    ""application"" : {
        # application.conf @ file:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources/application.conf: 7
        ""modules"" : [
            # application.conf @ file:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources/application.conf: 7
            ""com.example.ApplicationKt.module""
        ]
    },
    # application.conf @ file:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources/application.conf: 2
    ""deployment"" : {
        # application.conf @ file:/Users/NOTiFY/IdeaProjects/HelloKtorWorld/out/production/resources/application.conf: 3
        ""port"" : 8080
    },
    # Content hidden
    ""security"" : ""***""
}

2019-05-22 08:08:07.885 [main] INFO  Application - No ktor.deployment.watch patterns specified, automatic reload is not active
Exception in thread ""main"" java.lang.ClassNotFoundException: Module function cannot be found for the fully qualified name 'com.example.ApplicationKt.module'
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.executeModuleFunction(ApplicationEngineEnvironmentReloading.kt:367)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.access$executeModuleFunction(ApplicationEngineEnvironmentReloading.kt:33)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading$instantiateAndConfigureApplication$1$$special$$inlined$forEach$lambda$1.invoke(ApplicationEngineEnvironmentReloading.kt:287)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading$instantiateAndConfigureApplication$1$$special$$inlined$forEach$lambda$1.invoke(ApplicationEngineEnvironmentReloading.kt:33)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.avoidingDoubleStartupFor(ApplicationEngineEnvironmentReloading.kt:320)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.access$avoidingDoubleStartupFor(ApplicationEngineEnvironmentReloading.kt:33)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading$instantiateAndConfigureApplication$1.invoke(ApplicationEngineEnvironmentReloading.kt:286)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading$instantiateAndConfigureApplication$1.invoke(ApplicationEngineEnvironmentReloading.kt:33)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.avoidingDoubleStartup(ApplicationEngineEnvironmentReloading.kt:302)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.instantiateAndConfigureApplication(ApplicationEngineEnvironmentReloading.kt:284)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.createApplication(ApplicationEngineEnvironmentReloading.kt:137)
    at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.start(ApplicationEngineEnvironmentReloading.kt:257)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:116)
    at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:22)
    at io.ktor.server.engine.ApplicationEngine$DefaultImpls.start$default(ApplicationEngine.kt:56)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:21)
    at com.example.ApplicationKt.main(Application.kt:14)

Process finished with exit code 1
</code></pre>

<p>Any suggestions, besides look at your stack trace it's a:</p>

<p><code>java.lang.ClassNotFoundException: Module function cannot be found for the fully qualified name 'com.example.ApplicationKt.module'</code> ? </p>
","3787442","","3787442","","2019-05-22 13:46:38","2019-07-22 06:43:16","Ktor - Quickstart new project from plugin throwing Error","<intellij-idea><kotlin><ktor>","3","0","","","","56251286","128262","128262","ktor","265","45915935","45915934"
"56300035","1","56365316","","2019-05-24 22:10:51","","1","383","<p>I have Ktor based REST API application which uses the <code>jwt</code> token's as authentication. Then I have to restrict certain routes for the specific role. In order to do it I am creating principal, containing the relevant info:</p>

<pre><code>data class UserPrincipal (
  val id: Long,
  val username: String,
  val roleId: Long,
): Princpal {
  override fun getName() = username
}

object AuthLogin {
  fun Application.auth(jwt: JwtProvider) {
    install(Authentication) {
      jwt(""jwt"") {
        realm = jwt.realm()
        verifier(jwt.verifier())
        validate {
          val userId = it.payload.getClaim(""id"").asLong()
          val username = it.payload.getClain(""name"")
          val roleId = it.payload.getClaim(""roleId"").asLong()
          UserPrincipal(userId, username, roleId)
        }
      }
    }
  }
}
</code></pre>

<p>The claims with <code>userId</code> and <code>roleId</code> are being provided when signing the correctly logged in user. Now I can restrict REST endpoints like that:</p>

<pre><code>object RestModule {
  fun Application.enititiesOne(userRepo: UserRepo) {
    routing {
      authenticate(""jwt"") {
        route(""/entities1"") {
          get {
            val principal = call.principal&lt;UserPrincipal&gt;()
            when(userRepo.hasAccessByRole(principal!!.roleId, ""CAN_R_E1"") {
              false -&gt; call.respond(HttpStatusCode.Forbidden)
              true -&gt; // some retrieval logic
          }
          post {
            val principal = call.principal&lt;UserPrincipal&gt;()
            when(userRepo.hasAccessByRole(principal!!.roleId, ""CAN_W_E1"") {
              false -&gt; call.respond(HttpStatusCode.Forbidden)
              true -&gt; // some update logic
          }
        }
      }
    }
  }
}
</code></pre>

<p>As you can see even inside one routing function I have to duplicate code that checks the principal's role twice. I can move it out to function but what I want is a single place to define my security roles. Something like that:</p>

<pre><code>authenticate {
  val principal = call.principal&lt;UserPrincipal()
  val rights = userRepo.rightsByRole(principal.roleId)
  when(routes) {
    get(""/entities1/**"") -&gt; 
      if(rights.contain(""CAN_R_E1"")) call.proceed
      else call.respond(HttpStatusCode.Forbidden)
    post(""/entites1) -&gt; rights.contain(""CAN_W_E1"") // similar 
    get(""/entities2/**"") -&gt; rights.contain(""CAN_R_E2"") // similar
    else -&gt; call.respond(401)
  }
}
</code></pre>

<p>And then plug it into the rest endpoints. Or is there some similar approach that I can use in Kotlin's Ktor? Seems like interceptors is what I need but I'm not sure how to use them in an intended way.</p>
","6856361","","","","","2019-11-18 14:47:51","How to extract access rights validation in Kotlin's Ktor","<kotlin><ktor>","1","1","","","","56300035","128262","128262","ktor","265","45915935","45915934"
"56309654","1","56339926","","2019-05-26 00:02:25","","1","203","<p>I am creating simple HTTP request with ktor-client (ApacheHttpClient engine)</p>

<pre><code>val client = HttpClient(Apache) {
    engine {
        followRedirects = false
        this@HttpClient.expectSuccess = false
    }
}
</code></pre>

<p>and using it to submit a form</p>

<pre><code>client.submitForm&lt;HttpResponse&gt;(
        url = ""https://foo.com/login"",
        formParameters = Parameters.build {
            append(""_username"", username)
            append(""_password"", password)
        })
</code></pre>

<p>In logs, I can see a correct response with 302-redirection which I want to get and obtain a cookie from it. But instead, I see that the client moves on and makes several more requests and finally fails with: </p>

<blockquote>
  <p>io.ktor.client.features.SendCountExceedException: Max send count 20 exceeded</p>
</blockquote>

<p>How can I completely disable 302-based redirections in ktor-client?</p>
","1768378","","1768378","","2019-05-26 00:28:24","2019-05-28 10:15:40","How to disable redirections in ktor-client","<kotlin><httpclient><ktor>","1","0","","","","56309654","128262","128262","ktor","265","45915935","45915934"
"56311655","1","56311656","","2019-05-26 07:47:10","","0","425","<p>I've found nearly everywhere in ktor-client documentation and examples they use empty formData to show how the client works</p>

<pre><code>formParameters: Parameters = Parameters.Empty
</code></pre>

<p>So what's the kotlin/ktor way to fill it with parameters?</p>
","1768378","","","","","2019-05-26 07:47:10","How to send Http Form with parameters by ktor-client","<kotlin><httpclient><ktor>","1","0","","","","56311655","128262","128262","ktor","265","45915935","45915934"
"56347516","1","56349077","","2019-05-28 17:42:17","","3","547","<p>I am validating App Store recipes in a server-side Kotlin using with Ktor's <code>HttpClient</code> (Ktor version is 1.2.1). Here is my code so far:</p>

<pre><code>class AppStoreClient(
        val url: String,
        val password: String,
        val excludeOldTransactions: Boolean = true
) {
    private val objectMapper = ObjectMapperFactory.defaultObjectMapper()
    private val client = HttpClient(Apache /* tried with CIO as well */) {
        install(JsonFeature) {
            serializer = JacksonSerializer()
        }
    }

    suspend fun validate(receipt: String): VerifyReceiptResponse {
        val post = client.post&lt;String&gt; {
            url(this@AppStoreClient.url)
            contentType(ContentType.Application.Json)
            accept(ContentType.Application.Json)
            body = VerifyReceiptRequest(
                    receipt,
                    password,
                    excludeOldTransactions
            )
        }

        // client.close()

        // Apple does not send Content-Type header ¯\_(ツ)_/¯
        // So Ktor's deserialization is not working here and
        // I have to manually deserialize the response.
        return objectMapper.readValue(post)
    }
}
</code></pre>

<p>And here I'm testing it:</p>

<pre><code>fun main() = runBlocking {
    val client = AppStoreClient(""https://sandbox.itunes.apple.com/verifyReceipt"", ""&lt;password&gt;"")

    println(client.validate(""&lt;recipe1&gt;""))
    // println(client.validate(""&lt;recipe2&gt;""))
    // println(client.validate(""&lt;recipe3&gt;""))
}
</code></pre>

<p>I got all the responses (one or three) in the output, but then my app just hangs and never quits the <code>main</code> method. Looks like <code>runBlocking</code> is still waiting for something, like <code>client.close</code>. Indeed, if I close the client after the first request, the app successfully ends, but that will force me to create the client on each separate validation request. Client's pipeline configuration seems to be time-consuming and <code>AppStoreClient</code> is meant to be a long-lived object, so I thought the client can share its lifecycle (probably even dependency-injected).</p>

<p>Is the <code>io.ktor.client.HttpClient</code> a long-lived object that can be re-used for multiple requests or should I create a new one for each request?</p>

<p>If yes, what am I doing wrong with it, so the <code>runBlocking</code> hangs?</p>

<hr>

<p>P.S. The code works with Ktor 1.1.1! Is it a bug?</p>

<hr>

<p>P.P.S. This code hangs as well:</p>

<pre><code>fun main() {
    val client = AppStoreClient(""..."", ""..."")

    runBlocking {
        println(client.validate(""...""))
        println(client.validate(""...""))
        println(client.validate(""...""))
    }

    runBlocking {
        println(client.validate(""...""))
        println(client.validate(""...""))
        println(client.validate(""...""))
    }
}
</code></pre>

<p>So I might seriously consider closing the client.</p>
","750510","","750510","","2019-05-28 18:46:32","2019-05-29 07:37:57","Ktor HttpClient is hang in runBlocking","<kotlin><kotlin-coroutines><ktor>","1","0","","","","56347516","128262","128262","ktor","265","45915935","45915934"
"56356253","1","","","2019-05-29 08:31:45","","1","123","<p>wanted to try some new stuff and decided to build next micro-app in Ktor + Koin + Exposed. Everything looks really nice but I found one problem that is actually destroying the whole idea. </p>

<p>App needs DB access and the connection cannot be stored within repository but should be encrypted on config-server. Every other micro-app is suing spring boot and fetches configs with lib <code>spring-cloud-config-client</code> but I don't know if it's even possible to use that somehow from Ktor app. Anyone had the same problem and managed to fix it somehow?</p>
","7227475","","","","","2019-05-31 17:38:58","Ktor application with spring config server","<ktor>","1","3","","","","56356253","128262","128262","ktor","265","45915935","45915934"
"56397973","1","","","2019-05-31 15:34:35","","1","552","<p>how to do field level(non root) resolvers using gaphql-kotlin ? My code working <em>(date_range in API1Response is null as i dont know how to call my second resolver function getAPI2Response() when date_range exists in query)</em> when each query called separately as i have two suspend functions with concern query names, but i want to call two suspend functions with one query based on a field(non root) check in query. For example, in below shown code (service), if my query is ""getAPI1Response"" with fields ""name"",""id"",""date_range"", then graphql should call getAPI1Response and also getAPI2Response and map it to Data model ""API1Response"" so users can use single query instead firing two queries.</p>

<p>Checked few samples from graphql-kotlin samples but all are referring to springboot which i am not using.</p>

<pre><code>//DATA MODEL

data class API1Response(
    val name: String?,
    val id: Int?,
    val date_range: API2Response?
)

data class API2Response(
    val max_date_range: ZonedDateTime?,
    val min_date_range: ZonedDateTime?
)
</code></pre>

<pre><code>//SERVICE
class Query() {
    private val httpClient = HttpClient()

// when query name is ""getAPI1Response"", this function get triggers
    suspend fun getAPI1Response(): API1Response {
        // call API 1 and map response to API1Response model.
        return resp.content.toInputStream().use {
                    jackson.readValue(it, API1Response::class.java)
                }
    }

//// when query name is ""getAPI2Response"", this function get triggers
    suspend fun getAPI2Response(): API2Response {
        // call API 2 and map response to API2Response model.
        return resp.content.toInputStream().use {
                    jackson.readValue(it, API2Response::class.java)
                }
    }
}
</code></pre>

<pre><code>// GRAPHQL HANDLER

package com.my.package.graphql

import com.expedia.graphql.SchemaGeneratorConfig
import com.expedia.graphql.TopLevelObject
import com.expedia.graphql.hooks.SchemaGeneratorHooks
import com.expedia.graphql.toSchema
import com.my.package.errors.ErrorType
import com.my.package.http.*
import com.my.package.json.Jackson
import graphql.ExecutionInput
import graphql.GraphQL
import graphql.language.StringValue
import graphql.schema.*
import graphql.schema.idl.SchemaPrinter
import io.ktor.application.ApplicationCall
import io.ktor.application.call
import io.ktor.http.ContentType
import io.ktor.http.HttpStatusCode
import io.ktor.response.respondText
import io.ktor.routing.Route
import io.ktor.routing.get
import io.ktor.routing.post
import java.time.LocalDate
import java.time.ZonedDateTime
import java.time.format.DateTimeFormatter
import kotlin.reflect.KClass
import kotlin.reflect.KType

class GraphQLHandler(
    mutations: List&lt;Any&gt;,
    queries: List&lt;Any&gt;
) : Handler {
    private val schema = toSchema(
        config = SchemaGeneratorConfig(
            supportedPackages = listOf(""com.my.package""),
            hooks = CustomSchemaGeneratorHooks(),
            topLevelQueryName = ""Query"",
            topLevelMutationName = ""Mutation""
        ),
        mutations = mutations.map { TopLevelObject(it) },
        queries = queries.map { TopLevelObject(it) }
    )

    private val graphQL = GraphQL.newGraphQL(schema).build()

    override val path = ""/graphql""

    override val routes: Route.() -&gt; Unit = {
        post {
            postQuery(call)
        }
    }

    private suspend fun postQuery(call: ApplicationCall) {
        val reqBody = call.receiveJson(Map::class)
        val query = reqBody[""query""] as? String
        if (query == null) {
            call.respondError(
                HttpStatusCode.BadRequest,
                ErrorType.bad_request,
                ""missing or invalid query field in json""
            )
            return
        }

        @Suppress(""UNCHECKED_CAST"")
        val variables = reqBody[""variables""] as? Map&lt;String, Any&gt; ?: emptyMap()

        handleQuery(call, query, variables)
    }

// main function which calls my concern suspend funciton mapping query name to function name
    private suspend fun handleQuery(call: ApplicationCall, query: String, variables: Map&lt;String, Any&gt;?) {
        val executionInput = ExecutionInput(query, null, call.request.authContext, null, variables)
        val result = graphQL.execute(executionInput).toSpecification()
        val statusCode = if (result.containsKey(""errors"")) HttpStatusCode.InternalServerError else HttpStatusCode.OK
        call.respondJson(statusCode, result, Jackson.all)
    }
}

class CustomSchemaGeneratorHooks : SchemaGeneratorHooks {
    override fun willGenerateGraphQLType(type: KType): GraphQLType? = when (type.classifier as? KClass&lt;*&gt;) {
        ZonedDateTime::class -&gt; graphqlZonedDateTimeType
        LocalDate::class -&gt; graphqlLocalDateType
        else -&gt; null
    }
}

val graphqlLocalDateType = GraphQLScalarType(""LocalDate"",
    "" ISO date format without an offset, such as '2011-12-03' "",
    object : Coercing&lt;LocalDate, String&gt; {
        //override few functions here
    }
)

val graphqlZonedDateTimeType = GraphQLScalarType(""ZonedDateTime"",
    "" ISO date-time format with an offset, such as '2011-12-03T10:15:30+01:00' "",
    object : Coercing&lt;ZonedDateTime, String&gt; {
        //override few functions here
    }
)
</code></pre>
","4971777","","4971777","","2019-05-31 20:09:36","2019-06-07 17:14:15","how to do field level resolvers using graphql-kotlin with ktor framework","<kotlin><graphql-java><ktor>","2","0","","","","56397973","128262","128262","ktor","265","45915935","45915934"
"56449759","1","56450698","","2019-06-04 18:55:12","","0","157","<p>I am trying to get an image to display on a webpage through the ktor HTML DSL. The image won't appear, and the alt is showing.</p>

<p>I am currently using the IDE Intellij, and I can't think of where to put the image. I tried putting it in the src folder where the .kt file is, but it is still not seeing it.</p>

<p>img (src: ""This is a picture!!"", alt: ""/img/picture.jpg"")
Here is a source I used: <a href=""https://github.com/celtric/kotlin-html/blob/master/README.md"" rel=""nofollow noreferrer"">https://github.com/celtric/kotlin-html/blob/master/README.md</a></p>

<p>The image is supposed to show but the alt shows instead.</p>
","11600653","","","","","2019-06-04 20:21:26","Image Tag in Ktor HTML DSL","<image><kotlin><ktor>","1","0","","","","56449759","128262","128262","ktor","265","45915935","45915934"
"56454823","1","","","2019-06-05 05:44:15","","1","105","<p>can`t receive post body array params</p>

<pre><code>$.post(
  'http://some_url/url',
  {
    order_items: [
      {
        order_item_id: 1,
        action_id: 1,
        fulfillment_time: ""String 1""
      },
      {
        order_item_id: 2,
        action_id: 2,
        fulfillment_time: ""string 2""}
    ]
  }
);
</code></pre>

<pre><code>post(""/url"") {
    val params = call.receiveParameters()
}
</code></pre>

<p>i got array/map:</p>

<pre><code>order_items[0][order_item_id]=[1],
order_items[0][action_id]=[1],
order_items[0][fulfillment_time]=[1s],
order_items[1][order_item_id]=[2],
order_items[1][action_id]=[2],
order_items[1][fulfillment_time]=[2s]
</code></pre>

<p>and i cant get param <code>order_items</code>.</p>

<pre><code>val p1 = params.get(""order_items"") //null
val p2 = params.get(""order_items[0][order_item_id]"") //1
</code></pre>
","3221547","","10020471","","2019-06-05 07:07:29","2020-04-04 09:01:11","How to receive POST array params in ktor?","<kotlin><ktor>","1","2","","","","56454823","128262","128262","ktor","265","45915935","45915934"
"56457143","1","","","2019-06-05 08:50:04","","1","884","<p>When I was using Retrofit, I could easily create logging interceptors to see the calls with body and headers on the logcat:</p>

<pre><code> val loggingInterceptor = HttpLoggingInterceptor().setLevel(HttpLoggingInterceptor.Level.BODY)
            val httpClient = OkHttpClient.Builder()
                    .addInterceptor(loggingInterceptor)
</code></pre>

<p>and then </p>

<pre><code> val retrofit = retrofit2.Retrofit.Builder()
                    .client(httpClient.build())
</code></pre>

<p>Now, <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">we switched to Ktor</a> and I don't know 
I dont know how </p>

<ul>
<li>to use <code>addInterceptor()</code>? </li>
<li>and for [<code>install(CallLogging)</code>][2] nothing happens..</li>
</ul>

<p>Any suggestions or examples?</p>

<p>[2] source: </p>

<pre><code>fun Application.main() {
    install(CallLogging){
        level = Level.TRACE
    }
}
</code></pre>
","11234746","","11234746","","2019-06-05 15:02:42","2019-06-07 18:04:13","How to add a logging interceptor for KTOR?","<logging><kotlin><ktor>","1","4","","","","56457143","128262","128262","ktor","265","45915935","45915934"
"56458202","1","","","2019-06-05 09:55:38","","0","91","<p>I develop a ktor server, when I send JSON in HTTP POST with a REST API, I got the original UTF-8 post body wiht encoding ISO_8859_1. I can convert it back to UTF-8 at all my request, at all code occurrence. But I would it configure in the top level of ktor server just one times. How can I change ktor default charset or something like that?</p>
","5457053","","","","","2019-06-05 09:55:38","How to set ktor char encoding to UTF-8","<rest><kotlin><character-encoding><grpc><ktor>","0","1","","","","56458202","128262","128262","ktor","265","45915935","45915934"
"56484281","1","56484636","","2019-06-06 19:56:23","","1","658","<p>I'm trying to add logging for <code>Ktor</code> http requests in Android application. According to <a href=""https://ktor.io/clients/http-client/features/logging.html"" rel=""nofollow noreferrer"">docs</a> I have to add gradle dependency</p>

<p><code>implementation ""io.ktor:ktor-client-logging:$ktor_version""</code></p>

<p>and just use this snippet</p>

<pre><code>val client = HttpClient() {
    install(Logging) {
        logger = Logger.DEFAULT
        level = LogLevel.HEADERS
    }
}
</code></pre>

<p>Problem is that compiler ""ignores"" package 'io.ktor.client.features.logging' added as a dependency. What's strange is that JsonFeature (added as similar dependency) works just fine.</p>

<pre><code>install(JsonFeature) { // perfectly works
...
}

install(Logging) { // unresolved reference
...
}
</code></pre>

<p>I already checked <code>.jar</code> file that gradle added to the project, it contains all expected classes, I can open them and see the source code, but magically just can't use in my app. After hours of research I guess it may be somehow related to gradle metadata or that logging feature is multiplatform and some additional gradle configuration is required, but unfortunately I'm not a gradle expert.</p>

<p>I tried adding <code>enableFeaturePreview(""GRADLE_METADATA"")</code> to <code>settings.gradle</code>, but no effect. Even tried to add ""-jvm"" to dependency.</p>

<p><code>implementation ""io.ktor:ktor-client-logging-jvm:$ktor_version""</code></p>

<p>With this dependency Android Studio finding package successfully, but fails to compile with following error</p>

<p><code>More than one file was found with OS independent path 'META-INF/ktor-http.kotlin_module'</code></p>

<p>Can anyone please clarify how to properly configure dependency for Ktor logger?</p>
","8132069","","","","","2019-06-06 20:24:01","Compiler cannot resolve classes in io.ktor.client.features.logging","<android><gradle><logging><kotlin><ktor>","1","0","","","","56484281","128262","128262","ktor","265","45915935","45915934"
"56515343","1","56518765","","2019-06-09 14:18:24","","0","229","<p>I'm having problems with KTOR and EXPOSED for a crud using relationship between tables.
I configured my service as follows:</p>

<pre><code>class LegalPersonService {

    suspend fun findAll(): List&lt;LegalPerson&gt; = dbQuery {
        LegalPersons.selectAll().map { toLp(it) }
    }

    suspend fun insert(lp: LegalPerson, ph: Phone) = dbQuery {
        LegalPersons.insert {
            it[id] = lp.id
            it[internalId] = lp.internalId
            it[companyId] = lp.companyId
            it[active] = lp.active
            it[tradeName] = lp.tradeName
            it[fantasyName] = lp.fantasyName
            it[email] = lp.fantasyName
            it[cnpj] = lp.cnpj
            it[stateRegistration] = lp.stateRegistration
            it[muninipalRegistration] = lp.muninipalRegistration
            it[address] = lp.address
        }.let {
            Phones.insert {
                it[id] = ph.id
                it[internalId] = ph.internalId
                it[phone] = ph.phone
            }
        }
    }

    private fun toLp(row: ResultRow): LegalPerson =
        Phone(
            id = row[Phones.id],
            internalId = row[Phones.internalId],
            phone = row[Phones.phone]
        ).let {
            LegalPerson(
                id = row[LegalPersons.id],
                internalId = row[LegalPersons.internalId],
                companyId = row[LegalPersons.companyId],
                active = row[LegalPersons.active],
                tradeName = row[LegalPersons.tradeName],
                fantasyName = row[LegalPersons.fantasyName],
                email = row[LegalPersons.email],
                cnpj = row[LegalPersons.cnpj],
                stateRegistration = row[LegalPersons.stateRegistration],
                muninipalRegistration = row[LegalPersons.muninipalRegistration],
                address = row[LegalPersons.address]
            )
        }
}
</code></pre>

<p>And my model:</p>

<pre><code>// *** LEGAL PERSONS ***

data class LegalPerson(
    val id: UUID,
    val internalId: Long,
    val companyId: UUID,
    val active: Boolean,
    val tradeName: String,
    val fantasyName: String,
    val email: String,
    val cnpj: String,
    val stateRegistration: String,
    val muninipalRegistration: String,
    val address: UUID
)

object LegalPersons : Table(""person.legal_person"") {
    val id: Column&lt;UUID&gt; = uuid(""id"").autoIncrement().primaryKey()
    val internalId: Column&lt;Long&gt; = long(""internal_id"").autoIncrement()
    val companyId: Column&lt;UUID&gt; = uuid(""company_id"")
    val active: Column&lt;Boolean&gt; = bool(""active"")
    val tradeName: Column&lt;String&gt; = varchar(""trade_name"", 100)
    val fantasyName: Column&lt;String&gt; = varchar(""fantasy_name"", 100)
    val email: Column&lt;String&gt; = varchar(""email"", 100)
    val cnpj: Column&lt;String&gt; = varchar(""cnpj"", 18)
    val stateRegistration: Column&lt;String&gt; = varchar(""state_registration"", 20)
    val muninipalRegistration: Column&lt;String&gt; = varchar(""municipal_registration"", 20)
    val address: Column&lt;UUID&gt; = uuid(""address"")
}

// *** PHONES ***

data class Phone(
    val id: UUID,
    val internalId: Long,
    val phone: UUID
)

object Phones : Table(""person.phone_legal_person"") {
    val id: Column&lt;UUID&gt; = reference(""id"", LegalPersons.id).primaryKey()
    val internalId: Column&lt;Long&gt; = long(""internal_id"").autoIncrement()
    val phone: Column&lt;UUID&gt; = uuid(""phone"")
}
</code></pre>

<p>But I'm getting this error when I'm trying to insert data:</p>

<pre><code>ERROR Application - Unhandled: POST - /api/clients/lp/
io.ktor.gson.UnsupportedNullValuesException: Receiving null values is not supported
</code></pre>

<p>Could anyone help? I am using DLS as opposed to DAO.
I am having difficulty, since the documentation is still being made.</p>
","9910654","","","","","2019-06-09 22:13:50","CRUD with table relationship using KTOR and EXPOSED","<ktor><kotlin-exposed>","1","1","","","","56515343","128262","128262","ktor","265","45915935","45915934"
"15220020","1","","","2013-03-05 09:20:54","","1","281","<p>How do I fetch data using a temporary view with ektorp. I would like to pass the map javascript function to couchdb as a string and get the results. (This is definitely possible with CouchDB4J)</p>
","9425","","1033581","","2018-12-09 04:10:01","2018-12-09 04:10:01","Query Ad-Hoc (Temporary) Views with ektorp","<couchdb><ektorp>","1","0","","","","15220020","73833","73833","ektorp","71","7739352","7739351"
"15459604","1","15643254","","2013-03-17 10:12:02","","1","1302","<p>I'm working on a Java application which uses the Ektorp Framework to communicate with a CouchDB. I use the following code to create a new CouchDbInstance:</p>

<pre><code>HttpClient httpClient = new StdHttpClient.Builder()
    .host(""localhost"")
    .port(""5984"")
    .username("""")
    .password("""");

/* no user name and password required because, its admin party */

CouchDbInstance couchDbInstance = new StdCouchDbInstance(httpClient);
</code></pre>

<p>Now I want to test the connection to the CouchDB before I create/modify etc. documents. There is no method for testing the connection. Do you have a tip for me?</p>
","2096060","","","","","2017-02-01 02:20:28","Ektorp CouchDB test connection","<java><couchdb><ektorp>","3","0","1","","","15459604","73833","73833","ektorp","71","7739352","7739351"
"15683166","1","","","2013-03-28 13:27:49","","2","430","<p>I am trying to synchronize my CouchDB with my android in a way that it works as good offline as online and as far as I understand the .continues(true/false) is the way to go for this. But is there some way to actually change it on runtime some way? I am thinking of having a BroadcastReciever listening to if there is any CONNECTIVITY_SERVICE and set the value of .continues() accordingly but I can't get it to work... any suggestions?</p>

<pre><code>protected void startEktorp() {
    httpClient = new TouchDBHttpClient(server);
    dbInstance = new StdCouchDbInstance(httpClient);

    HamsterSyncEktorpAsyncTask startupTask = new HamsterSyncEktorpAsyncTask() {

        @Override
        protected void doInBackground() {
            // create a local database
            dbConnector = dbInstance.createConnector(DATABASE_NAME, true);
        }

        @Override
        protected void onSuccess() {
            // Create the query and get the results
            queryDB();
            // Start doing the replications!
            startReplications();
        }
    };
    startupTask.execute();
}

public synchronized void queryDB() {
    ViewQuery viewQuery = new ViewQuery()
            .designDocId(""_design/"" + dDocName).viewName(viewName)
            .reduce(false).includeDocs(true);
    ViewResult viewResult = dbConnector.queryView(viewQuery);
    Log.v(""SUCCESS"", viewResult.getRows().toString());

    notifyHandlers(viewResult);
}

/**
 * Replicates the database from server to the phone and vice versa.
 */
public void startReplications() {
    // pull this database to the test replication server
    pullCommand = new ReplicationCommand.Builder().source(DATABASE_PATH)
            .target(DATABASE_NAME).continuous(true).build();

    pushCommand = new ReplicationCommand.Builder().source(DATABASE_NAME)
            .target(DATABASE_PATH).continuous(true).build();

    HamsterSyncEktorpAsyncTask pushReplicaton = new HamsterSyncEktorpAsyncTask() {

        @Override
        protected void doInBackground() {
            dbInstance.replicate(pullCommand);
            ReplicationStatus status = dbInstance.replicate(pushCommand);
            Log.e(TAG, status.getSessionId().toString());
        }
    };
    pushReplicaton.execute();
}
</code></pre>

<p>I am also wondering if there are any way to know if and when the replication actually sent/got something new and update my listview in the app showing all the documents in my database (the queryDB() function)?</p>
","2219868","","","","","2013-03-28 13:27:49","ektorp couchDB to android replication","<android><couchdb><httpclient><replication><ektorp>","0","1","4","","","15683166","73833","73833","ektorp","71","7739352","7739351"
"15970364","1","15972037","","2013-04-12 11:37:38","","3","399","<p>I am new to CouchDB and Ektorp (I ACTUALLY started today to try to work with it). The most detailed documentation I have found to help me getting started is this one:</p>

<p><a href=""http://www.ektorp.org/reference_documentation.html#d100e394"" rel=""nofollow"">http://www.ektorp.org/reference_documentation.html#d100e394</a></p>

<p>My use case is that I want to save a very complex class as a document (I have managed that so far), but I do not want to load all the fields all the time (since some of those are potentially big collections of other simpler documents).</p>

<p>Here is an example of what I have (its just an experimental class I am using to learn to use Ektorp and CouchDB</p>

<pre><code>@JsonSerialize(include = Inclusion.NON_NULL)
public class Player extends CouchDbDocument {

    private int xp = 0;

    @JsonDeserialize(using = CoinPouchDeserializer.class)
    private CoinPouch coins = new CoinPouch(); // subclass of enumMap not
                           // complex
    @DocumentReferences(backReference = ""playerId"", fetch = FetchType.LAZY, descendingSortOrder = true, orderBy = ""itemid"")
    private Inventory inventory = new Inventory();// subclass of Map&lt;String,
                          // Item&gt; Items are document
                          // themselves
}
</code></pre>

<p>I manage to save it and get it by id just fine. But how to I get it without loading it inventory?<br>
I would also appreciate any link to other resources I should checkout about starting to use couchdb or ektorp with java (or scala), cheers.</p>

<p>Thanks for any helpful answer.</p>
","1998098","","","","","2013-04-12 12:57:53","Can someone explain me Cascading and FetchType lazy in Ektorp?","<java><nosql><couchdb><ektorp>","1","0","0","","","15970364","73833","73833","ektorp","71","7739352","7739351"
"56533497","1","56535152","","2019-06-10 21:02:31","","2","613","<p>I have <code>ktor</code> application which expects file from multipart in code like this:</p>

<pre><code>multipart.forEachPart { part -&gt;
  when (part) {
    is PartData.FileItem -&gt; {
      image = part.streamProvider().readAllBytes()
    }
    else -&gt; // irrelevant
  }
}    
</code></pre>

<p>The Intellij IDEA marks <code>readAllBytes()</code> as inappropriate blocking call since ktor operates on top of coroutines. How to replace this blocking call to the appropriate one?</p>
","6856361","","","","","2019-06-11 00:59:58","How to replace blocking code for reading bytes in Kotlin","<kotlin><kotlin-coroutines><ktor>","1","0","0","","","56533497","128262","128262","ktor","265","45915935","45915934"
"56592788","1","56608950","","2019-06-14 06:41:36","","2","997","<p>I'd like to use a session cookie for authentication with Ktor and what I have so far is:</p>

<pre><code>private const val SEVER_PORT = 8082
private const val SESSION_COOKIE_NAME = ""some-cookie-name""

data class AuthSession(
    val authToken: String
)

fun main() {
    embeddedServer(Netty, port = SEVER_PORT, module = Application::basicAuthApplication).start(wait = true)
}

fun Application.basicAuthApplication() {
    install(Sessions) {
        cookie&lt;AuthSession&gt;(SESSION_COOKIE_NAME, SessionStorageMemory()) {
            cookie.path = ""/""
        }
    }
    install(DefaultHeaders)
    install(CallLogging)
    install(Authentication) {
        session&lt;AuthSession&gt; {
            validate { session -&gt;
                // TODO: do the actual validation
                null
            }
        }
    }

    routing {
        authenticate {
            get(""/"") {
                call.respondText(""Success"")
            }
        }
    }
}
</code></pre>

<p>But everytime when I do:</p>

<pre><code>curl -v localhost:8082
</code></pre>

<p>I get an HTTP 200 and the response ""Success""</p>

<p>I expected to get an HTTP 401 Not authorized or something similar.</p>

<p>Can somebody give me insights here how to do proper session cookie authentication with Ktor?</p>

<p>thanks</p>
","5247292","","","","","2019-06-18 10:22:10","Ktor Session Cookie Authentication","<kotlin><ktor>","1","0","","","","56592788","128262","128262","ktor","265","45915935","45915934"
"56599650","1","56601712","","2019-06-14 13:54:44","","1","133","<p>In this sample from Ktor website <a href=""https://ktor.io/samples/feature/auth.html"" rel=""nofollow noreferrer"">https://ktor.io/samples/feature/auth.html</a> they use an account ""test"" with password ""test"" as example.</p>

<pre><code>@UseExperimental(KtorExperimentalAPI::class)
val hashedUserTable = UserHashedTableAuth(
    getDigestFunction(""SHA-256"") { ""ktor${it.length}"" },
    table = mapOf(
        ""test"" to Base64.getDecoder().decode(""GSjkHCHGAxTTbnkEDBbVYd+PUFRlcWiumc4+MWE9Rvw="") // sha256 for ""test""
    )
)
</code></pre>

<p>I need to create another entry, but I can't figure out how they got that hash. I tried to sha256 the word ""test"", salted or not, tried to base64 the result... Nothing matches that hash so I'm unable to create another user.</p>

<p>Anyone could enlighten me here on how to create a compatible hash with that code?</p>
","515291","","","","","2019-06-14 16:00:13","Ktor basic auth from UserHashedTableAuth","<authentication><kotlin><base64><sha256><ktor>","1","0","","","","56599650","128262","128262","ktor","265","45915935","45915934"
"56614483","1","56625538","","2019-06-15 22:03:12","","0","406","<p><a href=""https://ktor.io/quickstart/guides/api.html#serving-json-content"" rel=""nofollow noreferrer"">Serving JSON content in Ktor as described in HTTP API - Quick Start - Ktor</a>, as shown in the examples, works for common collections (lists, maps, etc.) and data classes. However, if I want to serialize a class that is not a data class and has fields that I want to exclude, how do I specify the fields to be serialized and their serialized names? Assume that I am using Gson, can I do it in the same way as serializing a class object using Gson directly?</p>
","5082913","","","","","2019-06-17 06:08:34","Specify class fields to be serialized to JSON in Ktor","<json><kotlin><gson><ktor><json-serialization>","1","1","","","","56614483","128262","128262","ktor","265","45915935","45915934"
"56643352","1","56645756","","2019-06-18 06:57:23","","0","1232","<p><strong>Question</strong></p>

<p>I got a problem with understanding some basic thing about auth0, probably someone can help me out.</p>

<p>In the tutorial <a href=""https://auth0.com/docs/architecture-scenarios/spa-api"" rel=""nofollow noreferrer"">SPA + API</a> one of the first lines in the TDLR is this:</p>

<blockquote>
  <p>Both the SPA and the API must be configured in the Auth0 Dashboard</p>
</blockquote>

<p>I dont understand why I need to configure the API on Auth0. My code seems to work so can anyone help me understand if I do something wrong or what the advantages are if I actually add a custom API in my dashboard?</p>

<p><strong>Setup</strong></p>

<ul>
<li>SPA (React)</li>
<li>Auth0</li>
<li>REST API (ktor)</li>
</ul>

<p><strong>What I do</strong></p>

<ul>
<li>Created a SPA on Auth0 </li>
<li>Login on my SPA through Auth0 to get a JWT (google token)</li>
<li>Sending the JWT as authentication bearer in my calls to the REST API</li>
<li>REST API verifies the JWT token with a JWK provider using the Auth0 url <code>mydomain.eu.auth0.com/.well-known/jwks.json</code>. </li>
<li>Authentication seems to work</li>
</ul>
","753628","","","","","2019-06-18 09:20:08","What is the advantage of a custom API in Auth0?","<jwt><single-page-application><auth0><ktor>","1","0","","","","56643352","128262","128262","ktor","265","45915935","45915934"
"15976886","1","16058673","","2013-04-12 16:54:29","","3","1256","<p>At first I misunderstood my problem and posted this question : <a href=""https://stackoverflow.com/questions/15970364/can-someone-explain-me-cascading-and-fetchtype-lazy-in-ektorp/15972037?noredirect=1#comment22770964_15972037"">Can someone explain me Cascading and FetchType lazy in Ektorp?</a></p>

<p>What I need to do: I need to save an Entity in couchdb and then have way to read it and potentially ignore some fields.
So I came up with this solution: I create a show function that delete fields from an object and then send it back.</p>

<pre><code>function(doc, req) {
    var result = doc;
    var ignore = JSON.parse(decodeURIComponent(req.query.ignore)); //this is an array of field names
    for (var i = 0, j = ignore.length; i &lt; j; i++) {
        if (result[ignore[i]]) {
            delete result[ignore[i]];
        }
    }
    return {
        body : JSON.stringify(result),
        headers : {
            ""Content-Type"" : ""application/json""
        }
    };
}
</code></pre>

<p>I have the same function but reversed in which the object keeps the fields I tell the function to keep.</p>

<p>Is there a better way to do this? </p>

<p>I also want to use Ektorp to call this but it allows me to only call Views. Right now I am forced to manage the http request myself. Is there a way to avoid this?</p>

<p>Right now this is the code I must use, but I would like to use Ektorp to do this.</p>

<pre><code>    HttpClient httpClient = new StdHttpClient.Builder().url(""http://localhost:5984"").build();
    CouchDbInstance dbInstance = new StdCouchDbInstance(httpClient);
    CouchDbConnector db = new StdCouchDbConnector(""mydatabase"", dbInstance);
    db.createDatabaseIfNotExists();

    String[] forget = new String[] { ""field_to_ignore"" };
    String uri = ""/mydatabase/_design/mydesigndoc/_show/ignorefields/mydocid?ignore="" + URLEncoder.encode(Json.stringify(Json.toJson(forget)), ""UTF-8"");
    System.out.println(uri);
    HttpResponse r = db.getConnection().get(uri);
    String stuff = new Scanner(r.getContent()).useDelimiter(""\\A"").next();
    System.out.println(stuff);
</code></pre>
","1998098","","-1","","2017-05-23 12:28:07","2013-04-17 11:20:25","How to get doc from couchdb without some fields? using Ektorp if possible","<java><nosql><couchdb><ektorp>","1","0","","","","15976886","73833","73833","ektorp","71","7739352","7739351"
"16460578","1","16460659","","2013-05-09 11:22:17","","0","430","<p>I'm using a TouchDB with ektorp in an Android app to access a CouchDB</p>

<p>The json document I'm accessing has a array of categories:</p>

<p>categories: ['cat1', 'cat2']</p>

<p>In a view query i'm trying to access this array but I get a ClassCastException when trying to convert the result Object to a List:</p>

<pre><code> public void map(Map&lt;String, Object&gt; document, TDViewMapEmitBlock emitter) {
           Object dateAdded = document.get(""dateAdded"");
           Object expiryDate = document.get(""expiryDate"");
           boolean expired = false;
             if(expiryDate!=null){
                 expired = CompareDate.isItemExpired(expiryDate);
             }
           List&lt;String&gt; test = (List&lt;String&gt;)document.get(""categories"");
</code></pre>

<p>The <code>.get()</code> method works fine for single json fields. Any ideas?</p>
","1794063","","","","","2013-05-09 11:41:06","Cast from Object to List<String>: CastClassException","<java><android><json><ektorp><touchdb>","4","2","","","","16460578","73833","73833","ektorp","71","7739352","7739351"
"17090848","1","","","2013-06-13 15:19:02","","2","150","<p>I am new to ektorp and spring. So please do not throw stones at me :). We have existing app written in php/couchdb and now moving it to java/spring/couchdb. I've followed the documentation how to configure and write the code. When I run junit test code works OK, but in the staging environment (Debian) I see sockets are not released, which leads eventually to too many open files error.
The DBConnection object is annotated as repository. I am not using ektorp spring and do not configure ektorp through context.xml</p>

<p>Here is the code to configure </p>

<pre><code>private StdCouchDbConnector couchDbConnectior;

public CouchDbConnector getConnection() {
        if (null != couchDbConnectior) {
            return couchDbConnectior;
        } else {
            return createConnection();
        }
}

private CouchDbConnector createConnection() {
        StdCouchDbInstance dbInstance = null;
        if (null != host || !host.equalsIgnoreCase(""null"")) {
            try {
                HttpClient httpClient = new StdHttpClient.Builder()
                        .url(host)
                        .port(new Integer(port))
                        .username(key1)
                        .password(key2)
                        .maxConnections(new Integer(maxConnections))
                        .connectionTimeout(100000)
                        .socketTimeout(100000)
                        .cleanupIdleConnections(true)
                        .build();
                dbInstance = new StdCouchDbInstance(httpClient);
            } catch (MalformedURLException ex) {
                log.error(""Cannot create CouchDB connection"", ex);
            }
        }
        if (null != dbInstance) {
            return dbInstance.createConnector(dataBaseName, false);
        } else {
            return null;
        }
    }
</code></pre>

<p>As I mentioned before the connection itself is working fine. The problem is when I run code in tomcat in stage environment sockets are not released and I see so many opened sockets connections with status CLOSE_WAIT and I know that they are stuck because process ran at midnight and I checked the system at 11 AM.
Here is what I see when I run lsof connand</p>

<p>java       604     root   44u     IPv6              53620      0t0        TCP ip_of_couch_db (CLOSE_WAIT)</p>

<p>Any help will be greatly appreciated. </p>
","2220923","","","","","2013-06-13 15:19:02","EKTORP and Spring in Linux sockets are not released","<spring><sockets><ektorp>","0","1","1","","","17090848","73833","73833","ektorp","71","7739352","7739351"
"17286444","1","17624294","","2013-06-24 22:53:03","","0","386","<p>I have the following record structure (simplified to include only the bits that matter):</p>

<pre><code>_id: couchDB generated ID
_rev: couchDb generated revision number
_creationDate: timestamp for when the record was created
_amount: how much money was paid
_type: how they paid (Visa, MC, etc.)
</code></pre>

<p>I need to be able to sum up the totals for each payment type using the creationDate as the start and end key. I'd like to avoid making multiple queries for each type because there is an unknown number of payment types possible. I'd first have to query all available types and then do a single query for each specific type.</p>

<p>My view's map:</p>

<pre><code>   function(doc) {
      if(doc.type==""payment"") {
        emit([doc.type, doc.creationDate], doc.amount);
      }
   }
</code></pre>

<p>My view's reduce function:</p>

<pre><code>_sum
</code></pre>

<p>My query:</p>

<pre><code>   ViewQuery query = new ViewQuery()
      .designDocId(GLOBAL_DOC)
      .viewName(TOTAL_CREDIT_CARD_PAYMENTS_FOR_TODAY)
      .startKey(start)
      .group(true)
      .groupLevel(1)
      .reduce(true);
</code></pre>

<p>When I run the query in futon it builds everything as expected, giving the totals for all types grouped by type (and ignoring creationDate since no start or end is specified). When I run it using the query it looks like the start and end dates are being ignored because I get data outside of the expected range included in the totals.</p>

<p>Also, is there a way through futon to run a query with start and end keys? It's make developing these things faster if I knew how to skip the recompile / reinstall steps.</p>

<p>EDIT: The SQL version of what I'm trying to achieve would look something like this:</p>

<pre><code>   SELECT sum(amount)
   FROM payment
   WHERE creationDate &gt;= startDate AND creationDate &lt;= endDate
   GROUP BY type;
</code></pre>

<p>Is there a standard pattern to follow to get this behavior from a map/reduce?</p>
","556444","","556444","","2013-06-25 13:48:11","2013-07-12 21:28:25","How to build a multipart query in Ektorp and couchDB?","<nosql><couchdb><couchdb-futon><ektorp>","1","2","","","","17286444","73833","73833","ektorp","71","7739352","7739351"
"18095334","1","","","2013-08-07 05:28:48","","1","79","<p>I am creating replications using ektorp's ReplicationCommand.Builder() like below :</p>

<pre><code>ReplicationCommand replicationCommand = new ReplicationCommand.Builder()
            .source(sourceDB)
            .target(targetDB)
            .continuous(isContinuous)
            .build();
couchDbInstance.replicate(replicationCommand); 
</code></pre>

<p>This doesn't create a doc under <code>_replicator</code> db.</p>

<p>In my app I end up creating multiple replications and I might setup multiple replications with same source-target combination. When I have to cancel (one of the multiple replications), I end up  cancelling all replications with that source-target combination. </p>

<pre><code>ReplicationCommand replicationCommand = new ReplicationCommand.Builder()
            .source(sourceDB)
            .target(targetDB)
            .continuous(isContinuous)
            .cancel(isContinuous)
            .build();
couchDbInstance.replicate(replicationCommand);
</code></pre>

<p>I would like to have named-replications (like in <code>_replicator</code> when done through futon) so that I can cancel repeated one.</p>

<p>How do I do it ?</p>

<p>Regards,
Vijay </p>
","704728","","","","","2013-08-07 05:28:48","Named replications using Ektorp under /_replicate","<couchdb><couchbase><ektorp>","0","0","1","","","18095334","73833","73833","ektorp","71","7739352","7739351"
"18439175","1","","","2013-08-26 07:48:59","","0","352","<p>I am using <strong>CouchDB</strong> in my <strong>Android</strong> application. <em>My app also syncs data to an online server.</em> The problem that I am facing with the CouchDB views is that when I call a view it takes a lot of time to return the resulted documents(even when <code>includeDocs(false)</code>). It should cache the view for the first time so that retrieval will be fast for other times in the future. </p>

<p>If I run the view on the server side then <strong>data is cached automatically</strong> but calling those views from Android device causes delay in response. In this case when data is synced on my Android device, these views should fetch the data  from <strong>localhost</strong> rather than online - so retrieval should be fast from <strong>localhost</strong> but it is not. </p>

<p>Might be indices of localhost(Android device) couchdb are not indexed that is why everytime I call a view it returns the result after a lot of delay. Any Idea how to resolve this issue.</p>

<p>::<em>I am using Ektorp API for couchdb.</em></p>
","1602343","","","","","2013-09-10 13:15:56","Lazy query response after Indexing views - CouchDB on Android Device","<android><nosql><views><couchdb><ektorp>","1","7","","","","18439175","73833","73833","ektorp","71","7739352","7739351"
"56706485","1","56707530","","2019-06-21 15:34:20","","1","376","<p>I am using <a href=""https://api.ktor.io/1.2.2/"" rel=""nofollow noreferrer"">Ktor 1.2.2</a> and I have an InputStream object that I want to use as the body for an HttpClient request I make down the line. Up until Ktor 0.95 there was this <a href=""https://api.ktor.io/0.9.5/io.ktor.webjars/-input-stream-content/index.html"" rel=""nofollow noreferrer"">InputStreamContent</a> object that seemed to do just that but it has been removed from Ktor at version 1.0.0 (couldn't figure out why unfortunately). </p>

<p>I can make it work using a ByteArrayContent (see code below) but I'd rather find a solution that does not require loading the entire InputStream into memory...</p>

<pre><code>ByteArrayContent(input.readAllBytes())
</code></pre>

<p>This code is a simple test case that emulate what I'm trying to achieve:</p>

<pre><code>val file = File(""c:\\tmp\\foo.pdf"")
val inputStream = file.inputStream()
val client = HttpClient(CIO)
client.call(url) {
      method = HttpMethod.Post
      body = inputStream // TODO: Make this work :(
    }
// [... other code that uses the response below]
</code></pre>

<p>Let me know if I missed any relevant information,</p>

<p>Thanks!</p>
","7490030","","2318632","","2020-02-23 14:32:00","2020-02-23 14:32:00","In Ktor, how can I stream an InputStream into a HttpClient Request's body?","<kotlin><ktor><ktor-client>","2","0","","","","56706485","128262","128262","ktor","265","45915935","45915934"
"56714319","1","56722395","","2019-06-22 09:34:15","","0","333","<p>I'm trying to configure a Kotlin Multiplatform Project with Android and Ktor modules in it. After configuration, running the Ktor app fails with this message:</p>

<pre><code>/usr/lib/jvm/java-8-openjdk-amd64/bin/java -javaagent:/home/lenqnr/intellij-idea/lib/idea_rt.jar=44331:/home/lenqnr/intellij-idea/bin -Dfile.encoding=UTF-8 -classpath /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/cldrdata.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/dnsns.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/icedtea-sound.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/jaccess.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/java-atk-wrapper.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/localedata.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/nashorn.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/sunec.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/sunjce_provider.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/sunpkcs11.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext/zipfs.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/management-agent.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-netty/1.2.2/86f06a652bf2859236835e802cd81dc884a72c61/ktor-server-netty-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-host-common/1.2.2/80e62a4dab4e116aeb50e8017838b83836764bf9/ktor-server-host-common-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-server-core/1.2.2/37ba2773c666ff3f9f35a6d5949b8b8c2edd6adf/ktor-server-core-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-cio-jvm/1.2.2/22659690f735fa439b4f91b83ef846e3ec7dedf1/ktor-http-cio-jvm-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-jvm/1.2.2/1381ef340b58a3287f1da884b9db7280466c67ff/ktor-http-jvm-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-network/1.2.2/e8b2d5f46acfc25d7e893dde14f8da41ab28b7fd/ktor-network-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-utils-jvm/1.2.2/7c51add50945d74c07926e11acd33b66295903c8/ktor-utils-jvm-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk8/1.3.40/2d1d0a2f27fd060787075c69113846803fc27734/kotlin-stdlib-jdk8-1.3.40.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-classic/1.2.1/706a8b8206ead3683ec639dd270d11fd948fbb0e/logback-classic-1.2.1.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk7/1.3.40/2995de8f68444ad47f29e7b59962ac31e6301d7e/kotlin-stdlib-jdk7-1.3.40.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-io-jvm/0.1.10/ec98e487d8c710126001c4f3086e4a0b9c0d3179/kotlinx-coroutines-io-jvm-0.1.10.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-io-jvm/0.1.10/74f179ae134d78ad360770801807c7078e71885/kotlinx-io-jvm-0.1.10.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-jdk8/1.2.2/71653b85af2fe6baeb5314c2863dffe7aac8068a/kotlinx-coroutines-jdk8-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core/1.2.2/6ff48bdfc38a8c22e3fc37605b6a6afaed3b6dbd/kotlinx-coroutines-core-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-reflect/1.3.40/f2f8357e000fd80d8d799110f012b86fd4637386/kotlin-reflect-1.3.40.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib/1.3.40/b8a521c687329303778548e2f09b0ba5b2665236/kotlin-stdlib-1.3.40.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/atomicfu/0.12.9/5cee16643956d76c52c7ef345448b0990b6e1e04/atomicfu-0.12.9.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.slf4j/slf4j-api/1.7.25/da76ca59f6a57ee3102f8f9bd9cee742973efa8a/slf4j-api-1.7.25.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/com.typesafe/config/1.3.1/2cf7a6cc79732e3bdf1647d7404279900ca63eb0/config-1.3.1.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http2/4.1.36.Final/ed198d8a5283910b0c062a50dd28ef4688dcb2a5/netty-codec-http2-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty.alpn/alpn-api/1.1.3.v20160715/a1bf3a937f91b4c953acd13e8c9552347adc2198/alpn-api-1.1.3.v20160715.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-native-kqueue/4.1.36.Final/a2c6883a0f2e0adc15e6d764ced0ef044e2311c7/netty-transport-native-kqueue-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-native-epoll/4.1.36.Final/5eb8b3ad0a99a16e5ae492da27544b1143e00606/netty-transport-native-epoll-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-core/1.2.1/378913dfc3c6c71e7e2a2853eff2c3e8ac27599/logback-core-1.2.1.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-io/0.1.10/798b764e7f9396e63eb263a83c0385686d69f3e0/kotlinx-coroutines-io-0.1.10.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-io/0.1.10/c407b4bf931379824cf002f110df028cfe18c87c/kotlinx-io-0.1.10.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core-common/1.2.2/8b54928fbb813408684911eb27d6afeb23c92a4b/kotlinx-coroutines-core-common-1.2.2.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-common/1.3.40/ff8f3da514fc2877d1303d55e22d6da8156c29fb/kotlin-stdlib-common-1.3.40.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains/annotations/13.0/919f0dfe192fb4e063e7dacadee7f8bb9a2672a9/annotations-13.0.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/atomicfu-common/0.12.9/ba80bc10a440ea504b5cebd262becf9870e309c3/atomicfu-common-0.12.9.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http/4.1.36.Final/62b73d439dbddf3c0dde092b048580139695ab46/netty-codec-http-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-handler/4.1.36.Final/1c38a5920a10c01b1cce4cdc964447ec76abf1b5/netty-handler-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec/4.1.36.Final/8462116d327bb3d1ec24258071f2e7345a73dbfc/netty-codec-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-native-unix-common/4.1.36.Final/d95d7033f400f9472db9da7834c443b96cd4bab0/netty-transport-native-unix-common-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport/4.1.36.Final/8546e6be47be587acab86bbd106ca023678f07d9/netty-transport-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-buffer/4.1.36.Final/7f2db0921dd57df4db076229830ab09bba713aeb/netty-buffer-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver/4.1.36.Final/e4d243fbf4e6837fa294f892bf97149e18129100/netty-resolver-4.1.36.Final.jar:/home/lenqnr/.gradle/caches/modules-2/files-2.1/io.netty/netty-common/4.1.36.Final/f6f38fde652a70ea579897edc80e52353e487ae6/netty-common-4.1.36.Final.jar ApplicationKt
Error: Could not find or load main class ApplicationKt

Process finished with exit code 1
</code></pre>

<p>I noticed the module's output path is not included in the <code>-classpath</code> option. How should I fix it?</p>

<p>Here's what I did:</p>

<ol>
<li>Create new Gradle project with no additional libraries and frameworks using IntelliJ IDEA</li>
<li>Add new Android module</li>
<li>Add new Multiplatform module</li>
<li>Add new Ktor module</li>
<li>Define main method as shown in the <a href=""https://ktor.io/quickstart/index.html"" rel=""nofollow noreferrer"">Ktor quick start</a></li>
</ol>

<p>If you follow these steps, then I'm pretty sure you'll face the same problem. I'm working on Ubuntu 18.04 just in case.</p>

<p>project structure:</p>

<pre><code>hello
├── android
├── common
├── server
│   ├── resources
│   └── src
│       └── Application.kt
├── build.gradle
└── settings.gradle
</code></pre>

<p>settings.gradle in root project:</p>

<pre><code>include ':android', ':common', ':server'
</code></pre>

<p>build.gradle in root project:</p>

<pre><code>buildscript {
    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath(""com.android.tools.build:gradle:3.4.1"")
        classpath(""org.jetbrains.kotlin:kotlin-gradle-plugin:1.3.40"")
    }
}

allprojects {
    repositories {
        google()
        jcenter()
    }
}
</code></pre>
","11684295","","","","","2019-06-23 08:55:28","Ktor app is not running inside Kotlin Multiplatform Project using IntelliJ IDEA","<intellij-idea><ktor><kotlin-multiplatform>","1","1","0","","","56714319","128262","128262","ktor","265","45915935","45915934"
"56733260","1","","","2019-06-24 09:07:56","","1","76","<p>I'm using ktor for a kotlin/native app. Currently I'm testing things out on the android side and because of that I have some code directly in the viewmodel. The app needs to listen to incoming udp datagrams but it doesn't seem to receive anything. What am I doing wrong in my implementation?</p>

<p>How I listen to the incoming data while testing:</p>

<pre><code>viewModelScope.launch(Dispatchers.IO) {
            aSocket(ActorSelectorManager(Dispatchers.IO)).udp()
                .bind(InetSocketAddress(""localhost"", 40779))
                .use { udpSocket -&gt;
                    Log.d(""hereUDP"", udpSocket.localAddress.toString())
                    try {
                        while (!udpSocket.isClosed) {
                            val datagram = udpSocket.receive()
                            Log.d(""hereUDP"", ""received"")
                            val line = datagram.packet.readText()
                            Log.d(""hereUDP"", line)

                            if (line.toLowerCase() == ""q"")
                                udpSocket.close()
                        }
                        Log.d(""hereUDP"", ""closed"")
                    } catch (e:Throwable){
                        Log.d(""hereUDP"", ""something went wrong"", e)
                        udpSocket.close()
                    }
                }
        }
</code></pre>

<p>The code I actually wanted to get working:</p>

<pre><code>coroutineScope {
            launch(Dispatchers.IO + socket!!.socketContext) {
                socket?.incoming
                    ?.consumeEach {
                        val data = it.packet.readBytes()
                        val address = it.address as InetSocketAddress
                        listener?.onReceive(data, HostEndpoint(address.hostName))
                    }
            }
        }
</code></pre>

<p>What I did in my terminal: </p>

<pre><code>➜  platform-tools nc -u -c 192.168.1.130 40779
bla
bla
^C
</code></pre>
","6849045","","","","","2019-06-24 09:07:56","How to use Ktor BoundDatagramSocket to listen to incoming udp traffic","<android><kotlin><server><udp><ktor>","0","0","","","","56733260","128262","128262","ktor","265","45915935","45915934"
"56792736","1","","","2019-06-27 14:00:07","","0","52","<p>I'm writing common tests for my kotlin multiplatform library which implements the API business logic using ktor client library. </p>

<p>I have a function which takes a callback as an argument, use coroutines to make the request to the API, and then execute the callback. </p>

<p>Here is a simplified version of the function from my UserApi class I want to test</p>

<pre><code>fun &lt;T : Any&gt; fetch(
    requestBuilder: HttpRequestBuilder,
    deserializer: DeserializationStrategy&lt;T&gt;,
    callback: (Either&lt;ErrorMessage, T&gt;) -&gt; Unit)
{
    GlobalScope.launch(dispatcherIO) {
        val result: Either&lt;ErrorMessage, T&gt; =
        try {
            val returnObject: T = Json.parse(
                deserializer, 
                HttpClient().post(requestBuilder)
            )
            Either.Right(returnObject)
        } catch (e: Exception) {
            Either.Left(ErrorMessage(e.message))
        }
        withContext(dispatcherMain) { callback(result) }
    }
}
</code></pre>

<p>I would like to write a unit test like that:</p>

<pre><code>@Test
fun requestOK() {
    runTest { //runTest returns a platform specific runBlocking
        val UserApi().fetch(request, User.serializer()) {
            it.fold(
                { failure -&gt; fail(""must return success"" },
                { user -&gt; assertEquals(expectedUser, user) }
            )
        }
    }    
}
</code></pre>
","9905408","","","","","2019-06-27 14:00:07","How to write unit tests for asynchronous function with a callback argument","<unit-testing><testing><kotlin><ktor><kotlin-multiplatform>","0","2","","","","56792736","128262","128262","ktor","265","45915935","45915934"
"18628482","1","","","2013-09-05 05:32:55","","0","477","<p><strong>How can I retrieve a couchDB document with certain revision?</strong> I am using <code>Ektorp 1.2.2</code> API for <code>Android</code>. </p>

<p>I just want to pass the <strong>docId</strong> and <strong>revision number</strong> somewhere to access a particular document's revision. </p>

<p>I am not getting exact procedure to do that anywhere, How can I achieve this?</p>
","1602343","","1602343","","2013-09-05 05:38:14","2013-09-05 19:27:38","Retrieve a CouchDB document's previous revision with revision id?","<java><android><nosql><couchdb><ektorp>","1","2","","","","18628482","73833","73833","ektorp","71","7739352","7739351"
"18711737","1","","","2013-09-10 06:05:43","","1","221","<p>I am using <code>CouchDB</code> as the database on my <strong>Android Device</strong>. </p>

<p>Here is the problem that I am facing:</p>

<p><strong>The amount of space that couchDB takes on Android Device is very large.</strong> - Every time when couchdb starts replication, it logs the replication stats into a <code>couch.log</code> file - the size of this file keeps on increasing after every replication.</p>

<p>I do not want to log anything in this file because its a memory overhead on my Android Device. How can I stop logging into this <code>couch.log</code> file?</p>

<p><em>- I am using Ektorp API for CouchDB on Android.</em></p>
","1602343","","","","","2013-09-10 11:38:04","Stop CouchDB logging on Android Device?","<android><logging><nosql><couchdb><ektorp>","1","0","2","","","18711737","73833","73833","ektorp","71","7739352","7739351"
"18720823","1","18749235","","2013-09-10 13:52:59","","0","1355","<p>I am using cloudant and ektorp for DB operations in my java application. When I try to do a load test for 100 users (concurrent hits), it throws </p>

<pre><code>Caused by: org.ektorp.DbAccessException: org.apache.http.conn.ConnectionPoolTimeoutException: Timeout waiting for connection
        at org.ektorp.util.Exceptions.propagate(Exceptions.java:19)
        at org.ektorp.http.StdHttpClient.executeRequest(StdHttpClient.java:146)
</code></pre>

<p>Following is my couchdb.properties file</p>

<pre><code>url=https://myaccount.cloudant.com:443
host=https://myaccount.cloudant.com
port=443
username=myusername
password=mypassword
relaxedSSLSettings=true
enableSSL=true
maxConnections=100
connectionTimeout=3000
socketTimeout=30000
autoUpdateViewOnChange=true
cleanupIdleConnections=true
</code></pre>

<p>I am using the following code for creating connector</p>

<pre><code>CouchDbConnector dbConnector = couchdbInstance.createConnector(
                    xxxx,true);
dbConnector.queryView(query,test.class);
</code></pre>

<p>Please help me understand why I get connection timeout and what param i might need to change inorder to fix this</p>
","1089226","","991961","","2013-09-11 12:58:21","2013-09-17 11:11:58","Connection pool timeout in cloudant ( via ektorp)","<java><couchdb><cloudant><ektorp>","1","4","","","","18720823","73833","73833","ektorp","71","7739352","7739351"
"19589625","1","19590240","","2013-10-25 12:15:28","","0","165","<p>I'm working on an application for Android that displays events based on the user selected date. I'm using Couchdb and Ektorp. I don't know how to define a view on method findByMes that includes a variable date that I should read from the calendar instead of the ""2013-10-01""...
This is the code of de class EventDAO I'm working in.</p>

<p>I would be very grateful if someone could help me!!</p>

<pre><code>public class EventDAO extends CouchDbRepositorySupport&lt;EventVO&gt; {

        public EventDAO(CouchDbConnector db) {
                super(EventVO.class, db);
                initStandardDesignDocument();
        }

        @GenerateView @Override
        public List&lt;EventVO&gt; getAll() {
                ViewQuery q = createQuery(""all"")
                                .includeDocs(true);
                return db.queryView(q, EventVO.class);
        }

        public List&lt;EventVO&gt; findByDate(String Date) {
            List&lt;EventVO&gt; event = queryView(""by_date"", Date);
            return  event;
        }

       @View( name = ""by_mes"", map =""function(doc) {if (doc.type == 'Event' &amp;&amp; doc.date &gt;= '2013-10-01' &amp;&amp; doc.date &lt;= '2013-10-31'  ) { emit(doc._id,doc)}}"")
        public List&lt;EventVO&gt; findBymes() {
           ViewQuery q = createQuery(""by_mes"")
                   .includeDocs(true);
           return db.queryView(q, EventVO.class);

        }
}
</code></pre>
","2919808","","","","","2014-06-06 19:19:34","Its possible to put in @View dynamic parameters?","<android><view><couchdb><ektorp>","1","0","","","","19589625","73833","73833","ektorp","71","7739352","7739351"
"56811914","1","","","2019-06-28 18:50:59","","0","263","<p>I have spring boot controller</p>

<pre><code>@PostMapping(path = [""/download""])
fun getFile(@RequestBody myObjectRq: myObjectRq, httpServletResponse: HttpServletResponse): CompletableFuture&lt;HttpServletResponse&gt; {
    return GlobalScope.async {
       val response = webService.getFile(myObjectRq)
       response?.let {
           httpServletResponse.setHeader(""Content-Type"", response.headers.get(""Content-Type""))
           httpServletResponse.setHeader(""Content-Disposition"", response.headers.get(""Content-Disposition""))
           httpServletResponse.writer.write(String(response.content.toByteArray()))
           httpServletResponse.writer.flush()
           httpServletResponse.status = response.status.value
       }
       httpServletResponse
   }.asCompletableFuture()
}
</code></pre>

<p>in which I use service which in turn uses ktor client to send post request to external server which should respond sending csv file. csv file content depends on values I send in <code>myObjectRq</code>.</p>

<p>Service:</p>

<pre><code>suspend fun getFile(myObjectRq: myObjectRq): HttpResponse {
    val response = ktorClient.post&lt;HttpResponse&gt; {
        accept(ContentType.Application.OctetStream)
        url(externalWebServerUrl)
        body = myObjectRq
        contentType(ContentType.Application.Json)
    }
    log.info(String(response.content.toByteArray()))
    response
}
</code></pre>

<p>Headers in response are properly set, also <code>log.info(String(response.content.toByteArray()))</code> in the method prints out the content of received file, but I can't set it as a body of <code>HttpServletResponse</code>. I keep getting <code>org.springframework.web.HttpMediaTypeNotAcceptableException: Could not find acceptable representation</code>.</p>

<p>Also I get <code>Inappropriate blocking method call</code> for <code>httpServletResponse.writer</code> which kind of breaks async qualities of ktor client.
What do I do wrong? How should I solve it?</p>
","8844276","","766328","","2019-06-29 15:47:23","2019-06-29 17:03:28","How to set body of HttpServletResponse using ktor client","<kotlin><ktor>","2","0","","","","56811914","128262","128262","ktor","265","45915935","45915934"
"56989398","1","","","2019-07-11 12:38:09","","0","55","<p>I'm new to KTOR and OAuth 2.0. I’m creating an app with a front end (React JS) and Back End (KTOR). REST API services will be secured with OAuth 2.0. At this point I have a problem with auth flow. If the user is not authentificated, then it triggers OAuth 2.0 auth flow, with several riderects. Because of this redirects I loose the original location and method type. To fix this problem, I use call interceptor and save call data into session. I belive that this is not the best choise. Maybe I miss understand the concept of securing API and auth flow.</p>

<p><a href=""https://i.stack.imgur.com/1JRYY.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/1JRYY.jpg"" alt=""enter image description here""></a></p>
","3496657","","","","","2019-07-11 12:38:09","KTOR Rest API secured with OAuth 2.0","<kotlin><oauth><oauth-2.0><ktor>","0","0","1","","","56989398","128262","128262","ktor","265","45915935","45915934"
"57103615","1","57104636","","2019-07-18 23:01:12","","0","97","<p>I am trying to insert some data into the database, and am getting the following error:</p>

<pre><code>com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot construct instance of `org.joda.time.DateTime` (although at least one Creator exists): no String-argument constructor/factory method to deserialize from String value ('2019-04-19')
</code></pre>

<p>My content negotiation</p>

<pre><code>install(ContentNegotiation) {
        jackson {
            enable(SerializationFeature.INDENT_OUTPUT)
        }
    }
</code></pre>

<p>And my model:</p>

<pre><code>data class User(
//some codes
val registrationDate = DateTime  // org.joda.time.DateTime
)
</code></pre>

<p>And when will I send by json:</p>

<pre><code>{
 //some other data
 ""registrationDate"" : ""2019-07-15""
}
</code></pre>

<p>Can someone help me, please?</p>
","9910654","","162698","","2019-07-18 23:05:41","2019-07-19 16:19:47","Inserting data into database returns MismatchedInputException error","<serialization><kotlin><ktor><kotlin-exposed>","1","0","","","","57103615","128262","128262","ktor","265","45915935","45915934"
"57119697","1","","","2019-07-19 21:19:33","","0","181","<p>I have a function that is successfully hitting a google geolocation api and I can print the the JSON response to the terminal.   I cannot return it correctly in the desired route, however.  </p>

<p>I have tried calling the function inside the route, returning the response.body and then calling it in the route.</p>

<pre><code>    routing {
        get(""/"") {
            call.respondText(""You should absolutely hire Robert!"", contentType = ContentType.Text.Plain)
        }

        get(""/geosearch"") {
            call.respond(fetchGoogle())
            //'https//maps.googleapis.com/maps/api/place/autocomplete/json?input=${req.body.search}&amp;types=geocode&amp;key=MYKEY'
        }
    }
</code></pre>

<pre><code>
fun fetchGoogle(){
    val url = ""https://maps.googleapis.com/maps/api/place/autocomplete/json?input=5136&amp;types=geocode&amp;key=MYKEY""

    val request = Request.Builder().url(url).build()
    val client = OkHttpClient()
    client.newCall(request).enqueue(object: Callback {
        override fun onResponse(call: Call, response: Response) {
            val body = response?.body?.string()
//
            println(body)
//            return body
//            val headers: okhttp3.Headers = response.headers
//            println(headers)
        }

        override fun onFailure(call: Call, e: IOException) {
            println(""Failed to execute"")
        }
    })
}

No errors, but I cannot get the response.body into the /geosearch route.

VERY basic question, but do I need to create a class in order to access the ""body"" of the API call?  
</code></pre>
","9939208","","9939208","","2019-07-23 16:03:32","2019-07-23 16:03:32","I don't know how to set up a proxy server in Kotlin (Ktor framework)","<kotlin><ktor>","0","0","","","","57119697","128262","128262","ktor","265","45915935","45915934"
"57245921","1","57248428","","2019-07-29 00:21:03","","2","224","<p>I am trying to build up an application from Ktor which eventually should be executed via a fatjar.
A fatjar allows the use of arguments like the following one:</p>

<p>java -jar myApp.jar XXXXX YYYYY</p>

<p>I know how to get the XXXXX in the main module (by using simple args[0]) but I have troubles to get that values in the Application modules.</p>

<p>I would like to do something like that:</p>

<blockquote>
  <p>fun main(args: Array) {</p>
  
  <p>val port = System.getenv(""PORT"")?.toInt() ?: 8080</p>
  
  <p>val status = args[0]</p>
  
  <p>embeddedServer(Netty,  port = port, module = (Application::mainModule())).start(wait = true)
  }</p>
  
  <p>fun Application.mainModule() {</p>

<pre><code>routing {get(""/status"") 

{call.respondText(//status variable value from main function, contentType = ContentType.Text.Html)
</code></pre>
  
  <p>}}</p>
</blockquote>
","8502890","","","","","2019-07-30 04:41:42","Is there a way to get the command line argument values into a Ktor Application module instead of the Main application?","<kotlin><ktor>","1","0","","","","57245921","128262","128262","ktor","265","45915935","45915934"
"57268571","1","","","2019-07-30 09:33:01","","0","40","<p>I want to advertise the offered services to the local network.
Is there a nice way to integrate dns-sd or zeroconf/bonjour?</p>
","861744","","861744","","2019-07-30 09:43:04","2019-07-30 09:43:04","How to implement dns-sd in ktor","<netty><ktor><dns-sd>","1","0","","","","57268571","128262","128262","ktor","265","45915935","45915934"
"57273069","1","","","2019-07-30 13:36:41","","3","113","<p>Ktor has support for server side events in the sense that I can use the text/server-event content type. It works pretty well, but on client disconnect e.g. Browser window close/manual close call, it will still continue sending events, as it doesn't detect the disconnect until the next event, where it will throw an exception. Is there any way to get a event for client disconnect in a ktor request so that we can stop sending server side events and also cleanup resources? </p>
","8151052","","1305969","","2019-07-30 14:55:15","2019-07-30 14:55:15","Ktor sse client disconnect","<kotlin><server-sent-events><ktor>","0","0","","","","57273069","128262","128262","ktor","265","45915935","45915934"
"57281338","1","57290529","","2019-07-30 23:35:56","","0","302","<p>I am developing a Kotlin with ktor application and I am using exposed as ORM. I have a table with a reference to another table. The relationship is many to one. ex: </p>

<pre><code>object Users : IdTable&lt;String&gt;() {
   override val id: Column&lt;EntityID&lt;String&gt;&gt; = varchar(""user_id"", 64).entityId().primaryKey()
   val email = varchar(""email"", 128).uniqueIndex()
   val firstName = varchar(""first_name"", 64)
   val lastName = varchar(""last_name"", 64)
}
</code></pre>

<p>&amp; User Attendance table as - </p>

<pre><code>object UserAttendances : IntIdTable() {
   val userId = reference(""user_id"", Users).index()
   val checkInTime = date(""check_in"")
   val checkOutTime = date(""check_out"")
}
</code></pre>

<p>Now when I am trying to insert into the attendance table, i am not sure how to map the insert to users. I tried the following - </p>

<pre><code>StaffAttendances.insert {
    it[date] = DateTime.now()
    it[checkInTime] = DateTime.now()
    it[userId] = userId
}
</code></pre>

<p>This gives a compilation error that the required type is <code>EntityId&lt;String&gt;</code> but found <code>String</code>. Any help on how i can insert into a reference. This could possibly be because I have String as ID column with UUIDs</p>
","1273240","","1273240","","2019-07-31 00:18:50","2019-07-31 13:13:53","Kotlin ktor exposed DSL insert with reference","<kotlin><ktor><kotlin-exposed>","1","0","","","","57281338","128262","128262","ktor","265","45915935","45915934"
"57338810","1","","","2019-08-03 13:34:15","","1","113","<p>when I create the stated project type with Intellij Ultimate 2019.2</p>

<p>and then build the project (F11)</p>

<p>following error appears:</p>

<p><img src=""https://i.ibb.co/hdprkT2/Untitled.png"" alt=""build error""></p>

<p>However when I run the SampleJvm.kt:
<img src=""https://i.ibb.co/CbScXFX/Untitled2.png"" alt=""run""></p>

<p>Netty start and everything seems fine.
Unfortunately the code is not working correctly:</p>

<p><img src=""https://i.ibb.co/0p5yxJ9/Untitled3.png"" alt=""still an error""></p>

<p>The issue seems to be that the backend cannot find the
compiled testy.js, which shall be loaded as a resource
and then added to the HTML site:</p>

<p><img src=""https://i.ibb.co/YZ7xDL1/Untitled4.png"" alt=""issue""></p>

<p>I uploaded the project for download:
<a href=""https://file.io/Jj50Ow"" rel=""nofollow noreferrer"">https://file.io/Jj50Ow</a></p>

<p>Thank you so much for any advice,
Best Chris</p>
","3960197","","","","","2020-04-15 14:20:24","IntelliJ Project ""JS Client and JVM Server | Gradle"" does not work","<gradle><intellij-idea><kotlin><netty><ktor>","2","0","","","","57338810","128262","128262","ktor","265","45915935","45915934"
"57349885","1","","","2019-08-04 20:08:57","","1","427","<p>I am new to Kotlin and recently started working on Ktor server. To perform database operations server needs to communicate with MySql server. I started using JetBrains Exposed library to write database operations. </p>

<p>I wrote a suspended function to execute a block of code(database queries written using Exposed DSL) using transaction. This was followed from a blogpost on the getting started guide for ktor. </p>

<pre><code>suspend fun &lt;T&gt; dbQuery(block: () -&gt; T): T = withContext(Dispatchers.IO) {
        transaction { block() }
    }
</code></pre>

<p>Whenever I need to perform a db query I call </p>

<pre><code>dbQuery {
  // my queries
}
</code></pre>

<p>Because Exposed uses threadlocal transaction managers as well as blocking JDBC driver, I am wondering if this is safe to do so? </p>

<p>There is no good documentation on how to actually handle mysql connections with coroutines. </p>

<p>Incase this is wrong and will eventually lead to Transaction lock out then any pointer on how to solve this will help. </p>
","9774442","","","","","2019-08-06 20:07:29","Is it safe to use Jetbrains exposed library with KTor and perform the database transaction inside a coroutine?","<kotlin><kotlin-coroutines><ktor><kotlin-exposed>","1","1","","","","57349885","128262","128262","ktor","265","45915935","45915934"
"57353827","1","","","2019-08-05 07:18:00","","9","158","<p>As I am newbie in Android, I am building an application in which I need to update layer data on Geo server. For that scenario, I m calling post method along with XML body request. </p>

<p>I need to send data in xml format in request body and need to get response in xml. For that, I tried using XmlSerializer instead of JsonFeature but I got error saying ""XmlSerializer is not comapanion object, need to initialize here""</p>

<pre><code>val httpClient = HttpClient {
        install(JsonFeature) {
            serializer = KotlinxSerializer(Json.nonstrict)
                }
             }
</code></pre>

<p>Thanks in Advance!!</p>
","10347346","","10347346","","2019-08-05 07:32:50","2019-08-05 07:32:50","Serializer for xml data while calling http post method (Ktor lib)","<android><json><kotlin><xmlserializer><ktor>","0","1","","","","57353827","128262","128262","ktor","265","45915935","45915934"
"57378185","1","57927581","","2019-08-06 14:19:08","","0","82","<p>So I started a ktor project in IntelliJ it runs fine there.  However, I am attempting to now have docker use the jar created from the build/libs directory and  I get this error:</p>

<pre><code>WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
Error: A JNI error has occurred, please check your installation and try again
Exception in thread ""main"" java.lang.NoClassDefFoundError: io/ktor/application/Application
    at java.lang.Class.getDeclaredMethods0(Native Method)
    at java.lang.Class.privateGetDeclaredMethods(Class.java:2701)
    at java.lang.Class.privateGetMethodRecursive(Class.java:3048)
    at java.lang.Class.getMethod0(Class.java:3018)
    at java.lang.Class.getMethod(Class.java:1784)
    at sun.launcher.LauncherHelper.validateMainClass(LauncherHelper.java:544)
    at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:526)
Caused by: java.lang.ClassNotFoundException: io.ktor.application.Application
    at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
    ... 7 more
</code></pre>

<p>This is what my ktor.Dockerfile looks like:</p>

<pre><code>FROM openjdk:8-jre-alpine

ENV APPLICATION_USER ktor
RUN adduser -D -g '' $APPLICATION_USER

RUN mkdir /app
RUN chown -R $APPLICATION_USER /app

USER $APPLICATION_USER

COPY ./build/libs/website-0.0.1.jar /app/website-0.0.1.jar
WORKDIR /app

CMD [""java"", ""-server"", ""-XX:+UnlockExperimentalVMOptions"", ""-XX:+UseCGroupMemoryLimitForHeap"", ""-XX:InitialRAMFraction=2"", ""-XX:MinRAMFraction=2"", ""-XX:MaxRAMFraction=2"", ""-XX:+UseG1GC"", ""-XX:MaxGCPauseMillis=100"", ""-XX:+UseStringDeduplication"", ""-cp"", ""website-0.0.1.jar"", ""com.diracian.ApplicationKt""]
</code></pre>

<p>What I did first was start a ktor project, and after I got that working, I started working on my Dockerfile.</p>
","765139","","11895782","","2019-09-13 13:30:32","2019-09-13 16:52:43","IntelliJ Ktor and Docker is there a better way?","<intellij-idea><dockerfile><ktor>","1","0","","","","57378185","128262","128262","ktor","265","45915935","45915934"
"57441771","1","57442647","","2019-08-10 11:33:11","","0","207","<p>I'm wondering how to change allowed file size for multipart-files in ktor? 
I can not find anything in the documentation about this (only how to receive multipart-files). I'm using embedded netty server. I will limit filesize on the client but it would be good to also have that restriction on the server.</p>

<p>Searched the web and the only two things I found related to the topic is this example (seems to be configuration for a WAR file):
<a href=""https://github.com/ktorio/ktor-samples/blob/master/other/maven-google-appengine-standard/webapp/WEB-INF/web.xml"" rel=""nofollow noreferrer"">https://github.com/ktorio/ktor-samples/blob/master/other/maven-google-appengine-standard/webapp/WEB-INF/web.xml</a></p>

<p>and this example (how to receive multipart requests: 
<a href=""https://github.com/ktorio/ktor-samples/blob/master/app/youkube/src/Upload.kt"" rel=""nofollow noreferrer"">https://github.com/ktorio/ktor-samples/blob/master/app/youkube/src/Upload.kt</a></p>
","10851871","","5985853","","2019-08-10 13:37:02","2019-08-10 13:37:02","How to limit allowed file size (multipart-file) in Ktor","<kotlin><file-upload><multipartform-data><multipart><ktor>","1","0","","","","57441771","128262","128262","ktor","265","45915935","45915934"
"57442873","1","57443012","","2019-08-10 14:08:32","","0","19","<p>I have this code and I want to forward to another path when id == 1</p>

<pre><code>get(""/courses/{id}""){
    val id = call.parameters[""id""]?.toInt()
    if (id is Int) {
        if (id == 1)
        // i want redirection to ""/courses/top""
    }
}
</code></pre>
","11154695","","1554633","","2019-08-10 14:28:47","2019-08-10 14:31:14","how do I readirect t another path","<kotlin><ktor>","1","0","","","","57442873","128262","128262","ktor","265","45915935","45915934"
"57443995","1","57445568","","2019-08-10 16:50:13","","0","236","<p>I'm learing how to work with ktor. For a special use case i need to redirect to a different domain from my ktor server. However i cant get it to work rigth now.</p>

<p>As an simple example i have an Application.kt</p>

<pre><code>import io.ktor.application.*
import io.ktor.http.*
import io.ktor.response.*
import io.ktor.routing.*
import io.ktor.server.engine.*
import io.ktor.server.netty.*

fun main(args: Array&lt;String&gt;) {
    val server = embeddedServer(Netty, port = 8080) {
        routing {
         get(""/"") {
           call.respondRedirect(""www.google.com"")
        }}
    }
}
server.start(wait = true)
</code></pre>

<p>}</p>

<p>What i except is that it redirects me to <code>www.google.com</code> however it redirects me to <code>localhost:8080/www.google.com</code></p>
","6044679","","6044679","","2019-08-10 19:11:22","2019-08-10 20:45:12","Redirect to absolute URL in Ktor","<kotlin><ktor>","1","0","","","","57443995","128262","128262","ktor","265","45915935","45915934"
"57447254","1","","","2019-08-11 03:53:02","","0","101","<p>Given the following code results in error: The Ktor response is being created and captured entirely inside of the lambda. A constant string ""OK"" is being returned, not json response. Removing the ktor lines removes the error.</p>

<p>Uncaught Kotlin exception: kotlin.native.IncorrectDereferenceException: Trying to access top level value not marked as @ThreadLocal or @SharedImmutable from non-main thread</p>

<pre><code>val future = backgroundWorker.execute(TransferMode.SAFE, { url }) {
    val client = HttpClient()
    val result = runBlocking {
        client.get&lt;String&gt;(it)
    }
    client.close()
    ""OK""
}
</code></pre>
","1898873","","","","","2019-08-11 03:53:02","Trying to access top level value not marked as @ThreadLocal or @SharedImmutable from non-main thread","<ktor><kotlin-native>","0","1","","","","57447254","128262","128262","ktor","265","45915935","45915934"
"57452660","1","","","2019-08-11 18:45:41","","0","245","<p>I really apologize if this question has been asked before, I'll delete it as soon as someone posts a duplicate, but why does this fail ? </p>

<pre><code>package com.example

import com.example.data.TestObject
import io.ktor.application.*
import io.ktor.response.*
import io.ktor.request.*
import io.ktor.client.*
import io.ktor.client.engine.apache.*
import io.ktor.features.CallLogging
import io.ktor.features.Compression
import io.ktor.features.ContentNegotiation
import io.ktor.features.DefaultHeaders
import io.ktor.gson.gson
import io.ktor.http.ContentType
import io.ktor.routing.get
import io.ktor.routing.routing
import io.ktor.server.engine.embeddedServer
import io.ktor.server.netty.Netty
import java.text.DateFormat

fun main(args: Array&lt;String&gt;): Unit = io.ktor.server.netty.EngineMain.main(args)

@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {
    install(DefaultHeaders)
    install(Compression)
    install(CallLogging)
    install(ContentNegotiation) {
        gson {
            setDateFormat(DateFormat.LONG)
            setPrettyPrinting()
        }
    }

    val server = embeddedServer(Netty, port = 8080) {
        routing {
            get(""/test"") {
                val instance = TestObject()
                call.respond(instance)
            }
        }
    }
    server.start(true)
}
</code></pre>

<p>my TestObject :</p>

<pre><code>data class TestObject(val name: String = ""John"", val additional: String = ""Doe"")
</code></pre>

<p>and my build.gradle:</p>

<pre><code>buildscript {
    repositories {
        jcenter()
    }

    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'kotlin'
apply plugin: 'application'

group 'com.example'
version '0.0.1'
mainClassName = ""io.ktor.server.netty.EngineMain""

sourceSets {
    main.kotlin.srcDirs = main.java.srcDirs = ['src']
    test.kotlin.srcDirs = test.java.srcDirs = ['test']
    main.resources.srcDirs = ['resources']
    test.resources.srcDirs = ['testresources']
}

repositories {
    mavenLocal()
    jcenter()
    maven { url 'https://kotlin.bintray.com/ktor' }
}

dependencies {
    implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    implementation ""io.ktor:ktor-server-netty:$ktor_version""
    implementation ""ch.qos.logback:logback-classic:$logback_version""
    implementation ""io.ktor:ktor-client-core:$ktor_version""
    implementation ""io.ktor:ktor-client-core-jvm:$ktor_version""
    implementation ""io.ktor:ktor-client-apache:$ktor_version""
    implementation ""io.ktor:ktor-gson:$ktor_version""
    testImplementation ""io.ktor:ktor-server-tests:$ktor_version""
}
</code></pre>

<p>The only exception I get is this :</p>

<pre><code>java.lang.IllegalArgumentException: Response pipeline couldn't transform 'class com.example.data.TestObject' to the OutgoingContent
    at io.ktor.server.engine.BaseApplicationResponse$Companion$setupSendPipeline$1.invokeSuspend(BaseApplicationResponse.kt:271)
    at io.ktor.server.engine.BaseApplicationResponse$Companion$setupSendPipeline$1.invoke(BaseApplicationResponse.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27)
    at com.example.ApplicationKt$module$server$1$1$1.invokeSuspend(Application.kt:48)
    at com.example.ApplicationKt$module$server$1$1$1.invoke(Application.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27)
    at io.ktor.routing.Routing.executeResult(Routing.kt:147)
    at io.ktor.routing.Routing.interceptor(Routing.kt:34)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:99)
    at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
</code></pre>

<p>The project does run and i'm able to access different routes of different get requests, but using Gson to serialize my responses just doesn't seem to work ? </p>

<p>Any help is really appreciated, I started out a few hours ago :) </p>
","4729721","","","","","2019-08-11 20:16:43","Response pipeline couldn't transform data class using gson - Ktor","<kotlin><ktor>","1","0","","","","57452660","128262","128262","ktor","265","45915935","45915934"
"57497621","1","57595663","","2019-08-14 15:19:16","","2","254","<p>I have set up a multi-module gradle project with a common module and a ktor module.</p>

<p>The common module is a kotlin multiplatform library.</p>

<p>I would like to be able to serve the javascript files generated from the common library from the ktor server, when I run it from Intellij.</p>

<p>Currently ktor is set up to serve resources as static content:</p>

<pre><code>    static(""/static"") {
        resources()
    }
</code></pre>

<p>The ktor module has a dependency on the common module:</p>

<pre><code>dependencies {
    compile project(':common')
    ...
}
</code></pre>

<p>I would assume when running in Intellij to be able to browse to <a href=""http://localhost:8080/static/common.js"" rel=""nofollow noreferrer"">http://localhost:8080/static/common.js</a> to retrieve the outputs of the common module JS build (written to common\build\classes\kotlin\js\main) but this does not work.</p>
","45062","","","","","2019-08-21 16:14:29","Serve kotlin multiplatform javascript from ktor","<gradle><kotlin><ktor><kotlin-multiplatform>","1","0","","","","57497621","128262","128262","ktor","265","45915935","45915934"
"57502789","1","","","2019-08-14 22:23:13","","0","48","<p>I am working on user role based authentication. My <code>interceptors</code> are exacuted in wrong order: user role, authentication. They need to be switched so that I can access the authenticated user <code>Principal</code> in UserTypeAuthentication. When I debug the code the interceptors a registered in right order. Pipelines seemed to be in right order as well. </p>

<pre><code>class UserTypeAuthentication{
    class Configuration

    companion object Feature : ApplicationFeature&lt;Application, Configuration, UserTypeAuthentication&gt; {
        val userRestrict = PipelinePhase(""UserTypeAuth"")

        override val key = AttributeKey&lt;UserTypeAuthentication&gt;(""UserTypeAuth"")

        override fun install(pipeline: Application, configure: Configuration.() -&gt; Unit): UserTypeAuthentication {
            return UserTypeAuthentication().apply { configure(configure) }
        }
    }

    fun interceptPipeline(
        pipeline: ApplicationCallPipeline,
        vararg types: JWTUserType
    ) {
        pipeline.insertPhaseAfter(ApplicationCallPipeline.Features, userRestrict)

        pipeline.intercept(userRestrict){
            val user = call.authentication.principal as AuthenticatedUser
            if (!types.contains(user.type)) {
                call.respond(HttpStatusCode.Unauthorized)
                finish()
            }
        }
    }

    private fun configure(configure: Configuration.() -&gt; Unit) {}

}

fun Route.only(
    vararg types : JWTUserType,
    build: Route.() -&gt; Unit
): Route {
    val authenticatedRoute = createChild(
        UserTypeRoute(types.toList().distinct().map { it.toString() })
    )

    application.feature(UserTypeAuthentication).interceptPipeline(authenticatedRoute, *types)
    authenticatedRoute.build()

    return authenticatedRoute
}

@Test
fun testMultipleConfigurationsNested() =  withTestApplication {
    application.install(CustomHeader)
    application.install(Authentication) {
        basic {
            validate {
                when(it.name){
                    ""customer"" -&gt; AuthenticatedUser(1, JWTUserType.CUSTOMER)
                    ""admin"" -&gt; AuthenticatedUser(2, JWTUserType.ADMIN)
                    else -&gt; null
                }
            }
        }
    }

    application.install(UserTypeAuthentication)

    application.routing {
        authenticate {
            only(JWTUserType.CUSTOMER){
                route(""/route"") { handle { call.respondText(""OK"") } }
            }
        }
    }


    handleRequest(HttpMethod.Post, ""/route"") {
        addHeader(
            HttpHeaders.Authorization,
            HttpAuthHeader.Single(""basic"", Base64.getEncoder().encodeToString(""customer:password"".toByteArray())).render()
        )
    }.let { call -&gt;
        assertEquals(HttpStatusCode.OK.value, call.response.status()?.value)
    }

    handleRequest(HttpMethod.Post, ""/route"") {
        addHeader(
            HttpHeaders.Authorization,
            HttpAuthHeader.Single(""basic"", Base64.getEncoder().encodeToString(""admin:password"".toByteArray())).render()
        )
    }.let { call -&gt;
        assertEquals(HttpStatusCode.Unauthorized.value, call.response.status()?.value)
    }

}


</code></pre>

<p>Thank you for any ideas :)</p>

<p>EDIT:</p>

<p>I found that if I use before, the test is working. Is there any difference using before and after since the <code>authenticatedRoute</code> should be always inserted in between <code>Features</code> an <code>Call</code> ? </p>

<pre><code>//pipeline.insertPhaseAfter(ApplicationCallPipeline.Features,authenticatedRoute)
  pipeline.insertPhaseBefore(ApplicationCallPipeline.Call, authenticatedRoute)
</code></pre>
","6335443","","6335443","","2019-08-15 08:43:47","2019-08-15 08:43:47","User type restricted route feature, wrong order of interceptors","<kotlin><ktor>","0","0","","","","57502789","128262","128262","ktor","265","45915935","45915934"
"57532760","1","","","2019-08-17 01:57:42","","1","29","<p>I am working on a KTor server. I run the generated jar file using java -jar command. So I expect that only one Java process should run. After running for a while another Java process is being created which is bound to different port.</p>

<p>I checked the details of the process using ps -a [PID] and find this new Java process is ""kotlin-compiler-embeddable"" program.</p>

<p>I am wondering why this process is being created, what is use of this and is it safe to kill it.</p>

<p>Thanks for any pointer.</p>
","11938231","","","","","2019-08-17 03:17:22","Ktor creates an extra Java process","<java><kotlin><process><ktor>","1","0","","","","57532760","128262","128262","ktor","265","45915935","45915934"
"57560999","1","","","2019-08-19 16:54:02","","0","27","<p>I am new to kotlin and ktor. And was wondering if there was a way I login into a website with using a POST. Everything I try I get a 500 internal server error and I can't find out why. </p>

<p>For example say I want to login into Google how could I go about doing that through ktor using POST</p>
","3973465","","","","","2019-08-19 16:54:02","Using ktor post to login into website from android","<android><http-post><httprequest><httpclient><ktor>","0","0","","","","57560999","128262","128262","ktor","265","45915935","45915934"
"57580222","1","57580483","","2019-08-20 19:15:44","","2","594","<p>I'm trying to wrap my head around Kotlin coroutines and Ktors websocket support. My understanding is that <code>runBlocking</code> will create a scope and that it will block as long as there are coroutines living inside that scope (or child scopes), but I when the call to <code>runBlocking</code> in the test below returns there are still two coroutines alive..</p>

<p>Why am I leaking coroutines here?</p>

<pre><code>package dummy

import io.ktor.client.HttpClient
import io.ktor.client.features.websocket.WebSockets
import io.ktor.client.features.websocket.wss
import io.ktor.http.HttpMethod
import io.ktor.http.cio.websocket.Frame
import io.ktor.http.cio.websocket.readBytes
import io.ktor.http.cio.websocket.readText
import io.ktor.util.KtorExperimentalAPI
import kotlinx.coroutines.*
import kotlinx.coroutines.debug.DebugProbes
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test

@ExperimentalCoroutinesApi
@KtorExperimentalAPI
class WebsocketTest {

    @Test
    fun tidy() {
        DebugProbes.install()

        runBlocking {
            val socketJob = Job()

            launch(CoroutineName(""Websocket"") + socketJob) {
                println(""Connecting to websocket"")
                connectWebsocket(socketJob)
                println(""Websocket dead?"")
            }

            launch(CoroutineName(""Ninja socket killer"")) {
                delay(3500)
                println(""Killing websocket client"")
                socketJob.cancel(message = ""Time to die.."")
            }
        }

        println(""\n\n-------"")
        DebugProbes.dumpCoroutines(System.err)
        Assertions.assertEquals(0, DebugProbes.dumpCoroutinesInfo().size, ""It would be nice if all coroutines had been cleared up by now.."")
    }

}


@KtorExperimentalAPI
private suspend fun connectWebsocket(socketJob: CompletableJob) {

    val client = HttpClient {
        install(WebSockets)
    }

    socketJob.invokeOnCompletion {
        println(""Shutting down ktor http client"")
        client.close()
    }

    client.wss(
            method = HttpMethod.Get,
            host = ""echo.websocket.org"",
            port = 443,
            path = ""/""
    ) {

        send(Frame.Text(""Hello World""))

        for (frame in incoming) {
            when (frame) {
                is Frame.Text -&gt; println(frame.readText())
                is Frame.Binary -&gt; println(frame.readBytes())
            }

            delay(1000)
            send(Frame.Text(""Hello World""))
        }
    }

}
</code></pre>

<p>build.gradle.kts</p>

<pre><code>import org.gradle.api.tasks.testing.logging.TestExceptionFormat
import org.gradle.api.tasks.testing.logging.TestLogEvent

plugins {
    kotlin(""jvm"") version ""1.3.41"" apply true
}

repositories {
    mavenCentral()
}

val ktorVersion = ""1.2.3""
val junitVersion = ""5.5.1""

dependencies {
    implementation(kotlin(""stdlib-jdk8""))

    implementation(""io.ktor:ktor-client-websockets:$ktorVersion"")
    implementation(""io.ktor:ktor-client-okhttp:$ktorVersion"")

    implementation(""org.jetbrains.kotlinx:kotlinx-coroutines-debug:1.3.0-RC2"")


    testImplementation(""org.junit.jupiter:junit-jupiter-api:$junitVersion"")
    testRuntimeOnly(""org.junit.jupiter:junit-jupiter-engine:$junitVersion"")
}

tasks.withType&lt;Test&gt; {
    useJUnitPlatform()
    testLogging {
        showExceptions = true
        showStackTraces = true
        exceptionFormat = TestExceptionFormat.FULL
        events = setOf(TestLogEvent.PASSED, TestLogEvent.SKIPPED, TestLogEvent.FAILED)
    }
}
</code></pre>
","75793","","75793","","2019-08-20 19:32:57","2019-08-21 07:02:42","How can I make sure all Kotlin coroutines created by a ktor websocket client are cleared up?","<kotlin><kotlin-coroutines><ktor>","1","1","","","","57580222","128262","128262","ktor","265","45915935","45915934"
"57633403","1","","","2019-08-23 21:52:57","","0","67","<p>My authentication works fine when running my rest server.  However, if I try to execute a call via a test, it seems like it skips authentication every time and then I get a <code>401</code> when hitting any of my protected routes.  I have verified that the controller that should be executed in response to the test never runs.  If I add <code>skipWhen { testing }</code> to my <code>jwt</code> the controller runs as expected.  My token is valid as well.</p>

<pre><code>Relevant parts of Application.kt

install(Authentication) {
        val accessVerifier = appInjector.jwtTokenGenerator().accessVerifier
        val refreshVerifier = appInjector.jwtTokenGenerator().refreshVerifier

        jwt(""access"") {
            verifier(accessVerifier)
            realm = ""ktor.io""
            validate {
                validateToken(it, request)
            }
        }

        jwt(""refresh"") {
            verifier(refreshVerifier)
            realm = ""ktor.io""
            validate {
                validateToken(it, request)
            }
        }
    }

routing {
        post(""$API_V1/auth"") { appInjector.signInController().execute(call) }
        post(""$API_V1/user"") { appInjector.signUpController().execute(call) }

        get(""$API_V1/pagetest"") { appInjector.pagedGenreController().execute(call) }
        post(""$API_V1/multipart"") { appInjector.multipartTest().execute(call) }
        get(""$API_V1/user"") { appInjector.userController().execute(call) }

        authenticate(""access"") {
            get(""$API_V1/me"") { appInjector.meController().execute(call) }
            delete(""$API_V1/token"") { appInjector.logoutController().execute(call) }
            delete(""$API_V1/tokens"") { appInjector.invalidateAllTokensController().execute(call) }
            post(""$API_V1/review"") { appInjector.postRevieWController().execute(call) }
        }

        authenticate(""refresh"") {
            get(""$API_V1/refresh"") { appInjector.refreshTokenController().execute(call) }
        }
    }

suspend fun validateToken(cred: JWTCredential, request: ApplicationRequest): Principal? {
    val id = cred.payload.getClaim(""id"").asInt()
    val expired = cred.payload.expiresAt.before(Date())
    val token = StringUtils.trimAuthHeader(request.parseAuthorizationHeader()?.render())
    val valid = appInjector.authHelper().isTokenValid(token)

    return if (!expired &amp;&amp; valid) {
        appInjector.authHelper().findUserById(id)
    } else {
        null
    }
}

</code></pre>

<pre><code>Test.kt

@Test
    fun testRequest2() {
        withTestApplication ({
            (environment.config as MapApplicationConfig).apply {
                put(""ktor.deployment.test"", ""true"")
                put(""ktor.deployment.port"", ""8080"")
                put(""ktor.deployment.db_host"", ""a"")
                put(""ktor.deployment.db_port"", ""5432"")
                put(""ktor.deployment.db_schema"", ""c"")
                put(""ktor.deployment.db_username"", ""d"")
                put(""ktor.deployment.db_password"", ""e"")
                put(""ktor.deployment.image_upload_dir"", ""f"")
            }

            module(testing = true)
        }) {
            handleRequest(HttpMethod.Get, ""/api/v1/me"") {
                addHeader(HttpHeaders.Authorization, ""&lt;token&gt;"")
            }.apply {
                assertEquals(HttpStatusCode.OK, response.status())
            }
        }
    }
</code></pre>
","2111279","","","","","2019-08-23 21:52:57","Why does my authentication in Ktor only fail when running tests?","<ktor>","0","0","","","","57633403","128262","128262","ktor","265","45915935","45915934"
"57662950","1","","","2019-08-26 18:19:02","","0","35","<p>I've been trying to make a GET request to an endpoint defined in a ktor route, but the parameters seem to be missing no matter how I try to get them. According to the documentation, I should just be able to call <code>call.receive&lt;Parameters&gt;()</code> and that should yield a map containing the data, but it's always empty.</p>

<p>So Far, I've tried installing my own ContentNegotiator (the <code>convertForReceive</code> method is never called), accessing the queryParams (always empty as well), and using the <code>call.receiveParameters()</code> method, which is always always empty</p>

<p>My CURL request looks like</p>

<pre class=""lang-sh prettyprint-override""><code>curl -X GET \
  http://localhost:7802/api/v2/plans \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode ""id[starts_with]=asdf""
</code></pre>

<p>and my endpoint looks like</p>

<pre><code>fun Routing.plans() {
  route(""plans"") {
    get("""") {
      val params = call.receive&lt;Parameters&gt;()
      println(params)
      call.respond(HttpStatusCode.NoContent)
    }
  }
}
</code></pre>

<p>I expect the parameters to contain <em>something</em>, but they are always empty.</p>
","7255198","","","","","2019-10-30 01:29:35","Cannot access form data in GET request","<kotlin><ktor>","1","0","","","","57662950","128262","128262","ktor","265","45915935","45915934"
"57725097","1","","","2019-08-30 10:32:53","","1","72","<p>How to set the timeout after which if there is no user activity the session expires?
I am looking for something like in jetty:</p>

<pre><code>ServletContextHandler webappContext = new ServletContextHandler(ServletContextHandler.SESSIONS);
... 
webappContext.getSessionHandler().setMaxInactiveInterval(timeout_in_sec);
</code></pre>
","425183","","","","","2019-08-30 10:32:53","How to set session timeout in ktor?","<ktor>","0","0","","","","57725097","128262","128262","ktor","265","45915935","45915934"
"57881885","1","57911342","","2019-09-11 03:52:13","","0","72","<p>When I set up a basic authentication provider and put a simple <code>get</code> handler inside an <code>authenticate</code> block, I'll be prompted for credentials when I try to access the route, so once the get handler starts being executed, I can access the <code>UserIdPrincipal</code> and start finding data associated with the account. However, I now want to expand my <code>authenticate</code> block to include multiple routes, so I thought I could handle the initial processing of the principal/account inside an <code>intercept</code> block. Yet, when I try to do this, I am not prompted for my credentials and therefore the <code>UserIdPrincipal</code> inside the interceptor is null. How can I get Ktor to prompt me for my credentials from within a route interceptor inside an <code>authenticate</code> block?</p>

<p>This code properly prompts me for my credentials when I try to access the dashboard route.</p>

<pre><code>authenticate(""teacherAuth"") {
    get(""dashboard"") {
        val principal = call.principal&lt;UserIdPrincipal&gt;()!!
        val schoolName = principal.name
        val school = transaction {
            School.find { Schools.name eq schoolName }.singleOrNull()
        }
        if (school == null)
            call.respondText(""No school \""$schoolName\"" found"")
        else
            call.respondHtml {
                ...
            }
    }
}
</code></pre>

<p>This code does not prompt me for my credentials when I try to access the dashboard route, resulting in an error.</p>

<pre><code>authenticate(""teacherAuth"") {
    val schoolKey = AttributeKey&lt;School&gt;(""school"")

    intercept(ApplicationCallPipeline.Setup) {
        val principal = call.principal&lt;UserIdPrincipal&gt;()!!
        val schoolName = principal.name
        val school = transaction {
            School.find { Schools.name eq schoolName }.singleOrNull()
        }
        if (school == null) {
            call.respondText(""No school \""$schoolName\"" found"")
            return@intercept finish()
        }
        call.attributes.put(schoolKey, school)
    }

    get(""dashboard"") {
        val school = call.attributes[schoolKey]
        call.respondHtml {
            ...
        }
    }
}
</code></pre>
","11396024","","","","","2019-09-12 16:53:44","Ktor prompt for credentials from within route interceptor inside a basic authentication block","<kotlin><basic-authentication><ktor>","1","2","0","","","57881885","128262","128262","ktor","265","45915935","45915934"
"57978856","1","58150515","","2019-09-17 16:56:31","","2","177","<p>What is the correct way to send back cache headers for static images being served by Ktor?</p>

<p>I have the following Ktor setup:</p>

<p>In my <code>main</code>:</p>

<pre><code>embeddedServer(
        Netty,
        watchPaths = listOf(""module""),
        module = Application::module,
        port = if (ENV.env == LOCAL) {
            8080
        } else {
            80
        }
    ).apply {
        start(wait = true)
    }
</code></pre>

<p>and then outside the main:</p>

<pre><code>fun Application.module() {
    if (ENV.env != LOCAL) {
        install(ForwardedHeaderSupport)
        install(XForwardedHeaderSupport)
        install(HttpsRedirect)
    }
    install(CachingHeaders) {
        options { outgoingContent -&gt;
            when (outgoingContent.contentType?.withoutParameters()) {
                ContentType.Image.Any -&gt; CachingOptions(CacheControl.MaxAge(maxAgeSeconds = 30 * 24 * 60 * 60))
                else -&gt; null
            }
        }
    }
    install(Compression) {
        gzip {
            priority = 1.0
        }
        deflate {
            priority = 10.0
            minimumSize(1024) // condition
        }
    }

    routing {
        static(""/js/"") {
            resources(""/js/"")
        }

        static(""/css/"") {
            resources(""/css/"")
        }

        static(""/favicons"") {
            resources(""/favicons/"")
        }

        static(""/img/"") {
            resources(""/static/img/"")
            resources(""/static/images/"")
            resources(""/background/"")
            resources(""/logos/"")
            resources(""/icons/"")
        }
    }
}
</code></pre>

<p>The images however are coming back with no caching headers, any ideas?</p>

<p><a href=""https://i.stack.imgur.com/XOnn1.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/XOnn1.png"" alt=""enter image description here""></a></p>

<p><strong>Update</strong>:</p>

<p>Changing <code>ContentType.Image.Any</code> to <code>ContentType.Image.JPEG</code> seems to work. Looking at the source code of <code>Image</code>, it seems to map to ContentType(<code>image</code>, <code>*</code>) but is not matching any image type at all.</p>

<pre><code>install(CachingHeaders) {
    options { outgoingContent -&gt;
        when (outgoingContent.contentType?.withoutParameters()) {
            ContentType.Image.JPEG -&gt; CachingOptions(
                cacheControl = CacheControl.MaxAge(
                    mustRevalidate = false,
                    maxAgeSeconds = 30 * 24 * 60 * 60,
                    visibility = CacheControl.Visibility.Public
                )
            )
            else -&gt; null
        }
    }
}
</code></pre>

<p>Filed a bug in the meantime: 
<a href=""https://github.com/ktorio/ktor/issues/1366"" rel=""nofollow noreferrer"">https://github.com/ktorio/ktor/issues/1366</a></p>
","527533","","527533","","2019-09-28 18:45:09","2019-09-28 21:40:18","Respond with Cache headers for images in Ktor","<caching><kotlin><ktor>","2","0","","","","57978856","128262","128262","ktor","265","45915935","45915934"
"58076928","1","","","2019-09-24 09:16:22","","0","43","<p>I'm using Ktor with Gson and want to serialize an interface. However, instead of serializing only the fields of the interface, gson is serializing the whole implementation with all fields.</p>

<h1>Example</h1>

<h2>Interface</h2>

<pre><code>interface MyInterface {
    var id: Int
}
</code></pre>

<h2>Implementation</h2>

<pre><code>data class MyImplementation(
    override var id: Int,
    var name: String
) : MyInterface 
</code></pre>

<h2>Ktor configuration</h2>

<p>Configuring Gson and an endpoint for MyInterface. I would expect that <code>call.respond(implementation as MyInterface)</code> would lead to the serialization of only the Interface.</p>

<pre><code>install(ContentNegotiation) {
    gson {
        setPrettyPrinting()
    }
}

install(Routing) {
    get(""/myinterface"") {         
        val implementation = service.getMyImplementation()
        call.respond(implementation as MyInterface)
    }
}
</code></pre>

<h1>Problem</h1>

<p>When you request an Object of Type <code>MyInterface</code> from a Ktor endpoint you get both fields <code>id</code> and <code>name</code>.</p>

<p>Does anybody know how to tell Gson to serialize only the interface?</p>
","5825758","","","","","2019-09-24 09:16:22","Ktor + Gson serializing interface instead of implementation","<kotlin><gson><ktor>","0","0","","","","58076928","128262","128262","ktor","265","45915935","45915934"
"58257346","1","","","2019-10-06 12:43:43","","0","71","<p>In my <code>ktor</code> web app I'm using <code>exposed sql</code> to store objects in a database.</p>

<p>I'm also using a <code>ehcache</code> to offload some of the work from the database to the cache.</p>

<p>I want to be able to update an object in the cache without having to update it in the database as well (because it will be happening rather frequently). </p>

<p>My concern is that when the object is evicted from the cache the changes will not be saved in the database</p>

<p>How do I save the changes made to the object without having to access the database every time?</p>

<p><code>MyObject.kt</code></p>

<pre><code>import kotlinx.css.Color
import java.io.Serializable

data class MyObject(val ID: Int, val userID: String, var description: String, var color: Color, var count: Long = 0) : Serializable
</code></pre>

<hr>

<p><code>MyObjects.kt</code></p>

<pre><code>import org.jetbrains.exposed.sql.Table

object MyObjects : Table() {
    val ID = integer(""ID"").primaryKey().autoIncrement()
    val count = long(""Count"")
    val userID = varchar(""UserID"", 64).index()
    val color = varchar(""Color"", 16)
    val description = varchar(""Description"", 128)
}
</code></pre>

<hr>

<p><code>DAOFacade.kt</code></p>

<pre><code>import kotlinx.css.Color
import kotlinx.io.core.Closeable

interface DAOFacade : Closeable {
    fun getMyObject(ID: Int): MyObject?
    fun updateMyObject(ID: Int, description: String? = null, color: Color? = null, count: Long? = null)
}
</code></pre>

<hr>

<p><code>DAOFacadeDatabase.kt</code></p>

<pre><code>import kotlinx.css.Color
import org.jetbrains.exposed.sql.*

class DAOFacadeDatabase(private val DB: Database = Database.Companion.connect(""jdbc:h2:mem:test"", ""org.h2.Driver"")) : DAOFacade {
    init {
        DB.transaction { create(MyObjects) }
    }

    private fun ResultRow.toMyObject() = MyObject(this[MyObjects.ID], this[MyObjects.userID], this[MyObjects.description], Color(this[MyObjects.color]), this[MyObjects.count])

    override fun getMyObject(ID: Int): MyObject? = DB.transaction {
        MyObjects.select { MyObjects.ID eq ID }.singleOrNull()?.toMyObject()
    }

    override fun updateMyObject(ID: Int, description: String?, color: Color?, count: Long?): Unit = DB.transaction {
        MyObjects.update({ MyObjects.ID eq ID }) {
            if (description != null) it[MyObjects.description] = description
            if (color != null) it[MyObjects.color] = color.value
            if (count != null) it[MyObjects.count] = count
        }
    }

    override fun close() = Unit
</code></pre>

<hr>

<p><code>DAOFacadeCache.kt</code></p>

<pre><code>import kotlinx.css.Color
import org.ehcache.CacheManagerBuilder
import org.ehcache.config.CacheConfigurationBuilder
import org.ehcache.config.ResourcePoolsBuilder
import org.ehcache.config.persistence.CacheManagerPersistenceConfiguration
import org.ehcache.config.units.EntryUnit
import org.ehcache.config.units.MemoryUnit
import java.io.File

class DAOFacadeCache(private val delegate: DAOFacade, storage: File) : DAOFacade {
    private val myObjectCacheAlias = ""MyObject Cache""
    private val cacheManager = CacheManagerBuilder.newCacheManagerBuilder()
        .with(CacheManagerPersistenceConfiguration(storage))
        .withCache(myObjectCacheAlias, CacheConfigurationBuilder.newCacheConfigurationBuilder&lt;Int, MyObject&gt;()
                .withResourcePools(
                    ResourcePoolsBuilder.newResourcePoolsBuilder()
                        .heap(1024, EntryUnit.ENTRIES)
                        .offheap(16, MemoryUnit.MB)
                        .disk(128, MemoryUnit.MB, true)
                )
                .buildConfig(Int::class.javaObjectType, MyObject::class.java)
        ).build(true)

    private val myObjectCache = cacheManager.getCache(myObjectCacheAlias, Int::class.javaObjectType, MyObject::class.java)

    override fun getMyObject(ID: Int): MyObject? = myObjectCache[ID].takeUnless { it == null } ?: delegate.getMyObject(ID)?.also {
        myObjectCache.put(ID, it)
    }

    override fun updateMyObject(ID: Int, description: String?, color: Color?, count: Long?) {
        getMyObject(ID)?.let {
            if (description != null) it.description = description
            if (color != null) it.color = color
            if (count != null) it.count = count
        }
    }

    override fun close() = try {
        delegate.close()
    } finally {
        cacheManager.close()
    }
</code></pre>

<hr>

<p>In my Application I create a <code>DAOFacade</code> like this:</p>

<pre><code>import com.mchange.v2.c3p0.ComboPooledDataSource
import org.h2.Driver
import org.jetbrains.exposed.sql.Database
import java.io.File

val dir = File(""/build/db"")

val pool = ComboPooledDataSource().apply {
    driverClass = Driver::class.java.name
    jdbcUrl = ""jdbc:h2:file:${dir.canonicalFile.absolutePath}""
    user = """"
    password = """"
}

val DAO: DAOFacade = DAOFacadeCache(DAOFacadeDatabase(Database.connect(pool)), File(dir.parentFile, ""ehcache""))
</code></pre>

<p>My idea was to keep track of the <code>ID</code>s of <code>MyObject</code>s which were modified in a <code>Set&lt;Int&gt;</code> field in the <code>DAOFacadeCache</code> and to modify it's <code>close</code> function to save changes in the <code>delegate</code> database. </p>

<p>However, problem with this solution is that a <code>MyObject</code> whose <code>ID</code> is in the <code>Set</code> might be evicted from cache before the cache closes (possible changes will then be lost)</p>

<p>Is it possible to tell the cache to do something with the object before it evicts it from the memory?</p>
","10700039","","10700039","","2019-10-06 12:49:13","2019-10-06 12:49:13","How to update object in database before it is evicted from cache?","<kotlin><ehcache><ktor><kotlin-exposed>","0","0","","","","58257346","128262","128262","ktor","265","45915935","45915934"
"58425186","1","","","2019-10-17 04:59:16","","0","131","<p>I tried to search in api docs as well as examples, but there weren't any example demonstrating how to send pings and receive pings. The only example was of how to connect to websocket and to send a text <a href=""https://ktor.io/clients/websockets.html"" rel=""nofollow noreferrer"">here</a>.
I also saw chat sample <a href=""https://ktor.io/samples/app/chat.html"" rel=""nofollow noreferrer"">here</a> of server side and i carefully followed that as well (i.e. set ping interval in server side configuration of WebSocket installation).</p>

<p>I start listening both side for pongs but none of the side was receiving any ping messages.</p>

<p>And there is no option to configure the client side for pings as you can see <a href=""https://ktor.io/clients/http-client/engines.html#cio"" rel=""nofollow noreferrer"">here</a>.</p>

<p>I'm so much confused about how to send pings.</p>

<p><strong>This is my server side:</strong></p>

<pre><code>install(WebSockets)
{
    pingPeriod = Duration.ofSeconds(20)
}

routing {
    webSocket(""/ws"") {
        for (frame in incoming)
        {
            when(frame)
            {
                is Frame.Pong -&gt;
                {
                    println(""ping recieved"")
                }

                is Frame.Ping -&gt;
                {
                    // just temporary block
                    println(""ping recieved"")
                }

                is Frame.Text -&gt;
                {
                    println(frame.readText())
                }
            }
        }
    }
}
</code></pre>

<p><strong>This is my client side:</strong></p>

<pre><code>val client = HttpClient {
    install(WebSockets)
}

client.ws(
    method = HttpMethod.Get,
    host = ""127.0.0.1"",
    port = 80,
    path = ""/ws""
) {

    // pinger(outgoing, 20_000, 15_000)

    send(Frame.Text(""Hello World!""))

    for (frame in incoming)
    {
        when (frame)
        {
            is Frame.Pong -&gt;
            {
                println(""ping received"")
            }
        }
    }
}
</code></pre>

<p>I also found some functions for this <a href=""https://api.ktor.io/1.2.4/io.ktor.http.cio.websocket/"" rel=""nofollow noreferrer"">here</a> <code>pinger</code> and <code>ponger</code> but now it says its part of api and gets automatically start with initiation of WebsocketSession and i also tried to put pinger in client side but that didn't send ping to server whatsoever.</p>

<p>Result of above code is simply <code>Hello world</code> gets printed in server console as sent from client side but no ping received messages.</p>
","11377112","","","","","2019-10-17 04:59:16","How to send pings from client side to the server side on websockets ktor.io","<kotlin><websocket><kotlin-coroutines><ktor>","0","0","","","","58425186","128262","128262","ktor","265","45915935","45915934"
"58499036","1","","","2019-10-22 07:23:06","","0","34","<p>I use Freemarker templates in Ktor web server framework.
By default, I pass a FreeMarkerContent to the response:</p>

<pre><code>        get(""/login"") {
            val resp = FreeMarkerContent(""login.ftl"", NO_PARAM, ""e"")
            call.respond(resp)
        }
</code></pre>

<p>What I would like to is to add a special post process applied on the rendered web page, so my process pipe should be: template + data --[Freemarker]--> rendered page --[Post processor]--> final page. How could I insert a post process phase into?</p>

<p>My ideas:</p>

<ol>
<li>Render the page manually, then apply the processor also manually
For this, I need a Freemarker instance to call and render the output, which should be text based to be able to get and post process. At the moment I can't find how to get this instance and how to produce rendered page.</li>
<li>Inject some kind of processor into the process pipeline
I need some way to add processor to the pipeline, but it only pass a Content which is executed by the call.</li>
</ol>

<p><strong>EDIT:</strong> </p>

<p>I found out I can create new feature and by the example I did it. After hours of try, code dumping and several failed attempts, I was able to intercept the output of the Freemarker, but couldn't do anything with it to get the rendered text. </p>

<p>Finally, seeing that the Freemarker adapter is thin, I made an awful (hopfuly temporal), solution: I cloned the Freemarker feature source and created my own version, injecting my post-process code:</p>

<pre><code>/**
 * Represents a content handled by [GlossaryFreeMarker] feature.
 *
 * @param template name that is resolved by freemarker
 * @param model to be passed during template rendering
 * @param etag value for `E-Tag` header (optional)
 * @param contentType of response (optional, `text/html` with UTF-8 character encoding by default)
 */
class GlossaryFreeMarkerContent (
        val template: String,
        val model: Any?,
        val etag: String? = null,
        val contentType: ContentType = ContentType.Text.Html.withCharset(Charsets.UTF_8)
)

/**
 * Freemarker support feature. Provides ability to respond with [FreeMarkerContent]
 */
class GlossaryFreeMarker(private val config: Configuration) {
    /**
     * A feature installing companion object
     */
    companion object Feature : ApplicationFeature&lt;ApplicationCallPipeline, Configuration, GlossaryFreeMarker&gt; {
        override val key: AttributeKey&lt;GlossaryFreeMarker&gt; = AttributeKey(""glossaryFreemarker"")

        override fun install(pipeline: ApplicationCallPipeline, configure: Configuration.() -&gt; Unit): GlossaryFreeMarker {
            val config = Configuration(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS).apply(configure)
            val feature = GlossaryFreeMarker(config)
            pipeline.sendPipeline.intercept(ApplicationSendPipeline.Transform) { value -&gt;
                if (value is GlossaryFreeMarkerContent) {
                    val response = feature.process(value)
                    proceedWith(response)
                }
            }
            return feature
        }
    }

    private fun process(content: GlossaryFreeMarkerContent): FreeMarkerOutgoingContent {
        return FreeMarkerOutgoingContent(
                config.getTemplate(content.template),
                content.model,
                content.etag,
                content.contentType
        )
    }

    private class FreeMarkerOutgoingContent(
            val template: Template,
            val model: Any?,
            etag: String?,
            override val contentType: ContentType
    ) : OutgoingContent.WriteChannelContent() {
        override suspend fun writeTo(channel: ByteWriteChannel) {
            channel.bufferedWriter(contentType.charset() ?: Charsets.UTF_8).use {
                // This is where I ""injected my code""
                val w = StringWriter()
                template.process(model, w)
                // Do my transformation
                val res = MyTransformation.transform(w.toString())
                it.write(res)
            }
        }

        init {
            if (etag != null)
                versions += EntityTagVersion(etag)
        }
    }
}
</code></pre>

<p>This solution works. This solution has limitations (all my pages should be Freemarker templates) This solution is awful. This solution is surely not the right way to do it... </p>
","1139720","","1139720","","2019-10-22 14:04:06","2019-10-22 14:04:06","Post process rendered Freemarker page in Ktor","<kotlin><freemarker><ktor>","0","0","","","","58499036","128262","128262","ktor","265","45915935","45915934"
"58531750","1","","","2019-10-23 22:29:11","","0","40","<p>Is it possible to add/remove routes at runtime using KTOR framework?</p>

<p>I've investigated TEngine type but still don't found any solutions.</p>
","3641245","","","","","2019-10-23 22:29:11","How to add/remove routes at runtime in KTOR?","<kotlin><ktor>","0","1","","","","58531750","128262","128262","ktor","265","45915935","45915934"
"58579067","1","","","2019-10-27 11:43:05","","0","72","<p>I'm looking for a way to configure https for Ktor application.</p>

<p>I've found an official documentation there:
<a href=""https://ktor.io/servers/self-signed-certificate.html"" rel=""nofollow noreferrer"">https://ktor.io/servers/self-signed-certificate.html</a>
 Here explained how to add links to certs inside the HOCON config file. </p>

<p>Is it possible to config ssl without config file? </p>

<p>Here's my codebase:</p>

<pre><code>http = embeddedServer(Netty, port = listenPort, configure = {
                connectionGroupSize = 1
                workerGroupSize = 5
            }){
                if(sslCertificate != null) {
                    install(HttpsRedirect) {
                        sslPort = 443
                    }
                }

                install(StatusPages) {
                    exception&lt;NotFoundError&gt; { cause -&gt;
                        logger.error(""NotFoundError:"", cause.message)
                        call.respondText(cause.message ?: """",
                                ContentType.Text.Plain, HttpStatusCode.NotFound){}
                    }
                    exception&lt;BadFormatError&gt; { cause -&gt;
                        logger.error(""BadFormatError:"", cause.message)
                        call.respondText(cause.message ?: """",
                                ContentType.Text.Plain, HttpStatusCode.BadRequest){}
                    }
                    exception&lt;UserMistake&gt; { cause -&gt;
                        logger.error(""UserMistake:"", cause.message)
                        call.respondText(cause.message ?: """",
                                ContentType.Text.Plain, HttpStatusCode.BadRequest){}
                    }
                    exception&lt;OverloadedException&gt; { cause -&gt;
                        logger.error(""OverloadedException:"", cause.message)
                        call.respondText(cause.message ?: """",
                                ContentType.Text.Plain, HttpStatusCode.ServiceUnavailable){}
                    }
                    exception&lt;Exception&gt; { cause -&gt;
                        logger.error(""Exception:"", cause.message)
                        call.respondText(cause.message ?: """",
                                ContentType.Text.Plain, HttpStatusCode.InternalServerError){}
                    }
                }
                intercept(ApplicationCallPipeline.Call) {
                    call.response.headers.append(HttpHelper.ACCESS_CONTROL_ALLOW_ORIGIN, ""*"")
                    call.response.headers.append(HttpHelper.ACCESS_CONTROL_REQUEST_METHOD, ""POST, GET, OPTIONS"")
                   // call.response.headers.append(HttpHelper.CONTENT_TYPE, ""application/json"")
                    if(call.request.uri.endsWith(""/"")) {
                        call.respondRedirect(call.request.uri.dropLast(1))
                    }
                }
            }
            http.start()
</code></pre>
","3641245","","","","","2019-10-27 11:43:05","How to configure ssl using KTOR library?","<kotlin><ktor>","0","0","","","","58579067","128262","128262","ktor","265","45915935","45915934"
"58598213","1","","","2019-10-28 20:49:27","","0","32","<p>I'm using Ktor framework and curious how to get the actual port of my http connector at runtime. The thing is i need to use random port and put port=0 inside a connector. The app starts but i was unable to find actual port information using api.
 Is it possible to retrieve the actual port in runtime?</p>
","3641245","","","","","2019-10-28 20:49:27","Is it possible to get Ktor connector port at runtime?","<kotlin><ktor>","0","0","","","","58598213","128262","128262","ktor","265","45915935","45915934"
"20415851","1","","","2013-12-06 04:15:19","","0","99","<p>I'm using the CouchDbRepositorySupport class available in the ektorp library. According to their documentation I should be able to set a system property that will automatically generate my inline views which I'm doing <code>System.setProperty(CouchDbRepositorySupport.AUTO_UPDATE_VIEW_ON_CHANGE, Boolean.TRUE.toString());</code> but it doesn't seem like the views are changing when I edit my existing views. How would I be able to edit views after my app is released? (right now I'm uninstalling and re-installing which is less than ideal)</p>
","35505","","","","","2013-12-08 14:07:14","How do I update inline views in Couchdb lite","<android><ektorp><couchdb-lite>","1","1","","","","20415851","73833","73833","ektorp","71","7739352","7739351"
"20611924","1","20616997","","2013-12-16 13:18:07","","0","137","<p>Is it possible to define a one-to-one association in Ektorp? In the Ektorp documentation I only found how to embed a list of objects into an object referenced by foreign key.
I want to produce a document like:</p>

<pre><code>{
  name: ""John"",
  surname: ""Smith"",
  address: {
    street: ""Abc Street"",
    zip: ""12345"",
    city: ""My City""
  }
}
</code></pre>

<p>Thanks</p>
","3107432","","","","","2013-12-16 17:31:13","one-to-one association in Ektorp","<couchdb><ektorp>","1","0","","","","20611924","73833","73833","ektorp","71","7739352","7739351"
"21028750","1","","","2014-01-09 18:54:44","","2","193","<p>I try to use ektorp client for replication in android and I have an error :
org.ektorp.DocumentNotFoundException: nothing found on db path: /_replicate, Response body: {""error"":""not_found"",""reason"":""unknown URL""}</p>

<p>I installed a gateway and a CouchBase server.
I access to the url /sync_gateway, but the client try to reach /sync_gateway/_replicate.
What's this ??? and what I have to do to make it work ????</p>

<p>Thank you by advance
Best regards</p>

<p>My code :</p>

<pre><code>// start Ektorp adapter

HttpClient httpClient = new AndroidHttpClient.Builder()
.host(""XXX"")
.username(""XXX"")
.password(""XXX"")
.port(4984)
.build();

CouchDbInstance dbInstance = new StdCouchDbInstance(httpClient);

// create a local database
CouchDbConnector dbConnector = new StdCouchDbConnector(""sync_gateway"", dbInstance);

// pull this database to the test replication server
ReplicationCommand pullCommand = new ReplicationCommand.Builder()
.source(""sync_gateway"")
.target(""XXX"")
.continuous(true)
.build();

ReplicationStatus status = dbInstance.replicate(pullCommand);
</code></pre>
","3178937","","","","","2014-01-09 18:54:44","Android ektorp couchbase replication error","<android><replication><couchbase><ektorp>","0","0","","","","21028750","73833","73833","ektorp","71","7739352","7739351"
"21453071","1","","","2014-01-30 09:54:58","","1","770","<p>I am new to CouchDb/ektorp. According to the ektorp documentation you can generate couchdb views through an annotation like this:</p>

<pre><code>@View( name = ""avg_sofa_size"", map = ""function(doc) {...}"", reduce = ""function(doc) {...}"")
</code></pre>

<p>Is there a way to get only the latest revison of each doc, not by id but another attribute? &lt;-- not java specific</p>

<p>And if possible only get only one doc not by id but another attributefrom that view? &lt;-- ektorp/java</p>

<p>Thakns </p>
","771253","","771253","","2014-01-31 09:05:17","2014-01-31 09:05:17","How to get only the latest revision of a document","<java><couchdb><ektorp>","2","0","","","","21453071","73833","73833","ektorp","71","7739352","7739351"
"21783884","1","21927191","","2014-02-14 16:01:12","","0","300","<p>How can i get my List of existing Tourneys via Ektorp API from CouchDB? My code looks like this:  </p>

<p>thanks a lot.</p>

<p>I call the methode getAll() in my TourneyService Class and getAll() is a list of Tourneys</p>

<p>//TourneyService </p>

<pre><code>@Service
public class TourneyService implements Serializable{

private static final long serialVersionUID = 699617628013084160L;

@Autowired
private TourneyRepository tourneyRepository;

public List&lt;Tourney&gt; getAllTourneys(){
    return tourneyRepository.getAll();
}
}
</code></pre>

<p>//TourneyRepository </p>

<pre><code>@Component
public class TourneyRepository extends CouchDbRepositorySupport&lt;Tourney&gt; {

@Autowired
public TourneyRepository(@Qualifier(""cegocouchdb"") CouchDbConnector db) {
    super(Tourney.class, db);
    initStandardDesignDocument();
}

@GenerateView @Override
public List&lt;Tourney&gt; getAll() {
    ViewQuery q = createQuery(""all"")
                    .descending(true)
                    .includeDocs(true);
    return db.queryView(q, Tourney.class);
}

   }
</code></pre>

<p>//TourneyListBean </p>

<pre><code>    @ManagedBean(name = ""TourneyListMmgtBean"")
    @RequestScoped
    public class TourneyListBean implements Serializable {

private static final long serialVersionUID = 6130842812974474768L;

@ManagedProperty(value = ""#{tourneyService}"")
private TourneyService tourneyService;

private List&lt;Tourney&gt; tourneys; 

public void onEdit(RowEditEvent event) {
    FacesMessage msg = new FacesMessage(""Tourney changed"", """");

    FacesContext.getCurrentInstance().addMessage(null, msg);
}

public void onCancel(RowEditEvent event) {
    FacesMessage msg = new FacesMessage(""Aktion abgebrochen"", """");

    FacesContext.getCurrentInstance().addMessage(null, msg);
}


public TourneyService getTourneyService() {
    return tourneyService;
}

public void setTourneyService(TourneyService tourneyService) {
    this.tourneyService = tourneyService;
}

public List&lt;Tourney&gt; getTourneys() {
    tourneys = tourneyService.getAllTourneys();
    if (tourneys == null) {
        tourneys = new ArrayList&lt;Tourney&gt;();
    }
    return tourneys;
}

public void setTourneys(List&lt;Tourney&gt; torneys) {
    this.tourneys = torneys;
}
   }
</code></pre>

<p>JSF</p>

<pre><code>&lt;ui:define name=""content""&gt;



    &lt;h:form id=""form""&gt;

        &lt;p:growl id=""messages"" showDetail=""true"" /&gt;

        &lt;p:dataTable var=""tourney"" value=""#{TourneyListMmgtBean.tourneys}""
            id=""tourneyList"" editable=""true""&gt;

            &lt;f:facet name=""header""&gt;  
        In-Cell Editing  
    &lt;/f:facet&gt;

            &lt;p:ajax event=""rowEdit"" listener=""#{TourneyListMmgtBean.onEdit}""
                update="":form:messages"" /&gt;
            &lt;p:ajax event=""rowEditCancel""
                listener=""#{TourneyListMmgtBean.onCancel}"" update="":form:messages"" /&gt;

            &lt;p:column headerText=""Turniername"" style=""width:30%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.name}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.name}"" style=""width:100%""
                            label=""Turniername"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column headerText=""Straße"" style=""width:20%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.street}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.street}"" style=""width:100%""
                            label=""Straße"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column headerText=""Turnierstadt"" style=""width:24%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.city}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.city}"" style=""width:100%""
                            label=""Turnierstadt"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column headerText=""Beginnzeit"" style=""width:24%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.beginTime}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.beginTime}"" style=""width:100%""
                            label=""Beginnzeit"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column headerText=""Endzeit"" style=""width:24%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.endTime}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.endTime}"" style=""width:100%""
                            label=""Endzeit"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column headerText=""Turnierpunkte"" style=""width:24%""&gt;
                &lt;p:cellEditor&gt;
                    &lt;f:facet name=""output""&gt;
                        &lt;h:outputText value=""#{tourney.points}"" /&gt;
                    &lt;/f:facet&gt;
                    &lt;f:facet name=""input""&gt;
                        &lt;p:inputText value=""#{tourney.points}"" style=""width:100%""
                            label=""Turnierpunkte"" /&gt;
                    &lt;/f:facet&gt;
                &lt;/p:cellEditor&gt;
            &lt;/p:column&gt;

            &lt;p:column style=""width:6%""&gt;
                &lt;p:rowEditor /&gt;
            &lt;/p:column&gt;

        &lt;/p:dataTable&gt;

    &lt;/h:form&gt;

&lt;/ui:define&gt;
</code></pre>

<p>Error:</p>

<pre><code>org.ektorp.support.ViewGenerationException: Cannot generate 'all' view for null.
</code></pre>
","3107432","","","","","2014-02-21 06:43:57","Ektorp ArrayList get all in JSF in the PrimeFaces List component","<spring><jsf><primefaces><couchdb><ektorp>","1","0","","","","21783884","73833","73833","ektorp","71","7739352","7739351"
"21911391","1","21926958","","2014-02-20 14:55:27","","0","730","<p>I'm trying to delete all the saved documents in CouchDB with Ektorp. A document can I delete so: </p>

<pre><code>public void deleteDoc(Object o) {
    db.delete(o);
}
</code></pre>

<p>But for all Docs? can any help?</p>

<p>Thanks.</p>
","3107432","","","","","2014-02-21 06:31:34","How can I delete all Documents with Ektorp in CouchDB","<couchdb><ektorp>","1","0","","","","21911391","73833","73833","ektorp","71","7739352","7739351"
"23857197","1","","","2014-05-25 15:55:23","","0","345","<p>I am a beginner with couch db and ektorp. I want to use ektorp to retrieve one property from all the existing documents in couch db.</p>

<p>Till now I have learnt that couch db gives us the result of the following equivalent SQL query:-</p>

<pre><code>Select * from Customer;
</code></pre>

<p>Is there any ektorp way of retrieving the result set of the following SQL query, Apart from the normal Map/reduce solutions of couch db?</p>

<pre><code>Select name from customer;
</code></pre>

<p>The result set of the above query could somehow be retrieved in List or Set&lt;> in java. 
Any help would be appreciated.</p>
","3345843","","","","","2014-05-26 15:06:30","Getting single property from multiple views in couch db using ektorp","<java><spring><collections><couchdb><ektorp>","1","0","","","","23857197","73833","73833","ektorp","71","7739352","7739351"
"58624842","1","","","2019-10-30 11:56:06","","1","108","<p>How do I monitor request progress in Ktor http client?</p>

<p>For example: I have request like this:</p>

<pre><code>val response = HttpClient().get&lt;String&gt;(""https://stackoverflow.com/"")
</code></pre>

<p>and I want to monitor request progress with progress bar like this:</p>

<pre><code>fun progress(downloaded: Long, contentLength: Long) {
    // Update progress bar or whatever
}
</code></pre>

<p>How do I set <code>progress()</code> to be called by HttpClient?</p>

<p>edit: This is Kotlin Multiplatform project. Relevant dependencies are:</p>

<pre><code>implementation 'io.ktor:ktor-client-core:1.2.5'
implementation 'io.ktor:ktor-client-cio:1.2.5'
</code></pre>
","12296156","","12296156","","2019-10-30 12:25:42","2019-10-30 12:25:42","Ktor http client - request progress","<kotlin><ktor>","0","0","","","","58624842","128262","128262","ktor","265","45915935","45915934"
"58717774","1","58718428","","2019-11-05 18:56:23","","3","315","<p>I am trying to schedule a task in my Ktor application, however I have not been able to find anything online about how to do this.  Does anyone have any recommendations or been able to do this before?</p>
","12185656","","","","","2019-11-06 06:48:15","How to schedule tasks in Ktor microservice app","<kotlin><scheduling><ktor>","1","0","","","","58717774","128262","128262","ktor","265","45915935","45915934"
"58777854","1","","","2019-11-09 09:10:54","","1","168","<p>I am using below code for SSL pinning in Kotlin Multiplatform using Ktor.</p>

<p>I am having crash at this line of code </p>

<pre><code>val remoteCertificateData : NSData = SecCertificateCopyData(certificate) as NSData 
</code></pre>

<p>Here is the function.</p>

<pre><code>override fun URLSession(
            session: NSURLSession,
            didReceiveChallenge: NSURLAuthenticationChallenge,
            completionHandler: (NSURLSessionAuthChallengeDisposition, NSURLCredential?) -&gt; Unit
        ) {
            val serverTrust = didReceiveChallenge.protectionSpace.serverTrust

            val certificate = SecTrustGetCertificateAtIndex(serverTrust,0)

            var result: SecTrustResultType = 0u
            memScoped{
                val nativeResult = alloc&lt;SecTrustResultTypeVar&gt;()
                nativeResult.value = result
                SecTrustEvaluate(serverTrust!!, nativeResult.ptr)
            }

            val remoteCertificateData : NSData = SecCertificateCopyData(certificate) as NSData                                
            val bundle = NSBundle.bundleForClass(objc_getRequiredClass(""IosClientEngine""))                

            val pathToCert = bundle.pathForResource(""MyCertificate"",""cer"")                

            val localCertificate : NSData = NSData.dataWithContentsOfFile(pathToCert!!)!!

            if (localCertificate == remoteCertificateData) {
                completionHandler(NSURLSessionAuthChallengeUseCredential,NSURLCredential.create(serverTrust))                    
            } else {
                completionHandler(NSURLSessionAuthChallengeUseCredential, null)                    
            }
        }
</code></pre>
","1147587","","","","","2020-02-29 00:01:33","Ktor multiplatform - SSL pinning for iOS in kotlin","<ktor><kotlin-multiplatform>","1","0","2","","","58777854","128262","128262","ktor","265","45915935","45915934"
"58800723","1","","","2019-11-11 11:45:03","","0","24","<p>To serve https requests in Ktor, their documentation states you need to set some config properties (<code>ktor.security.ssl</code>) in application.conf, such that Ktor can find the ssl certificate. However, I want to retrieve the ssl certificate from another server (via an encrypted connection). </p>

<p>Can I setup my Ktor server in such a way that I retrieve this certificate and enable https on server startup?</p>
","8244705","","1033581","","2019-11-12 01:48:31","2019-11-12 01:48:31","How to serve https requests in Ktor programmatically","<kotlin><https><ktor>","0","0","","","","58800723","128262","128262","ktor","265","45915935","45915934"
"58842957","1","","","2019-11-13 17:57:38","","1","160","<p>I was making a simple file upload&amp;download service and found out that, as far as I understand, Netty doesn't release direct buffers until request processing is over. As a result, I can't upload bigger files.</p>

<p>I was trying to make sure that the problem is not inside my code, so I created the most simple tiny Ktor application:</p>

<pre class=""lang-kotlin prettyprint-override""><code>routing {
    post(""upload"") {
        call.receiveMultipart().forEachPart {}
        call.respond(HttpStatusCode.OK)
    }
}
</code></pre>

<p>The default direct memory size is about 3Gb, to make test simpler I limit it with:</p>

<pre class=""lang-kotlin prettyprint-override""><code>System.setProperty(""io.netty.maxDirectMemory"", (10 * 1024 * 1024).toString())
</code></pre>

<p>before starting the NettyApplicationEngine.</p>

<p>Now if I upload a large file, for example with httpie, I got ""Connection reset"":</p>

<pre><code>http -v --form POST http://localhost:42195/upload file@/tmp/FileStorageLoadTest-test-data1.tmp

http: error: ConnectionError: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')) while doing POST request to URL: http://localhost:42195/upload
</code></pre>

<p>On the server side there is no information about the problem except for the ""java.io.IOException: Broken delimiter occurred"" exception. But if I put the breakpoint in NettyResponsePipeline#processCallFailed, the real exception is: </p>

<pre><code>io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 65536 byte(s) of direct memory (used: 10420231, max: 10485760)
</code></pre>

<p>It is a pity that this exception is not logged.</p>

<p>Also, I found out that the same code works without problems if I use Jetty engine instead.</p>

<p>Environment:</p>

<pre><code>Ubuntu Linux
Java 8
Ktor=1.2.5
netty-transport-native-epoll=4.1.43.Final 
</code></pre>

<p>(but if Netty started without native-epoll support, the problem is the same)</p>
","10763322","","","","","2019-11-13 17:57:38","Is it possible to upload large files to Ktor & Netty server?","<kotlin><netty><ktor>","0","0","1","","","58842957","128262","128262","ktor","265","45915935","45915934"
"58876250","1","","","2019-11-15 11:36:07","","2","68","<p>I can't seem to find how to build the URL of a newly created resource in Ktor. </p>

<pre><code>post(""/resources"") {
  val newResRequest = call.receive&lt;Resource&gt;()

  val newResLocation = service.create(newResRequest)
    .id
    .let { constructAUrlWith(it) }

  with(call) {
    response.header(""Location"", newResLocation)
    respond(Created)
  }
</code></pre>

<p>Coming from the Spring world, where URLs can be constructed without knowing the request context or hostnames and such, I was wondering how could I achieve something similar in Ktor. Thanks in advance.</p>
","891466","","","","","2019-12-02 17:58:06","Location URI with 201 response in Ktor","<kotlin><ktor>","0","5","","","","58876250","128262","128262","ktor","265","45915935","45915934"
"58910096","1","","","2019-11-18 07:53:52","","1","184","<p>I made a kotlin-ktor application, what i wanted to achieve is that it is modular that anytime any pipelines inside the application maybe removed from the source code without breaking any functionalities. So i decided i want to move a websocket implementation to separate class</p>

<p>but i faced an issue where the coroutine inside the lambda expression terminates immediately.
<a href=""https://github.com/ktorio/ktor/issues/1350"" rel=""nofollow noreferrer"">link-github issue</a></p>

<p>Can someone enlighten me about the coroutine setup on this, and how I can still keep this as modular without this kind of issue</p>

<p><strong>working ktor websocket</strong></p>

<pre><code>
fun Application.socketModule() = runBlocking {

   // other declarations
    ......

    routing {
        val sessionService = SocketSessionService()
        webSocket(""/home"") {
            val chatSession = call.sessions.get&lt;ChatSession&gt;()
            println(""request session: $chatSession"")

            if (chatSession == null) {
                close(CloseReason(CloseReason.Codes.VIOLATED_POLICY, ""empty Session""))
                return@webSocket
            }
            send(Frame.Text(""connected to server""))
            sessionService.addLiveSocket(chatSession.id, this)
            sessionService.checkLiveSocket()
        }

        thread(start = true, name = ""socket-monitor"") {
            launch {
                sessionService.checkLiveSocket()
            }
        }
    }
}

</code></pre>

<p><strong>kotlin-ktor auto-close web socket</strong></p>

<p>code below closes the socket automatically</p>

<p><strong><em>Socket Module</em></strong></p>

<pre><code>class WebSocketServer {

    fun createWebSocket(root: String, routing: Routing) {
        println(""creating web socket server"")
        routing.installSocketRoute(root)
    }

    private fun Routing.installSocketRoute(root: String) {
        val base            = ""/message/so""
        val socketsWeb      = SocketSessionService()

        webSocket(""$root$base/{type}"") {

            call.parameters[""type""] ?: throw Exception(""missing type"")
            val session = call.sessions.get&lt;ChatSession&gt;()

            if (session == null) {
                println( ""WEB-SOCKET:: client session is null"" )
                close(CloseReason(CloseReason.Codes.VIOLATED_POLICY, ""No Session""))
                return@webSocket
            }

            socketsWeb.addLiveSocket(session.id, this)

            thread(start= true, name = ""thread-live-socket"") {
                launch {
                    socketsWeb.checkLiveSocket()
                }
            }
        }
    }
}
</code></pre>

<p><strong><em>Application Module</em></strong></p>

<pre><code>fun Application.socketModule() = runBlocking {
   // other delcarations
   .....
    install(Sessions) {
        cookie&lt;ChatSession&gt;(""SESSION"")
    }

    intercept(ApplicationCallPipeline.Features) {
        if (call.sessions.get&lt;ChatSession&gt;() == null) {
            val sessionID = generateNonce()
            println(""generated Session: $sessionID"")
            call.sessions.set(ChatSession(sessionID))
        }
    }

    routing {
        webSocketServer.createWebSocket(""/home"", this)
   }
}
</code></pre>

<p>I quite dont understand why the coroutine insdie <strong>webSocket</strong> lamda is completed.
Can someone show me other/right approach on this one.</p>
","7669443","","7669443","","2019-11-18 08:01:17","2019-11-18 08:01:17","Kotlin Coroutine - Ktor Server WebSocket","<kotlin><kotlin-coroutines><ktor>","0","0","","","","58910096","128262","128262","ktor","265","45915935","45915934"
"27952848","1","","","2015-01-14 21:32:49","","1","161","<p>I have a Spring MVC app running under Jetty. It connects to a CouchDB instance on the same host using Ektorp. 
In this scenario, once the Web API request comes into Jetty, I don't have any code that connects to anything not on the localhost of where the Jetty instance is running. This is an important point for later. </p>

<p>I have debug statements in Jetty to show me the performance of various components of my app, including the performance of querying my CouchDB database. </p>

<p>Scenario 1: When I initiate the API request from localhost, i.e. I use Chrome to go to <a href=""http://localhost:8080/"" rel=""nofollow"">http://localhost:8080/</a>, my debug statements indicate a CouchDB peformance of X. 
Scenario 2: When I initiate the exact same API request from a remote host, i.e. I use Chrome to go to http://:8080/, my debug statements indicate a CouchDB performance of 4X. </p>

<p>It looks like something is causing the connection to CouchDB to be much slower in scenario 2 than scenario 1. That doesn't seem to make sense, since once the request comes into my app, regardless of where it came from, I don't have any code in the application that establishes the connection to CouchDB differently based on where the initial API request came from. As a matter of fact, I have nothing that establishes the connection to CouchDB differently based on anything.
It's always the same connection (from the application's perspective), and I have been able to reproduce this issue 100% of the time with a Jetty restart in between scenario 1 and 2, so it does not seem to be related to caching either. </p>

<p>I've gone fairly deep into StdCouchDbConnector and StdHttpClient to try to figure out if anything is different in these two scenarios, but cannot see anything different. </p>

<p>I have added timers around the executeRequest(HttpUriRequest request, boolean useBackend) call in StdHttpClient to confirm this is where the delay is happening and it is. The time difference between Scenario 1 and 2 is several fold on client.execute(), which basically uses the Apache HttpClient to connect to CouchDB. </p>

<p>I have also tried always using the ""backend"" HttpClient in StdHttpClient, just to take Apache HTTP caching out of the equation, and I've gotten the same results as Scenarios 1 and 2. </p>

<p>Has anyone run into this issue before, or does anyone have any idea what may be happening here? I have gone all the way down to the org.apache.http.impl.client.DefaultRequestDirectory to try to see if anything was different between scenarios 1 and 2, but couldn't find anything ... </p>

<p>A couple of additional notes: </p>

<p>a. I'm currently constrained to a Windows environment in EC2, so instances are virtualized. 
b. Scenarios 1 and 2 give the same response time when the underlying instance is not virtualized. But see a - I have to be on AWS. 
c. I can also reproduce similar 4X slower performance as in scenario 2 with this third scenario: instead of making the localhost:8080/ using Chrome, I make it using Postman, which is a Chrome application. Using Postman from the Jetty instance itself, I can reproduce the 4X slower times. </p>

<p>The only difference I see in c. above is that the request headers in Chrome's developer tools indicate a Remote Address of [::1]:8080. I don't have any way to set that through Postman, so I don't know if that's the difference maker. And if it were, first I wouldn't understand why. And second, I'm not sure what I could do about it, since I can't control how every single client is going to connect to my API. </p>

<p>All theories, questions, ideas welcome. Thanks in advance! </p>
","4455274","","","","","2015-01-14 21:32:49","Ektorp querying performance against CouchDB is 4x slower when initiating the request from a remote host","<couchdb><httpclient><ektorp>","0","0","","","","27952848","73833","73833","ektorp","71","7739352","7739351"
"28296832","1","","","2015-02-03 10:39:06","","1","110","<p>I'm trying to parse a webservice that gives me JSON data in response. And I'm storing the JSON data in couchdb with ektorp. So I have a string that contains JSON data for instance : </p>

<pre><code>String t = ""{\""id\"":2834361855,\""name\"":\""Деменковa Елена\""}"";
</code></pre>

<p>Then I transform the string into an InputStream to store the JSON just like that :</p>

<pre><code>InputStream jsonInputStream = 
    new ByteArrayInputStream(t.getBytes(Charset.forName(""UTF-8"")));

db.update(String.valueOf(id),
               jsonInputStream,
               t.length(),
               null);
</code></pre>

<p>But it raises an exception :</p>

<blockquote>
  <p>400:Bad Request
  URI: /databs/101
  Response Body: 
  {
   ""error"" : ""bad_request"",
   ""reason"" : ""invalid_json""
  }</p>
</blockquote>

<p>And I'm pretty sure it's a charset issue because if I change the String so it does no longer contains any russian characters like :</p>

<pre><code>String t = ""{\""id\"":2834361855,\""name\"":\""toto\""}"";
</code></pre>

<p>Then it works just fine. I don't know what I'm doing wrong, I tried a lot of things without any luck. Many thanks for the help I'm really stuck.</p>
","2343221","","1033422","","2015-02-04 09:27:30","2015-02-04 09:27:30","InputStream charset issue with couchdB in java","<java><json><character-encoding><couchdb><ektorp>","0","2","","","","28296832","73833","73833","ektorp","71","7739352","7739351"
"59009798","1","59009953","","2019-11-23 16:34:15","","0","25","<p>How can we declare a <code>&lt;a&gt;</code> in KTOR's HTML DSL? I know there's a tag like <code>a { href = ""example.com"" }</code>, but I can't set its label. So, it doesn't appear.</p>
","2191890","","","","","2019-11-23 16:48:33","How to add a anchor <a> in KTOR?","<ktor>","1","0","","","","59009798","128262","128262","ktor","265","45915935","45915934"
"59056611","1","","","2019-11-26 17:40:19","","1","94","<p>The exception below is thrown after this code.  Interestingly it works while debugging and stepping through the code.  The exception is thrown on the last line.  </p>

<p>Kotlin 1.3.60</p>

<p>Ktor 1.2.6</p>

<p>kotlinx.serialization 0.14.0</p>

<pre><code>} catch (throwable: Throwable) {
   when (throwable) {
      is ClientRequestException -&gt; {
          val statusCode = throwable.response.status.value
          val byteArray = ByteArray(throwable.response.content.availableForRead)
          throwable.response.content.readFully(byteArray, 0, byteArray.size)
          val text = String(byteArray, 0, byteArray.size, Charsets.UTF_8)
          logger.log(""text is: $text"")
          val isJson = throwable.response.headers[""Content-Type""]?.startsWith(""application/json"") ?: false
          val failure = if (isJson) {
              val json = Json(JsonConfiguration.Default).parseJson(text).jsonObject
</code></pre>

<p>When not stepping through with the debugger, the log states that <code>text</code> is empty.  How can this be?  Is this running before all the content has been transferred?</p>

<pre><code>kotlinx.serialization.json.JsonDecodingException: Invalid JSON at 0: Can't begin reading from here
 at kotlinx.serialization.json.internal.JsonReader.fail(JsonReader.kt:293)
 at kotlinx.serialization.json.internal.JsonReader.fail$default(JsonReader.kt:292)
</code></pre>
","751581","","1000551","","2019-12-19 08:01:21","2019-12-19 08:01:21","Ktor: JsonDecodingException on valid JSON","<android><kotlin><ktor><kotlin-multiplatform><kotlinx.serialization>","0","4","","","","59056611","128262","128262","ktor","265","45915935","45915934"
"59130217","1","","","2019-12-01 21:37:46","","0","165","<p>I've just started Keycloak for the first time (newbie) with a docker container on port 10080. And setup a new realm, client, user and a attached it to a role/group. Everything till now is fine and working without any issue. </p>

<p>In the client setup of Keycloak I've set the <code>Valid Redirect URIs</code> to my application to <code>http://localhost:8080/*</code> and when I'm call the the auth page of my webserver I get a error message from Keycloak <code>Invalid parameter: redirect_uri</code> and if I setup the <code>URI</code> to <code>*</code> its working but the Keycloak doesn't redirects to port 8080 and redirects to <code>:10080/oauth?state=1c7</code> and if I'm just replacing the port with my webservice it shows the auth token, which I've setup for testing to show the payload from Keylcloak.</p>

<p><strong>Somehow the redirects doesn't work</strong>! If I'm putting the wrong credentials for my user its working perfectly with error message, which is the expected behaviour. </p>

<p>I've also setup the root and admin url in the client setup to be on the save side ¯_(ツ)_/¯</p>

<p>My docker-compose:</p>

<pre><code>  keycloak:
    image: jboss/keycloak:8.0.0
    container_name: keycloak_abc
    ports:
      - ""10080:8080""
    environment:
      - KEYCLOAK_USER=admin
      - KEYCLOAK_PASSWORD=admin
    networks:
      - abc-network
</code></pre>

<p>The response from Keycloak after login with a valid user and redirect url set to <code>*</code> : 
<a href=""http://localhost:10080/oauth?state=768038c4a2adb8dd&amp;session_state=e64e00d9-f3d0-4c0a-9df0-42cab897be08&amp;code=47cd4e1c-ff62-46c1-a681-182a83b6aeb4.e64e00d9-f3d0-4c0a-9df0-42cab897be08.7006377e-2f0d-4b56-b3e5-991f8036fb11"" rel=""nofollow noreferrer"">http://localhost:10080/oauth?state=768038c4a2adb8dd&amp;session_state=e64e00d9-f3d0-4c0a-9df0-42cab897be08&amp;code=47cd4e1c-ff62-46c1-a681-182a83b6aeb4.e64e00d9-f3d0-4c0a-9df0-42cab897be08.7006377e-2f0d-4b56-b3e5-991f8036fb11</a></p>

<p>I've uploaded a recording from the network traffic: <a href=""https://pastebin.com/v3yqcUh7"" rel=""nofollow noreferrer"">https://pastebin.com/v3yqcUh7</a></p>
","354164","","354164","","2019-12-02 20:26:54","2019-12-03 12:01:04","Keycloak doesn't redirects in development","<keycloak><ktor>","2","4","","","","59130217","128262","128262","ktor","265","45915935","45915934"
"59173340","1","","","2019-12-04 10:01:16","","0","33","<p>I have an API implementend with ktor server that is currently discarding some POST requests with big JSON data payloads being send to with the HTTP Status code 413 (Payload too large).</p>

<p>I'm checking documentation of ktor but cannot find where I can configure this max content length configuration.</p>

<p>This is how I instantiate my server:</p>

<pre><code>val server = embeddedServer(Netty, port = config[parameters.api.port]) {
    install(Locations)

    install(ContentNegotiation) {
        jackson {
            enable(SerializationFeature.INDENT_OUTPUT) // Pretty Prints the JSON
        }
    }

    install(StatusPages) {
       (...)
    }

    routing {
       (...)
    }
}
</code></pre>

<p>I've found deep in the API documentation that <code>HttpObjectAggregator</code> object accepts a <code>maxContentLength</code> parameter but I can't find how to use it or if it actually is what I need to use.</p>
","111065","","111065","","2019-12-04 10:13:59","2019-12-04 10:13:59","KTOR: How to increase max-content-length","<kotlin><ktor>","0","0","","","","59173340","128262","128262","ktor","265","45915935","45915934"
"59189255","1","","","2019-12-05 06:12:29","","0","66","<p>I'm using Ktor Framework to create the server.</p>

<p>I created a POST request that has the body structure like {""Image"": ""Image File""}. Now I need to process the received image using a Python Script.</p>

<p>Is there any way to run a python script in Ktor Framework?</p>
","6782471","","","","","2019-12-05 06:50:42","Is there anyway to run python script in Ktor Framework?","<python><kotlin><server><ktor>","0","2","0","","","59189255","128262","128262","ktor","265","45915935","45915934"
"59221697","1","59224602","","2019-12-06 23:44:02","","1","265","<p>I have a feature branch where I'm loading data from a rest service. For two requests this works absolutely as expected, but for one request I get always an NoTransformationFoundException.</p>

<p>I'm creating the http client like this:</p>

<pre><code>private val httpClient =
    HttpClient(OkHttp) {
        install(JsonFeature) {
            serializer = GsonSerializer()
        }
    }
</code></pre>

<p>Above you see I'm using okhttp with gson. Just to make the issue easier to debug here are my ktor dependencies:</p>

<pre><code>compile ""io.ktor:ktor-client-okhttp:1.2.6""
compile ""io.ktor:ktor-client-json:1.2.6""
compile ""io.ktor:ktor-client-gson:1.2.6""
</code></pre>

<p>The request like below is works fine for me. <a href=""https://developer.amazon.com/de/docs/smapi/vendor-operations.html#request"" rel=""nofollow noreferrer"">Here is the relevant documentation</a> (including response JSON):</p>

<pre><code>data class Vendors(val vendors: List&lt;Vendor&gt;)

data class Vendor(
    val id: String,
    val name: String,
    val roles: List&lt;String&gt;
)

fun fetchVendors() = runBlocking {
    httpClient.get&lt;Vendors&gt;(""https://api.amazonalexa.com/v1/vendors"") {
        headers.append(""Authorization"", ""Bearer $accessToken"")
    }?.vendors
}
</code></pre>

<p><strong>Update:</strong> I knew there had to be a difference: The content type above is <code>application/json</code></p>

<p>However this call (fetching the skills, with the <a href=""https://developer.amazon.com/de/docs/smapi/skill-operations.html#list-skills"" rel=""nofollow noreferrer"">documentation here</a>) keeps failing:</p>

<pre><code>data class Skills(
    val isTruncated: Boolean,
    val skills: List&lt;Skill&gt;
)

data class Skill(
    val apis: List&lt;String&gt;,
    val asin: String,
    val lastUpdated: String,
    val nameByLocale: Map&lt;String, String&gt;,
    val publicationStatus: String,
    val skillId: String,
    val stage: String
)

fun fetchSkills(vendor: String) = runBlocking {
    httpClient.get&lt;Skills&gt;(""https://api.amazonalexa.com/v1/skills?vendorId=$vendor"") {
        headers.append(""Authorization"", ""Bearer $accessToken"")
    }.skills
}
</code></pre>

<p><strong>Update</strong>: Here is the response Content-Type: <code>application/json+hal</code></p>

<p>I don't understand why one works while the other fails with this exception:</p>

<pre><code>Exception in thread ""main"" io.ktor.client.call.NoTransformationFoundException: No transformation found: class kotlinx.coroutines.io.ByteBufferChannel -&gt; class my.package.name.Skills
        at io.ktor.client.call.HttpClientCall.receive(HttpClientCall.kt:88)
        at my.package.name.AmazonApi$fetchSkills$1.invokeSuspend(AmazonApi.kt:200)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
        at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:215)
        at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
        at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
        at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
        at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:215)
        at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
        at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
        at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
        at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:215)
        at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
        at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
        at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
        at kotlinx.coroutines.DispatchedTask.run(Dispatched.kt:241)
        at kotlinx.coroutines.EventLoopImplBase.processNextEvent(EventLoop.common.kt:270)
        at kotlinx.coroutines.BlockingCoroutine.joinBlocking(Builders.kt:79)
        at kotlinx.coroutines.BuildersKt__BuildersKt.runBlocking(Builders.kt:54)
        at kotlinx.coroutines.BuildersKt.runBlocking(Unknown Source)
        at kotlinx.coroutines.BuildersKt__BuildersKt.runBlocking$default(Builders.kt:36)
        at kotlinx.coroutines.BuildersKt.runBlocking$default(Unknown Source)
        at my.package.name.AmazonApi.fetchSkills(AmazonApi.kt:131)
        at my.package.name.Cli.createProject(Cli.kt:305)
        at my.package.name.Cli.parseArgs(Cli.kt:208)
        at my.package.name.Cli$Companion.main(Cli.kt:508)
        at my.package.name.Cli.main(Cli.kt)
</code></pre>

<p>Please give me some hints how to resolve this issue, or at least how I can debug it. Btw when I use String instead of Skill I see the expected response JSON.</p>
","995926","","995926","","2019-12-06 23:57:21","2019-12-07 09:24:10","ktor throws for some data classes an NoTransformationFoundException","<json><kotlin><gson><ktor>","1","1","","","","59221697","128262","128262","ktor","265","45915935","45915934"
"59229189","1","","","2019-12-07 18:49:03","","1","138","<p>Below is the code that I have tried. I am trying the following code in the commonMain block.</p>

<pre><code>suspend fun callHttpFunction(){

val clientEngine = HttpClient{

        engine {
            pipelining = true
            threadsCount = 4
        }

    }

    clientEngine.post&lt;String&gt;(""https"",""m2.testing.com"",8080,
        ""/TokenServiceEncrypt/api/base/TokenUpdated"",requestBlock
    ) {
        headers.append(""Content-Type"", ""application/json"")
        headers.append(""Accept"", ""application/json"")
        headers.append(""SessionToken"", ""seesfssfsf"")
    }
    clientEngine.close()
}

//HttpClient(Apache) fails and so does HttpClient(OkHttp)
</code></pre>
","11634795","","11634795","","2019-12-07 18:56:55","2020-03-23 11:13:42","How do I configure the engine for KTOR HTTPclient Multiplatform Kotlin projects? Addition of SSL certificate is also required","<kotlin><httpclient><multiplatform><ktor>","2","1","1","","","59229189","128262","128262","ktor","265","45915935","45915934"
"59363307","1","","","2019-12-16 19:44:41","","1","66","<p>I cannot receive the json body of the ktor HttpClient twice.
For the server there is a DoubleReceive feature but I don't see how I can use this when doing client calls.</p>

<p>I want to call a different microservice which either returns some json or when there is an error it return e.g. status 500 and a error description a json payload.</p>

<p>so I tried to HttpResponseValidator and in this only allows a readBytes with this code </p>

<pre><code>HttpResponseValidator {
validateResponse { response -&gt;
  val statusCode = response.status.value
  val originCall = response.call

  if (statusCode &lt; 300 || originCall.attributes.contains(ValidateMark)) return@validateResponse
  response.use {
    val exceptionCall = originCall.save().apply {
      attributes.put(ValidateMark, Unit)
    }
    //try parse error from json payload which other microservice usually send
    exceptionCall.response.receiveError()?.also { throw mapErrors(response, it) }
    //default ktor exception mapping
    when (statusCode) {
      in 300..399 -&gt; throw RedirectResponseException(response)
      in 400..499 -&gt; throw ClientRequestException(response)
      in 500..599 -&gt; throw ServerResponseException(response)
    }
    if (statusCode &gt;= 600) {
      throw ResponseException(response)
    }
  }
}
</code></pre>

<p>}</p>

<p>receiveError can be used as <code>JacksonConfig.defaultMapper.readValue&lt;ServiceErrorResponse&gt;(this.readBytes())</code> but will throw a DoubleReceivException if you just call <code>response.receive&lt;ServiceErrorResponse&gt;()</code>
The reason for this is that the receive function first checks a <code>received atomicBoolean</code>.</p>

<p><strong>TL;DR</strong>
Now I wonder if there are any ideas on how you handle error payloads or do you just not use them? I am new to microservice in such a manner and it was a requirement to add them. Ktor is a new addition. How do you communicate error infromation between services?</p>

<p>Also is there a way to use the DoubleReceive feature in the client. Because <code>HttpClient(){install(DoubleReceive)}</code> does not work as it is not an ApplicationFeature and not a ClientFeature.</p>
","4011761","","","","","2019-12-16 19:44:41","ktor receive json body twice","<exception><microservices><ktor>","0","0","","","","59363307","128262","128262","ktor","265","45915935","45915934"
"59370764","1","","","2019-12-17 09:04:01","","13","488","<p>Update:
It works if I first execute a coroutine without timeout and then withTimeout. But If I execute a coroutine withTimeout first then it gives me an error. same goes for Async as well.</p>

<p>I am creating a demo kotlin multiplatform application where I am executing an API call with ktor.
I want to have a configurable timeout function on ktor request so I am using withTimeout at coroutine level.</p>

<p>Here is my function call with network API.</p>

<pre><code>suspend fun &lt;T&gt; onNetworkWithTimeOut(
    url: String,
    timeoutInMillis: Long,
    block: suspend CoroutineScope.() -&gt; Any): T {
    return withTimeout(timeoutInMillis) {
        withContext(dispatchers.io, block)
    } as T
}

suspend fun &lt;T&gt; onNetworkWithoutTimeOut(url: String, block: suspend CoroutineScope.() -&gt; Any): T {
    return withContext(dispatchers.io, block) as T
}
</code></pre>

<p>Here is my AppDispatcher class for the iOSMain module.</p>

<pre><code>@InternalCoroutinesApi
actual class AppDispatchersImpl : AppDispatchers {
@SharedImmutable
override val main: CoroutineDispatcher =
    NsQueueDispatcher(dispatch_get_main_queue())

@SharedImmutable
override val io: CoroutineDispatcher =
    NsQueueDispatcher(dispatch_get_main_queue())

internal class NsQueueDispatcher(
    @SharedImmutable private val dispatchQueue: dispatch_queue_t
) : CoroutineDispatcher() {
    override fun dispatch(context: CoroutineContext, block: Runnable) {
        NSRunLoop.mainRunLoop().performBlock {
            block.run()
        }
    }
}
</code></pre>

<p>}</p>

<p>so the function with the timeout gives me the following error in iOS client.</p>

<pre><code>kotlin.IllegalStateException: There is no event loop. Use runBlocking { ... } to start one.
</code></pre>

<p>I am using 1.3.2-native-mt-1 version of the kotlin-coroutine-native.
I have created a sample demo application at the following URL.
<a href=""https://github.com/dudhatparesh/kotlin-multiplat-platform-example"" rel=""noreferrer"">https://github.com/dudhatparesh/kotlin-multiplat-platform-example</a></p>
","3418658","","3418658","","2019-12-28 02:52:30","2019-12-28 09:53:49","withTimeout function gives IllegalStateException: There is no event loop. Use runBlocking { ... } to start one. in Kotlin Multiplatform iOS client","<ios><kotlin><kotlin-coroutines><ktor><kotlin-native>","3","3","","","","59370764","128262","128262","ktor","265","45915935","45915934"
"59410528","1","","","2019-12-19 13:14:14","","2","70","<p>I am working on <strong>Kotlin</strong> Multiplatform Project. I used <strong>Ktor</strong> Client for Network calls. I want to cache some request based on some custom logic not based on response header. </p>

<p><code>HttpCache</code> feature provided by <code>Ktor</code> is Response Header driven and I am not able to override it because number of Classes is <code>Internal</code>.</p>

<p>How can i enable <code>Ktor</code> to work with custom cache?</p>
","3524134","","","","","2019-12-19 13:14:14","How to Implement Custom Cache Mechanism with Kotlin Multiplatform(Android, iOS) Ktor Client","<ktor><kotlin-multiplatform>","0","0","1","","","59410528","128262","128262","ktor","265","45915935","45915934"
"59470764","1","","","2019-12-24 15:22:05","","1","80","<p>I need to make a GET request using a Ktor client. The URL I'm using is passed to me as a string from a source I have no control over. The URL string contains commas that are encoded by the Ktor client to <code>%2C</code> which is breaking the backend logic. Is there a way to prevent Ktor from encoding the URL?</p>

<p>Example to clarify:</p>

<pre><code>client.get {
    url(url)
    accept(ContentType.Application.Json)
    method = HttpMethod.Get
}
</code></pre>

<p>In the following code, the value of <code>url</code> is <code>https://my.domain/someData,someMoreData</code> but the outgoing request URL is <code>https://my.domain/someData%2CsomeMoreData</code>.</p>
","2318632","","2318632","","2019-12-24 15:29:26","2019-12-25 11:12:48","Encode URL in Ktor Client","<kotlin><urlencode><ktor><ktor-client>","1","0","","","","59470764","128262","128262","ktor","265","45915935","45915934"
"59516599","1","","","2019-12-29 03:13:48","","3","347","<p><strong>Is there a way to run Cron Jobs with <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">Ktor</a>? My end objective is to host a Cron Job written with Kotlin for the <a href=""https://play.google.com/store/apps/details?id=app.coinverse"" rel=""nofollow noreferrer"">Coinverse app's</a> backend service to populate data.</strong></p>

<p>I'm currently hosting multiple Java <em>.jar</em> apps written in Kotlin on AppEngine. I'm looking to refactor these apps into Ktor apps on AppEngine with a <a href=""https://cloud.google.com/appengine/docs/standard/java/config/cron-yaml"" rel=""nofollow noreferrer"">Cron Job</a> for scheduled tasks, as the <em>.jar</em> apps have more issues with dependencies. </p>

<p>I'm looking for Ktor's equivalent to Cloud Functions' <a href=""https://firebase.googleblog.com/2019/04/schedule-cloud-functions-firebase-cron.html"" rel=""nofollow noreferrer"">built-in implementation</a> for Cron Jobs with JavaScript. </p>

<pre><code>functions.pubsub.schedule
</code></pre>

<p><em>Back-up option:</em> If Ktor does not have this feature and I want to keep the code in Kotlin, Google has an alpha, <a href=""https://github.com/GoogleCloudPlatform/kotlin-samples/tree/master/functions"" rel=""nofollow noreferrer"">Using Kotlin with Google Cloud Functions</a>. It appears Kotlin + Cloud Functions' built-in implementation could be used with this approach.</p>
","2253682","","1000551","","2019-12-30 08:38:49","2019-12-31 16:46:57","How to Run Cron Jobs in Kotlin Ktor?","<java><google-app-engine><kotlin><google-cloud-functions><ktor>","1","0","2","","","59516599","128262","128262","ktor","265","45915935","45915934"
"28913693","1","28968526","","2015-03-07 10:07:31","","1","499","<p>So I've  been trying to move data from one database to another. I've already move them but I need to clear the documents which I've already moved from the old database. I've been using ektorp's execute bulk to perform bulk operations. But for some reason I keep getting <code>document update conflict</code> when I try to delete bulk by inserting <code>_deleted</code>.
I might be doing it wrong, here is what I did.</p>

<ol>
<li>Fetch by bulk with <code>include docs</code>. (For some reason, this doesn't work with just <code>id</code> and <code>rev</code>.)</li>
<li>Then include the _deleted field to each document.</li>
<li>Post using <code>executebulk</code>.</li>
</ol>

<p>It works for some documents but keeps getting document update conflict for some documents.</p>

<p>Any solution/suggestions please..</p>
","4643810","","4370109","","2015-07-04 11:20:07","2015-07-04 11:20:07","Couch db bulk operations","<couchdb><conflict><ektorp><bulk-operations>","2","0","","","","28913693","73833","73833","ektorp","71","7739352","7739351"
"31954032","1","","","2015-08-12 00:11:55","","2","268","<p>Im trying to use couchDB, ektorp to store and query data
If i have documents like</p>

<pre><code>Sofa{
    colour:red   manufaturedDate: 12/8/2015
}
</code></pre>

<p>how can i create a view and query it.. so i can answer
give me all Sofas that are in a set or arbitrary colours AND have been manufactured between certain days..</p>

<p>the user can search for what ever colours they want and select whatever days they like in sudo SQL i would write something like</p>

<pre><code>select* from Sofa where manufaturedDate is inbetween date1 and date 2 and colour in ('red', 'blue', 'orange');
</code></pre>

<p>But im having difficulty creating the equivilant in couchDB/ektorp
i can create view</p>

<p>[red, 12/8/2015] = {Sofa1}</p>

<p>I know i can search by mutilpe keys
but i dont know how to query it using both ""types"" of criteria. </p>

<p>i can either do</p>

<pre><code>ComplexKey start = ComplexKey.of(query.getStartKey());
ComplexKey end = ComplexKey.of(query.getEndKey());
view2.startKey(start).endKey(end);
</code></pre>

<p>OR</p>

<pre><code>for(Object[] sample:query.getKeyValues()){
    keys.add(ComplexKey.of(sample));
}
view2.keys(keys);
</code></pre>

<p>How can i do both.. Am i looking at this the wrong way?</p>
","3533542","","","","","2015-08-12 00:11:55","query couchdb with ektorp for range and key value","<couchdb><ektorp>","0","0","","","","31954032","73833","73833","ektorp","71","7739352","7739351"
"33920370","1","","","2015-11-25 15:29:24","","1","169","<p>On my CouchDB DB, I have created a view with key [""userId"", ""startdate""]</p>

<p>I must get data from different userId and a range date. I have tried some of solutions, example :</p>

<pre><code>{
    ""keys"": [
        {
            ""startkey"": [""userID_A"",""2014-05-02""],
            ""endkey"": [""userID_A"", ""2015-05-02"",{}]
            ]
        },
        {
            ""startkey"": [""userID_B"",""2014-05-02""],
            ""endkey"": [""userID_B"",""2015-05-02"",{}]
            ]
        }
    ]
}
</code></pre>

<p>But it doesn't work... </p>

<p>This <a href=""http://jamietalbot.com/2010/03/24/using-multiple-start-and-end-keys-for-couchdb-views/"" rel=""nofollow noreferrer"">website</a> is useful, and give a good example : (here to recup all posts of a category A or B in March 2010 -> June 2010</p>

<pre><code>{
    ""keys"": [
        {
            ""startkey"": [""Category A"",""2010"",""03""],
            ""endkey"": [""Category A"",""2010"",""06"",{}]
        },
        {
            ""startkey"": [""Category B"",""2010"",""03""],
            ""endkey"": [""Category B"",""2010"",""06"",{}]
        }
    ]
}
</code></pre>

<p>Some have any idea?</p>

<p>Note : I need perform that in Java, with Ektorp. If someone has already do that...</p>

<p>EDIT : I think that my post is a duplicate. Similar post <a href=""https://stackoverflow.com/questions/1468684/multiple-key-ranges-as-parameters-to-a-couchdb-view"">here</a>.</p>
","3917714","","-1","","2017-05-23 10:28:16","2015-11-25 16:02:41","CouchDb get data from multiple key and date range","<couchdb><ektorp>","0","0","","","","33920370","73833","73833","ektorp","71","7739352","7739351"
"34218492","1","34325095","","2015-12-11 07:47:25","","2","915","<p>I want to update a field in couchdb document which already has an attachment.
If I update new field with the current revision then the attachment gets deleted. Is there a way so that I update the field without losing the attachment? I am using Ektorp API to update the document.</p>

<p>Regards
Sunil.</p>
","1849139","","","","","2015-12-29 23:45:51","How to update couchdb document without losing existing attachment","<couchdb><attachment><ektorp>","1","0","","","","34218492","73833","73833","ektorp","71","7739352","7739351"
"59535055","1","","","2019-12-30 18:09:46","","0","38","<p>I am working on a simple user hub application, I user Swagger OAS to template my API built in KTOR using Mongo as my DB. </p>

<p>I can currently get the expected response when I call <code>getAllUsers()</code> I can POST a user to the collection but I can't seem to get it to return a single user from the collection. 
When I try and get a user by their ID this </p>

<p><strong>Request</strong></p>

<p><code>curl -X GET ""http://localhost:8080/users/4352"" -H ""accept: application/json""</code></p>

<p><strong>Object</strong></p>

<pre><code>{
""userName"":""exampleUser123"",
""firstName"":""Example"",
""lastName"":""User"",
""email"":""example@email.com"",
""dob"":""08/01/2000"",
""age"":""28"",
""apps"":[],
""userId$user_hub"":""5e03f88ea0f6683162f7c109""
}
</code></pre>

<p>Would have something to do with the ""userId$user_hub""?</p>

<p><strong>Stack Error</strong></p>

<pre><code>[nioEventLoopGroup-4-4] ERROR Application - Unhandled: GET - /users/exampleUser123
java.lang.IllegalArgumentException: null
    at org.bson.types.ObjectId.isValid(ObjectId.java:91)
    at com.lsm.userHub.MongoDriver.getDocumentById(mongoConnector.kt:44)
    at com.lsm.userHub.LSMHubServer.getUserById(LSMHubServer.kt:62)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at io.ktor.swagger.experimental.SwaggerUtilsKt.invokeSuspend(SwaggerUtils.kt:341)
    at io.ktor.swagger.experimental.SwaggerUtilsKt$registerRoutes$1$1$1$1.invokeSuspend(SwaggerUtils.kt:141)
    at io.ktor.swagger.experimental.SwaggerUtilsKt$registerRoutes$1$1$1$1.invoke(SwaggerUtils.kt)
    at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:91)
    at kotlinx.coroutines.BuildersKt__Builders_commonKt.withContext(Builders.common.kt:155)
    at kotlinx.coroutines.BuildersKt.withContext(Unknown Source)
    at io.ktor.swagger.experimental.SwaggerUtilsKt$registerRoutes$1$1$1.invokeSuspend(SwaggerUtils.kt:140)
    at io.ktor.swagger.experimental.SwaggerUtilsKt$registerRoutes$1$1$1.invoke(SwaggerUtils.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.features.StatusPages$interceptCall$2.invokeSuspend(StatusPages.kt:98)
    at io.ktor.features.StatusPages$interceptCall$2.invoke(StatusPages.kt)
    at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:91)
    at kotlinx.coroutines.CoroutineScopeKt.coroutineScope(CoroutineScope.kt:180)
    at io.ktor.features.StatusPages.interceptCall(StatusPages.kt:97)
    at io.ktor.features.StatusPages$Feature$install$2.invokeSuspend(StatusPages.kt:137)
    at io.ktor.features.StatusPages$Feature$install$2.invoke(StatusPages.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27)
    at io.ktor.routing.Routing.executeResult(Routing.kt:147)
    at io.ktor.routing.Routing.interceptor(Routing.kt:34)
    at io.ktor.routing.Routing$Feature$install$1.invokeSuspend(Routing.kt:99)
    at io.ktor.routing.Routing$Feature$install$1.invoke(Routing.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invokeSuspend(ContentNegotiation.kt:106)
    at io.ktor.features.ContentNegotiation$Feature$install$1.invoke(ContentNegotiation.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.features.CallLogging$Feature$install$2.invokeSuspend(CallLogging.kt:139)
    at io.ktor.features.CallLogging$Feature$install$2.invoke(CallLogging.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27)
    at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invokeSuspend(DefaultEnginePipeline.kt:118)
    at io.ktor.server.engine.DefaultEnginePipelineKt$defaultEnginePipeline$2.invoke(DefaultEnginePipeline.kt)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141)
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161)
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27)
    at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invokeSuspend(NettyApplicationCallHandler.kt:36)
    at io.ktor.server.netty.NettyApplicationCallHandler$handleRequest$1.invoke(NettyApplicationCallHandler.kt)
    at kotlinx.coroutines.intrinsics.UndispatchedKt.startCoroutineUndispatched(Undispatched.kt:55)
    at kotlinx.coroutines.CoroutineStart.invoke(CoroutineStart.kt:111)
    at kotlinx.coroutines.AbstractCoroutine.start(AbstractCoroutine.kt:154)
    at kotlinx.coroutines.BuildersKt__Builders_commonKt.launch(Builders.common.kt:54)
    at kotlinx.coroutines.BuildersKt.launch(Unknown Source)
    at io.ktor.server.netty.NettyApplicationCallHandler.handleRequest(NettyApplicationCallHandler.kt:26)
    at io.ktor.server.netty.NettyApplicationCallHandler.channelRead(NettyApplicationCallHandler.kt:20)
    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374)
    at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:56)
    at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:365)
    at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)
    at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:416)
    at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:515)
    at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)
    at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
    at java.lang.Thread.run(Thread.java:748)
</code></pre>

<p><strong>Kotlin Mongo DB connector</strong></p>

<p>There error is coming as I enter the first loop checking if the ID is valid</p>

<pre><code>fun getDocumentById(col: String, id: String?): Map&lt;String, Any&gt;? {
        if (ObjectId.isValid(id)) {
            return emptyMap()
        }
        val document = db.getCollection(col)
            .find(Document(""_id"", ObjectId(id)))
        if (document?.first() != null) {
            return dbDocToMap(document.first())
        }
        return null
    }
</code></pre>

<p>I have a feeling I am missing something small that is causing this issue. Any help is greatly appreciated.</p>
","10414909","","10414909","","2019-12-30 21:21:39","2019-12-30 21:21:39","KTOR Illegal Argument Exception when returning id from Mongo db","<mongodb><api><kotlin><ktor>","0","1","","","","59535055","128262","128262","ktor","265","45915935","45915934"
"59538918","1","","","2019-12-31 02:28:11","","0","85","<p>I'm prototyping an API that serves as a proxy for S3 files using Ktor with Netty engine, while making use of the AWS S3 Async client which makes use of the java NIO API for truly non-blocking I/O, unlike the first version of the SDK(More here: <a href=""https://docs.aws.amazon.com/sdk-for-java/v2/developer-guide/basics-async.html"" rel=""nofollow noreferrer"">https://docs.aws.amazon.com/sdk-for-java/v2/developer-guide/basics-async.html</a>). However I'm running into a few hiccups while doing so, due to the awkwardness of the S3 Async Client API callbacks and my rudimentary knowledge of the Kotlin Coroutines. Here's what I've got so far.</p>

<p><strong>API declaration and routing to controller</strong></p>

<pre><code>....
routing {

    get(""/s3File"") {
        call.respond(service.s3OutgoingContent())
    }

}
....
</code></pre>

<p><strong>API implementation</strong></p>

<pre><code>override suspend fun s3OutgoingContent(): OutgoingContent {

     return suspendCoroutine { continuation -&gt;
            val asyncResponseTransformer = object : AsyncResponseTransformer&lt;GetObjectResponse, Void&gt; {
                private var contentLength: Long? = null
                private var contentType: ContentType? = null

                override fun prepare(): CompletableFuture&lt;Void&gt; {
                    // Ignore this as we don't rely on futures to be notified of completion
                    return CompletableFuture.completedFuture(null)
                }

                override fun onResponse(getObjectResponse: GetObjectResponse) {
                    // S3 GetObject response has been received
                    contentLength = getObjectResponse.contentLength()
                    contentType = ContentType.parse(getObjectResponse.contentType())
                }

                override fun onStream(byteBufferPublisher: SdkPublisher&lt;ByteBuffer&gt;) {
                    // The bytebuffer publisher has been made available.
                    // Subscribe to it, so we can start sending bytes to the response write channel
                    continuation.resumeWith(Result.success(S3FileOutgoingContent(byteBufferPublisher,
                            HttpStatusCode.OK, contentLength, contentType)))
                }

                override fun exceptionOccurred(ex: Throwable) {
                    // TODO: Map exception type to HTTP response code
                    // S3 GetObject call failed
                    continuation.resumeWith(Result.success(HttpStatusCodeContent(HttpStatusCode.InternalServerError)))
                }
            }

            // Make the async S3 call and suspend until we know we are 
            // dealing with a valid S3 object, and then return an 
            // OutgoingContent object based on the received S3 GetObjectResponse.
            S3_CLIENT.getObject(GetObjectRequest.builder()
                    .bucket(""BUCKET_NAME"")
                    .key(""OBJECT_KEY"")
                    .build(),
                    asyncResponseTransformer
            )

        }

}
</code></pre>

<p><strong>S3FileOutgoingContent.kt implementation</strong></p>

<pre><code>internal class S3FileOutgoingContent(private val byteBufferPublisher: SdkPublisher&lt;ByteBuffer&gt;,
                                     override val status: HttpStatusCode? = null,
                                     override val contentLength: Long? = null,
                                     override val contentType: ContentType? = null): OutgoingContent.WriteChannelContent() {

    override suspend fun writeTo(channel: ByteWriteChannel) {
        suspendCoroutine&lt;Nothing?&gt; { continuation -&gt;

            val byteBufferSubscriber = object : Subscriber&lt;ByteBuffer&gt; {
                private var currentSubscription: Subscription? = null

                override fun onComplete() {
                    // Finished receiving all bytes from S3
                    continuation.resumeWith(Result.success(null))
                }

                override fun onSubscribe(subscription: Subscription) {
                    currentSubscription?.cancel()
                    currentSubscription = subscription
                    // Request all byte buffers from S3
                    currentSubscription!!.request(Long.MAX_VALUE)
                }

                override fun onNext(nextByteBuffer: ByteBuffer) {
                    // The writeTo calls are invoked on the I/O dispatcher threads.
                    // Resume the byteBuffer writes on the same thread-pool.
                    CoroutineScope(continuation.context).launch {
                        channel.writeFully(nextByteBuffer)
                    }
                }

                override fun onError(ex: Throwable) {
                    // Error while receiving bytes from the publisher.
                    // TODO: How do we handle this gracefully? 
                    continuation.resumeWith(Result.failure(ex))
                }
            }

            // Subscribe to the byteBuffer publisher so we can start receiving the bytes from S3
            byteBufferPublisher.subscribe(byteBufferSubscriber)
        }

    }
}
</code></pre>

<p>There's two problems I'm running into with this:</p>

<ol>
<li>Its not documented here - <a href=""https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/core/async/AsyncResponseTransformer.html#onStream-software.amazon.awssdk.core.async.SdkPublisher-"" rel=""nofollow noreferrer"">https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/core/async/AsyncResponseTransformer.html#onStream-software.amazon.awssdk.core.async.SdkPublisher-</a>, but as per the implementation of the <a href=""https://github.com/aws/aws-sdk-java-v2/blob/master/core/sdk-core/src/main/java/software/amazon/awssdk/core/internal/async/FileAsyncResponseTransformer.java#L74"" rel=""nofollow noreferrer"">FileAsyncResponseTransformer</a> in the AWS SDK, the <code>onStream(SdkPublisher&lt;ByteBuffer&gt; publisher)</code> may be called multiple times during the lifecycle of the GetObject call. If that is the case, how can we reliably resume the continuation with a single instance of the <code>OutgoingContent</code> object?</li>
<li><p>During my tests I have not run into the problem described above, but I do see a different exception when writing to the <code>ByteWriteChannel</code> instance. It is as follows.</p>

<pre><code>java.lang.IllegalStateException: Write operation is already in progress: kotlinx.coroutines.io.internal.CancellableReusableContinuation@6a6eccec
    at kotlinx.coroutines.io.ByteBufferChannel.setupStateForWrite(ByteBufferChannel.kt:179) ~[kotlinx-coroutines-io-jvm-0.1.14.jar:?]
    at kotlinx.coroutines.io.ByteBufferChannel.access$setupStateForWrite(ByteBufferChannel.kt:21) ~[kotlinx-coroutines-io-jvm-0.1.14.jar:?]
    at kotlinx.coroutines.io.ByteBufferChannel.writeAsMuchAsPossible(ByteBufferChannel.kt:2711) ~[kotlinx-coroutines-io-jvm-0.1.14.jar:?]
    at kotlinx.coroutines.io.ByteBufferChannel.writeFully(ByteBufferChannel.kt:1169) ~[kotlinx-coroutines-io-jvm-0.1.14.jar:?]
</code></pre>

<p>I suspect I'm seeing this as I'm writing to the <code>ByteWriteChannel</code> concurrently from different I/O Dispatcher threads by spinning up a coroutine for each bytebuffer I wish to writeFully. Even the <a href=""https://ktor.io/servers/calls/responses.html#sending-response-content"" rel=""nofollow noreferrer"">Ktor documentation</a> suggests writing sequentially to the channel, but in my case the bytes aren't all available at once. So how would I go about serializing these suspending write calls from a non-suspending function? Creating a dispatcher context from a singleThreaded executor comes to mind, but it doesn't seem like the right solution.</p></li>
</ol>

<p><strong>=== UPDATE ===</strong></p>

<p>To serialize the suspending calls I ended up using a <code>Mutex</code> as recommended in the <a href=""https://kotlinlang.org/docs/reference/coroutines/shared-mutable-state-and-concurrency.html#mutual-exclusion"" rel=""nofollow noreferrer"">Kotlin documentation</a>. So the <code>onNext</code> method is modified as follows:</p>

<pre><code>override fun onNext(nextByteBuffer: ByteBuffer) {
    CoroutineScope(continuation.context).launch {
        channelWriteMutex.withLock {

            channel.writeFully(nextByteBuffer)

        }
    }
}
</code></pre>

<p>I'm yet to test the implications of this on performance under heavy load, but it gets the job done for now. I'd be interested in learning about other possible solutions. </p>
","643129","","643129","","2020-01-01 02:45:37","2020-01-01 02:45:37","Using S3AsyncClient with Ktor OutgoingContent","<kotlin><kotlin-coroutines><ktor>","0","1","","","","59538918","128262","128262","ktor","265","45915935","45915934"
"59602749","1","61438358","","2020-01-05 18:05:49","","1","62","<p>I use Objectify 6.0.5, Ktor 1.2.6, com.google.appengine:appengine:1.9.60</p>

<p>I set up web.xml, bootstrapper by tutorial <a href=""https://github.com/objectify/objectify/wiki/Setup"" rel=""nofollow noreferrer"">https://github.com/objectify/objectify/wiki/Setup</a></p>

<p>web.xml</p>

<pre><code>    ...
    &lt;listener&gt;
        &lt;listener-class&gt;com.group.Bootstrapper&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;filter&gt;
        &lt;filter-name&gt;ObjectifyFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.googlecode.objectify.ObjectifyFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;ObjectifyFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
    ...
</code></pre>

<p>Boostrapper</p>

<pre><code>class Bootstrapper : ServletContextListener {
    override fun contextInitialized(sce: ServletContextEvent?) {
        println(""         contextInitialized"")
        ObjectifyService.init(
            ObjectifyFactory()
        )

        ObjectifyService.register(User::class.java)
    }

    override fun contextDestroyed(sce: ServletContextEvent?) {}
}
</code></pre>

<p>When I call this method</p>

<pre><code>    fun save(entity: T) {
        ofy().save().entity(entity)
    }
</code></pre>

<p>I catch error</p>

<pre><code>2020-01-05 17:55:09 ERROR Application:104 - Unhandled: GET - /test
java.lang.IllegalStateException: You must call ObjectifyService.init() before using Objectify
    at com.google.common.base.Preconditions.checkState(Preconditions.java:511) ~[guava-28.1-android.jar:?]
    at com.googlecode.objectify.ObjectifyService.factory(ObjectifyService.java:34) ~[objectify-6.0.5.jar:?]
    at com.googlecode.objectify.ObjectifyService.ofy(ObjectifyService.java:51) ~[objectify-6.0.5.jar:?]
    at com.group.dao.BaseDao.listAll(BaseDao.kt:15) ~[classes/:?]
    at com.group.ApplicationKt$module$2$2.invokeSuspend(Application.kt:50) ~[classes/:?]
    at com.group.ApplicationKt$module$2$2.invoke(Application.kt) ~[classes/:?]
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:268) ~[ktor-utils-jvm-1.2.6.jar:1.2.6]
    at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:141) ~[ktor-utils-jvm-1.2.6.jar:1.2.6]
    at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:161) ~[ktor-utils-jvm-1.2.6.jar:1.2.6]
    at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:27) ~[ktor-utils-jvm-1.2.6.jar:1.2.6]
    at io.ktor.routing.Routing.executeResult(Routing.kt:147) ~[ktor-server-core-1.2.6.jar:1.2.6]
...
</code></pre>

<p>I run datastore using 'gcloud beta emulators datastore start'. It definitely run. May be is not connect to it?</p>

<p>When I run app use appengineRun, datastore also is run?</p>
","12657520","","12657520","","2020-01-05 21:28:17","2020-04-26 09:14:32","Catch IllegalStateException with Objectify","<google-app-engine><kotlin><google-cloud-platform><objectify><ktor>","1","6","","","","59602749","128262","128262","ktor","265","45915935","45915934"
"59613187","1","","","2020-01-06 13:42:05","","0","102","<p>I develop web app via IntelliJ Idea. Web App base on Google App Engine, Ktor, Kotlin. App starts, but when I go to localhost:8080, then get:</p>

<blockquote>
  <p>This localhost page can’t be found<br>
  No webpage was found for the web address: <a href=""http://localhost:8080/"" rel=""nofollow noreferrer"">http://localhost:8080/</a><br>
  HTTP ERROR 404</p>
</blockquote>

<p>In console not written some errors</p>

<p><strong>But if run app via gradle appengineRun then all is ok</strong></p>

<p>Example code:</p>

<pre><code>fun Application.module() {
    // This adds Date and Server headers to each response, and allows custom additional headers
    install(DefaultHeaders)
    // This uses use the logger to log every call (request/response)
    install(CallLogging)

    install(CORS) {
        method(HttpMethod.Options)
        method(HttpMethod.Put)
        method(HttpMethod.Delete)
        method(HttpMethod.Patch)
        header(HttpHeaders.Authorization)
        allowCredentials = true
        host(""api.vk.com"")
    }

    routing {
        get(""/"") {
            call.respondText(""It's server for apartments searching!"", contentType = ContentType.Text.Plain)
        }
    }
}
</code></pre>

<p>Attached settings in IntelliJ Idea</p>

<p>Project Structure:</p>

<p>Facets
<a href=""https://i.stack.imgur.com/RJXbL.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/RJXbL.png"" alt=""Facets""></a></p>

<p>Artifacts
<a href=""https://i.stack.imgur.com/OKfxd.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/OKfxd.png"" alt=""Artifacts""></a></p>

<p>Modules
<a href=""https://i.stack.imgur.com/jWCVG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/jWCVG.png"" alt=""Modules""></a></p>

<p>Google App Engine Standard Local Server
<a href=""https://i.stack.imgur.com/Fsule.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Fsule.png"" alt=""Google App Engine Standard Local Server""></a></p>

<p>After click run get this:</p>

<pre><code>Starting the App Engine local development server...
Jan 06, 2020 4:16:05 PM java.util.prefs.WindowsPreferences &lt;init&gt;
WARNING: Could not open/create prefs root node Software\JavaSoft\Prefs at root 0x80000002. Windows RegCreateKeyEx(...) returned error code 5.
2020-01-06 16:16:06.052:INFO::main: Logging initialized @1216ms to org.eclipse.jetty.util.log.StdErrLog
2020-01-06 16:16:06.230:WARN:oejs.AbstractConnector:main: Ignoring deprecated socket close linger time
Connected to server
2020-01-06 16:16:07.288:INFO:oejs.Server:main: jetty-9.4.18.v20190429; built: 2019-04-29T20:42:08.989Z; git: e1bc35120a6617ee3df052294e433f3a25ce7097; jvm 1.8.0_201-b09
2020-01-06 16:16:10.345:WARN:oeja.AnnotationParser:qtp1073502961-17: org.slf4j.impl.StaticLoggerBinder scanned from multiple locations: jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/log4j-slf4j-impl-2.11.2.jar!/org/slf4j/impl/StaticLoggerBinder.class, jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class
2020-01-06 16:16:10.346:WARN:oeja.AnnotationParser:qtp1073502961-17: org.slf4j.impl.StaticMDCBinder scanned from multiple locations: jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/log4j-slf4j-impl-2.11.2.jar!/org/slf4j/impl/StaticMDCBinder.class, jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticMDCBinder.class
2020-01-06 16:16:10.346:WARN:oeja.AnnotationParser:qtp1073502961-17: org.slf4j.impl.StaticMarkerBinder scanned from multiple locations: jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/log4j-slf4j-impl-2.11.2.jar!/org/slf4j/impl/StaticMarkerBinder.class, jar:file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticMarkerBinder.class
2020-01-06 16:16:10.867:INFO:oeja.AnnotationConfiguration:main: Scanning elapsed time=2202ms
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/log4j-slf4j-impl-2.11.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/WEB-INF/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
         contextInitialized
Jan 06, 2020 1:16:11 PM com.google.auth.oauth2.ComputeEngineCredentials runningOnComputeEngine
INFO: Failed to detect whether we are running on Google Compute Engine.
ERROR StatusLogger No Log4j 2 configuration file found. Using default configuration (logging only errors to the console), or user programmatically provided configurations. Set system property 'log4j2.debug' to show Log4j 2 internal initialization logging. See https://logging.apache.org/log4j/2.x/manual/configuration.html for instructions on how to configure Log4j 2
2020-01-06 16:16:12.453:INFO:oejsh.ContextHandler:main: Started c.g.a.t.d.j.DevAppEngineWebAppContext@3d08f3f5{/,file:///C:/Projects/ApartmentSearching/classes/artifacts/com_group_app/,AVAILABLE}{C:\Projects\ApartmentSearching\classes\artifacts\com_group_app}
2020-01-06 16:16:12.454:INFO:oejs.session:main: DefaultSessionIdManager workerName=node0
2020-01-06 16:16:12.454:INFO:oejs.session:main: node0 Scavenging disabled
2020-01-06 16:16:12.471:INFO:oejs.AbstractConnector:main: Started NetworkTrafficSelectChannelConnector@20398b7c{HTTP/1.1,[http/1.1]}{localhost:8080}
2020-01-06 16:16:12.472:INFO:oejs.Server:main: Started @7636ms
Jan 06, 2020 1:16:12 PM com.google.appengine.tools.development.AbstractModule startup
INFO: Module instance default is running at http://localhost:8080/
Jan 06, 2020 1:16:12 PM com.google.appengine.tools.development.AbstractModule startup
INFO: The admin console is running at http://localhost:8080/_ah/admin
Jan 06, 2020 4:16:12 PM com.google.appengine.tools.development.DevAppServerImpl doStart
INFO: Dev App Server is now running
</code></pre>

<p><strong>Reason</strong></p>

<pre><code>&lt;listener&gt;
    &lt;listener-class&gt;com.group.Bootstrapper&lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

<pre><code>class Bootstrapper : ServletContextListener {
    override fun contextInitialized(sce: ServletContextEvent?) {
        println(""         contextInitialized"")
        ObjectifyService.init()
        ObjectifyService.register(User::class.java)
    }

    override fun contextDestroyed(sce: ServletContextEvent?) {}
}
</code></pre>

<p><strong>How fix it, except deleting this class?</strong></p>
","12657520","","12657520","","2020-01-10 11:56:47","2020-01-10 11:56:47","Why get error 404 if app starts and not get errors to console?","<google-app-engine><kotlin><intellij-idea><ktor>","0","7","","","","59613187","128262","128262","ktor","265","45915935","45915934"
"59663420","1","","","2020-01-09 11:54:08","","0","81","<p>I have a problem, I have already generated OpenApi Swagger files (swagger.json and swagger.yaml) Is it possible somehow in Ktor (kotlin) import this files and start swagger-ui server on specific route ?
I have visited <a href=""https://github.com/nielsfalk/ktor-swagger"" rel=""nofollow noreferrer"">ktor-swagger project</a> but could get how just to add json file to display swagger-ui.
Any suggestions ?   </p>
","5687795","","","","","2020-01-09 11:54:08","Swagger-UI and Ktor how to import swagger.json or .yaml file and start Swagger-UI?","<kotlin><swagger><swagger-ui><ktor><projekktor>","0","0","","","","59663420","128262","128262","ktor","265","45915935","45915934"
"35288406","1","","","2016-02-09 09:36:05","","1","93","<p>I'm using the Ektorp framework as Java ""ORM"" for CouchDB. It's using Jackson for (de)serialization of the JSON documents.</p>

<p>I have the following hierarchy:</p>

<pre><code>public class Animal extends CouchDbDocument {
    private int numberOfLegs;
    // Getters and setters ...
}

public class Dog extends Animal {
    private String name;
    // Getters and setters
}
</code></pre>

<p>I have saved 3 <code>Animal</code>s and 1 <code>Dog</code> to my CouchDB.</p>

<p>When executing <code>List&lt;Dog&gt; dogs = dogRepository.getAll()</code>, I get a collection with 4 objects (at 3 of them <code>name</code> is <code>NULL</code>). This is because Jackson/Ektorp seems to not handle inheritance by default.</p>

<p>So how can I handle inheritance? I would expect not getting 4 objects but only the 1 (<code>Dog</code>).</p>

<p><strong>Update</strong>
I just tried to remove the inheritance. The problem persists. So it seems Ektorp/Jackson aren't able to detect the class type.</p>
","2081129","","2081129","","2016-02-09 09:49:37","2016-02-10 06:56:32","How to handle inheritance?","<java><json><jackson><couchdb><ektorp>","2","0","","","","35288406","73833","73833","ektorp","71","7739352","7739351"
"35349730","1","","","2016-02-11 20:48:08","","1","42","<p>I am having trouble with org.ektorp.DocumentNotFoundException in a multi-tiered application (EJB container). </p>

<p>DocumentNotFoundException does declare a serialVersionUID, but contains a private member of class JsonNode, which in my case has the implementation class of com.fasterxml.jackson.databind.node.ObjectNode. Neither JsonNode nor ObjectNode implement Serializable, so when I try to pass a DocumentNotFoundException over the wire to a client, I get a NotSerializableException. The original exception is never seen by the client.</p>

<p>Is DocumentNotFoundException breaking the rules of java.io.Serializable (inherited from java.lang.Throwable)?</p>

<p>Is there a workaround other than catching DocumentNotFoundException everywhere possible and throwing a different Exception class that is fully Serializable? </p>
","2917389","","","","","2016-02-11 20:48:08","org.ektorp.DocumentNotFoundException breaks java.io.Serializable?","<java><jackson><couchdb><ektorp>","0","0","1","","","35349730","73833","73833","ektorp","71","7739352","7739351"
"35944929","1","35947579","","2016-03-11 16:12:46","","1","303","<p>I am a newbee to Couch and I found lazy-fetching interesting. So I was trying that out but probably due to something wrong I did, it doesn't work and I can't figure out what is wrong. I referred <a href=""http://ektorp.org/reference_documentation.html#d100e394"" rel=""nofollow"">http://ektorp.org/reference_documentation.html#d100e394</a>. I get the error below. (I am able to read the docs separately but not by document referencing). Any help would be much appreciated. I'm using ektorp version 1.4.1.</p>

<pre><code>09:51:03.581 [main] DEBUG org.ektorp.impl.StdCouchDbConnector - Querying CouchDb view at /employee/_design/Employee/_view/ektorp_docrefs_addresses?startkey=%5B%22222%22%2C%22addresses%22%5D&amp;endkey=%5B%22222%22%2C%22addresses%22%2C%7B%7D%5D&amp;include_docs=true.
Exception in thread ""main"" org.ektorp.DocumentNotFoundException: nothing found on db path: /employee/_design/Employee/_view/ektorp_docrefs_addresses?startkey=%5B%22222%22%2C%22addresses%22%5D&amp;endkey=%5B%22222%22%2C%22addresses%22%2C%7B%7D%5D&amp;include_docs=true, Response body: {""error"":""not_found"",""reason"":""missing""}
    at org.ektorp.http.StdResponseHandler.createDbAccessException(StdResponseHandler.java:40)
    at org.ektorp.http.StdResponseHandler.error(StdResponseHandler.java:68)
    at org.ektorp.http.RestTemplate.handleResponse(RestTemplate.java:110)
    at org.ektorp.http.RestTemplate.getUncached(RestTemplate.java:27)
    at org.ektorp.impl.StdCouchDbConnector.executeQuery(StdCouchDbConnector.java:431)
    at org.ektorp.impl.StdCouchDbConnector.queryView(StdCouchDbConnector.java:423)
    at org.ektorp.impl.docref.ViewBasedCollection.loadSetResult(ViewBasedCollection.java:69)
    at org.ektorp.impl.docref.ViewBasedCollection.loadFromBackReferences(ViewBasedCollection.java:50)
    at org.ektorp.impl.docref.ViewBasedCollection.initialize(ViewBasedCollection.java:102)
    at 
org.ektorp.impl.docref.LazyLoadingViewBasedCollection.invoke(LazyLoadingViewBasedCollection.java:27)
    at com.sun.proxy.$Proxy13.size(Unknown Source)
    at com.poc.main.Main.main(Main.java:37)
</code></pre>

<p>My test files are below. </p>

<p>Employee doc</p>

<pre><code>{
   ""_id"": ""222"",
   ""_rev"": ""1-32d4d52d4ea11b521b1e366959ce5557"",
   ""name"": ""Mariamma"",
   ""age"": 21
}
</code></pre>

<p>Address doc</p>

<pre><code>{
   ""_id"": ""ad1"",
   ""_rev"": ""2-39f3162e0fc63ed5526adda5ae496291"",
   ""employeeId"": 222,
   ""addressLine1"": ""555 Randolph"",
   ""city"": ""Chicago""
}
</code></pre>

<p>Employee.java</p>

<pre><code>public class Employee extends CouchDbDocument {
  private String name;

  private int age;

  @DocumentReferences(backReference = ""employeeId"", fetch = FetchType.LAZY, cascade=CascadeType.NONE)
  private Set&lt;Address&gt; addresses = new HashSet&lt;Address&gt;();
// getters and setters
}
</code></pre>

<p>Address.java</p>

<pre><code>public class Address extends CouchDbDocument {

  private String employeeId; 

  private String addressLine1;

  private String addressLine2;

  private String city;

  private String State;

  private String zipCode;
// getters and setters
}
</code></pre>

<p>EmployeeDao.java</p>

<pre><code>public class EmployeeDao {

  private final CouchDbConnector db;

  public EmployeeDao() {
    db = getEmployeeDatabaseConnector();
  }

  public CouchDbConnector getEmployeeDatabaseConnector() {
    HttpClient httpClient = new StdHttpClient.Builder().build();
    CouchDbInstance couchDbInstance = new StdCouchDbInstance(httpClient);
    CouchDbConnector connector = new StdCouchDbConnector(""employee"", couchDbInstance);
    connector.createDatabaseIfNotExists();
    return connector;
  }

  public Employee read(String employeeId) {
    return this.db.get(Employee.class, employeeId);
  }
}
</code></pre>

<p>Main.java</p>

<pre><code>public class Main {

  public static void main(String[] args) {
    EmployeeDao dao = new EmployeeDao();
    Employee employee = dao.read(""222"");
    System.out.println(employee.getName());
    System.out.println(employee.getAddresses().size()); // this line throws error.
  }

}
</code></pre>
","6050145","","","","","2016-03-15 15:42:35","Ektorp - @DocumentReference not working","<couchdb><ektorp>","1","0","0","","","35944929","73833","73833","ektorp","71","7739352","7739351"
"36008902","1","36015101","","2016-03-15 10:40:22","","2","207","<p>what I am trying to do is updating a document, which has this pattern:</p>

<p><div class=""snippet"" data-lang=""js"" data-hide=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-html lang-html prettyprint-override""><code>{
    ""_id"":""myObjectId"",
    ""_rev"":""4-cf19d80a7315bb7fc72882839d7eccb9"",
    ""properties"":
	{
	 ""1b5f313d044f7cd4d46f62c96e8e26d68"":""9f5afece4144ab5676375335150a9776"",
         ""2f127235e8302fb6fdcbec41f05a059cf"":""2190e8ce6a07bd025ea150187a47e11af"",
         ""99927ee3855e87d44c05f1bc881a3726"":""359f664a4e43d5dde05a7f7ff41551b7a"",
         {And so on, that's not the point}
	}
	,
    ""projects"":[
	  { ""_id"":""project_0"",""name"":""1704e5cafc16e18af2076dc7b640fc9cc"" }
	  ,
	  { ""_id"":""project_1"",""name"":""2a69038d0133688518aadf02affe746c3"" }
	  ,
	  { ""_id"":""project_2"",""name"":""228854981f9c5d37439b2736cb952444c"" }
      , {And so on ...}
  ]
}</code></pre>
</div>
</div>
</p>

<p>What I am trying to achieve is removing or adding one ""project"" from this document. I tried using the <a href=""http://www.lightcouch.org/"" rel=""nofollow"">LightCouch</a> Java API and <a href=""https://github.com/helun/Ektorp"" rel=""nofollow"">Ektorp</a>, but both do not provide ways to do so (which is understandable).</p>

<p>So far, the only way I found was fetching a document, getting it's content, removing manually the array and updating this document. And it is not working very well, to be honest. The problem is, as I get my document as a String, I have trouble inserting my changes into it (e.g removing a project) and updating it (the most troublesome part is updating to me).</p>

<p>So I have two questions:
- Are there ways to doing it more simply ?
- How can I remove/add an item from a Json array and updating my document ?</p>

<p>I am new to those technologies and am trying to work my way around, but I think I have problems understanding Serialization / Deserialization concepts while working with those Java APIs.</p>

<p>Thank you, in advance.</p>
","5899172","","","","","2016-03-15 15:10:47","Removing an item from an array in CouchDB","<java><arrays><json><couchdb><ektorp>","1","0","","","","36008902","73833","73833","ektorp","71","7739352","7739351"
"59697266","1","","","2020-01-11 18:13:38","","1","93","<p>I'm trying to connect to IMAP server with Ktor raw sockets</p>

<pre><code>@KtorExperimentalAPI
    override suspend fun start(host: SocketAddress) {
        socket = aSocket(ActorSelectorManager(Dispatchers.IO)).tcp().connect(host).tls(Dispatchers.IO)
        writeChannel = socket.openWriteChannel()
        readChannel = socket.openReadChannel()
        val handshakeResponse = ByteArray(readChannel.availableForRead)
        readChannel.readAvailable(handshakeResponse)
        val handshake = String(handshakeResponse)
        println(handshake)
    } 
</code></pre>

<p>After this connection I excpect that I'll get IMAP server response like this</p>

<pre><code>* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE  SPECIAL-USE LITERAL+ AUTH=PLAIN AUTH=LOGIN] Dovecot ready.
</code></pre>

<p>And then I send IMAP commands to login to my mailbox</p>

<pre><code>  @KtorExperimentalAPI
    override suspend fun command(command: String): String {
        writeChannel.write(""$command\r\n"".also { print(it) })
        val response = ByteArray(readChannel.availableForRead)
        readChannel.readAvailable(response)
        val responseString = String(response)
        println(responseString)
        return responseString
    }
</code></pre>

<p>So my output should be like this</p>

<pre><code> * OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE  SPECIAL-USE LITERAL+ AUTH=PLAIN AUTH=LOGIN] Dovecot ready.
S1 LOGIN email pass
S1 OK Logged in
</code></pre>

<p>But for some reason, the output looks like these commands are executed in parallel threads</p>

<pre><code>S1 LOGIN email pass
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE  SPECIAL-USE LITERAL+ AUTH=PLAIN AUTH=LOGIN] Dovecot ready.
</code></pre>

<p>And my coroutine is blocked at write/read channels because Ktor use randezvous channels and I can't write to channel until I read output</p>

<p>My main code looks like this</p>

<pre><code> fun run() {
        val store = IMAPStore()
        runBlocking(coroutineContext) {
                //connect with tls (suspend function)
                store.install()
                //send login command (suspend function)
                store.login()
        }
    }
</code></pre>

<p>I probably don’t quite understand how the connection through tls works and how the channels work. Maybe I'm starting coroutines wrong. </p>

<p>In this sample code the same logic works perfectly</p>

<pre><code>fun main() {
    runBlocking {
        val socket =
            aSocket(ActorSelectorManager(Dispatchers.IO)).tcp().connect(host)
                .tls(Dispatchers.IO)
        val w = socket.openWriteChannel(autoFlush = false)
        val r = socket.openReadChannel()
        r.readUTF8LineTo(System.out)
        w.write(""$TAG${tagCounter++} LOGIN email password\r\n"")
        r.readUTF8LineTo(System.out)
    }
</code></pre>

<p>Can someone understand and explain this behavior?</p>
","5624767","","","","","2020-01-13 20:22:22","Ktor raw sockets read channel read nothing right after connection established","<sockets><kotlin><kotlin-coroutines><ktor>","0","0","","","","59697266","128262","128262","ktor","265","45915935","45915934"
"59726744","1","59727211","","2020-01-14 02:29:50","","1","232","<p>I am trying out Kotlin multi-platform and trying to setup all my dependencies for it. Starting with <code>commonMain</code></p>

<p>I am trying to add <code>Koin</code> and <code>Ktor</code> dependencies to the common portion but I cant seem to be able to use any of them.</p>

<p>This is my Gradle script</p>

<pre><code>plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.61'
}
repositories {
    google()
    jcenter()
    mavenCentral()
}
apply plugin: 'com.android.application'
apply plugin: 'kotlin-android-extensions'

android {
    compileSdkVersion 29
    defaultConfig {
        applicationId 'org.jetbrains.kotlin.mpp_app_android'
        minSdkVersion 15
        targetSdkVersion 29
        versionCode 1
        versionName '1.0'
        testInstrumentationRunner 'android.support.test.runner.AndroidJUnitRunner'
    }
    buildTypes {
        release {
            minifyEnabled false
        }
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'org.koin:koin-android:2.0.1'
    implementation 'org.koin:koin-androidx-viewmodel:2.0.1'
    implementation 'androidx.lifecycle:lifecycle-viewmodel:2.1.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.0.0-beta4'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
}

kotlin {
    android(""android"")
    // This is for iPhone emulator
    // Switch here to iosArm64 (or iosArm32) to build library for iPhone device
    iosX64(""ios"") {
        binaries {
            framework()
        }
    }
    sourceSets {
        commonMain {
            dependencies {
                implementation kotlin('stdlib-common')
                implementation 'org.koin:koin-ktor:2.0.1'
                implementation 'org.koin:koin-core:2.0.1'

                // HTTP
                implementation ""io.ktor:ktor-client-core:1.2.6""
                implementation ""io.ktor:ktor-client-json:1.2.6""
                implementation ""io.ktor:ktor-client-serialization:1.2.6""

                // Coroutines
                implementation ""org.jetbrains.kotlinx:kotlinx-coroutines-core-common:1.2.1""
            }
        }
        commonTest {
            dependencies {
                implementation kotlin('test-common')
                implementation kotlin('test-annotations-common')
            }
        }
        androidMain {
            dependencies {
                implementation kotlin('stdlib')
            }
        }
        androidTest {
            dependencies {
                implementation kotlin('test')
                implementation kotlin('test-junit')
            }
        }
        iosMain {
        }
        iosTest {
        }
    }
}

// This task attaches native framework built from ios module to Xcode project
// (see iosApp directory). Don't run this task directly,
// Xcode runs this task itself during its build process.
// Before opening the project from iosApp directory in Xcode,
// make sure all Gradle infrastructure exists (gradle.wrapper, gradlew).
task copyFramework {
    def buildType = project.findProperty('kotlin.build.type') ?: 'DEBUG'
    def target = project.findProperty('kotlin.target') ?: 'ios'
    dependsOn kotlin.targets.""$target"".binaries.getFramework(buildType).linkTask

    doLast {
        def srcFile = kotlin.targets.""$target"".binaries.getFramework(buildType).outputFile
        def targetDir = getProperty('configuration.build.dir')
        copy {
            from srcFile.parent
            into targetDir
            include 'app.framework/**'
            include 'app.framework.dSYM'
        }
    }
}
</code></pre>

<p>In the <code>Sample.kt</code> file that was generated when I created the project I tried to setup <code>Koin</code> in the <code>main</code> method</p>

<pre><code>fun main() {
    startKoin {
        // declare modules
        modules(myModule)
    }
    println(hello())
}
</code></pre>

<p>but <code>startKoin</code> cannot be resolved.</p>

<p>I cleaned/rebuilt the project, did a gradle sync and still cant import koin or any other dependency so what am I missing</p>
","599346","","2224047","","2020-01-14 08:38:43","2020-01-14 08:38:43","Can't import dependencies for Kotlin multi platform common","<kotlin><ktor><kotlin-multiplatform><koin>","1","0","","","","59726744","128262","128262","ktor","265","45915935","45915934"
"59734963","1","","","2020-01-14 13:41:02","","0","68","<p>I'm trying to access the Youtube api using rest. To that I need an apikey(I have that) and access token. The token can only be retrieved from google using Oauth2. The Oauth2 part is proving to be a problem for me.<br>
I have a link to the github account. I have tried 2 different approaches, 1 on the master branch and the other on a branch called alternative. Link: <a href=""https://bitbucket.org/mobileapparchitect/simplektor/src/master/"" rel=""nofollow noreferrer"">https://bitbucket.org/mobileapparchitect/simplektor/src/master/</a></p>

<p>I have been following this documentation from Ktor <a href=""https://ktor.io/quickstart/guides/oauth.html"" rel=""nofollow noreferrer"">https://ktor.io/quickstart/guides/oauth.html</a>
and 
<a href=""https://developers.google.com/youtube/v3/guides/auth/server-side-web-apps"" rel=""nofollow noreferrer"">https://developers.google.com/youtube/v3/guides/auth/server-side-web-apps</a></p>

<p>but been getting this error </p>

<p>Exception in thread ""DefaultDispatcher-worker-1"" io.ktor.client.features.ClientRequestException: Client request(<a href=""https://www.googleapis.com:443/oauth2/v3/token"" rel=""nofollow noreferrer"">https://www.googleapis.com:443/oauth2/v3/token</a>) invalid: 400 Bad Request
at io.ktor.client.features.DefaultResponseValidationKt$addDefaultResponseValidation$1$1.invokeSuspend(DefaultResponseValidation.kt:34)</p>

<p>Any pointers will be appreciated. Thanks</p>
","12552670","","","","","2020-01-14 13:41:02","Oauth2 with Ktor","<oauth-2.0><google-oauth><youtube-data-api><ktor>","0","0","","","","59734963","128262","128262","ktor","265","45915935","45915934"
"59795546","1","59851614","","2020-01-17 22:17:07","","0","165","<p>I have a simple <code>Spring Boot WebFlux</code> api and I am trying to use <code>Ktor</code> to call it. </p>

<p>Here is my controller</p>

<pre><code>@RestController
@RequestMapping(""api/v1"")
class TestController {

    @RequestMapping(method = [RequestMethod.GET], value = [""/values""], produces = [MediaType.TEXT_EVENT_STREAM_VALUE])
    fun sayHello(@RequestParam(value = ""name"") name:String): Flux&lt;Example&gt; {
        return Flux.interval(Duration.ofSeconds(1))
            .map { Example(number = generateNumber()) }
            .share()
    }

    fun generateNumber(): Int{
        return ThreadLocalRandom.current().nextInt(100)
    }
}
</code></pre>

<p>It just returns an object with a number every second</p>

<p>Now on the client side is where I want to use Ktor to get the data but I am unsure what to do. Reading the docs it looks like <a href=""https://ktor.io/clients/http-client/quick-start/streaming.html"" rel=""nofollow noreferrer"">Scoped streaming</a> is what I need but I am not sure how to get it to work with my controller</p>

<p>Here is the client code I have so far.</p>

<pre><code>suspend fun getData(): Flow&lt;Example&gt; {
        return flow {
            val client = HttpClient()
            client.get&lt;HttpStatement&gt;(""http://192.168.7.24:8080/api/v1/values?name=hello"").execute{
        val example = it.receive&lt;Example&gt;()
        emit(example)
    }
        }
    }
</code></pre>

<p>When I try to make the call on the <code>Android</code> client I get this error</p>

<blockquote>
  <p>NoTransformationFoundException: No transformation found: class
  io.ktor.utils.io.ByteBufferChannel (Kotlin reflection is not
  available)</p>
</blockquote>

<p>So it looks like I cant just serialize the stream into my object so how do I serialize <code>ByteReadChannel</code> to an object?</p>

<p>This is my first time trying out spring and ktor</p>
","599346","","599346","","2020-01-22 00:04:43","2020-01-22 01:58:01","Ktor with Spring boot WebFlux web api","<android><spring-boot><kotlin><ktor>","1","0","","","","59795546","128262","128262","ktor","265","45915935","45915934"
"59858543","1","","","2020-01-22 11:19:28","","0","34","<p>I´m trying to upload a csv-file in a ktor-application and I used the multipart example from the ktor documentation.
My problem is, I don´t see how I can call/read that file in my programm to be able to use the CSVReaderBuilder() on it. My goal is to declare a variable, save the file in it and then use it to read the content of it.
My snip code is there and if there are more specification needed, I will gladly adjust it.
Thanks You</p>

<pre><code>val multipart = call.receiveMultipart()
            multipart.forEachPart { part -&gt;
                when (part) {
                    // if part is a file (could be form item/text)
                    is PartData.FileItem -&gt; {
                        // retrieve file name of upload
                        val ext = File(part.originalFileName).extension
                        val file = File(""resources/myFile.csv"")
                        part.streamProvider().use { its -&gt;
                            // copy the stream to the file with buffering
                            file.outputStream().buffered().use {
                                // note that this is blocking
                                its.copyTo(it)
                            }
                        }
                    }
                }
                // make sure to dispose of the part after use to prevent leaks
                part.dispose()
            }

            // Remove the .withCSVParser part if you use the default separator instead of "";""
            // This is where i want to put the uploaded File and not the path of the file
            val csvReader = CSVReaderBuilder(File(""resources/myFile.csv"").reader(Charsets.UTF_8))
                .withCSVParser(CSVParserBuilder().withSeparator(';').build())
                .build()
</code></pre>
","12761024","","7554868","","2020-01-22 11:36:53","2020-01-22 11:36:53","Upload a file and access/read it - Ktor","<spring><ktor>","0","0","","","","59858543","128262","128262","ktor","265","45915935","45915934"
"59865901","1","59867177","","2020-01-22 18:12:42","","0","32","<p>I'm currently learning kotlin and have came into the following scenario. In <code>Ktor</code> server there's a method with the following signature:</p>

<pre><code>fun Route.webSocket(protocol: String? = null, handler: suspend DefaultWebSocketServerSession.() -&gt; Unit) {
    webSocketRaw(protocol) {
        proceedWebSocket(handler)
    }
}
</code></pre>

<p>where I'm supposed to interact with it somehow like this:</p>

<pre><code>embeddedServer(Netty, 8080) {
        install(Routing) {
            webSocket(""/ws"") {
                // Handle websocket connection here
            }
        }
}
</code></pre>

<p>Meaning websocket accepts labda that's an extension method of <code>DefaultWebSocketServerSession</code> and has it's context. I would like to convert this lambda into a handler so I can pass it from somewhere else, I imagine it should look something like that:</p>

<pre><code>embeddedServer(Netty, 8080) {
        install(Routing) {
            webSocket(""/ws"", myHandler::handle)
        }
}

//...
fun suspend handle(context: DefaultWebSocketServerSession): Unit {
    // Handle websocket connection here
}
</code></pre>

<p>So, my question is how do I convert <code>suspend DefaultWebSocketServerSession.() -&gt; Unit</code> to<code>(DefaultWebSocketServerSession) -&gt; Unit</code>, or how do I Implement a handler with <code>suspend DefaultWebSocketServerSession.() -&gt; Unit</code> signature so I can pass it from the outside?</p>

<p><strong>PS</strong></p>

<p>I know I could do this</p>

<pre><code>embeddedServer(Netty, 8080) {
        install(Routing) {
            webSocket(""/ws"") {
                myHandler.handle(this)
            }
        }
}
</code></pre>

<p>But that doesn't feel elegant</p>
","1188047","","","","","2020-01-22 19:41:29","Pass lambda as extension method","<kotlin><lambda><extension-methods><ktor>","1","1","","","","59865901","128262","128262","ktor","265","45915935","45915934"
"59917431","1","59918704","","2020-01-26 10:26:30","","1","75","<p>I develop app on GAE using Kotlin, Ktor. Database is CloudSQL. For connect to it use Exposed library</p>

<pre><code>Database.connect(
            ""jdbc:postgresql://cloudsql/&lt;project-id&gt;:&lt;zone-name&gt;:&lt;instance-name&gt;"",
            driver=""org.postgresql.Driver"",
            user=""postgres"",
            password=""********""
        )
</code></pre>

<p>But I get error:</p>

<blockquote>
  <p>org.postgresql.core.v3.ConnectionFactoryImpl log: IOException occurred while connecting to cloudsql:5432 (ConnectionFactoryImpl.java:317)
  java.net.UnknownHostException: cloudsql</p>
  
  <p>.......</p>
</blockquote>

<p>I try change url on:</p>

<pre><code>    jdbc:postgresql://google/&lt;project-id&gt;:&lt;zone-name&gt;:&lt;instance-name&gt;
    jdbc:postgresql://cloudsql/&lt;project-id&gt;:&lt;zone-name&gt;:&lt;instance-name&gt;/.s.PGSQL.5432

</code></pre>

<p>But also can this error.</p>

<p>Error is geted both on local and server</p>
","12657520","","12657520","","2020-01-27 18:32:49","2020-01-27 18:32:49","How connect tot Google Cloud SQL via Exposed","<google-cloud-sql><ktor><kotlin-exposed>","1","0","","","","59917431","128262","128262","ktor","265","45915935","45915934"
"59934686","1","","","2020-01-27 16:00:05","","0","44","<p>I am using <strong>Authentication/jwt</strong> feature in <strong>KTOR</strong> app for authentication.</p>

<p>I would like to unit test JWT expiration time.
I need to manipulate current time that is used by JWT validate/verify method.</p>

<p>How to do that?
Currently I am using short expiration time and delay method in my test, however this is not always working way.</p>
","1392400","","","","","2020-01-27 16:00:05","KTOR JWT Auth - manipulate current time","<jwt><jwt-auth><ktor>","0","1","","","","59934686","128262","128262","ktor","265","45915935","45915934"
"59950147","1","59956786","","2020-01-28 13:42:31","","0","91","<p>I'm creating a abstraction for consumer and producer Kafka, to avoid duplicate code all the time. So i created a lib using kotlin and gradle, named ""kafka-commons"", and put the following code:
For Kafka producer: </p>

<pre><code>fun producer(
    bootstrapServers: String,
    idempotence: Boolean,
    acks: Acks,
    retries: Int,
    requestPerConnection: Int,
    compression: Compression,
    linger: Int,
    batchSize: BatchSize
): KafkaProducer&lt;String, Any&gt; {
    val prop: HashMap&lt;String, Any&gt; = HashMap()
    prop[BOOTSTRAP_SERVERS_CONFIG] = bootstrapServers
    prop[KEY_SERIALIZER_CLASS_CONFIG] = StringSerializer::class.java.name
    prop[VALUE_SERIALIZER_CLASS_CONFIG] = StringSerializer::class.java.name
    prop[ENABLE_IDEMPOTENCE_CONFIG] = idempotence
    prop[ACKS_CONFIG] = acks.value
    prop[RETRIES_CONFIG] = retries
    prop[MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION] = requestPerConnection
    prop[COMPRESSION_TYPE_CONFIG] = compression.value
    prop[LINGER_MS_CONFIG] = linger
    prop[BATCH_SIZE_CONFIG] = batchSize.value

    return KafkaProducer(prop)
}

suspend inline fun &lt;reified K : Any, reified V : Any&gt; KafkaProducer&lt;K, V&gt;.dispatch(record: ProducerRecord&lt;K, V&gt;) =
    suspendCoroutine&lt;RecordMetadata&gt; { continuation -&gt;
        val callback = Callback { metadata, exception -&gt;
            if (metadata == null) {
                continuation.resumeWithException(exception!!)
            } else {
                continuation.resume(metadata)
            }
        }
        this.send(record, callback)
    }
</code></pre>

<p>So, i created a default Command object with the following structure</p>

<pre><code>data class Command(
    val id: UUID,
    val status: CommandStatus,
    val message: Any
)
</code></pre>

<p>id: create a unique ID
status: crete a message status (can be: Open /Processing / Closed / Error)
message: an object from http reques (for example: If have an Post</p>

<p>For example: if have a ""insert user: POST"" with body :</p>

<blockquote>
  <p>{   ""id"": 1,   ""name"" : ""John"",   ""lastName"" : ""Wick"" }</p>
</blockquote>

<p>so message will be this object, and so on.</p>

<p>And for create this command, i made this function:</p>

<pre><code>suspend fun creatCommand(
    topicName: String,
    id: UUID,
    commandStatus: CommandStatus,
    request: Any,
    bootstrapServers: String,
    idempotence: Boolean,
    acks: Acks,
    retries: Int,
    requestPerConnection: Int,
    compression: Compression,
    linger: Int,
    batchSize: BatchSize
): Unit {
    val producer = producer(
        bootstrapServers,
        idempotence,
        acks,
        retries,
        requestPerConnection,
        compression,
        linger,
        batchSize)

    val command = toCommand(processStarted(id, commandStatus, request))
    val record = ProducerRecord&lt;String, Any&gt;(topicName, id.toString(), command)
    coroutineScope { launch { producer.dispatch(record) } }
}
</code></pre>

<p>So, I created other APIs and just call this function to create a producer that sends a command to kafka. Like: </p>

<pre><code>fun Route.user(service: Service) =
    route(""/api/access"") {
        post(""/test"") {
            call.respond(service.command(call.receive())) 
            }
}

&gt;&gt;&gt;&gt;&gt;&gt; other class &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

classService () {
    fun command( all parameters) { creatCommand(all parameters)} 
}
</code></pre>

<p>Sor far so good. All works great. </p>

<p>Now my problemas begin. I'm trying to create a consumer. 
First i made this: </p>

<pre><code>fun consumer(
    bootstrapServers: String,
    group: String,
    autoCommit: Boolean,
    offsetBehaviour: OffsetBehaviour,
    pollMax: Int
): KafkaConsumer&lt;String, Any&gt; {
    val prop: HashMap&lt;String, Any&gt; = HashMap()
    prop[BOOTSTRAP_SERVERS_CONFIG] = bootstrapServers
    prop[KEY_DESERIALIZER_CLASS_CONFIG] = StringDeserializer::class.java.name
    prop[VALUE_DESERIALIZER_CLASS_CONFIG] = StringDeserializer::class.java.name
    prop[GROUP_ID_CONFIG] = group
    prop[AUTO_OFFSET_RESET_CONFIG] = offsetBehaviour
    prop[ENABLE_AUTO_COMMIT_CONFIG] = autoCommit
    prop[MAX_POLL_RECORDS_CONFIG] = pollMax

    return KafkaConsumer(prop)
}
</code></pre>

<p>And after:</p>

<pre><code>fun&lt;T&gt; recordingCommand(
    command: Class&lt;T&gt;,
    topic: String,
    bootstrapServers: String,
    group: String,
    autoCommit: Boolean,
    offsetBehaviour: OffsetBehaviour,
    pollMax: Int
) {
    val consumer = consumer(bootstrapServers, group, autoCommit, offsetBehaviour, pollMax)
    consumer.subscribe(mutableListOf(topic))
    while (true) {
        val records = consumer.poll(Duration.ofMillis(100))
        for (record in records) {
            val om = ObjectMaper
            om.readvalue(record.value(), command::class.java)

            &gt;&gt;&gt;&gt; I GOT LOST HERE &lt;&lt;&lt;&lt;&lt;&lt;

        }
    }
}
</code></pre>

<p>What i need: creating a abstract consumer that record all data inside a Command.message() (only the message) in a database.</p>

<p>For example, i need to record the user above (id 1, john wick ) into a postgresql database.
So if i had a service with insert method, i can call it, passing insertmethod like:</p>

<pre><code>service.insert(recordingCommand(all parameters)).
</code></pre>

<p>Anyone can help me with that?</p>
","9910654","","9910654","","2020-01-28 13:52:59","2020-01-28 20:47:26","Make na abstraction to kafka consumer using ktor and kotlin","<kotlin><apache-kafka><ktor>","1","0","","","","59950147","128262","128262","ktor","265","45915935","45915934"
"60005195","1","","","2020-01-31 13:49:17","","1","99","<p>I'm using Ktor and Kotlin/native in iOS in an iOS app that accesses an internal dev server. The dev server uses a certificate issued by an internal CA which is not publicly trusted. </p>

<p>When trying to access the server with the following code :</p>

<pre><code>  internal suspend fun performHttp(url : String)
    {
        // URL is a self signed HTTPS: request
        val client = HttpClient(Ios) 

        val response = client.get&lt;String&gt;(url)
        println(response)
    }
</code></pre>

<p>it throws the following exception :</p>

<pre><code>TIC SSL Trust Error [32:0x281956dc0]: 3:0
esri2[470:136341] NSURLSession/NSURLConnection HTTP load failed (kCFStreamErrorDomainSSL, -9807)
esri2[470:136341] Task &lt;F3CC4C40-0231-4E58-97F3-F457D5A18BB0&gt;.&lt;1&gt; HTTP load failed (error code: -1202 [3:-9807])
 esri2[470:136417] Task &lt;F3CC4C40-0231-4E58-97F3-F457D5A18BB0&gt;.&lt;1&gt; finished with error - code: -1202
esri2[470:136211] Task &lt;F3CC4C40-0231-4E58-97F3-F457D5A18BB0&gt;.&lt;1&gt; load failed with error Error Domain=NSURLErrorDomain Code=-1202 ""The certificate for this server is invalid. You might be connecting to a server that is pretending to be “server1.internal.lan” which could put your confidential information at risk."" UserInfo={NSLocalizedRecoverySuggestion=Would you like to connect to the server anyway?, _kCFStreamErrorDomainKey=3, NSErrorPeerCertificateChainKey=(
    ""&lt;cert(0x12b094e00) s: server1.internal.lan i: Internal-Issuing-CA2&gt;"",
</code></pre>

<p>How do I convince Ktor that it should access this URL, or ignore untrusted certs? Yes, I know that one should not ignore untrusted certs, but this is a lab test.</p>
","8819392","","7271020","","2020-01-31 15:54:55","2020-01-31 15:54:55","Ktor client IOS and self-signed certificate","<ios><ssl><ktor><kotlin-native>","0","4","","","","60005195","128262","128262","ktor","265","45915935","45915934"
"60017168","1","60315546","","2020-02-01 13:10:07","","0","46","<p>I am trying to learn to use ktor and I'm trying to display the text ""Hello Ktor"" at the root path but all I keep getting is this site can't be reached.
This is my code:</p>

<pre><code>import io.ktor.application.*
import io.ktor.http.ContentType
import io.ktor.response.respondText
import io.ktor.routing.get
import io.ktor.routing.routing

fun main(args: Array&lt;String&gt;): Unit = io.ktor.server.netty.EngineMain.main(args)

private val userData = ""{\""users\"": [\""Timi\"", \""Tomi\"", \""Temi\""]}""

@Suppress(""unused"") // Referenced in application.conf
@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {

    routing {
        get(""/"") {
            call.respondText(""Hello Ktor"", ContentType.Text.Plain)
        }

    }
}

</code></pre>

<p>What am I doing wrong?</p>
","11724265","","","","","2020-02-20 08:19:40","Ktor application not running on my computer","<kotlin><server><ktor>","2","2","","","","60017168","128262","128262","ktor","265","45915935","45915934"
"60025577","1","","","2020-02-02 11:21:50","","1","64","<p>I'm struggling to write tests for an endpoint that is under auth (token). In particular, when writing my test, I'm not able to chain the login request with my second request, despite providing the token received as part of the login request.</p>

<p><em>LoginEndpoint.kt</em></p>

<pre><code>const val LOGIN_ENDPOINT = ""$API_VERSION/login""

@Location(LOGIN_ENDPOINT)
class Login

fun Route.loginEndpoint(patientsRepository: Repository&lt;Patient&gt;, authProvider: AuthProvider) {
    post&lt;Login&gt; {
        val params = call.receive&lt;Parameters&gt;()
        val userId = params[""id""] ?: return@post call.respond(status = HttpStatusCode.BadRequest, message = ""Missing user id"")

        val user = patientsRepository.get(userId)
        if (user != null) {
            val token = authProvider.generateToken(user.id!!)
            call.respond(TextContent(""{ \""token\"": \""$token\"" }"", ContentType.Application.Json))
        } else {
            call.respond(status = HttpStatusCode.NotFound, message = ""User with id $userId does not exist"")
        }
    }
}
</code></pre>

<p><em>LoginEndpointTest.kt</em> (passing, all good)</p>

<pre><code>    @Test
    fun `given user exists then returns 200 and token`() {
        val userId = ""paco123""
        val token = ""magic_token_123""
        withTestApplication({
            givenTestModule()
        }) {
            every { authProvider.generateToken(userId) } answers { token }
            givenPatientExists(userId)
            with(handleRequest(HttpMethod.Post, ""/$API_VERSION/login"") {
                addHeader(""content-type"", ""application/x-www-form-urlencoded"")
                setBody(""id=$userId"")
            }) {
                assertEquals(HttpStatusCode.OK, response.status())
                assertEquals(""{ \""token\"": \""magic_token_123\"" }"", response.content)
            }
        }
    }

    private fun Application.givenTestModule() {
        module(
            testing = true,
            repositoryModule = TestingRepositoryModule,
            authProvider = authProvider
        )
    }
</code></pre>

<p>Now, the problematic endpoint. </p>

<p><em>ProfileEndpoint.kt</em></p>

<pre><code>const val PATIENTS_API_ENDPOINT = ""$API_VERSION/profile""

@Location(PATIENTS_API_ENDPOINT)
class ProfileEndpoint

fun Route.profileEndpoint(patientsRepository: Repository&lt;Patient&gt;) {
    authenticate(""jwt"") {
        get&lt;ProfileEndpoint&gt; {
            val apiUser: Patient = call.apiUser!!
            val id = apiUser.id!!
            val patient = patientsRepository.get(id)
            when (patient != null) {
                false -&gt; call.respond(status = HttpStatusCode.NotFound, message = ""Patient with id $id does not exist"")
                true -&gt; call.respond(status = HttpStatusCode.OK, message = patient.map())
            }
        }
    }
}
</code></pre>

<p>Finally, my failing test</p>

<p><em>ProfileEndpointTest.kt</em></p>

<pre><code>    @Test
    fun `given user is logged in then returns 200 and profile`() {
        val userId = ""paco123""
        val token = ""magic_token_123""
        withTestApplication({
            givenTestModule()
        }) {
            every { authProvider.generateToken(userId) } answers { token }
            givenPatientExists(userId)

            handleRequest(HttpMethod.Post, ""/$API_VERSION/login"") {
                addHeader(""content-type"", ""application/x-www-form-urlencoded"")
                setBody(""id=$userId"")
            }

            handleRequest(HttpMethod.Get, ""/$API_VERSION/profile"") {
                addHeader(""Authorization"", ""Bearer $token"")
            }.apply {
                assertEquals(HttpStatusCode.OK, response.status())
            }
        }
    }
</code></pre>

<p>The error is: </p>

<pre><code>expected:&lt;200 OK&gt; but was:&lt;401 Unauthorized&gt;
Expected :200 OK
Actual   :401 Unauthorized
</code></pre>

<p><em>AuthProvider.kt</em></p>

<pre><code>open class AuthProvider(secret: String = System.getenv(Environment.JWT_SECRET)) {
    private val algorithm = Algorithm.HMAC512(secret)

    fun getVerifier(): JWTVerifier = JWT
        .require(algorithm)
        .withIssuer(APP_NAME)
        .build()

    fun generateToken(userId: String): String = JWT.create()
        .withSubject(SUBJECT)
        .withIssuer(APP_NAME)
        .withClaim(CLAIM, userId)
        .withExpiresAt(expiresAt())
        .sign(algorithm)

    private fun expiresAt() = Date(System.currentTimeMillis() + MILLIES_PER_DAY * TOKEN_DAYS_LENGTH)
}

val ApplicationCall.apiUser get() = authentication.principal&lt;Patient&gt;()
</code></pre>

<p>I've tried using <code>cookiesSession</code> like in this documentation's example <a href=""https://ktor.io/servers/testing.html#preserving-cookies"" rel=""nofollow noreferrer"">https://ktor.io/servers/testing.html#preserving-cookies</a> but it didn't work. Any help would be much appreciated.</p>
","2282433","","","","","2020-02-02 11:21:50","Testing endpoint under auth with Ktor","<kotlin><ktor>","0","0","","","","60025577","128262","128262","ktor","265","45915935","45915934"
"60033320","1","60048155","","2020-02-03 05:00:34","","1","114","<p>I created the following files based on the tutorial here: <a href=""https://ktor.io/quickstart/quickstart/gradle.html"" rel=""nofollow noreferrer"">https://ktor.io/quickstart/quickstart/gradle.html</a></p>

<p>This is my kotlin file:</p>

<pre><code>package blog

import io.ktor.application.*
import io.ktor.http.*
import io.ktor.response.*
import io.ktor.routing.*
import io.ktor.server.engine.*
import io.ktor.server.netty.*


fun Application.main() {
    install(DefaultHeaders)
    install(CallLogging)
    install(Routing) {
        get(""/"") {
            call.respondText(""My Example Blog2"", ContentType.Text.Html)
        }
    }

}
</code></pre>

<p>and it is the content of my build.gradle file</p>

<pre><code>group 'Example'
buildscript {
    ext.kotlin_version = '1.3.61'
    ext.ktor_version = '1.3.0'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath ""org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version""
    }
}

apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'application'

mainClassName = 'io.ktor.server.netty.EngineMain' 

sourceCompatibility = 1.8
compileKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}
compileTestKotlin {
    kotlinOptions.jvmTarget = ""1.8""
}

kotlin {
    experimental {
        coroutines ""enable""
    }
}

repositories {
    jcenter()
    mavenCentral()
}

dependencies {
    compile ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""
    compile ""io.ktor:ktor-server-netty:$ktor_version""
    compile ""ch.qos.logback:logback-classic:1.2.3""
    testCompile group: 'junit', name: 'junit', version: '4.12'
}
</code></pre>

<p>and application.conf</p>

<pre><code>ktor {
    deployment {
        port = 8080
    }

    application {
        modules = [ blog.BlogAppKt.main ]
    }
}
</code></pre>

<p>All of them live in the same folder.</p>

<p>When I tried to run up the server by this command <code>./gradlew run</code>, I got this error message:</p>

<pre><code>&gt; Task :run FAILED
Exception in thread ""main"" java.lang.IllegalArgumentException: Neither port nor sslPort specified. Use command line options -port/-sslPort or configure connectors in application.conf
        at io.ktor.server.engine.CommandLineKt$commandLineEnvironment$environment$1.invoke(CommandLine.kt:129)
        at io.ktor.server.engine.CommandLineKt$commandLineEnvironment$environment$1.invoke(CommandLine.kt)
        at io.ktor.server.engine.ApplicationEngineEnvironmentBuilder.build(ApplicationEngineEnvironment.kt:105)
        at io.ktor.server.engine.ApplicationEngineEnvironmentKt.applicationEngineEnvironment(ApplicationEngineEnvironment.kt:44)
        at io.ktor.server.engine.CommandLineKt.commandLineEnvironment(CommandLine.kt:57)
        at io.ktor.server.netty.EngineMain.main(EngineMain.kt:21)
</code></pre>

<p>How can I make <code>application.conf</code> visible to the Netty process in this case?</p>
","58129","","58129","","2020-02-03 22:16:01","2020-02-03 22:40:49","How to fix 'Neither port nor sslPort specified' throw by io.ktor.server.engine.CommandLineKt in a gradle/kotlin/netty project?","<gradle><kotlin><ktor>","1","2","","","","60033320","128262","128262","ktor","265","45915935","45915934"
"60136038","1","","","2020-02-09 11:20:51","","1","58","<p>Here's my shadowJar task</p>

<pre><code>shadowJar {
    archiveName ""server.jar""
    mainClassName = ""myapp.ApplicationKt""
    manifest {
        attributes(
                'Class-Path': project.configurations.compile.collect { it.getName() }.join(' ')
        )
    }
    minimize {
//        exclude(dependency('.*:.*:.*'))
    }
    from sourceSets.main.output
}
</code></pre>

<p>Note the commented exclude line removing any dependency from being minimized (effectively disabling shadowJar). When I uncomment this, then the resulting jar works. However, there seems to be some problematic dependency that shadowJar's minimize chops away that is actually loaded at runtime:</p>

<p>Here's the error that I keep getting:</p>

<pre><code>2020-02-09 16:39:01.843 [main] INFO  ktor.application - No ktor.deployment.watch patterns specified, automatic reload is not active
Exception in thread ""main"" java.util.ServiceConfigurationError: org.jetbrains.exposed.sql.DatabaseConnectionAutoRegistration: Provider org.jetbrains.exposed.jdbc.ExposedConnectionImpl not found
</code></pre>

<pre><code>at java.util.ServiceLoader.fail(ServiceLoader.java:239)
        at java.util.ServiceLoader.access$300(ServiceLoader.java:185)
        at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:372)
        at java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)
        at java.util.ServiceLoader$1.next(ServiceLoader.java:480)
        at kotlin.collections.CollectionsKt___CollectionsKt.firstOrNull(_Collections.kt:224)
        at org.jetbrains.exposed.sql.Database.&lt;clinit&gt;(Database.kt:64)
        at myapp.DB.init(DB.kt:23)
        at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.instantiateAndConfigureApplication(ApplicationEngineEnvironmentReloading.kt:293)
        at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.createApplication(ApplicationEngineEnvironmentReloading.kt:137)
        at io.ktor.server.engine.ApplicationEngineEnvironmentReloading.start(ApplicationEngineEnvironmentReloading.kt:257)
        at io.ktor.server.netty.NettyApplicationEngine.start(NettyApplicationEngine.kt:126)
        at myApp.ApplicationKt.main(Application.kt:35)
        at kotlin.coroutines.intrinsics.IntrinsicsKt__IntrinsicsJvmKt$createCoroutineUnintercepted$$inlined$createCoroutineFromSuspendFunction$IntrinsicsKt__IntrinsicsJvmKt$1.invokeSuspend(IntrinsicsJvm.kt:199)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
        at kotlin.coroutines.ContinuationKt.startCoroutine(Continuation.kt:114)
        at kotlin.coroutines.jvm.internal.RunSuspendKt.runSuspend(RunSuspend.kt:19)
</code></pre>

<p>I use Exposed database library with mysql driver. Here's how I'm connecting to exposed database</p>

<pre><code>        Database.connect(
            driver = ""com.mysql.cj.jdbc.Driver"",
</code></pre>

<p>I believe the problem is somewhere around this. It's not able to find the database driver at the runtime.</p>

<p>I've tried the obvious: Excluding exposed, sql, mysql-connector-java dependencies to no avail.</p>
","5925080","","","","","2020-02-09 11:20:51","How to correctly use shadowJar while deploying a Ktor + Exposed backend?","<java><kotlin><jar><ktor><kotlin-exposed>","0","7","1","","","60136038","128262","128262","ktor","265","45915935","45915934"
"60197310","1","","","2020-02-12 21:42:11","","0","34","<p>I'm trying to deploy my project onto Heroku, I followed <a href=""http://sebi.io/general/2018/08/15/Kotlin-on-Heroku.html"" rel=""nofollow noreferrer"">this tutorial</a> and <a href=""https://medium.com/@dariopellegrini/deploy-a-kotlin-server-in-minutes-using-ktor-and-heroku-ed6ed33337f"" rel=""nofollow noreferrer"">this one</a> but none worked for me.</p>

<p>My gradle looks like this: </p>

<pre><code>apply plugin: 'kotlin'
apply plugin: 'application'
apply plugin: 'kotlinx-serialization'

version '0.0.1'
mainClassName = ""io.ktor.server.jetty.EngineMain""

task stage(dependsOn: ['clean', 'installDist'])

repositories {
    mavenLocal()
    jcenter()
    maven { url 'https://kotlin.bintray.com/ktor' }
}

dependencies {
    implementation ""org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version""

    //Log
    implementation ""ch.qos.logback:logback-classic:$logback_version""

    //KTor core
    implementation ""io.ktor:ktor-server-jetty:$ktor_version""
    implementation ""io.ktor:ktor-server-core:$ktor_version""
    implementation ""io.ktor:ktor-client-core:$ktor_version""
...
</code></pre>

<p>I've created the <code>Procfile</code> with <code>web: ./build/install/my-ws/bin/my-ws</code></p>

<p>I've run <code>./gradlew stage</code> in my terminal and it worked fine.</p>

<p>But when I do <code>git push heroku master</code> I still get the error </p>

<pre><code>remote: Building source:
remote: 
remote: -----&gt; Gradle app detected
remote: -----&gt; Installing JDK 1.8... done
remote: -----&gt; Building Gradle app...
remote: -----&gt; executing ./gradlew stage
remote:        Downloading https://services.gradle.org/distributions/gradle-4.10-all.zip
remote:        ...............................................................................................................
remote:        
remote:        FAILURE: Build failed with an exception.
remote:        
remote:        * What went wrong:
remote:        Task 'stage' not found in root project 'my-ws'.
remote:        


</code></pre>
","6074224","","750510","","2020-02-13 12:44:38","2020-02-13 12:44:38","Heroku task stage not found","<kotlin><heroku><ktor>","1","0","","","","60197310","128262","128262","ktor","265","45915935","45915934"
"60233921","1","","","2020-02-14 21:45:23","","1","357","<p>I've created a Ktor application with Gradle and I followed the tutorial on <a href=""https://ktor.io/quickstart/quickstart/gradle.html#initial"" rel=""nofollow noreferrer"">https://ktor.io/quickstart/quickstart/gradle.html#initial</a>.<br>
At the end it says: </p>

<blockquote>
  <p>And then go to Run -> Edit Configurations select the blog.BlogAppKt
  configuration and change its Main class to:
  io.ktor.server.netty.EngineMain</p>
  
  <p>Now when we run the new configuration, the application will start
  again.</p>
</blockquote>

<p>I am searching for the option but could not find it: </p>

<p><a href=""https://i.stack.imgur.com/PAsEQ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/PAsEQ.png"" alt=""enter image description here""></a></p>

<p>The gradle file looks as follows:</p>

<pre><code>plugins {
    application
    kotlin(""jvm"") version ""1.3.61""
}

group = ""org.example""
version = ""1.0-SNAPSHOT""


val ktor_version = ""1.3.0""

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    implementation(kotlin(""stdlib-jdk8""))
    compile(""io.ktor:ktor-server-netty:$ktor_version"")
    compile(""io.ktor:ktor-server-core:$ktor_version"")
    compile(""ch.qos.logback:logback-classic:1.2.3"")
    testCompile(group = ""junit"", name = ""junit"", version = ""4.12"")
}

tasks {
    compileKotlin {
        kotlinOptions.jvmTarget = ""1.8""
    }
    compileTestKotlin {
        kotlinOptions.jvmTarget = ""1.8""
    }
}

application {
    mainClassName = ""io.ktor.server.netty.EngineMain""
}
</code></pre>

<p><strong>Update</strong></p>

<p>I'v tried following configuration: </p>

<p><a href=""https://i.stack.imgur.com/pLIEj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pLIEj.png"" alt=""enter image description here""></a></p>

<p>But as you can, there is a error message.</p>

<p>What do I have to add to run the Ktor app?</p>
","1743843","","1743843","","2020-02-15 09:27:48","2020-04-25 05:36:47","How to run ktor application?","<gradle><kotlin><ktor>","5","3","","","","60233921","128262","128262","ktor","265","45915935","45915934"
"60241857","1","60241952","","2020-02-15 18:29:54","","1","1481","<p>When I run my Ktor application with <code>gradle run</code> then I've got the following exception: </p>

<pre><code>19:21:11.795 [main] DEBUG io.netty.util.internal.logging.InternalLoggerFactory - Using SLF4J as the default logging framework
19:21:11.810 [main] DEBUG io.netty.util.internal.PlatformDependent0 - -Dio.netty.noUnsafe: false
19:21:11.810 [main] DEBUG io.netty.util.internal.PlatformDependent0 - Java version: 11
19:21:11.811 [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.theUnsafe: available
19:21:11.812 [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.copyMemory: available
19:21:11.812 [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Buffer.address: available
19:21:11.814 [main] DEBUG io.netty.util.internal.PlatformDependent0 - direct buffer constructor: unavailable
java.lang.UnsupportedOperationException: Reflective setAccessible(true) disabled
        at io.netty.util.internal.ReflectionUtil.trySetAccessible(ReflectionUtil.java:31)
        at io.netty.util.internal.PlatformDependent0$4.run(PlatformDependent0.java:225)
        at java.base/java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.PlatformDependent0.&lt;clinit&gt;(PlatformDependent0.java:219)
        at io.netty.util.internal.PlatformDependent.isAndroid(PlatformDependent.java:273)
        at io.netty.util.internal.PlatformDependent.&lt;clinit&gt;(PlatformDependent.java:92)
        at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)
        at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:57)
        at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
        at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
        at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
        at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
19:21:11.814 [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Bits.unaligned: available, true
19:21:11.815 [main] DEBUG io.netty.util.internal.PlatformDependent0 - jdk.internal.misc.Unsafe.allocateUninitializedArray(int): unavailable
java.lang.IllegalAccessException: class io.netty.util.internal.PlatformDependent0$6 cannot access class jdk.internal.misc.Unsafe (in module java.base) because module java.base does not export jdk.internal.misc to unnamed module @557caf28
        at java.base/jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:361)
        at java.base/java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:591)
        at java.base/java.lang.reflect.Method.invoke(Method.java:558)
        at io.netty.util.internal.PlatformDependent0$6.run(PlatformDependent0.java:335)
        at java.base/java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.PlatformDependent0.&lt;clinit&gt;(PlatformDependent0.java:326)
        at io.netty.util.internal.PlatformDependent.isAndroid(PlatformDependent.java:273)
        at io.netty.util.internal.PlatformDependent.&lt;clinit&gt;(PlatformDependent.java:92)
        at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)
        at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:57)
        at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
        at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
        at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
        at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
</code></pre>

<p>the content of <strong>build.gradle.kts</strong> file  </p>

<pre><code>plugins {
    application
    kotlin(""jvm"") version ""1.3.61""
}

group = ""io.flatmap""
version = ""1.0-SNAPSHOT""


val ktor_version = ""1.3.0""

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    implementation(kotlin(""stdlib-jdk8""))
    compile(""io.ktor:ktor-server-netty:$ktor_version"")
    compile(""io.ktor:ktor-server-core:$ktor_version"")
    compile(""ch.qos.logback:logback-classic:1.2.3"")
    testCompile(group = ""junit"", name = ""junit"", version = ""4.12"")
}

tasks {
    compileKotlin {
        kotlinOptions.jvmTarget = ""11""
    }
    compileTestKotlin {
        kotlinOptions.jvmTarget = ""11""
    }
}

application {
    mainClassName = ""io.ktor.server.netty.EngineMain""
}
</code></pre>

<p>I am using Zulu OpenJDK 11: </p>

<pre><code> java --version
openjdk 11.0.6 2020-01-14 LTS
OpenJDK Runtime Environment Zulu11.37+17-CA (build 11.0.6+10-LTS)
OpenJDK 64-Bit Server VM Zulu11.37+17-CA (build 11.0.6+10-LTS, mixed mode) 
</code></pre>

<p>What am I doing wrong? </p>
","1743843","","","","","2020-02-16 08:45:20","java.lang.UnsupportedOperationException: Reflective setAccessible(true) disabled","<java><kotlin><netty><ktor>","1","4","1","","","60241857","128262","128262","ktor","265","45915935","45915934"
"60338534","1","","","2020-02-21 12:19:08","","2","44","<p>A beginner here, 
Is there any other way of adding Content-Type Charset instead of doing <code>header(""Content-Type"", ""application/json; charset=UTF-8"")</code> ? </p>

<pre><code>val client = HttpClient {
            Charsets {
                Charsets.UTF_8
            } // This sets the accept header only, does not set the content type charset
        }
 client.put&lt;HttpResponse&gt; {
            contentType(ContentType.Application.Json)
            url(url)
            body =body
        }

</code></pre>

<p>This however works</p>

<pre><code> client.put&lt;HttpResponse&gt; {
            header(""Content-Type"", ""application/json; charset=UTF-8"")
            contentType(ContentType.Application.Json)
            url(url)
            body = body
        }
</code></pre>

<p>Would highly appreciate.</p>
","3596728","","","","","2020-04-27 02:05:57","How do I set a Content Type Charset in Ktor client (Not an accept charset)","<kotlin><character-encoding><ktor>","1","0","1","","","60338534","128262","128262","ktor","265","45915935","45915934"
"60352285","1","","","2020-02-22 12:47:59","","2","60","<p>I'm new to Kotlin and Ktor and as I try to implement authentication for my web app, I need to store passwords for users. However, I can't seem to find a way either by Ktor Core or by external java dependencies to hash passwords and verify them.</p>

<p>I found some articles on how to hash using BCrypt or PBKDF2, but these require me to do the hashing implementation myself which doesn't seem safe as I will have to worry about maintaining it.</p>

<ul>
<li>Is there a way via Ktor where I can hash passwords and verify them? (similar to PHP's <code>password_hash()</code> and <code>password_verify()</code>)</li>
<li>If not, can you recommend a Gradle dependency that has a good reputation and is well maintained?</li>
<li>Or how can I make a custom implementation and make sure it's safe?</li>
</ul>
","4112200","","","","","2020-02-22 12:47:59","How to hash and verify passwords in Ktor?","<java><gradle><kotlin><password-hash><ktor>","0","1","","","","60352285","128262","128262","ktor","265","45915935","45915934"
"60367302","1","","","2020-02-23 22:02:57","","0","382","<p>During starting Ktor application, I've got the following logs:</p>

<pre><code>java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll_x86_64 in java.library.path
    at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
    at java.lang.Runtime.loadLibrary0(Runtime.java:872)
    at java.lang.System.loadLibrary(System.java:1124)
    at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:369)
    at java.security.AccessController.doPrivileged(Native Method)
    at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:361)
    at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:339)
    at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:136)
    at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:231)
    at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:58)
    at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
    at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
    at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
22:56:07.760 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - netty_transport_native_epoll_x86_64 cannot be loaded from java.library.path, now trying export to -Dio.netty.native.workdir: /tmp
java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll_x86_64 in java.library.path
    at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
    at java.lang.Runtime.loadLibrary0(Runtime.java:872)
    at java.lang.System.loadLibrary(System.java:1124)
    at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
    at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:349)
    at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:136)
    at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:231)
    at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:58)
    at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
    at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
    at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
    Suppressed: java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll_x86_64 in java.library.path
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
        at java.lang.Runtime.loadLibrary0(Runtime.java:872)
        at java.lang.System.loadLibrary(System.java:1124)
        at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:369)
        at java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:361)
        at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:339)
        ... 7 common frames omitted
22:56:07.761 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - Unable to load the library 'netty_transport_native_epoll', trying other loading mechanism.
java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll in java.library.path
    at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
    at java.lang.Runtime.loadLibrary0(Runtime.java:872)
    at java.lang.System.loadLibrary(System.java:1124)
    at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:369)
    at java.security.AccessController.doPrivileged(Native Method)
    at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:361)
    at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:339)
    at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:136)
    at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:234)
    at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:58)
    at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
    at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
    at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
22:56:07.761 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - netty_transport_native_epoll cannot be loaded from java.library.path, now trying export to -Dio.netty.native.workdir: /tmp
java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll in java.library.path
    at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
    at java.lang.Runtime.loadLibrary0(Runtime.java:872)
    at java.lang.System.loadLibrary(System.java:1124)
    at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
    at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:349)
    at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:136)
    at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:234)
    at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:58)
    at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
    at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
    at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
    at io.ktor.server.netty.EngineMain.main(EngineMain.kt:22)
    Suppressed: java.lang.UnsatisfiedLinkError: no netty_transport_native_epoll in java.library.path
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1871)
        at java.lang.Runtime.loadLibrary0(Runtime.java:872)
        at java.lang.System.loadLibrary(System.java:1124)
        at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:369)
        at java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:361)
        at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:339)
        ... 7 common frames omitted
</code></pre>

<p>the build file</p>

<pre><code>plugins {
    application
    kotlin(""jvm"") version ""1.3.61""
}

group = ""io.oceanstack""
version = ""1.0-SNAPSHOT""

val ktor_version = ""1.3.1""

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    implementation(kotlin(""stdlib-jdk8""))
    compile(""io.ktor:ktor-server-core:$ktor_version"")
    compile(""io.ktor:ktor-server-netty:$ktor_version"")
    compile(""ch.qos.logback:logback-classic:1.2.3"")
    testCompile(group = ""junit"", name = ""junit"", version = ""4.12"")
}

tasks {
    compileKotlin {
        kotlinOptions.jvmTarget = ""1.8""
    }
    compileTestKotlin {
        kotlinOptions.jvmTarget = ""1.8""
    }
}

application {
    mainClassName = ""io.ktor.server.netty.EngineMain""
} 
</code></pre>

<p>What am I doing wrong?</p>

<p>The Java runtime:</p>

<pre><code> java -version
openjdk version ""1.8.0_242""
OpenJDK Runtime Environment (Zulu 8.44.0.11-CA-linux64) (build 1.8.0_242-b20)
OpenJDK 64-Bit Server VM (Zulu 8.44.0.11-CA-linux64) (build 25.242-b20, mixed mode)
</code></pre>
","1743843","","1743843","","2020-02-23 22:11:40","2020-02-23 22:11:40","Ktor no netty_transport_native_epoll_x86_64 in java.library.path","<java><kotlin><netty><ktor>","0","5","","","","60367302","128262","128262","ktor","265","45915935","45915934"
"60373937","1","60373938","","2020-02-24 10:31:43","","0","106","<p>I have read <a href=""https://ktor.io/clients/http-client/quick-start/requests.html"" rel=""nofollow noreferrer"">the docs</a> about HTTP requests in Ktor clients, but it lacks of an example of file upload. It mentions <code>PartData.FileItem</code>, but it's unclear how to use it.</p>

<p>So, how do I prepare a <code>multipart/form-data</code> request for file upload in Ktor?</p>
","750510","","","","","2020-02-24 10:31:43","How to upload a file using Ktor client","<http><kotlin><ktor>","1","0","","","","60373937","128262","128262","ktor","265","45915935","45915934"
"60385365","1","","","2020-02-24 23:22:02","","0","26","<p>I'm trying to create a Ktor (1.3.1) HttpClient Mock with JsonFeature like this:</p>

<pre><code>@Test
fun mockFailure() = runBlocking {
    val mock = MockEngine { call -&gt;
        respond(""{}"",
                HttpStatusCode.OK,
                headersOf(""Content-Type"", ContentType.Application.Json.toString()))
    }

    val client = HttpClient(mock) {
        install(JsonFeature) {
            serializer = KotlinxSerializer()
        }
    }

    val resp =  client.get&lt;JsonObject&gt;(""dsf"")
}
</code></pre>

<p>It appears to process it correctly, but then I get this error:</p>

<pre><code>io.ktor.client.call.NoTransformationFoundException: No transformation found: class kotlinx.coroutines.io.ByteBufferChannel -&gt; class kotlinx.serialization.json.JsonObject
with response from http://localhost/dsf:
status: 200 OK
response headers: 
Content-Type: application/json


    at io.ktor.client.call.HttpClientCall.receive(HttpClientCall.kt:79)
</code></pre>
","727797","","727797","","2020-02-24 23:41:47","2020-02-24 23:41:47","Ktor HttpClient Mock Fails","<ktor>","0","1","","","","60385365","128262","128262","ktor","265","45915935","45915934"
"60399691","1","","","2020-02-25 16:57:56","","0","84","<p>I have an api using jackson to serialize/deserialize and everything works perfectly. I tried to switch to kotlinx and had some errors. How my api works:
I have a lib I made, Commons to use in all my apis, it is an abstraction for Kafka consumers and  producers
It all starts when the API receives an http request. Let's use endpoint</p>

<pre><code>/api/client
</code></pre>

<p>as an example
Receiving the following JSON</p>

<pre><code>{
    ""id"" : ""uuid-here"",
     ""name"" : ""Name"",
     ""phones: [
           {
               ""id"" : ""uuid-here"",
               ""number"" : ""+1 589 9652 5522""
            }
     ]
} 
</code></pre>

<p>In my KTOR Orchestration API I will declare that I want jackson to serialize/</p>

<pre><code>install(ContentNegotiation) {
  jackson {
     registerModule(KotlinModule())
     dateFormat = DateFormat.getDateInstance(3)
     enable(SerializationFeature.INDENT_OUTPUT)
  }
}
</code></pre>

<p>And i have my Models:</p>

<pre><code>data class Client(
    val id: UUID,
    val name: String,
    val phones : List&lt;Phone&gt;
)

data class Phone (
   val id: UUID
   val number: String
)
</code></pre>

<p>So, i will receive JSON requests in the controller Orchestration API</p>

<pre><code>fun Route.client(service: ClientService) {
    route(""/api/client"") {
        post(""/"") {
           val client = call.receive&lt;Client&gt;()          
           call.respond(HttpStatusCode.Created, service.sendCommand(client)
        }
    }
}
</code></pre>

<p>So far so good. Now in my lib i will create a Kafka Producer</p>

<pre><code>fun producer(
    bootstrapServers: String,
): KafkaProducer&lt;JsonNode, JsonNode&gt; {
    val prop: HashMap&lt;String, Any&gt; = HashMap()
    prop[BOOTSTRAP_SERVERS_CONFIG] = bootstrapServers
    prop[KEY_SERIALIZER_CLASS_CONFIG] = JsonSerializer::class.java.name // my key will be json
    prop[VALUE_SERIALIZER_CLASS_CONFIG] = JsonSerializer::class.java.name  // my value will be json
    return KafkaProducer(prop)
}
</code></pre>

<p>Now I will create a function to abstract the creation of producers.</p>

<pre><code>data class Event (
  val id: UUID
  val status: String
  val message: Any
)
suspend fun producerCommand(
    topicName: String,
    id: UUID,
    status: Status // its an Enum,
    message: Any,
    bootstrapServer: String
) {
    val producer = producer(bootstrapServers)
     val record = ProducerRecord&lt;JsonNode, JsonNode&gt;(topicName, valueToTree(id), valueToTree(Event(id, status, message)))
     coroutineScope { launch { producer.dispatch(record) } }
}
</code></pre>

<p>My function needs the Event Class, because it does not send a client directly to a Kafka topic. It sends an Event that can have a Client (or other classes)</p>

<p>valueToTree is a function to convert a object to JsonNode</p>

<pre><code>fun valueToTree(obj: Any): JsonNode? {
    try {
        return jacksonObjectMapper().valueToTree(obj)
    } catch (ex: JsonMappingException) {
        ex.printStackTrace()
    }
    return null
} 
</code></pre>

<p>Back to my API i will create a Service to call the producerCommand</p>

<pre><code>class ClientService {
    suspend fun sendCommand(client: Client) {
        producerCommand(
            ""insert-client"", client.id, Status.Open, client, ""localhost:9092""
        )
    }
}
</code></pre>

<p>Everything working perfectly. Now if I change the jackson serialization for kotlinx:</p>

<pre><code>install(ContentNegotiation) {
      serialization(
            contentType = ContentType.Application.Json,
            json = Json(
                DefaultJsonConfiguration.copy(
                    prettyPrint = true
                )
            )
        )
   }
</code></pre>

<p>Changing Models:</p>

<pre><code>@Serializable
data class Client(
    @Serializable(UUIDSerializer::class)
    val id: UUID,
    val name: String,
    val phones : List&lt;Phone&gt;
 )

@Serializable
data class Phone (
   @Serializable(UUIDSerializer::class)
   val id: UUID
   val number: String
)
</code></pre>

<p>Changing Kafka Producer</p>

<pre><code>fun producer(
    bootstrapServers: String,    
    schemaUrl: String
): KafkaProducer&lt;String, GenericRecord&gt; {
    val prop: HashMap&lt;String, Any&gt; = HashMap()
    prop[BOOTSTRAP_SERVERS_CONFIG] = bootstrapServers
    prop[KEY_SERIALIZER_CLASS_CONFIG] = StringSerializer::class.java.name
    prop[VALUE_SERIALIZER_CLASS_CONFIG] = KafkaAvroSerializer::class.java.name
    prop[SCHEMA_REGISTRY_URL_CONFIG] = schemaUrl
    return KafkaProducer(prop)
}
</code></pre>

<p>Now my key will be a string, and my value will be an Avro schema.</p>

<p>Changing my function producerCommand</p>

<pre><code>@Serializable
data class Event(
    @Serializable(UUIDSerializer::class)
    val id: UUID,
    val status: Status,
    @ContextualSerialization
    val message: Any
)

suspend fun producerCommand(
    topicName: String,
    id: UUID,
    status: Status,
    message: Any,
    bootstrapServers: String,
    schemaUrl: String
) {
    val producer = producer(
        bootstrapServers,
        schemaUrl)

  Avro.default.schema(Event.serializer())
  val avroSchema = Avro.default.toRecord(Event.serializer(), Event(id, status, message))
  val record = ProducerRecord&lt;String, GenericRecord&gt;(topicName, id.toString(), avroSchema)
  coroutineScope { launch { producer.dispatch(record) } }
}
</code></pre>

<p>And lastly, updating my Service</p>

<pre><code>class ClientService {
    suspend fun sendCommand(client: Client) {
        producerCommand(
            ""insert-client"", UUID.randomUUID(), Status.Open, client, ""localhost:9092"",
            ""http://localhost:8081""
        )
    }
}
</code></pre>

<p>Now if I try to run the api and consume a JSON request I get the error</p>

<blockquote>
  <p>java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length
  0</p>
</blockquote>
","9910654","","9910654","","2020-02-25 17:03:06","2020-02-25 17:03:06","Changing Jackson to Kotlinx using Ktor","<kotlin><ktor><kotlinx.serialization>","0","0","","","","60399691","128262","128262","ktor","265","45915935","45915934"
"60399933","1","60495656","","2020-02-25 17:11:13","","0","35","<p>I am trying out <code>Ktor</code> by converting some existing project that's currently using <code>Retrofit</code>.</p>

<p>Although I could easily convert the request into something like:</p>

<pre><code>client.get {
    url(""$BASE_URL/something/somepage/another"")
}
</code></pre>

<p>It seems very tedious to always add the <code>$BASE_URL</code> to all paths every time. In retrofit, we could simply do something like:</p>

<pre><code>Retrofit.Builder()
    .baseUrl(BASE_URL)
    .create(SomeServiceClass::class.java)
</code></pre>

<p>I've triede using <code>defaultRequest</code> and setting the <code>BASE_URL</code> there but apparently you could only set the <code>url.host</code> and not the whole <code>basePath</code>.</p>

<p>Is there a way to do the same thing in <code>Ktor</code>? or if there is none, what's the best practice to handle this?</p>
","9291997","","","","","2020-03-02 19:49:48","How to set a basePath in Ktor similar to Retrofit's `Retrofit.Builder().baseUrl(baseUrl)?","<android><kotlin><ktor><kotlin-multiplatform><ktor-client>","1","0","","","","60399933","128262","128262","ktor","265","45915935","45915934"
"60405615","1","","","2020-02-26 01:43:09","","0","39","<p>I'm trying to build an application using Ktor and Exposed with SQLite. Unfortunately my application keeps crashing.</p>

<p>This is my database connection:</p>

<pre class=""lang-kotlin prettyprint-override""><code>class DatabaseFactory(connection: DatabaseConnection) {
    init {
        connect()
        createSchema()
    }

    private fun connect() {
        Database.connect(""jdbc:sqlite:/path/to/file"", ""org.sqlite.JDBC"")
        TransactionManager.manager.defaultIsolationLevel = Connection.TRANSACTION_SERIALIZABLE
    }

    private fun createSchema() {
        transaction {
            SchemaUtils.create(Images)
            SchemaUtils.create(KeyValues)

            Images.deleteAll()
        }
    }

    suspend fun &lt;T&gt; dbQuery(block: () -&gt; T): T =
        withContext(Dispatchers.IO) {
            transaction { block() }
        }
}

// access db with
DatabaseFactory.dbQuery {
    // do stuff
}
</code></pre>

<p>While running my application I get the following error:</p>

<pre><code>org.jetbrains.exposed.exceptions.ExposedSQLException: org.sqlite.SQLiteException: [SQLITE_BUSY]  The database file is locked (database is locked)
</code></pre>
","519790","","","","","2020-02-26 07:28:41","Exposed SQLite connection fails with SQLITE_BUSY","<sqlite><kotlin><ktor><kotlin-exposed>","1","0","","","","60405615","128262","128262","ktor","265","45915935","45915934"
"60443412","1","","","2020-02-27 23:51:51","","1","24","<p>I'm wondering if there's a way to do an internal redirect, re-route, or response forwarding inside Ktor.</p>

<pre><code>call.respondRedirect(""relative/url"")
</code></pre>

<p>sends a HTTP 302 or 301 depending on the <code>permantent: Boolean</code> flag. I'm looking for something that would do the same without using HTTP, just internally in Ktor. Here's some pseudo-routing of what I want to achieve:</p>

<pre><code>get(""/foo"") {
    if (call.parameters[""something""] != null) {
        call.respondText(""Yay, something!"")
    } else {
        call.respondRedirect(""/bar"") // except without relying on client to handle HTTP redirects.
    }
}
get(""/bar"") {
    call.respondText(""No thing :("")
}
</code></pre>

<p>The goal is that the client shouldn't make 2 requests, and shouldn't be aware of the redirection happening.</p>

<p><strong>NB: I'm aware I can extract a function for <code>/bar</code>'s body and invoke it, instead of <code>responsdRedirect</code>. However, I want to make Ktor handle it so that it goes through all the necessary lifecycle and pipeline with all the interceptors. This is to make sure it is handled as if it was an external request, except the network roundtrip.</strong></p>

<p><em>I'm looking for something like Express.js' <code>req.app.handle(req, res)</code> as shown in the first half of this answer: <a href=""https://stackoverflow.com/a/48790319/253468"">https://stackoverflow.com/a/48790319/253468</a>. A potential solution I couldn't understand yet is something like <code>TestApplicationEngine.handleRequest</code> (in <code>io.ktor:ktor-server-test-host</code>) is doing with <code>pipeline.execute</code>. I guess I could invoke <code>call.application.execute()</code>, the question is how to construct the <code>ApplicationCall</code> object then. Note this is for production use, so no <code>TestApplicationCall</code>.</em></p>
","253468","","","","","2020-02-27 23:51:51","How to redirect internally in Ktor?","<redirect><response.redirect><ktor>","0","0","","","","60443412","128262","128262","ktor","265","45915935","45915934"
"60446787","1","","","2020-02-28 07:03:33","","0","68","<p>How can I convert <code>io.ktor.utils.io.ByteReadChannel</code> into <code>kotlinx.coroutines.flow.Flow&lt;java.nio.ByteBuffer&gt;</code>?</p>

<p>I use <strong>Ktor</strong> with this routing:</p>

<pre><code>        post(""/upload"") {
            val channel: ByteReadChannel = call.receiveChannel()
            val flow: Flow&lt;ByteBuffer&gt; = channel.asByteBufferFlow() // my custom extension method
            transaction.execute {
                testDao.saveFile(flow)
            }
            call.respond(""OK"")
        }
</code></pre>

<p>The DAO uses <strong>R2DBC</strong> and <strong>Blob</strong> like this:</p>

<pre><code>    override suspend fun saveFile(input: Flow&lt;ByteBuffer&gt;) {
        val connection = requireR2DBCTransactionConnection()
        val publisher: Publisher&lt;ByteBuffer&gt; = input.asPublisher()
        val statement: Statement = connection.createStatement(""insert into bindata (data) values ($1)"")
        statement.bind(0, Blob.from(publisher))
        val count: Int = statement.execute().awaitFirst().rowsUpdated.awaitFirst()
        if (count != 1) {
            throw IllegalStateException()
        }
    }
</code></pre>

<p>I tried to write this extension method but I failed:</p>

<pre><code>fun ByteReadChannel.asByteBufferFlow(): Flow&lt;ByteBuffer&gt; = object : AbstractFlow&lt;ByteBuffer&gt;() {

    override suspend fun collectSafely(collector: FlowCollector&lt;ByteBuffer&gt;) {
        /* I have no idea */
    }

}
</code></pre>

<p>My main problem is that I have not found any similar sample and both <code>ByteBuffer</code> and <code>ByteReadChannel</code> is new for me.</p>
","7605862","","","","","2020-02-28 07:03:33","How to convert ByteReadChannel into Flow<ByteBuffer>","<kotlin-coroutines><ktor><r2dbc>","0","6","","","","60446787","128262","128262","ktor","265","45915935","45915934"
"60474434","1","","","2020-03-01 11:08:41","","0","20","<p>I have a GAE Standard Environment running with ktor. 
Now I'm trying to access the sql import RESTApi out of GAE and therefore need an accesstoken...</p>

<p>When trying to retrieve that token with <code>AppIdentityServiceFactory.getAppIdentityService().getAccessToken</code> an Exception is thrown pointing towards that <code>ApiProxy.getCurrentEnvironment()</code> is null, which I checked: it is... (similar problem with <code>getAccessTokenUncached</code>)</p>

<p>I'm getting the impression that this has something to do with ktor, since I found <a href=""https://github.com/ktorio/ktor-samples/tree/master/deployment/google-appengine-standard"" rel=""nofollow noreferrer"">here</a> that the <code>application.conf</code> from ktor can have some influence on the GAE environment setting:</p>

<blockquote>
  <p>You'll need to remove the deployment block from application.conf, otherwise when running on Google App Engine the Servlet will not get it's environment configured correctly causing the Google Cloud API's to fail.</p>
</blockquote>

<p>Any help would be appreciated</p>

<pre><code>com.google.apphosting.api.ApiProxy$CallNotFoundException: Can't make API call app_identity_service.GetAccessToken in a thread that is neither the original request thread nor a thread created by ThreadManager
    at com.google.apphosting.api.ApiProxy$CallNotFoundException.foreignThread(ApiProxy.java:847)
    at com.google.apphosting.api.ApiProxy.makeSyncCall(ApiProxy.java:124)
    at com.google.apphosting.api.ApiProxy.makeSyncCall(ApiProxy.java:75)
    at com.google.appengine.api.appidentity.AppIdentityServiceImpl.getAccessTokenUncached(AppIdentityServiceImpl.java:233)
    at com.moregames.playspot.service.DataImportManager$token$2.invoke(DataImportManager.kt:47)
    at com.moregames.playspot.service.DataImportManager$token$2.invoke(DataImportManager.kt:36)
    at kotlin.SynchronizedLazyImpl.getValue(LazyJVM.kt:74)
    at com.moregames.playspot.service.DataImportManager.getToken(DataImportManager.kt)
    at com.moregames.playspot.service.DataImportManager.triggerRevenuesImport(DataImportManager.kt:124)
    at com.moregames.playspot.service.DataImportManager.triggerRevenuesImportAndWaitForResponse(DataImportManager.kt:103)
    at com.moregames.playspot.service.DataImportManager.processLoad(DataImportManager.kt:78)
    at com.moregames.playspot.service.DataImportManager$processLoad$1.invokeSuspend(DataImportManager.kt)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
    at kotlinx.coroutines.DispatchedContinuationKt.resumeCancellableWith(DispatchedContinuation.kt:313)
    at kotlinx.coroutines.DispatchedCoroutine.afterResume(Builders.common.kt:254)
    at kotlinx.coroutines.AbstractCoroutine.resumeWith(AbstractCoroutine.kt:113)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
    at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:216)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
    at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:216)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
    at io.ktor.util.pipeline.SuspendFunctionGun.resumeRootWith(PipelineContext.kt:216)
    at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:172)
    at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:67)
    at io.ktor.util.pipeline.SuspendFunctionGun$continuation$1.resumeWith(PipelineContext.kt:122)
    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:46)
    at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:56)
    at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:561)
    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:727)
    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:667)
    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:655)
</code></pre>
","12612733","","","","","2020-03-01 11:08:41","Google App Engine `currentEnvironment` is null (`ApiProxy.getCurrentEnvironment()`)","<google-app-engine><exception><ktor>","0","1","","","","60474434","128262","128262","ktor","265","45915935","45915934"
"36817110","1","","","2016-04-23 22:19:22","","0","1068","<p>I'm new about NOSQL. I use couchDB and ektrop Java API. I tried these code but it gives HTTP 405 error.</p>

<pre><code>protected CouchDbInstance _db;
{       
String dbname = ""my_database"";
try {
//creates a database with the specified name
CouchDbConnector dbc = _db.createConnector(dbname, true);

//create a simple doc to place into your new database
Map&lt;String, Object&gt; doc = new HashMap&lt;String, Object&gt;();
doc.put(""_id"", UUID.randomUUID().toString());
doc.put(""season"", ""summer"");
doc.put(""climate"", ""arid"");
dbc.create(doc);

} catch (Exception e) {

}
</code></pre>

<p>Examples on the internet are very complex for me, so I didn't understand anything and i did not find any tutorial, so i have two questions.<br>
-How can i connect db ?<br>
-How can i add/delete/update documents operations ? 
If you give me examples codes, i will be really happy. Also you can suggest good tutorial. Thanks in advance.</p>
","6242699","","","","","2019-09-04 18:44:48","How to connect CouchDB with Java","<java><couchdb><ektorp>","1","2","","","","36817110","73833","73833","ektorp","71","7739352","7739351"
"36969742","1","","","2016-05-01 17:34:36","","0","131","<p>I use java servlet and ektorp for couchdb). I added image to database but i didn't show it.</p>

<pre><code>AttachmentInputStream data = db.getAttachment(""document_id"",""attachment_id"");
</code></pre>

<p>I fetched attachment by this way. Problem is that i don't know how to show this fetched image in java servlet.</p>

<p>Thank in advance.</p>
","6242699","","","","","2016-07-29 08:28:47","Fetching attachment by using java and ektorp","<java><servlets><attachment><ektorp>","1","0","","","","36969742","73833","73833","ektorp","71","7739352","7739351"
"37172582","1","","","2016-05-11 20:21:52","","1","599","<p>I want to <strong>query multiple candidates</strong> for a search string which could look like <strong>""My sear foo""</strong>.
Now I want to look for documents which have a field that <strong>contains one (or more)</strong> of the entered strings (seen as splitted by whitespaces).</p>

<p>I found some code which allows me to do a search by pattern:</p>

<pre><code>@View(name = ""find_by_serial_pattern"", map = ""function(doc) { var i; if(doc.serialNumber) { for(i=0; i &lt; doc.serialNumber.length; i+=1) { emit(doc.serialNumber.slice(i), doc);}}}"")
public List&lt;DeviceEntityCouch&gt; findBySerialPattern(String serialNumber) {
    String trim = serialNumber.trim();

    if (StringUtils.isEmpty(trim)) {
        return new ArrayList&lt;&gt;();
    }
    ViewQuery viewQuery = createQuery(""find_by_serial_pattern"").startKey(trim).endKey(trim + ""\u9999"");

    return db.queryView(viewQuery, DeviceEntityCouch.class);
}
</code></pre>

<p>which works quite nice for looking just for one pattern. But how do I have to modify my code to get a multiple contains on doc.serialNumber?</p>

<p><strong>EDIT:</strong>
This is the current workaround, but there must be a better way i guess.
Also there is only an OR logic. So an entry fits term1 or term2 to be in the list.</p>

<pre><code>@View(name = ""find_by_serial_pattern"", map = ""function(doc) { var i; if(doc.serialNumber) { for(i=0; i &lt; doc.serialNumber.length; i+=1) { emit(doc.serialNumber.slice(i), doc);}}}"")
public List&lt;DeviceEntityCouch&gt; findBySerialPattern(String serialNumber) {
    String trim = serialNumber.trim();

    if (StringUtils.isEmpty(trim)) {
        return new ArrayList&lt;&gt;();
    }

    String[] split = trim.split("" "");

    List&lt;DeviceEntityCouch&gt; list = new ArrayList&lt;&gt;();
    for (String s : split) {
        ViewQuery viewQuery = createQuery(""find_by_serial_pattern"").startKey(s).endKey(s + ""\u9999"");
        list.addAll(db.queryView(viewQuery, DeviceEntityCouch.class));
    }

    return list;
}
</code></pre>
","2494666","","2494666","","2016-05-11 21:29:00","2016-05-12 02:59:37","Ektorp CouchDb: Query for pattern with multiple contains","<java><search><couchdb><ektorp>","1","0","","","","37172582","73833","73833","ektorp","71","7739352","7739351"
"38682574","1","","","2016-07-31 09:27:28","","0","422","<p>I want to send my object to couchdb using the ektorp java client. But I couldn't write my bytearray value to couchdb properly. My java object as follow:</p>

<p><a href=""https://i.stack.imgur.com/pDCFy.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pDCFy.png"" alt=""enter image description here""></a></p>

<p>If I convert bytearray to String:</p>

<p><a href=""https://i.stack.imgur.com/5CuYv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/5CuYv.png"" alt=""enter image description here""></a></p>

<p>The metadata value is saved on couchdb as ""AgIGZm9vBmJhegA="" (base64), This means that ""foobaz"". Why is my bytearray value changed?</p>

<p><a href=""https://i.stack.imgur.com/yk7i1.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/yk7i1.png"" alt=""enter image description here""></a> </p>

<p>My example code :</p>

<pre><code>private CouchDbInstance dbInstance;
private CouchDbConnector db;    

    ... 

    Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
    doc.put(""_id"", ""foo.com:http/"");

    byte[] serilazeData = IOUtils.serialize(writer, fieldValue);
    doc.put(""metadata"", serilazeData);

    ...
    db.update(doc);
</code></pre>

<p>My main code block</p>

<pre><code>    public void put(K key, T obj) {

        final Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
        doc.put(""_id"", key.toString());

        Schema schema = obj.getSchema();

        List&lt;Field&gt; fields = schema.getFields();
        for (int i = 0; i &lt; fields.size(); i++) {
          if (!obj.isDirty(i)) {
            continue;
          }
          Field field = fields.get(i);
          Schema.Type type = field.schema().getType();
          Object fieldValue = obj.get(field.pos());
          Schema fieldSchema = field.schema();

          fieldValue = serializeFieldValue(fieldSchema, fieldValue);
          doc.put(field.name(), fieldValue);
        }
        db.update(doc);

      }

      private Object serializeFieldValue(Schema fieldSchema, Object fieldValue ){
        ...
            byte[] data = null;
            try {
              SpecificDatumWriter writer = getDatumWriter(fieldSchema);
              data = IOUtils.serialize(writer, fieldValue);
            } catch (IOException e) {
              LOG.error(e.getMessage(), e);
            }
            fieldValue = data;
         ...
        return fieldValue;
      }
</code></pre>
","1736002","","-1","","2017-09-22 18:01:22","2017-08-27 01:36:29","How to write bytearray to couchdb?","<java><couchdb><ektorp><database><nosql>","3","0","","","","38682574","73833","73833","ektorp","71","7739352","7739351"
"60499667","1","","","2020-03-03 03:28:30","","0","13","<p>On the KTOR side I think that i set up serialization</p>

<pre><code>install(ContentNegotiation) {
    serialization(
        contentType = ContentType.Application.Json,
        json = Json(
            DefaultJsonConfiguration.copy(
                prettyPrint = true
            )
        )
    )
}
</code></pre>

<p>But when i post to this endpoint i get <strong>Content type text/plain is not supported</strong></p>

<p>my route looks like this</p>

<pre><code>post(""/""){
    try {
        //val request = call.receive&lt;String&gt;()
        val request = call.receive&lt;AuthorREQ&gt;()
        call.respond(request)
    }catch (e:Exception){
        val foo =true
    }
}
</code></pre>

<p>My client side code looks like this.</p>

<pre><code>suspend fun  &lt;R: REQ&gt;save(req:R, ctx:ModelCtx,  deserializationStrategy: KSerializer&lt;R&gt;){
    val fetchAddy = ""$REST_SERVICE_ADDRESS${ctx.getStub()}""
    val body = Json.stringify(deserializationStrategy, req)
    val responsePromise = window.fetch(fetchAddy, object : RequestInit {
        override var method: String? = ""POST""
        override var mode: RequestMode? = RequestMode.NO_CORS
        override var headers = buildHeader()
        override var body = body })

    val response = responsePromise.await()
    val jsonPromise = response.json()
    val json = jsonPromise.await()
}
</code></pre>

<p>jvm gradle : implementation(""org.jetbrains.kotlinx:kotlinx-serialization-runtime:$serialization_version"")</p>

<p>js gradle : implementation(""org.jetbrains.kotlinx:kotlinx-serialization-runtime-js:$serialization_version"")</p>

<p>the project works fine with my get routes, the client can use them without issue... Also changing my request to the following works but I don't think this is how it is supposed to be setup.</p>

<pre><code>val request = call.receive&lt;String&gt;()
</code></pre>
","981511","","","","","2020-03-03 03:28:30","ktor, rest and Content type text/plain is not supported","<coroutine><ktor><kotlinx.serialization>","0","0","","","","60499667","128262","128262","ktor","265","45915935","45915934"
"60523776","1","","","2020-03-04 10:19:04","","0","9","<p>Using the ktor client to make an HTTP request, I want to change the HTTP Protocol Version to 1.0.</p>

<p>The documentation on the different Engines, e.g. Apache or CIO, mentions that they support 1.X, but not how to change the version.</p>

<p>I have the following code, which initialized the client, but I could not find configuration options for setting the protocol version for client or the request.</p>

<pre><code>val client = HttpClient(Apache){
        engine {
            ...
        }
    }
val result = client.post&lt;HttpResponse&gt;(""http://127.0.0.1:8080/handler"") {
   body = MultiPartContent.build {
       add(""user"", ""myuser"")
       add(""password"", ""password"")
       add(""file"", byteArrayOf(1, 2, 3, 4), filename = ""binary.bin"")
   }
}
</code></pre>

<p>The HTTPProtocolVersion class exists, but I could only find one reference to it for getting the version of a request, but not for setting it.
<a href=""https://api.ktor.io/0.9.5/io.ktor.http/-http-protocol-version/index.html"" rel=""nofollow noreferrer"">https://api.ktor.io/0.9.5/io.ktor.http/-http-protocol-version/index.html</a></p>
","1375822","","","","","2020-03-04 10:19:04","Setting HttpProtocolVersion for Ktor Http Client Request","<kotlin><ktor><ktor-client>","0","0","","","","60523776","128262","128262","ktor","265","45915935","45915934"
"60523926","1","","","2020-03-04 10:26:33","","1","34","<p>New to Kotlin Exposed and trying to store data using IdTable and getting errror 'id is not in record set.' Below is the code using </p>

<pre><code>object GeoLocationModel : IdTable&lt;Long&gt;(""geolocation_pos"") {
    val code = long(""code"").primaryKey()
    val createdAt = datetime(""created_at"").clientDefault { currentUtc() }
    val updatedAt = datetime(""updated_at"").nullable()
    val createdBy = varchar(""created_by"", 255).clientDefault { authenticatedUser() }
    val updatedBy = varchar(""updated_by"", 255).nullable()
    val uuid = uuid(""uuid"").autoGenerate().uniqueIndex()
    val latitude: Column&lt;Double&gt; = double(""latitude"")
    val longitude: Column&lt;Double&gt; = double(""longitude"")
    val pincode: Column&lt;Long&gt; = long(""pincode"")
    override val id: Column&lt;EntityID&lt;Long&gt;&gt; =  code.entityId()
}

object GeoLocationModel : IdTable&lt;Long&gt;(""geolocation_pos"") {
    val code = long(""code"").primaryKey()
    val createdAt = datetime(""created_at"").clientDefault { currentUtc() }
    val updatedAt = datetime(""updated_at"").nullable()
    val createdBy = varchar(""created_by"", 255).clientDefault { authenticatedUser() }
    val updatedBy = varchar(""updated_by"", 255).nullable()
    val uuid = uuid(""uuid"").autoGenerate().uniqueIndex()
    val latitude: Column&lt;Double&gt; = double(""latitude"")
    val longitude: Column&lt;Double&gt; = double(""longitude"")
    val pincode: Column&lt;Long&gt; = long(""pincode"")
    override val id: Column&lt;EntityID&lt;Long&gt;&gt; =  code.entityId()
}

Insertion of data for **geolocation_pos** table

 val geolocationId = GeoLocationModel.insert {
                it[code] = nextSequenceVal()
                it[latitude] = 28.550667
                it[longitude] = 77.268952
                it[pincode] = xxxxxx
            } get GeoLocationModel.id 

</code></pre>

<p>MySQL database is not able to save throws an error stating</p>

<pre><code>java.lang.IllegalStateException: com.xxxx.xxxx.xxxx.xxx.GeoLocationModel.code is not in record set
    at org.jetbrains.exposed.sql.ResultRow.getRaw(ResultRow.kt:53) ~[exposed-core-0.21.1.jar:na]
    at org.jetbrains.exposed.sql.ResultRow.get(ResultRow.kt:18) ~[exposed-core-0.21.1.jar:na]
    at org.jetbrains.exposed.sql.statements.InsertStatement.get(InsertStatement.kt:20) ~[exposed-core-0.21.1.jar:na]
</code></pre>

<p>Generated SQL</p>

<pre><code>INSERT INTO geolocation_pos (code, created_at, created_by, latitude, longitude, pincode, updated_at, updated_by, uuid) VALUES (106, 'xxxxxxx', 'xxx', 28.550667, 77.268952, xxxxx, NULL, NULL, 'dd6aaf69-5324-4fac-9271-5c099957e06b')
</code></pre>

<p>Please can anyone help me resolving the issue.</p>
","13005073","","","","","2020-03-04 10:26:33","Kotlin Exposed ORM - id not in record set","<kotlin><orm><ktor>","0","1","","","","60523926","128262","128262","ktor","265","45915935","45915934"
"60578673","1","","","2020-03-07 14:40:26","","0","37","<p>I have set up a server in Ktor with a Postgres database in Docker, but figured it would be useful to be able to develop the server locally without rebuilding the docker container each time.</p>

<p>In <code>application.conf</code> I have</p>

<pre><code>// ...

db {
    jdbcUrl = ${DATABASE_URL}
    dbDriver = ""org.postgresql.Driver""
    dbDriver = ${?DATABASE_DRIVER}
    dbUser = ${DATABASE_USER}
    dbPassword = ${DATABASE_PASSWORD}
}
</code></pre>

<p>and in my DatabaseFactory I have</p>

<pre><code>object DatabaseFactory {

    private val appConfig = HoconApplicationConfig(ConfigFactory.load())
    private val dbUrl = appConfig.property(""db.jdbcUrl"").getString()
    private val dbDriver = appConfig.property(""db.dbDriver"").getString()
    private val dbUser = appConfig.property(""db.dbUser"").getString()
    private val dbPassword = appConfig.property(""db.dbPassword"").getString()

    fun init() {
        Database.connect(hikari())

        transaction {
            val flyway = Flyway.configure().dataSource(dbUrl, dbUser, dbPassword).load()
            flyway.migrate()
        }
    }

    private fun hikari(): HikariDataSource {
        val config = HikariConfig()
        config.driverClassName = dbDriver
        config.jdbcUrl = dbUrl
        config.username = dbUser
        config.password = dbPassword
        config.maximumPoolSize = 3
        config.isAutoCommit = false
        config.transactionIsolation = ""TRANSACTION_REPEATABLE_READ""
        config.validate()
        return HikariDataSource(config)
    }

    suspend fun &lt;T&gt; dbQuery(block: () -&gt; T): T =
        withContext(Dispatchers.IO) {
            transaction { block() }
        }

}
</code></pre>

<p>I have edited the Gradle run configuration with the following environment config:</p>

<pre><code>DATABASE_URL=jdbc:h2:mem:default;DATABASE_DRIVER=org.h2.Driver;DATABASE_USER=test;DATABASE_PASSWORD=password
</code></pre>

<p>When I run the task I get this error: <code>Could not resolve substitution to a value: ${DATABASE_URL}</code>, but if I set a breakpoint on the first line (<code>private val appConfig</code>) and evaluate <code>System.getenv(""DATABASE_URL"")</code> it is resolved to the correct value.</p>

<p><strong>My questions are:</strong></p>

<ol>
<li>Why does this not work?</li>
<li>What is the best (or: a good) setup for developing the server without packing it in a container? Preferably without running the database in another container.</li>
</ol>
","3602593","","","","","2020-03-07 22:45:16","Ktor with Gradle run configuration ""Could not resolve substitution to a value"" from environment variables","<database><gradle><kotlin><environment-variables><ktor>","1","1","","","","60578673","128262","128262","ktor","265","45915935","45915934"
"60579294","1","","","2020-03-07 15:42:24","","0","55","<p>Could one please help me figure out the reason why my application written in <code>Kotlin</code>fails to run after it was built with <code>Intellij Idea</code> and deployed to <code>Ubuntu 19.10</code> virtual machine ?</p>

<p>I use the following components: </p>

<ol>
<li>Ktor 1.3.0 </li>
<li>Netty for Ktor</li>
</ol>

<p><strong>Launch logs:</strong></p>

<pre><code>15:22:08.488 [main] DEBUG io.netty.util.internal.logging.InternalLoggerFactory - Using SLF4J as the default logging framework
15:22:08.530 [main] DEBUG io.netty.util.internal.PlatformDependent0 - -Dio.netty.noUnsafe: false
15:22:08.530 [main] DEBUG io.netty.util.internal.PlatformDependent0 - Java version: 11
15:22:08.568 [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.theUnsafe: available
15:22:08.569 [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.copyMemory: available
15:22:08.569 [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Buffer.address: available
15:22:08.577 [main] DEBUG io.netty.util.internal.PlatformDependent0 - direct buffer constructor: unavailable
java.lang.UnsupportedOperationException: Reflective setAccessible(true) disabled
        at io.netty.util.internal.ReflectionUtil.trySetAccessible(ReflectionUtil.java:31)
        at io.netty.util.internal.PlatformDependent0$4.run(PlatformDependent0.java:225)
        at java.base/java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.PlatformDependent0.&lt;clinit&gt;(PlatformDependent0.java:219)
        at io.netty.util.internal.PlatformDependent.isAndroid(PlatformDependent.java:273)
        at io.netty.util.internal.PlatformDependent.&lt;clinit&gt;(PlatformDependent.java:92)
        at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)
        at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:57)
        at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
        at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
        at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
        at io.ktor.server.netty.Netty.create(Embedded.kt:14)
        at io.ktor.server.netty.Netty.create(Embedded.kt:12)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer(EmbeddedServer.kt:79)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer$default(EmbeddedServer.kt:77)
        at app.common.ApplicationKt.main(Application.kt:96)
15:22:08.581 [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Bits.unaligned: available, true
15:22:08.582 [main] DEBUG io.netty.util.internal.PlatformDependent0 - jdk.internal.misc.Unsafe.allocateUninitializedArray(int): unavailable
java.lang.IllegalAccessException: class io.netty.util.internal.PlatformDependent0$6 cannot access class jdk.internal.misc.Unsafe (in module java.base) because module java.base does not export jdk.internal.misc to unnamed module @6d3af739
        at java.base/jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:361)
        at java.base/java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:591)
        at java.base/java.lang.reflect.Method.invoke(Method.java:558)
        at io.netty.util.internal.PlatformDependent0$6.run(PlatformDependent0.java:335)
        at java.base/java.security.AccessController.doPrivileged(Native Method)
        at io.netty.util.internal.PlatformDependent0.&lt;clinit&gt;(PlatformDependent0.java:326)
        at io.netty.util.internal.PlatformDependent.isAndroid(PlatformDependent.java:273)
        at io.netty.util.internal.PlatformDependent.&lt;clinit&gt;(PlatformDependent.java:92)
        at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:225)
        at io.netty.channel.epoll.Native.&lt;clinit&gt;(Native.java:57)
        at io.netty.channel.epoll.Epoll.&lt;clinit&gt;(Epoll.java:39)
        at io.ktor.server.netty.EventLoopGroupProxy$Companion.create(NettyApplicationEngine.kt:189)
        at io.ktor.server.netty.NettyApplicationEngine.&lt;init&gt;(NettyApplicationEngine.kt:74)
        at io.ktor.server.netty.Netty.create(Embedded.kt:14)
        at io.ktor.server.netty.Netty.create(Embedded.kt:12)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer(EmbeddedServer.kt:79)
        at io.ktor.server.engine.EmbeddedServerKt.embeddedServer$default(EmbeddedServer.kt:77)
        at app.common.ApplicationKt.main(Application.kt:96)
15:22:08.586 [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.DirectByteBuffer.&lt;init&gt;(long, int): unavailable
15:22:08.587 [main] DEBUG io.netty.util.internal.PlatformDependent - sun.misc.Unsafe: available
15:22:08.710 [main] DEBUG io.netty.util.internal.PlatformDependent - maxDirectMemory: 249364480 bytes (maybe)
15:22:08.711 [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.tmpdir: /tmp (java.io.tmpdir)
15:22:08.711 [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.bitMode: 64 (sun.arch.data.model)
15:22:08.713 [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.maxDirectMemory: -1 bytes
15:22:08.713 [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.uninitializedArrayAllocationThreshold: -1
15:22:08.714 [main] DEBUG io.netty.util.internal.CleanerJava9 - java.nio.ByteBuffer.cleaner(): available
15:22:08.714 [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.noPreferDirect: false
15:22:08.716 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - -Dio.netty.native.workdir: /tmp (io.netty.tmpdir)
15:22:08.717 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - -Dio.netty.native.deleteLibAfterLoading: true
15:22:08.717 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - -Dio.netty.native.tryPatchShadedId: true
15:22:08.718 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - Unable to load the library 'netty_transport_native_epoll_x86_64', trying other loading mechanism.

</code></pre>
","12942529","","490324","","2020-03-09 09:26:42","2020-03-09 09:26:42","Application throws error on Ubuntu 19 with Java 11","<java><ubuntu><kotlin><netty><ktor>","0","2","","","","60579294","128262","128262","ktor","265","45915935","45915934"
"60623687","1","","","2020-03-10 18:19:37","","1","42","<p>So I have this class:</p>

<pre class=""lang-kotlin prettyprint-override""><code>@Serializable
sealed class Message&lt;out T&gt;{
    @Serializable
    class Success&lt;out T&gt;(val value: T) : Message&lt;T&gt;()
    @Serializable
    class Error&lt;out T&gt;(val errorMessage: String) : Message&lt;T&gt;()
}
</code></pre>

<p>Which I want to use for every message I send from my server to client. I already had to change the following function because I cant figure out how to use serialization with generics</p>

<pre class=""lang-kotlin prettyprint-override""><code>            post(""create"") {
                val userName = call.receive&lt;String&gt;()
                if (userName.isBlank()) {
                    call.respond(Message.Error&lt;User&gt;(""Specify a username""))
                } else {
                    call.respond(Message.Success(User(userName)))
                }
            }
</code></pre>

<p>to</p>

<pre class=""lang-kotlin prettyprint-override""><code>            post(""create"") {
                val userName = call.receive&lt;String&gt;()
                if (userName.isBlank()) {
                    val serializer = Message.Error.serializer(User.serializer())
                    val response = Message.Error&lt;User&gt;(""Specify a username"")
                    val responseString = stringify(serializer, response)
                    call.respond(responseString)
                } else {
                    val serializer = Message.Success.serializer(User.serializer())
                    val response = Message.Success(User(userName))
                    val responseString = stringify(serializer, response)
                    call.respond(responseString)
                }
            }
</code></pre>

<p>But now my client throws this error: <code>java.lang.RuntimeException: Failed to invoke private com.kvw.letsgo.common.Message() with no args</code></p>

<p>How do I use generics right with serialization?</p>
","6849045","","","","","2020-03-10 18:19:37","kotlinx serialization with generic message wrapper","<android><kotlin><gson><ktor><kotlinx.serialization>","0","2","","","","60623687","128262","128262","ktor","265","45915935","45915934"
"60632541","1","","","2020-03-11 09:10:18","","2","17","<p>Consider this simple <a href=""https://ktor.io/"" rel=""nofollow noreferrer"">ktor</a> server setup</p>

<pre class=""lang-kotlin prettyprint-override""><code>@Location(""/user"") data class User(val id: Long)

fun Application.module(testing: Boolean = false) {
    install(Locations)
    routing {
        get&lt;User&gt; {
            call.respondText(""User[id: ${id}]"")
        }
    }
}
</code></pre>

<p>Getting <code>/user?id=123</code> works fine resulting in <code>User [id 123]</code>.</p>

<p>However getting <code>/user</code> yields <code>HTTP 404</code> but a <code>HTTP 400</code> make much more sense here.</p>

<p>How can I</p>

<ol>
<li>Serve <code>400</code> instead of <code>404</code> in such case?</li>
<li>Attach a custom
error handler for missing query parameters so I can provide clients
with information about what they got wrong?</li>
</ol>

<p>sidenote: I also filled <a href=""https://github.com/ktorio/ktor/issues/1711"" rel=""nofollow noreferrer"">an issue</a> in the ktor github repository for this.</p>

<p>Thanks in advance!</p>
","5698865","","","","","2020-03-11 09:10:18","How to serve HTTP 400 when missing Location parameters?","<kotlin><ktor>","0","0","1","","","60632541","128262","128262","ktor","265","45915935","45915934"
"60642365","1","","","2020-03-11 18:23:44","","0","59","<p>I'm trying to build a Kotlin JS application targeting the browser.</p>

<p>I wan't to request a REST API with Ktor Client, Kotlin Serialization and Coroutines. My <code>build.gradle.kts</code> look like this:</p>

<pre class=""lang-kotlin prettyprint-override""><code>dependencies {
    val serializationVersion = ""0.20.0""
    val ktorVersion = ""1.3.1""
    implementation(kotlin(""stdlib-js""))
    implementation(""io.ktor:ktor-client-core:$ktorVersion"")
    implementation(""io.ktor:ktor-client-js:$ktorVersion"")
    implementation(""io.ktor:ktor-client-serialization-js:$ktorVersion"")
    implementation(""org.jetbrains.kotlinx:kotlinx-serialization-runtime-js:$serializationVersion"")
    implementation(""org.jetbrains.kotlinx:kotlinx-serialization-runtime-common:$serializationVersion"")
    implementation(""org.jetbrains.kotlinx:kotlinx-coroutines-core-js:1.3.3"")
    implementation(npm(""abort-controller"", ""3.0.0""))
    implementation(npm(""bufferutil"", ""4.0.1""))
    implementation(npm(""utf-8-validate"", ""5.0.2""))
    implementation(npm(""fs"", ""0.0.1-security""))
    implementation(npm(""text-encoding"", ""0.7.0""))
}

kotlin.target.browser {
    dceTask {
        dceOptions {
            keep(""ktor-ktor-io.\$\$importsForInline\$\$.ktor-ktor-io.io.ktor.utils.io"")
        }
    }
}

</code></pre>

<p>When I try to run the application by calling <code>./gradlew run</code>, I'm getting following error on the console:</p>

<pre><code>WARNING in /PATH_TO_PROJECT_DIRECTORY/build/js/packages_imported/ktor-ktor-client-core/1.3.1/ktor-ktor-client-core.js 16700:13-32
Critical dependency: the request of a dependency is an expression
 @ ./kotlin/MyProject.js
 @ multi ./kotlin/MyProject.js

ERROR in /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/node-gyp-build/index.js
Module not found: Error: Can't resolve 'fs' in '/PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/node-gyp-build'
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/node-gyp-build/index.js 1:9-22
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/utf-8-validate/index.js
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/ws/lib/Validation.js
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/ws/lib/Receiver.js
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/node_modules/ws/index.js
 @ /PATH_TO_PROJECT_DIRECTORY/build/js/packages_imported/ktor-ktor-client-core/1.3.1/ktor-ktor-client-core.js
 @ ./kotlin/MyProject.js
 @ multi ./kotlin/MyProject.js
</code></pre>

<p>I already tried to remove <code>implementation(npm(""fs"", ""0.0.1-security""))</code> but it don't make any differences.</p>

<p>Does anybody have a clue?</p>

<p>Thanks</p>
","3025757","","","","","2020-03-12 20:09:46","Kotlin JS error Ktor client resolving 'fs'","<kotlin><ktor><kotlin-js>","1","2","","","","60642365","128262","128262","ktor","265","45915935","45915934"
"60652474","1","","","2020-03-12 10:46:25","","1","13","<p>I have a ktor server that exposes an API to my android client. It has its own database, some signup structure, and all the standard stuff. But now, a part of my database is getting filled with data from an 3rd party database, which I can only reach via it's own API. That means my server is a client on itself. I know this might not be the best structure, but that's how it is right now. So I need an HTTPClient for my server I think. For that I need to use an engine, but should I use the same engine as the one that I use for my server? How do I set it up in my DI, Koin, so that my services have access to the HTTPClient (factory or single)
Right now I set up the server part like this:</p>

<pre class=""lang-kotlin prettyprint-override""><code>fun main(args: Array&lt;String&gt;): Unit = io.ktor.server.netty.EngineMain.main(args)

@Suppress(""unused"") // Referenced in application.conf
@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {
    install(ContentNegotiation) {
        serialization()
    }
    install(Koin) {
        modules(
            KoinModules.exposedModule,
            KoinModules.repositoryModule
        )
    }

    val userRepository by inject&lt;UserRepository&gt;()

    routing {
    ...
</code></pre>

<p>application.conf</p>

<pre><code>ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ com.kvw.letsgo.server.ApplicationKt.module ]
    }
}
</code></pre>

<p>Should I change my main(), lose application.conf and code it by hand so that I use the same engine?</p>
","6849045","","","","","2020-03-12 10:46:25","How to connect to external api on ktor server","<ktor><koin><ktor-client>","0","0","1","","","60652474","128262","128262","ktor","265","45915935","45915934"
"60683684","1","","","2020-03-14 14:16:02","","1","64","<p>I try to use the Route.static function to serve static files, but it doesn't work. I have tried all kinds of combinations and folders in my working directory. Now I have a css under resources/static/css, and index.html under resources/static. If I write the following I don't get served anything : </p>

<pre><code>@kotlin.jvm.JvmOverloads
fun Application.module(testing: Boolean = false) {

    val client = HttpClient(Apache) {}

    routing {
      static(""root"") {
        files(""css"")
        default(""index.html"")
      }
   }
}
</code></pre>

<p>I can however, from this answer : <a href=""https://stackoverflow.com/questions/50901472/ktor-static-content-routing"">Ktor - Static content routing</a>, write :</p>

<pre><code>        resource(""/"", ""index.html"")
        resource(""*"", ""index.html"")
</code></pre>

<p>Then I will get index.html under resources/static. I cannot however get anything else. What am I doing wrong here ?</p>

<p>Ref : <a href=""https://ktor.io/servers/features/static-content.html#specifying-files-and-folders"" rel=""nofollow noreferrer"">https://ktor.io/servers/features/static-content.html#specifying-files-and-folders</a></p>
","12182754","","","","","2020-04-26 23:06:02","Cannot serve static content with Ktor","<kotlin><ktor>","1","0","1","","","60683684","128262","128262","ktor","265","45915935","45915934"
"60692010","1","60719155","","2020-03-15 10:40:32","","0","60","<p>The official tutorial from <a href=""https://ktor.io/servers/deploy/hosting/google-app-engine.html"" rel=""nofollow noreferrer"">Ktor.io</a> doesn't work, I tried it.
It's my first deploy. Thanks for help.</p>

<p>My gradle file (kts):</p>

<pre><code>import com.google.cloud.tools.gradle.appengine.appyaml.AppEngineAppYamlExtension

buildscript {
    dependencies {
        classpath(""com.google.cloud.tools:appengine-gradle-plugin:2.2.0"")
    }
}

apply {
    plugin(""com.google.cloud.tools.appengine"")
}

plugins {
    // Support for Kotlin
    id(""org.jetbrains.kotlin.jvm"") version ""1.3.61""
    // Support for building a CLI application
    application
    // Documentation
    id(""org.jetbrains.dokka"") version ""0.10.1""

    war
//    id(""com.improve_future.harmonica"") version ""1.1.24""
}

application {
    mainClassName = ""com.easythings.parkkometr.AppKt""
    group = ""com.easythings""
    version = ""0.0.1""
}

sourceSets {
    main {
        java.srcDir(""app/main/src"")
        resources.srcDir(""app/main/resources"")
    }
    test {
        java.srcDir(""app/test/src/"")
        resources.srcDir(""app/test/resources/"")
    }
}

repositories {
    jcenter()
    maven { setUrl(""https://kotlin.bintray.com/ktor"") }
}

dependencies {
    val ktorVersion: String by project
    val logbackVersion: String by project
    val exposedVersion: String by project
    val pgVersion: String by project
    val spekVersion: String by project
    val sendGridVersion: String by project
    val assertJVersion: String by project

    // Kotlin ============================================================================
    implementation(platform(""org.jetbrains.kotlin:kotlin-bom""))
    implementation(""org.jetbrains.kotlin:kotlin-stdlib-jdk8"")

    // Libs ============================================================================
    // Ktor - framework
    implementation(""io.ktor"", ""ktor-server-jetty"", ktorVersion)
    implementation(""io.ktor"", ""ktor-server-core"", ktorVersion)
    implementation(""io.ktor"", ""ktor-server-host-common"", ktorVersion)
    implementation(""io.ktor"", ""ktor-auth"", ktorVersion)
    implementation(""io.ktor"", ""ktor-auth-jwt"", ktorVersion)
    implementation(""io.ktor"", ""ktor-gson"", ktorVersion)
    implementation(""io.ktor"", ""ktor-network-tls-certificates"", ktorVersion)

    // Logback - application logger
    implementation(""ch.qos.logback"", ""logback-classic"", logbackVersion)

    // Exposed - orm
    implementation(""org.jetbrains.exposed"", ""exposed-core"", exposedVersion)
    implementation(""org.jetbrains.exposed"", ""exposed-dao"", exposedVersion)
    implementation(""org.jetbrains.exposed"", ""exposed-jdbc"", exposedVersion)
    implementation(""org.jetbrains.exposed"", ""exposed-jodatime"", exposedVersion)

    // Postgresql - database driver
    implementation(""org.postgresql"", ""postgresql"", pgVersion)

    // SendGrid - mailer
    implementation(""com.sendgrid"", ""sendgrid-java"", sendGridVersion)

    // Deploy ============================================================================
    providedCompile(""com.google.appengine"", ""appengine"", ""1.9.60"")

    // Tests ============================================================================
}

tasks {
    dokka {
        outputDirectory = ""$buildDir/docs/dokka""
        outputFormat = ""html""
    }

    test {
        useJUnitPlatform {
            includeEngines(""spek2"")
        }
    }
}

configure&lt;AppEngineAppYamlExtension&gt; {
    deploy {
        setAppEngineDirectory(""."")
        version = ""1""
        projectId = ""XYZ-placeholder""
        stopPreviousVersion = true  // default - stop the current version
        promote = true              // default - &amp; make this the current version
    }
    stage {
        setAppEngineDirectory(""."")
    }
}
</code></pre>

<p>My app.yaml file:</p>

<pre><code>runtime: java
env: flex

handlers:
  - url: /.*
    script: this field is required, but ignored
</code></pre>

<p>I get information that the deploy has finished successfully, but I get a 403 error when I call <code>gcloud app browse</code>.</p>

<blockquote>
  <p>HTTP ERROR 403 Problem accessing /. Reason:</p>

<pre><code>Forbidden
</code></pre>
</blockquote>

<p>I think that my app doesn't start and it's the error from Jetty, but I don't know how to check/confirm and fix it.</p>

<p>The task <code>appengineRun</code> doesn't exist in this version GAE.</p>
","10632815","","","","","2020-03-17 09:04:19","How to deploy Ktor app on Google App Engine?","<google-app-engine><deployment><ktor>","1","0","","","","60692010","128262","128262","ktor","265","45915935","45915934"
"60712864","1","","","2020-03-16 20:34:09","","1","34","<p>I'm implementing a server using Ktor, and one of the calls is to get a (potentially large) list of users that will come from a database query. I would like to chunk my response, so my user call looks like this:</p>

<pre><code>    fun users() =
        flow {
            emit(""A"")
            emit(""B"")
            emit(""C"")
        }
</code></pre>

<p>Where the emit calls will eventually be replaced with data from a result set. The route looks like this:</p>

<pre><code>        route(""Users"") {
            get() {
                call.respondTextWriter {
                    users().collect { write(it) }
                    flush()
                }
            }
            // other calls, e.g. post(), delete(), etc.
</code></pre>

<p>However, both calls to <code>write</code> and <code>flush</code> show a warning: ""Inappropriate blocking method call"". What am I missing?</p>

<p>Thanks.</p>
","2997623","","","","","2020-03-16 21:24:25","Ktor respondTextWriter complaining about inappropriate blocking method call","<kotlin-coroutines><ktor>","1","0","","","","60712864","128262","128262","ktor","265","45915935","45915934"
"60748926","1","","","2020-03-18 23:33:50","","0","13","<p>I'm currently trying to implement the following pattern with Features, Pipelines and Interceptors:</p>

<pre><code>auth {
    limit(1) {
        get {
            call.respond(""Cake1"")
        }
    }
}
</code></pre>

<p>In both features, I use  this:</p>

<pre><code>pipeline.insertPhaseAfter(ApplicationCallPipeline.Features, myCustomPhase)
pipeline.intercept(appTokenAuthPhase)
</code></pre>

<p>I'm having the following two issues:</p>

<ol>
<li>When using PhaseAfter, the order is wrong. Auth should be called first, Limit should be called second. Why is Limit first? How can I prevent this? Note: It should always depend on the code sequence, first block should be executed first. For some unknown reason it works as expected with PhaseBefore. But this seems inconsistent. The methods put the Phase in place to other Phases, but perform no Ordering for the merge. How is this done?</li>
</ol>

<p><strong>insertPhaseAfter</strong></p>

<blockquote>
  <p>[Phase('Setup'), Phase('Monitoring'), Phase('Features'), Phase('Limit'), Phase('Call'), Phase('Fallback')]</p>
  
  <p>[Phase('Setup'), Phase('Monitoring'), Phase('Features'), Phase('Auth'), Phase('Call'), Phase('Fallback')]</p>
</blockquote>

<p><strong>insertPhaseBefore</strong></p>

<blockquote>
  <p>[Phase('Setup'), Phase('Monitoring'), Phase('Auth'), Phase('Features'), Phase('Call'), Phase('Fallback')]</p>
  
  <p>[Phase('Setup'), Phase('Monitoring'), Phase('Limit'), Phase('Features'), Phase('Call'), Phase('Fallback')]</p>
</blockquote>

<ol start=""2"">
<li>I would like to delete Phase Interceptors.</li>
</ol>

<pre><code>rate(100) {
 route(""/sub"") {
   rate(5) {
     get(""/critical"") {
       call.respondText(""Hello, World!"")
     }
   }
   get(""/profile/{id}"") { TODO(""..."") }
 }
}
</code></pre>

<p>So for /sub/critical only the Interceptor with Rate(5) should be called, and Rate(100) should be skipped. Is this possible in the current architecture? I see no way to override the merge and delete all but the ""last"" interceptor for the Phase ""Limit"". The other ""Limit"" should stay in place for all pipelines without an ""Limit"" as a child. Other Interceptors (like Auth) should be performed as usual.</p>
","6874359","","6874359","","2020-03-18 23:51:53","2020-03-18 23:51:53","Ktor Interceptor Ordering for same Phase and overriding","<kotlin><ktor>","0","0","","","","60748926","128262","128262","ktor","265","45915935","45915934"
"60783637","1","","","2020-03-21 01:29:36","","0","28","<p>I have a Ktor application where I would like to validate the clients identity using a x509 certificate on the client (as they do using spring boot at <a href=""https://www.baeldung.com/x-509-authentication-in-spring-security#Mutual"" rel=""nofollow noreferrer"">https://www.baeldung.com/x-509-authentication-in-spring-security#Mutual</a>).</p>

<p>However I cannot seem to find any documentation about this. Is this even possible in Ktor at the moment without, for example, using an external OAuth2 server?</p>

<p>It seems like there is a trivial solution out there which I am missing. </p>
","3013116","","3013116","","2020-03-21 01:46:20","2020-03-21 01:46:20","Client authentication with certificate in Ktor","<x509><ktor><mutual-authentication>","0","0","","","","60783637","128262","128262","ktor","265","45915935","45915934"
"60840847","1","","","2020-03-24 23:23:29","","0","10","<p>I am working with an endpoint that is not very flexible.  It basically only gives me 10 responses at a time with a few fields that give me some context:</p>

<pre><code>{
'num_pages': n,
'page': m, // where m &lt;= n,
'total_records': t, // where t = n*10
'records': [ ... ] // sizeOf(records) == 10
}
</code></pre>

<p>So I basically spin off <code>num_pages</code> async requests and build the requests as such:</p>

<pre><code>val baseUrl = ""http://localhost/path/to/endpoint""
repeat(num_pages) {page -&gt;
    client.get&lt;String&gt;(""$baseUrl?page=$page}"")
}
</code></pre>

<p>But I'm wondering if there's a better way to do this.  As sometimes, even after configuring the <code>HttpClient</code> (either apache or CIO), I get timeouts, connection reset by peer, and <code>cancellationexceptions</code>.</p>

<p>In short what is the appropriate way to handle this case using ktor? <code>num_pages</code> in this context can be as large as 200.  I've noticed ktor supports streaming, but I don't think this applies in this context.</p>
","194598","","","","","2020-03-24 23:23:29","Requests to API endpoint that has many pages","<kotlin><ktor>","0","0","","","","60840847","128262","128262","ktor","265","45915935","45915934"
"60886843","1","","","2020-03-27 13:19:05","","0","12","<p>i've an api rest made in ktor.
I've installed Micrometer and i think i'm sending metrics, but my problem now it's do a prebuilt panel in grafana. Most of publics are based in prometheus, but i'm using graphite. My question is, there is an easier way to integrate metrics and auto build the panel?</p>
","988283","","","","","2020-03-27 13:19:05","Easier metrics panel in grafana for ktor","<grafana><ktor>","0","0","","","","60886843","128262","128262","ktor","265","45915935","45915934"
"60898585","1","","","2020-03-28 07:48:30","","0","19","<p>I am currently trying out Ktor. But it already fails on registering a onClickListener to the button. </p>

<p>I am just wondering because the onClick extends from String. If I click on the onClick the Code I get is this one:</p>

<pre><code>var CommonAttributeGroupFacade.onClick : String
    get()  = attributeStringString.get(this, ""onclick"")
    set(newValue) {attributeStringString.set(this, ""onclick"", newValue)}
</code></pre>

<p>So I think onClick has a getter and setter but not more. I installed location and FreeMarker so this is my route:</p>

<pre><code>get&lt;CharityRoute&gt; {
            val id = it.id
            call.respondHtml {
                body {
                    h1 { +""${it.id}"" }
                    ul {
                        for (n in it.list) {
                            li { +""$n"" }
                        }
                    }
                    button {
                        text(""Run function"")
                        onClick = ""Hello""
                    }
                }
            }
        }
</code></pre>

<p>Maybe someone has more experience with Ktor and especially with Kotlinx. </p>
","4843155","","","","","2020-03-28 07:48:30","Add onClick to Button in Ktor with Kotlinx","<kotlin><freemarker><ktor><kotlinx>","0","0","","","","60898585","128262","128262","ktor","265","45915935","45915934"
"60903856","1","","","2020-03-28 16:52:24","","1","29","<p>I am trying to run this example on an Android device with a ktor server but I have this error.</p>

<p>I have seen that there is some kind of incompatibility between Android and the <code>java.util.Base64</code> class that is used in one of the ktor libraries, but I don't know how to replace it.</p>

<pre><code>Process: me.amryousef.webrtc_demo, PID: 19499
    java.lang.NoClassDefFoundError: Failed resolution of: Ljava/util/Base64;
        at io.ktor.util.Base64JvmKt.encodeBase64(Base64Jvm.kt:15)
        at io.ktor.client.features.websocket.WebSocketContent.&lt;init&gt;(WebSocketContent.kt:17)
        at io.ktor.client.features.websocket.WebSockets$Feature$install$1.invokeSuspend(WebSockets.kt:37)
        at io.ktor.client.features.websocket.WebSockets$Feature$install$1.invoke(WebSockets.kt)
        at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278)
        at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63)
        at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137)
        at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157)
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23)
        at io.ktor.client.HttpClient.execute(HttpClient.kt:152)
        at io.ktor.client.call.HttpClientCallKt.call(HttpClientCall.kt:80)
        at io.ktor.client.call.UtilsKt.call(utils.kt:16)
        at io.ktor.client.features.websocket.BuildersKt.webSocketRawSession(builders.kt:105)
        at io.ktor.client.features.websocket.BuildersKt.webSocketSession(builders.kt:25)
        at io.ktor.client.features.websocket.BuildersKt.webSocket(builders.kt:59)
        at io.ktor.client.features.websocket.BuildersKt.ws(builders.kt:92)
        at io.ktor.client.features.websocket.BuildersKt.ws$default(builders.kt:91)
        at me.amryousef.webrtc_demo.SignallingClient$connect$1.invokeSuspend(SignallingClient.kt:56)
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
        at kotlinx.coroutines.DispatchedTask.run(Dispatched.kt:238)
        at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:594)
        at kotlinx.coroutines.scheduling.CoroutineScheduler.access$runSafely(CoroutineScheduler.kt:60)
        at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:742)
     Caused by: java.lang.ClassNotFoundException: Didn't find class ""java.util.Base64"" on path: DexPathList[[zip file ""/data/app/me.amryousef.webrtc_demo-1/base.apk""],nativeLibraryDirectories=[/data/app/me.amryousef.webrtc_demo-1/lib/x86, /data/app/me.amryousef.webrtc_demo-1/base.apk!/lib/x86, /vendor/lib, /system/lib]]
        at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:56)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:511)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:469)
        at io.ktor.util.Base64JvmKt.encodeBase64(Base64Jvm.kt:15) 
        at io.ktor.client.features.websocket.WebSocketContent.&lt;init&gt;(WebSocketContent.kt:17) 
        at io.ktor.client.features.websocket.WebSockets$Feature$install$1.invokeSuspend(WebSockets.kt:37) 
        at io.ktor.client.features.websocket.WebSockets$Feature$install$1.invoke(WebSockets.kt) 
        at io.ktor.util.pipeline.SuspendFunctionGun.loop(PipelineContext.kt:278) 
        at io.ktor.util.pipeline.SuspendFunctionGun.access$loop(PipelineContext.kt:63) 
        at io.ktor.util.pipeline.SuspendFunctionGun.proceed(PipelineContext.kt:137) 
        at io.ktor.util.pipeline.SuspendFunctionGun.execute(PipelineContext.kt:157) 
        at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:23) 
        at io.ktor.client.HttpClient.execute(HttpClient.kt:152) 
        at io.ktor.client.call.HttpClientCallKt.call(HttpClientCall.kt:80) 
        at io.ktor.client.call.UtilsKt.call(utils.kt:16) 
        at io.ktor.client.features.websocket.BuildersKt.webSocketRawSession(builders.kt:105) 
        at io.ktor.client.features.websocket.BuildersKt.webSocketSession(builders.kt:25) 
        at io.ktor.client.features.websocket.BuildersKt.webSocket(builders.kt:59) 
        at io.ktor.client.features.websocket.BuildersKt.ws(builders.kt:92) 
        at io.ktor.client.features.websocket.BuildersKt.ws$default(builders.kt:91) 
        at me.amryousef.webrtc_demo.SignallingClient$connect$1.invokeSuspend(SignallingClient.kt:56) 
        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33) 
        at kotlinx.coroutines.DispatchedTask.run(Dispatched.kt:238) 
        at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:594) 
        at kotlinx.coroutines.scheduling.CoroutineScheduler.access$runSafely(CoroutineScheduler.kt:60) 
        at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:742) 
        Suppressed: java.lang.ClassNotFoundException: java.util.Base64
        at java.lang.Class.classForName(Native Method)
        at java.lang.BootClassLoader.findClass(ClassLoader.java:781)
        at java.lang.BootClassLoader.loadClass(ClassLoader.java:841)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:504)
                ... 24 more
     Caused by: java.lang.NoClassDefFoundError: Class not found using the boot class loader; no stack trace available`
</code></pre>
","13061426","","7508700","","2020-03-29 09:39:27","2020-03-29 09:39:27","Error in Signalling on Ktor Server from android device","<kotlin><base64><webrtc><signals><ktor>","0","3","","","","60903856","128262","128262","ktor","265","45915935","45915934"
"60924266","1","61035247","","2020-03-30 04:52:43","","2","34","<p>I have an application with a Gradle module structure similar to this:</p>

<ul>
<li><code>app - applies war</code></li>
<li><code>common/utilities</code></li>
<li><code>common/auth</code>
etc.</li>
</ul>

<p>The <code>app</code> module applies the WAR plugin. When deployed to a remote server, this exception comes back:</p>

<pre><code>Caused by: java.lang.TypeNotPresentException: Type [SomeClass] not present
    at sun.reflect.generics.factory.CoreReflectionFactory.makeNamedType(CoreReflectionFactory.java:117)
    at sun.reflect.generics.visitor.Reifier.visitClassTypeSignature(Reifier.java:125)
    at sun.reflect.generics.tree.ClassTypeSignature.accept(ClassTypeSignature.java:49)
    at sun.reflect.generics.visitor.Reifier.reifyTypeArguments(Reifier.java:68)
    at sun.reflect.generics.visitor.Reifier.visitClassTypeSignature(Reifier.java:138)
    at sun.reflect.generics.tree.ClassTypeSignature.accept(ClassTypeSignature.java:49)
    at sun.reflect.generics.repository.ClassRepository.getSuperclass(ClassRepository.java:90)
    at java.lang.Class.getGenericSuperclass(Class.java:777)
    at org.kodein.di.TypeReference.&lt;init&gt;(types.kt:272)
</code></pre>

<p>Clearly, classes from depended-on modules are not being brought into the WAR somehow (which is exposed via Kodein service locator usage) - this is not intuitive since that wouldn't be the case if it was packaged into a JAR or AAR.</p>

<p>Anyone know why this may be happening and how I can change my Gradle configuration to fix it?</p>

<hr>

<p>Edit: if I expand the WAR, I see external Maven dependencies are brought into <code>lib</code> as JARs along with non-app modules. All of the compiled Kotlin classes from the <code>app</code> module are in <code>classes</code>. I guess it's not working because the main app JAR is not bringing in the module JARs, for some reason.</p>
","309644","","309644","","2020-03-31 04:38:40","2020-04-04 21:47:24","WAR - Gradle multi-module app - TypeNotPresentException","<java><gradle><war><ktor><typenotpresentexception>","1","3","","","","60924266","128262","128262","ktor","265","45915935","45915934"
"60941456","1","","","2020-03-31 00:06:15","","0","29","<p>I have a Ktor server running with kotlinx.serialization as it's json (de)serializer
I send my Ktor a message like this one:</p>

<pre><code>{
  ""Brick(partNumber=004229, partName=Sticker Sheet for Set 295-1, dataSource=Rebrickable, brickImage=null, categoryID=58)"": 5
}
</code></pre>

<p>which is a pair of an Int and this class:</p>

<pre class=""lang-kotlin prettyprint-override""><code>import kotlinx.serialization.Serializable

@Serializable
data class Brick(
    val partNumber: String,
    val partName: String,
    val dataSource: String,
    val brickImage: String?,
    val categoryID: Int?
)
</code></pre>

<p>But I get this error</p>

<pre><code>kotlinx.serialization.json.JsonDecodingException: Invalid JSON at 0: Expected '[, kind: MAP'
    at kotlinx.serialization.json.internal.JsonReader.fail(JsonReader.kt:293)
</code></pre>

<p>Which to me means that kotlinx.serialization expects a different syntax for the map class. Which is odd to me. When I change the type into List> it throws the same exception but with LIST instead of MAP.
EDIT: Upon further inspection, it expects a [ instead of a { at the start of the line.
My (partial) application implementation</p>

<pre class=""lang-kotlin prettyprint-override""><code>fun Application.module(testing: Boolean = false) {
    install(ContentNegotiation) { serialization() }
    routing {
        route(""user"") {
            route(""brick"") {
                post {
                    call.request.queryParameters[""userName""]
                        ?.let { userRepository.login(it) } // Someone else is still working login nvm this
                        ?.let { user -&gt;
                            val bricks = call.receive&lt;Map&lt;Brick, Int&gt;&gt;() // This throws an error
                            userRepository.addBricks(user, bricks)
                            call.respond(HttpStatusCode.OK)
                        }
                        ?: call.respond(HttpStatusCode.Unauthorized)
                }
            }
        }
    }
}
</code></pre>

<p>The android retrofit function that sends the class (using GSON):</p>

<pre class=""lang-kotlin prettyprint-override""><code>    @POST(""/user/brick"")
    suspend fun setBricksAmounts(
        @Query(""userName"")
        userName: String,
        @Body
        brickAmounts: Map&lt;Brick, Int&gt;
    )
</code></pre>
","6849045","","6849045","","2020-03-31 00:15:54","2020-03-31 11:49:21","Receive Map in ktor server using kotlinx.serialization","<json><dictionary><kotlin><ktor><kotlinx.serialization>","1","0","","","","60941456","128262","128262","ktor","265","45915935","45915934"
"60990140","1","","","2020-04-02 11:07:13","","0","20","<p>I am using firebase token to verify my https call s to my ktor server. How can I install jwt authentication in ktor to verify the token? Now I am using a custom jwt and install authentication like given below</p>

<pre><code>    install(Authentication) {
    jwt {
        verifier(myJWT.verifier)
        validate {
            UserIdPrincipal(it.payload.getClaim(""key"").asString())
        }
      }
    }
</code></pre>

<p>But when I am using firebase token I don't have an issuer. How can I solve this issue?</p>
","8209569","","","","","2020-04-02 11:07:13","How to install JWT authentication in ktor and the JWT token is created by firebase authentication system","<firebase><firebase-authentication><firebase-admin><ktor>","0","3","","","","60990140","128262","128262","ktor","265","45915935","45915934"
"61009367","1","","","2020-04-03 10:01:34","","0","17","<p>I'm using the KTOR multiplatform project template in IntelliJ (New Project -> Kotlin -> JS Client and JVM Server). Is there any way, when running the project in IntelliJ, to pick up runtime changes to the JS build? When I look at the classpath of the running JVM I don't see where the JS files are being picked up from at all.</p>
","45062","","","","","2020-04-03 10:01:34","How to make ktor reload JS changes at runtime","<kotlin><ktor>","0","0","","","","61009367","128262","128262","ktor","265","45915935","45915934"
"61011842","1","","","2020-04-03 12:22:03","","1","51","<p>Kotlin official documentation tells that it supports web development. And its replacement for java. I am trying to build a web application using Kotlin. So far I read so many blogs, courses and videos in YouTube but I did not succeed coming up with a flow. I came across this link <a href=""https://medium.com/bcgdv-engineering/building-a-full-stack-web-app-in-kotlin-af8e8fe1f5dc"" rel=""nofollow noreferrer"">https://medium.com/bcgdv-engineering/building-a-full-stack-web-app-in-kotlin-af8e8fe1f5dc</a> and I could not proceed with this alone. I only need a front end and connect to my server with normal http request. Is there any right way of doing a web app in kotlin. Please help me with this. Thanks in advance!</p>
","4489182","","","","","2020-04-05 07:07:05","Can we build a full stack webapp with kotlin?","<kotlin><web-applications><ktor><spring-kotlin>","1","2","1","","","61011842","128262","128262","ktor","265","45915935","45915934"
"61015309","1","","","2020-04-03 15:31:56","","0","9","<p>i am giving a try to ktor, able to setup the project successfully but when i change <code>Application.kt</code> the project doesn't reload and the changes are not reflected in the browser.</p>

<p>here is my <code>application.conf</code> file </p>

<pre><code>ktor {
  deployment {
    port = 8080
    host = ""localhost""
    watch = [ktorTest]
  }
  application {
    modules = [com.ktorTest.ApplicationKt.module]
  }
}
</code></pre>

<p>And run output </p>

<pre><code>2020-04-03 20:37:51.893 [main] DEBUG Application - Watching D:\Project\temp\build\classes\kotlin\main\com\ktorTest for changes.
2020-04-03 20:37:52.890 [main] INFO  Application - Responding at http://localhost:8080
</code></pre>
","7639541","","","","","2020-04-03 15:31:56","While using ktor autoreload chages are not reflecting in browser","<kotlin><ktor>","0","0","","","","61015309","128262","128262","ktor","265","45915935","45915934"
"61060293","1","","","2020-04-06 12:50:57","","0","34","<p>I want to create a simple form where user enters some string (key that authorizes them to upload a file) and the file they want to upload (no size limit, can be even 10GB or more).</p>

<p>The problem I have is that I don't know how to verify the code BEFORE accepting the file.</p>

<p>So far I have this code that disallows any upload even with a valid code since the uploaded file seems to be always the first form element to be checked.
(when I reversed the order of elements in the form this code didn't handle the request at all)</p>

<pre><code>            var isAuth = false
            multipart.forEachPart { part -&gt;
                when (part) {
                    is PartData.FormItem -&gt; {
                        val name = part.name
                        if(name != null &amp;&amp; name == ""key"")
                            isAuth = isKeyValid(part.value)
                    }
                    is PartData.FileItem -&gt; {
                        if(!isAuth) {
                            call.respond(""Request not authorized"")
                            call.response.status(HttpStatusCode.Forbidden)
                            part.dispose
                            return@forEachPart
                        }
                        if(part.originalFileName.isNullOrEmpty() || part.originalFileName!!.isBlank()) {
                            call.respond(""Illegal filename"")
                            call.response.status(HttpStatusCode.BadRequest)
                            return@forEachPart
                        }
                        val targetDir = File(uploadDir.path + File.separator + randomId)
                        targetDir.mkdir()
                        val targetFile = File(targetDir.path + File.separator + part.originalFileName)
                        targetFile.createNewFile()
                        sb.append(randomId)
                        sb.append(""/"")
                        sb.append(part.originalFileName)
                        sb.append(""\n"")
                        part.streamProvider().use { input -&gt; targetFile.outputStream().buffered().use { output -&gt; input.copyToSuspend(output) } }
                    }
                }
                part.dispose
            }

</code></pre>

<p>HTML form I'm using:</p>

<pre><code>&lt;html&gt;
&lt;body&gt;
&lt;form action=""/upload"" method=""POST"" enctype=""multipart/form-data""&gt;
    &lt;input type=""file"" name=""file""&gt;
    &lt;input type=""text"" name=""key""&gt;

    &lt;input type=""submit"" value=""upload"" name=""submit""&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
","12200650","","","","","2020-04-07 17:24:06","How to authorize POST form upload in Ktor?","<kotlin><ktor>","1","2","","","","61060293","128262","128262","ktor","265","45915935","45915934"
"39026025","1","","","2016-08-18 19:22:45","","0","118","<p>I am trying to make a website which lists data in a table from a CouchDB database. I tried adding a view as seen below:</p>

<pre><code>    @View( name = ""all"", map = ""function(doc) { if (doc.type == 'sofa' ) emit( [doc.sofaID,doc.timesofa], doc._id )}"")
    public List&lt;TVreport&gt; getAllTVreports() {
        List&lt;TVreport&gt; couchresults = null;
        try {
            ViewQuery q = new ViewQuery().allDocs().includeDocs(true);
            couchresults = sofadb.queryView(q, TVreport.class);
        } catch (Exception e) {
            System.err.println(e.getMessage());
        }

        return couchresults;
}
</code></pre>

<p>This results in no change to the order of the list. I need to be able to sort by both sofaID and timesofa which I made as unique keys. I am using Ektorp Java library.</p>
","6731958","","","","","2016-08-18 19:22:45","Sorting a couchdb database by muliple fields in Java Ektorp Library","<java><sorting><couchdb><ektorp>","0","2","","","","39026025","73833","73833","ektorp","71","7739352","7739351"
"41202367","1","","","2016-12-17 19:38:36","","0","253","<p>My java application connects to CouchDB using the Ektorp persistence api <a href=""http://ektorp.org/reference_documentation.html"" rel=""nofollow noreferrer"">http://ektorp.org/reference_documentation.html</a> to store and retrieve objects. I'm trying to store a simple bean with few String properties and
using CouchDbConnector.create(mybean) to create the document and CouchDbConnector.get(mybean.class,doumentid) to retrieve the document. 
When I extend my bean with CouchDBDocument as documented here <a href=""http://ektorp.org/reference_documentation.html#d100e355"" rel=""nofollow noreferrer"">http://ektorp.org/reference_documentation.html#d100e355</a>, it works well while creating and retrieving the document but if I don't extend it with CouchDBDocument and annotate the ""id"" and the ""revision"" attributes as listed here <a href=""http://ektorp.org/reference_documentation.html#d100e31"" rel=""nofollow noreferrer"">http://ektorp.org/reference_documentation.html#d100e31</a>, then create document works but retrieve document throws this exception.</p>

<p>nested exception is org.ektorp.DbAccessException: com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field ""_id""</p>

<p>I tried various options by changing the name ""id"" to ""_id"" but it do not work. Also, I notice that when I don't extend my bean with CouchDbDocument then in the couchdb, an ""id"" and ""revision"" fields are created in the document along with ""_id"" and ""_rev"". These fields are not created when I extend CouchDbDocument. Any idea what's wrong here?</p>
","4444884","","","","","2020-03-03 18:43:27","org.ektorp.DbAccessException if POJO not extended from CouchDbDocument","<java><couchdb><ektorp>","2","0","","","","41202367","73833","73833","ektorp","71","7739352","7739351"
"42085719","1","","","2017-02-07 09:09:13","","1","137","<p>I am using Ektorp API to get from CouchDB, but to get 5 millions records it tooks 8 min(Apporx) on standalone machine. IS there any way to getch record faster.</p>

<p>I have created view on top of couchDB database and view result contains 5m records.</p>

<p>List results = db.queryView(query, Map.class);</p>

<p>where db is instance of CouchDbConnector class from Ektorp API.</p>
","5147698","","","","","2017-02-07 09:09:13","How to get large volume of CouchDb data through Java API?","<couchdb><ektorp>","0","3","","","","42085719","73833","73833","ektorp","71","7739352","7739351"
"45049302","1","","","2017-07-12 05:43:48","","0","427","<p>I have gone through all the blogs available for the ektrop library and also the source code of the library.I have found that <strong>get(class obj,String id)</strong> function is available but If I use this function then only one document will be returned according to the id given.So <strong>I want to read all the changed documents present in the bucket</strong>.How Can I achieve this.Thanks in advance any help would be appreciable.</p>
","4788592","","4788592","","2017-07-14 03:28:31","2017-07-14 03:28:31","How to find all documents in couchDB using ektrop library","<couchdb><ektorp>","2","0","","","","45049302","73833","73833","ektorp","71","7739352","7739351"
"45714575","1","45716530","","2017-08-16 13:12:55","","2","198","<p>I'm using Ektorp as CouchDB ""ORM"" but this question seems to be more general than that. Could someone explain what is the difference between</p>

<pre><code>@JsonInclude(NON_NULL)
abstract class AbstractEntity(
        id: String?,
        revision: String?
) {

    @JsonProperty(""_id"")
    val id: String? = id

    @JsonProperty(""_rev"")
    val revision: String? = revision

}
</code></pre>

<p>and </p>

<pre><code>@JsonInclude(NON_NULL)
abstract class AbstractEntity(
        @JsonProperty(""_id"")
        val id: String? = null,
        @JsonProperty(""_rev"")
        val revision: String? = null
)
</code></pre>

<p>?</p>

<p>For the first case Ektorp does not complain but for the second it says:</p>

<pre><code>org.ektorp.InvalidDocumentException: Cannot resolve revision mutator in class com.scherule.calendaring.domain.Meeting

    at org.ektorp.util.Documents$MethodAccessor.assertMethodFound(Documents.java:165)
    at org.ektorp.util.Documents$MethodAccessor.&lt;init&gt;(Documents.java:144)
    at org.ektorp.util.Documents.getAccessor(Documents.java:113)
    at org.ektorp.util.Documents.getRevision(Documents.java:77)
    at org.ektorp.util.Documents.isNew(Documents.java:85)
</code></pre>

<p>In addition to that if I do</p>

<pre><code>@JsonInclude(NON_NULL)
abstract class AbstractEntity(
        @JsonProperty(""_id"")
        var id: String? = null,
        @JsonProperty(""_rev"")
        var revision: String? = null
)
</code></pre>

<p>I get:</p>

<pre><code>org.ektorp.DbAccessException: com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field ""_id"" (class com.scherule.calendaring.domain.Meeting), not marked as ignorable
</code></pre>

<p>The question is in what way the first code snippet is different from the second? In the first case Ektorp ""thinks"" there is a mutator but not in the second...</p>

<p>Here's the code snippet which Ektorp seems to use when locating a method (setId, setRevision).</p>

<pre><code>private Method findMethod(Class&lt;?&gt; clazz, String name,
                Class&lt;?&gt;... parameters) throws Exception {
            for (Method me : clazz.getDeclaredMethods()) {
                if (me.getName().equals(name)
                        &amp;&amp; me.getParameterTypes().length == parameters.length) {
                    me.setAccessible(true);
                    return me;
                }
            }
            return clazz.getSuperclass() != null ? findMethod(
                    clazz.getSuperclass(), name, parameters) : null;
        }
</code></pre>
","1130975","","","","","2017-08-16 15:19:23","Kotlin mutators","<kotlin><ektorp>","1","0","","","","45714575","73833","73833","ektorp","71","7739352","7739351"
"61087015","1","","","2020-04-07 18:34:48","","0","15","<p>I am pretty new to Kotlin and I am trying to make a ktor exposed server with Freemarker templates to allow me to display data from the database. However, I tried to specify where the templates were, but even after I did, I still get the error of template not found. What am I doing wrong?</p>

<pre><code>   val dao = DAOFacadeDatabase(Database.connect(""jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"", driver = ""org.h2.Driver""))
fun main() {
    embeddedServer(Netty, port = 8080) {
        dao.init()
        install(FreeMarker){
            //allow the connection with the ftl files
            templateLoader = ClassTemplateLoader(this::class.java.classLoader, ""templates"")
        }

        routing {
            route(""/""){
                get{
                    call.respond(FreeMarkerContent(""Home.ftl"", null))
                }
            }
        }
    }.start(wait=true)
}
</code></pre>

<p><a href=""https://i.stack.imgur.com/P6qqz.png"" rel=""nofollow noreferrer"">Here is the package structure:</a></p>
","13251999","","","","","2020-04-07 18:34:48","FreeMarker not finding the base directory in Ktor","<kotlin><freemarker><ktor>","0","1","","","","61087015","128262","128262","ktor","265","45915935","45915934"
"61093072","1","61139365","","2020-04-08 03:55:33","","0","34","<p>I have this table schema:</p>

<pre><code>object ValuesTable : IntIdTable(""values"") {
    val parameter =
        reference(""parameters"", ParametersTable, onDelete = ReferenceOption.CASCADE, onUpdate = ReferenceOption.CASCADE)
    val service =
        reference(""services"", ServicesTable, onDelete = ReferenceOption.CASCADE, onUpdate = ReferenceOption.CASCADE)
    val values = text(""actual_values"")
}
</code></pre>

<p>When exposed tries to create my table i'm getting `java.sql.SQLException: Duplicate foreign key constraint name 'fk_values_parameters_id'. I've tried manually adding a different <strong>fkName</strong>, also tried to use a different table name starting with uppercase.</p>

<p>MySQL version is : <strong>Ver 8.0.19 for macos10.15 on x86_64 (MySQL Community Server - GPL)</strong></p>
","4487858","","","","","2020-04-10 11:29:44","Jetbrains Exposed generating duplicate foreign keys","<mysql><ktor><kotlin-exposed>","1","0","","","","61093072","128262","128262","ktor","265","45915935","45915934"
"61204100","1","","","2020-04-14 09:02:14","","1","50","<p>I'm using ""withTestAppliction"" in one of my tests to test if the route works. Before all Tests the DB-Table ""cats"" should have no entries. To get the DAO I need Koin in this Test but if conflicts with ""withTestAppliction"" where Koin will also be startet and throws <code>A KoinContext is already started</code></p>

<p>[Update]<br>
I know I could use something like <code>handleRequest(HttpMethod.Delete, ""/cats"")</code> but I don't want to expose this Rest-Interface. Not even for testing.</p>

<pre class=""lang-kotlin prettyprint-override""><code>@ExperimentalCoroutinesApi
class CatsTest: KoinTest {
    companion object {
        @BeforeClass
        @JvmStatic fun setup() {
            // once per run
            startKoin {
                modules(appModule)
            }
        }

        @AfterClass
        @JvmStatic fun teardown() {
            // clean up after this class, leave nothing dirty behind
            stopKoin()
        }
    }

    @Before
    fun setupTest() = runBlockingTest {
        val dao = inject&lt;CatDAO&gt;()
        dao.value.deleteAll()
    }

    @After
    fun cleanUp() {

    }

    @Test
    fun testCreateCat() {
        withTestApplication({ module(testing = true) }) {
            val call = createCat(predictName(""Pepples""), 22)

            call.response.status().`should be`(HttpStatusCode.Created)
        }
    }

}

fun TestApplicationEngine.createCat(name: String, age: Int): TestApplicationCall {
    return handleRequest(HttpMethod.Post, ""/cats"") {
        addHeader(HttpHeaders.ContentType, ContentType.Application.FormUrlEncoded.toString())
        setBody(listOf(
                ""name"" to name,
                ""age"" to age.toString()
        ).formUrlEncode())
    }
}

</code></pre>
","504184","","504184","","2020-04-14 09:19:19","2020-04-14 09:19:19","startKoin in KoinTest-class throws ""A KoinContext is already started""","<kotlin><ktor><koin>","0","2","","","","61204100","128262","128262","ktor","265","45915935","45915934"
"61245847","1","61433514","","2020-04-16 08:29:25","","0","37","<p>Trying to create a runnable jar for a kotlin multiplatform project which includes a ktor server component, building with Kotlin Gradle DSL.</p>

<p>I have seen several questions including <a href=""https://stackoverflow.com/questions/57168853/create-fat-jar-from-kotlin-multiplatform-project"">Create fat jar from kotlin multiplatform project</a>  which asks and answers how to create the gradle build file in Groovy, but how do you do it in kotlin dsl?</p>

<p>The groovy code that is reported to work is:</p>

<pre><code>kotlin {
jvm() {
    withJava()
    jvmJar {
        manifest {
            attributes 'Main-Class': 'sample.MainKt'
        }
        from { configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
    }
}
...
}
</code></pre>

<p>How would this translate to Kotlin DSL? I have tried many variations, some of which compile and run, but don't create the desired output... a runnable jar.</p>
","5023255","","","","","2020-04-25 22:38:20","Create fat jar from ktor Kotlin multiplatform project with Kotlin Gradle DSL","<gradle-kotlin-dsl><ktor><kotlin-multiplatform>","2","0","","","","61245847","128262","128262","ktor","265","45915935","45915934"
"61245981","1","","","2020-04-16 08:36:11","","0","9","<p>KTor works nice with unit tests but how can I start my ktor server for integration tests?</p>

<p>This is how my test looks like:</p>

<pre class=""lang-kotlin prettyprint-override""><code>@ExperimentalCoroutinesApi
class HttpClientTest {
    private val logger = LoggerFactory.getLogger(HttpClientTest::class.java.name)

    companion object {

        @BeforeClass
        @JvmStatic
        fun setup() {
            // ?????
        }

        @AfterClass
        @JvmStatic
        fun teardown() {
            // ????
        }
    }


    @Test
    fun testMitDefaultHttpClient() {
        val httpget = HttpGet(""http://0.0.0.0:8080/json/gson"")
        httpget.setHeader(""Accept"", ""application/json"")
        httpget.setHeader(""Content-Type"", ""application/json"")

        val httpclient: HttpClient = HttpClients.createDefault()
        val response = httpclient.execute(httpget)

        Assert.assertEquals(200, response.statusLine.statusCode.toLong())

        val responseString = EntityUtils.toString(response.entity)
        logger.info(responseString)
    }
}
</code></pre>
","504184","","","","","2020-04-16 09:17:07","How can I start ktor-server programmatically for Integration-Tests","<ktor>","1","0","","","","61245981","128262","128262","ktor","265","45915935","45915934"
"61275165","1","","","2020-04-17 15:25:03","","0","18","<p>Hey im struggeling by how to call the mongoDB from my ktor application inside the docker container.
When i start the application localy from like intellij the rest call is working.</p>

<p>This is the dockerfile of my ktor application</p>

<pre><code>FROM openjdk:8-jre-alpine

ENV APPLICATION_USER ktor
RUN adduser -D -g '' $APPLICATION_USER

RUN mkdir /app
RUN chown -R $APPLICATION_USER /app

USER $APPLICATION_USER

COPY ./build/libs/myapp.jar /app/myapp.jar
WORKDIR /app

CMD [""java"", ""-server"", ""-XX:+UnlockExperimentalVMOptions"", ""-XX:+UseCGroupMemoryLimitForHeap"", ""-XX:InitialRAMFraction=2"", ""-XX:MinRAMFraction=2"", ""-XX:MaxRAMFraction=2"", ""-XX:+UseG1GC"", ""-XX:MaxGCPauseMillis=100"", ""-XX:+UseStringDeduplication"", ""-jar"", ""myapp.jar""]

</code></pre>

<p>and this is the function where the post call ends</p>

<pre><code>post(""/"") {
  try {
     var postParams =  call.receive&lt;Request&gt;()
     val id = postParams.id
     var response 
     if(id != null) {
       val mongo = MongoClient()
       val db = mongo.getDatabase(""col"")
       val table = db.getCollection(""items"")

       val searchQuery = BasicDBObject();
       searchQuery.put(""_id"", id);
       val cursor = table.find(searchQuery).cursor();
       response = cursor?.next()
       call.respond(response)
....

</code></pre>

<p>the mongo container got the default ports.</p>

<p>If anybody had any suggestions i would be glad because i cannot figure it out what the problem is.</p>
","7860410","","6565093","","2020-04-17 15:34:58","2020-04-17 15:34:58","Docker how to call the mongodb from my ktor application","<java><mongodb><docker><kotlin><ktor>","0","1","","","","61275165","128262","128262","ktor","265","45915935","45915934"
"46514639","1","46567618","","2017-10-01 16:53:32","","0","69","<p>I am using this guide to configure CouchDb via Spring-boot: <a href=""https://helun.github.io/Ektorp/reference_documentation.html#d100e1161"" rel=""nofollow noreferrer"">link</a>. The problem arises when this XML configuration file</p>

<pre><code>&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;
&lt;beans xmlns=""http://www.springframework.org/schema/beans""
xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
xmlns:couchdb=""http://www.ektorp.org/schema/couchdb""
xsi:schemaLocation=""
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.ektorp.org/schema/couchdb http://www.ektorp.org/schema/couchdb/couchdb.xsd
""&gt;

 &lt;couchdb:database name=""myDatabase"" url=""http://localhost:5984""/&gt; 


&lt;/beans&gt;
</code></pre>

<p>cannot be validated, because <strong>ektorp</strong> xml schema can't be read. When I check via browser link of its schema, there isn't any, but there is one definitively in maven dependencies. But when I switch this line</p>

<pre><code>http://www.ektorp.org/schema/couchdb/couchdb.xsd
</code></pre>

<p>into</p>

<pre><code>classpath:couchdb.xsd
</code></pre>

<p>It won't be read either, even it's in one of the maven dependencies under the name couchdb.xsd. (You can inspect that file on <a href=""https://github.com/helun/Ektorp/blob/master/org.ektorp.spring/src/main/resources/org/ektorp/spring/xml/couchdb.xsd"" rel=""nofollow noreferrer"">github</a>).</p>

<p>How I can force XML reader to look into maven dependencies in order to find proper schema file?</p>
","7568895","","7568895","","2017-10-01 17:48:05","2017-10-04 14:36:15","Failed to read CouchDb schema from classpath","<java><xml><maven><xsd><ektorp>","1","2","","","","46514639","73833","73833","ektorp","71","7739352","7739351"
"47930293","1","48299514","","2017-12-21 17:55:08","","0","88","<p>Hi I want to fetch data from couchdb-view by applying reduce and pagination.</p>

<p>My view gives reduce function result as complex key as follows</p>

<pre><code>{""rows"":[
         {""key"":{""attribute"":""Attribute1""},""value"":20},
         {""key"":{""attribute"":""Attribute2""},""value"":1}
         {""key"":{""attribute"":""Attribute3""},""value"":1}
]}
</code></pre>

<p>I am trying to fetch data from couchdb using ektorp, check following code</p>

<pre><code>PageRequest pageRequest = PageRequest.firstPage(10);
ViewQuery query = new ViewQuery()
            .designDocId(""_design/medesign"")
            .viewName(""viewname"")
            .includeDocs(false)
            .reduce(true)
            .group(true);
Page&lt;ViewResult&gt; rs1 = db.queryForPage(query, pageRequest, ViewResult.class);

rs1.forEach(v -&gt; {
            System.out.println(v.getSize());
        });
</code></pre>

<p>I am getting following error</p>

<pre><code>org.ektorp.DbAccessException: com.fasterxml.jackson.databind.JsonMappingException: 
Can not construct instance of org.ektorp.ViewResult: 
no int/Int-argument constructor/factory method to deserialize from Number value (20)
at [Source: N/A; line: -1, column: -1]
</code></pre>
","787255","","","","","2018-01-18 09:49:30","Fetch Paginated view data after applying reduce in couchdb with ektorp","<java><pagination><couchdb><ektorp>","1","0","1","","","47930293","73833","73833","ektorp","71","7739352","7739351"
"51614003","1","","","2018-07-31 13:00:42","","1","31","<p>I have two basic document types:</p>

<ul>
<li>Patient with fields name and number;</li>
<li>Analysis with fields that
consist of 3 arrays, date of analysis, a bunch of floats and a
patientId, linking it to the Patient, so there's a 1:M relationship
between Patient and Analysis.</li>
</ul>

<p>I'm using Ektorp as a driver. Right now there are two POJOs, reflecting the documents, and Patient POJO also has a <code>Set&lt;Analysis&gt;</code>, marked by <code>@DocumentReferences</code> annotation (which I don't actually need yet, but might use later to show all analyses for one patient, for example). </p>

<p>However, what I want to do is use pagination to populate TableView with rows, containing info about both Patient AND Analysis, sorted by date of analysis in descending order.
Right now, my only idea is to</p>

<ol>
<li>Query CouchDB for all Analysis documents sorted by date (using
pagination via PageRequest in Ektorp)</li>
<li>Then for each analysis query db for patients with patientId</li>
<li>Make a separate class representing a row in table with fields for both patient and analysis, then create an object of that class using
retrieved Analysis and Patient objects.</li>
</ol>

<p>In code it would look somewhat like this:</p>

<pre><code>PageRequest pageRequest = PageRequest.firstPage(5);

ViewQuery query = new ViewQuery()
    .designDocId(""_design/analysis"")
    .viewName(""by_date"")
    .descending(true)
    .includeDocs(true);

Page&lt;Analysis&gt; result = db.queryForPage(query, pageRequest, Analysis.class);
for(Analysis analysis : result) {
    Patient patient = db.find(Patient.class, analysis.getPatientId());
    Row row = new Row(patient, analysis);
    //TODO: ...Populate TableView...
}
</code></pre>

<p>This all sounds very cumbersome. Is there a better way to do this? Can I deserialize data I need in one go (or at least in one query)?
I know there's <a href=""http://docs.couchdb.org/en/2.1.2/ddocs/views/joins.html#linked-documents"" rel=""nofollow noreferrer"">a way</a> to use <code>{_id: doc.patientId}</code> as a value in <code>emit()</code> function to return Patient for each Analysis when querying with parameter <code>include_docs=true</code>, but I'm not sure how to use that to my advantage.</p>

<p>I could just embed Patient in Analysis, but then I would have to change every Analysis document if there's a change in Patient, so that's not a good solution.
I've read <a href=""http://docs.couchdb.org/en/2.1.2/ddocs/views/joins.html#approach-2-comments-separate"" rel=""nofollow noreferrer"">these</a> <a href=""http://docs.couchdb.org/en/2.1.2/ddocs/views/joins.html#optimization-using-the-power-of-view-collation"" rel=""nofollow noreferrer"">two</a> paragraphs of documentation several times over, but I can't for the life of me figure out how to implement them with Ektorp.
Any help would be appreciated.</p>
","4061718","","","","","2018-07-31 13:00:42","Retrieving separate documents as one object","<java><couchdb><ektorp>","0","0","","","","51614003","73833","73833","ektorp","71","7739352","7739351"
"61291419","1","","","2020-04-18 15:11:46","","-1","19","<p>I have a problem with test my ktor application - I cannot do a post request correctly.</p>

<p>My code:</p>

<pre><code>object AdminAuthHandlerTest : Spek({
    with(ktorTestEngine()) {
        describe(""A sign-in endpoint"") {
            lateinit var call: TestApplicationCall
            beforeGroup {
                call = handleRequest(HttpMethod.Post, ""/api/admin/auth/sign-in"") {
                    addHeader(HttpHeaders.Accept, ContentType.Text.Plain.contentType)
                    addHeader(HttpHeaders.ContentType, ContentType.Application.Json.contentType)
                    setBody(jsonAsString(AdminSignInRequest(""admin"", ""admin123"")))
                }
            }
            it(""should return 200"") {
                assertThat(call.response.status()).isEqualTo(HttpStatusCode.OK)
            }
        }
    }
})
</code></pre>

<p>I get 400 (Bad Request), but my request body is correct.</p>

<p>Do you have any idea what is wrong?</p>
","10632815","","10632815","","2020-04-18 15:22:43","2020-04-18 15:22:43","How to test POST request?","<unit-testing><testing><ktor><spek>","0","0","","","","61291419","128262","128262","ktor","265","45915935","45915934"
"61339863","1","","","2020-04-21 09:10:59","","0","39","<p>When trying to start iOS app with included Kotlin/Native framework it is crashing on start with log</p>

<pre><code>dyld: Symbol not found: _in6addr_linklocal_allv2routers
</code></pre>

<p>I am using latest releases of Kotlin/Native and ktor.</p>

<p>Config:</p>

<p>Kotlin/Native (multiplatform) 1.3.71</p>

<p>ktor 1.3.2</p>

<pre><code>api(""io.ktor:ktor-client-ios:$ktorVersion"")
api(""io.ktor:ktor-client-serialization-native:$ktorVersion"")
</code></pre>

<p>This crash is not reproduced with ktor 1.3.0</p>

<p>Please also note that I am even not using ktor classes in shared module (it is literally empty) nor in iOS app project.</p>

<p>Running with XCode 11.4, on iOS simulator v12.4</p>
","3223198","","3223198","","2020-04-21 12:42:54","2020-04-21 12:42:54","iOS app crashes on start when using Kotlin/Native framework + ktor 1.3.2","<ios><ktor><kotlin-native>","0","6","","","","61339863","128262","128262","ktor","265","45915935","45915934"
"61362485","1","61434078","","2020-04-22 10:11:37","","1","50","<p>I am trying to use <strong>ktor</strong> <a href=""https://ktor.io/clients/http-client/quick-start/client.html"" rel=""nofollow noreferrer"">client</a> in Kotlin/MPP (Multiplatform) project and on JVM target feature <a href=""https://ktor.io/clients/http-client/features/auth.html#basic"" rel=""nofollow noreferrer"">basic authentication</a> does not seem to have an effect.</p>

<h3>Here is an example to reproduce:</h3>

<pre class=""lang-kotlin prettyprint-override""><code>import io.ktor.client.HttpClient
import io.ktor.client.features.ResponseException
import io.ktor.client.features.auth.Auth
import io.ktor.client.features.auth.providers.basic
import io.ktor.client.features.json.JsonFeature
import io.ktor.client.features.json.serializer.KotlinxSerializer
import io.ktor.client.features.logging.DEFAULT
import io.ktor.client.features.logging.LogLevel
import io.ktor.client.features.logging.Logger
import io.ktor.client.features.logging.Logging
import io.ktor.client.request.get
import io.ktor.client.request.header
import kotlinx.coroutines.runBlocking
import java.util.*

fun main() = runBlocking {
    val client = HttpClient {
        install(Logging) {
            logger = Logger.DEFAULT
            level = LogLevel.HEADERS
        }
        install(JsonFeature) {
            serializer = KotlinxSerializer()
        }
        install(Auth) {
            basic {
                username = ""user""
                password = ""pass""
            }
        }
    }
    val url = ""https://en.wikipedia.org/wiki/Main_Page""

    val failing = try {
        client.get&lt;String&gt;(url)
    } catch (e: ResponseException) {
        ""failed""
    }

    val succeeding = try {
        client.get&lt;String&gt;(url) {
            header(""Authorization"", ""Basic ${Base64.getEncoder().encodeToString(""user:pass"".toByteArray())}"")
        }
    } catch (e: ResponseException) {
        ""failed""
    }
}
</code></pre>

<h3>Observation</h3>

<p>From the logger output, you can see that client does not send <code>Authorization</code> header but I experience no problems when I provide such header manually:</p>

<p>First request (failing example:)</p>

<pre><code>[main] INFO io.ktor.client.HttpClient - REQUEST: https://en.wikipedia.org/wiki/Main_Page
[main] INFO io.ktor.client.HttpClient - METHOD: HttpMethod(value=GET)
[main] INFO io.ktor.client.HttpClient - COMMON HEADERS
[main] INFO io.ktor.client.HttpClient - -&gt; Accept: application/json
[main] INFO io.ktor.client.HttpClient - -&gt; Accept-Charset: UTF-8
[main] INFO io.ktor.client.HttpClient - CONTENT HEADERS
</code></pre>

<p>Second request (succeeding example:)</p>

<pre><code>[main] INFO io.ktor.client.HttpClient - REQUEST: https://en.wikipedia.org/wiki/Main_Page
[main] INFO io.ktor.client.HttpClient - METHOD: HttpMethod(value=GET)
[main] INFO io.ktor.client.HttpClient - COMMON HEADERS
[main] INFO io.ktor.client.HttpClient - -&gt; Authorization: Basic dXNlcjpwYXNz
[main] INFO io.ktor.client.HttpClient - -&gt; Accept: application/json
[main] INFO io.ktor.client.HttpClient - -&gt; Accept-Charset: UTF-8
[main] INFO io.ktor.client.HttpClient - CONTENT HEADERS

</code></pre>

<h3>Environment</h3>

<ul>
<li>Kotlin: 1.4-M1</li>
</ul>

<p>Ktor Artifacts version 1.3.1:</p>

<ul>
<li>ktor-client-core</li>
<li>ktor-client-logging</li>
<li>ktor-client-json</li>
<li>ktor-client-serialization</li>
<li>ktor-client-auth-basic</li>
</ul>

<h3>Did I miss something?</h3>
","7598113","","","","","2020-04-26 01:08:35","Ktor client Auth feature does not sending Authorization header","<kotlin><ktor><kotlin-multiplatform><ktor-client>","1","3","","","","61362485","128262","128262","ktor","265","45915935","45915934"
"61409276","1","","","2020-04-24 13:15:29","","0","25","<p>I know I can use Kotlin for the server-side, but is it really good?
 I want to create a social media app, can Kotlin operate as efficient as other back end languages like node JS or Django or Laravel?</p>
","9470643","","","","","2020-04-24 13:15:29","is it ok to use Kotlin for server side","<kotlin><server><backend><ktor>","0","3","","2020-04-24 14:55:52","","61409276","128262","128262","ktor","265","45915935","45915934"
"61414196","1","","","2020-04-24 17:36:15","","0","11","<p>I am trying to build a simple website with ktor. </p>

<p>I want to add a button with a simple onClick method / Click listener. The purpose is to update a text or a list. </p>

<p>I tried both, the kotlinx / html dsl and freemaker. But nothing works.</p>

<p>Here is the Kotlinx way:</p>

<pre><code>div(""charityWrapper"") {
              for(charity in charities) {
                    span {
                        text(charity)
                           }
                      }
                  }
    button {
             text(""Next"")
              onClick = ""Hello""
           }
</code></pre>

<p>But the onClick cant do anything. So i dont know how to change the text above or the list of charities. </p>

<p>And this is my FreeMaker file:</p>

<pre><code>&lt;#-- @ftlvariable name=""data"" type=""com.example.IndexData"" --&gt;
&lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;huhu&lt;/h1&gt;
        &lt;h2&gt;dhesfes&lt;/h2&gt;
        &lt;a href=""javascript:void(0)"" onclick=""console.log('hello')""&gt;Delete kweet&lt;/a&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>But i dont know how to call a Kotlin function on it or change the charities..</p>
","4843155","","","","","2020-04-24 17:36:15","How to change variables or texts in ktor frontend","<kotlin><ktor>","0","0","","","","61414196","128262","128262","ktor","265","45915935","45915934"
"61415016","1","","","2020-04-24 18:23:01","","0","11","<p>I currently have a TABLE object, as below and existing table in DB. I am creating a webservice using KTOR. </p>

<pre><code>object Arts: Table() {
    val id : Column&lt;Int&gt; = integer(""id"").autoIncrement().primaryKey()
    val title = varchar(""title"" , 256)
    val description = varchar(""desc"", 512)
    val price = double(""price"")
}
</code></pre>

<p>I would like to add a column, last_modified how to alter the current table. </p>
","1699159","","","","","2020-04-26 00:06:38","Adding a column to an existing table with values","<ktor><kotlin-exposed>","1","0","","","","61415016","128262","128262","ktor","265","45915935","45915934"
"61437066","1","","","2020-04-26 07:13:20","","0","4","<p>When validating the <strong>jwt</strong> one may want to differentiate between invalid and expired tokens.</p>

<p>Currently I'm throwing <code>SessionExpired</code> or <code>Unauthorized</code> custom <strong>Exceptions</strong>, which I'd like to handle with different <code>HttpStatusCode</code> responses.</p>

<p>The problem is, that while <code>FormAuthChallenge</code> and <code>SessionAuthChallenge</code> does allow for differentiating between errors, <code>JwtAuthChallenge</code> has only the <em>scheme</em> and <em>realm</em> payloads, hence the differentiation information is lost at that point.</p>

<p>Is there anyway to work around this issue or one should implement a custom authentication just for this?</p>
","4487858","","","","","2020-04-26 07:13:20","How should one handle SessionExpired with ktor jwt?","<authentication><jwt><ktor>","0","0","","","","61437066","128262","128262","ktor","265","45915935","45915934"
"61441640","1","","","2020-04-26 13:31:06","","0","6","<p>I would like ktor to start returning my data as soon as it becomes available. I have tried:</p>

<pre><code>    get (""/alphabet"") {
        val outgoingContent = object : OutgoingContent.WriteChannelContent() {
            override val contentType: ContentType = ContentType.Text.Plain
            override suspend fun writeTo(channel: ByteWriteChannel) {
                println(""Writing 1"")
                channel.write(""ABCDEFGHIJKLMNOPQRSTUVWXYZ"")
                channel.flush()
                delay(2000)
                println(""Writing 2"")
                channel.write(""ABCDEFGHIJKLMNOPQRSTUVWXYZ"")
                channel.flush()
                delay(2000)
                println(""Writing 3"")
                channel.write(""ABCDEFGHIJKLMNOPQRSTUVWXYZ"")
            }
        }
        println(""Responding..."")
        call.respond(outgoingContent)
        println(""Done"")
    }
</code></pre>

<p>but the output doesn't start immediately, as I had hoped. (And I hoped I wouldn't need <code>flush()</code>.)</p>

<p>I also tried using <code>OutgoingContent.ReadChannelContent</code>, but no luck that way either.</p>

<p>Is there any way to get ktor to stream response data in this way?</p>
","13411183","","","","","2020-04-26 13:31:06","Return streaming content from ktor","<ktor>","0","1","","","","61441640","128262","128262","ktor","265","45915935","45915934"
"61447126","1","","","2020-04-26 19:50:14","","0","12","<p>I'm trying to design an API that can grade Kotlin assignments. So far, I have it such that you can upload two files: file.kt (which stores the user's attempt at an assignment solution) and test.kt (which stores the test cases, I designed my own lightweight testing framework). The problem I have is that I can't access elements in these files because they don't exist at compile time. How can I run the main() method of my tester after both of these files are uploaded to my server (ktor)? Is there a viable work-around?</p>
","5736558","","","","","2020-04-26 19:50:14","How to run kotlin method from an uploaded kotlin file?","<api><kotlin><ktor>","0","0","","","","61447126","128262","128262","ktor","265","45915935","45915934"
"61479495","1","","","2020-04-28 11:48:50","","0","11","<p>I use ktor on server and have a request that may be executed for a long time (one minute or more). I want to detect client request cancellation to release resources and cancel the long running operation. Is there any way to do it?</p>

<p>Thanks in advance</p>
","7656896","","","","","2020-04-28 11:48:50","How do detect if request was cancelled by client on ktor server","<kotlin><server><ktor>","0","0","","","","61479495","128262","128262","ktor","265","45915935","45915934"
"61492364","1","","","2020-04-29 00:43:35","","1","33","<p>Here's a Ktor route that returns a map of LocalDates:</p>

<pre><code>route {
   get {
       val map = mapOf(LocalDate.now() to ""test"")
       call.respond(map)
   }
}
</code></pre>

<p>LocalDate is not serializable, however:</p>

<pre><code>kotlinx.serialization.SerializationException: Can't locate argument-less serializer for class LocalDate. For generic classes, such as lists, please provide serializer explicitly.
</code></pre>

<p>I've built my own serializer:</p>

<pre><code>@Serializer(forClass = LocalDate::class)
object LocalDateSerializer : KSerializer&lt;LocalDate&gt; {
    override fun serialize(encoder: Encoder, value: LocalDate) {
        encoder.encodeString(value.toString())
    }

    override fun deserialize(decoder: Decoder): LocalDate {
        return LocalDate.parse(decoder.decodeString())
    }
}
</code></pre>

<p>I can use this serializer in a data class, e.g. <code>data class Foo(@Serializable(with=LocalDateSerializer::class)date: LocalDate</code>. But I don't know how to get it work with my map.</p>

<p>I've tried a couple different annotations:</p>

<pre><code>val map: Map&lt;@ContextualSerialization LocalDate, String&gt; = mapOf(LocalDate.now() to ""test"")
// OR
val map: Map&lt;@Serializable(with=LocalDateSerializer::class) LocalDate, String&gt; = mapOf(LocalDate.now() to ""test"")
</code></pre>

<p>And I've tried registering it with Ktor:</p>

<pre><code>install(ContentNegotiation) {
    json(module = serializersModuleOf(LocalDate::class, LocalDateSerializer))
}
</code></pre>

<p>No matter what I try, I get the same <code>SerializationException</code> as above.</p>

<p>How can I apply my serializer automatically when kotlinx.serialization tries to parse a LocalDate? OR how can I suggest a serializer when Ktor tries to serialize my map?</p>
","281657","","","","","2020-04-29 00:43:35","Serialize a Map<LocalDate, Object> with Ktor and kotlinx.serialization","<json><kotlin><ktor><kotlinx.serialization>","0","0","1","","","61492364","128262","128262","ktor","265","45915935","45915934"
"55442204","1","55443631","","2019-03-31 14:58:49","","1","212","<p>I`m making a web application. The back-end is in Java, and I use Spring. For the database I use CouchDb and I want to use Ektorp, but here comes the problem. It crashes when I add the Ektorp dependency. It compiles, but when I try to run, I get the errors from below.</p>

<pre><code>Exception in thread ""main"" java.lang.IllegalArgumentException: Cannot instantiate interface org.springframework.context.ApplicationListener : org.springframework.boot.context.logging.ClasspathLoggingApplicationListener
    at org.springframework.boot.SpringApplication.createSpringFactoriesInstances(SpringApplication.java:450)
    at org.springframework.boot.SpringApplication.getSpringFactoriesInstances(SpringApplication.java:429)
    at org.springframework.boot.SpringApplication.getSpringFactoriesInstances(SpringApplication.java:420)
    at org.springframework.boot.SpringApplication.&lt;init&gt;(SpringApplication.java:270)
    at org.springframework.boot.SpringApplication.&lt;init&gt;(SpringApplication.java:249)
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
    at QEasyApplication.main(QEasyApplication.java:18)
Caused by: java.lang.NoClassDefFoundError: org/springframework/context/event/GenericApplicationListener
    at java.base/java.lang.ClassLoader.defineClass1(Native Method)
    at java.base/java.lang.ClassLoader.defineClass(ClassLoader.java:1016)
    at java.base/java.security.SecureClassLoader.defineClass(SecureClassLoader.java:174)
    at java.base/jdk.internal.loader.BuiltinClassLoader.defineClass(BuiltinClassLoader.java:802)
    at java.base/jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull(BuiltinClassLoader.java:700)
    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClassOrNull(BuiltinClassLoader.java:623)
    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)
    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)
    at java.base/java.lang.Class.forName0(Native Method)
    at java.base/java.lang.Class.forName(Class.java:398)
    at org.springframework.util.ClassUtils.forName(ClassUtils.java:275)
    at org.springframework.boot.SpringApplication.createSpringFactoriesInstances(SpringApplication.java:442)
    ... 7 more
Caused by: java.lang.ClassNotFoundException: org.springframework.context.event.GenericApplicationListener
    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583)
    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)
    ... 20 more

Process finished with exit code 1
</code></pre>

<p>I tried changing to different versions of Ektorp or spring boot but nothing worked. Down below is my Maven pom file. What could be the problem? </p>

<pre><code>&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;
&lt;project xmlns=""http://maven.apache.org/POM/4.0.0""
         xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd""&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
            &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
            &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
            &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.ektorp&lt;/groupId&gt;
            &lt;artifactId&gt;org.ektorp.spring&lt;/artifactId&gt;
            &lt;version&gt;1.4.4&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
","5618708","","","","","2019-03-31 17:37:58","Ektorp dependency crashing Spring boot application","<java><maven><spring-boot><ektorp>","1","0","1","","","55442204","73833","73833","ektorp","71","7739352","7739351"
"56268510","1","","","2019-05-23 05:23:03","","0","95","<p>I was trying to create CouchDBConnector object in spring boot project to get connetion to CouchDB. So this problem occured while creating connector object. </p>

<p>There was not much of documentation on Ektorp Github project to try.</p>

<pre><code>@Bean
public CouchDbConnector firstCouchDbConnector() throws MalformedURLException {
    HttpClient httpClient = new StdHttpClient.Builder()
            .url(""http://localhost:5984"")
            .username(""admin"")
            .password(""admin"")
            .build();

    CouchDbInstance couchdbInstance = new StdCouchDbInstance(httpClient);
    CouchDbConnector couchDbConnector = new StdCouchDbConnector(""spring"", couchdbInstance);
    return couchDbConnector;
}
</code></pre>

<p>I expected a CouchDBConnector object to get access to CouchDB database. But all i got is this error.</p>

<p>Error I got in Console is :</p>

<p>The following method did not exist:</p>

<pre><code>com.fasterxml.jackson.databind.SerializationConfig.withSerializationInclusion(Lcom/fasterxml/jackson/annotation/JsonInclude$Include;)Lcom/fasterxml/jackson/databind/SerializationConfig;
</code></pre>

<p>The method's class, com.fasterxml.jackson.databind.SerializationConfig, is available from the following locations:</p>

<pre><code>jar:file:/C:/Users/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.core/jackson-databind/2.9.8/11283f21cc480aa86c4df7a0a3243ec508372ed2/jackson-databind-2.9.8.jar!/com/fasterxml/jackson/databind/SerializationConfig.class
</code></pre>

<p>It was loaded from the following location:</p>

<pre><code>file:/C:/Users/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.core/jackson-databind/2.9.8/11283f21cc480aa86c4df7a0a3243ec508372ed2/jackson-databind-2.9.8.jar
</code></pre>
","7453167","","","","","2019-07-29 07:18:44","withSerializationInclusion function is not available in latest Jackson-databind-2.9.8","<java><spring-boot><jackson><couchdb><ektorp>","1","0","","","","56268510","73833","73833","ektorp","71","7739352","7739351"
"56431844","1","","","2019-06-03 17:17:01","","0","17","<p>Does <code>Ektorp</code> api allows to search + find + return a document from no sql db <code>couchdb</code> without knowing its <code>id</code> which maps <code>_id</code> of a document? After reading its api doc, I am not sure that would be possible.</p>

<p>What I am trying to accomplish is be able to identify a document (maybe its _id?) that has pet as <code>bird</code> without knowing its <code>_id</code> up front. </p>

<pre><code>{
  ""_id"": ""12345"",
  ""_rev"": ""5-abcdffff133432432"",
  ""version"": ""someversion"",
  ""doctype"": ""foodocument"",
  ""name"": ""foo"",
  ""pet"": ""bird""
}
</code></pre>

<p>Following test method in restful web service finds/returns pet's name of a document if I know its <code>_id</code> up front.</p>

<pre><code>@GET
@Path(""/finddocument"")
public Response findDocument(@QueryParam(""id"") String _id) {
    CouchDbConnector db = ...;
    JsonNode doc db.get(JsonNode.class,_id);
    JsonNode pet= doc.findPath(""pet"");
    return Response.status(Response.Status.OK).entity(pet).build();
}
</code></pre>
","1056958","","","","","2019-06-03 17:17:01","In Ektorp api, is it possible to identify a document without knowing its unique id value?","<ektorp>","0","0","","","","56431844","73833","73833","ektorp","71","7739352","7739351"
"59652946","1","","","2020-01-08 19:53:20","","0","25","<p>I'm coding a java application to insert data on CouchDB. For that I'm using <a href=""https://github.com/helun/Ektorp"" rel=""nofollow noreferrer"">Ektorp</a> and I'm getting the exception <code>org.ektorp.InvalidDocumentException: Cannot resolve id accessor in class</code></p>

<p>These are my maven dependencies:</p>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.ektorp&lt;/groupId&gt;
  &lt;artifactId&gt;org.ektorp&lt;/artifactId&gt;
  &lt;version&gt;1.4.4&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
  &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;
  &lt;version&gt;2.9.10&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>The POJO, as described <a href=""https://github.com/FasterXML/jackson-annotations"" rel=""nofollow noreferrer"">here</a></p>

<pre><code>public class Item {

    @JsonProperty(""_index"")
    public String index;

    @JsonProperty(""_type"")
    public String type;

    @JsonProperty(""_id"")
    public String id;

    @JsonProperty(""_score"")
    public float score;

}
</code></pre>

<p>The repository:</p>

<pre><code>public class ItemRepository extends CouchDbRepositorySupport&lt;Item&gt; {
    public ItemRepository(CouchDbConnector db) {
        super(Item.class, db);
    }
}
</code></pre>

<p>And how I'm trying to add:</p>

<pre><code>Item x = new Item();
x.id = ""1291"";
x.index=""test_index"";
x.score = 1;
x.type = ""_doc"";

this.repo = new ItemRepository(this.db);
this.repo.add(x);
</code></pre>

<p>The error description:</p>

<pre><code>Exception in thread ""main"" org.ektorp.InvalidDocumentException: Cannot resolve id accessor in class org.example.Item
    at org.ektorp.util.Documents$MethodAccessor.assertMethodFound(Documents.java:165)
    at org.ektorp.util.Documents$MethodAccessor.&lt;init&gt;(Documents.java:136)
    at org.ektorp.util.Documents.getAccessor(Documents.java:113)
    at org.ektorp.util.Documents.getRevision(Documents.java:77)
    at org.ektorp.util.Documents.isNew(Documents.java:85)
    at org.ektorp.support.CouchDbRepositorySupport.add(CouchDbRepositorySupport.java:100)
    at org.example.DataBase.addItem(DataBase.java:69)
    at org.example.App.main(App.java:42)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)
</code></pre>

<p>I'm not sure what I'm doing wrong. I think it is the Jackson JSON library that I'm not sure If I'm using the right one since the link they have in the doc does not exist anymore.</p>

<p>I appreciate any help</p>
","1265205","","","","","2020-01-08 20:00:03","org.ektorp.InvalidDocumentException: Cannot resolve id accessor in class","<java><couchdb><ektorp>","1","0","","","","59652946","73833","73833","ektorp","71","7739352","7739351"