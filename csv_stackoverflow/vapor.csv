Id,PostTypeId,AcceptedAnswerId,ParentId,CreationDate,DeletionDate,Score,ViewCount,Body,OwnerUserId,OwnerDisplayName,LastEditorUserId,LastEditorDisplayName,LastEditDate,LastActivityDate,Title,Tags,AnswerCount,CommentCount,FavoriteCount,ClosedDate,CommunityOwnedDate,PostId,TagId,Id,TagName,Count,ExcerptPostId,WikiPostId
"41712123","1","41712801","","2017-01-18 05:38:49","","3","403","<p>I have installed vapor on my mac and when trying to build project, it will never ending.</p>

<p>I am getting waring when trying to install again like below (brew install qutheory/tap/vapor)</p>

<pre><code>Warning: qutheory/tap/vapor-0.4.1 already installed, it's just not linked.
</code></pre>

<p>and below is my running console output.</p>

<pre><code>MAC-mini-A:vapor-docker22 mac$ vapor build
Fetching Dependencies [Done]
Building Project [ •                       ]
</code></pre>

<p>The last building project step will never ending.</p>

<p>.</p>

<p>Edit:</p>

<p>Building with Xcode works good, but I want to do with 'vapor build' command not from Xcode.</p>
","2949441","","2949441","","2017-01-18 05:43:49","2017-01-18 09:56:15","swift vapor build(Building Project) will never ending and getting warning 'it's just not linked'","<swift><vapor><vapor-cli>","1","0","","","","41712123","124188","124188","vapor-cli","1","41712133","41712132"
"54875500","1","","","2019-02-25 22:13:03","","0","77","<p>I'm starting to use Vapor (the server-side Swift framework) and I saw the driver named Theo made for Vapor. But I am wondering how I would  deploy a project with Theo into Vapor Cloud 2? Does Vapor Cloud 2 support it?</p>

<p><strong>Update:</strong>
Here's the link for Theo 5.0 from Neo4j: <a href=""https://github.com/Neo4j-Swift/Neo4j-Swift"" rel=""nofollow noreferrer"">https://github.com/Neo4j-Swift/Neo4j-Swift</a></p>
","5573179","","5573179","","2019-09-04 01:11:21","2019-09-04 01:11:21","Deploy a project with Theo into Vapor cloud v2","<neo4j><vapor><vapor-cloud>","1","1","","","","54875500","137170","137170","vapor-cloud","3","55092033","55092032"
"57549145","1","57553432","","2019-08-18 23:46:13","","1","47","<p>How can I use my own domain when hosting on vapor cloud?</p>

<p>I have never written an API before and just started playing around with Vapor, I purchased a domain from godaddy and would like my API to use that for my routes instead of the domain Vapor is creating ex ""appname.vapor.cloud""</p>
","4109016","","","","","2019-08-19 08:57:42","How can I use my own domain with vapor cloud","<vapor><vapor-cloud>","1","0","","","","57549145","137170","137170","vapor-cloud","3","55092033","55092032"
"58944547","1","","","2019-11-19 23:43:31","","0","42","<p>I'm attempting to write a server with Vapor, that communicates with another server.
On an incoming call, /auth, I need to call another server which requires the request to be signed with a certificate.
Right now I just want to return the status code and the body.</p>

<p>Let's say the certificate is named test_cert.pfx and has the password ""test_pass"".
How can I attach that so my requests succeeds?</p>

<pre><code>router.get(""auth"") { req -&gt; Future&lt;String&gt; in
    var headers: HTTPHeaders = .init()
    headers.add(name: .contentType, value: ""application/json"")
    let bodyString = ""{\""someKey\"": \""someValue\""}""
    let body = HTTPBody(string: bodyString)
    let httpReq = HTTPRequest(
        method: .POST,
        url: URL(string: ""/auth"")!,
        headers: headers,
        body: body)
    let client = HTTPClient.connect(hostname: ""https://server.require.cert.com"", on: req)
    let httpRes = client.flatMap(to: HTTPResponse.self) { client in
        return client.send(httpReq)
    }

    let data = httpRes.map(to: String.self) { httpResponse in
        return ""\(httpResponse.status.code.description) \(httpResponse.body.description)""
    }
    return data
}
</code></pre>

<p>This is what happens right now:</p>

<blockquote>
  <p>[ ERROR ] connectFailed(NIO.NIOConnectionError(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80, dnsAError: Optional(NIO.SocketAddressError.unknown(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80)), dnsAAAAError: Optional(NIO.SocketAddressError.unknown(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80)), connectionErrors: [])) (ErrorMiddleware.swift:26)
  [ DEBUG ] Conform <code>ChannelError</code> to <code>Debuggable</code> for better debug info. (ErrorMiddleware.swift:26)</p>
</blockquote>
","1329799","","","","","2019-11-19 23:43:31","POST request from Vapor with .pfx certificate","<swift><ssl><nio><vapor><vapor-cloud>","0","0","","","","58944547","137170","137170","vapor-cloud","3","55092033","55092032"
"54292759","1","54293436","","2019-01-21 15:09:07","","2","326","<p>I'm trying to setup a Vapor 3 project with SQLite.<br>
In the <code>configure.swift</code> file, I have the following setup related to sqlite:</p>

<pre><code>try services.register(FluentSQLiteProvider())

...

// Get the root directory of the project
// I have verified that the file is present at this path
let path = DirectoryConfig.detect().workDir + ""db_name.db""
let sqlite: SQLiteDatabase
do {
    sqlite = try SQLiteDatabase(storage: .file(path: path))
    print(""connected"") // called
} catch {
    print(error) // not called
    return
}

var databases = DatabasesConfig()
databases.add(database: sqlite, as: .sqlite)
services.register(databases)
</code></pre>

<p>In the database, I have a table called <code>posts</code>, that I want to query and return all entries from:</p>

<p><a href=""https://i.stack.imgur.com/KVIuB.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/KVIuB.png"" alt=""database table""></a></p>

<p>This is the <code>Post</code> implementation inside <em>/Sources/App/Models/</em>:</p>

<pre><code>final class Post: Content {
    var id: Int?
    var title: String
    var body: String

    init(id: Int? = nil, title: String, body: String) {
        self.id = id
        self.title = title
        self.body = body
    }
}
extension Post: SQLiteModel, Migration, Parameter { }
</code></pre>

<p>I have also added the migration in <code>configure.swift</code>:</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Post.self, database: .sqlite)
services.register(migrations)
</code></pre>

<p>In <code>routes.swift</code>, I define the <code>posts</code> route as follows:</p>

<pre><code>router.get(""posts"") { req in
    return Post.query(on: req).all()
}
</code></pre>

<p>Now, when calling <code>localhost:8080/posts</code>, I get:</p>

<pre><code>[]
</code></pre>

<p>Have I not properly connected the database?<br>
Have I missed something?</p>
","3397217","","3103448","","2019-01-22 16:41:23","2019-01-22 16:41:23","Vapor connect to SQLite Database","<swift><sqlite><vapor><vapor-fluent>","1","0","","","","54292759","136591","136591","vapor-fluent","38","54295329","54295328"
"54304666","1","54304704","","2019-01-22 09:05:31","","2","263","<p>I want to connect a MySQL database on my machine with a Vapor 3 app.<br>
My current <code>configure.swift</code> file looks as follows:</p>

<pre><code>try services.register(FluentMySQLProvider())

...

let mysqlConfig = MySQLDatabaseConfig(
    username: ""dev"",
    password: """",
    database: ""test""
)
let mysql = MySQLDatabase(config: mysqlConfig)

var databases = DatabasesConfig()
databases.add(database: mysql, as: .mysql)
services.register(databases)
</code></pre>

<p>This works just fine. However, since I need to add my Model to the migration configuration, I also need to add:</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Posts.self, database: .mysql)
services.register(migrations)
</code></pre>

<p>When running the app this time, I'm seeing an error saying:</p>

<blockquote>
  <p>Full authentication not supported over insecure connections.</p>
</blockquote>

<p>After some research, it seems that this error can be overcome by changing the password logic from <code>caching_sha2_password</code> to <code>mysql_native_password</code>.<br>
However, that leaves me with the error saying:</p>

<blockquote>
  <p>Unrecognized basic packet.</p>
</blockquote>

<p>How do I fix this?</p>
","3397217","","7568116","","2019-03-19 08:02:01","2019-03-19 08:02:01","MySQL & Vapor 3: unrecognized basic packet, full auth not supported","<swift><vapor><vapor-fluent><fluent-mysql>","1","0","1","","","54304666","136591","136591","vapor-fluent","38","54295329","54295328"
"54894342","1","54895086","","2019-02-26 21:25:09","","4","446","<p>I'm struggling with understanding how to perform a batch save of fetched objects and store them to the database. After I have stored the objects to the database I want to return the result of a query. 
I can't understand how to do this with EventLoopFuture since when I call <code>.wait()</code> I get the error message:</p>

<blockquote>
  <p>Precondition failed: BUG DETECTED: wait() must not be called when on an EventLoop.</p>
</blockquote>

<p>As an example of my problem:</p>

<ul>
<li>I need to fetch an entity from an external endpoint (let's say flights for an airport)</li>
<li>The result of that call needs to be saved to a database. If the flight exists in the database, it needs to be updated otherwise created.</li>
<li>When completed, a list of all the flights in from the database needs to be returned.</li>
</ul>

<p>This is what I got so far, but which gives me the bug:</p>

<pre><code>func flights(on conn: DatabaseConnectable, customerName: String, flightType: FlightType) throws -&gt; Future&lt;[Flight]&gt; {

    return Airport.query(on: conn).filter(\.customerName == customerName).first().flatMap(to: [Flight].self) { airport in
      guard let airport = airport else {
        throw Abort(.notFound)
      }

      guard let airportId = airport.id else {
        throw Abort(.internalServerError)
      }

      // Update items for customer
      let fetcher: AirportManaging?

      switch customerName.lowercased() {
      case ""coolCustomer"":
        fetcher = StoreOneFetcher()
      default:
        fetcher = nil
        debugPrint(""Unhandled customer to fetch from!"")
        // Do nothing
      }

      let completion = Flight.query(on: conn).filter(\.airportId == airportId).filter(\.flightType == flightType).all

      guard let flightFetcher = fetcher else { // No customer fetcher to get from, but still return whats in the DB
        return completion()
      }

      return try flightFetcher.fetchDataForAirport(customerName, on: conn).then({ (flights) -&gt; EventLoopFuture&lt;[Flight]&gt; in
        flights.forEach { flight in
          _ = try? self.storeOrUpdateFlightRecord(flight, airport: airport, on: conn).wait()
        }
        return completion()
      })
    }
  }

  func storeOrUpdateFlightRecord(_ flight: FetcherFlight, airport: Airport, on conn: DatabaseConnectable) throws -&gt; EventLoopFuture&lt;Flight&gt; {
    guard let airportId = airport.id else {
      throw Abort(.internalServerError)
    }

    return Flight.query(on: conn).filter(\.itemName == flight.itemName).filter(\.airportId == airportId).filter(\.flightType == flight.type).all().flatMap(to: Flight.self) { flights in
      if let firstFlight = flights.first {
        debugPrint(""Found flight in database, updating..."")
        return flight.toFlight(forAirport: airport).save(on: conn)
      }

      debugPrint(""Did not find flight, saving new..."")
      return flight.toFlight(forAirport: airport).save(on: conn)
    }
  }
</code></pre>

<p>So the problem in on line <code>_ = try? self.storeOrUpdateFlightRecord(flight, airport: airport, on: conn).wait()</code>. I can't call <code>wait()</code> since it'll block the eventLoop but if I call <code>map</code> or <code>flatMap</code> I need in turn return an <code>EventLoopFuture&lt;U&gt;</code> (<code>U</code> being <code>Flight</code>), which I am totally uninterested in. </p>

<p>I want <code>self.storeOrUpdateFlightRecord</code> to be called and the result ignored. How can I do that?</p>
","406677","","406677","","2019-02-27 20:17:11","2019-02-27 20:17:11","Vapor 3: Eventloop bug detected when using wait()","<swift><future><event-loop><vapor><vapor-fluent>","1","0","","","","54894342","136591","136591","vapor-fluent","38","54295329","54295328"
"54998287","1","55022184","","2019-03-05 08:22:26","","1","184","<p>When I am saving my object to the database, it stores the id of the object with +10. The autoincrement for the table increments by default with 1. When I manually add something to the database, it'll increment with 1. </p>

<p>Am I missing (or my misstake, setting) a setting for FluentMySQL?</p>

<pre><code>  func storeOrUpdateItemRecord(_ item: FetcherItem, store: Store, on conn: DatabaseConnectable) throws -&gt; EventLoopFuture&lt;Item&gt; {
    guard let storeId = store.id else {
      throw Abort(.internalServerError)
    }

    let calendar = Calendar.current
    let fromDate = calendar.startOfDay(for: Date())
    guard let endDate = calendar.date(bySettingHour: 23, minute: 59, second: 59, of: Date()) else { throw Abort(.internalServerError) }

    return Item.query(on: conn)
      // Bunch of filters
      .filter(\.scheduledDate &lt; endDate)
      .all()
      .flatMap(to: Flight.self) { flights in
        if var firstItem = flights.first {
          debugPrint(""Found item, updating..."")
          // Update a bunch of values
          return firstItem.save(on: conn)
        }

        debugPrint(""Did not find item, saving new..."")
        return item.toItem(forStore: store).save(on: conn)
    }
  }
</code></pre>

<p>The <code>toItem</code> func does nothing more then initiate a new <code>Item</code>:</p>

<pre><code>extension FetcherItem {

  func toItem(forStore store: Store) -&gt; Item {
    return Item.init(
      id: nil,
      // Set a bunch of values
      actualDate: actualDateTime)
  }
}
</code></pre>

<p>As you can see, the <code>id</code> is set to <code>nil</code>... which I would guess should store using <code>null</code> while making the insert query. </p>

<p>The result in the database:</p>

<p><a href=""https://i.stack.imgur.com/f89Dn.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/f89Dn.png"" alt=""MySQL db result""></a></p>

<p>What am I missing?</p>

<p><em>Update</em>:
After following suggestions from <a href=""https://stackoverflow.com/questions/53023892/how-do-i-log-sql-statements-in-vapor-3-fluent"">this page</a> I've added logging for the queries... and they seem to work as they should.
Example of what fluent runs for query:</p>

<pre><code>[mysql] [2019-03-06 08:49:44 +0000] INSERT INTO `Items` (`company`, `name`, `storeId`, [...] `scheduledDate`) VALUES (?, ?, ?, ?, ?, ?, ?, ?) [string(""A company""), string(""abc123""), integer8(1), [...] time(2019-3-6 16:25:0.0)]
</code></pre>

<p>As you can see, it doesn't set the <code>id</code> in any way. Maybe a MySQL problem?</p>
","406677","","406677","","2019-03-06 09:51:22","2019-03-06 11:36:21","Vapor 3 Fluent MySQL: save on model adds 10 to auto_increment","<mysql><swift><vapor><vapor-fluent>","1","0","","","","54998287","136591","136591","vapor-fluent","38","54295329","54295328"
"55089886","1","55090130","","2019-03-10 16:32:11","","3","523","<p>I have a model Campaign, that has multiple Months:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Campaign: Content, SQLiteModel {
  var id: Int?
  var name: String
  var months: Children&lt;Campaign, Month&gt; {
    return children(\.campaignID)
  }
}
</code></pre>

<p>When I want to return a Campaign in the most basic way, it doesn't include the Months, as computed properties are not Codable as I understand.</p>

<pre class=""lang-swift prettyprint-override""><code>func getOneHandler(_ req: Request) throws -&gt; Future&lt;Campaign&gt; {
  return try req.parameters.next(Campaign.self)
}
</code></pre>

<p>So, I made a new struct to hold the full object I want to return</p>

<pre class=""lang-swift prettyprint-override""><code>struct FullCampaignData: Content {
  let id: Int
  let name: String
  var months: [Month]?
}
</code></pre>

<p>And then modified my route handler like this:</p>

<pre class=""lang-swift prettyprint-override""><code>func getOneHandler(_ req: Request) throws -&gt; Future&lt;FullCampaignData&gt; {
  return try req.parameters.next(Campaign.self).flatMap(to: FullCampaignData.self) { campaign in
    return try campaign.months.query(on: req).all().map(to: FullCampaignData.self) { months in
      return try FullCampaignData(id: campaign.requireID(), name: campaign.name, months: months)
    }
  }
}
</code></pre>

<p>This does work. However, it seems like a lot of work and a lot of boilerplate to do this. What's the normal Swifty ""Vapory"" way to deal with child objects, or other computed objects in general? Right now it seems to come down to a bunch of different versions of your models (for creation, for returning, the actual full internal one) and then converting between them, but I am hoping there is something I am missing here? Because it's so easy to forget to add a newly added model property also to that special public model. </p>

<p>Or at the very least, if converting between models in indeed the recommended way, is there a way doesn't need all these nested maps/flatmaps in the route handler?</p>
","403425","","","","","2019-03-10 16:56:53","Vapor 3: when returning a model, how to easily also return child objects","<swift><vapor><vapor-fluent>","1","2","","","","55089886","136591","136591","vapor-fluent","38","54295329","54295328"
"57733122","1","","","2019-08-30 20:57:40","","1","285","<p>We are running our website on the AWS serverless infrastructure through Laravel vapor now. It runs on a serverless Aurora database and uses Amazon SQS as the queue driver.  Basically the defaults for a Laravel Vapor deploy.</p>

<p>We are currently running into a performance issue that while we are trying to resolve it, has us smash our head into other walls we meet on our journey.  So here we go.</p>

<p><strong>What we want to do</strong></p>

<p>Our customers can have various types of subscriptions that need to be renewed. These subscriptions come in all kinds of flavours, can have different billing intervals, different currencies and different prices.</p>

<p>On our customer dashboard we want to present them with a nice card informing the customer about their upcoming renewals, with a good estimate of what the cost will be, so they can make sure they have enough credits:</p>

<p><a href=""https://i.stack.imgur.com/6xSfO.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6xSfO.png"" alt=""Dashboard information""></a></p>

<p>As our subscriptions come with different flavours, we have one table that holds the basic subscription details, such as <code>net_renewal_date</code>.  It also references a <code>subscriptionable_id</code> of <code>subscriptionable_type</code> which is a morph relation ship to the different types of models that a user can have a subscription for.</p>

<p><strong>Our first attempt</strong></p>

<p>In our first attempt, we basically added a REST endpoint which fetched the upcoming renewal forecast.</p>

<p>It basically took all Subscriptions that were up for renewal the coming 30 days.  For each of those items, we would calculate the current price in its currency, and add tax caculations.</p>

<p>That was then returned into a collection that we further used to:
1/ calculated the total per currency
2/ filter that collection for items within the next 14 days, and calculate the same total per currency.</p>

<p>We would then basically just convert the different amounts to our base currency (EUR) and return the sum thereof.</p>

<p>This worked great for the vast majority of our clients.  Even customers with 100 subscriptions were no issue at all.</p>

<p>But then we migrated one of our larger customers to the new platform.  He basically had 1500+ subcsriptions renewing in the upcoming 30 days, so that didn't go well...</p>

<p><strong>Our second attempt</strong>
Because going through the above code simply doens't work in an acceptable amount of time, we decided we had to move the simulation calculation into a seperate job.</p>

<p>We added an attribute to the subscriptions table and called it 'simulated_renewal_amount'</p>

<p>This job would need to run every time when:
- a price changes
- the customer's discount would change (based on his loyalty, we provide seperate prices
- the exchanges rates change.</p>

<p>So the idea was to listen for any of these changes, and then dispatch a job to recalculate the simulated amount to any of the involved subscriptions.  This however means that a change in an exchange rate for instance can easily trigger 10,000 jobs to be processed.</p>

<p>And this is where it becomes tricky.
Even though running just one job only takes less than 1200ms in most cases, it seems that dispatching a lot of jobs that need to do the same calculations for a set of subscriptions is causing jobs running 60+ seconds when they are being aborted.</p>

<p>What is the best practice to setup such a queued job?  Should I just created one job in stead and process them sequentially?  </p>

<p>Any insights on how we can best set this up to start with, would be very welcome.  We've played a lot with it, and it always seems to be ending up with the same kind of issues.</p>

<p>FYI - we host the site on laravel vapor, so serverless on AWS infrastructure with an Aurora database.</p>
","8212904","","4947257","","2020-01-04 15:01:55","2020-01-28 11:33:39","Managing Queued jobs / Database connections / performance on Laravel Vapor","<laravel><amazon-web-services><amazon-sqs><jobs><laravel-vapor>","1","0","2","","","57733122","140584","140584","laravel-vapor","30","58347582","58347581"
"57916370","1","58053072","","2019-09-13 01:45:58","","1","153","<p>I just installed Laravel Vapor today and am so excited to get started, but I've run into a wall with authentication from my Mac (using iTerm). I enter <code>vapor login</code>, then follow the prompts for <code>Email Address:</code> and <code>Password:</code>... and get <code>Authentication failed.</code> every time. I have triple-checked my email address, very carefully entered the password, checked caps lock is not on, and changed my password 3 times via the website and re-entered to see if it changed anything. I don't know what else I can do! Has anyone else run into this problem?? Any suggestions??</p>
","650537","","1902010","","2019-10-11 19:42:28","2019-10-11 19:42:28","Authentication failed on Laravel Vapor CLI","<laravel><laravel-vapor>","1","2","1","","","57916370","140584","140584","laravel-vapor","30","58347582","58347581"
"58135493","1","","","2019-09-27 13:24:47","","0","262","<p>I just deployed a Laravel App using Vapor, and received the following message. I don't believe that I changed anything (a few html blade lines).</p>

<blockquote>
  <p>Caching Laravel configuration{""message"":""Argument 1 passed to
  Symfony\Component\HttpKernel\Exception\HttpException::__construct()
  must be of the type int, string given, called in
  /var/task/vendor/laravel/framework/src/Illuminate/Foundation/Application.php
  on line
  1014"",""context"":{""exception"":{""class"":""Symfony\Component\Debug\Exception\FatalThrowableError"",""message"":""Argument
  1 passed to
  Symfony\Component\HttpKernel\Exception\HttpException::__construct()
  must be of the type int, string given, called in
  /var/task/vendor/laravel/framework/src/Illuminate/Foundation/Application.php
  on line
  1014"",""code"":0,""file"":""/var/task/vendor/symfony/http-kernel/Exception/HttpException.php:24""},""aws_request_id"":null},""level"":400,""level_name"":""ERROR"",""channel"":""production"",""datetime"":""2019-09-27T13:18:45.338555+00:00"",""extra"":{}}</p>
</blockquote>

<p>The website now just shows <code>{""message"": ""Internal server error""}</code></p>

<p>Did I do this, or is this a Laravel/Vapor bug?</p>
","278149","","1902010","","2019-10-11 19:42:52","2019-10-11 19:42:52","Laravel Vapor deploys and then fails to respond to requests","<laravel><aws-lambda><laravel-vapor>","0","2","","","","58135493","140584","140584","laravel-vapor","30","58347582","58347581"
"58346824","1","58346900","","2019-10-11 18:39:52","","3","461","<p>I recently moved a Laravel app from a server to Vapor. This app relies on logging request IP addresses using <code>Request::ip()</code>, but since switching to Vapor, all IPs are logged as 127.0.0.1.</p>

<p>I have looked over the Trusted Proxy docs at <a href=""https://laravel.com/docs/5.6/requests#configuring-trusted-proxies"" rel=""nofollow noreferrer"">https://laravel.com/docs/5.6/requests#configuring-trusted-proxies</a> but we do not have a load balancer set up, so this solution does not appear relevant. I suspect this IP address is coming from the Amazon API Gateway. </p>

<p>How do we get the <em>actual</em> client IP of incoming requests in an app deployed on Vapor?</p>

<p>A minimal example of how we use the IP address is below:</p>

<pre><code>public function store(Request $request)
    {
        $workerIP = $request-&gt;ip();
        $worker = Worker::create(['ip_address' =&gt; $workerIP]);
        return view('workers.show')-&gt;withWorker($worker);

    }
</code></pre>
","9211153","","1902010","","2019-10-11 19:41:50","2019-11-04 15:45:56","How can I get the IP of an HTTP request in a Laravel Vapor application?","<laravel><aws-lambda><laravel-vapor>","2","3","3","","","58346824","140584","140584","laravel-vapor","30","58347582","58347581"
"58374071","1","58432660","","2019-10-14 09:42:11","","1","631","<p>I am trying to deploy a Laravel + Vue JS project to Laravel Vapor. Everything is working as expected, except for my background images, applied using styles in a Vue JS single file component. The URL's point to my domain/lamba instance, not the cdn provided by Vapor.</p>

<p>My existing style, which works on my local environment is:</p>

<pre><code>.slide1 {
  background-image: url(""/images/banner1.jpg"");
}
</code></pre>

<p>When deployed to vapor the image url is : <a href=""https://damp-pine-l46hzzzbsa5p.vapor-farm-a1.com/images/banner1.jpg"" rel=""nofollow noreferrer"">https://damp-pine-l46hzzzbsa5p.vapor-farm-a1.com/images/banner1.jpg</a></p>

<p>And returns a 404, as it is expected to be the url of the cdn. </p>

<p>When I use the image from the base blade file, the image url is rewritten to: <a href=""https://d16wfy3cif7yy.cloudfront.net/e9ce46ed-bf61-4c85-8bd0-b136f1d15a33/images/banner1.jpg"" rel=""nofollow noreferrer"">https://d16wfy3cif7yy.cloudfront.net/e9ce46ed-bf61-4c85-8bd0-b136f1d15a33/images/banner1.jpg</a> as expected.</p>

<p>I have made a few attempts at following other posts relating to vue-js/laravel-mix urls, however all have failed, and most won't even allow npm run to complete without error.</p>

<p>After doing more research, it seems I missed part of the vapor documentation: <a href=""https://docs.vapor.build/1.0/projects/deployments.html#code-splitting-dynamic-imports"" rel=""nofollow noreferrer"">https://docs.vapor.build/1.0/projects/deployments.html#code-splitting-dynamic-imports</a> that talks about dynamic imports. This is obviously the intended way of doing it, rather than have the vapor-cli do the rewrite, however I cannot for the life of me get it working.</p>

<p>I have tried adding the suggested code to my webpack.mix file, and still no luck. The image URLs still point to the domain, not to the cdn.</p>

<p>I have also followed many tutorials/stack overflow questions that talk about relative vs module assets, and following any of these causes npm to throw an error that the image could not be resolved. </p>

<p>My webpack.mix.js file:</p>

<pre><code>const mix = require('laravel-mix');

/*
 |--------------------------------------------------------------------------
 | Mix Asset Management
 |--------------------------------------------------------------------------
 |
 | Mix provides a clean, fluent API for defining some Webpack build steps
 | for your Laravel application. By default, we are compiling the Sass
 | file for the application as well as bundling up all the JS files.
 |
 */

mix.js('resources/js/app.js', 'public/js')
    .sass('resources/sass/app.scss', 'public/css');

if (mix.inProduction()) {
    const ASSET_URL = process.env.ASSET_URL + ""/"";

    mix.webpackConfig(webpack =&gt; {
        return {
            plugins: [
                new webpack.DefinePlugin({
                    ""process.env.ASSET_PATH"": JSON.stringify(ASSET_URL)
                })
            ],
            output: {
                publicPath: ASSET_URL
            }
        };
    });
}
</code></pre>

<p>And this is my vue-component that is not loading images correctly</p>

<pre><code>&lt;template&gt;
  &lt;div class=""heroheader-container""&gt;
    &lt;carousel
      :scrollPerPage=""false""
      :perPage=""1""
      :autoplay=""true""
      :autoplay-timeout=""4000""
      :autoplay-hover-pause=""true""
      :loop=""true""
      :pagination-enabled=""false""
    &gt;
      &lt;slide class=""slide slide1""&gt;
        &lt;div class=""slide-content""&gt;

        &lt;/div&gt;
      &lt;/slide&gt;
      &lt;slide class=""slide slide2""&gt;Slide 2&lt;/slide&gt;
      &lt;slide class=""slide slide3""&gt;Slide 3&lt;/slide&gt;
    &lt;/carousel&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      //
    };
  }
};
&lt;/script&gt;

&lt;style&gt;
:root {
  --carousel-height: 75vh;
}

.heroheader-container {
  width: 100%;
  margin-left: 0px;
  padding: 0px;
  top: 0px;
  position: absolute;
}

.carousel {
  width: 100%;
  height: var(--carousel-height);
}

.slide1 {
  background-image: url(""/images/banner2.jpg"");
}

.slide2 {
  background-image: url(""/images/banner3.jpg"");
}

.slide3 {
  background-image: url(""/images/banner4.jpg"");
}

.slide {
  background-position: center center;
  background-size: cover;
  height: var(--carousel-height);
  padding-top: 150px;
}

.slide-content {
  position: relative;
  text-align: center;
  color: #efefef;
}
&lt;/style&gt;
</code></pre>

<p>As a PHP developer (new to vue), I forked and edited the laravel/vapor-cli in about 5 minutes to rewrite these style urls in the compiled js. This works, however it seems there is a better way, I'm just missing something! Any help would be appreciated.</p>
","6179529","","6179529","","2019-10-15 10:16:50","2020-03-04 06:09:43","How to add css image backgrounds in Vue-js so Laravel Vapor can rewrite the url to the correct S3/CDN url","<css><vue.js><laravel-vapor>","2","0","1","","","58374071","140584","140584","laravel-vapor","30","58347582","58347581"
"58493339","1","58552939","","2019-10-21 20:01:51","","0","305","<p>Using Tymon jwt tokens for auth. Laravel works fine.</p>

<p>When using the upload to S3 code for Laravel vapor I cannot get the signed-storage-url to use my axios defaults:</p>

<p><code>axios.defaults.headers.common[""Authorization""] = 'Bearer ' + token;</code></p>

<p>Store Method as shown in the docs:</p>

<pre><code>Vapor.store(this.$refs.file.files[0], {
    progress: progress =&gt; {
        this.uploadProgress = Math.round(progress * 100);
    }
}).then(response =&gt; {
...
</code></pre>

<p>It calls this in the index.js of the npm package:</p>

<pre><code>async store(file, options = null) {
        // want this to use my default header.
        const response = await axios.post('/vapor/signed-storage-url', {
            'bucket': options.bucket || '',
            'content_type': options.contentType || file.type,
            'expires': options.expires || ''
        });
</code></pre>

<p>Maybe something to do with the npm module not being in the correct scope.</p>

<p>I have overridden the vapor-core signed-storage-url controller to use the token and can get that to work no problem with Postman.
It is calling Vapor.store that doesn't add the token to the axios call and I don't see a way to pass in the headers.</p>

<p><strong>Edit</strong>: You can use these packages without signing up for Vapor.</p>

<pre><code>composer require laravel/vapor-core
</code></pre>

<p>and</p>

<pre><code>npm install --save-dev laravel-vapor
</code></pre>
","1279109","","1279109","","2019-10-25 05:54:01","2019-10-25 05:58:43","Use Axios defaults in laravel vapor signed-storage-url","<laravel><vue.js><axios><laravel-vapor>","1","0","","","","58493339","140584","140584","laravel-vapor","30","58347582","58347581"
"36204579","1","36204637","","2016-03-24 15:56:42","","2","419","<p>How can I install Vapor on Ubuntu 14, and install it locally to use the latest Swift release?</p>
","2611971","","","","","2016-07-18 20:43:50","Is it possible to use Vapor web framework with Swift 2.2?","<swift><vapor>","1","1","","","","36204579","118712","118712","vapor","592","36204589","36204588"
"38175021","1","","","2016-07-03 22:52:26","","4","943","<p>I have set up an Ubuntu instance on Google Cloud Platform and installed Swift-3 and Vapor on it. Then I tried to build the Vapor app with <code>vapor build</code> command and it succeeded. Then I run <code>vapor run</code> on the application folder, it successfully initiate the server and the console says that the service is available on local host, <code>0.0.0.0:8080</code>.</p>

<p>But when I enter the static ip of my VM in the browser window I am not able to see the vapor page I am supposed to. Instead I am getting a <code>connection refused</code> error.</p>
","569497","","2360798","","2016-09-18 23:20:53","2016-09-18 23:20:53","Hosting Vapor Swift App on Google Cloud Platform","<hosting><google-compute-engine><google-cloud-platform><vapor>","2","0","","","","38175021","118712","118712","vapor","592","36204589","36204588"
"38296145","1","38296146","","2016-07-10 20:21:07","","10","2975","<p>When trying to build Vapor 0.13 (and likely other versions) w/ Swift 3 and Xcode </p>

<p><strong>Environment</strong></p>

<pre><code>Vapor: 0.13
Swift: 3
Snapshot: DEVELOPMENT-SNAPSHOT-06-20-A
Xcode: 8
</code></pre>

<p>The following error is often the first result:</p>

<blockquote>
  <p>error: Swift does not support the SDK 'MacOSX10.11.sdk'</p>
</blockquote>
","2611971","","","","","2018-11-04 13:47:58","Vapor Web Framework: error: Swift does not support the SDK 'MacOSX10.11.sdk'","<swift><swift-package-manager><vapor>","1","0","2","","","38296145","118712","118712","vapor","592","36204589","36204588"
"38313470","1","38331067","","2016-07-11 18:09:30","","13","3946","<p>I'm trying to write server side application using Swift and Vapor framework. However, I can't figure out, how to serve static files using Vapor. It's not enough to just move them to the <code>Public</code> or <code>Resources</code> directory.</p>

<p>How can I do that?</p>

<p><strong>UPD.</strong>
I performed steps which Tanner Nelson suggested but it still doesn't work. </p>

<p>What I tried so far:</p>

<ol>
<li><p><code>vapor build</code> and <code>vapor run</code> (using Vapor Toolbox v0.6.1). </p></li>
<li><p><code>./build/debug/App</code> from root directory (which contains <code>Package.swift</code>).</p></li>
<li><p>Run in Xcode 8 beta after editing scheme as Tanner Nelson suggested.</p></li>
</ol>

<p>In all this cases I get error 
<code>{""error"":true,""message"":""Page not found""}</code></p>

<p>I have file <code>vapor_logo.png</code> inside a <code>Public</code> folder and also the same file inside <code>Public/images/</code> folder. I try to request it and it fails. Requests that I made: <code>http://localhost:8080/image/vapor_logo.png</code> and <code>http://localhost:8080/vapor_logo.png</code>. However, other routes work fine. </p>

<p><strong>UPD 2.</strong> Well, that was all my mistakes. First, file that I think was called <code>vapor_logo.png</code>, actually was called <code>vapor-logo.png</code>. Second, case matters when you make a request. I also tried to request file with name <code>IMG_8235.JPG</code> but write file extension as <code>jpg</code>, so got an error.</p>

<p>So, just to recap: if you experience the same problem as me, follow the Tanner Nelson's answer and make sure that name of requested file <strong>exactly</strong> matches name of file on disk.</p>
","6223726","","6223726","","2016-07-12 20:10:47","2018-11-24 15:26:41","How to serve static files using Vapor?","<swift><vapor>","2","0","1","","","38313470","118712","118712","vapor","592","36204589","36204588"
"38357981","1","38438883","","2016-07-13 17:17:31","","15","1821","<p>Sometimes I get this error when trying to run a Vapor application from Xcode. Reopening Xcode doesn't help, only restarting of system do. Is it a bug of the framework? What should I do to prevent this?</p>
","6223726","","","","","2016-12-02 16:02:46","Could not bind to 0.0.0.0:8080, it may be in use or require sudo","<swift><vapor>","2","2","5","","","38357981","118712","118712","vapor","592","36204589","36204588"
"38544089","1","38571359","","2016-07-23 16:39:40","","2","1061","<p>This question is about the Swift Web Framework, Vapor.  </p>

<p>I am trying to import VaporMySQL framework using Swift's Package Manager.</p>

<p>I already have the database running locally, the mySQL port is open &amp; working, the mySQL database is working, the Vapor app is working [I have written several GET / POST requests that work].</p>

<p>But I can't Import VaporMySQL.  <strong>This may be related to my lack of knowledge with Package.swift.</strong>  </p>

<pre><code>    let package = Package(
    name: ""HelloWorld"",        
    dependencies: [
    .Package(url: ""https://github.com/qutheory/vapor.git"", majorVersion: 0, minor: 10),
    .Package(url: ""https://github.com/qutheory/cmysql.git"", majorVersion: 0, minor: 2)
</code></pre>
","5562045","","330315","","2016-07-25 15:12:17","2016-07-25 15:12:17","Vapor MySQL - not showing as an Import value","<mysql><swift><vapor>","1","0","","","","38544089","118712","118712","vapor","592","36204589","36204588"
"55275018","1","55277971","","2019-03-21 06:39:59","","1","280","<p>How to use fluent-mysql to join query and limit query in Vapor 3? eg:</p>

<p><code>SELECT a.*, b.* ON a.id = b.aid LIMIT 0,10</code></p>

<p>I am not find such examples and documents.</p>
","10898359","","452584","","2019-03-21 15:09:35","2019-03-21 15:09:35","vapor 3 fluent-mysql join query","<vapor><vapor-fluent><fluent-mysql>","1","3","1","","","55275018","136591","136591","vapor-fluent","38","54295329","54295328"
"55282303","1","55283560","","2019-03-21 14:07:22","","2","511","<p>I tried to make the most basic example that I could think of for my problem. I have a <code>Course</code> model and a many-to-many table to <code>User</code> that also stores some extra properties (the <code>progress</code> in the example below).</p>

<pre class=""lang-swift prettyprint-override""><code>import FluentPostgreSQL
import Vapor

final class Course: Codable, PostgreSQLModel {
  var id: Int?
  var name: String
  var teacherId: User.ID

  var teacher: Parent&lt;Course, User&gt; {
    return parent(\.teacherId)
  }

  init(name: String, teacherId: User.ID) {
    self.name = name
    self.teacherId = teacherId
  }
}

struct CourseUser: Pivot, PostgreSQLModel {
  typealias Left = Course
  typealias Right = User

  static var leftIDKey: LeftIDKey = \.courseID
  static var rightIDKey: RightIDKey = \.userID

  var id: Int?
  var courseID: Int
  var userID: UUID
  var progress: Int

  var user: Parent&lt;CourseUser, User&gt; {
    return parent(\.userID)
  }
}
</code></pre>

<p>Now, when I return a <code>Course</code> object, I want the JSON output to be something like this:</p>

<pre><code>{
  ""id"": 1,
  ""name"": ""Course 1"",
  ""teacher"": {""name"": ""Mr. Teacher""},
  ""students"": [
    {""user"": {""name"": ""Student 1""}, progress: 10},
    {""user"": {""name"": ""Student 2""}, progress: 60},
  ]
}
</code></pre>

<p>Instead of what I would normally get, which is this:</p>

<pre><code>{
  ""id"": 1,
  ""name"": ""Course 1"",
  ""teacherID"": 1,
}
</code></pre>

<p>So I created some extra models and a function to translate between them:</p>

<pre class=""lang-swift prettyprint-override""><code>struct PublicCourseData: Content {
  var id: Int?
  let name: String
  let teacher: User
  let students: [Student]?
}

struct Student: Content {
  let user: User
  let progress: Int
}

extension Course {
  func convertToPublicCourseData(req: Request) throws -&gt; Future&lt;PublicCourseData&gt; {
    let teacherQuery = self.teacher.get(on: req)
    let studentsQuery = try CourseUser.query(on: req).filter(\.courseID == self.requireID()).all()

    return map(to: PublicCourseData.self, teacherQuery, studentsQuery) { (teacher, students) in
      return try PublicCourseData(id: self.requireID(),
                                  name: self.name,
                                  teacher: teacher,
                                  students: nil) // &lt;- students is the wrong type!
    }
  }
}
</code></pre>

<p>Now, I am <em>almost</em> there, but I am not able to convert <code>studentsQuery</code> from <code>EventLoopFuture&lt;[CourseUser]&gt;</code> to <code>EventLoopFuture&lt;[Student]&gt;</code>. I tried multiple combinations of <code>map</code> and <code>flatMap</code>, but I can't figure out how to translate an array of Futures to an array of different Futures.</p>
","403425","","403425","","2019-03-21 14:29:12","2019-03-21 16:48:28","Vapor 3: transform array of Future object to an array of Future other objects","<vapor><vapor-fluent>","1","0","","","","55282303","136591","136591","vapor-fluent","38","54295329","54295328"
"55383680","1","","","2019-03-27 17:53:58","","1","216","<p>I'm using <code>Vapor 3</code> and <code>FluentMySQL</code> for my new project and want to change maximum length of a field (<code>varchar(N)</code>) via migration. How can I do this?</p>

<p>I have a Model named <code>Word</code> in my project and one of its fields is <code>sourceIdentifier</code> that is <code>String</code> and have maximum length of 12. The model is something like this:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Word: MySQLModel {
    ...other properties

    var sourceIdentifier: String

    ...other properties
}
</code></pre>

<p>At the beginning, I thought 5 is enough for the field and used this code to create <code>Table</code> for this model:</p>

<pre class=""lang-swift prettyprint-override""><code>static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
    return MySQLDatabase.create(Word.self, on: conn) { builder in
        ...other fields...

        builder.field(for: \.sourceIdentifier, type: .varchar(5, characterSet: nil, collate: nil))

        ...other fields...
    }
}
</code></pre>

<p>As you see above, the table created with field <code>sourceIdentifier</code> and its type is <code>.varchar(5, characterSet: nil, collate: nil)</code>.</p>

<p>Now I want to increase maximum length of the field via migration. </p>

<p>I also tried <code>MySQLDatabase.update</code> like this:</p>

<pre class=""lang-swift prettyprint-override""><code>static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
    return MySQLDatabase.update(Word.self, on: conn) { builder in
        builder.field(for: \.sourceIdentifier, type: .varchar(12, characterSet: nil, collate: nil))
    }
}
</code></pre>

<p>and it didn't work; Nothing happened.</p>

<p>How can I change structure of the table via <code>Vapor</code>, <code>FluentMySQL</code> and migrations?</p>
","2894482","","","","","2020-02-12 08:11:53","Change a VARCHAR field via migration in Vapor Fluent-MySQL","<swift><vapor><vapor-fluent><fluent-mysql>","2","0","","","","55383680","136591","136591","vapor-fluent","38","54295329","54295328"
"58531591","1","","","2019-10-23 22:10:44","","0","118","<p>I installed Vapor in a brand new Laravel up. When I try to run 'vapor deploy production' I get this error: </p>

<pre><code>Running Command: npm ci &amp;&amp; npm run prod &amp;&amp; rm -rf node_modules
npm ERR! cipm can only install packages with an existing package-lock.json or npm-shrinkwrap.json with lockfileVersion &gt;= 1. Run an install with npm@5 or later to generate it, then try again.

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/vagrant/.npm/_logs/2019-10-23T21_24_09_128Z-debug.log

In Process.php line 254:

  The command ""npm ci &amp;&amp; npm run prod &amp;&amp; rm -rf node_modules"" failed.

  Exit Code: 1(General error)

  Working directory: /home/vagrant/code/sales2/.vapor/build/app

  Output:
  ================


  Error Output:
  ================
  npm ERR! cipm can only install packages with an existing package-lock.json or npm-shrinkwrap.json with lockfileVers
  ion &gt;= 1. Run an install with npm@5 or later to generate it, then try again.

  npm ERR! A complete log of this run can be found in:
  npm ERR!     /home/vagrant/.npm/_logs/2019-10-23T21_24_09_128Z-debug.log
</code></pre>

<p>I sucessfully installed vapor. Created a new project and left the domain setting at default.</p>
","5964689","","","","","2019-11-06 16:05:16","Running Vapor from Homestead failds","<laravel><homestead><laravel-vapor>","1","1","","","","58531591","140584","140584","laravel-vapor","30","58347582","58347581"
"58556767","1","","","2019-10-25 10:28:13","","0","128","<p>I just updated my Laravel application to 6.0 to use the new tool Vapor.
However, after the deployment process end, I get this error when i access the app using the vanity url :</p>

<pre><code>ErrorException thrown with message 
""file_put_contents(/tmp/storage/framework/sessions/cqDlEgxQSwsYKnBGpPjv94Dvzasa0ECmqF1Rl9xV): 
failed to open stream: No such file or directory""
</code></pre>

<p>Do you have some ideas about the reason of this error ?
Thank you</p>
","5718447","","","","","2019-10-25 10:45:52","Error with file_put_contents() when deploying web app using Laravel Vapor","<php><laravel><laravel-vapor>","0","2","","","","58556767","140584","140584","laravel-vapor","30","58347582","58347581"
"58613935","1","","","2019-10-29 19:09:20","","1","411","<p>I have a Laravel application (v6.x), deployed with Vapor. </p>

<p>I'm trying to upload a file using a form within Laravel Nova. </p>

<p>Nova offers multiple ways of uploading, one using their own implementation for ease of use and another where the developer has more control.</p>

<p>Standard code: </p>

<pre><code>public function fields(Request $request)
    {
        return [
              File::make('file')
                -&gt;disk('s3')
                -&gt;storeSize('attachment_size')-&gt;nullable()
                -&gt;path('ID-'.$request-&gt;associatedId)
                -&gt;putFile()
                -&gt;hideWhenUpdating()
                -&gt;hideFromIndex(),
        ];
    }
</code></pre>

<p>And ""taking control"": </p>

<pre><code>public function fields(Request $request)
    {
        return [
              File::make('file')
              -&gt;store(function (Request $request, $model) {
                // I think i can do whatever i want here.

                  return [
                      'file' =&gt; $request-&gt;file-&gt;store('/ITEM-'.$request-&gt;associatedId, 's3'),
                      'attachment_size' =&gt; $request-&gt;file-&gt;getSize(),
                  ];
              }),
         ];
    }
</code></pre>

<p>Both of these work, as long as the file is about ~3MB or less. However, i will need to upload files that are roughly 20~200 MB in size. </p>

<p>Whenever i try to submit the form, all the information gets stored into the database, and no error is displayed. Sadly, the file field is not filled and no upload took place.</p>

<p>What do i need to do to make large file uploads in Laravel nova possible? </p>
","1692823","","","","","2019-10-29 19:09:20","Uploading large files using Laravel Nova","<laravel><file-upload><laravel-vapor>","0","8","","","","58613935","140584","140584","laravel-vapor","30","58347582","58347581"
"58698556","1","","","2019-11-04 17:41:34","","0","192","<p>I successfully deployed an app on AWS with Laravel Vapor.</p>

<pre><code>  ==&gt; Ensuring Storage Exists
  ==&gt; Ensuring Cache Table Is Configured
  ==&gt; Updating Function Configurations
  ==&gt; Updating Function Code
  ==&gt; Running Deployment Hooks
  ==&gt; Ensuring Rest API Is Configured
  ==&gt; Ensuring Custom Domains Exist
  ==&gt; Ensuring DNS Records Exist
  ==&gt; Ensuring Mail Is Configured
  ==&gt; Ensuring Scheduled Tasks Are Configured
  ==&gt; Ensuring Queues Are Configured
  ==&gt; Updating Function Aliases To New Version

  Project deployed successfully. (1m26s)

=============== =================================================== 
  Deployment ID   Environment URL (Copied To Clipboard)              
 =============== =================================================== 
  38261           https://clean-kyiv-40wzwvz1sutk.vapor-farm-a1.com  
 =============== =================================================== 
</code></pre>

<p>However, when I go on the given link <code>https://clean-kyiv-40wzwvz1sutk.vapor-farm-a1.com</code> I am getting 502 Error
<img src=""https://i.imgur.com/TRAspAA.png"" alt=""502""></p>

<p>After requesting the link I can see, on Vapor, in the <code>Log</code> tab inside the staging environment next message.</p>

<p><img src=""https://i.imgur.com/Gouu0wW.png"" alt=""a busy cat""></p>

<p>What else should I check to resolve that issue?</p>
","8463002","","8463002","","2019-11-04 18:05:28","2020-03-08 15:29:08","Laravel Vapor {“message”:“The security token included in the request is invalid.”}","<laravel><amazon-web-services><laravel-vapor>","1","6","","","","58698556","140584","140584","laravel-vapor","30","58347582","58347581"
"38547464","1","","","2016-07-24 00:00:20","","3","432","<p>I was following the instructions <a href=""https://vapor.readme.io/docs/install-toolbox"" rel=""nofollow"">here</a>, but was not able to get vapor working on my mac. Here're my xcode and swift versions</p>

<pre><code>Xcode 8.0
Build version 8S174q

Apple Swift version 3.0-dev (LLVM 8fcf602916, Clang cf0a734990, Swift 000d413a62)
Target: x86_64-apple-macosx10.9
</code></pre>

<p>When I try to install the toolbox using this command</p>

<pre><code>curl -sL toolbox.qutheory.io | bash
</code></pre>

<p>The installation is unsuccessful and yields this message</p>

<pre><code>⚠️  It looks like your Command Line Tools version is incorrect.
Make sure Xcode &gt; Preferences &gt; Locations &gt; Command Line Tools is set correctly.
Correct: Xcode 8.0 (8S162m)
Current: Xcode 8.0
Build version 8S174q

⚠️  It looks like your Swift install location has been modified.
Correct: /usr/bin/swift
Current: /Users/&lt;name&gt;/.swiftenv/shims/swift

❌  Incompatible

Reason: Invalid Swift version
Output must contain 'swiftlang-800.0.33.1'

Current 'swift -version' output:
Apple Swift version 3.0-dev (LLVM 8fcf602916, Clang cf0a734990, Swift 000d413a62) Target: x86_64-apple-macosx10.9

📖  Visit our docs for step-by-step instructions on installing Swift correctly.
http://docs.qutheory.io

👋  or Join our Slack and we'll help you get setup.
http://slack.qutheory.io
</code></pre>

<p>From this, I can gather that my swift location is wrong (I don't remember changing it) and that my xcode build number is wrong (because xcode beta 2 is no longer available for download, so I got xcode beta 3.)</p>

<p>Can anybody help me to get this working without changing too much, or is this framework still too finicky to work with a slightly different setup?</p>
","1637272","","1255289","","2016-08-23 19:03:25","2016-08-23 19:03:46","Trouble getting Vapor to work with Xcode 8 beta 3","<swift><vapor>","2","0","1","","","38547464","118712","118712","vapor","592","36204589","36204588"
"38812065","1","38815145","","2016-08-07 07:48:28","","4","818","<p>I just started swift backend development. I noticed Vapor &amp; installed swift packange manager (Swiftenv). I follow its <a href=""https://medium.com/@timominous/basic-swift-server-setup-using-vapor-475b10e811b7#.gwn857dg2"" rel=""nofollow"">instruction</a> to install Vapor CLI by :</p>

<pre><code>wget cli.qutheory.io -O vapor
</code></pre>

<p>But constantly get error:</p>

<pre><code>Resolving cli.qutheory.io... 138.197.255.240
Connecting to cli.qutheory.io|138.197.255.240|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2016-08-07 10:41:15 ERROR 404: Not Found.
</code></pre>

<p>Anyone faces the same problem? How to get rid of it?</p>

<p><strong>I also tried another way :</strong></p>

<pre><code>curl -L cli.qutheory.io -o vapor
</code></pre>

<p>The output is:</p>

<pre><code>% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    38  100    38    0     0     21      0  0:00:01  0:00:01 --:--:--    21
</code></pre>

<p>Then, I run command:</p>

<pre><code>chmod +x vapor
</code></pre>

<p>and then:</p>

<pre><code>sudo mv vapor /usr/local/bin
</code></pre>

<p>and then:</p>

<pre><code>vapor self-update
</code></pre>

<p>But I get error:</p>

<pre><code>/usr/local/bin/vapor: line 1: error:1: command not found
</code></pre>

<p>How to install vapor CLI ?</p>
","959734","","","","","2016-08-07 14:29:46","Install Vapor for Swift backend development","<swift><vapor>","1","1","","","","38812065","118712","118712","vapor","592","36204589","36204588"
"38815353","1","38818432","","2016-08-07 14:51:18","","2","416","<p>This is a Swift, Vapor related question.</p>

<p>How do I access the FluentValue type when trying to create a ResponseRepresentable Class?  </p>

<p>The Vapor <code>Model</code> Protocol demands an ID; I want to assign my ID variable as a FluentValue optional.  However, I can't find it (even after Import Vapor &amp; Import Fluent).</p>

<pre><code>import Vapor
import VaporMySQL

let drop = Droplet()

drop.post(String.self, ""boughtcoffee"")     { request, buyerName in

   let coffeeledger = CoffeeLedger(name: buyerName, time: 0)

   guard let atLeastOneDrinker = request.data[""drinker""].string else { 
       throw Abort.custom(status: .badRequest, message: ""Please enter some drinkers"")
}
     return coffeeledger
}
</code></pre>

<p>import Vapor
import Fluent</p>

<pre><code>final class CoffeeLedger: Model {
    var id: FluentValue?
    var name: String
    var time: Int

    init (name: String, time: Int){
        self.name = name
        self.time = time
    }
}
</code></pre>

<p>I am following the Vapor video on setting up a Model that is Response Representable.  <a href=""https://www.youtube.com/watch?v=E1ir7_s_VTw"" rel=""nofollow"">https://www.youtube.com/watch?v=E1ir7_s_VTw</a> </p>
","5562045","","5562045","","2016-08-07 15:09:58","2016-08-08 09:25:32","Vapor - How to access the FluentValue type?","<vapor>","2","1","","","","38815353","118712","118712","vapor","592","36204589","36204588"
"55834641","1","","","2019-04-24 16:26:15","","1","118","<p>I'm using an external auth system to authenticate users.  But I want to capture the results from that external system and create a record for the users that successfully authenticates and is not already in my local DB.  </p>

<p>I've written custom middleware for the external authentication system which is working but I can't figure out how to check if the user already exists in my current DB.  My currently using FluentSQLite as my backing DB.</p>

<pre class=""lang-swift prettyprint-override""><code>let creds = returnFromExternalAuth()
// creds = [""id"": ""1"", ""emailAdress"": ""blah@blah.com"", ""firstName"": ""Test"", ""lastname"": ""User""]

let user = User.query(on: request).filter(\.ID == id).first()
// returns EventLoopFuture&lt;User?&gt;

</code></pre>

<p>What I'd like to do is something like</p>

<pre class=""lang-swift prettyprint-override""><code>if let user = try User.query(on: request).filter(\.ID == id).first(){

// Return the found DB user
return User.query(on: request).filter(\.ID == id).first()

} else {

// create db entry for user
// Query and return the newly created DB object
return User.query(on: request).filter(\.ID == id).first() 

}
</code></pre>

<p>This doesn't work with .first() since it doesn't return an Optional.</p>

<p>Thanks in advance for any help, ideas, or suggestions.</p>

<p>Derek</p>
","11375271","","","","","2019-04-24 20:09:56","Is there a way to check if a record exists?","<vapor-fluent>","1","0","","","","55834641","136591","136591","vapor-fluent","38","54295329","54295328"
"55893199","1","55893277","","2019-04-28 18:13:18","","2","107","<p>I'm writing a web service in Swift using Vapor framework. </p>

<p>I use FluentSQLite to save data. I have a User Model which conforms to the SQLiteModel and Migration. I have added routes to create new user via a post methods and return the list of users via a get method like below. </p>

<p><a href=""https://i.stack.imgur.com/nSEAR.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/nSEAR.png"" alt=""enter image description here""></a></p>

<p>When I hit the get API for first time, it returns an empty array. After I post some users, I am able to get them. But when I stop the service and run again, I am unable to get the previously saved users.</p>

<p>Since I am new to Vapor, I can't figure out what I am missing here and all the online searches and docs didn't help. Initially I did not have a save or query inside a transaction, after seeing that in the docs I tried that also, but same issue. </p>
","9308052","","","","","2019-04-28 18:22:54","Unable to persist data across instances of web service in Swift using Vapor-Fluent","<swift><vapor><server-side-swift><vapor-fluent>","1","2","","","","55893199","136591","136591","vapor-fluent","38","54295329","54295328"
"55899009","1","","","2019-04-29 07:49:01","","0","106","<p>I have two models and they have one-many relation. Here are my classes.</p>

<p><strong>Booking</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Booking: PostgreSQLModel {
    /// The unique identifier for this `Todo`.
    var id: Int?

    /// A title describing what this `Todo` entails.
    var user_id: User.ID
    var product_id: Product.ID
    var count: Int

    /// Creates a new `Todo`.
    init(id: Int? = nil, user_id: User.ID, product_id: Product.ID, count: Int) {
        self.id = id
        self.user_id = user_id
        self.product_id = product_id
        self.count = count
    }
}
extension Booking {
    var user: Parent&lt;Booking, User&gt; {
        return parent(\.user_id)
    }
    var product: Parent&lt;Booking, Product&gt; {
        return parent(\.product_id)
    }
}
</code></pre>

<p><strong>Product</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Product: PostgreSQLModel {
    /// The unique identifier for this `Todo`.
    var id: Int?

    /// A title describing what this `Todo` entails.
    var name: String
    var image_url: String
    var description: String
    var price: Int?

    /// Creates a new `Todo`.
    init(id: Int? = nil, name: String, image_url: String, description: String, price: Int) {
        self.id = id
        self.name = name
        self.image_url = image_url
        self.description = description
        self.price = price
    }
}
extension Product {
    var bookings: Children&lt;Product, Booking&gt; {
        return children(\.product_id)
    }
}
</code></pre>

<p>Now i want to fetch all bookings of a user and with each booking i want to fetch the product information as well. So for this i have tried to join <code>Booking</code> and <code>Product</code> table but this throws an exception.</p>

<blockquote>
  <p>Fatal error: 'try!' expression unexpectedly raised an error: ⚠️ CoreError: <code>Parent&lt;Booking, Product&gt;</code> does not conform to <code>ReflectionDecodable</code>.
  - id: CoreError.ReflectionDecodable
  : file /BuildRoot/Library/Caches/com.apple.xbs/Sources/swiftlang_Fall2018/swiftlang_Fall2018-1000.11.42/src/swift/stdlib/public/core/ErrorType.swift, line 184
  Program ended with exit code: 9</p>
</blockquote>

<p>Here is my code for join.</p>

<pre class=""lang-swift prettyprint-override""><code>let booking = Booking.query(on: req).join(\Product.bookings, to:\Booking.product).filter(\.user_id == userID).decode(BookingM.self).all()
</code></pre>
","2626237","","","","","2019-05-31 14:08:47","Crash on Join with Fluent in Vapor","<swift><postgresql><join><vapor><vapor-fluent>","1","0","","","","55899009","136591","136591","vapor-fluent","38","54295329","54295328"
"38820095","1","","","2016-08-08 01:22:54","","0","49","<p>Running on Mac OS X 10.11 with the example on Vapor site, has anyone getting some error when benchmarking with wrk -c128 -1m <a href=""http://localhost:8080"" rel=""nofollow"">http://localhost:8080</a>?</p>

<p>Is those error related to a bug Vapor's code or Swift's performance issue for web development? Can it be fix with high priority.</p>

<p>Testing them from Vapor 0.14-0.16.</p>
","6689259","","2611971","","2016-08-11 04:00:45","2016-11-10 23:21:54","Mailbox full error when benchmarking Vapor web framework","<vapor>","1","2","","","","38820095","118712","118712","vapor","592","36204589","36204588"
"38983501","1","38983607","","2016-08-16 20:02:59","","3","249","<p>I've checked the documentation of Vapor (web framework for Swift: <a href=""http://docs.vapor.codes/"" rel=""nofollow"">http://docs.vapor.codes/</a>) for any hints or tips to use localization in a mustache template, but I couldn't find anything.</p>

<p>The example project of Vapor contains an example on how to use localization, but then I have to pass all the localized texts to my mustache template which sounds like an overkill to me. This is the example:</p>

<pre><code>let drop = Droplet()
drop.get(""localization"", String.self) { request, lang in
    return try JSON([
        ""title"": drop.localization[lang, ""welcome"", ""title""],
        ""body"": drop.localization[lang, ""welcome"", ""body""]
    ])
}
drop.serve()
</code></pre>

<p>Is there someone that can point me into the right direction?</p>
","1630528","","1041105","","2016-08-16 21:05:10","2016-08-16 21:05:10","Can I use localization directly in a mustache template?","<swift><swift3><vapor>","1","0","","","","38983501","118712","118712","vapor","592","36204589","36204588"
"38988329","1","39001102","","2016-08-17 04:51:56","","9","2577","<p>I've seen in documentation in <a href=""https://vapor.github.io/documentation/http/body.html"" rel=""noreferrer"">Body section</a> that there's a support for file uploading right now - or at least I understand it this way 😅</p>

<p>I have no strong <em>foundation</em> in backend development - especially if it comes to frameworks which are still eveloving so fast as Vapor do. 
I wonder if someone can provide some real life example of file uploading? I was hoping for a simple web page with possibility to upload a file to the backend and then store it for future usage.</p>
","1911042","","","","","2016-08-17 15:47:46","Uploading files using Vapor","<vapor>","1","0","1","","","38988329","118712","118712","vapor","592","36204589","36204588"
"38997750","1","38997827","","2016-08-17 13:15:52","","5","1245","<p>My Vapor and Vapor-MySQL setup died after I tried newer versions in my Package.swift file.  </p>

<p>Ultimately, I wanted a Package.swift that included the following:</p>

<p><code>.Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 0, minor: 16),</code>
<code>.Package(url: ""https://github.com/vapor/mysql-provider.git"", majorVersion: 0, minor: 4)</code></p>

<p>Then I ran 
<code>vapor build --mysql</code>   That worked.  No errors reported.</p>

<p>Then I flipped to Xcode to build the project and hit run.  </p>

<p>I then hit a lot of Framework errors.  ""Pathindexable"". ""CryptoEssentials"" and ""Node"" frameworks.   Seemed to be linker errors.</p>

<p>I then ran <code>vapor clean</code>.  Cleaned my project in Xcode.  No joy.</p>

<p>Any idea why this did not work?</p>
","5562045","","106435","","2016-09-28 10:10:15","2016-09-28 10:10:24","Setting up Vapor and Vapor-MySQL","<vapor>","1","0","","","","38997750","118712","118712","vapor","592","36204589","36204588"
"39000241","1","","","2016-08-17 15:04:24","","0","230","<pre><code>import Vapor
import VaporMySQL

let mysql = try VaporMySQL.Provider(host: ""localhost"", user: ""username"", password: ""secret"", database: ""coffeeLedger"")
</code></pre>

<p>What is the difference between</p>

<pre><code>let drop = Droplet(preparations: [CoffeeLedger.self], providers: [VaporMySQL.Provider.self])
</code></pre>

<p>and....</p>

<pre><code>let drop = Droplet(preparations: [CoffeeLedger.self], providers: [mysql])
</code></pre>

<p>I get a <code>Cannot convert value of type 'Provider' to expected element type 'Provider.Type'</code> error</p>
","5562045","","","","","2016-08-17 19:19:11","VaporMySQL Provider","<vapor>","1","0","","","","39000241","118712","118712","vapor","592","36204589","36204588"
"39058080","1","","","2016-08-20 19:45:30","","2","435","<p>This is a Swift Vapor question related to the Vapor ValidationSuite and Validator.</p>

<p>My Class has a name variable. I used to declare name as a String. But I wanted to perform validation on this field.  So I inherited the attributes of a validated Name field.  See the following example code.</p>

<pre><code>class Name: ValidationSuite {
static func validate(input value: String) throws {
let evaluation = OnlyAlphanumeric.self
    &amp;&amp; Count.min(5)
    &amp;&amp; Count.max(20)
    try evaluation.validate(input: value)
  }
}
</code></pre>

<p>The following code shows my class.  Interesting points; this inherits from the Model class (as it connects to a database) and uses a Node for the ID.  You can see I declared the name variable to conform to a Name type.</p>

<pre><code>final class LedgerUser: Model {
var id: Node?
var name: Name
</code></pre>

<p>This generates a couple of ""Type of expression is ambiguous without more context"".  I guess it relates to Node retrieving a string from the mySQL database and not knowing how to cast it into the Name type?</p>
","5562045","","","","","2016-08-27 20:17:08","Vapor - Validator","<validation><vapor>","2","0","","","","39058080","118712","118712","vapor","592","36204589","36204588"
"56055213","1","","","2019-05-09 08:26:24","","1","120","<p>I am trying to pre populate tables with Vapor 3 and Vapor fluent. I am new to Vapor</p>

<p>I'm trying to populate <code>Sharedkeys</code> with data from <code>Platform</code>. I have managed to query <code>Platform</code>. However, I am struggling to populate <code>SharedKeys</code></p>

<p>So every <code>platform</code> will have a <code>shared key</code> </p>

<p>I have included an example below, with this I have no luck. </p>

<p>On this line
<code>let sharedKeys = platforms.map { platform in</code> 
I get an compile error 
<code>Unable to infer complex closure return type: add explicit type to disambiguate</code></p>

<p>I then realised that <code>map</code> is returning <code>[T]</code>, can't figure out a way to create <code>Future&lt;SharedKey&gt;</code> instead of <code>[SharedKey]</code></p>

<p>Here is an example of my coding, feel free to criticise!</p>

<p>Platform Model</p>

<pre class=""lang-swift prettyprint-override""><code>struct Platform : Codable {
    var id : Int?
    /// Type of platform, i.e. iPhone, iPad, Android etc...
    var platform : String

    init(platform : String) {
        self.platform = platform
    }
}

extension Platform : PostgreSQLModel, Content {}
extension Platform : PostgreSQLMigration {

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: conn) { builder in
            try addProperties(to: builder)
            builder.unique(on: \.platform)
        }
    }
}
</code></pre>

<p>SharedKey Model</p>

<pre class=""lang-swift prettyprint-override""><code>final class SharedKey: Codable {
    var id : Int?
    /// platform
    var platID : Platform.ID?
    /// shared key
    var key : String

    init(key: String, platform : Platform) {
        self.key    = key
        self.platID = platform.id
    }
}

extension SharedKey : PostgreSQLModel, Content {}
extension SharedKey : PostgreSQLMigration {

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: conn) { builder in
            try addProperties(to: builder)
            builder.unique(on: \.key)
        }
    }
}
</code></pre>

<p>Trying to populate <code>sharedKey</code></p>

<pre class=""lang-swift prettyprint-override""><code>        let p = Platform.query(on: conn).all()
        let keysFuture = p.flatMap(to: [SharedKey].self) { platforms in

            let sharedKeys = platforms.map { platform in
                let key = SharedKey(key: ""&lt;random key&gt;"", platform: platform)
                return key.save(on: conn)
            }

            return sharedKeys
        }


</code></pre>

<p>What I am expecting is the variable <code>keysFuture</code> to be type <code>Future&lt;[SharedKey]&gt;</code> NOT <code>[SharedKey]</code></p>

<p>Edit:</p>

<p>I have used this example to pre populate <code>Platform</code>:
<a href=""https://mihaelamj.github.io/Pre-populating%20a%20Database%20with%20Data%20in%20Vapor/"" rel=""nofollow noreferrer"">https://mihaelamj.github.io/Pre-populating%20a%20Database%20with%20Data%20in%20Vapor/</a></p>

<p>Populating strings into a table is easy but trying to populate <code>shared key</code> with <code>platform</code> is a challenge for me.</p>

<p>I realised that I need Sharedkeys to be <code>[EventLoopFuture&lt;Void&gt;]</code> 
I did updated the following:</p>

<pre class=""lang-swift prettyprint-override""><code>   let pp = Platform.query(on: conn).all()
        let op = pp.map { platforms in

           return platforms.map { p in
                return SharedKey(key: ""random"", platform: p).create(on: conn).map(to: Void.self) { _ in return }
            }
        }
</code></pre>

<p>However, this returns as <code>EventLoopFutrue&lt;[EventLoopFutrue&lt;Void&gt;]&gt;</code> is there a way of unwrapping this?</p>

<p>I just need to append <code>[EventLoopFutrue&lt;Void&gt;]</code> to <code>futures</code> from the link above (<a href=""https://mihaelamj.github.io"" rel=""nofollow noreferrer"">https://mihaelamj.github.io</a>)</p>
","5246430","","5246430","","2019-05-10 12:07:46","2019-05-10 12:07:46","Vapor 3, Pre populate table with data from another table","<swift><database><postgresql><vapor><vapor-fluent>","0","7","","","","56055213","136591","136591","vapor-fluent","38","54295329","54295328"
"56765102","1","","","2019-06-26 04:17:51","","2","249","<p>I am writing an API using the server side swift framework Vapor. My model is very simple. I have a <code>Workout</code> table, which has a to many relationship to the <code>Circuit</code> table, which has a to many relationship with the <code>Exercise</code> table. When the api consumer creates a workout, the json contains all circuits and exercises in the workout. Here is an example:</p>

<pre><code>{
    ...
    circuits: [{
        ...,
        exercises: [{
            ""title"": ...
        }, {
            ""title"": ...
        }]
    }, {
        ...,
        exercises: [{
            ""title"": ...
        }, {
            ""title"": ...
        }]
    }]
}
</code></pre>

<p>The problem I am running into is duplicate exercises being created, when the user has the same exercise in multiple circuits. I query the db before creating a new exercise, but it seems like the saves are all happening asynchronously, which prevents me from detecting an existing exercise with the same id/title in the db before saving a new one. Here is my code:</p>

<pre><code>private func saveExercise(on conn: DatabaseConnectable, with content: WorkoutCreateExerciseContent, for authUser: User) throws -&gt; Future&lt;Exercise&gt; {

        if let exerciseId: UUID = content.id {

            return Exercise.find(exerciseId, on: conn)
                .unwrap(or: Abort(.badRequest, reason: ""No exercise for id: \(exerciseId.uuidString)""))

        } else if let title: String = content.title, let isPublicallyVisible: Bool = content.isPublicallyVisible {

            return Exercise.query(on: conn).filter(\.title == title).filter(\.directions == content.directions).first().flatMap({ (possibleMatchingExercise: Exercise?) -&gt; Future&lt;Exercise&gt; in

                if let matchingExercise: Exercise = possibleMatchingExercise {

                    return conn.future(matchingExercise)

                } else {
                    print(""xxx Found no match for \(title)"")
                    let newExercise: Exercise = Exercise(
                        title: title,
                        directions: content.directions,
                        isPublicallyVisible: isPublicallyVisible
                    )
                    newExercise.userId = authUser.id
                    return newExercise.save(on: conn)

                }

            })

        } else {

            throw Abort(.badRequest, reason: """"""
                Bad data for exercise. Expecting either of the following:
                {
                    /""id/"": /""some id/""
                }
                or
                {
                    /""title/"": /""some title/""
                    /""directions/"": /""(optional)/"",
                    /""isPublicallyVisible/"": false
                }
                id takes priority over other properties.
            """""")
        }

    }

    private func saveCircuit(on conn: DatabaseConnectable, with content: CircuitCreateContent, order: Int, workoutId: UUID, authUser: User) throws -&gt; Future&lt;Circuit&gt; {

        return try content.exercises.map({ (exerciseContent: WorkoutCreateExerciseContent) throws -&gt; Future&lt;Exercise&gt; in

            let createdExercise: Future&lt;Exercise&gt; = try self.saveExercise(
                on: conn,
                with: exerciseContent,
                for: authUser
            )

            return createdExercise

        })
        .flatten(on: conn)
        .flatMap({ (exercises: [Exercise]) -&gt; Future&lt;Circuit&gt; in

            let circuit: Circuit = Circuit(
                workoutId: workoutId,
                order: order,
                exerciseDuration: content.exerciseDuration,
                restDuration: content.restDuration,
                exerciseIDs: exercises.compactMap({ $0.id })
            )

            return circuit.save(on: conn)

        })

    }

    func saveWorkout(_ conn: DatabaseConnectable,  _ authentiatedUser: User, _ content: WorkoutCreateContent) throws -&gt; Future&lt;Workout&gt; {

        let workout: Workout = content.makeWorkout()

        workout.userId = authentiatedUser.id

        // First save the exercises

        let createdWorkout: Future&lt;Workout&gt; = workout.save(on: conn).flatMap({ (savedWorkout: Workout) -&gt; Future&lt;Workout&gt; in

            let createdCircuits: Future&lt;[Circuit]&gt; = try content.circuits.enumerated().map({ (order: Int, circuitContent: CircuitCreateContent) throws -&gt; Future&lt;Circuit&gt; in

                let createdCircuit: Future&lt;Circuit&gt; = try self.saveCircuit(
                    on: conn, with: circuitContent,
                    order: order,
                    workoutId: savedWorkout.id!,
                    authUser: authentiatedUser
                )

                return createdCircuit

            })
            .flatten(on: conn)

            return createdCircuits.then({ _ -&gt; Future&lt;Workout&gt; in
                return conn.future(savedWorkout)
            })

        })

        return createdWorkout

    }
</code></pre>

<p>Does anyone see what I'm missing here? Is there a way to wait for a <code>Future</code> to fulfill before starting a new <code>Future</code>? I am new to Vapor, so I'm not that familiar with Vapor's fluent api.</p>
","1402027","","1402027","","2019-06-26 05:28:38","2020-02-18 17:30:49","Wait for async task to complete in request in Vapor","<swift><fluent><vapor><server-side-swift><vapor-fluent>","1","0","","","","56765102","136591","136591","vapor-fluent","38","54295329","54295328"
"57422469","1","57436591","","2019-08-09 01:30:52","","2","169","<p>I use docker to compose Vapor, PostgreSQL and Nginx for a project, my docker-compose.yml like this:</p>

<pre><code>version: ""3.6""

services:
    vapor:
        build:
            context: ./vapor
        image: ${CURRENT_VAPOR_IMG}
        ports:
            - 8080:8080
        volumes:
            - ${HOST_ROOT}:${CONTAINER_ROOT}
        working_dir: ${CONTAINER_ROOT}
        tty: true
        entrypoint: bash
        networks:
            - x-net

    nginx:
        build:
            context: ./nginx
        image: ${CURRENT_NGINX_IMG}
        ports:
            - ${HOST_HTTP_PORT}:80
        volumes:
            - ${HOST_ROOT}:${CONTAINER_ROOT}
        networks:
            - x-net

    psql:
        image: ${CURRENT_DB_IMG}
        ports:
            - 5432:5432
        environment:
            - POSTGRES_DB=xxx
            - POSTGRES_USER=xxx
            - POSTGRES_PASSWORD=pass
        volumes:
            - ~/x/x-db:/var/lib/postgresql/data
    networks:
        - x-net

networks:
    x-net:
         driver: bridge
</code></pre>

<p>After I start all the container by running docker-compose up, then enter to vapor's container to build &amp;&amp; run the project, it will prompt an error to the console:</p>

<pre><code>NIO.ChannelError.connectFailed(NIO.NIOConnectionError(host: ""localhost"", port: 5432, dnsAError: nil, dnsAAAAError: nil, connectionErrors: [NIO.SingleConnectionFailure(target: [IPv6]localhost/::1:5432, error: connection reset (error set): Connection refused (errno: 61)), NIO.SingleConnectionFailure(target: [IPv4]localhost/127.0.0.1:5432, error: connection reset (error set): Connection refused (errno: 61))]))
</code></pre>

<p>Then I run the vapor project on local machine and keep the psql container running, it works normally, such as finished the first migration with models.</p>

<p>Is there any mistakes on my configuration of docker or any others?</p>
","1122446","","1122446","","2019-08-10 10:43:43","2019-08-10 10:43:43","Vapor + PostgreSQL + Nginx build on Docker not operation properly","<vapor><vapor-fluent>","2","0","","","","57422469","136591","136591","vapor-fluent","38","54295329","54295328"
"57676112","1","57681055","","2019-08-27 13:48:05","","0","165","<p>How do I add a default value for a non-optional field in a fluent migration?
I currently have this error:</p>

<pre><code>⚠️ PostgreSQL Error: column ""firstName"" contains null values
</code></pre>

<p>my only options are</p>

<pre><code>public func field&lt;T&gt;(for key: KeyPath&lt;Self.Model, T&gt;, isIdentifier: Bool? = nil)
public func field&lt;T&gt;(for key: KeyPath&lt;Self.Model, T&gt;, type: Self.Model.Database.SchemaFieldType)
</code></pre>

<p><strong>EDIT:</strong> Thanks to Tim's answer, the solution is:</p>

<pre><code>static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.update(User.self, on: conn) { builder in
            builder.field(for: \User.firstName, type: .text, .default(.literal("""")))
        }
    }
</code></pre>
","743923","","743923","","2019-08-28 10:28:26","2019-08-28 10:28:26","Add a default value in migration in Vapor","<swift><vapor><vapor-fluent>","1","1","","","","57676112","136591","136591","vapor-fluent","38","54295329","54295328"
"57879195","1","","","2019-09-10 23:06:29","","0","74","<p>I’m getting a weird error when trying to deploy my Vapor project onto GCP App Engine. I was able to deploy it previously but this error just began out of nowhere. I believe it has something to do with my Fluent Migrations but don’t seem to know how to pinpoint this issue… does anyone have any idea as to why my migration might suddenly fail when it worked before? I followed this tutorial to get it up on App Engine: <a href=""https://medium.com/swift2go/serverless-google-app-engine-flex-docker-runtime-cloud-sql-backend-with-swift-vapor-web-alfian-c8310acfea0d"" rel=""nofollow noreferrer"">https://medium.com/swift2go/serverless-google-app-engine-flex-docker-runtime-cloud-sql-backend-with-swift-vapor-web-alfian-c8310acfea0d</a></p>

<p>I already looked at this stackOverflow question but it is not the same as my issue: <a href=""https://stackoverflow.com/questions/44676231/google-app-engine-deploy-error-code-9"">Google App Engine Deploy Error Code 9</a></p>

<p><a href=""https://i.stack.imgur.com/JraJA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/JraJA.png"" alt=""enter image description here""></a></p>
","8828017","","","","","2019-09-10 23:06:29","Vapor 3 - Error Response 9 on Fluent MySQL when deploying to GCP App Engine","<mysql><google-app-engine><google-cloud-platform><vapor><vapor-fluent>","0","2","","","","57879195","136591","136591","vapor-fluent","38","54295329","54295328"
"59345008","1","","","2019-12-15 14:50:06","","0","76","<p>While fetching vapor signed url we are getting this error. In .env file configured aws credentials</p>

<p>Can any one help how to fix this issue</p>

<p><a href=""https://i.stack.imgur.com/xHFwn.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
","11005701","","","","","2019-12-15 14:50:06","Laravel Vapor: Unable to issue signed URL. Missing environment variables: AWS_BUCKET, AWS_DEFAULT_REGION, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY","<laravel><vue.js><file-upload><laravel-vapor>","0","1","","","","59345008","140584","140584","laravel-vapor","30","58347582","58347581"
"59355601","1","59379135","","2019-12-16 11:20:06","","0","96","<p>I'm attempting to login to Laravel Vapor CLI in order to get started, but it fails without messages.</p>

<p>According to documentation, I should run the command <code>vapor login</code> but when running this command, the script aborts without giving any error messages and also no way of typing Email Address or Password.</p>

<p>I'm on Windows 10, using Laravel 6.3, vapor-cli 1.4, vapor-core 2.2, PHP 7.4.</p>

<p>I have already followed this <a href=""https://stackoverflow.com/questions/57916370/authentication-failed-on-laravel-vapor-cli"">SO question</a> and answer, but without success. I tried the similar approach installing OpenSSL using Chocolatey - although it's not the actual authentication that fails, because in my case, it never gives me the chance to enter credentials.</p>

<p><a href=""https://i.stack.imgur.com/XGysv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/XGysv.png"" alt=""Screendump of attempted Vapor login""></a></p>
","2656059","","2656059","","2019-12-17 19:26:11","2019-12-17 19:26:11","Laravel Vapor CLI login aborts without error. How do I login?","<laravel><laravel-vapor>","1","0","","","","59355601","140584","140584","laravel-vapor","30","58347582","58347581"
"59476548","1","","","2019-12-25 08:28:57","","0","154","<p>Papertrail works on local and never when deployed to Vapor. </p>

<pre><code>'stack' =&gt; [
     'driver' =&gt; 'stack',
     'channels' =&gt; ['papertrail', 'bugsnag'],
  ],
</code></pre>
","1239189","","1239189","","2019-12-26 01:31:48","2019-12-26 01:32:51","Is it possible to use services like Papertrail for Laravel Vapor?","<laravel><laravel-vapor>","1","0","","","","59476548","140584","140584","laravel-vapor","30","58347582","58347581"
"59540401","1","59588830","","2019-12-31 06:24:12","","0","123","<p>I am trying the BugSnag integration with a Laravel app deployed on AWS Lambda through Laravel Vapor.</p>

<p>Bugsnag is working fine on my local but doesn’t send any error from AWS Lamda.</p>

<p>I also tried Bugsnag::setBatchSending(false) but it is still not working for me.</p>

<p>Any ideas what can be wrong?</p>
","8854861","","","","","2020-01-04 07:34:05","BugSnag not working for Laravel Vapor in production","<laravel><aws-lambda><bugsnag><laravel-vapor>","1","0","","","","59540401","140584","140584","laravel-vapor","30","58347582","58347581"
"59541976","1","","","2019-12-31 09:13:42","","1","44","<p>I am using the PHP GD library for image processing in my Laravel Application.</p>

<p>My application is deployed on AWS Lamda.</p>

<p>I am trying to use custom fonts in GD Library.</p>

<p>The function <code>imagettftext</code> specifically asks for the file path. Since I am on AWS Lamba, the path does not work for me.</p>

<p>Is there a way to use the font file stored on S3 with PHP GD?</p>

<p>Is there a way to input the file itself instead of the file path?</p>
","8854861","","","","","2019-12-31 09:26:15","Use font file from S3 bucket with php gd","<php><amazon-web-services><amazon-s3><php-gd><laravel-vapor>","1","0","","","","59541976","140584","140584","laravel-vapor","30","58347582","58347581"
"59590081","1","","","2020-01-04 11:04:32","","1","93","<p>I am literally copying what the Laravel Vapor documentation states but to no avail. So to keep it short, I am unable to access the <code>ASSET_URL</code> environment variable that Taylor says is injected during the build step. </p>

<p>Now note, the same environment variable is being injected into the application which is why the <code>assets()</code> and <code>mix()</code> helpers in blade on index.blade.php work just fine. However, my problem is accessing the <code>ASSET_URL</code> inside <code>webpack.mix.js</code>. </p>

<p>This is from my Github action below. You can see that <code>ASSET_URL</code> is empty when logged.</p>

<pre><code>&gt; @ production /github/workspace/.vapor/build/app
&gt; cross-env NODE_ENV=production node_modules/webpack/bin/webpack.js --no-progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js

ASSET URL IS: 
 DONE  Compiled successfully in 26754ms11:23:07 PM
</code></pre>

<p><strong>webpack.mix.js.</strong> </p>

<pre><code>// To deal with Laravel Vapor
if (mix.inProduction()) {
    const ASSET_URL = process.env.ASSET_URL;
    console.log(""ASSET URL IS: "" + ASSET_URL);

    mix.webpackConfig(webpack =&gt; {
        return {
            plugins: [
                new webpack.DefinePlugin({
                    ""process.env.ASSET_PATH"": JSON.stringify(ASSET_URL)
                })
            ],
            output: {
                publicPath: ASSET_URL
            }
        };
    });
</code></pre>

<p><strong>Proposed solutions on Laracasts forums</strong></p>

<ol>
<li>Paul Marshall suggests that he found a workaround by using <code>window.__ASSET_URL__ = '{{ env('ASSET_URL') }}';</code> but I do not like that approach, unless its the last resort.</li>
<li>@fylzero suggests that I do <code>MIX_ASSET_URL=""${ASSET_URL}""</code> in my environment files to see if Mix can read that. It doesn't.</li>
</ol>
","1239189","","","","","2020-01-04 11:04:32","Why doesn't Laravel Vapor inject ASSET_URL in my build step?","<laravel><webpack><laravel-mix><laravel-vapor>","0","0","","","","59590081","140584","140584","laravel-vapor","30","58347582","58347581"
"39271676","1","","","2016-09-01 12:31:31","","4","1363","<p><strong>Swift 3</strong> introduced <strong>package manager</strong>, with which I can add dependencies to my project. </p>

<p>For example, in my <strong>Package.swift</strong> , I can declare my dependency by:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""my-project"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 0, minor: 16),
    ]
)
</code></pre>

<p>Now, I need to add <a href=""https://github.com/Alamofire/Alamofire"" rel=""noreferrer"">Alamofire</a> to my project, how can I get it through Swift 3 package manager?</p>
","959734","","","","","2017-10-24 06:06:31","Add Alamofire as dependency through Swift 3 package manager","<swift><alamofire><swift3><vapor>","2","5","1","","","39271676","118712","118712","vapor","592","36204589","36204588"
"39280452","1","","","2016-09-01 20:34:39","","1","1699","<p>I am new in Swift based <a href=""https://github.com/vapor/vapor"" rel=""nofollow noreferrer"">Vapor</a> backend framework, I just setup the HelloWorld project. </p>

<p>I need to use <strong>HMAC SHA256</strong> algorithm to encrypt data. I searched on internet, and found <a href=""https://stackoverflow.com/questions/35620960/generating-hmac-sha256-from-byte-array-in-swift"">something like this</a>, but they are all based on iOS or OSX framework, which uses C library and can be added by <code>import &lt;CommonCrypto/CommonHMAC.h&gt;</code>.</p>

<p>How can I add CommonCrypto or HMAC to my Vapor project? If it is impossible, how can I have a pure swift HMAC Sha256 algorithm? Is there such dependency I can add to <em>Package.swift</em> ?</p>
","959734","","-1","","2017-05-23 12:25:17","2017-03-10 14:18:59","have HMAC SHA256 in pure Swift (Vapor) project","<swift3><hmac><vapor>","3","1","1","","","39280452","118712","118712","vapor","592","36204589","36204588"
"39426364","1","","","2016-09-10 13:06:48","","6","674","<p>I'm using Ubuntu 16.04 and having trouble following the installation guide for <a href=""https://vapor.github.io/documentation/getting-started/install-toolbox.html"">Vapor Toolbox</a> . I used swiftenv as described in the guide, and installed the Ubuntu 15.10 version of Swift, but attempting to install the toolbox results in the following: </p>

<pre><code>$ curl -sL toolbox.vapor.sh | bash
✅  Compatible
Downloading...
Compiling...
&lt;unknown&gt;:0: error: build had 1 command failures
error: exit(1): /home/william/.swiftenv/versions/DEVELOPMENT-SNAPSHOT-2016-09-06-a/usr/bin/swift-build-tool -f /home/william/workspace/.vapor-toolbox-0.10.2/vapor-toolbox/.build/release.yaml
Installing...
bash: line 24: .build/release/Executable: No such file or directory
Use vapor --help and vapor &lt;command&gt; --help to learn more.
</code></pre>

<p>Trying 'vapor' results in:</p>

<pre><code>$ vapor
vapor: command not found
</code></pre>
","757550","","","","","2016-09-12 06:37:57","Installing Vapor Toolbox on Ubuntu 16.04","<ubuntu><ubuntu-16.04><vapor>","1","1","1","2016-10-30 21:56:13","","39426364","118712","118712","vapor","592","36204589","36204588"
"39562783","1","39566375","","2016-09-18 21:19:17","","1","219","<p>I just downloaded Xcode 8 and I tried to setup Vapor Test Project manually so followed up this tutorial: </p>

<p><a href=""https://vapor.github.io/documentation/getting-started/manual.html"" rel=""nofollow"">https://vapor.github.io/documentation/getting-started/manual.html</a></p>

<p>But at the time I perform <code>swift build</code> on the terminal I keep receiving this error:</p>

<blockquote>
  <p>Compile Swift Module 'Hello' (1 sources)</p>
  
  <p>/Users/davidvpe/Desktop/Hello/Sources/main.swift:9:1: </p>
  
  <p>error: value of type 'Droplet' has no member 'run'</p>
  
  <p>drop.run() </p>
  
  <p>^~~~ ~~~ </p>
  
  <p>:0:
  error: build had 1 command failures</p>
</blockquote>
","8250305","","2360798","","2016-09-19 02:22:47","2016-09-19 06:08:36","Vapor - Trying to manually set up starter project","<swift><vapor>","1","0","","","","39562783","118712","118712","vapor","592","36204589","36204588"
"39687466","1","","","2016-09-25 13:41:48","","1","723","<p>I just tried to create a web app using Vapor, but when I tried to define my own variable/constant in my project, and write it in main.swift, the following error occurred.</p>

<pre><code>let websiteURL = ""http://localhost:8080"" // in AppConstants.swift
let url = websiteURL // in main.swift
</code></pre>

<blockquote>
  <p>Use of unresolved identifier: <code>websiteURL</code></p>
</blockquote>

<p>However, it seems that the <code>PostController</code> class defined in <code>Controllers</code> directory can be seen without any problems. I put <code>AppConstants.swift</code> in the same directory as <code>main.swift</code>, but it got the error above.</p>

<p>In traditional iOS/macOS app, which is the only project I have developed so far, if you just create any files in the project, they can be seen from anywhere in the project, I think.</p>

<p>So how and where can I create and define my custom file in Vapor? </p>

<hr>

<h2>UPDATE</h2>

<p>Here is my <code>Package.swift</code> file in my project:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""vapor_sample"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 0)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
        ""Tests"",
    ]
)
</code></pre>

<hr>

<h3>UPDATE 2</h3>

<p>I found that for some reasons, the default files created by Vapor are named with directory suffix, like <code>Controllers/PostController.swift</code>, not <code>PostController.swift</code>. I tried moving <code>AppConstants.swift</code> under the directory, but it doesn't show its file name with the directory suffix. Is there anything related to it? I use Xcode 8.0.</p>

<p><a href=""https://i.stack.imgur.com/CaRNB.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/CaRNB.png"" alt=""enter image description here""></a></p>
","2360798","","2360798","","2016-09-27 19:43:55","2016-11-04 19:28:34","Where to create your own file in Vapor?","<swift><xcode><xcode8><vapor>","1","7","","","","39687466","118712","118712","vapor","592","36204589","36204588"
"57881305","1","57881801","","2019-09-11 02:36:46","","1","123","<p>I'm using Vapor 3 for some server-side Swift, with the Fluent add-in for handling database/model management, with MySQL underneath.</p>

<p>I'm working in development and wanted to force the migrator to recreate a table, so I went into mysql on the command line and did:</p>

<pre><code>mysql&gt; drop table SomeTableName;
</code></pre>

<p>However, re-running, the migration doesn't re-create the table.  It has a zillion columns and lots of constraints, so I don't really want to do it manually.</p>
","4044855","","","","","2019-09-14 16:25:31","Force Fluent migration to re-create dropped table -- Using Fluent with Vapor 3 iOS Swift MySQL","<mysql><vapor><vapor-fluent>","1","0","","","","57881305","136591","136591","vapor-fluent","38","54295329","54295328"
"58311066","1","58311666","","2019-10-09 19:31:41","","0","167","<p>I am developing a REST API using <strong>Vapor 3</strong>. This API uses another API to create content that will later be consumed by an app.
So I created a function that fetches content from this API (Leagues and Seasons) and store them on my MySQL DB. The response from the API also contains nested objects that I would want to store too, if it possible all in the same request. Here is the API response:</p>

<pre><code>{
""data"": [
         {
             ""id"": 271,
             ""name"": ""Superliga"",
             ""current_season_id"": 16020,
             ""season"": {
                 ""data"": {
                     ""id"": 16020,
                     ""name"": ""2019/2020"",
                     ""league_id"": 271,
                 }
             }
        }
    ]
}
</code></pre>

<p>Here are the model:</p>

<pre><code>final class League: MySQLModel {

    var id: League.ID?

    var name: String

    var current_season_id: Season.ID

    var currentSeason: Parent&lt;League, Season&gt; {
        return parent(\League.current_season_id)
    }
}

final class Season: MySQLModel {

    var id: Season.ID?

    var name: String

    var league_id: League.ID

    var league: Parent&lt;Season, League&gt; {
        return parent(\.league_id)
    }
}
</code></pre>

<p>Here is the function performing the request and storing on the DB. </p>

<pre><code>func getLeagues(using context: CommandContext) throws -&gt; EventLoopFuture&lt;Void&gt; {
    guard let url = URL(string: ""SOME_API_URL"") else { return .done(on: context.container) }

    let client = try context.container.client()
    return client.get(url).flatMap({ (response) -&gt; EventLoopFuture&lt;Void&gt; in // do the request
        let leagues = response.content.get([League].self, at: ""data"") // get the array of EventLoopFuture&lt;[League]&gt;

        return context.container.requestPooledConnection(to: .mysql).flatMap({ (connection) -&gt; EventLoopFuture&lt;Void&gt; in // connecto to DB

            let savedLeagues = leagues.flatMap(to: [League].self, { (flattenLeagues) -&gt; EventLoopFuture&lt;[League]&gt; in
                return flattenLeagues.map { (league) -&gt; EventLoopFuture&lt;League&gt; in

                    return league.create(orUpdate: true, on: connection) // save on the DB

                }.flatten(on: context.container)
            })

            return savedLeagues.flatMap { (_) -&gt; EventLoopFuture&lt;Void&gt; in
                return .done(on: context.container)
            }
        })
    })
}
</code></pre>

<p>The question would be: it is possible to save a Parent-Child relation? Do I have to do it manually using decode/encode functions?
I did implemented encode/decode and created the League, but don't know how to create te Season and how all can be saved when doing <code>league.create(orUpdate: true, on: connection)</code></p>

<p>Any help would be appriciated.</p>
","4905076","","","","","2019-10-09 20:17:41","How to save Parent-Child relation from a JSON response in Vapor 3","<swift><vapor><vapor-fluent>","1","0","","","","58311066","136591","136591","vapor-fluent","38","54295329","54295328"
"58466181","1","58471904","","2019-10-19 17:21:47","","2","297","<p>I would like to create a route to let users update their data (e.g. changing their email or their username). To make sure a user cannot use the same username as another user, I would like to check if a user with the same username already exists in the database.</p>

<p>I have already made the username unique in the migrations.</p>

<p>I have a user model that looks like this:</p>

<pre><code>struct User: Content, SQLiteModel, Migration {
    var id: Int?
    var username: String
    var name: String
    var email: String
    var password: String

    var creationDate: Date?

    // Permissions
    var staff: Bool = false
    var superuser: Bool = false

    init(username: String, name: String, email: String, password: String) {
        self.username = username
        self.name = name
        self.email = email
        self.password = password
        self.creationDate = Date()
    }
}
</code></pre>

<p>This is the piece of code where I want to use it:</p>

<pre><code>func create(_ req: Request) throws -&gt; EventLoopFuture&lt;User&gt; {
    return try req.content.decode(UserCreationRequest.self).flatMap { userRequest in

        // Check if `userRequest.email` already exists
        // If if does -&gt; throw Abort(.badRequest, reason: ""Email already in use"")
        // Else -&gt; Go on with creation

        let digest = try req.make(BCryptDigest.self)
        let hashedPassword = try digest.hash(userRequest.password)
        let persistedUser = User(name: userRequest.name, email: userRequest.email, password: hashedPassword)

        return persistedUser.save(on: req)
    }
}
</code></pre>

<p>I could do it like this (see next snippet) but it seems a strange option as it requires a lot of nesting when more checks for e.g. uniqueness would have to be performed (for instance in the case of updating a user).</p>

<pre><code>func create(_ req: Request) throws -&gt; EventLoopFuture&lt;User&gt; {
    return try req.content.decode(UserCreationRequest.self).flatMap { userRequest in
        let userID = userRequest.email
        return User.query(on: req).filter(\.userID == userID).first().flatMap { existingUser in
            guard existingUser == nil else {
                throw Abort(.badRequest, reason: ""A user with this email already exists"")
            }

            let digest = try req.make(BCryptDigest.self)
            let hashedPassword = try digest.hash(userRequest.password)
            let persistedUser = User(name: userRequest.name, email: userRequest.email, password: hashedPassword)

            return persistedUser.save(on: req)
        }
    }
}
</code></pre>

<hr>

<p>As one of the answers suggested I've tried to add Error middleware (see next snippet) but this does not correctly catch the error (maybe I am doing something wrong in the code - just started with Vapor).</p>

<pre><code>import Vapor
import FluentSQLite

enum InternalError: Error {
    case emailDuplicate
}

struct EmailDuplicateErrorMiddleware: Middleware {
    func respond(to request: Request, chainingTo next: Responder) throws -&gt; EventLoopFuture&lt;Response&gt; {
        let response: Future&lt;Response&gt;

        do {
            response = try next.respond(to: request)
        } catch is SQLiteError {
            response = request.eventLoop.newFailedFuture(error: InternalError.emailDuplicate)
        }

        return response.catchFlatMap { error in
            if let response = error as? ResponseEncodable {
                do {
                    return try response.encode(for: request)
                } catch {
                    return request.eventLoop.newFailedFuture(error: InternalError.emailDuplicate)
                }
            } else {
                return request.eventLoop.newFailedFuture(error: error)
            }
        }
    }
}
</code></pre>
","11760491","","11760491","","2019-10-20 12:08:08","2019-10-21 11:55:03","Vapor 3 - How to check for similar email before saving object","<swift><rest><vapor><vapor-fluent>","2","4","0","","","58466181","136591","136591","vapor-fluent","38","54295329","54295328"
"59605879","1","59606805","","2020-01-06 02:00:46","","0","304","<p>I'm having a problem loading images in my html dynamically after storing them successfully with Laravel Vapor.</p>

<p>I have followed <a href=""https://docs.vapor.build/1.0/resources/storage.html"" rel=""nofollow noreferrer"">this</a> documentation provided by laravel vapor to store files, and it works like a charm. I copy my uploaded files from the tmp directory into the root of my S3 bucket and then store the path of that file in my databases images table so that later I can return the file path to my front end and display the image in my browser. </p>

<p>Unfortunately this is always returning a 403 status code from AWS S3.</p>

<p>I could fix this by making my generated S3 bucket public, but that would raise a security issue. I believe this should work out of the box, not sure where I could have gone wrong... any ideas?</p>

<p>I am returning the uploaded image url using the Storage facade.</p>

<pre><code>use Illuminate\Support\Facades\Storage;    

return Storage::url($image-&gt;path);
</code></pre>

<p>Where <code>$image-&gt;path</code> is the file path in my S3 bucket.</p>

<p>I'm sure that the storage facade is working correctly because it is returning the correct url with the file's path.</p>
","5457600","","","","","2020-01-06 04:46:17","How to retrieve files from S3 in Laravel Vapor","<laravel><amazon-s3><laravel-vapor>","1","0","","","","59605879","140584","140584","laravel-vapor","30","58347582","58347581"
"59627927","1","","","2020-01-07 11:53:00","","0","46","<p>I get the following error during deployment of Laravel on Vapor:</p>

<pre><code>In Process.php line 256:
The command ""npm ci &amp;&amp; npm run prod &amp;&amp; rm -rf node_modules"" failed.
Exit Code: 1(General error)

rm: cannot remove `node_modules/.cache/terser-webpack-plugin/content-v2/sha512/d8/2c/[very long hash]': File or path name too long
</code></pre>

<p>I'm on Windows 10, and NPM 6.13.4.
It only happens when deploying to production. Deployment works fine to staging. </p>

<p>I have tried to activate long paths in Windows. That didn't work. 
On Vapor, I believe, that I have no way of changing Webpack configuration to use other paths or to flatten the <code>node_modules</code> folder. I have also looked through numerous answers regarding too long paths in NPM.</p>

<p>Do any of you have solutions or suggestions?</p>
","2656059","","","","","2020-01-07 11:53:00","npm error - ""File or path name too long"" during deployment of Laravel on Vapor on Windows 10","<npm><laravel-vapor>","0","0","","","","59627927","140584","140584","laravel-vapor","30","58347582","58347581"
"59640000","1","","","2020-01-08 05:41:34","","1","260","<p>I have followed the instructions for installing a password client for Laravel passport exactly as written in the Laravel docs and with default Laravel 6.0 composer versions of guzzle, etc. I have done the install on an existing project and as a clean install, both on local dev environment and live server, and every time I try to post to the example.com/oauth/token route, I am greeted with a crazy Guzzle error that seems to have no previous search history on the internet. The error is (summarized):</p>

<pre><code>GuzzleHttp\Exception\ServerException

/var/task/vendor/guzzlehttp/guzzle/src/Exception/RequestException.php:113

""Return value of Zend\\Diactoros\\normalizeServer() must be of the type array, none returned""
</code></pre>

<p>I am running php 7.3 in all environments, but tried php 7.2 and 7.1 and got the same result. I'm running Laravel Valet locally, and have never seen anything like this on any other project. I am also running a staging server with Laravel Vapor, and I get the exact same error. My guzzle request is almost exactly the same as Taylor Otwell's example in the Laravel docs, and looks like this:</p>

<pre><code>        $http = new \GuzzleHttp\Client;

        $response = $http-&gt;post(env('API_TOKEN_URL'), [
            'form_params' =&gt; [
                'grant_type' =&gt; 'password',
                'client_id' =&gt; env('PASSPORT_CLIENT_ID'),
                'client_secret' =&gt; env('PASSPORT_CLIENT_SECRET'),
                'username' =&gt; $request['username'],
                'password' =&gt; $request['password'],
            ],
        ]);

        return json_decode((string) $response-&gt;getBody(), true);
</code></pre>

<p>I have data dumped all variables to verify that the username, password, client_id and client_secret are all accurate. It doesn't seem to be an authentication issue at all, but some issue with Guzzle passing proper server headers. I have no idea how to fix, as there is no previous record of this issue that I could find anywhere else on the internet. Any ideas???</p>
","10250802","","","","","2020-01-16 02:41:26","Laravel 6 with laravel passport, weird Guzzle error","<laravel><curl><guzzle><laravel-passport><laravel-vapor>","1","2","","","","59640000","140584","140584","laravel-vapor","30","58347582","58347581"
"39721306","1","39779036","","2016-09-27 09:42:01","","1","629","<p>I want to install SSL(Comodo wildcard certificate, ex: ""*.test.com"")
in Vapor Web framework, the ""servers.json"" I got is:
</p>

<pre><code>{
    ""default"": {
        ""port"": ""$PORT:443"",
        ""host"": ""api.test.com"",
        ""securityLayer"": ""tls"",
        ""tls"": {
            ""certificates"": ""chain"",
            ""certificateFile"": ""/path/ssl-bundle.crt"",
            ""chainFile"": ""/path/ssl-bundle.crt"",
            ""privateKeyFile"": ""/path/key.pem"",
            ""signature"": ""signedFile"",
            ""caCertificateFile"": ""/path/AddTrustExternalCARoot.crt""
            }
    }
}
</code></pre>

<p>I already make sure that ""public/private"" key matches already using openssl command. And about the certificateFile part like ""ssl-bundle.crt"", I also tried ""*.test.com.crt"" with the ""key.pem"" as well(still pass the validation using openssl, the only difference is one is test.com's certificate, the other is bundle certificate, combined by correct orders already.). Besides, all certs and key's format are correct as well. And I also make sure the cert/key files location is correct so that the Vapor can find these files. But I still can't launch the server correctly, and always display the error.

I try to locate the exact location in xcode, but I can only see it fails in this method: ""tls_accept_fds()"", which is in tls_server.c of CLibreSSL library.
</p>

<p><a href=""https://i.stack.imgur.com/qOZhS.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/qOZhS.png"" alt=""enter image description here""></a></p>

<p>Also, I saw the error message the xcode displayed to me:
</p>

<p><a href=""https://i.stack.imgur.com/YYY0y.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/YYY0y.png"" alt=""enter image description here""></a></p>

<p>After use debug mode to trace, I can only know that it seems the program throws the error in ""SSL_set_rfd()"" or ""SSL_set_rfd()"", but I don't know exactly. The xcode only shows this to me, and I can't find any other error messages in the debug console. As result, so far I can only make sure that the error should be in this block:</p>

<pre><code>int
tls_accept_fds(struct tls *ctx, struct tls **cctx, int fd_read, int fd_write)
{
struct tls *conn_ctx = NULL;

// I pass this block
if ((ctx-&gt;flags &amp; TLS_SERVER) == 0) {
    tls_set_errorx(ctx, ""not a server context"");
    goto err;
}

// I pass this block
if ((conn_ctx = tls_server_conn(ctx)) == NULL) {
    tls_set_errorx(ctx, ""connection context failure"");
    goto err;
}

// I pass this block
if ((conn_ctx-&gt;ssl_conn = SSL_new(ctx-&gt;ssl_ctx)) == NULL) {
    tls_set_errorx(ctx, ""ssl failure"");
    goto err;
}

// I pass this block
if (SSL_set_app_data(conn_ctx-&gt;ssl_conn, conn_ctx) != 1) {
    tls_set_errorx(ctx, ""ssl application data failure"");
    goto err;
}

// The error occurs here, in SSL_set_rfd or SSL_set_wfd, it will then go to err part: ""*cctx = NULL;"", not even go into the if block.
if (SSL_set_rfd(conn_ctx-&gt;ssl_conn, fd_read) != 1 ||
    SSL_set_wfd(conn_ctx-&gt;ssl_conn, fd_write) != 1) {
    tls_set_errorx(ctx, ""ssl file descriptor failure"");
    goto err;
}

*cctx = conn_ctx;

return (0);

err:
tls_free(conn_ctx);

*cctx = NULL;

return (-1);
}
</code></pre>

<p>So, the above is all the info I got right now, and I can't find the solution on the internet for several days already...
Could anyone give me any hint about how to install SSL in Vapor web framework? I can correctly install the SSL in Apache, Nginx, Tomcat, etc already. But never success in Vapor, it seems like C library issue, but I don't know the real reason why it fails, thank you very much for any possible help.</p>

<p><p></p>
","3222186","","3222186","","2016-09-27 18:06:54","2016-09-29 20:03:07","How to install SSL certificate in Vapor web framework?","<ssl><openssl><vapor>","1","3","","","","39721306","118712","118712","vapor","592","36204589","36204588"
"39762722","1","39779062","","2016-09-29 06:16:26","","0","459","<p>I'm trying to add SQLite to a Vapor app but not having much luck. Here is what I have done to add it to the project and the error I get in Xcode when I try an build it. The error is in Sqlite.swift on the import statement:  ""No such module 'CSQLiteMac'""  I know there is a missing framework somewhere but I just can't seem to track down what I'm missing and my google fu is failing me. </p>

<pre><code>myke$ brew update
Already up-to-date.

myke$ brew install sqlite3 libsqlite3-dev
Error: No available formula with the name ""libsqlite3-dev""
==&gt; Searching for similarly named formulae...
Error: No similarly named formulae found.
==&gt; Searching taps...
Error: No formulae found in taps.
==&gt; You haven't updated Homebrew in a while.
A formula for libsqlite3-dev might have been added recently.
Run `brew update` to get the latest Homebrew updates!

myke$ vapor build --clean
Cleaning [Done]
No Packages folder, fetch may take a while...
Fetching Dependencies [Done]
Building Project [Done]

myke$ vapor xcode
Fetching Dependencies [Done]
Generating Xcode Project [Done]
Select the `App` scheme to run.
Open Xcode project?
y/n&gt;n
</code></pre>

<p>My Package file: </p>

<pre><code>import PackageDescription

let package = Package(
    name: ""kanban"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 0),
        .Package(url: ""https://github.com/vapor/sqlite-provider.git"", majorVersion: 1, minor: 0)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
        ""Tests"",
    ]
)
</code></pre>
","642502","","","","","2016-09-29 20:04:52","Vapor SQLite missing module CSQLiteMac","<swift><vapor>","1","0","1","","","39762722","118712","118712","vapor","592","36204589","36204588"
"39776073","1","","","2016-09-29 17:00:32","","0","515","<p>I am trying to run a Vapor app on my local machine and have MongoDb installed and running. </p>

<p>I have this as my mongo.json: <code>{
  ""user"": ""test"",
  ""password"": ""password"",
  ""database"": ""reading_journal"",
  ""host"": ""127.0.0.1"",
  ""port"": 2701
}
</code></p>

<p>which is correct in terms of the info for the local DB. </p>

<p>My main.swift: </p>

<pre><code>import Vapor
import FluentMongo
import VaporMongo


let drop = Droplet(providers: [VaporMongo.Provider.self])

drop.get { req in
    let lang = req.headers[""Accept-Language""]?.string ?? ""en""
    return try drop.view.make(""welcome"", [
        ""message"": Node.string(drop.localization[lang, ""welcome"", ""title""])
    ])
}

drop.resource(""users"", UserController())
drop.resource(""posts"", PostController())

drop.run()
</code></pre>

<p>Yet in the log I get: ""Could not initialize provider Provider: Socket failed with code 61 (""No data available"") [connectFailed] ""Unknown error""</p>

<p>Is there some other initialization that needs to be done? This is a brand new MongoDB DB.</p>

<p>Any help would be greatly appreciated!</p>
","467183","","","","","2016-10-20 22:52:51","Vapor MongoDB Provider Error","<swift><mongodb><vapor>","2","0","","","","39776073","118712","118712","vapor","592","36204589","36204588"
"39812998","1","39813691","","2016-10-02 01:22:02","","10","4455","<p>I am trying to install vapor (<a href=""https://github.com/vapor/vapor"" rel=""noreferrer"">https://github.com/vapor/vapor</a>) toolbox on a server which is running Ubuntu 15.10 x64.</p>

<p>I am getting this error from the ""swift build"" command</p>

<pre><code>/swift-3.0/usr/bin/swift-build: error while loading shared libraries:    libcurl.so.4: cannot open shared object file: No such file or directory
</code></pre>

<p><strong>Is this a curl issue?  How can I resolve this error?</strong></p>

<h1>Details:</h1>

<p>I am following the steps described here:
<a href=""https://vapor.github.io/documentation/getting-started/install-toolbox.html"" rel=""noreferrer"">https://vapor.github.io/documentation/getting-started/install-toolbox.html</a></p>

<p>Swift 3.0 has been installed:</p>

<pre><code>user@server:~$ swift --version
Swift version 3.0 (swift-3.0-RELEASE)
Target: x86_64-unknown-linux-gnu
</code></pre>

<p>To install the toolbox: </p>

<pre><code>user@server:~$ curl -sL toolbox.vapor.sh | bash

✅  Compatible
Downloading...
Compiling...
/swift-3.0/usr/bin/swift-build: error while loading shared libraries: libcurl.so.4: cannot open shared object file: No such file or directory
Installing...
bash: line 22: .build/release/Executable: No such file or directory
Use vapor --help and vapor &lt;command&gt; --help to learn more.
</code></pre>

<p>The error above happens at this line in the script: <code>swift build -c release &gt; /dev/null;</code></p>

<p><code>swift build --help</code> gives this same error:</p>

<pre><code>user@server:~$ swift build --help
/swift-3.0/usr/bin/swift-build: error while loading shared libraries: libcurl.so.4: cannot open shared object file: No such file or directory
</code></pre>

<p>vapor is not present:</p>

<pre><code>user@server:~$ vapor --help
vapor: command not found
</code></pre>

<p>Also curl info:</p>

<pre><code>user@server:~$ sudo -i curl --version
curl 7.43.0 (x86_64-pc-linux-gnu) libcurl/7.43.0 GnuTLS/3.3.15 zlib/1.2.8 libidn/1.28 librtmp/2.3
Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp 
Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP UnixSockets 
</code></pre>

<p>curl was installed with <code>sudo apt-get install curl</code> and did not report any errors.</p>

<p><code>user@server:/usr/lib$ find . | grep curl</code> reports about 15 matches but none are exactly libcurl.so.4.  The closes matches are:</p>

<pre><code>./x86_64-linux-gnu/libcurl-gnutls.so.4
./x86_64-linux-gnu/libcurl-gnutls.so.4.3.0
./x86_64-linux-gnu/libcurl-gnutls.so.3
</code></pre>
","4692222","","4692222","","2016-12-21 05:39:14","2016-12-21 05:39:14","swift build error on ubuntu 15.10","<ubuntu><curl><swift3><libcurl><vapor>","1","0","3","","","39812998","118712","118712","vapor","592","36204589","36204588"
"58755538","1","60081235","","2019-11-07 19:16:06","","2","244","<p>I am creating backend based on Vapor 3.1.10 using Xcode 11.2 and Swift 5.1, database is PostgreSQL 12. I have a question: how to interact with database (CRUD) without POST and GET requests. All tutorials show how to CRUD only based on Request through HTTPS. But what if my app needs to save something in database without interacting with network? Look at my code:</p>

<pre class=""lang-swift prettyprint-override""><code>import Vapor
import FluentPostgreSQL

final class Device: PostgreSQLModel {        
    var id: Int?
    var isWorking: Bool
    var serial: Int

    init(isWorking: Bool, serial: Int) {
        self.isWorking = isWorking
        self.serial = serial
    }    
}
extension Device: Content {}
extension Device: Migration {}
extension Device: Parameter {}
</code></pre>

<p>classical method to write or read is:</p>

<pre class=""lang-swift prettyprint-override""><code>import Vapor

final class DeviceController {        
    func readAll(_ req: Request) throws -&gt; Future&lt;[Device]&gt; {
        return Device.query(on: req).all()
    }

    func create(_ req: Request) throws -&gt; Future&lt;Device&gt; {
        return try req.content.decode(Device.self).flatMap { device in
            return device.save(on: req)
        }
    }
}
</code></pre>

<p>How to replace <code>req</code> to another background, safe thread, which I can create locally?</p>

<p>For example:</p>

<pre class=""lang-swift prettyprint-override""><code>let device = Device(isWorking: true, serial: 54321)
device.save(on: &lt;#T##DatabaseConnectable#&gt;)
</code></pre>

<p>How to replace <code>&lt;#T##DatabaseConnectable#&gt;</code> ?</p>

<p>I will be thankful for any help or advice.</p>
","4716121","","1001057","","2019-11-08 12:26:18","2020-02-05 17:36:46","Vapor 3 PostgreSQL CRUD without requests http","<swift><xcode><postgresql><vapor><vapor-fluent>","2","3","","","","58755538","136591","136591","vapor-fluent","38","54295329","54295328"
"59023131","1","","","2019-11-24 22:38:30","","1","77","<p>I'm using Vapor on a Ubuntu server to connect to my DigitalOcean-managed PostgreSQL database.</p>

<p>From the command-line, running the following works fine: </p>

<pre><code>psql postgresql://user:password@host:port/dbname?sslmode=require
</code></pre>

<p>But running the equivalent with the following code gives me: </p>

<pre><code>Fatal error: Error raised at top level: NIOOpenSSL.NIOOpenSSLError.handshakeFailed(NIOOpenSSL.OpenSSLError.sslError([Error: 337047686 error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed])): file /home/buildnode/jenkins/workspace/oss-swift-5.1-package-linux-ubuntu-18_04/swift/stdlib/public/core/ErrorType.swift, line 200
</code></pre>

<p>Here is the code: </p>

<pre class=""lang-swift prettyprint-override""><code>    let postgres = PostgreSQLDatabase(config: PostgreSQLDatabaseConfig(
        hostname: Environment.get(""POSTGRESQL_HOSTNAME"")!,
        port: Int(Environment.get(""POSTGRESQL_PORT"")!)!,
        username: Environment.get(""POSTGRESQL_USERNAME"")!,
        database: Environment.get(""POSTGRESQL_DATABASE"")!,
        password: Environment.get(""POSTGRESQL_PASSWORD"")!,
        transport: .standardTLS
    ))
</code></pre>

<p>Switching the transport argument to <code>.unverifiedTLS</code> works.</p>

<p>I need help to let Vapor work out the SSL connection fine, but I have no idea where to start.</p>
","455016","","","","","2019-11-24 22:38:30","How can I help Vapor successfully SSL-handshake my PostgreSQL server?","<swift><postgresql><ssl><vapor><vapor-fluent>","0","2","","","","59023131","136591","136591","vapor-fluent","38","54295329","54295328"
"59108951","1","59109543","","2019-11-29 17:23:44","","1","62","<p>why this works when directly in router.swift</p>

<pre><code>router.delete(""users"", User.parameter, ""books"", Book.parameter, ""favourite"") { req -&gt; Future&lt;HTTPStatus&gt; in
    try req.parameters.next(User.self).flatMap { user in
        try req.parameters.next(Book.self).flatMap { book in
            UserBookWatched.query(on: req).filter(\.userID == user.id!).filter(\.bookID == book.id!).first().flatMap { books in
                if let books = books {
                    return books.delete(on: req).transform(to: HTTPStatus.noContent)
                }

                return req.future().transform(to: HTTPStatus.notFound)
            }
        }
    }
}
</code></pre>

<p>and this one does not work in route controller</p>

<pre><code>// userid hardcoded, book from Book.parameter 
func removeBookFromFavourited(_ req: Request) throws -&gt; Future&lt;HTTPStatus&gt; {
    let user = User(id: StaticUser.id)

    try req.parameters.next(Book.self).flatMap(to: HTTPStatus.self) { book in
        UserBookFavourited.query(on: req)
            .filter(\.userID == user.id!)
            .filter(\.bookID == book.id!)
            .first().flatMap { books in
            if let books = books {
                return books.delete(on: req).transform(to: HTTPStatus.noContent)
            }

            return req.future().transform(to: HTTPStatus.notFound)
        }
    }
}
</code></pre>

<p>it drops error that   <code>.filter(\.userID == user.id!)</code> ""Type of expression is ambiguous in this context""</p>

<p>models are properly defined as pivot</p>

<p>thx in advance for help(edytowane)
static user will be replaced with JWT token sent in request headers</p>
","1285959","","","","","2019-11-29 18:25:34","Vapor filters are ambiguous in context","<swift><vapor><vapor-fluent>","1","9","","","","59108951","136591","136591","vapor-fluent","38","54295329","54295328"
"60058443","1","60059852","","2020-02-04 13:25:57","","2","37","<p>First up I know something is wrong fundamentally with the way I am running my queries. I would like to ignore the root cause of this and in this question just ask the following:</p>

<p>I have a PHP script running on Lambda (Larval Vapor). The lambda function times out at 60 seconds while running a batch of insert, update and delete queries, however in the MySQL process list I see these queries running for a long long time afterwards (tens of minutes).</p>

<p>Where are these queries coming from if the PHP script has timed out? My guess is they are being stored in the QUERY CACHE but I am just guessing. I would love to know a little more about how this works.</p>

<p>The issue I am having at the moment is the php script times out and my application therefor thinks it has failed. On a later function we run the same queries again but of-course they are still running on the RDS instance. We therefore end up just layering the same queries over the top of each other - PHP has no idea that the SQL server has any queries running... </p>
","6771855","","","","","2020-02-04 15:07:43","MySQL (RDS) queries are running in my process list long after my scripts have finished","<php><mysql><laravel><rds><laravel-vapor>","2","0","","","","60058443","140584","140584","laravel-vapor","30","58347582","58347581"
"60232569","1","","","2020-02-14 19:42:55","","1","36","<p>I'm having difficulty pre-warming my deploys.  The first few minutes after a deploy produce a lot of request timeouts, followed by too many db connections, ... followed by stability.  If I pre-warm a bunch then it triggers the too many db connection errors ... so I guess I need to pre-scale both.  Anybody know how to do this in vapor.yaml or vapor web gui ... or aws as a last resort? (but I'd like to keep the infra config with the project repo)</p>
","4740921","","","","","2020-02-20 17:17:30","How can I prewarm laravel vapor lambda instances as well as the serverless db?","<laravel><laravel-vapor>","1","4","","","","60232569","140584","140584","laravel-vapor","30","58347582","58347581"
"60470284","1","60472346","","2020-02-29 22:40:49","","0","107","<p>I have a small simple API, basically for testing purposes built in Laravel 6 using a simple JWT Auth to allow login and restricted access to a couple of routes. All simple stuff really and it works just fine using Homestead.</p>

<p>However, on <a href=""https://vapor.laravel.com/"" rel=""nofollow noreferrer"">Vapor</a> I can't get it to actually talk to the database.
Here's what my vapor.yml looks like, it's not changed much from the default other than adding the db name in</p>

<pre><code>id: 7529
name: mything
environments:
    production:
        database: mydb
        database-user: vapor
        memory: 1024
        cli-memory: 512
        runtime: php-7.4
        build:
            - 'composer install'
            - 'php artisan jwt:secret'
            - 'php artisan event:cache'
            - 'npm ci &amp;&amp; npm run prod &amp;&amp; rm -rf node_modules'
    mything-environment:
        build:
            - 'composer install'
    staging:
        memory: 1024
        cli-memory: 512
        runtime: php-7.4
        build:
            - 'composer install'
            - 'php artisan jwt:secret'
            - 'php artisan event:cache'
            - 'npm ci &amp;&amp; npm run dev &amp;&amp; rm -rf node_modules'
</code></pre>

<p>I have set up the db using the vapor CLI as so
<code>php vendor/bin/vapor mydb</code></p>

<p>And have edited the .env.production file as so
<code>php vendor/bin/vapor env:pull production</code></p>

<p>And added the relevant conn details</p>

<pre><code>DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=mydb
</code></pre>

<p>I have re-deployed numerous times, and the application works. However when performing any kind of database work I always end up with an error, for example:</p>

<pre><code>{""message"":""SQLSTATE[HY000] [2002] Connection refused (SQL: insert into `users` (`name`, `email`, `password`, `updated_at`, `created_at`) values (testtest, test@test.com, $2y$10$SYYdAXC1aYrFUBQ/wVHcDuUgzBfTK76cvqxaiS2d8Kbg4Vbp/VGXK, 2020-02-29 22:37:36, 2020-02-29 22:37:36))"",""context"":{""exception"":{""class"":""Illuminate\\Database\\QueryException"",""message"":""SQLSTATE[HY000] [2002] Connection refused (SQL: insert into `users` (`name`, `email`, `password`, `updated_at`, `created_at`) values (testtest, test@test.com, $2y$10$SYYdAXC1aYrFUBQ/wVHcDuUgzBfTK76cvqxaiS2d8Kbg4Vbp/VGXK, 2020-02-29 22:37:36, 2020-02-29 22:37:36))"",""code"":2002,""file"":""/var/task/vendor/laravel/framework/src/Illuminate/Database/Connection.php:669"",""previous"":{""class"":""PDOException"",""message"":""SQLSTATE[HY000] [2002] Connection refused"",""code"":2002,""file"":""/var/task/vendor/laravel/framework/src/Illuminate/Database/Connectors/Connector.php:70""}},""aws_request_id"":""9bba7341-a0f3-481c-961a-a0b59fcb64b9""},""level"":400,""level_name"":""ERROR"",""channel"":""
</code></pre>

<p>Can anyone point me in the right direction? I don't belive I need to add in the .env vars for the user and password, I have tried it anyway, but still the same issue.</p>
","162642","","","","","2020-03-01 05:42:44","Unable to connect to MySQL database using Laravel Vapor in production","<mysql><laravel><serverless><laravel-vapor>","1","0","","","","60470284","140584","140584","laravel-vapor","30","58347582","58347581"
"39814475","1","39828832","","2016-10-02 06:32:36","","3","954","<p>Created a new project using toolbox command: vapor new projectname</p>

<p>In main.swift file I added the middleware code:</p>

<pre><code>import Vapor
import HTTP

final class VersionMiddleware: Middleware {
    func respond(to request: Request, chainingTo next: Responder) throws -&gt; Response {
        let response = try next.respond(to: request)

        response.headers[""Version""] = ""API v1.0""
        print(""not printing"")

        return response
    }
}

let drop = Droplet(availableMiddleware: [
    ""version"": VersionMiddleware()
])

drop.get(""hello"") {
    req in 
    return ""Hello world""
} 

drop.run()
</code></pre>

<p>But when I run this, it prints ""hello world"" but the API version is not added to headers. I am checking it using postman.</p>
","1920977","","1920977","","2016-10-02 07:16:24","2017-11-10 22:20:35","How do I write a middleware for vapor web framework?","<swift><vapor>","2","0","1","","","39814475","118712","118712","vapor","592","36204589","36204588"
"39815701","1","39837127","","2016-10-02 09:39:43","","3","1344","<p>I made a model for Users looking like this: </p>

<pre><code>import Vapor
import Fluent
import Foundation

final class User: Model {

var id: Node?
var username: String
var name : String
var surename : String
var password : String
var credit : String
var isBlocked : String
var isAdmin : String

init(username: String, name: String, surename: String, password: String, credit: String, isBlocked: String, isAdmin: String) {
    self.id = UUID().uuidString.makeNode()
    self.username = username
    self.name = name
    self.surename = surename
    self.password = password
    self.credit = credit
    self.isBlocked = isBlocked
    self.isAdmin = isAdmin
}

init(node: Node, in context: Context) throws {
    id = try node.extract(""_id"")
    username = try node.extract(""username"")
    name = try node.extract(""name"")
    surename = try node.extract(""surename"")
    password = try node.extract(""password"")
    credit = try node.extract(""credit"")
    isBlocked = try node.extract(""isBlocked"")
    isAdmin = try node.extract(""isAdmin"")

}

func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [
        ""_id"": id,
        ""username"": username,
        ""name"": name,
        ""surename"": surename,
        ""password"" : password,
        ""credit"" : credit,
        ""isBlocked"" : isBlocked,
        ""isAdmin"" : isAdmin
    ])
}
}

//extension User {
//    /**
//        This will automatically fetch from database, using example here to   load
//        automatically for example. Remove on real models.
//    */
//    public convenience init?(from string: String) throws {
//        self.init(content: string)
//    }
//}

extension User: Preparation {
static func prepare(_ database: Database) throws {
    try database.create(""users"") { users in
        users.id()
        users.string(""username"")
        users.string(""name"")
        users.string(""surename"")
        users.string(""password"")
        users.string(""credit"")
        users.string(""isBlocked"")
        users.string(""isAdmin"")
    }
}

static func revert(_ database: Database) throws {
    //
}
}
</code></pre>

<p>I try to create a new User with this: </p>

<pre><code>    var user = User(username: ""Test"", name: ""Name"", surename: ""zuname"", password: ""1234"", credit: ""0.00"", isBlocked: ""false"", isAdmin: ""true"")

    try user.save()
    print(user.id) // prints the new id
</code></pre>

<p>i can build and run vapor. when i enter the route the could should be execute i got this error:</p>

<blockquote>
  <p>Uncaught Error: EntityError.noDatabase. Use middleware to catch this error and provide a better response. Otherwise, a 500 error page will be returned in the production environment.</p>
</blockquote>

<p>Can anybody help me? </p>

<p>Where can i found a complete documentation for Fluent with mongo and Vapor?</p>

<p>Thanks a lot!</p>
","6076277","","","","","2016-10-03 17:26:25","Use Mongo DB with Vapor and Fluent","<mongodb><fluent><vapor>","1","1","2","","","39815701","118712","118712","vapor","592","36204589","36204588"
"40095964","1","40196196","","2016-10-17 21:29:06","","6","628","<p><strong>I'm trying to figure out how to deploy in IBM Bluemix a Cloudfoundry app that uses Vapor framework.</strong></p>

<p>IBM is providing facilities and guidance for using his platform for developing server side Swift apps with his framework, Kitura. I think as a Cloudfoundry provider, with the proper Swift buildpack, we must be able to deploy generic server side Swift code.</p>

<p>Finally, while learning bits of CF, I reached the point that with the CloudFoundry CLI: </p>

<ol>
<li>I'm connecting to the Bluemix API endpoint (api .eu-gb .bluemix .net)</li>
<li>Login ok (after expanding the timeout setting env. var CF_DIAL_TIMEOUT to 20)</li>
<li>Making a ""cf push"". It creates the app and uploads and compiles everything. </li>
<li>The app state is ""running"". </li>
</ol>

<p>But when I load the page (<a href=""https://sommobilitatcore.eu-gb.mybluemix.net/"" rel=""nofollow"">https://sommobilitatcore.eu-gb.mybluemix.net/</a>) I get:</p>

<pre><code>404 Not Found: Requested route ('sommobilitatcore.eu-gb.mybluemix.net') does not exist.
</code></pre>

<p><strong>Can anyone help me on that? Thanks!</strong></p>

<p>Some context:</p>

<p>The manifest.yml:</p>

<pre><code>applications:
- path: .
  memory: 256M
  instances: 1
  name: SomMobilitatCore
  disk_quota: 1024M
  buildpack: https://github.com/IBM-Swift/swift-buildpack.git
</code></pre>

<p>The Procfile</p>

<pre><code>web: App
</code></pre>

<p>(main.swift is in Source/App/)</p>

<p>No port is configured in Vapor Config files, then Vapor is trying to listen to port 80:</p>

<pre><code>import Vapor
import HTTP

let drop = Droplet()

let _ = drop.config[""app"", ""key""]?.string ?? """"

drop.get(""/"") { request in
    return try drop.view.make(""welcome.html"")
}

(...)

let port = drop.config[""app"", ""port""]?.int ?? 80

// Print what link to visit for default port
drop.serve()
</code></pre>

<p><strong>UPDATE:</strong></p>

<p>Finally get it working without Procfile, the manifest.yml</p>

<pre><code>- path: .
  instances: 1
  memory: 256M
  disk_quota: 1024M
  name: SomMobilitat4
  command: App --env=production --workdir=""./""
  buildpack: swift_buildpack
</code></pre>

<p>And the /Config/production/servers.json :</p>

<pre><code>{
    ""production"": {
        ""port"": ""$PORT""
    }
}
</code></pre>

<p>I neither specify the port variable in the main.swift file. With the updated Vapor version:</p>

<pre><code>import Vapor
import HTTP

let drop = Droplet()

drop.get(""/"") { request in
    return ""hello vapor in bluemix cloudfoundry""
}


drop.run()
</code></pre>

<p>If you are new to Cloudfoundry or IBM Bluemix, this is a way to work:</p>

<ol>
<li>You signup in a Cloudfoundry provider (ex: bluemix)</li>
<li>You have you Vapor project locally.</li>
<li>Add to it a .cfignore file with this short line: Packages/
to avoid uploading Packages to the server.</li>
<li>Add to it the mentioned manifest.yml file.</li>
<li><p>Download and install the Cloudfoundry CLI: <a href=""https://docs.cloudfoundry.org/cf-cli/"" rel=""nofollow"">https://docs.cloudfoundry.org/cf-cli/</a></p>

<p>With the CLI:</p></li>
<li><p>cf api <a href=""https://api.eu-gb.bluemix.net"" rel=""nofollow"">https://api.eu-gb.bluemix.net</a></p></li>
<li>cf login</li>
<li>cf push</li>
</ol>
","4069855","","4069855","","2016-10-24 22:38:32","2016-10-24 22:38:32","Trying to run Swift Vapor on Bluemix - 404 Not Found: Requested route does not exist","<swift><ibm-cloud><cloudfoundry><vapor>","2","0","3","","","40095964","118712","118712","vapor","592","36204589","36204588"
"60508866","1","","","2020-03-03 13:58:32","","0","31","<p>I connect to an anonymous ftp to get a list of files, it works locally but not deployed as vapor.</p>

<p>I assume it is because vapor runs on aws-lambda? Is there any workaround or is there some other library that can do ftp (I only need to 'ls' the directory)?</p>

<p>I do something like this:</p>

<pre><code>$fileNames = Storage::disk('ftp_connection')-&gt;files(env('SOME_FTP_PATH'));
</code></pre>

<p>with</p>

<pre><code> 'ftp_connection' =&gt; [
        'driver' =&gt; 'ftp',
        'host' =&gt; env('SOME_FTP_HOST'),
        'username' =&gt; 'anonymous',
        'password' =&gt; '',
    ]
</code></pre>

<p>and</p>

<pre><code>SOME_FTP_HOST=1.2.3.4
SOME_FTP_PATH=/path
</code></pre>

<p>and on vapor I get the error:</p>

<pre><code>{
""message"": ""ftp_connect(): php_network_getaddresses: getaddrinfo failed: Name or service not known"",
""context"": {
    ""exception"": {
        ""class"": ""ErrorException"",
        ""message"": ""ftp_connect(): php_network_getaddresses: getaddrinfo failed: Name or service not known"",
        ""code"": 0,
        ""file"": ""/var/task/vendor/league/flysystem/src/Adapter/Ftp.php:136""
    },
    ""aws_request_id"": ""d77a0168-2d9b-448c-90d9-d596362b8a89""
},
""level"": 400,
""level_name"": ""ERROR"",
""channel"": ""staging"",
""datetime"": ""2020-03-03T13:37:26.511493+00:00"",
""extra"": {}
}
</code></pre>
","1151537","","","","","2020-03-03 13:58:32","error using laravel ftp filesystem on vapor","<aws-lambda><ftp><laravel-vapor>","0","1","","","","60508866","140584","140584","laravel-vapor","30","58347582","58347581"
"60879190","1","","","2020-03-27 02:33:05","","0","19","<p>I am trying to figure out how to upload a file from IOS to Laravel Vapor using AlamoFire. There is little information on how to achieve this.</p>

<p>There is a npm file with the following seemingly simple code.</p>

<pre><code>const axios = require('axios')

class Vapor
{
    /**
     * Store a file in S3 and return its UUID, key, and other information.
     */
    async store(file, options = {}) {
        const response = await axios.post('/vapor/signed-storage-url', {
            'bucket': options.bucket || '',
            'content_type': options.contentType || file.type,
            'expires': options.expires || '',
            'visibility': options.visibility || ''
        }, {
            baseURL: options.baseURL || null,
            headers: options.headers || {}
        });

        let headers = response.data.headers;

        if ('Host' in headers) {
            delete headers.Host;
        }

        if (typeof options.progress === 'undefined') {
            options.progress = () =&gt; {};
        }

        const cancelToken = options.cancelToken || ''

        await axios.put(response.data.url, file, {
            cancelToken: cancelToken,
            headers: headers,
            onUploadProgress: (progressEvent) =&gt; {
                options.progress(progressEvent.loaded / progressEvent.total);
            }
        })

        response.data.extension = file.name.split('.').pop()

        return response.data;
    }
}

module.exports = new Vapor();
</code></pre>

<p>How that could translate into AlamoFire is beyond me. There is no information anywhere I could find on doing <strong>Native</strong> mobile uploads to a laravel vapor server.</p>

<p>Any help or guidance appreciated.</p>
","542285","","","","","2020-03-27 02:33:05","Laravel Vapor AlamoFire Upload","<ios><laravel><alamofire><laravel-vapor>","0","1","","","","60879190","140584","140584","laravel-vapor","30","58347582","58347581"
"60968172","1","","","2020-04-01 09:55:23","","0","37","<p>As per documentation:</p>

<blockquote>
  <p>Currently, serverless applications on AWS may only process a single request (web or queue) for a maximum of 15 minutes. If your queued jobs take longer than 15 minutes, you will need to either chunk your job's work into smaller pieces or consider another deployment solution for your application. In addition, a queued job may not have a ""delay"" greater than 15 minutes.</p>
</blockquote>

<p>I currently have a heavy scheduled task in my application which under AWS circumstances fails due to time out. Logically I need to dispatch jobs to the queue instead. My question is, do I understand the documentation as the whole queue must not take more than 15 minutes or each job must not be longer than 15 minutes?</p>
","7786549","","3103448","","2020-04-07 05:56:25","2020-04-07 05:56:25","Scheduled jobs in queue Laravel Vapor","<laravel><scheduled-tasks><laravel-vapor>","0","1","","","","60968172","140584","140584","laravel-vapor","30","58347582","58347581"
"59129540","1","59129923","","2019-12-01 20:11:44","","2","71","<p>According to answer from question: <a href=""https://stackoverflow.com/questions/51484138/vapor-obtaining-data-from-mysql-using-alsodecode"">vapor - Obtaining data from mysql using alsodecode()</a> I was able to reproduce this for my model with multiple joins.</p>

<p>This resulted with multiple nested tuples which I have to access to get joined values. Is it possible to make other type of join or flatten this tuple structure to one level?</p>

<pre><code>struct MyTuple: Encodable, Content {
    let title: String
    let publicationDate: Date
    let authorID: Author.ID
    let authorName: String
    let categoryID: Category.ID
    let categoryName: String
    let language: String
}

struct MyContext: Encodable {
    let title: String
    let books: [MyTuple]
}

func getBooks(_ req: Request) throws -&gt; Future&lt;[MyTuple]&gt; {
    return Book.query(on: req)
        .join(\Category.id, to: \Book.categoryID)
        .join(\Language.id, to: \Book.languageID)
        .join(\ProgrammingLanguage.id, to: \Book.programmingLanguageID)
        .join(\Author.id, to: \Book.authorID)
        .alsoDecode(Category.self)
        .alsoDecode(Language.self)
        .alsoDecode(ProgrammingLanguage.self)
        .alsoDecode(Author.self)
        .sort(\Book.publicationDate, .descending).all().flatMap(to: [MyTuple].self) { tuples in
            print(tuples)
            var tempTuples: [MyTuple] = []
            for tuple in tuples {
                tempTuples.append(try MyTuple(
                        title: tuple.0.0.0.0.title,
                        publicationDate: tuple.0.0.0.0.publicationDate,
                        authorID: tuple.1.requireID(),
                        authorName: ""\(tuple.1.name) \(tuple.1.surname)"",
                        categoryID: tuple.0.0.0.1.requireID(),
                        categoryName: tuple.0.0.0.1.name, language: tuple.0.0.1.code ) )
            }

            return Future.map(on: req) {
                tempTuples
            }
        }
}
</code></pre>
","1285959","","","","","2019-12-01 21:47:44","Vapor join and alsoDecode produces lots of nested tuples","<swift><vapor><vapor-fluent>","1","0","","","","59129540","136591","136591","vapor-fluent","38","54295329","54295328"
"59257086","1","59297085","","2019-12-09 21:41:24","","1","86","<p>I'm trying to do a nested query in Vapor 3 and Fluent. The point is I need to get all the users, from each team where the teams have a specific eventID. Teams are children of Event. Users are children of Teams. Thanks in advance for your help.
There are only 15 teams per event, but 12 users per team</p>

<p>Here is the Event model:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Event: Codable {    
    var id: Int?
    var name: String
}

extension Event {
    var teams: Children&lt;Event, Team&gt; {
        return children(\.eventID)
    }
}
</code></pre>

<p>Here is the Team model</p>

<pre class=""lang-swift prettyprint-override""><code>final class Team: Codable {    
    var id: Int?
    var name: String
    var icon: String
    var eventID: Event.ID
}

extension Team {
    var user: Parent&lt;Team, Event&gt; {
        return parent(\.eventID)
    }
}

extension Team {
    var users: Children&lt;Team, User&gt; {
        return children(\.teamID)
    }
}
</code></pre>

<p>Here is the User model.</p>

<pre class=""lang-swift prettyprint-override""><code>final class User: Codable {
    var id: UUID?
    var name: String
    var email: String
    var eventID: Event.ID
    var teamID: Team.ID
}

extension User {
    var user: Parent&lt;User, Team&gt; {
        return parent(\.teamID)
    }
}
</code></pre>

<p>I need to send an event ID and I want it to return all the users in all the teams</p>

<pre class=""lang-swift prettyprint-override""><code>func getUsersForEvent(_ req: Request) throws -&gt; Future&lt;[User]&gt; {        
    return try req.parameters.next(Event.self).flatMap(to: [User].self) { event in
        return try event.teams.query(on: req).all().flatMap(to: [User].self) { team in
            return try team.users.query(on: req).all()
        }
    }
}
</code></pre>
","496193","","1001057","","2019-12-09 21:50:02","2019-12-12 02:59:37","Vapor 3 and Fluent - nested query","<vapor><vapor-fluent>","2","0","","","","59257086","136591","136591","vapor-fluent","38","54295329","54295328"
"40099029","1","","","2016-10-18 03:29:45","","0","75","<p>I'm using ""Model"" with function ""makeNode"" in Vapor, and I can successfully build and run the project when the table columns amount are less than about 14. 
But when my table columns goes to 19 or 20, then the Vapor starts to build very very slowly, and will report failed eventually. 
I have tried using MySQL or MongoDB, both got the same issue. So I'm wondering how to fix this issue when I need to use a table that consists of 20 columns. 
The below are the details:</p>

<pre><code>final class TableName: Model {
    var id: Node?
    var column1: Int
    var column2: Int
    var column3: String
    var column4: String
    var column5: String
    var column6: String
    var column7: String
    var column8: String
    var column9: String
    var column10: String
    var column11: String
    var column12: String
    var column13: String
    var column14: String
    var column15: String
    var column16: String
    var createdAt: Double
    var updatedAt: Double

    init(column1: Int, column2: Int, column3: String, column4: String, column5: String, column6: String, column7: String, column8, column9: String, column10: String, column11: String, column12: String, column13: String, column14: String, column15: String, column16: String, createdAt: Double, updatedAt: Double) {
        self.id = UUID().uuidString.makeNode()
        self.column1 = column1
        self.column2 = column2
        self.column3 = column3
        self.column4 = column4
        self.column5 = column5
        self.column6 = column6
        self.column7 = column7
        self.column8 = column8
        self.column9 = column9
        self.column10 = column10
        self.column11 = column11
        self.column12 = column12
        self.column13 = column13
        self.column14 = column14
        self.column15 = column15
        self.column16 = column16
        self.createdAt = createdAt
        self.updatedAt = updatedAt
    }

    init(node: Node, in context: Context) throws {
        id = try node.extract(""id"")
        column1 = try node.extract(""column1"")
        column2 = try node.extract(""column2"")
        // from 2~16, etc... don't repeat here...
        updatedAt = try node.extract(""updatedAt"")
        createdAt = try node.extract(""createdAt"")
    }

    // Issue happened here... 
    // when the amount less than about 10, results are ok and build fast, 
    // but will build slowly and slowly when the number goes more and more, 
    // even build failed when table columns goes to about 18~20.
    func makeNode(context: Context) throws -&gt; Node {
        var node = try Node(node: [
            ""id"": id,
            ""column1"": column1,
            ""column2"": column2,
            ""column3"": column3,
            ""column4"": column4,
            ""column5"": column5,
            ""column6"": column6,
            ""column7"": column7,
            ""column8"": column8,
            ""column9"": column9,
            ""column10"": column10,
            ""column11"": column11,
            ""column12"": column12,
            ""column13"": column13,
            ""column14"": column14,
            ""column15"": column15,
            ""column16"": column16,
            ""createdAt"": createdAt,
            ""updatedAt"": updatedAt
            ])
        return node
    }
}
</code></pre>

<p>And the build error message is:</p>

<blockquote>
  <p>Command failed due to signal: Killed: 9</p>
</blockquote>

<p>So, I would be appreciate for giving me any hint to fix this issue. Thank you.</p>
","3222186","","","","","2016-11-10 23:18:21","Vapor build failed when the amount of columns in Node are more than 18?","<vapor>","1","0","","","","40099029","118712","118712","vapor","592","36204589","36204588"
"40189044","1","","","2016-10-22 06:28:12","","0","105","<p>swift code:</p>

<pre><code>let drop = Droplet()
print(drop.config)
</code></pre>

<p>result:</p>

<pre><code>▿ Config
  ▿ node : Node
    - object : 0 elements
</code></pre>

<p>why is drop.config nil</p>
","7056189","","","","","2017-05-09 12:27:46","Vapor, why is drop.config nil","<vapor>","2","2","","","","40189044","118712","118712","vapor","592","36204589","36204588"
"40218815","1","40227985","","2016-10-24 12:45:17","","3","3426","<p>I know the question has been asked before and I agree with most answers that claim it is better to follow the way requests are made async with URLSession in Swift 3. I haver the following scenario, where async request cannot be used.</p>

<p>With Swift 3 and the ability to run swift on servers I have the following problem.</p>

<ol>
<li>Server Receives a request from a client</li>
<li>To process the request the server has to send a url request and wait for the response to arrive.</li>
<li>Once response arrives, process it and reply to the client</li>
</ol>

<p>The problem arrises in step 2, where URLSession gives us the ability to initiate an async data task only. Most (if not all) server side swift web frameworks do not support async responses. When a request arrives to the server everything has to be done in a synchronous matter and at the end send the response.</p>

<p>The only solution I have found so far is using DispatchSemaphore (see example at the end) and I am not sure whether that will work in a scaled environment.</p>

<p>Any help or thoughts would be appreciated.</p>

<pre><code>extension URLSession {
    func synchronousDataTaskWithURL(_ url: URL) -&gt; (Data?, URLResponse?, Error?) {
        var data: Data?
        var response: URLResponse?
        var error: Error?

        let sem = DispatchSemaphore(value: 0)

        let task = self.dataTask(with: url as URL, completionHandler: {
            data = $0
            response = $1
            error = $2 as Error?
            sem.signal()
        })

        task.resume()

        let result = sem.wait(timeout: DispatchTime.distantFuture)
        switch result {
        case .success:
            return (data, response, error)
        case .timedOut:
            let error = URLSessionError(kind: URLSessionError.ErrorKind.timeout)
            return (data, response, error)

        }
    }
}
</code></pre>

<p>I only have experience with kitura web framework and this is where i faced the problem. I suppose that similar problems exist in all other swift web frameworks.</p>
","997108","","","","","2016-10-24 21:39:26","How to make synchronous url requests with swift 3","<swift3><alamofire><vapor><kitura>","2","0","1","","","40218815","118712","118712","vapor","592","36204589","36204588"
"59259963","1","","","2019-12-10 03:53:29","","1","108","<p>I'm writing a backend app in <code>Xcode 11.2</code> using <code>Vapor3</code> and <code>Fluent</code> with <code>SQLite</code>.  I have a route for a <code>POST</code> request to update a record in Table1, but before I save the record, I need to pull values from another table with a key that's in one of the fields I'm passing in.  The part that I'm getting stuck on is accessing that data from the other table.</p>

<p>What I have so far:</p>

<p><strong>Table for staff</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Staff: Content, SQLiteUUIDModel, Migration, Parameter { 
  var id: UUID? 
  var staffID: String (value that's in the other table to match)
  var value1: Int (one of the values I'm trying to fetch)
  var value2: Int (another value I'm trying to fetch)
  ...(additional variables and Init
</code></pre>

<p><strong>Table for assignments</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Assignments: Content, SQLiteUUIDModel, Migration, Parameter {
  var id: UUID?
  var staffID: String 
  ...(additional variables and Init
</code></pre>

<p><strong>Route for incoming POST request to update existing Assignment:</strong></p>

<pre class=""lang-swift prettyprint-override""><code>router.post(""update"", Assignments.parameter) { req -&gt; Future&lt;Assignments&gt; in
  return try req.parameters.next(Assignments.self).flatMap { Assignment in
  return try req.content.decode(Assignments.self).flatMap { updatedAssignment in

  (Code where I perform calculations on the incoming 'Assignment' and save to 'updatedAssignment' before calling:)

  return WorkOrder.save(on: req)
</code></pre>

<p>The route I have works, incoming data is modified and written to the SQLite database, however there are a couple of fields that I need to perform calculations on or set to values stored in the Staff table.  IE: </p>

<pre class=""lang-swift prettyprint-override""><code>
editedAssignment.variable = (variable) * (value1 from staff table for matching staffID)
editedAssignment.variable = (value2 from staff table for matching staffID)
</code></pre>

<p><strong>What I've tried so far</strong></p>

<pre><code>let staffData = Staff.query(on: req).filter(\.staffID == staffID).all() before the calculations
(adding as a Future as:)
router.post(...) { req -&gt; Future&lt;Staff&gt; in return try Staff.query(on: req).filter ...(rest of query)  
</code></pre>

<p>-- this method throws off the whole request, the values of the incoming request are just lost.</p>

<p>Ideally, if I could call a query and save as a dictionary in the calculations, that would be ideal, I just can't seem to ""figure it out"".</p>
","12508716","","12508716","","2019-12-10 04:39:14","2019-12-17 18:57:17","Swift & Vapor/Fluent : How to pull values from another table during a post router request","<swift><sqlite><vapor><vapor-fluent>","1","0","","","","59259963","136591","136591","vapor-fluent","38","54295329","54295328"
"59749447","1","","","2020-01-15 10:25:15","","1","59","<p>I've created migration for adding a field to the Postgres table, it works as expected on the existing database. But when I want to run the same vapor server with a new database it crashes on the migration with the ""field already exists"" message, which is, of course, understandable. But how to maintain the server code so it could work both with existing and new databases?</p>

<pre><code>Fatal error: Error raised at top level: PostgreSQL Error: column ""the_coloumn"" of relation ""User"" already exists
- id: PostgreSQLError.server.error.check_for_column_name_collision
: file /BuildRoot/Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-1100.8.280/swift/stdlib/public/core/ErrorType.swift, line 200
</code></pre>
","961037","","","","","2020-01-15 19:51:44","Avoiding Vapor migrations on a new database","<swift><vapor><vapor-fluent>","1","0","","","","59749447","136591","136591","vapor-fluent","38","54295329","54295328"
"59975829","1","","","2020-01-29 21:28:55","","1","110","<p>I am trying to upload an image (.jpg) to a Vapor server as a binary file (no multipart form). Currently I have the following route:</p>

<pre><code>router.put(""images"") { (req) -&gt; Future&lt;HTTPStatus&gt; in
    // Don't do anything with the decoded file for now...
    return try req.content.decode(File.self).transform(to: .ok)
}
</code></pre>

<p>The problem is when I upload a jpg image with Insomnia (/Postman) the following error occurs:</p>

<pre><code>[ ERROR ] Abort.httpDecoder: Unsupported Media Type (ContentCoders.swift:60)
[ DEBUG ] Suggested fixes for Abort.httpDecoder: Register an `HTTPMessageDecoder` using `ContentConfig`. Use one of the decoding methods that accepts a custom decoder. (ErrorMiddleware.swift:26)
</code></pre>

<p>In Insomnia (/Postman) the...</p>

<p>...HTTP-Body is configured as a binary file (no multiform!)</p>

<p>...Content-Type is set to image/jpeg</p>

<p>In <code>configure.swift</code> I tried to register a HTTPMessageDecoder like the error message told me, but I don't know exactly how to do it:</p>

<pre><code>var contentConfig = ContentConfig()
contentConfig.use(dataDecoder: &lt;#T##DataDecoder#&gt;, for: .jpeg)
services.register(contentConfig)
</code></pre>
","6912779","","","","","2020-01-29 21:28:55","Vapor 3: Upload and decode image as binary file","<swift><xcode><vapor><server-side-swift><vapor-fluent>","0","4","","","","59975829","136591","136591","vapor-fluent","38","54295329","54295328"
"61062810","1","61280600","","2020-04-06 15:04:27","","0","40","<p>I had some difficulties finding out why my events are not ""triggered"" in the frontend (Laravel Echo + Pusher) with my application being deployed through Laravel Vapor, even though it was working out perfectly locally.</p>

<p><a href=""https://pusher.com/docs/channels/getting_started/debugging#pusher_debug_console"" rel=""nofollow noreferrer"">Pushers debug console</a> was actually showing that the events are actually being dispatched to Pusher by the Laravel application.</p>

<p>Since I pretty much wasted around half a day finding out what was wrong (by luck, I saw my message showing up in real-time in my local environment instead of staging after posting something on staging), I though I'll spend another 10 minutes writing a post here so some people (hopefully) don't need to waste as much time.</p>
","2565909","","","","","2020-04-17 21:01:32","Using Laravel Echo (Pusher) on Laravel Vapor","<laravel><laravel-echo><pusher-js><laravel-vapor>","2","0","","","","61062810","140584","140584","laravel-vapor","30","58347582","58347581"
"61062920","1","","","2020-04-06 15:10:02","","0","11","<p>Works fine on local host, but not on Laravel Nova. The error is so generic as below.</p>

<p>Initially I thought its the timeout on Vapor, so I set it to 60 seconds, but the error still persists.</p>

<p><code>The document file failed to upload.</code> No error logs whatsoever.</p>
","1239189","","","","","2020-04-06 15:10:02","File bigger than 2MB fails to upload on Nova 2 while using Laravel Vapor","<laravel-nova><laravel-vapor>","0","0","","","","61062920","140584","140584","laravel-vapor","30","58347582","58347581"
"61072437","1","","","2020-04-07 03:36:20","","-1","15","<p>I use the Laravel Vapor and I have an error during deployment. Support doesn't help me...</p>

<p>Output of <code>composer diagnose</code>:</p>

<pre><code>Checking composer.json: OK
Checking platform settings: OK
Checking git settings: OK
Checking http connectivity to packagist: OK
Checking https connectivity to packagist: OK
Checking github.com rate limit: OK
Checking disk free space: OK
Composer version: 1.10.1
PHP version: 7.4.4
PHP binary path: /usr/bin/php7.4
OpenSSL version: OpenSSL 1.1.1d  10 Sep 2019
</code></pre>

<p>When I run this command:</p>

<pre><code>vapor deploy staging
</code></pre>

<p>I get the following output:</p>

<pre><code>The command ""composer install --classmap-authoritative"" failed.                                                                                            

  Exit Code: 255(Unknown error)                                                                                                                              

  Working directory: /var/www/.vapor/build/app                                                                                                               

  Output:                                                                                                                                                    
  ================                                                                                                                                           
  ocramius/package-versions: Generating version class...                                                                                                     
  ocramius/package-versions: ...done generating version class                                                                                                

  Fatal error: Cannot redeclare composerRequire3769093da9969960d08bc382b84551a8() (previously declared in /var/www/vendor/composer/autoload_real.php:66) in  
   /var/www/.vapor/build/app/vendor/composer/autoload_real.php on line 57                                                                                    


  Error Output:                                                                                                                                              
  ================                                                                                                                                           
  Loading composer repositories with package information                                                                                                     
  Installing dependencies (including require-dev) from lock file                                                                                                                                                                                                                
  &gt; Illuminate\Foundation\ComposerScripts::postAutoloadDump                                                                                                  
  PHP Fatal error:  Cannot redeclare composerRequire3769093da9969960d08bc382b84551a8() (previously declared in /var/www/vendor/composer/autoload_real.php:6  
  6) in /var/www/.vapor/build/app/vendor/composer/autoload_real.php on line 57
</code></pre>
","1153705","","3103448","","2020-04-07 05:57:27","2020-04-07 05:57:27","Cannot redeclare composerRequire during deployment on Laravel Vapor","<php><laravel><composer-php><laravel-vapor>","0","1","","","","61072437","140584","140584","laravel-vapor","30","58347582","58347581"
"40240250","1","40447667","","2016-10-25 12:40:28","","3","361","<p>I want to add my own Markdown file, a file named <code>profile.md</code>. However, I don't know where I should add the file in my Vapor project, which is developed in Xcode.</p>

<p>I tried adding it to <code>Sources/</code> or just the root directory, but it cannot be searched by <code>Bundle.main.url(forResource:)</code> function, like:</p>

<pre><code>guard let url = Bundle.main.url(forResource: ""profile"", withExtension: "".md"") else { ... }
</code></pre>

<p>Also, I found that I already added it under <em>Copy Bundle Resources</em> tab.</p>

<p>In the normal app (for iOS and macOS), the function above works properly. </p>

<p>How can I add my own file to be used in Vapor project developed in Xcode?</p>
","2360798","","","","","2016-11-06 09:09:36","Where should I add my own Markdown file in Vapor project?","<swift><xcode><nsbundle><vapor>","1","3","","","","40240250","118712","118712","vapor","592","36204589","36204588"
"40248289","1","40249397","","2016-10-25 19:37:21","","1","690","<p>Getting build error when I run:</p>

<p><code>vapor build --mysql</code></p>

<p>Not much documentation on how to install any dependencies for this project in their [website][1]. From the stack trace, it seems im missing 'lmysqlclient' which im not sure if im supposed to add to the linker flags or is this something that needs to be added to the vapor config (im pretty new to vapor).</p>

<p>Here is the stack trace:</p>

<pre><code>computer:Server user$ swift build -Xswiftc -I/usr/local/mysql/include -Xlinker -L/usr/local/mysql/lib -Xswiftc -DNOJSON
Linking CLibreSSL
Compile Swift Module 'TurnstileCrypto' (3 sources)
Compile Swift Module 'Jay' (21 sources)
Compile Swift Module 'SocksCore' (14 sources)
Compile Swift Module 'Polymorphic' (2 sources)
Compile Swift Module 'PathIndexable' (2 sources)
Compile Swift Module 'libc' (1 sources)
Compile Swift Module 'Core' (28 sources)
ld: warning: directory not found for option '-L/usr/local/mysql/lib'
Compile Swift Module 'Node' (22 sources)
Compile Swift Module 'Socks' (5 sources)
Compile Swift Module 'Fluent' (35 sources)
Compile Swift Module 'Essentials' (2 sources)
Compile Swift Module 'TLS' (7 sources)
Compile Swift Module 'Console' (34 sources)
Compile Swift Module 'Leaf' (34 sources)
Compile Swift Module 'JSON' (8 sources)
Compile Swift Module 'Turnstile' (13 sources)
Compile Swift Module 'Random' (3 sources)
Compile Swift Module 'Cipher' (2 sources)
Compile Swift Module 'MySQL' (10 sources)
Compile Swift Module 'TurnstileWeb' (8 sources)
Compile Swift Module 'BCrypt' (1 sources)
Compile Swift Module 'Hash' (3 sources)
Compile Swift Module 'HMAC' (2 sources)
Compile Swift Module 'FluentMySQL' (2 sources)
Compile Swift Module 'URI' (10 sources)
Compile Swift Module 'Transport' (8 sources)
Compile Swift Module 'HTTP' (33 sources)
Compile Swift Module 'SMTP' (21 sources)
Compile Swift Module 'WebSockets' (14 sources)
Compile Swift Module 'Settings' (10 sources)
Compile Swift Module 'Cookies' (11 sources)
Compile Swift Module 'Cache' (3 sources)
Compile Swift Module 'Routing' (9 sources)
Compile Swift Module 'HTTPRouting' (5 sources)
Compile Swift Module 'Sessions' (6 sources)
Compile Swift Module 'Auth' (14 sources)
Compile Swift Module 'TypeSafeRouting' (3 sources)
Compile Swift Module 'Vapor' (86 sources)
Compile Swift Module 'VaporMySQL' (1 sources)
Compile Swift Module 'App' (3 sources)
Linking ./.build/debug/App
ld: warning: directory not found for option '-L/usr/local/mysql/lib'
ld: library not found for -lmysqlclient for architecture x86_64
&lt;unknown&gt;:0: error: link command failed with exit code 1 (use -v to see invocation)
&lt;unknown&gt;:0: error: build had 1 command failures
error: exit(1): /Applications/Xcode/10.0/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f /Users/user/test/Server/.build/debug.yaml
</code></pre>
","5477795","","2360798","","2016-11-04 07:18:32","2017-03-15 01:15:44","Vapor Mysql not building","<vapor>","2","2","","","","40248289","118712","118712","vapor","592","36204589","36204588"
"40323337","1","40327092","","2016-10-29 20:23:45","","1","237","<p>I have just update my Xcode from version 8.0 to 8.1 and Swift 3.0.1.</p>

<p>And if I set 'mongo-provider' package dependency in Package.swift:</p>

<pre><code>.Package(url: ""https://github.com/vapor/mongo-provider.git"", majorVersion: 1, minor: 0)
</code></pre>

<p>I have a build errors in Terminal output:</p>

<pre><code>Fetching Dependencies [Failed]
Check your dependencies' Package.swift files to see where the conflict is.
Error: warning: refname '1.0.0' is ambiguous.
warning: refname '1.0.0' is ambiguous.
warning: refname '1.0.4' is ambiguous.
warning: refname '1.0.4' is ambiguous.
warning: refname '1.7.2' is ambiguous.
warning: refname '1.7.2' is ambiguous.
warning: refname '3.7.2' is ambiguous.
warning: refname '3.7.2' is ambiguous.
swift-package: error: The dependency graph could not be satisfied. The package (https://github.com/vapor/socks.git) with version tag in range (1.0.0..&lt;1.0.9223372036854775807) is not found. Found tags ([1.1.0])
</code></pre>

<p>Do you have any ideas to resolve it?</p>
","6726766","","2360798","","2016-11-04 07:17:25","2016-11-04 07:17:25","How to resolve Vapor MongoProvider build errors using XCode 8.1 and Swift 3.0.1?","<xcode><mongodb><vapor>","1","0","","","","40323337","118712","118712","vapor","592","36204589","36204588"
"60030978","1","60065199","","2020-02-02 21:55:06","","3","41","<p>I have a controller whose create action I want to accept JSON either like this:</p>

<pre><code>{ ""foo"": ""bar"" }
</code></pre>

<p>OR like this:</p>

<pre><code>{ ""widget"": { ""foo"": ""bar"" } }
</code></pre>

<p>That is, I want to accept either the widget or the widget wrapped in a containing object. Currently, the create action for my controller looks a lot like this: </p>

<pre><code>func createHandler(_ req: Request) throws -&gt; Future&lt;Widget&gt; {
  do {
    return try req.content.decode(WidgetCreateHolder.self).flatMap(to: Widget.self) {
      return createWidget(from: $0.widget)
    }
  } catch DecodingError.keyNotFound {
    return try req.content.decode(WidgetCreateObject.self).flatMap(to: Widget.self) {
      return createWidget(from: $0)
    }
  }
}
</code></pre>

<p>where <code>WidgetCreateObject</code> looks something like:</p>

<pre><code>struct WidgetCreateObject { var foo: String? }
</code></pre>

<p>and where <code>WidgetCreateHolder</code> looks like:</p>

<pre><code>struct WidgetCreateHolder { var widget: WidgetCreateObject }
</code></pre>

<p>That is, my create action should <code>try</code> to create a holder, but if that fails it should catch the error and try just creating the inner object (a <code>WidgetCreateObject</code>). However, when I deploy this code to Heroku and make a request with just the inner object JSON, I get this in my logs:</p>

<pre><code>[ ERROR ] DecodingError.keyNotFound: Value required for key 'widget'. (ErrorMiddleware.swift:26)
</code></pre>

<p>even though I am trying to catch that error!</p>

<p>How can I get my create action to accept two different formats of JSON object?</p>
","1799154","","1799154","","2020-02-04 20:37:49","2020-02-04 20:37:49","Vapor 3 decoding content: do/catch for multiple post formats?","<swift><vapor><vapor-fluent>","1","1","","","","60030978","136591","136591","vapor-fluent","38","54295329","54295328"
"60104516","1","","","2020-02-06 22:29:07","","2","63","<p>I've been trying to link up my PostgreSQL database to a Swift Vapor project so I create routes to it. The first table I want to access is a table in <code>my_database</code> calls <code>users</code>. It has the properties <code>user_id</code> (primary integer key) and <code>created_on</code> (timestamp with time zone).</p>

<p>I've linked my Vapor project to <code>my_database</code> so that I can create new models. However, what if I want access to the pre-existing table <code>users</code>. Here's what I've cobbled together from the documentation and a few tutorials:</p>

<p><strong>My initial model:</strong></p>

<pre><code>final class Users: Model {

static let name = ""users""

typealias ID = Int
typealias Database = PostgreSQLDatabase

static let idKey: WritableKeyPath&lt;Users, Int?&gt; = \.user_id

var user_id: Int?
var created_on: Date
}

extension Users: Content { }
</code></pre>

<p><strong>My migration (which I think is just a 'blank' migration, just to hook the project to the table?):</strong></p>

<pre><code>struct FirstMigration: PostgreSQLMigration {
static func prepare(on conn: PostgreSQLConnection) -&gt; EventLoopFuture&lt;Void&gt; {
    return conn.future()
}

static func revert(on conn: PostgreSQLConnection) -&gt; EventLoopFuture&lt;Void&gt; {
    return Future&lt;Void&gt;.done(on: conn)
   }
}
</code></pre>

<p><strong>And my configuration:</strong></p>

<pre><code>var migrations = MigrationConfig()
migrations.add(migration: FirstMigration.self, database: .psql)
services.register(migrations)
</code></pre>

<p>Any guidance much appreciated!</p>
","5954887","","","","","2020-02-07 10:39:17","Linking my Fluent model to a pre-existing database table","<swift><postgresql><vapor><server-side-swift><vapor-fluent>","1","0","","","","60104516","136591","136591","vapor-fluent","38","54295329","54295328"
"60292259","1","","","2020-02-19 02:46:50","","2","39","<p>I have a table in a PostgreSQL database used by a Vapor Swift app.  One of the columns in the table is an array of strings.</p>

<pre class=""lang-sql prettyprint-override""><code>CREATE TABLE ""Code"" (
    id uuid PRIMARY KEY,
    name text NOT NULL,
    lines text[] NOT NULL
);
</code></pre>

<p>I'd like to select some rows, pulling only the first four items from the array.  The raw SQL is this:</p>

<pre><code>SELECT id, name, lines[1:4] FROM ""Code""
</code></pre>

<p>Is there a way to specify the array subset via Vapor's Fluent syntax?  I would also be happy using a raw SQL query, that can then be decoded by the model (like <code>alsoDecode</code> with joins).</p>

<p>This is the model, fwiw:</p>

<pre class=""lang-swift prettyprint-override""><code>struct Snippet: Codable, PostgreSQLUUIDModel {
    var id: UUID?
    var name: String
    var lines: [String]
}
</code></pre>

<p>Thanks!</p>
","690043","","","","","2020-02-19 02:46:50","Is there a way to select a subset of an array in Vapor/Fluent?","<postgresql><vapor><vapor-fluent>","0","3","","","","60292259","136591","136591","vapor-fluent","38","54295329","54295328"
"61216983","1","","","2020-04-14 20:49:05","","0","19","<p>I have deployed a web app via Laravel Vapor (AWS Lambda scaffolding) which gave me a cloudfront domain to which I point using a simple CNAME in my custom domain registrar DNS settings. The same domain is registered in GSuite to recieve emails. Before I deployed to cloud my VPS had a email server in it so there was no problem. But now the inbox is unreachable. Is the deployed application able to somehow recieve emails? Or rather forwards them to the Gmail inbox? Am I missing the email server?</p>
","7786549","","","","","2020-04-14 20:49:05","Is Laravel Vapor able to recieve email with the lamda function working as a email server?","<amazon-web-services><email><laravel-vapor>","0","2","","","","61216983","140584","140584","laravel-vapor","30","58347582","58347581"
"61523676","1","","","2020-04-30 12:43:07","","0","7","<p><a href=""https://docs.vapor.build/1.0/projects/environments.html#maintenance-mode"" rel=""nofollow noreferrer"">According to the docs</a> we are able to put a <code>503.html</code> document inside the root of our Laravel project. </p>

<blockquote>
  <p><strong>You may customize the maintenance mode splash screen for your application by placing a 503.html file in your application's root directory.</strong></p>
</blockquote>

<p>I would however love to be able to put one or more assets on this page (for example our Logo) to make this page better more personal. Laravel Vapor automatically uploads your static assets to cloudfront, <a href=""https://docs.vapor.build/1.0/projects/deployments.html#assets"" rel=""nofollow noreferrer"">which is not a problem if you're using the <code>asset()</code> helper</a>. However, are there any solutions already being made? I can't find any.</p>

<p>Is there anyone who has created a solution to make this happen?</p>
","2565909","","","","","2020-05-01 23:47:12","Laravel Vapor - Assets (logo) on maintenance mode page","<laravel><amazon-cloudfront><laravel-vapor>","1","0","","","","61523676","140584","140584","laravel-vapor","30","58347582","58347581"
"40445506","1","40447583","","2016-11-06 02:45:44","","5","1203","<p>I recently made the switch from <a href=""https://github.com/PerfectlySoft/Perfect"" rel=""noreferrer"">Perfect</a> to <a href=""https://github.com/vapor/vapor"" rel=""noreferrer"">Vapor</a>.In Perfect you could do something like this without using a html file.</p>

<pre><code>routes.add(method: .get, uri: ""/"", handler: {
    request, response in
    response.setHeader(.contentType, value: ""text/html"")
    response.appendBody(string: ""&lt;html&gt;&lt;img src=http://www.w3schools.com/html/pic_mountain.jpg&gt;&lt;/html&gt;"")
    response.completed()
   }
)
</code></pre>

<p>In Vapor the only way I found to  return the html is to do this.How could I return html code without using a html file in vapor?</p>

<pre><code> drop.get(""/"") { request in
    return try drop.view.make(""somehtmlfile.html"")
} 
</code></pre>
","6951854","","6951854","","2016-11-06 03:00:30","2016-11-06 08:58:34","Swift - Vapor Using HTML","<html><swift><perfect><vapor>","1","1","1","","","40445506","118712","118712","vapor","592","36204589","36204588"
"40470572","1","40474661","","2016-11-07 17:01:42","","1","371","<p>In Vapor, specifically in the class for a custom Leaf tag, how can you retrieve values stored in a context?</p>

<p>I'm trying to implement a tag that takes a string and a path, and renders a link unless the path is the current page, so, for example, <code>#navElement(""About Us"", ""/about"")</code> will produce a link to the site's about page on every page except the about page itself. On that page, it should display the text without a link on it.</p>

<p>I don't want to have to pass the current path to the tag every time I use it, so I've stored the request's path in the context, roughly like this (checks omitted):</p>

<pre><code>drop.get("":page""){ request in
  return try drop.view.make(thePage, [""path"": request.uri.path])
}
</code></pre>

<p>I can use <code>#(path)</code> in a template and see the path I expect.</p>

<p>My custom tag is derived from <code>Tag</code>, and its <code>run</code> method receives the context as an argument, and I can see the stored value in there in the debugger – but how do I get at it? The <code>get</code> method in the <code>Context</code> class, which seems to do this, is <code>internal</code>, so I can't use it. There is a comment that says subscripts are to be done, and I assume that this will ultimately be the way to extract values from the context, but in the meantime, is there any way to retrieve them?</p>
","7126158","","5236226","","2017-03-20 16:13:10","2017-03-20 16:13:10","How to retrieve values from a context in Vapor?","<vapor><leaf>","1","0","","","","40470572","118712","118712","vapor","592","36204589","36204588"
"40489348","1","","","2016-11-08 14:23:33","","2","2433","<p>I can't find any example of handling file upload, especially how to save into some specific folder.</p>

<p>Here is the code, addVideo is a HTTP POST multipart/form-data:</p>

<pre><code>videos.post(""addVideo"") { req in

    // need to save req.multipart[""video""] into /data/videos/

    return try JSON(node: [""status"": 0, ""message"": ""success""])
}
</code></pre>
","1810980","","","","","2017-09-07 17:10:21","file upload using Vapor","<swift><file-upload><vapor>","3","1","1","","","40489348","118712","118712","vapor","592","36204589","36204588"
"40526638","1","","","2016-11-10 11:34:20","","0","45","<p>I used to return my array of 'MapPoints' (from the db) using the following</p>

<pre><code>extension Sequence where Iterator.Element == MapPoints {
    func makeJSON() -&gt; JSON {
        return .array(self.map { $0.makeJSON() })
    }

    func makeResponse(request: Request) throws -&gt; Response {
        return try makeJSON().makeResponse()
    }
}
</code></pre>

<p>This now gives an error ""Instance member 'array' cannot be used on type 'JSON'""</p>

<p>Can anyone tell me how this should be done ?</p>
","361211","","","","","2016-11-10 23:00:51","Change of syntax","<arrays><json><vapor>","1","0","","","","40526638","118712","118712","vapor","592","36204589","36204588"
"40531549","1","","","2016-11-10 15:44:14","","4","233","<p>My program seems to work fine on Heroku, but after reloading the page 3-4 times, it crashes, and I get the error <code>H13: Connection closed without response</code>.
However, it works perfectly fine and without any error when I run it on my computer.</p>

<p>Here is my code:
</p>

<pre><code>#if os(Linux)
  import Glibc
#else
  import Darwin
#endif
import Vapor

let arrayA: [String] = [""some strings here""]

let arrayB: [String] = [""more strings there""]

let arrayC: [String] = [""and some more here""]

func buildName (from arrayA: [String], and arrayB: [String], and arrayC: [String]) -&gt; String {
  #if os(Linux)
    let a: Int = Int(random() % (arrayA.count + 1))
    let b: Int = Int(random() % (arrayB.count + 1))
    let c: Int = Int(random() % (arrayC.count + 1))
  #else
    let a: Int = Int(arc4random_uniform(UInt32(arrayA.count)))
    let b: Int = Int(arc4random_uniform(UInt32(arrayB.count)))
    let c: Int = Int(arc4random_uniform(UInt32(arrayC.count)))
  #endif

  return (arrayA[a] + "" "" + arrayB[b] + "" "" + arrayC[c])
}

let defaultHead: String = ""&lt;head&gt;&lt;meta charset='utf-8'&gt;&lt;/head&gt;""

//create Droplet object
let drop = Droplet()

// REGISTER Routes and handlers
drop.get { req in
  return buildName(from: arrayA, and: arrayB, and: arrayC)
}

// Start the server
drop.run()
</code></pre>

<p>What am I doing wrong?</p>
","5057996","","5057996","","2016-11-10 15:51:51","2017-07-17 13:54:59","Vapor error H13 on Heroku","<swift><heroku><vapor>","2","8","","","","40531549","118712","118712","vapor","592","36204589","36204588"
"60362241","1","60362375","","2020-02-23 12:36:40","","1","36","<p>I'm trying to add some seed data to a table in a migration. For this table I don't want the id value to be generated automatically, but I want to set it manually for each record. How can this be done? My current code looks like the bellow, but the record isn't inserted to the database and no error is thrown when the migration runs.</p>

<p>Model class:</p>

<pre><code>import Foundation
import FluentPostgreSQL
import Vapor

final class PropertyType: PostgreSQLModel {
    var id: Int?
    var name: String

    init(id: Int, name: String) {
        self.id = id
        self.name = name
    }
}

extension PropertyType: Migration { }
extension PropertyType: Content { }
extension PropertyType: Parameter { }
</code></pre>

<p>Migration class:</p>

<pre><code>import FluentPostgreSQL
import Vapor

struct AddPropertyTypes: Migration {
    typealias Database = PostgreSQLDatabase

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        let propertyType1 = PropertyType(id: 1, name: ""Einfamilienhaus"")
        return propertyType.save(on: conn).transform(to: ())
    }

    static func revert(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        let futures = [1].map { id in
            return CodePropertyType.query(on: conn).filter(\CodePropertyType.id == id)
                .delete()
        }
        return futures.flatten(on: conn)
    }
}
</code></pre>
","10826194","","","","","2020-02-23 12:53:30","How to save a model with a specific id in Vapor 3","<swift><vapor><vapor-fluent>","1","0","","","","60362241","136591","136591","vapor-fluent","38","54295329","54295328"
"60443583","1","60590161","","2020-02-28 00:14:45","","1","49","<p>I've got a Vapor 3 app in which I need to determine is 2 users share any common groups.</p>

<p>So I have 2 models User and Group.  A user can belong to many groups.  But I have a permission check that if both users share a common group they can send a messages to each other.</p>

<pre><code>final public class User: PostgreSQLModel {
    public var id: Int?
    var firstName: String
    var lastName: String
}

extension User {
    var containers: Siblings&lt;User, Group, UserGroups&gt; {
        return siblings()
    }
}

final public class Group: PostgreSQLModel {
    public var id: Int?
    var name: String
}
</code></pre>

<p>What I'd like to do is this</p>

<pre><code>UserGroups.query(to: request).group(.or) { $0.filter(\.userId == user.id!).filter(\.userId == user.id!) }.flatMap { ... }
</code></pre>

<p>plus a filter that says where groupId == groupId.</p>

<p>Any thoughts or suggestions?</p>
","11375271","","","","","2020-03-08 17:27:22","Need help doing a many <-> many match with Fluent in Vapor 3","<vapor><vapor-fluent>","1","0","","","","60443583","136591","136591","vapor-fluent","38","54295329","54295328"
"60578723","1","","","2020-03-07 14:46:00","","1","88","<p>I need to do lots of queries to different tables and return the results in one single response. I'm wondering ow could I flatten the extremely nested function?</p>

<pre><code>final class CodeController {
    internal func indexCodes(_ req: Request) throws -&gt; EventLoopFuture&lt;Response&gt; {
        CodeCountry.query(on: req).sort(\.name).all().flatMap { countries -&gt; EventLoopFuture&lt;Response&gt; in
            CodeFloor.query(on: req).sort(\.name).all().flatMap { floors -&gt; EventLoopFuture&lt;Response&gt; in
                CodeRegion.query(on: req).sort(\.name).all().flatMap { regions -&gt; EventLoopFuture&lt;Response&gt; in
                    CodeObjectType.query(on: req).sort(\.name).all().flatMap { objectTypes -&gt; EventLoopFuture&lt;Response&gt; in
                        CodePropertyType.query(on: req).sort(\.name).all().flatMap { propertyTypes -&gt; EventLoopFuture&lt;Response&gt; in
                            CodeRooms.query(on: req).sort(\.name).all().flatMap { rooms -&gt; EventLoopFuture&lt;Response&gt; in
                                let codes = CodesContent(
                                    countries: countries,
                                    floors: floors,
                                    regions: regions,
                                    objectTypes: objectTypes,
                                    propertyTypes: propertyTypes,
                                    rooms: rooms
                                )

                                return codes.encode(status: .ok, for: req)
                            }
                        }
                    }
                }
            }
        }
    }
}
</code></pre>
","10826194","","","","","2020-03-30 07:38:08","How to flatten multiple queries in Vapor","<swift><vapor><vapor-fluent>","2","3","","","","60578723","136591","136591","vapor-fluent","38","54295329","54295328"
"40564069","1","","","2016-11-12 14:55:11","","5","510","<p>I'm making my way through the <a href=""https://vapor.codes"" rel=""noreferrer"">vapor</a> tutorial <a href=""https://videos.raywenderlich.com/screencasts/server-side-swift-with-vapor-getting-started/"" rel=""noreferrer"">videos</a> <a href=""https://videos.raywenderlich.com/screencasts/server-side-swift-with-vapor-templating-with-leaf"" rel=""noreferrer"">on</a> <a href=""https://videos.raywenderlich.com/screencasts/server-side-swift-with-vapor-configuring-a-database"" rel=""noreferrer"">Ray</a> <a href=""https://videos.raywenderlich.com/screencasts/server-side-swift-with-vapor-persisting-models"" rel=""noreferrer"">Wenderlich's</a> <a href=""https://videos.raywenderlich.com/screencasts/server-side-swift-with-vapor-crud-database-options"" rel=""noreferrer"">site</a>. </p>

<p>In the Xcode project in the videos, it shows a nice clean folder structure, like how the folder structure is defined in the <a href=""https://vapor.github.io/documentation/guide/folder-structure.html"" rel=""noreferrer"">vapor docs</a>.<br>
<a href=""https://i.stack.imgur.com/IG7KC.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/IG7KC.png"" alt=""enter image description here""></a></p>

<p>When I follow the same steps to create a new vapor project and use xcode as the docs and videos show, <code>vapor new my-project</code> -> <code>cd my-project</code> -> <code>vapor xcode</code>. 
The folder structure I see is not the same.<br>
<a href=""https://i.stack.imgur.com/U1N9z.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/U1N9z.png"" alt=""enter image description here""></a></p>

<p>The folder structure I see (above) I can use just fine. However, when I open the <code>Sources</code> folder(group) I see all the vapor dependencies listed instead of just the <code>App</code> folder.<br>
<a href=""https://i.stack.imgur.com/frT0y.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/frT0y.png"" alt=""enter image description here""></a>
... and on until finally the last folder listed is the <code>App</code> folder. </p>

<p>Running this command <code>curl -sL check.vapor.sh | bash</code> I can see that my vapor installation was successful.
I'm using <code>Vapor Toolbox v1.0.3</code> and <code>Xcode Version 8.1 (8B62)</code></p>

<p><strong>Does anyone know how to use</strong> <code>vapor xcode</code> <strong>and have it generate an Xcode project where the vapor dependencies don't show up in the</strong> <code>Sources</code> <strong>folder?</strong> </p>
","1655378","","","","","2017-02-26 06:17:09","Vapor Xcode project structure off","<swift><xcode><vapor>","1","2","1","","","40564069","118712","118712","vapor","592","36204589","36204588"
"40565582","1","","","2016-11-12 17:24:47","","5","848","<p>In Vapor, we can create many-to-many relationships by creating a <code>Pivot&lt;U, T&gt;</code> object, where <code>U</code> and <code>T</code> are the models that we want to link together. So if I want to create a system where <code>User</code>s can have many <code>File</code>s and many <code>File</code>s can belong to many <code>User</code>s, I'd associate them like this:</p>

<pre><code>var alice = User(name: ""Alice"")
try! alice.save()
var sales = File(name: ""sales.xclx"")
try! sales.save()

var pivot = Pivot&lt;User, File&gt;(alice, sales)
try! pivot.save()
</code></pre>

<p>What I can't figure out for the life of me is how would I make a <code>Pivot&lt;User, File&gt;</code> contain additional information? For example, I'd like to know when was this file associated associated to Alice, or what permissions she has over it.</p>

<p>On a Relational database, Fluent creates this table for the <code>Pivot&lt;User, File&gt;</code> type.</p>

<pre><code>+---------+---------+------+-----+---------+----------------+
| Field   | Type    | Null | Key | Default | Extra          |
+---------+---------+------+-----+---------+----------------+
| id      | int(11) | NO   | PRI | NULL    | auto_increment |
| file_id | int(11) | NO   |     | NULL    |                |
| user_id | int(11) | NO   |     | NULL    |                |
+---------+---------+------+-----+---------+----------------+
</code></pre>

<p>But I'd like the ability to represent something like this:</p>

<pre><code>+---------+---------+------+-----+---------+----------------+
| Field   | Type    | Null | Key | Default | Extra          |
+---------+---------+------+-----+---------+----------------+
| id      | int(11) | NO   | PRI | NULL    | auto_increment |
| file_id | int(11) | NO   |     | NULL    |                |
| user_id | int(11) | NO   |     | NULL    |                |
| date    | date    | NO   |     | NULL    |                |
| perms   | varchar | NO   |     | READ    |                |
+---------+---------+------+-----+---------+----------------+
</code></pre>
","648767","","","","","2017-11-19 23:59:25","How do I add additional information to a Pivot (using Fluent)?","<swift><vapor>","2","0","","","","40565582","118712","118712","vapor","592","36204589","36204588"
"60796307","1","","","2020-03-22 05:46:28","","0","20","<p>Here is my RecipeIngredientPivot table schema to which I added an addition <code>quantity</code> column.</p>

<pre class=""lang-none prettyprint-override""><code>-----------------------------------------------------
 id | ingredientID | recipeID | quantity
-----------------------------------------------------
| 1 | A001         | R001       | 100               |
| 2 | A002         | R001       | 50                |
| 3 | C004         | R001       | 23                |
| 4 | A001         | R002       | 75                |
</code></pre>

<p>I was able to create a <code>quantity</code> column to the Pivot table which has the <code>ingredient_id</code> and <code>recipe_id</code> as siblings by only using Pivot instead of ModifiablePivot.</p>

<pre><code>extension RecipeIngredientPivot: Pivot {
    init(_ recipe: Recipe, _ ingredient: Ingredient, _ quantity: Double) throws {
        self.recipeID = try recipe.requireID()
        self.ingredientID = try ingredient.requireID()
        self.quantity = quantity
    }
}
</code></pre>

<p>However, I am not sure how to query and get quantities of a recipe.</p>

<pre><code>extension Recipe {
    var ingredients: Siblings&lt;Recipe, Ingredient, RecipeIngredientPivot&gt; {
        return siblings()
    }

    var quantities: [Double] {
        // Not sure how to get this.
    }
}
</code></pre>

<p>Any help is much appreciated.</p>
","1532381","","330315","","2020-03-22 09:15:15","2020-03-23 17:54:56","How to query the additional column (other than siblings) added to pivot table?","<swift><postgresql><vapor-fluent>","1","0","","","","60796307","136591","136591","vapor-fluent","38","54295329","54295328"
"60969552","1","60971944","","2020-04-01 11:10:54","","2","76","<p>In Vapor 4 I have created a user and it has ""gear"" as such: </p>

<pre><code>final class User: Model, Content {

    init() {}

    static var schema: String = ""user""

    @ID(key: .id)
    var id: UUID?

    @Field(key: ""name"")
    var name: String?

    @Children(for: \.$user)
        var gear: [Gear]
}


final class Gear: Model, Content {

    init() {}

    static var schema: String = ""gear""

    @ID(key: .id)
    var id: UUID?

    @Parent(key: ""userId"")
    var user: User
}
</code></pre>

<p>Then when I get this data I do:</p>

<pre><code>func index(req: Request) throws -&gt; EventLoopFuture&lt;[User]&gt; {
    return User.query(on: req.db).with(\.$gear).all()
}
</code></pre>

<p>Rather smooth and simple. Except that ID is being forced to be an UUID while the table in the database can only take the type ""text"" so I get the error:</p>

<pre><code>{
    ""error"": true,
    ""reason"": ""server: operator does not exist: text = uuid (op_error)"" 
}
</code></pre>

<p>So anyone have a clue of how to solve this?</p>

<p>The structure I want in response is similar to:</p>

<pre><code>{
    ""id"": ""w32423tsdg3w"",
    ""name"": ""username"",
    ""gear"": [{
        ""id"": ""1""
        },
        {
        ""id"": ""2""
        }
    ]
}
</code></pre>
","4757272","","4370109","","2020-04-01 11:50:43","2020-04-01 13:26:26","Vapor 4 parent child relationship","<swift><relationship><vapor><vapor-fluent>","1","1","","","","60969552","136591","136591","vapor-fluent","38","54295329","54295328"
"61363681","1","61368428","","2020-04-22 11:11:01","","1","32","<p>I have a vapor 4 application. I do a query from database for getting some items and I want to perform some manual calculation based on the returned values before finishing the request. here a sample code of what I am trying to achieve.</p>

<pre class=""lang-swift prettyprint-override""><code>final class Todo: Model, Content {

    static var schema: String = ""todos""

    @ID(custom: .id)
    var id: Int?

    @Field(key: ""title"")
    var title: String

    var someValue: Int?

}

/// Allows `Todo` to be used as a dynamic migration.
struct CreateTodo: Migration {
    func prepare(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        database.schema(Todo.schema)
            .field(""id"", .int, .identifier(auto: true))
            .field(""title"", .string, .required)
            .create()
    }

    func revert(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        database.schema(Todo.schema).delete()
    }
}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>final class TodoController:RouteCollection{

    func boot(routes: RoutesBuilder) throws {

        routes.get(""tmp"", use: temp)
    }

    func temp(_ req:Request) throws -&gt; EventLoopFuture&lt;[Todo]&gt; {

        Todo.query(on: req.db).all().map { todos in

            todos.map {
                $0.someValue = (0...10).randomElement()!
                return $0
            }
        }
    }

}
</code></pre>

<p><strong>The problem is that those manual changes, aren't available in response. In this case <code>someValue</code> property.</strong></p>

<p>Thanks.</p>

<pre class=""lang-js prettyprint-override""><code>[
    {
        ""title"": ""item 1"",
        ""id"": 1
    },
    {
        ""title"": ""item 2"",
        ""id"": 2
    }
]
</code></pre>
","7649191","","3103448","","2020-04-22 20:56:52","2020-04-22 20:56:52","Manually modifying model property values in vapor 4 response","<swift><vapor><server-side-swift><vapor-fluent>","1","0","","","","61363681","136591","136591","vapor-fluent","38","54295329","54295328"
"40569832","1","40593857","","2016-11-13 02:10:19","","1","380","<p>I've been unable to get tests working in my Vapor app. It seems like the linker just doesn't find any of the app classes being tested. To narrow the problem down, I've tried creating the simplest test possible using the default app template. The steps are shown below. If anyone can either tell me what I'm doing wrong, or that they can replicate the issue, I'd be very grateful.</p>

<ol>
<li>Create a new project.</li>
</ol>

<blockquote>
<pre><code>$ vapor new Foo
Cloning Template [Done]
$ cd Foo
$ mkdir -p Tests/ModelTests
</code></pre>
</blockquote>

<ol start=""2"">
<li>Add a dummy test that references a class in the default project.</li>
</ol>

<blockquote>
<pre><code>$ cat &gt; Tests/ModelTests/PostTests.swift
import XCTest
@testable import App

class PostTests: XCTestCase {
  func testPost() {
    print(Post.self)
    XCTAssertEqual(""a"", ""a"")
  }
}
^D
</code></pre>
</blockquote>

<ol start=""3"">
<li>Build the project.</li>
</ol>

<blockquote>
<pre><code>$ vapor build
No Packages folder, fetch may take a while...
Fetching Dependencies [Done]
Building Project [Done]
</code></pre>
</blockquote>

<ol start=""4"">
<li>Run the tests.</li>
</ol>

<blockquote>
<pre><code>$ vapor test
Testing [Failed]
Log:
swift-test: error: no tests found to execute, create a module in your `Tests' directory
</code></pre>
</blockquote>

<ol start=""5"">
<li>Oops, seems like we need to remove ""Tests"" from the exclude: section of Package.swift.</li>
</ol>

<blockquote>
<pre><code>$ vi Package.swift
   ... remove Tests from exclude: ....
</code></pre>
</blockquote>

<ol start=""6"">
<li>Try again.</li>
</ol>

<blockquote>
<pre><code>$ vapor test
Testing [Failed]
Log:
&lt;unknown&gt;:0: error: build had 1 command failures
swift-test: error: exit(1): /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f /Users/mark/tmp/Foo/.build/debug.yaml test
</code></pre>
</blockquote>

<ol start=""7"">
<li>Try directly executing the command line shown above.</li>
</ol>

<blockquote>
<pre><code>$ /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool
-f /Users/mark/tmp/Foo/.build/debug.yaml test
Linking ./.build/debug/FooPackageTests.xctest/Contents/MacOS/FooPackageTests
Undefined symbols for architecture x86_64:
  ""__TMaC3App4Post"", referenced from:
      __TFC10ModelTests9PostTests8testPostfT_T_ in PostTests.swift.o
      __TMaMC3App4Post in PostTests.swift.o
ld: symbol(s) not found for architecture x86_64
&lt;unknown&gt;:0: error: link command failed with exit code 1 (use -v to see invocation)
&lt;unknown&gt;:0: error: build had 1 command failures
</code></pre>
</blockquote>

<p>This is the behavior I see in my own project as well: the linker doesn't find classes from the app referenced in the test.</p>

<p><strong>Solved, see comment below.</strong></p>
","81434","","81434","","2016-11-13 23:38:09","2016-11-14 16:51:28","tests not working in vapor app","<swift><vapor>","1","2","1","","","40569832","118712","118712","vapor","592","36204589","36204588"
"40584379","1","","","2016-11-14 08:16:37","","0","1104","<p>I'm trying to create a small chat application using Vapor but I got stuck.  I am using Socket.IO on ios and I am always getting the error page not found.</p>

<p>Can you please guide me towards identifying my error?</p>

<p>Vapor codes :</p>

<pre><code>drop.socket(""ws"") { req, ws in
print(""New WebSocket connected: \(ws)"")

// ping the socket to keep it open
try background {
while ws.state == .open {
  try? ws.ping()
  drop.console.wait(seconds: 10) // every 10 seconds
}
}

ws.onText = { ws, text in
print(""Text received: \(text)"")

// reverse the characters and send back
let rev = String(text.characters.reversed())
try ws.send(rev)
}

ws.onClose = { ws, code, reason, clean in
print(""Closed."")
}
}

drop.run()
</code></pre>

<p>On the client side: </p>

<pre><code>func receiveMSGFromServer(){

let u = URL(string: ""ws://localhost:8080/ws"")
//""http://localhost:8080/""

let socket = SocketIOClient(socketURL: URL(string: ""wss://localhost:8080/ws"")!, config: [.log(true), .forcePolling(true)]) //SocketIOClient(socketURL: u!)

socket.emit(""ws"", "":emptyParam"")

socket.on(""ws"") {data, ack in
  print(""Message for you! \(data[0])"")
 // ack(""I got your message, and I'll send my response"")
  socket.emit(""response"", ""Hello!"")
}

socket.connect()
</code></pre>

<p>}</p>
","6592602","","","","","2016-11-29 13:32:37","Vapor - Create web socket","<swift><vapor>","1","3","","","","40584379","118712","118712","vapor","592","36204589","36204588"
"61445205","1","","","2020-04-26 17:35:59","","2","36","<p>My context:</p>

<ul>
<li>macOS Catalina version 10.15.3</li>
<li>Xcode 11.4</li>
<li>Swift 5.2</li>
<li>Vapor4</li>
</ul>

<p>I'm creating a new Vapor project with <code>vapor-beta new myProjectName</code></p>

<p>It asks if I want to use Fluent, which I agree to (y) and asks what kind of database do I want (1. postgreSQL   2. MySql   3. SQLite).
I went with option 3; SQLite is what I need.</p>

<p>It then proceeds to download a template and supposedly customise it with my above selected options.
It stops / freezes at </p>

<pre><code>Generating project files
+ Package.Swift
</code></pre>

<p>Nothing happens after this line, even after 10 minutes of waiting.</p>

<p>When I look in my application folder, there's a hidden .vapor-template folder that seems to contain the folder structure of an app.
I can't simply start using it, because many files seem to be...unfinished, in some way.
For instance, here's how Package.swift looks like:</p>

<pre><code>let package = Package(
    name: ""{{name}}"",
    platforms: [
       .macOS(.v10_15)
    ],
    dependencies: [
        // 💧 A server-side Swift web framework.
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""4.0.0-rc""){{#fluent}},
        .package(url: ""https://github.com/vapor/fluent.git"", from: ""4.0.0-rc""),
        .package(url: ""https://github.com/vapor/fluent-{{fluent.db.url}}-driver.git"", from: ""{{fluent.db.version}}-rc""){{/fluent}}
    ],
    targets: [
        .target(name: ""App"", dependencies: [{{#fluent}}
            .product(name: ""Fluent"", package: ""fluent""),
            .product(name: ""Fluent{{fluent.db.module}}Driver"", package: ""fluent-{{fluent.db.url}}-driver""),{{/fluent}}
            .product(name: ""Vapor"", package: ""vapor"")
        ]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [
            .target(name: ""App""),
            .product(name: ""XCTVapor"", package: ""vapor""),
        ])
    ]
)
</code></pre>

<p>As you can see, the name of the project is not set (I'm referring to the <code>name: ""{{name}}""</code> thing), and there are plenty of weird references to <code>{{#fluent}}</code> or <code>""{{fluent.db.version}}-rc"")</code> that freak out the compiler. 
It looks like the ""vapor new"" command had some more customisation work to do that it simply did not get a chance to finish.
Same story repeats in configure.swift and routes.swift.</p>

<p>I did comb through all of them, deleting the weird placeholders only to bump into some configure.swift situation where it complains about .sqlite not being recognised or something.
I did look it up on google / stackoverflow, tried some fixes that didn't work...until I took a step back an realised that hell...I shouldn't be doing all this SherlokHolmes-ing...the ""vapor new"" command should simply work and successfully finish...There's plenty of work for me afterwards...This simple, helloWorld-ish step should simply work...</p>

<p>If anyone has some insights into successfully creating a Vapor4 project, I'll be grateful...(simply following the steps at <a href=""https://docs.vapor.codes/4.0/hello-world/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/4.0/hello-world/</a>  is not conducive to a working project)</p>

<p>L.E: thanks to imike's suggestion, I headed over to Vapor's community on Discord and found my solution.
My project's folder path happened to contain some spaces and dashes. Removing those allowed the process to finish correctly.
Great, helpful community!</p>
","3411322","","3411322","","2020-04-28 22:22:44","2020-04-28 22:22:44","Not able to create a valid, working, new project while using Vapor4","<swift><vapor><vapor-fluent>","1","0","","","","61445205","136591","136591","vapor-fluent","38","54295329","54295328"
"61557416","1","","","2020-05-02 09:53:15","","2","13","<p>how can I add WHERE x LIKE $xyz to query builder?</p>

<p>i started with </p>

<pre><code>let searchQuery = try? request.query.get(String.self, at: ""s"")
...
query.where(\Talk.title, SwifQL.like(searchQuery))
</code></pre>

<p>but what next I want to search for case insensitive string I have error: </p>

<p><code>[ ERROR ] PostgreSQLError.server.error.scanner_yyerror: GET /testroute?s=Swift syntax error at or near ""$8"" (ErrorMiddleware.swift:26)</code></p>
","1285959","","","","","2020-05-02 10:44:16","How to use LIKE in WHERE clause in SwifQL","<vapor><vapor-fluent>","1","0","","","","61557416","136591","136591","vapor-fluent","38","54295329","54295328"
"27199714","1","40958272","","2014-11-29 06:49:45","","4","597","<p>I am using Evaporate.js to upload files to Amazon Web Service .</p>

<p><a href=""https://github.com/TTLabs/EvaporateJS"" rel=""nofollow"">https://github.com/TTLabs/EvaporateJS</a>
This is working fine,But i need to add pause/resume features to my application.Is it possible?</p>

<p>I notice that some empty functions are there in <a href=""https://github.com/TTLabs/EvaporateJS/blob/master/evaporate.js"" rel=""nofollow"">https://github.com/TTLabs/EvaporateJS/blob/master/evaporate.js</a></p>

<pre><code> _.pause = function(id){

 };

 _.resume = function(id){

 };

 _.forceRetry = function(){

 }; 
</code></pre>

<p>Is  any way to do with this function?</p>
","1682826","","1682826","","2014-12-02 06:37:59","2016-12-04 11:45:58","Evaporate.js pause/resume","<javascript><amazon-web-services><upload><evaporate.js>","1","0","1","","","27199714","108432","108432","evaporate.js","13","27157574","27157573"
"27243922","1","38354788","","2014-12-02 07:23:29","","1","293","<p>I am using angular-evaporate <a href=""https://github.com/uqee/angular-evaporate"" rel=""nofollow"">https://github.com/uqee/angular-evaporate</a> for uploading files to Amazon Web Service(AWS).
I need to add a cancel button in it.There is a function already available in Evaporate.js.</p>

<pre><code>_.cancel = function(id){

    l.d('cancel ', id);
    if (files[id]){
       files[id].stop();
       return true;
    } else {
       return false;
    }
 };
</code></pre>

<p>But i don't know how to cal it on a button click.I am new in angulare js,Please help me.</p>
","1682826","","2546444","","2015-12-03 17:41:31","2016-07-13 14:39:39","Cancel upload angular-evaporate","<javascript><angularjs><amazon-web-services><evaporate.js>","1","0","","","","27243922","108432","108432","evaporate.js","13","27157574","27157573"
"29196338","1","","","2015-03-22 15:43:30","","0","700","<p>I'm trying to use this:</p>

<p><a href=""https://github.com/uqee/angular-evaporate"" rel=""nofollow"">https://github.com/uqee/angular-evaporate</a>  </p>

<p>to create a multipart uploader.  The issue I'm having is creating the signature since I'm using PHP.  Are there any working examples anyone could point me to?</p>
","2453687","","","","","2015-03-25 11:29:06","evaporate js with php signing url for s3","<javascript><angularjs><amazon-s3><evaporate.js>","1","0","","","","29196338","108432","108432","evaporate.js","13","27157574","27157573"
"36641478","1","","","2016-04-15 08:00:42","","0","480","<p>You can limit file size with <strong>content-length-range</strong> field in a browser based upload (not multipart):
<a href=""http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTConstructPolicy.html"" rel=""nofollow"">http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTConstructPolicy.html</a></p>

<p>How can you limit it in a multipart upload? I'm using <a href=""https://github.com/TTLabs/EvaporateJS"" rel=""nofollow"">EvaporateJS</a>.</p>
","2201106","","2201106","","2016-04-15 08:27:58","2016-12-04 11:49:08","Set maximum allowed file size for S3 multipart upload","<amazon-s3><evaporate.js>","1","0","","","","36641478","108432","108432","evaporate.js","13","27157574","27157573"
"41604594","1","","","2017-01-12 03:25:10","","10","1709","<p>I'm building a web app that uses EvaporateJS to upload large files to Amazon S3 using Multipart Uploads. I noticed an issue where every time a new chunk was started the browser would freeze for ~2 seconds. I want the user to be able to continue to use my app while the upload is in progress, and this freezing makes that a bad experience.</p>

<p>I used Chrome's Timeline to look into what was causing this and found that it was SparkMD5's hashing. So I've moved the entire upload process into a Worker, which I thought would fix the issue.</p>

<p>Well the issue is now fixed in Edge and Firefox, but Chrome still has the exact same problem.</p>

<p>Here's a screenshot of my Timeline:
<img src=""https://i.imgur.com/Y0qs8Lx.png"" alt=""Timeline""></p>

<p>As you can see, during the freezes my main thread is doing basically nothing, with &lt;8ms of JavaScript running during that time. All the work is occurring in my Worker thread, and even that is only running for ~600ms or so, not the 1386ms that my frame takes.</p>

<p>I'm really not sure what's causing the issue, are there any gotchas with Workers that I should be aware of?</p>

<p>Here's the code for my Worker:</p>

<pre><code>var window = self; // For Worker-unaware scripts

// Shim to make Evaporate work in a Worker
var document = {
    createElement: function() {
        var href = undefined;

        var elm = {
            set href(url) {
                var obj = new URL(url);
                elm.protocol = obj.protocol;
                elm.hostname = obj.hostname;
                elm.pathname = obj.pathname;
                elm.port = obj.port;
                elm.search = obj.search;
                elm.hash = obj.hash;
                elm.host = obj.host;
                href = url;
            },
            get href() {
                return href;
            },
            protocol: undefined,
            hostname: undefined,
            pathname: undefined,
            port: undefined,
            search: undefined,
            hash: undefined,
            host: undefined
        };

        return elm;
    }
};

importScripts(""/lib/sha256/sha256.min.js"");
importScripts(""/lib/spark-md5/spark-md5.min.js"");
importScripts(""/lib/url-parse/url-parse.js"");
importScripts(""/lib/xmldom/xmldom.js"");
importScripts(""/lib/evaporate/evaporate.js"");

DOMParser = self.xmldom.DOMParser;

var defaultConfig = {
    computeContentMd5: true,
    cryptoMd5Method: function (data) { return btoa(SparkMD5.ArrayBuffer.hash(data, true)); },
    cryptoHexEncodedHash256: sha256,
    awsSignatureVersion: ""4"",
    awsRegion: undefined,
    aws_url: ""https://s3-ap-southeast-2.amazonaws.com"",
    aws_key: undefined,
    customAuthMethod: function(signParams, signHeaders, stringToSign, timestamp, awsRequest) {
        return new Promise(function(resolve, reject) {
            var signingRequestId = currentSigningRequestId++;

            postMessage([""signingRequest"", signingRequestId, signParams.videoId, timestamp, awsRequest.signer.canonicalRequest()]);
            queuedSigningRequests[signingRequestId] = function(signature) {
                queuedSigningRequests[signingRequestId] = undefined;
                if(signature) {
                    resolve(signature);
                } else {
                    reject();
                }
            }
        });
    },
    //logging: false,
    bucket: undefined,
    allowS3ExistenceOptimization: false,
    maxConcurrentParts: 5
}

var currentSigningRequestId = 0;
var queuedSigningRequests = [];

var e = undefined;
var filekey = undefined;
onmessage = function(e) {
    var messageType = e.data[0];
    switch(messageType) {
        case ""init"":
            var globalConfig = {};
            for(var k in defaultConfig) {
                globalConfig[k] = defaultConfig[k];
            }
            for(var k in e.data[1]) {
                globalConfig[k] = e.data[1][k];
            }

            var uploadConfig = e.data[2];

            Evaporate.create(globalConfig).then(function(evaporate) {
                var e = evaporate;

                filekey = globalConfig.bucket + ""/"" + uploadConfig.name;

                uploadConfig.progress = function(p, stats) {
                    postMessage([""progress"", p, stats]);
                };

                uploadConfig.complete = function(xhr, awsObjectKey, stats) {
                    postMessage([""complete"", xhr, awsObjectKey, stats]);
                }

                uploadConfig.info = function(msg) {
                    postMessage([""info"", msg]);
                }

                uploadConfig.warn = function(msg) {
                    postMessage([""warn"", msg]);
                }

                uploadConfig.error = function(msg) {
                    postMessage([""error"", msg]);
                }

                e.add(uploadConfig);
            });
            break;

        case ""pause"":
            e.pause(filekey);
            break;

        case ""resume"":
            e.resume(filekey);
            break;

        case ""cancel"":
            e.cancel(filekey);
            break;

        case ""signature"":
            var signingRequestId = e.data[1];
            var signature = e.data[2];
            queuedSigningRequests[signingRequestId](signature);
            break;
    }
}
</code></pre>

<p>Note that it relies on the calling thread to provide it with the AWS Public Key, AWS Bucket Name and AWS Region, AWS Object Key and the input File object, which are all provided in the 'init' message. When it needs something signed, it sends a 'signingRequest' message to the parent thread, which is expected to provided the signature in a 'signature' message once it's been fetched from my API's signing endpoint.</p>
","674675","","","","","2017-01-23 14:28:33","Worker blocking UI thread in Chrome","<javascript><multithreading><google-chrome><web-worker><evaporate.js>","1","7","3","","","41604594","108432","108432","evaporate.js","13","27157574","27157573"
"43681054","1","","","2017-04-28 13:10:34","","2","259","<p>We are working on s3 browser based multipart file using EvaporateJS, Using pre-signed URL with temperory credentials.  </p>

<p>Following will be my configuration</p>

<pre><code>var amz_headers_common = {};
var amz_headers_at_initiate = {};
var amz_headers_at_upload = {};
var amz_headers_at_complete = {};

amz_headers_common['x-amz-acl'] = 'private';
amz_headers_common['x-amz-security-token'] = '&lt;?=AWS_TOKEN;?&gt;';
amz_headers_at_initiate['x-amz-acl'] = 'private';
amz_headers_at_initiate['x-amz-security-token'] = '&lt;?=AWS_TOKEN;?&gt;';

var customAuth = $(""#signingMethod"")[0].checked; 
Evaporate.create({
  signerUrl: customAuth ? undefined : '&lt;?=AWS_SIGNER_URL;?&gt;', 
  aws_key: '&lt;?=AWS_KEY;?&gt;' ,
  bucket: '&lt;?=AWS_S3_BUCKET;?&gt;',
  cloudfront: false,
  computeContentMd5: true,
  cryptoMd5Method: function (data) { return AWS.util.crypto.md5(data, 'base64'); },
  cryptoHexEncodedHash256: function (data) { return AWS.util.crypto.sha256(data, 'hex'); },
  logging: true,
  s3Acceleration: true,
  signTimeout: 10,
  s3FileCacheHoursAgo: 1,
  maxConcurrentParts:5,
  allowS3ExistenceOptimization: true,
  sendCanonicalRequestToSignerUrl: true,
  customAuthMethod: customAuth? doNotUseUnsafeJavaScriptV4Signer : undefined,
  evaporateChanged: function (file, evaporatingCount) {
     $('#totalParts').text(evaporatingCount);
     if (evaporatingCount &gt; 0) {
        $(""#pause-all, #pause-all-force, #cancel-all"").show();
     } else if (evaporatingCount === 0) {
        $(""#pause-all, #pause-all-force, #resume, #cancel-all"").hide();
     }
  }
})
var promise = _e_.add({
 name: name,
 file: files[i],
 started: callback_methods.started,
 complete: callback_methods.complete,
 cancelled: callback_methods.cancelled,
 progress: callback_methods.progress,
 error: callback_methods.error,
 warn: callback_methods.warn,
 paused: callback_methods.paused,
 pausing: callback_methods.pausing,
 resumed: callback_methods.resumed,
 nameChanged: callback_methods.nameChanged,
 xAmzHeadersCommon: amz_headers_common,
 xAmzHeadersAtInitiate: amz_headers_at_initiate,
 xAmzHeadersAtUpload: amz_headers_at_upload,
 xAmzHeadersAtComplete: amz_headers_at_complete
},
{
 bucket: '&lt;?=AWS_S3_BUCKET;?&gt;',  // Shows that the bucket can be changed per
 aws_key: '&lt;?=AWS_KEY;?&gt;' // Shows that aws_key can be changed per
}
</code></pre>

<p>But I'm getting following signature mismatch error.</p>

<p>AWS Code: SignatureDoesNotMatch, Message:The request signature we calculated does not match the signature you provided. Check your key and signing method.status:403</p>

<p>Following will be log</p>

<pre><code>Without temperary credentials following cannonical request and v4 string to sign.

POST
/test-video.mp474.6796611212833
uploads=
host:&lt;bucket-name&gt;.s3-accelerate.amazonaws.com
x-amz-date:20170428T055938Z

host;x-amz-date
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855

V4 stringToSign: AWS4-HMAC-SHA256
20170428T055938Z
20170428/ap-southeast-1/s3/aws4_request
ce2c7c5fbbf58483efbd4bd244551d138353ebb7b7233d3fdce73e85d96fad8d

--------------------------------------------------------------------------------------
Using temperary credentials following cannonical request and v4 string to sign.

initiate V4 CanonicalRequest: POST
/test-video.mp461.80892198840156
uploads=
host:&lt;bucket-name&gt;.s3-accelerate.amazonaws.com
x-amz-acl:private
x-amz-date:20170427T160400Z
x-amz-security-token:FQoDYXdzEDEaDIkS6zY1Oj8PQLLDVSK5A5pPusfWw81Yq3v0c4VqlyyQsBDW+PHosDuDnG8EYc9jlXD1tQwiTKU1E2Nf3aKcYmv/BHYwGwOen9GPStPeVBGbWNBzi1lT+B6xOnDvIXzelnuC6Eddt+jYIrjy9RVIKBN/s80NtVwfjmFK+93iOWJzdl2ruRSzQINZ+UuSmuthudkYLZzKy0pDmCrgIz8YCjXsjhN7FyeSZzXk9qmBDCASygVEFDNbkb/xidH/Yj7P9gYdsxY6YokV/CM8ZpAKmE8Lp+en+xs9rDclexFzCId8QyJaGj0xb205WoeRIHr8RSStvyounCxrmhWP6M/eijWTP/uHIfWVDqBadEPSgVWqcEzrW2iJ+0SGROb+In6BMmkEMaw+9L5M+lkgCfMDm5Fw9Ip8bujcb4okoNjEn6L+L0b1lm3yuqvLkT3oOzL3Sn48n3y0dXsYtt3yAq+C02bnfmgtYVQgv1C9TaMHrvipFADYNJ9U81HxQWlgvuSG5BEgqV59PIzGhwPFHais/GyA+a1bmxkyhzKEw1yq6F6+wQ+VBRskmPlahQd9ZK3wrnqvpQm+H7tD2YLkVVQb+AGKtRVU3mOL3yjgnYjIBQ==

host;x-amz-acl;x-amz-date;x-amz-security-token
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855

V4 stringToSign: AWS4-HMAC-SHA256
20170427T160400Z
20170427/ap-southeast-1/s3/aws4_request
e0b18a695b23bc16b6727fd2dc417e445266111ebb4995794287a46304d2cc92
</code></pre>

<p>Please help me to solve singature mismatch issue.</p>
","420179","","","","","2017-08-24 03:28:48","Using Temporary Credentials giving SignatureDoesNotMatch issue","<file-upload><amazon-s3><multipart><aws-sts><evaporate.js>","1","0","1","","","43681054","108432","108432","evaporate.js","13","27157574","27157573"
"46675251","1","","","2017-10-10 20:17:24","","0","64","<p>I'm trying to use Evaporatejs to upload files to AWS, but we need to use it not from the browser but from the node layer. Imagine just a javasript script that is trying to upload the ""file"" object that is supposed to be created from a file path. </p>

<p>But I don't see how this could be done since Evaooratejs uses FileAPI file object that is completely browser based.
Is there a way I could use evaporatejs to upload a file from file path and not from the browser?</p>
","1148287","","","","","2017-10-24 12:46:04","Using Evaporatejs with file path","<javascript><amazon-s3><evaporate.js>","1","0","","","","46675251","108432","108432","evaporate.js","13","27157574","27157573"
"40592541","1","40595311","","2016-11-14 15:42:00","","2","118","<p>I am doing my first steps in Vapor, the web framework for Swift.</p>

<p>The first piece of code that called my attention was this:</p>

<pre><code>app.get(""welcome"") { request in 
    return ""Hello""
}
</code></pre>

<p>I don't understand the syntax here. I mean, I'm calling <code>app.get()</code> method, but I'm also defining some kind of function where request is a parameter. I know that this will result in a get method accessible by a <code>/welcome</code> URL and will return ""Hello"". What is not clear for me is how this piece of code works and how the compiler interprets it. </p>
","4055783","","236755","","2017-04-18 13:55:49","2017-04-18 13:55:49","Parameters after opening bracket","<swift><parameters><vapor>","1","3","1","","","40592541","118712","118712","vapor","592","36204589","36204588"
"40601323","1","40726004","","2016-11-15 03:01:33","","4","292","<p>I have a Vapor app that I want to push to Heroku.  I used <code>vapor heroku init</code> to initialize the Heroku project.  Now that it is on Heroku, I want to be able to push changes to Heroku using <code>vapor heroku push</code>.  But every time I run that command from the Vapor CLI, I get the following:</p>

<pre><code>Error: spawnProcess
</code></pre>

<p>Can anyone tell me why that might be failing or perhaps point me in the right direction?</p>
","1704173","","","","","2016-11-21 17:29:46","Trying to push a Vapor app to Heroku using CLI fails","<swift><heroku><vapor>","1","1","0","","","40601323","118712","118712","vapor","592","36204589","36204588"
"40696026","1","40752068","","2016-11-19 17:46:14","","1","713","<p>I am running Xcode 8.1 with Vapor and SWIFT 3. </p>

<p>I am posting a request to to google server to get an auth token, so I can call FireBaseDB API, but I get error:   unsupported_grant_type/Invalid grant_type.<br>
On <a href=""https://developers.google.com/identity/protocols/OAuth2ServiceAccount"" rel=""nofollow noreferrer"">developers.google.com</a> it says that I have to encode in a URL the following: <a href=""https://www.googleapis.com/oauth2/v4/token"" rel=""nofollow noreferrer"">https://www.googleapis.com/oauth2/v4/token</a> + grant_type + assertion, and pass the encoded URL in the body of the POST request. I pass it as a string. </p>

<p>I have noticed that the private key from the JSON file downloaded from my service account contains characters such as /n , ----,==, should I delete them before posting the key?</p>

<pre><code>    let dateNow = Date()
      var expDate = String(Int(dateNow.timeIntervalSince1970 + (60 * 60)))
        var iatDate = String(Int(dateNow.timeIntervalSince1970))


 let headerJWT = [""alg"":""HS256"",""typ"":""JWT""]
    let jwtClaimSet =
    [""iss"":""firebase-adminsdk-c7i48@fir-10c2e.iam.gserviceaccount.com"",
     ""scope"":""https://www.googleapis.com/auth/firebase.database"",
      ""aud"":""https://www.googleapis.com/oauth2/v4/token"",
       ""exp"": expDate,
         ""iat"": iatDate]

      //create and sign JSON Web Token
   let jwt = try JWT(headers: Node(node: headerJWT),
              payload: Node(node: jwtClaimSet),
               signer: HS256(key:""-----BEGIN PRIVATE KEY-----\nMIIEvAWvQ== \n-----END PRIVATE KEY-----\n""))

    // Store JSON Web Token
      let JWTtoken = try jwt.createToken()

func createUrlWithString() -&gt; NSURL {
    var urlString = ""https://www.googleapis.com/oauth2/v4/token""
     urlString.append(""?grant_type="")
      urlString.append(""urn:ietf:params:oauth:grant-type:jwt-bearer"")
       urlString.append(""&amp;assertion="")
        urlString.append(JWTtoken)
  return NSURL(string: urlString)!
 }

        // make the body input for our POST
      let bodyURL =  createUrlWithString().absoluteURL

     drop.get(""any"") { request in
        let response =  
 try drop.client.request(.other(method:""Post""),
           ""https://www.googleapis.com/oauth2/v4/token"", 
             headers: [""Content-Type"": ""application/x-www-form-urlencoded""], 
                 query: [:], 
                  body: String(describing: bodyURL) )


     let serverResp = response.headers
        let serverBody = response.body.bytes
          let serverJson = try JSON(bytes: serverBody!)
             print(serverJson)
    return ""POST Request went through""
}
</code></pre>

<h2>Update</h2>

<p>As per Karol Gasienica suggestion, I am passing <code>grant_type</code> and <code>assertion</code> parameters as POST request parameters. Now I get <code>""error_description"": Node.Node.string(""SSL is required to perform this operation."")]))</code></p>

<pre><code>func createUrlWithString() -&gt; NSURL {
 var urlString = ""https://www.googleapis.com/oauth2/v4/token""
  urlString.append(""?grant_type="")
    urlString.append(""urn:ietf:params:oauth:grant-type:jwt-bearer"")
     urlString.append(""&amp;assertion="")
      urlString.append(JWTtoken)
  return NSURL(string: urlString)!
}

  let response =  try drop.client.request(.other(method:""Post""), 
   String(describing: bodyURL),
      headers: [""Content-Type"": ""application/x-www-form-urlencoded""], 
         query: [:])
</code></pre>
","5918849","","5918849","","2016-11-23 12:06:18","2016-11-23 12:06:18","Swift Vapor unsupported_grant_type invalid signature / OAuth access token","<swift><oauth-2.0><vapor>","2","1","","","","40696026","118712","118712","vapor","592","36204589","36204588"
"49650077","1","","","2018-04-04 11:40:36","","0","390","<p>I am attempting to upload files directly to the browser to S3 using evaporate js.
I followed the tutorial at <a href=""https://jqueryajaxphp.com/direct-upload-amazon-s3-evaporatejs-php/"" rel=""nofollow noreferrer"">jqueryajaxphp.com</a> but I am having a problem with the signature</p>

<p><strong>Signature.php</strong></p>

<pre><code>&lt;?php

$to_sign = $_GET['to_sign'];
$secret = 'AWS_SECRET';
$hmac_sha1 = hash_hmac('sha1', $to_sign, $secret, true);
$signature = base64_encode($hmac_sha1);
echo $signature;
</code></pre>

<p><strong>Upload function</strong></p>

<pre><code>function largeFileUPload(file) {

    var ins = new Evaporate({
        signerUrl: './includes/s3-signature.php',
        aws_key: ""AWS_KEY_XXXXXXX"",
        bucket: 'bucket-name',
        awsRegion: 'eu-west-1',
        cloudfront: true,
        aws_url: 'http://bucket-name.s3-accelerate.amazonaws.com',
        // partSize: 10 * 1024 * 1024,
        s3Acceleration: true,
        computeContentMd5: true,
        cryptoMd5Method: function (data) { return AWS.util.crypto.md5(data, 'base64'); },
        cryptoHexEncodedHash256: function (data) { return AWS.util.crypto.sha256(data, 'hex'); }
    });
    // http://&lt;?=$my_bucket?&gt;.s3-&lt;?=$region?&gt;.amazonaws.com

    ins.add({
        name: 'evaporateTest' + Math.floor(1000000000*Math.random()) + '.' + file.name.replace(/^.*\./, ''),
        file: file,
        xAmzHeadersAtInitiate : {
            'x-amz-acl': 'public-read'
        },
        signParams: {
            foo: 'bar'
        },
        complete: function(r){
            console.log('Upload complete');
        },
        progress: function(progress){
            var progress = Math.floor(progress*100);
            console.log(progress);
        },
        error: function(msg){
            console.log(msg);
        }
    });
}
</code></pre>

<p>I am getting to following response from from the s3 end point </p>

<pre><code>&lt;Code&gt;SignatureDoesNotMatch&lt;/Code&gt;
&lt;Message&gt;The request signature we calculated does not match the signature you provided. Check your key and signing method.&lt;/Message&gt;
</code></pre>

<p>I have also tried the blueimp plugin but this fails with files over 200MB</p>
","1685748","","1685748","","2018-04-05 14:12:11","2019-04-18 09:42:36","evaporate.js s3 direct uploads 403","<file><amazon-web-services><amazon-s3><file-upload><evaporate.js>","1","0","","","","49650077","108432","108432","evaporate.js","13","27157574","27157573"
"54069703","1","","","2019-01-07 06:53:01","","1","72","<p>I have created pre-signed URL for post file to AWS s3 bucket, it's working for ap-southeast-1 but for ap-south-1 it shown me signature does not match error.</p>

<p>I'm using sign v4 and evaporate.js to do multipart upload<br><br><a href=""https://i.stack.imgur.com/Qb5Tu.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Qb5Tu.png"" alt=""enter image description here""></a></p>
","7353240","","5255147","","2019-01-07 08:34:21","2019-01-09 02:51:36","AWS SignatureDoesNotMatch error on ap-south-1 region","<javascript><amazon-s3><evaporate.js>","1","0","","","","54069703","108432","108432","evaporate.js","13","27157574","27157573"
"55511395","1","","","2019-04-04 08:36:47","","1","221","<p>Very weird occurrence of this error (see below). Points of note:</p>

<ul>
<li>Web app in question has >500 daily users, all of them uploading objects into S3 daily</li>
<li>Two users, have this one error when they try and upload a file</li>
<li>The same users, if they try a different computer, do not get this error</li>
<li>Web app is using the EvaporateJS library - <a href=""https://github.com/TTLabs/EvaporateJS"" rel=""nofollow noreferrer"">https://github.com/TTLabs/EvaporateJS</a></li>
<li>There seems to be no pattern with regards to file size (even a tiny &lt;10kb file will cause it)</li>
<li>The authentication/authorisation component of the web app is handled by the web-app. I.e. - The IAM user associated with generating the S3 upload Url is shared for all web app users, so I have ruled out a permission issue for the IAM user ID in question</li>
</ul>

<p>Error message:</p>

<pre><code>&lt;Error&gt;
  &lt;Code&gt;InvalidRequest&lt;/Code&gt;
  &lt;Message&gt;
    Key is not expected for the GET method ?uploads subresource
  &lt;/Message&gt;
  &lt;RequestId&gt;
    *****
  &lt;/RequestId&gt;
  &lt;HostId&gt;
    *****
  &lt;/HostId&gt;
&lt;/Error&gt;
</code></pre>

<p>From all the points above, the only variable here seems to be the computers. Am I right? Have I overlooked something? If it is the computers, any idea what would be the issue there? An overactive firewall/something else preventing the upload network requests?</p>

<p>Thanks in advance for any guidance in decipher this error message (what does it even mean?!)</p>
","5711615","","","","","2019-04-04 08:36:47","AWS S3 - key is not expected for the get method","<reactjs><amazon-web-services><amazon-s3><evaporate.js>","0","4","","","","55511395","108432","108432","evaporate.js","13","27157574","27157573"
"56750326","1","59580021","","2019-06-25 08:58:49","","0","73","<p>I'm using EvaporateJS in a react project which uses webpack.</p>

<p>As described in the <a href=""https://github.com/TTLabs/EvaporateJS/wiki/Evaporate.create()"" rel=""nofollow noreferrer"">documentation</a> I used the following: </p>

<p>(<strong>I don't want to use the aws-sdk because of the package size which btw works properly</strong>)</p>

<pre><code>cryptoMd5Method: function (data) { 
 return crypto.createHash('md5').update(data).digest('base64'); 
}
</code></pre>

<p>But 'data' is type of ArrayBuffer. So I tried converting it to string.</p>

<pre><code>cryptoMd5Method: function (data) { 
    var enc = new TextDecoder();
    var dataString = enc.decode(data);
    var computed = crypto.createHash('md5').update(dataString).digest('base64');
    return computed ;
}
</code></pre>

<p>But that doesn't compute the digest correctly.</p>

<hr>

<p>So, what should be the solution for this (considering the nodejs crypto option)?</p>

<p>Also alternatively, how to import just <code>AWS.util.crypto</code> module without referencing the whole <code>aws-sdk</code> ? This will help me keep the bundle small.</p>
","10843897","","10843897","","2019-06-25 10:26:04","2020-01-03 14:11:26","How to use nodejs crypto in cryptoMd5Method of EvaporateJS","<javascript><node.js><webpack><aws-sdk><evaporate.js>","2","4","","","","56750326","108432","108432","evaporate.js","13","27157574","27157573"
"57858708","1","57906693","","2019-09-09 17:34:11","","1","110","<p>I am using <a href=""https://www.npmjs.com/package/evaporate"" rel=""nofollow noreferrer"">evaporate</a> to upload stuff to s3, and there's a lot of files to be uploaded. I really want this process to be seamless to the user. There's one problem though. Google Chrome has <a href=""https://www.chromestatus.com/feature/6172836527865856"" rel=""nofollow noreferrer"">Throttle expensive background timers feature</a> that drastically decreases the performance of the process.</p>

<p>I had a few ideas on how to handle this issue:</p>

<ul>
<li>Ask the user to disable throttling for the tab. But I haven't found a way to do that for a specific tab and in some kind of <a href=""https://developer.android.com/guide/topics/permissions/overview"" rel=""nofollow noreferrer"">Mobile permissions</a> style. All you can do as a developer is show user a guide on how to do that by going to <code>chrome://flags/#expensive-background-timer-throttling</code> page and manually change the flag.</li>
<li>Playing a video/audio on the page is turning the throttling off according to the <a href=""https://developers.google.com/web/updates/2017/03/background_tabs"" rel=""nofollow noreferrer"">documentation</a>. Seems hacky though :-\</li>
</ul>

<p>I'd be glad to hear any advice on how to resolve this situation. Maybe somebody already faced the same problem and have some experience with it?</p>
","1436209","","","","","2019-09-12 12:25:50","Upload in chrome background tab","<google-chrome><background-process><evaporate.js>","1","0","","","","57858708","108432","108432","evaporate.js","13","27157574","27157573"
"59884315","1","","","2020-01-23 17:38:41","","0","11","<p>In our case, <code>aws_key</code> is only valid for 1 hour, so I am trying to understand how to handle the situation when the upload process has been started with <a href=""https://github.com/TTLabs/EvaporateJS/wiki/Evaporate.prototype.add()"" rel=""nofollow noreferrer"">Evaporate#add</a> using one accessKey, but URL was signed with a different key.</p>

<p>Our <code>signerUrl</code> response is an object:</p>

<pre><code>interface SingUrlResponse
{
    url: string;
    credentials: S3CredentialsREST;
}
</code></pre>

<p>According to the documentation, I am processing <code>signerUrl</code> response with custom <code>signResponseHandler</code>:</p>

<pre><code>signResponseHandler: async (response: string) =&gt;
{
    const signUrlResp: SingUrlResponse = JSON.parse(response);
    const awsCredentials = new S3Credentials(signUrlResp.credentials);
    if (this.awsCredentials.awsKey !== awsCredentials.awsKey)
    ....
}
</code></pre>

<p>The question is what are my options in case the last if-condition is <code>true</code>?
I've checked evaporate source code and at this point, it's not possible to change file upload configuration.</p>
","1436209","","","","","2020-01-23 17:38:41","Evaporate js: handle aws key expiration","<javascript><amazon-s3><evaporate.js>","0","0","","","","59884315","108432","108432","evaporate.js","13","27157574","27157573"
"40703955","1","40772346","","2016-11-20 12:21:36","","0","453","<p>The only way I've found to update a record in Vapor is this:</p>

<pre><code>drop.get(""update"") { request in

  guard var first = try Acronym.query().first(),
    let long = request.data[""long""]?.string else {
    throw Abort.badRequest
  }
  first.long = long
  try first.save()
  return first

}
</code></pre>

<p>However it's not a very RESTful way of doing it since it's performing a GET request with a parameter instead of a PUT request.</p>

<p>How does one perform a PUT request in Vapor?</p>
","5572258","","","","","2016-11-23 19:05:09","How to handle PUT HTTP request in Vapor?","<swift><macos><rest><vapor>","2","0","","","","40703955","118712","118712","vapor","592","36204589","36204588"
"40728145","1","","","2016-11-21 19:47:11","","1","320","<p>I'm trying to create a custom password validator in Vapor.
I can't seem to figure out how to make the Matches work. </p>
","4657761","","737105","","2016-12-14 16:21:53","2016-12-14 16:22:47","vapor swift custom validator","<swift><validation><passwords><vapor>","1","2","","","","40728145","118712","118712","vapor","592","36204589","36204588"
"40728827","1","40775728","","2016-11-21 20:32:16","","0","1875","<p>I'm using vapor to host images for my app.I have the following code to recieve the image and print it.</p>

<pre><code>drop.post(""saveArt"") { request in
if let contentType = request.headers[""Content-Type""], contentType.contains(""image/png""), let bytes = request.body.bytes {
    let image = NSImage(data: Data(bytes))
    print(image)
    return JSON([""Testawesome"":""awesome123""])
}
return JSON([""test"":""123""])
}
</code></pre>

<p>How can I send a multipart request using just swift?.Here is the current post request code i'm using.</p>

<pre><code> let tiffData = imagetosend?.tiffRepresentation
 let imageRep = NSBitmapImageRep(data: tiffData!)
 let image_data = imageRep?.representation(using: .JPEG, properties: [:])
 print(""Hi"")

 let url = NSURL(string: ""http://localhost:8080/getArt"")

let request = NSMutableURLRequest(url: url! as URL)
request.httpMethod = ""POST""


//define the multipart request type

request.setValue(""multipart/form-data"", forHTTPHeaderField: ""Content-Type"")


let body = NSMutableData()

let mimetype = ""image/png""

//define the data post parameter




body.append(""Content-Type: \(mimetype)\r\n\r\n"".data(using: String.Encoding.utf8)!)
body.append(image_data!)
body.append(""\r\n"".data(using: String.Encoding.utf8)!)


request.httpBody = body as Data



let session = URLSession.shared


let task = session.dataTask(with: request as URLRequest) {
    (
    data, response, error) in

    guard let _:NSData = data as NSData?, let _:URLResponse = response  , error == nil else {
        print(error?.localizedDescription)
        return
    }

    let dataString = NSString(data: data!, encoding: String.Encoding.utf8.rawValue)
    print(dataString)

}

task.resume()
</code></pre>
","6951854","","","","","2016-11-23 23:18:20","Swift 3 How To Send A Multipart Post Request With Vapor","<swift><xcode><post><vapor>","1","3","","","","40728827","118712","118712","vapor","592","36204589","36204588"
"40750092","1","40750313","","2016-11-22 19:28:15","","3","1396","<p>Is there a possibility of scheduling tasks on a server-side Swift framework, preferably Kitura?</p>

<p>I need to schedule tasks; for example, wiping a database everyday at 3AM.</p>
","2983361","","3701320","","2016-11-23 02:41:12","2017-10-26 19:30:41","Scheduled tasks in Server-Side Swift (Kitura, Vapor, Zewo, etc.)","<swift><vapor><kitura>","3","0","1","","","40750092","118712","118712","vapor","592","36204589","36204588"
"40769280","1","","","2016-11-23 16:12:51","","0","276","<p>Is there some commands to reload your current schema on your Heroku PostgreSQL databse ? </p>

<p><strong><em>vapor run prepare</em></strong> work fine locally, but i didn't find a way to do that on Heroku</p>
","7200951","","","","","2016-12-15 10:17:27","Vapor & Heroku : How to","<heroku><vapor>","2","0","","","","40769280","118712","118712","vapor","592","36204589","36204588"
"40779046","1","","","2016-11-24 06:02:54","","-2","121","<p>Let's say I need to query the distance between two classes in vapor.Here is what I mean</p>

<pre><code>let distanceBetweenLocations = 5
let CloseLocations = try Locations.query().filter(""lat"", .distance , .isLessThan , 4)
</code></pre>

<p>Something like that</p>
","7203573","","","","","2016-11-24 21:24:34","Vapor Querying Classes By Distance","<swift><xcode><server><vapor>","1","1","","","","40779046","118712","118712","vapor","592","36204589","36204588"
"40789556","1","","","2016-11-24 15:02:35","","0","412","<p>My configuration Swift 3, Vapor framework for server and Xcode 8.1   </p>

<p>I am trying to read the contents of my firebase db by making a call to Firebase using an access_token received from Oauth 2.0, but I get <code>error 301 Moved Permanently</code>. What is the correct path to use in the uri of the GET request?
I suppose here is my mistake.</p>

<pre><code>drop.get(""it"") { request in
 var accesstoken = ""ya2Qdkg.... and so on""
  let responseFirebase = try drop.client.get(""https://fir-34c2e.firebaseio.com/data/Users"",
 headers: [""Authorization"":""Authorization: Bearer \(accesstoken)""], 
      query: [:])

   print(""FirebaseResponse_is \(responseFirebase)"")
     return ""success""
}
</code></pre>

<p><a href=""https://i.stack.imgur.com/B0bb0.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/B0bb0.png"" alt=""enter image description here""></a></p>
","5918849","","5918849","","2016-11-24 17:58:25","2016-11-24 17:58:25","Read Firebase Database via HTTPS REST with error: 301 Moved Permanently","<rest><firebase-realtime-database><firebase-authentication><vapor>","0","2","","","","40789556","118712","118712","vapor","592","36204589","36204588"
"40807228","1","","","2016-11-25 14:31:47","","1","302","<p>I'm trying to create a <code>Model</code> with Vapor, and in the <code>prepare</code> method, I can't seem to figure out how to add some data types into the statement. </p>

<p>Looking into the Vapor source code, there seems to be some data types that can be stored:</p>

<pre><code>extension Schema {
    /**
        Various types of fields
        that can be used in a Schema.
    */
    public struct Field {
        public var name: String
        public var type: DataType
        public var optional: Bool

        public enum DataType {
            case id
            case int
            case string(length: Int?)
            case double
            case bool
            case data
        }

        public init(name: String, type: DataType, optional: Bool = false) {
            self.name = name
            self.type = type
            self.optional = optional
        }
    }
}
</code></pre>

<p>So Data Types like Int, String (<code>VARCHAR</code>), Double, Bool and Data (<code>BLOB</code>) can be stored, but I can't find the ones I'm looking for, specifically:</p>

<ul>
<li>Unsigned <code>SMALLINT</code> (<code>UInt16</code>)</li>
<li><code>DATETIME</code></li>
<li><code>DECIMAL</code> (<a href=""https://dev.mysql.com/doc/refman/5.7/en/precision-math-decimal-characteristics.html"" rel=""nofollow noreferrer"">The MySQL Decimal</a>, NOT Double or Float)</li>
</ul>

<p>How would I make these?</p>
","5572258","","","","","2016-11-25 14:57:53","Additional Data types (such as Unsigned SmallInt, Datetime and Decimal) in Swift Vapor/Fluent Model?","<mysql><swift><vapor>","1","0","","","","40807228","118712","118712","vapor","592","36204589","36204588"
"40810233","1","40831536","","2016-11-25 17:47:56","","14","9660","<p>Swift + Vapor framework for server + Xcode 8.1</p>

<p>I am trying to read Firebase Realtime Database making HTTP requests to my DB, but I get permission denied. </p>

<p>These are the steps:<br>
1. create JWT sign it with secret key downloaded from ""console.developers.google.com""<br>
2. send POST request to OAuth2 server and get access token<br>
3. send GET request to firebase database with access token received from OAuth2 server.  </p>

<p>I get ""Permission denied"", HTTP/1.1 403 Forbidden</p>

<pre><code>// the header of the JSON Web Token (first part of the JWT)
let headerJWT = [""alg"":""RS256"",""typ"":""JWT""]

// the claim set of the JSON Web Token
let jwtClaimSet =
  [""iss"":""firebase-adminsdk-kxx5h@fir-30c9e.iam.gserviceaccount.com"",
 ""scope"":""https://www.googleapis.com/auth/firebase.database"", //is this the correct API to access firebase database?
 ""aud"":""https://www.googleapis.com/oauth2/v4/token"",
 ""exp"": expDate,
 ""iat"": iatDate]


drop.get(""access"") { request in
var accesstoken = ""ya29.ElqhA-....XXXX""

 let responseFirebase = try drop.client.get(""https://fir- 30c9e.firebaseio.com/data/Users.json"",
  headers: [""Authorization"":""Bearer \(accesstoken)""], 
     query: [:])

print(""FirebaseResponse_is \(responseFirebase)"")
return ""success""
}
</code></pre>

<p><a href=""https://i.stack.imgur.com/kQdsL.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/kQdsL.png"" alt=""Firebase Service Account""></a>
<a href=""https://i.stack.imgur.com/vSc6o.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/vSc6o.png"" alt=""FireBase Database Rulles""></a></p>
","5918849","","5918849","","2016-11-26 18:29:31","2016-11-27 17:18:16","Can't access FireBase Database via HTTP/REST error 403 Forbidden","<firebase><firebase-realtime-database><service-accounts><vapor>","3","1","6","","","40810233","118712","118712","vapor","592","36204589","36204588"
"40823330","1","","","2016-11-26 21:26:13","","1","119","<p>This code uses 99-100% CPU:</p>

<pre><code>drop.post(""upload"") { request in
    guard let file = request.multipart?[""zip""]?.file, let name = file.name else {
        throw Abort.badRequest
    }

    try Data(bytes: file.data).write(to: URL(fileURLWithPath: ""/tmp/\(name)""))
    return ""OK""
}
</code></pre>

<p>How to optimize this task?</p>
","1568239","","","","","2016-12-20 02:02:15","High CPU utilization when uploading a file","<vapor>","1","2","","","","40823330","118712","118712","vapor","592","36204589","36204588"
"40825433","1","","","2016-11-27 03:14:55","","2","176","<p>Using <a href=""http://vapor.codes"" rel=""nofollow noreferrer"">Vapor</a> I want to store a relationship to children. I haven't been able to find any examples of what the class should look like and I'm just guessing on what to do. Can anyone provide an example of a class that has a relationship to a list of other <code>Model</code> objects?</p>

<pre><code>import Vapor
import Fluent
import Foundation

final class Store: Model {

    // MARK: - Model
    var id: Node?
    var exists: Bool = false
    var locationIDs: [Node] = [] // No idea if this is right

    var name: String

    init(name: String, locationIDs: [Node] = []) {
        self.id = nil
        self.name = name
        self.locationIDs = locationIDs
    }

    init(node: Node, in context: Context) throws {
        id = try node.extract(""id"")
        name = try node.extract(""name"")
//      ???
    }

    func makeNode(context: Context) throws -&gt; Node {
        return try Node(node: [
            ""id"": id,
            ""name"": name
//          ???
        ])
    }

    static func prepare(_ database: Database) throws {
        try database.create( ""stores"" ) { creator in
            creator.id()
            creator.string(""name"")
//            creator.id("""", optional: false) // ???
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(""stores"")
    }

}
</code></pre>
","996110","","","","","2019-06-25 21:05:21","What does a `Model` class look like that has a relation?","<swift><postgresql><fluent><vapor>","1","2","","","","40825433","118712","118712","vapor","592","36204589","36204588"
"40826991","1","40829279","","2016-11-27 08:14:55","","0","503","<p>I want to do this <code>SELECT COUNT(column_name) FROM table_name;</code> to get back an Int and return it as part of a response. I don't want to have to load every object into memory just to get the count; like this: <code>User.query().all().count</code></p>

<p>Please tell me this is possible with Fluent! :)</p>
","996110","","","","","2016-11-27 13:04:33","Can I use straight SQL to get the number of rows in a table using Fluent (Vapor)?","<swift><postgresql><fluent><vapor>","1","0","","","","40826991","118712","118712","vapor","592","36204589","36204588"
"40829187","1","40834357","","2016-11-27 12:55:47","","2","202","<p>I try to use Vapor <strong>AuthMiddleware</strong> for two entities: <strong>Customer</strong> and <strong>Merchant</strong></p>

<p><a href=""https://vapor.github.io/documentation/auth/request.html"" rel=""nofollow noreferrer"">https://vapor.github.io/documentation/auth/request.html</a></p>

<pre><code>let auth = AuthMiddleware(user: Customer.self) { value in
                return Cookie(
                    name: ""vapor-auth"",
                    value: value,
                    expires: Date().addingTimeInterval(60 * 60 * 5),
                    secure: true,
                    httpOnly: true
                )
            }
</code></pre>

<p>But as I see, the first added middleware (Customer) was replaced by second (Merchant) if they added by:</p>

<pre><code>drop?.middleware.append(auth)
</code></pre>

<p>or</p>

<pre><code>drop?.addConfigurable(middleware: auth, name: ""auth"")
</code></pre>

<p>So if I try to log in by credentials from request: </p>

<pre><code>guard let login = req.data[""login""]?.string,
    let password = req.data[""password""]?.string else {
        throw Abort.badRequest
}
let credentials = APIKey(id: login, secret: password)
try req.auth.login(credentials)
</code></pre>

<p>I have an error:</p>

<pre><code>▿ Abort
▿ custom : 2 elements
    - .0 : HTTP.Status.badRequest
    - .1 : ""Invalid credentials.""
</code></pre>

<p>But it throws only for the firstly added entity, which AuthMiddleware was replaced by other AuthMiddleware...</p>

<p>Please, let me know if it is possible to solve this problem. 
Thanks!</p>
","6726766","","","","","2016-11-27 21:53:02","How to use AuthMiddleware for more than one entity?","<swift><authentication><middleware><vapor>","1","0","0","","","40829187","118712","118712","vapor","592","36204589","36204588"
"40838920","1","40838938","","2016-11-28 07:13:52","","1","163","<p>How can I set a limit and an offset on a Query using Vapor's <code>Fluent</code>?</p>
","996110","","","","","2016-11-28 07:15:50","How can I set the limit on a Fluent Query?","<swift><fluent><vapor>","1","0","","","","40838920","118712","118712","vapor","592","36204589","36204588"
"40843100","1","","","2016-11-28 11:21:40","","1","219","<p>I have a question regarding the Leaf template engine.</p>

<p>How can I access the Session values in the Leaf Template?
For instance to loop through Flash messages like in Laravel: <a href=""https://laravel.com/docs/5.3/redirects#redirecting-with-flashed-session-data"" rel=""nofollow noreferrer"">https://laravel.com/docs/5.3/redirects#redirecting-with-flashed-session-data</a></p>

<p>I can't find a solution to accomplish this.</p>

<p>Thanks in advance</p>
","4707978","","5236226","","2017-03-20 16:08:29","2017-03-20 16:08:29","Access Session in Leaf template","<vapor><leaf>","1","0","","","","40843100","118712","118712","vapor","592","36204589","36204588"
"40860942","1","","","2016-11-29 08:24:03","","3","393","<p>I have a <code>Stall</code> <code>Resource</code> in a way that I have a <code>StallController</code> that inherits <code>ResourceRepresentable</code>. </p>

<p>I can perform <code>/stalls/</code> to get all <code>Stall</code>s, <code>/stalls/1</code> to get <code>Stall</code> of ID 1, but I want to add a route in such a way that if I do <code>/stalls/1/products</code> I can get all products under <code>Stall</code> of ID 1. </p>

<p>How would I add routes to a <code>Resource</code>?</p>
","5572258","","","","","2016-12-03 14:49:21","Add routes to resources in Vapor, Swift?","<swift><rest><vapor>","1","0","","","","40860942","118712","118712","vapor","592","36204589","36204588"
"40893144","1","40893222","","2016-11-30 16:17:53","","2","125","<p>I am working on a very simple Vapor app. I am currently working on one of the views:</p>

<pre><code>#extend(""base"")

#export(""body"") {
    &lt;form&gt;
        &lt;div class=""row""&gt;
                &lt;div class=""six columns""&gt;
                    &lt;label for=""exampleEmailInput""&gt;Acronym&lt;/label&gt;
                    &lt;input class=""u-full-width"" type=""email"" id=""short""&gt;
                    &lt;/div&gt;
                &lt;div class=""six columns""&gt;
                    &lt;label for=""exampleRecipientInput""&gt;Long form&lt;/label&gt;
                    &lt;input class=""u-full-width"" type=""email"" id=""long""&gt;
                &lt;/div&gt;
        &lt;/div&gt;
    &lt;/form&gt;
    &lt;div class=""row""&gt;
        &lt;div class=""five columns""&gt;&lt;/div&gt;
            &lt;div class=""two columns""&gt;
                &lt;a class=""button button-primary"" id=""submit"" href=""/acronym/all""&gt;Save Acronym&lt;/a&gt;
            &lt;/div&gt;
        &lt;div class=""five columns""&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;script&gt;
        function setHref() {
            var short = $(""#short"").val();
        }
    &lt;/script&gt;
}
</code></pre>

<p>This code works until I add the <code>short</code> variable to the <code>setHref</code> function. Then I get a parsing error:</p>

<pre><code>Uncaught Error: ParseError.tagTemplateNotFound(""short\"").val""). Use middleware to catch this error and provide a better response. Otherwise, a 500 error page will be returned in the production environment.
</code></pre>

<p>Why is this happening?</p>
","5236226","","5236226","","2016-11-30 16:27:49","2016-11-30 16:27:49","ParseError.tagTemplateNotFound(""short\"").val"")","<javascript><jquery><html><vapor><leaf>","1","0","","","","40893144","118712","118712","vapor","592","36204589","36204588"
"40963488","1","","","2016-12-04 20:51:10","","2","91","<p>Using Vapor and Fluent (PostgreSQL if that matters) I have entity <code>B</code> that has <code>aID: Node</code> (A is B's parent) to reference <code>A</code> and <code>A</code> has a one-to-many relationship with <code>B</code>. How can I make a query to fetch all <code>A</code>'s sorted by the count of <code>B</code>'s?</p>

<p>I want the result to look something like this:</p>

<p><code>All A's in DB</code></p>

<pre><code>[
  {
    ""id"": 4,
    ""name"": ""Hi"",
    ""bCount"": 1000
  },
  {
    ""id"": 3,
    ""name"": ""Another"",
    ""bCount"": 800
  },
  {
    ""id"": 5,
    ""name"": ""Test"",
    ""bCount"": 30
  }
]
</code></pre>
","996110","","","","","2016-12-26 21:05:48","How can I sort based on children?","<database><postgresql><sorting><fluent><vapor>","2","0","","","","40963488","118712","118712","vapor","592","36204589","36204588"
"40988638","1","40988721","","2016-12-06 05:48:48","","1","108","<p>I am using <a href=""https://vapor.github.io/documentation/getting-started/hello-world.html"" rel=""nofollow noreferrer"">Vapor</a> and one of the first thing is to use get method which looks like following:</p>

<pre><code>drop.get(""hello"") { request in
    return ""Hello, world!""
}
</code></pre>

<p>Now my understanding was that the closures are like variable of type functions. Correct? Here I see we call a method <code>get</code> on an instance of <code>Droplet</code> class called drop and pass in a string. </p>

<p>What is with the closure being called/passed inside the get method body? How do I read this?</p>
","1099142","","1187415","","2016-12-06 06:18:17","2016-12-06 06:33:44","How do I read this Swift syntax?","<swift><vapor>","1","0","","2016-12-06 22:20:22","","40988638","118712","118712","vapor","592","36204589","36204588"
"40998552","1","40998840","","2016-12-06 15:08:31","","1","626","<p>I am making a post request to a server with an HTML form. When I press the submit button for the form I get a 404 page does not exist error. However, if I go to the URL through directly typing in the address bar, I get the error I should be getting from the server (400 invalid request).</p>

<p>Here is my HTML (note I am using leaf):</p>

<pre><code>#extend(""base"")

#export(""head"") {
    &lt;link rel=""stylesheet"" href=""/styles/normalize.css""&gt;
    &lt;link rel=""stylesheet"" href=""/styles/skeleton.css""&gt;
}

#export(""body"") {
    &lt;div class=""container""&gt;
        &lt;form action=""/admin/new-post"" method=""POST""&gt;
            &lt;div class=""row"" style=""padding: 25px 0 0 0;""&gt;
                &lt;div class=""six columns form-group""&gt;
                    &lt;label for=""email""&gt;Usernam&lt;/label&gt;
                    &lt;input class=""u-full-width"" type=""text"" placeholder=""Username"" id=""email"" name=""email""&gt;
                &lt;/div&gt;
                &lt;div class=""six columns form-group""&gt;
                    &lt;label for=""password""&gt;Password&lt;/label&gt;
                    &lt;input class=""u-full-width"" type=""password"" placeholder=""Password"" id=""password"" anem=""password""&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;input type=""hidden"" name=""_csrf"" value=""{{csrfToken}}""&gt;
            &lt;button type=""submit"" class=""button-primary""&gt;Login&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
}
</code></pre>

<p>And my server code (Swift):</p>

<pre><code>import Vapor
import HTTP

final class AdminController {

    func addRoutes(to drop: Droplet) {
        let admin = drop.grouped(""admin"")
        drop.get(""login"", handler: login)
        admin.get(""new-post"", handler: newPost)
    }

    func login(_ request: Request)throws -&gt; ResponseRepresentable {
        return try drop.view.make(""admin-login"", [])
    }

    func newPost(_ request: Request)throws -&gt; ResponseRepresentable {
        guard let cred = request.auth.header?.basic else {
            throw Abort.badRequest
        }
        do {
            try request.auth.login(cred)
            return try drop.view.make(""new-post"", [])
        } catch {
            return Response(redirect: ""/login?login=failed"")
        }
    }
}
</code></pre>

<p>Why am I getting a 404 error?</p>

<p>The web framework I am using is Vapor.</p>
","5236226","","","","","2016-12-06 15:22:13","Getting a 404 error when the page exists","<html><swift><post><http-status-code-404><vapor>","1","0","","","","40998552","118712","118712","vapor","592","36204589","36204588"
"41018174","1","41028837","","2016-12-07 13:00:23","","1","337","<p>How to decide what to put for <code>majorVersion</code> and <code>minor</code> in below code.
I was trying to use sqlite3 with vapor and got stuck here.</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""Hello"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 1)
        ,.Package(url: ""https://github.com/vapor/sqlite-driver.git"", majorVersion: 1, minor: 0)
        ,.Package(url: ""https://github.com/vapor/sqlite-provider.git"", majorVersion: 1, minor: 1)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
        ""Tests"",
    ]
)
</code></pre>

<p>I am getting error as below when I do <code>vapor build</code> - </p>

<blockquote>
  <p>Fetching Dependencies [Failed] Check your dependencies' Package.swift
  files to see where the conflict is. Error: swift-package: error: The
  dependency graph could not be satisfied. The package
  (<a href=""https://github.com/vapor/sqlite-driver.git"" rel=""nofollow noreferrer"">https://github.com/vapor/sqlite-driver.git</a>) with version tag in range
  (1.1.0..&lt;1.1.9223372036854775807) is not found. Found tags ([0.0.0,
  0.1.0, 0.1.1, 0.2.0, 0.3.0, 0.3.1, 0.3.2, 0.4.0, 0.4.1, 0.5.0, 0.6.0, 0.7.0, 1.0.0, 1.0.1])</p>
</blockquote>
","6536841","","","","","2016-12-07 22:53:31","majorVersion and minor in describing dependency package in Vapor","<swift><git><sqlite><server-side><vapor>","1","1","","","","41018174","118712","118712","vapor","592","36204589","36204588"
"41019524","1","41032419","","2016-12-07 14:07:14","","1","239","<p>Following steps from <a href=""https://vapor.github.io/documentation/getting-started/install-toolbox.html"" rel=""nofollow noreferrer"">https://vapor.github.io/documentation/getting-started/install-toolbox.html</a> are leaded to this error: </p>

<p><code>$ curl -sL toolbox.vapor.sh | bash</code></p>

<blockquote>
  <p>/swift-3.0/usr/bin/swift-build: error while loading shared libraries: libFoundation.so: cannot enable executable stack as shared object requires: Invalid argument</p>
</blockquote>

<p>Any ideas?</p>
","6019988","","284120","","2016-12-08 05:34:07","2016-12-08 05:34:07","Errors in Vapor setup on Ubuntu 14.04 (Windows)","<swift><bash><ubuntu><windows-subsystem-for-linux><vapor>","1","2","","","","41019524","118712","118712","vapor","592","36204589","36204588"
"41033634","1","41033709","","2016-12-08 07:02:22","","0","78","<p>My <code>Package.swift</code> looks like this - </p>

<pre><code>import PackageDescription

let package = Package(
    name: ""Hello"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 2),
        .Package(url: ""https://github.com/vapor/sqlite-provider.git"", majorVersion: 1, minor: 1)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
        ""Tests"",
        ]
)
</code></pre>

<p>And my <code>main.swift</code> looks like this -</p>

<pre><code>import Vapor

let drop = Droplet()

drop.get(""/version"") { request in
    do{
        let version = try drop.database?.driver.raw(""SELECT sqlite_version()"")
        return try JSON(node: version)
    } catch {
        return ""Sorry""
    }
}

drop.resource(""posts"", PostController())
drop.run()
</code></pre>

<p>And my sqlite.json looks like this -</p>

<pre><code>{
""path"": ""/Users/nikhil.manapure/Desktop/Helo/newDB""
}
</code></pre>

<p>And my error looks like -</p>

<p><a href=""https://i.stack.imgur.com/Hwfcp.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Hwfcp.png"" alt=""enter image description here""></a></p>

<p>Please help me with using sqlite3 with Vapor.</p>
","6536841","","","","","2016-12-08 07:07:19","Error: Could not build CSQLiteMac in Vapor","<swift><sqlite><server-side><vapor>","1","1","","","","41033634","118712","118712","vapor","592","36204589","36204588"
"41045887","1","41065442","","2016-12-08 17:58:45","","4","702","<p>I am trying to fix an error I have been getting recently when I run my Vapor project.</p>

<p>It builds fine, but when it runs, it crashes. Here is my log: </p>

<pre><code>fatal error: Error raised at top level: Fluent.EntityError.noDatabase: file /Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-800.0.58.6/src/swift/stdlib/public/core/ErrorType.swift, line 184
Current stack trace:
0    libswiftCore.dylib                 0x0000000100fe7cc0 swift_reportError + 132
1    libswiftCore.dylib                 0x0000000101004f50 _swift_stdlib_reportFatalErrorInFile + 112
2    libswiftCore.dylib                 0x0000000100fb3370 partial apply for (_assertionFailed(StaticString, String, StaticString, UInt, flags : UInt32) -&gt; Never).(closure #1).(closure #1).(closure #1) + 99
3    libswiftCore.dylib                 0x0000000100dfb0a0 specialized specialized StaticString.withUTF8Buffer&lt;A&gt; ((UnsafeBufferPointer&lt;UInt8&gt;) -&gt; A) -&gt; A + 355
4    libswiftCore.dylib                 0x0000000100fb32b0 partial apply for (_assertionFailed(StaticString, StaticString, StaticString, UInt, flags : UInt32) -&gt; Never).(closure #1).(closure #1) + 144
5    libswiftCore.dylib                 0x0000000100dfb5b0 specialized specialized String._withUnsafeBufferPointerToUTF8&lt;A&gt; ((UnsafeBufferPointer&lt;UInt8&gt;) throws -&gt; A) throws -&gt; A + 124
6    libswiftCore.dylib                 0x0000000100f57af0 partial apply for (_assertionFailed(StaticString, String, StaticString, UInt, flags : UInt32) -&gt; Never).(closure #1) + 185
7    libswiftCore.dylib                 0x0000000100dfb0a0 specialized specialized StaticString.withUTF8Buffer&lt;A&gt; ((UnsafeBufferPointer&lt;UInt8&gt;) -&gt; A) -&gt; A + 355
8    libswiftCore.dylib                 0x0000000100dfae80 _assertionFailed(StaticString, String, StaticString, UInt, flags : UInt32) -&gt; Never + 144
9    libswiftCore.dylib                 0x0000000100e1e540 swift_unexpectedError_merged + 569
10   App                                0x0000000100001ef0 main + 2798
11   libdyld.dylib                      0x00007fff974375ac start + 1
Program ended with exit code: 9
</code></pre>

<p>I am using the VaporPostgreSQL package. Here is my <code>Package.swift</code>:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""mist"",
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 2),
        .Package(url: ""https://github.com/vapor/postgresql-provider.git"", majorVersion: 1, minor: 1)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
        ""Tests"",
    ]
)
</code></pre>

<p>And <code>main.swift</code>:</p>

<pre><code>import Vapor
import VaporPostgreSQL
import Auth
import HTTP

let drop = Droplet()
let auth = AuthMiddleware(user: User.self)

try drop.addProvider(VaporPostgreSQL.Provider.self)
drop.preparations.append(Post.self)
drop.preparations.append(User.self)
drop.preparations.append(Site.self)
drop.middleware.append(auth)

let admin = AdminController()
var site = Site(name: """", theme: """")

if let retreivedSite = try Site.all().first {
    site = retreivedSite
} else {
    drop.get { req in
        return Response(redirect: ""http://localhost:8080/login"")
    }
}

drop.get { req in
    return try drop.view.make(""Themes/VaporDark/index"", [
        ""posts"": Node(node: JSON(Post.all().makeNode()))
    ])
}

admin.addRoutes(to: drop)

drop.resource(""posts"", PostController())

drop.run()
</code></pre>

<p>My postgres version is 9.6.1</p>

<p>For some reason VaporPostgreSQL won't update and I think that might be part of the problem. I have tried <code>vapor xcode</code>, <code>vapor build</code> and <code>vapor clean</code>, but I can't get the latest version.</p>

<p><a href=""https://i.stack.imgur.com/aJjcq.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aJjcq.png"" alt=""enter image description here""></a></p>
","5236226","","5236226","","2019-01-29 12:27:31","2019-01-29 12:27:31","Error raised at top level: Fluent.EntityError.noDatabase","<postgresql><vapor>","2","1","","","","41045887","118712","118712","vapor","592","36204589","36204588"
"41070762","1","41127406","","2016-12-10 00:11:23","","2","249","<p>My question is what difference in Vapor JSON function calls <code>return JSON([""foo"":""bar""])</code> vs <code>return try JSON(node: [""foo"":""bar""])</code>?</p>

<p>Both variants work, what is the right way?</p>

<p>Mixing them like <code>return JSON(node: [""foo"":""bar""])</code> or <code>return try JSON([""foo"":""bar""])</code> will make build fail.</p>

<pre><code>import Vapor

let drop = Droplet()

drop.get(""json"") { req in
  return JSON([""foo"": ""bar""])
}

drop.run()
</code></pre>
","2117550","","","","","2016-12-13 17:44:02","Swift Vapor framework difference in JSON function calls","<json><swift><function><swift3><vapor>","1","6","1","","","41070762","118712","118712","vapor","592","36204589","36204588"
"41167745","1","41167746","","2016-12-15 15:26:46","","1","877","<p><em>Disclaimer: this question originally asked on the Vapor help channel on Slack</em></p>

<p>Easy question: if I'm sending a response like this</p>

<pre><code>let response: ResponseRepresentable = try JSON(node: [""message"": ""User Created""])`
</code></pre>

<p>How can i set the status code for the response?</p>
","737105","","","","","2016-12-15 15:26:46","Vapor - How do I return a JSON response with a specific Status Code?","<json><api><httpresponse><vapor>","1","0","","","","41167745","118712","118712","vapor","592","36204589","36204588"
"41202457","1","41233777","","2016-12-17 19:48:58","","1","369","<p>I am looking into the Swift Vapor framework.</p>

<p>I am trying to create a controller class that maps data obtained on an SSL link to a third party system (an Asterisk PBX server..) into a response body that is sent over some time down to the client.</p>

<p>So I need to send received text lines (obtained separately on the SSL connection) as they get in, without waiting for a 'complete response' to be constructed.</p>

<p>Seeing this example:</p>

<pre><code>return Response(status: .ok) { chunker in
  for name in [""joe\n"", ""pam\n"", ""cheryl\n""] {
      sleep(1)
      try chunker.send(name)
  }

  try chunker.close()
}
</code></pre>

<p>I thought it might be the way to go.</p>

<p>But what I see connecting to the Vapor server is that the REST call waits for the loop to complete, before the three lines are received as result.</p>

<p>How can I obtain to have try chunker.send(name) send it's characters back the client without first waiting for the loop to complete?</p>

<p>In the real code the controller method can potentially keep an HTTP connection to the client open for a long time, sending Asterisk activity data to the client as soon as it is obtained. So each .send(name) should actually pass immediately data to the client, not waiting for the final .close() call.</p>

<p>Adding a try chunker.flush() did not produce any better result..</p>
","1489155","","","","","2016-12-20 01:54:42","How to produce a response body with asynchronously created body chunks in Swift Vapor","<swift><server><vapor><http-chunked>","1","0","","","","41202457","118712","118712","vapor","592","36204589","36204588"
"41203054","1","41233805","","2016-12-17 21:04:57","","3","80","<p>Is it possible, using swift, to verify <code>data: Data</code> is image using <code>Foundation.framework</code> only? </p>

<p>Nothing else from macOS or iOS is available as this is for Server side project only (Vapor)</p>
","182551","","182551","","2016-12-21 10:16:03","2016-12-21 10:16:03","Can I verify Data if image using foundation framework only","<swift><vapor>","1","1","1","","","41203054","118712","118712","vapor","592","36204589","36204588"
"41245368","1","","","2016-12-20 15:04:54","","5","655","<p>I'm trying to connect to my Heroku PostgreSQL database but I have the following error : </p>

<pre><code>cannotEstablishConnection(""FATAL:  no pg_hba.conf entry for host \""37.167.93.189\"", user \""clpnkpyttmdtyq\"", database \""d3h6147v73mgtu\"", SSL off\n"")
</code></pre>

<p>I know that Heroku postgres databases need to use an SSL connection but I don't know how to configure the connection on my <code>Droplet</code> object.</p>

<p>This is my <code>postgresql.json</code> configuration file :</p>

<pre><code>{
    ""host"": ""ec2-54-163-224-108.compute-1.amazonaws.com"",
    ""user"": ""clpnkpyttmdtyq"",
    ""password"": ""99201aa07c48e18e7bdf210937857b85bee37cd8d8cb904381b1ddff934c7a4f"",
    ""database"": ""d3h6147v73mgtu"",
    ""port"": 5432
}
</code></pre>

<p>Maybe there is <code>ssl</code> parameter that I don't know ? </p>

<p>How I add the <code>VaporPostgresSQLProvider</code> : </p>

<pre><code>let drop = Droplet()

// Tell the droplet to use our SQL provider service
try drop.addProvider(VaporPostgreSQL.Provider.self)
</code></pre>

<p>Any ideas ? </p>

<p>When I try with my local postgres database, it works, because it don't need ssl connection.</p>
","4733067","","","","","2019-12-31 23:07:06","Vapor Framework : Configure a postgres connection with SSL","<postgresql><ssl><heroku><vapor>","2","4","","","","41245368","118712","118712","vapor","592","36204589","36204588"
"41332945","1","41335976","","2016-12-26 14:56:03","","1","234","<p>I have the following project layout (contracted):</p>

<pre><code>project_root
└── Sources
    └── App
        ├── main.swift
        └── Models
            └── SQL
                └── createTables.sql
</code></pre>

<p>I'm trying to read the <code>createTables.sql</code> file at runtime but <code>FileManager.fileExists()</code> says it doesn't exist. I got the path by using <code>#file</code> in <code>main.swift</code>:</p>

<pre><code>let path = URL(fileURLWithPath: #file).deletingLastPathComponent().path + ""/Models/SQL/createTables.sql""
</code></pre>

<p>Printing out the path, it seems to be correct.
I'm guessing that the source tree is inaccessible because of Heroku's <a href=""https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem"" rel=""nofollow noreferrer"">ephemeral filesystem</a>. How can I get around this and read the file at runtime?</p>
","3425536","","","","","2016-12-26 20:26:32","Heroku: how to read file?","<swift><file><heroku><file-io><vapor>","1","0","","","","41332945","118712","118712","vapor","592","36204589","36204588"
"41348348","1","41352046","","2016-12-27 16:04:07","","2","124","<p>I am looking to reuase some (iOS) client side code into a sample Vapor serverside project.</p>

<p>The code in question relies on SwiftyJSON functionality, defined as a struct JSON; now this name slot is not 'free', but already used inside a package that Vapor relies upon (the package name is JSON, as well).</p>

<p>While I can point to the JSON thing I want in my former client side code (as App.JSON), the controller that is boilerplated into the code also uses JSON. And apparently putting as I did the SwiftyJSON library files into the App namespace actually overrides the moduleless references to Vapor's JSON.</p>

<p>I tried to refer then to JSON.JSON, but it does not get recognized. JSON is a defined and compiled framework in the project. Should it not define implicitely a module name, as well?</p>

<p>How can I reach Vapor's JSON, then?</p>

<p>Thanks..</p>
","1489155","","","","","2016-12-27 20:48:33","Swift Vapor and modules; how to distinguish two overlapping 'type symbols'","<swift><module><namespaces><vapor>","1","0","","","","41348348","118712","118712","vapor","592","36204589","36204588"
"41460895","1","41462585","","2017-01-04 09:56:20","","9","1899","<p>In the Vapor framework for server side swift, I would like to respond to a request with info I got from third party API. For example, I receive a get request asking for the temperature of a city, and I want to connect to yahoo whether API to get the temperature then send it back. Do I need to download packages like Alamofire? Or Is there a built in way to do so in Vapor?</p>
","7373500","","7373500","","2017-01-04 10:11:38","2017-01-04 11:21:12","How to make requests to connect to third party APIs in Vapor?","<swift3><vapor>","1","3","1","","","41460895","118712","118712","vapor","592","36204589","36204588"
"41469649","1","41551631","","2017-01-04 17:16:14","","3","810","<p>I am trying to revert a PostgreSQL database with with the Vapor command:</p>

<pre class=""lang-shell prettyprint-override""><code>vapor run prepare --revert -y
</code></pre>

<p>I get this out put:</p>

<pre class=""lang-shell prettyprint-override""><code>Running mist...
Are you sure you want to revert the database?
y/n&gt;yes
Reverting Post
Reverted Post
Removing metadata
Reversion complete
</code></pre>

<p>In case you are wondering, I have tried doing this multiple times, so the <code>Post</code> class gets prepared, but the others don't.</p>

<p>This command reverts that tables for all the models, except one (There are four total).</p>

<p>For some reason the 'pages' table will not revert.</p>

<p>And when I try running the app after reverting the database, I get this error:</p>

<pre><code>invalidSQL(""ERROR:  relation \""pages\"" already exists\n"")
</code></pre>

<p>Here is the database preparation code for the model:</p>

<pre class=""lang-swift prettyprint-override""><code>extension Page: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(""pages"", closure: { post in
            post.id()
            post.string(""content"", length: 10000)
            post.string(""name"")
            post.string(""link"")
        })
    }

    static func revert(_ database: Database) throws {
        try database.delete(""pages"")
    }
}
</code></pre>
","5236226","","5236226","","2017-01-05 17:02:11","2017-01-09 15:44:32","Vapor PostgreSQL Error: invalidSQL(""ERROR: relation \""pages\"" already exists\n"")","<swift><postgresql><revert><vapor>","1","1","","","","41469649","118712","118712","vapor","592","36204589","36204588"
"41471544","1","41515849","","2017-01-04 19:11:49","","3","629","<p>I have built a MySQL database with multiple tables and complex relationships, but when I go through the vapor documentation, specifically, in the building the model phase, there is a method for creating the table (that my model class will interact with).</p>

<pre><code>static func prepare(_ database: Database) throws {
    try database.create(""users"") { users in
        users.id()
        users.string(""name"")
    }
}
</code></pre>

<p>However, I don't want to use it because the table that I already have contain foreign keys and types like DATETIME (which I don't know how to declare within the swift context.) is there a way to link my already built tables with vapor?</p>
","7373500","","","","","2017-03-13 09:33:48","how to build a vapor app from an already existing database?","<swift3><vapor>","2","0","","","","41471544","118712","118712","vapor","592","36204589","36204588"
"41513191","1","41540434","","2017-01-06 19:45:43","","1","727","<p>I have created a very simple app with one route in <code>main.swift</code>. It reads a city from a query string and use it to get the weather (through the yahoo API) of that city. this is the route:</p>

<pre><code>drop.get(""whether"") { request in


    guard let city = request.data[""city""]?.string else {
        return try JSON(node: [""Error"": ""no city given""])
    }

    return try drop.client.get(""https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22\(city)%22)&amp;format=json&amp;env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys"")
}
</code></pre>

<p>The code works perfectly when I run it on localhost, but I get a 500 error when I deploy it with Heroku.</p>

<p>Is there  any file that I shouldn't be pushing to heroku? I want to note that in <code>server.json</code> the host value is <code>0.0.0.0</code>.</p>

<p>This is my Heroku logs (note that I redeployed it multiple times. all of which didn't work):</p>

<pre><code>2017-01-05T17:00:28.932559+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=10bd5717-a444-4106-9479-5dda7de686d1 fwd=""94.77.202.2"" dyno=web.1 connect=1ms service=24ms status=500 bytes=138
2017-01-05T17:00:34.568980+00:00 heroku[router]: at=info method=GET path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=88277ee9-5814-4e33-a180-69e2a36a10ac fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=2ms status=404 bytes=161
2017-01-05T17:00:50.620499+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=e9e03939-3252-4eb2-ba05-ed06b7123fc0 fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=20ms status=500 bytes=138
2017-01-05T17:03:30.089070+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=d3334e79-bdaf-4f51-a6fe-198a356c2c8a fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=31ms status=500 bytes=138
2017-01-05T17:03:41.773239+00:00 heroku[router]: at=error code=H13 desc=""Connection closed without response"" method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=cb0f1bca-7538-497b-b1f2-6af9756c80f4 fwd=""94.77.202.2"" dyno=web.1 connect=2ms service=6ms status=503 bytes=0
2017-01-05T17:03:41.855395+00:00 heroku[web.1]: State changed from up to crashed
2017-01-05T17:03:41.856485+00:00 heroku[web.1]: State changed from crashed to starting
2017-01-05T17:03:41.842156+00:00 heroku[web.1]: Process exited with status 132
2017-01-05T17:03:45.147623+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=25036`
2017-01-05T17:03:48.789403+00:00 heroku[web.1]: State changed from starting to up
2017-01-05T17:04:29.863680+00:00 heroku[router]: at=info method=GET path=""/"" host=dry-beyond-95031.herokuapp.com request_id=82133ef0-4539-4095-b3a9-e4d0c4bc709c fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=5ms status=404 bytes=119
2017-01-05T17:04:38.544040+00:00 heroku[router]: at=info method=GET path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=258ab0c8-df6e-4ad2-a220-cb27f854a1bd fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=2ms status=404 bytes=119
2017-01-05T17:05:43.705482+00:00 heroku[web.1]: Process exited with status 132
2017-01-05T17:05:43.718722+00:00 heroku[web.1]: State changed from up to crashed
2017-01-05T17:05:43.608207+00:00 heroku[router]: at=error code=H13 desc=""Connection closed without response"" method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=1a343b3b-963e-45b0-9795-1f83351b0100 fwd=""94.77.202.2"" dyno=web.1 connect=1ms service=6ms status=503 bytes=0
2017-01-05T17:08:54.112283+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=5fcfc4a8-d8da-4e45-b8d1-99a8c14c1529 fwd=""94.77.202.2"" dyno= connect= service= status=503 bytes=
2017-01-05T17:10:34.292205+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=75035a40-c1ca-4fc9-8cd1-10f73c5a4b84 fwd=""94.77.202.2"" dyno= connect= service= status=503 bytes=
2017-01-05T17:17:45.483824+00:00 heroku[slug-compiler]: Slug compilation started
2017-01-05T17:17:45.483833+00:00 heroku[slug-compiler]: Slug compilation finished
2017-01-05T17:17:45.350717+00:00 app[api]: Deploy c3d8250 by user naifdev@gmail.com
2017-01-05T17:17:45.350717+00:00 app[api]: Release v4 created by user naifdev@gmail.com
2017-01-05T17:17:45.706244+00:00 heroku[web.1]: State changed from crashed to starting
2017-01-05T17:17:48.678813+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=53088`
2017-01-05T17:17:52.352793+00:00 heroku[web.1]: State changed from starting to up
2017-01-05T17:18:25.670087+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=9cec4496-95c5-4157-8dea-002310af4eaf fwd=""94.77.202.2"" dyno=web.1 connect=1ms service=27ms status=500 bytes=138
2017-01-05T17:51:55.253360+00:00 heroku[web.1]: Idling
2017-01-05T17:51:55.254766+00:00 heroku[web.1]: State changed from up to down
2017-01-05T17:51:55.780574+00:00 app[web.1]: No command supplied, defaulting to serve...
2017-01-05T17:51:55.780578+00:00 app[web.1]: Server 'default' starting at 0.0.0.0:53088
2017-01-05T17:51:55.780562+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2017-01-05T17:51:55.780575+00:00 app[web.1]: No preparations.
2017-01-05T17:51:55.780579+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-05T17:51:55.774837+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2017-01-05T17:51:55.895627+00:00 heroku[web.1]: Process exited with status 15
2017-01-05T18:01:48.893674+00:00 heroku[web.1]: Unidling
2017-01-05T18:01:48.893975+00:00 heroku[web.1]: State changed from down to starting
2017-01-05T18:01:53.364634+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=21483`
2017-01-05T18:01:57.090891+00:00 heroku[web.1]: State changed from starting to up
2017-01-05T18:01:58.019181+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=ed174181-b3c9-4196-bd39-29121c343ea6 fwd=""94.77.202.2"" dyno=web.1 connect=0ms service=41ms status=500 bytes=138
2017-01-05T18:34:12.945697+00:00 heroku[web.1]: Idling
2017-01-05T18:34:12.946307+00:00 heroku[web.1]: State changed from up to down
2017-01-05T18:34:13.855518+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2017-01-05T18:34:13.855528+00:00 app[web.1]: No command supplied, defaulting to serve...
2017-01-05T18:34:13.855529+00:00 app[web.1]: No preparations.
2017-01-05T18:34:13.855530+00:00 app[web.1]: Server 'default' starting at 0.0.0.0:21483
2017-01-05T18:34:13.855531+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-05T18:34:13.848202+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2017-01-05T18:34:13.932737+00:00 heroku[web.1]: Process exited with status 15
2017-01-06T07:44:31.444744+00:00 heroku[web.1]: Unidling
2017-01-06T07:44:31.444992+00:00 heroku[web.1]: State changed from down to starting
2017-01-06T07:44:34.523300+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=31252`
2017-01-06T07:44:36.676936+00:00 heroku[web.1]: State changed from starting to up
2017-01-06T07:44:37.549125+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=0355d39f-cda9-4f8b-888b-18082332a824 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=26ms status=500 bytes=138
2017-01-06T07:50:51.627447+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=11ee0882-1bd1-43a2-a0cc-4bc1c11f74eb fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=27ms status=500 bytes=138
2017-01-06T07:57:45.954329+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=e4ca9186-fdc5-4cd8-b98b-cfee45c7f3b2 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=213ms status=500 bytes=138
2017-01-06T08:04:00.591772+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=b664a4c2-5aef-43b8-9c9f-180dfabeb93d fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=23ms status=500 bytes=138
2017-01-06T08:04:57.818556+00:00 heroku[router]: at=info method=GET path=""/"" host=dry-beyond-95031.herokuapp.com request_id=4ea215b8-a0a3-4ad0-9d8a-45fe27dbafd0 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=4ms status=404 bytes=119
2017-01-06T08:04:58.069106+00:00 heroku[router]: at=info method=GET path=""/favicon.ico"" host=dry-beyond-95031.herokuapp.com request_id=04affbf0-ded7-4eb1-845c-e569aa31107c fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=2ms status=404 bytes=161
2017-01-06T08:05:26.089377+00:00 heroku[router]: at=info method=POST path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=3c5ba6df-acec-4b27-a3f4-e3c0f27941c2 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=400ms status=500 bytes=138
2017-01-06T08:05:32.043519+00:00 heroku[router]: at=info method=GET path=""/"" host=dry-beyond-95031.herokuapp.com request_id=9d35561a-633b-42c9-8fb6-6ec423bf667c fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=2ms status=404 bytes=119
2017-01-06T08:05:40.163170+00:00 heroku[router]: at=info method=GET path=""/huguh"" host=dry-beyond-95031.herokuapp.com request_id=7a11db63-7644-4e42-a662-e223cb154171 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=2ms status=404 bytes=119
2017-01-06T08:13:43.406289+00:00 heroku[router]: at=info method=GET path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=f672e00b-db30-484c-a5da-01f8e57022f4 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=2ms status=404 bytes=161
2017-01-06T08:13:55.835147+00:00 heroku[router]: at=info method=GET path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=adb06e24-72cc-4b79-9d23-8a5ea127d2a3 fwd=""94.99.227.109"" dyno=web.1 connect=0ms service=1ms status=404 bytes=161
2017-01-06T08:45:25.599867+00:00 heroku[web.1]: Idling
2017-01-06T08:45:25.600941+00:00 heroku[web.1]: State changed from up to down
2017-01-06T08:45:26.264901+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2017-01-06T08:45:26.280223+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2017-01-06T08:45:26.280240+00:00 app[web.1]: No command supplied, defaulting to serve...
2017-01-06T08:45:26.280241+00:00 app[web.1]: No preparations.
2017-01-06T08:45:26.280241+00:00 app[web.1]: Server 'default' starting at 0.0.0.0:31252
2017-01-06T08:45:26.280242+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-06T08:45:26.280243+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-06T08:45:26.280244+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-06T08:45:26.280244+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-06T08:45:26.280245+00:00 app[web.1]: unable to load path
2017-01-06T08:45:26.280246+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2017-01-06T08:45:26.280246+00:00 app[web.1]: unable to load path
2017-01-06T08:45:26.369735+00:00 heroku[web.1]: Process exited with status 15
2017-01-06T18:01:52.724336+00:00 heroku[web.1]: Unidling
2017-01-06T18:01:52.724823+00:00 heroku[web.1]: State changed from down to starting
2017-01-06T18:01:56.197941+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=51652`
2017-01-06T18:01:59.779285+00:00 heroku[web.1]: State changed from starting to up
2017-01-06T18:02:00.857405+00:00 heroku[router]: at=info method=GET path=""/whether"" host=dry-beyond-95031.herokuapp.com request_id=39353fc7-8f70-49b4-95b0-12b4f2e0980a fwd=""94.99.227.109"" dyno=web.1 connect=1ms service=4ms status=404 bytes=161
2017-01-06T18:36:26.460178+00:00 heroku[web.1]: Idling
2017-01-06T18:36:26.460594+00:00 heroku[web.1]: State changed from up to down
2017-01-06T18:36:27.237564+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2017-01-06T18:36:27.390324+00:00 heroku[web.1]: Process exited with status 15
2017-01-06T18:36:27.262126+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2017-01-06T18:36:27.262141+00:00 app[web.1]: No command supplied, defaulting to serve...
2017-01-06T18:36:27.262142+00:00 app[web.1]: No preparations.
2017-01-06T18:36:27.262143+00:00 app[web.1]: Server 'default' starting at 0.0.0.0:51652
2017-01-06T19:13:59.497901+00:00 heroku[slug-compiler]: Slug compilation started
2017-01-06T19:13:59.497911+00:00 heroku[slug-compiler]: Slug compilation finished
2017-01-06T19:13:59.336403+00:00 app[api]: Deploy fa16ad6 by user naifdev@gmail.com
2017-01-06T19:13:59.336403+00:00 app[api]: Release v5 created by user naifdev@gmail.com
2017-01-06T19:13:59.722058+00:00 heroku[web.1]: State changed from down to starting
2017-01-06T19:14:02.835500+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=8308`
2017-01-06T19:14:06.609232+00:00 heroku[web.1]: State changed from starting to up
2017-01-06T19:14:38.480190+00:00 heroku[router]: at=info method=GET path=""/whether?city=Paris"" host=dry-beyond-95031.herokuapp.com request_id=26c5f8bb-eb3b-47be-8fd2-799dfc4aed66 fwd=""94.99.227.109"" dyno=web.1 connect=1ms service=24ms status=500 bytes=138
2017-01-06T19:17:53.744114+00:00 heroku[router]: at=info method=GET path=""/whether?city=Paris"" host=dry-beyond-95031.herokuapp.com request_id=8414a869-8d81-480a-8a74-51cfb3644bbf fwd=""94.99.227.109"" dyno=web.1 connect=1ms service=221ms status=500 bytes=138
2017-01-06T19:18:06.721140+00:00 heroku[router]: at=info method=GET path=""/whether?city=Paris"" host=dry-beyond-95031.herokuapp.com request_id=04a1b568-bfe1-4643-9a34-fce7b23eb325 fwd=""94.99.227.109"" dyno=web.1 connect=1ms service=22ms status=500 bytes=138
</code></pre>
","7373500","","5236226","","2017-01-06 21:47:28","2020-04-12 11:40:38","Deploying Vapor with heroku","<swift><heroku><swift3><vapor>","2","3","1","","","41513191","118712","118712","vapor","592","36204589","36204588"
"41529854","1","41530704","","2017-01-08 05:41:58","","3","741","<p>Im having 2 problems when trying to generate a random string in Linux with Swift 3.</p>

<ol>
<li><p>arc4random_uniform is not available in Linux only on BSD. SO i was able to get away with using random() function. And this worked when i was generating random numbers of a variable size (See code below)</p>

<pre><code>func generateRandomNumber() -&gt; Int
{
   var place = 1

   var finalNumber = 0;

#if os(Linux)
for _ in 0..&lt;5
{
    place *= 10

    let randomNumber = Int(random() % 10) + 1

    finalNumber += randomNumber * place
}
#else
for _ in 0..&lt;5
{
    place *= 10

    let randomNumber = Int(arc4random_uniform(10))

    finalNumber += randomNumber * place
}
#endif

  return finalNumber
}
</code></pre></li>
</ol>

<p>And that WORKS. 
<strong>Edit:</strong> it works but it gives me the same number every time :(</p>

<ol start=""2"">
<li>When trying to generate random alphanumeric string I'm limited to using Swift String and NOT NSSTRING. Linux throws this error </li>
</ol>

<p>original pre Linux block of code:</p>

<pre><code>   func randomString(_ length: Int) -&gt; String
   {

      let letters : NSString = ""abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789""
      let len = UInt32(letters.length)

      var randomString = """"

      for _ in 0 ..&lt; length {
    let rand = arc4random_uniform(len)
    var nextChar = letters.character(at: Int(rand))
    randomString += NSString(characters: &amp;nextChar, length: 1) as String
      }

       return randomString
    }
</code></pre>

<p>And the actual error I get when using above code</p>

<pre><code>    error: cannot convert value of type 'NSString' to type 'String' in coercion
        randomString += NSString(characters: &amp;nextChar, length: 1) as String
</code></pre>

<p>modified for linux block of code. </p>

<pre><code>    func randomString(_ length: Int) -&gt; String
    {

let letters : String = ""abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789""
let len = letters.characters.count

var randomString = """"

#if os(Linux)

    for _ in 0..&lt;length
    {
        let randomValue = (random() % len) + 1

        randomString += ""\(letters[letters.index(letters.startIndex, offsetBy: Int(randomValue))])""
    }

    #else
    for _ in 0 ..&lt; length
    {
        let rand = arc4random_uniform(UInt32(len))

        randomString += ""\(letters[letters.index(letters.startIndex, offsetBy: Int(rand))])""
    }
    #endif


      return randomString
}          
</code></pre>

<p>but this time the error is weird it only says  <strong>Illegal instruction</strong> with no extra information. I ran the docker container in interactive mode and i saw my server running and printing out when calling other functions etc.</p>

<p>but the thing is the function actually WORKS when i ran it in IBMs swift
sandbox </p>

<p><a href=""https://i.stack.imgur.com/CrDb7.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/CrDb7.png"" alt=""enter image description here""></a> 
and I'm assuming its using linux also. Im very stuck and confused any help would be greatly appreciated. </p>

<p>(<strong>UPDATE</strong>): I ran the same function in just a linux env with a single swift file and not the Vapor swift web framework. and it works. As mentioned in my edit above it gives me the same random string everytime. I will still have to test the entire project once my build finishes. But besides that i need to know if the random() function will actually give me something new each time instead of the same crap.</p>
","2562090","","2562090","","2017-01-08 06:22:47","2018-10-17 12:50:35","Random Alphanumeric String Linux Swift 3","<linux><random><swift3><ubuntu-16.04><vapor>","4","0","","","","41529854","118712","118712","vapor","592","36204589","36204588"
"41597986","1","41602498","","2017-01-11 18:20:49","","2","512","<p>I am getting started with Vapor in Xcode to build a simple server to support my app. I am trying to understand how to properly build JSON objects I can return for example in a get request.</p>

<p>I have the following:</p>

<pre><code>drop.get { request in
    let date:TimeInterval = Date().timeIntervalSince1970
    let dictionary:[String:String] = [""name"":""e2"",""age"":""3""]
    return try JSON(node: [
        ""time"":date,
        ""t1"" : ""abc"",
        ""t2"" : dictionary
        ])
}
</code></pre>

<p>This does not work, it tells me that ""argument labels (node:) do not match any available overloads""</p>

<p>How can I build JSON that includes strings, numbers and nested dictionary like above?</p>
","728246","","","","","2017-01-11 23:14:35","Swift Vapor server: how to return nested dictionaries in get request?","<ios><vapor>","1","0","","","","41597986","118712","118712","vapor","592","36204589","36204588"
"41626091","1","41626669","","2017-01-13 01:37:44","","0","100","<p>I want to use Vapor as the outside facing API to other internal services. For example:</p>

<pre><code>drop.client.post(""http://localhost:8091/someEndpoint"")
</code></pre>

<p>However, I get an error explaining that the URL is not a URI (It has problems paling the port and the "":""). Furthermore, if I need to forward to multiple internal services, do I need multiple clients?</p>
","2997261","","","","","2017-01-13 02:52:59","How to Use Vapor Client to Route to Another Port","<vapor>","1","0","","","","41626091","118712","118712","vapor","592","36204589","36204588"
"41634334","1","","","2017-01-13 12:08:09","","3","789","<p>I am trying to create cookies, but I am not seeing any cookie in browser. Instead of that I am getting different output on Postman &amp; different output on chrome browser.</p>

<p>blow is how I code to create cookies.</p>

<ol>
<li><p>Create route</p>

<pre><code>drop.get(""create"", handler:createCookie)
</code></pre></li>
<li><p>Handler</p>

<pre><code>func createCookie(request: Request) throws -&gt; ResponseRepresentable {

let cookie = Cookie(name: ""login"", value:""value"", expires: generateExpirationDate(), secure: true)
request.cookies.insert(cookie)

return ""Done""
}
</code></pre></li>
<li><p>below is func to create expiration handler</p>

<pre><code> func generateExpirationDate() -&gt; Date {
  return Date() + (60 * 1) // 1 Minutes later
 }
</code></pre></li>
</ol>

<p><strong>In post man I am getting one cookie named ""vapor-sessions""</strong> 
<a href=""https://i.stack.imgur.com/k9sBd.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/k9sBd.png"" alt=""enter image description here""></a></p>

<p><strong>And in chrome browser I am getting two cookies as in below picture.</strong>
<a href=""https://i.stack.imgur.com/GLWw3.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/GLWw3.png"" alt=""enter image description here""></a></p>

<p><strong>But my desired one is not there. !!!!!!!</strong></p>

<p><strong>EDIT</strong>:</p>

<p><strong>I also have tried below code but no luck for Postman, but this one 'works in chrome', I have doubt for other browsers !!!!</strong></p>

<pre><code>func createCookie(request: Request) throws -&gt; ResponseRepresentable {

    let cookie = Cookie(name: ""login"", value:""value"", expires: generateExpirationDate(), secure: true)

    let response = try Response(status: .ok, json: JSON(node: [
        ""yo"": ""yoyo""
        ]))

    response.cookies.insert(cookie)


    return response
}
</code></pre>
","2949441","","2949441","","2017-01-16 06:16:08","2017-02-17 12:12:32","Swift Vapor Cookies not working","<swift><cookies><session-cookies><vapor>","2","0","","","","41634334","118712","118712","vapor","592","36204589","36204588"
"41635303","1","","","2017-01-13 13:05:30","","1","418","<p>I have created a test Vapor web app, but it does not seem to serve the css files.
Do I have to do anything other than put them in the Public/styles directory (and rebuild) ?</p>

<p>Please see attached pic (note the css files in red).</p>

<p><a href=""https://i.stack.imgur.com/SGyFs.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/SGyFs.png"" alt=""enter image description here""></a></p>
","361211","","","","","2017-01-14 10:25:35","Vapor - Server Side Swift: Doesn't find css","<css><vapor>","1","3","","","","41635303","118712","118712","vapor","592","36204589","36204588"
"41667915","1","41669807","","2017-01-16 00:29:41","","1","397","<p>I'm trying to connect to 
<a href=""https://www.bamboohr.com/api/documentation/"" rel=""nofollow noreferrer"">Bamboo HR's API</a>, and I've managed to make this work with <code>curl</code> and Swift Foundation's <code>URLRequest</code>/<code>URLSession</code> (as well as an older Express node.js app).</p>

<p>However, when trying to utilize <a href=""https://vapor.github.io/documentation/http/client.html"" rel=""nofollow noreferrer"">Vapor's client</a> with the <code>.get()</code> method, I'm getting a successful <code>200</code> response from BambooHR - but the response's <code>.body</code> is empty.</p>

<p>Here's the code snippet:</p>

<p><em>key and {myDomain} are placeholders in the example</em>
</p>

<pre><code>let encodedKey = ""\(key):x"".utf8.base64String
let directoryRootUrl = ""https://api.bamboohr.com/api/gateway.php/{myDomain}/v1/employees/directory""

let response = try drop.client.get(
    directoryRootURL,
    headers: [
        ""Accept"": ""application/json"",
        ""Authorization"": ""Basic \(encodedKey)"",
        ""Host"": ""api.bamboohr.com""
    ])
</code></pre>

<p>When I do <code>print(response)</code>, this is what's displayed:</p>

<pre><code>Response
- HTTP/1.0 200 OK
- Headers:
    Connection: close
    Vary: User-Agent
    Server: Apache
    Content-Security-Policy:  {...}
    Date: Mon, 16 Jan 2017 00:26:31 GMT
    Content-Type: application/json
    X-Content-Type-Options: nosniff
- Body:
</code></pre>

<p>I'm wondering if I'm doing anything wrong with Vapor, or if it's a bug.</p>
","4095379","","","","","2017-01-16 05:10:04","Empty Body in Vapor Client GET Response","<swift3><vapor>","1","2","1","","","41667915","118712","118712","vapor","592","36204589","36204588"
"41668152","1","","","2017-01-16 01:07:54","","2","336","<p>I am building a application in Vapor. My website works fine on localhost but on the Heroku doesn't run correctly. I have got a list with elements from xml. Xml is parsing by SWXMLHash. Heroku printing only static header. I cant see any informations about error in server log. Everything need to works fine but not working.</p>

<pre><code>guard let xmlString = response?.body.bytes?.string else {
    throw Abort.custom(status: .badRequest, message: ""Could not retrieve xml string"")
}

let xml = SWXMLHash.parse(xmlString)
var cars:[Car] = []
for item in xml[""findItemsByCategoryResponse""][""searchResult""][""item""].all {
    cars.append(Car(item:item))
    print(""1 ""+(item[""title""].element?.text ?? """"))

}

var table:[Node]=[]
for car in cars {
    table.append(try [""title"": car.title,""url"": car.auctionUrl,""price"":car.price,""imgUrl"":car.galeryUrl].makeNode())
}
var nodeTables = try table.makeNode()
return try drop.view.make(""index"", Node(node: [""cars"": nodeTables]))
</code></pre>
","6747995","","","","","2017-02-01 02:36:08","Swift Vapor SWXMLHash probably SWXMLHash error","<swift><heroku><vapor><swxmlhash>","1","7","0","","","41668152","118712","118712","vapor","592","36204589","36204588"
"41682286","1","","","2017-01-16 17:54:22","","2","388","<p>There are some css files in Public/css/. I'm accustomed to setting cache rules in the .htaccess for Apache server. How can I make the browswer cache static files when using Vapor?</p>
","5808504","","","","","2017-02-01 21:42:44","How to cache static files when using Vapor framework for Swift","<swift><vapor>","1","1","1","","","41682286","118712","118712","vapor","592","36204589","36204588"
"41712123","1","41712801","","2017-01-18 05:38:49","","3","403","<p>I have installed vapor on my mac and when trying to build project, it will never ending.</p>

<p>I am getting waring when trying to install again like below (brew install qutheory/tap/vapor)</p>

<pre><code>Warning: qutheory/tap/vapor-0.4.1 already installed, it's just not linked.
</code></pre>

<p>and below is my running console output.</p>

<pre><code>MAC-mini-A:vapor-docker22 mac$ vapor build
Fetching Dependencies [Done]
Building Project [ •                       ]
</code></pre>

<p>The last building project step will never ending.</p>

<p>.</p>

<p>Edit:</p>

<p>Building with Xcode works good, but I want to do with 'vapor build' command not from Xcode.</p>
","2949441","","2949441","","2017-01-18 05:43:49","2017-01-18 09:56:15","swift vapor build(Building Project) will never ending and getting warning 'it's just not linked'","<swift><vapor><vapor-cli>","1","0","","","","41712123","118712","118712","vapor","592","36204589","36204588"
"41744484","1","41750958","","2017-01-19 14:38:51","","2","433","<p>While doing Ray Wenderlich tutorial ""Server Side Swift with Vapor: Persisting Models"" I tried to add one more parameter(param) to the class Acronyms.</p>

<pre><code>import Vapor

final class Acronym: Model {

  var id: Node?
  var exists: Bool = false

  var short: String
  var long: String
  var param: String

    init(short: String, long: String, param: String) {
    self.id = nil
    self.short = short
    self.long = long
    self.param = param
  }

  init(node: Node, in context: Context) throws {
    id = try node.extract(""id"")
    short = try node.extract(""short"")
    long = try node.extract(""long"")
    param = try node.extract(""param"")
  }

  func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [
      ""id"": id,
      ""short"": short,
      ""long"": long,
      ""param"": param
    ])
  }

  static func prepare(_ database: Database) throws {
    try database.create(""acronyms"") { users in
      users.id()
      users.string(""short"")
      users.string(""long"")
      users.string(""param"")
    }
  }

  static func revert(_ database: Database) throws {
    try database.delete(""acronyms"")
  }

}
</code></pre>

<p>At first I run this code without one more parameter. And it works. But when i added one it fails.</p>

<p>Error: 500The operation couldn’t be completed. (PostgreSQL.DatabaseError error 1.)</p>

<p>My main.swift:</p>

<pre><code>import Vapor
import VaporPostgreSQL

let drop = Droplet(
    preparations: [Acronym.self],
    providers: [VaporPostgreSQL.Provider.self]
)

drop.get(""hello"") { request in
    return ""Hello, world!""
}

drop.get(""version"") { req in
    if let db = drop.database?.driver as? PostgreSQLDriver {
        let version = try db.raw(""SELECT  version()"")
        return try JSON(node: version)
    } else {
        return ""No db connection""
    }
}

drop.get(""test"") { request in
    var acronym = Acronym(short: ""AFK"", long: ""Away From Keyboard"", param: ""One More Parametr"")
    try acronym.save()
    return try JSON(node: Acronym.all().makeNode())
}

drop.run()
</code></pre>
","5685381","","","","","2017-02-08 18:10:34","500 The operation couldn’t be completed. (PostgreSQL.DatabaseError error 1.)","<sql><swift><database><postgresql><vapor>","3","0","0","","","41744484","118712","118712","vapor","592","36204589","36204588"
"41852726","1","41863567","","2017-01-25 13:21:57","","1","68","<p>I making chat backend and I need messages history table which will contain two users.</p>

<p>Is it some way to do something like that right way?</p>

<pre><code>static func prepare(_ database: Database) throws {
    try database.create(""historys"") { history in
        history.id()
        history.parent(User.self, optional: false)
        history.parent(User.self, optional: false)
    }
}
</code></pre>

<p>Now I'm getting an error of multiple user_id fields.</p>
","6029626","","","","","2017-01-25 23:26:55","Two same parents in one entity","<swift><vapor>","1","0","","","","41852726","118712","118712","vapor","592","36204589","36204588"
"41868625","1","41872702","","2017-01-26 07:28:49","","1","610","<p>I’m trying to GET data from another web service, then transform it and return it. I found a Spotify example in the docs, but I’m not sure how to return a portion of the JSON.</p>

<pre><code>drop.get(""music"") { request in
    guard let query = request.data[""q""]?.string else {
        throw Abort.badRequest
    }

    let result = try drop.client.get(
        ""https://api.spotify.com/v1/search"",
        query: [""type"": ""artist"", ""q"": query]
    )

    return result.data[""artists""]?.array
}
</code></pre>

<p>I'm getting this error when I try to build: <code>error: return expression of type '[Polymorphic]?' does not conform to 'ResponseRepresentable'</code></p>
","239380","","","","","2017-01-26 11:42:13","Vapor `client.get`, transform and return json","<json><swift><vapor>","1","0","","","","41868625","118712","118712","vapor","592","36204589","36204588"
"41884674","1","","","2017-01-26 23:14:09","","3","1245","<p>If I build a Swift dictionary, i.e. <code>[String: Any]</code> how can I return that as JSON? I tried this, but it gives me the error: <code>Argument labels '(node:)' do not match any available overloads</code>.</p>

<pre><code>drop.get(""test"") { request in
    var data: [String: Any] = [:]

    data[""name""] = ""David""
    data[""state""] = ""CA""

    return try JSON(node: data)
}
</code></pre>
","239380","","","","","2017-04-07 02:18:55","Vapor JSON from `[String: Any]` Dictionary","<json><swift><vapor>","2","3","","","","41884674","118712","118712","vapor","592","36204589","36204588"
"41898944","1","41905350","","2017-01-27 16:46:23","","6","1450","<p>Can I use timer, such as <code>NSTimer</code> in Vapor (server-side Swift)?</p>

<p>I hope my server written in Vapor can do some tasks proactively once in a while. For example, polling some data from the web every 15 mins.</p>

<p>How to achieve this with Vapor?</p>
","830098","","","","","2019-04-05 16:39:34","How to use timer in Vapor (server-side Swift)?","<vapor><server-side-swift>","2","0","2","","","41898944","118712","118712","vapor","592","36204589","36204588"
"41906422","1","41906581","","2017-01-28 04:45:48","","7","883","<p>I'm using Vapor to try to get an XML file from another server, the problem is I don't know how to convert the response body to a swift String.</p>

<pre><code>let bikesResponse = try drop.client.get(""http://www.c-bike.com.tw/xml/stationlistopendata.aspx"")

let bodyBytes = bikesResponse.body
let string = String(bytes) // &lt;-- WHAT DO I DO HERE?
</code></pre>

<p>Thanks</p>
","1712184","","","","","2017-01-28 05:16:03","How do I convert response.body from Vapor to String in Swift 3?","<vapor>","1","0","1","","","41906422","118712","118712","vapor","592","36204589","36204588"
"41917803","1","41974725","","2017-01-29 05:06:52","","3","1307","<ol>
<li>How do I download a file using server side swift?</li>
</ol>

<p>I have tried this:</p>

<pre><code>let result = try drop.client.get(""http://dropcanvas.com/ir4ok/1"")
</code></pre>

<p>but result.body always = 0 elements</p>

<ol start=""2"">
<li>How do I send a file?</li>
</ol>

<p>I have tried this </p>

<pre><code>drop.get(""theFile"") { request in 
   let file = NSData(contentsOf: ""/Users/bob.zip"")
   return file // This fails here
}
</code></pre>
","433073","","","","","2020-02-03 21:51:00","How do I download a file and send a file using Vapor server side swift?","<swift><vapor><server-side-swift>","2","2","1","","","41917803","118712","118712","vapor","592","36204589","36204588"
"41920143","1","41925227","","2017-01-29 11:01:25","","1","462","<p>After successfully deploying on localhost (0.0.0.0:8080)
While I pushed the code to git for heroku, 
I am getting error on heroku.</p>

<pre><code>Cannot connect to MongoDB
Process exited with status 0
</code></pre>

<p>Inside package file I added </p>

<pre><code>dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 1),
        .Package(url: ""https://github.com/OpenKitten/MongoKitten.git"", majorVersion: 3)
    ],
</code></pre>

<p>Inside main.swift the program exists on this line</p>

<pre><code>let mongoDatabase = try Database(mongoURL: ""mongodb://localhost/mydatabase"")
</code></pre>

<p>Additional info: I believe that on commit there is something which is left out by the SourceTree.
As the same code is also not working after checkout on a different machine. And the code is compiling perfect.</p>
","884674","","1930509","","2017-01-29 15:33:34","2017-01-29 19:49:21","Setting up Vapor and MongoKitten","<swift><mongodb><heroku><atlassian-sourcetree><vapor>","1","10","2","","","41920143","118712","118712","vapor","592","36204589","36204588"
"41934484","1","","","2017-01-30 11:13:28","","1","313","<p>I want to create simple data base model. I'am using postgresql-provider package major:1 minor:1. I've followed instructions to create model. I've added preparations and resource to my Droplet object. Message I receive after running is</p>

<p>No command supplied, defaulting to serve...
Database prepared
Server 'default' starting at 0.0.0.0:8080</p>

<p>Can someone help me with the problem?</p>
","5179274","","","","","2017-01-30 21:05:13","No command supplied, defaulting to serve Vapor","<vapor>","2","1","","","","41934484","118712","118712","vapor","592","36204589","36204588"
"41952974","1","","","2017-01-31 08:35:13","","2","461","<p>I am not quite sure if this work - so that why I am asking this question:</p>

<p>I have a macOS app based on Swift that is used as a specialized CRM application. 
My client wants to use the app on different machines but the data should be fetched from one Mac. 
My consideration was to use one app as ""server"" and the other apps as clients connecting to this server. </p>

<ul>
<li>Can I use vapor inside an app for macOS for such a scenario? </li>
<li>Can it be used as a library? </li>
<li>I have seen that vapor comes with its own stack of environment - is it compatible to be used inside a macOS app?</li>
</ul>

<p>Cheers</p>

<p>Sas</p>
","3791239","","","","","2017-01-31 09:17:05","Use Swift vapor inside a macOS app","<swift><macos><vapor>","1","1","","","","41952974","118712","118712","vapor","592","36204589","36204588"
"41994883","1","","","2017-02-02 05:35:27","","1","211","<p>I'm new to vapor and I'm stucked. I'm following this tutorial: <a href=""https://www.xplusz.com/how-to-do-basic-crud/"" rel=""nofollow noreferrer"">https://www.xplusz.com/how-to-do-basic-crud/</a> but I'm using a MySQL database instead of a postgresql database. </p>

<p>So this is the code I have:
Patient.swift</p>

<pre><code>import Foundation
import Vapor
import Fluent


final class Patient: Model {

  var id: Node?
  var firstName: String
  var lastName: String
  var exists: Bool = false

  init(firstName: String, lastName: String) {
    self.id = nil
    self.firstName = firstName
    self.lastName = lastName
  }

  init(node: Node, in context: Context) throws {
    id = try node.extract(""id"")
    firstName = try node.extract(""first_name"")
    lastName = try node.extract(""last_name"")
  }

  func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [
      ""id"": id,
      ""first_name"": firstName,
      ""last_name"": lastName
      ])
  }

  static func prepare(_ database: Database) throws {
    try database.create(""patients"") { users in
      users.id()
      users.string(""first_name"")
      users.string(""last_name"")
    }
  }

  static func revert(_ database: Database) throws {
  try database.delete(""patients"")
  }

}
</code></pre>

<p>main.swift</p>

<pre><code>import Vapor
import VaporMySQL

let drop = Droplet(
  providers:[VaporMySQL.Provider.self]
)

drop.get { req in
    return try drop.view.make(""welcome"", [
        ""message"": drop.localization[req.lang, ""welcome"", ""title""]
    ])
}


drop.get(""version""){request in
  if let db = drop.database?.driver as? MySQLDriver{
    let version = try db.raw(""SELECT version()"")
    return try JSON(node: version)
  }else{
    return ""No db connection""
  }
}

drop.post(""patients"") { request in
  print(request.json)
  var patient = try Patient(node: request.json)
  try patient.save()
  return patient
}

drop.get(""patients""){request in
  return try JSON(node: Patient.all().makeNode())
}




drop.resource(""posts"", PostController())

drop.run()
</code></pre>

<p>If I run version, everything works fine:</p>

<pre><code>[
  {
    ""version()"": ""5.7.14""
  }
]
</code></pre>

<p>But for example if I run post or get requests, I get an error:
<a href=""https://i.stack.imgur.com/zLLVy.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zLLVy.png"" alt=""enter image description here""></a></p>

<p>The tutorial didn't talk about creating a table in the database first, but thats what the prepare function is about right? What else is wrong?</p>

<p>mysql.json</p>

<pre><code>{
  ""host"": ""localhost"",
  ""user"": ""root"",
  ""password"": """",
  ""database"": ""development"",
  ""port"": ""3306"",
  ""encoding"": ""utf8""
}
</code></pre>
","2529173","","2529173","","2017-02-02 11:14:37","2017-02-03 05:06:35","Fluent.EntityError error 0","<ios><swift><vapor>","1","0","1","","","41994883","118712","118712","vapor","592","36204589","36204588"
"42008299","1","42009305","","2017-02-02 17:12:31","","0","763","<p>I'm trying to make a simple get request to Google Places API from my vapor web service.</p>

<p>This is what my controller looks like:</p>

<pre><code>import Vapor
import HTTP
import VaporPostgreSQL

final class MainController {

var currentDroplet: Droplet!

func addRoutes(drop: Droplet) {

    currentDroplet = drop
    drop.get(""places"",String.self, String.self, handler: getNearbyPlaces)

}

func getNearbyPlaces(request: Request, lat: String, long: String) throws -&gt; ResponseRepresentable {

    let googleAPIKey = ""MY_KEY""
    let googlePlacesBaseURL = ""https://maps.googleapis.com/maps/api/place/nearbysearch""

    let url = googlePlacesBaseURL + ""/json?location=\(lat),\(long)&amp;radius=500&amp;types=food&amp;key="" + googleAPIKey

    print(url)

    let apiResponse = try drop.client.get(url)

    print(apiResponse)

    return apiResponse.json != nil ? apiResponse.json! : ""Something went bad""


   }
}
</code></pre>

<p>It should be as simple as that, however when I call it, the request keeps hanging for a long time and then it returns 500.
Note that the printed <strong>url</strong> in the console does work fine directly in the browser.
I couldn't figure out a useful way to catch and debug any errors too.</p>
","1222373","","","","","2017-02-02 18:04:48","Struggling with Vapor Client","<swift><http><client><vapor>","1","5","","","","42008299","118712","118712","vapor","592","36204589","36204588"
"42030704","1","42037087","","2017-02-03 18:25:52","","1","637","<p>i just newbie and want learn more about server side swift with vapor, now i am really stack on the show image dynamically with vapor swift. in my case. i have image on folder :</p>

<p>public -> images -> a.png , b.png</p>

<p>and i have name of image on my database, and i want to make get requests for show image on leaf file, with parameter name of my image, how to implement thats. Thanks a lot. </p>
","4895259","","","","","2017-02-09 18:41:43","How to show dynamic image with server side vapor swift?","<swift><server-side><vapor><leaf>","1","0","","","","42030704","118712","118712","vapor","592","36204589","36204588"
"42052050","1","42056101","","2017-02-05 12:29:02","","2","330","<p>For my Vapor application, I need to read the fragment of a request's URI.</p>

<pre class=""lang-swift prettyprint-override""><code>let drop = Droplet()

drop.get(""fragment"") {
    request in

    print(""URI: \(request.uri)"")
    print(""Fragment: \(request.uri.fragment)"")

    return """"
}
</code></pre>

<p>The problem is: When I request <code>http://myserver/fragment#hello</code>, the <code>request.uri.fragment</code> is <code>nil</code>. This is printed in the console:</p>

<pre class=""lang-none prettyprint-override""><code>URI: http://localhost:8080/fragment
Fragment: nil
</code></pre>

<p>Am I missing something? The <a href=""https://vapor.github.io/documentation/http/request.html"" rel=""nofollow noreferrer"">Vapor documentation</a> does not mention any case, where the fragment is not included in the <code>URI</code>.</p>
","4687348","","","","","2017-02-05 19:12:05","Get fragments of URI in Vapor","<swift><vapor>","1","0","","","","42052050","118712","118712","vapor","592","36204589","36204588"
"42168911","1","","","2017-02-10 21:26:40","","1","997","<p>Maybe it's a noob question, but I can't find any solution anywhere else, so I want to ask.</p>

<p>I'm trying to generate JSON formatted data with Vapor in swift.</p>

<p>I have a class, named Customer and a class, named Parcel
In Customer class, I have a variable 
<code>var parcelArray = [Parcel]</code>
I added a parcels in that array in 'drop.get'
Now I want to generate JSON </p>

<pre><code> return try Node(node:[ 
        ""firstName"" : self.firstName,
        ""lastName"" : self.lastName,
        ""personID"" : self.personID
    ])
</code></pre>

<p>How can I add <code>parcelArray</code> here? I want result like this:</p>

<pre><code>{""name"": ""Name"",
    ""surname"": ""Surname"",
    ""person_id"": 123123123,
    ""parcel"": [
       ""parcelName"": ""parcel 1""
    ],
    ""parcel"": [
       ""parcelName"" : ""parcel 2""
    ]
}
</code></pre>
","1219750","","","","","2017-02-14 10:23:22","JSON array of objects in vapor","<json><swift><vapor>","1","3","","","","42168911","118712","118712","vapor","592","36204589","36204588"
"42171919","1","42171920","","2017-02-11 03:38:01","","3","1002","<p>There is a build error after adding the vapor postgresql connector to Package.swift</p>

<pre><code>    import PackageDescription

        let package = Package(
        name: ""todo_vapor_swift"",
            dependencies: [
                .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 5),
                .Package(url: ""https://github.com/vapor/postgresql-provider"", majorVersion: 1, minor: 0)
],
exclude: [
    ""Config"",
    ""Database"",
    ""Localization"",
    ""Public"",
    ""Resources"",
]
</code></pre>

<p>)</p>
","4293021","","","","","2017-02-11 03:38:01","Swift Vapor Postgres Xcode Build Error: Could not build Objective-C module 'CPostgreSQLMac'","<swift><xcode><postgresql><vapor>","1","0","2","","","42171919","118712","118712","vapor","592","36204589","36204588"
"42219238","1","42220361","","2017-02-14 06:22:29","","3","174","<p>I have created the Vapor project. I have registered two views and two API's as like below.</p>

<pre><code>    drop.get { req in
        return try drop.view.make(""index.html"")
    }

    drop.get(""home"") { req in
        return try drop.view.make(""home.html"")
    }

    // Register the GET request routes
    drop.get(""appname"") { request in
        return ""Welcome to Swift Web service"";
    }

    drop.get(""appversion"") { request in
        return ""v1.0"";
    }
</code></pre>

<p>Middleware code:</p>

<pre><code>    // Added the Middleware version for request and response
    final class VersionMiddleware: Middleware {

        // Interact with request and response
        func respond(to request: Request, chainingTo next: Responder) throws -&gt; Response {

            //Middleware is the perfect place to catch errors thrown from anywhere in the application.
            do {
                // Exclude the views from middleware
                if ( request.uri.path != ""/"") {
                    // The request has a 'Version' named token that equals ""API \(httpVersion)""
                    guard request.headers[""access_token""] == ""\(publicAPIKey)"" else {
                        throw Abort.custom(
                            status: .badRequest,
                            message: ""Sorry, Wrong web service authendication!!""
                        ) // The request will be aborted.
                    }

                }
                let response = try next.respond(to: request)
                response.headers[""Version""] = ""API \(httpVersion)""
                return response
            } catch {
                throw Abort.custom(
                    status: .badRequest,
                    message: ""Sorry, we were unable to query the Web service.""
                )
            }
        }
    }
</code></pre>

<p>Added the middleware Configuration:</p>

<pre><code>    // Configure the middleware
    drop.addConfigurable(middleware: VersionMiddleware() as Middleware, name: ""VersionMiddleware"")
</code></pre>

<blockquote>
  <p>My Questions are:</p>
  
  <p>Whenever user try to load home.html it should validate Middleware
  conditions and if we load index.html server will exclude the
  middleware validation.</p>
  
  <p>Same as in API's:  Whenever user try to load ""/appname"" it should
  validate Middleware conditions and if we load ""appversion"" server will
  exclude the middleware validation.</p>
</blockquote>

<p>I have done this using request.uri.path != ""/"". Do we have any another way to configure this in Vapor?</p>
","2586904","","","","","2017-02-14 07:37:58","Exclude some views from middleware Vapor","<swift><vapor>","1","0","","","","42219238","118712","118712","vapor","592","36204589","36204588"
"42232148","1","","","2017-02-14 17:10:29","","0","319","<p>I am running a vapor server on Ubuntu (16.04.2 TLS) and keep getting this error:</p>

<pre><code>**Server error: accept(Socket failed with code 11 (""Resource temporarily unavailable"") [acceptFailed])**
</code></pre>

<p>However, running exactly the same server on OS X, I don't get the error.</p>

<p>Do I have to do anything different on Ubuntu ? Can I inore the error ?</p>

<p>Thanks</p>
","361211","","","","","2017-02-15 18:46:28","Vapor server error","<ubuntu><server><vapor>","1","1","","","","42232148","118712","118712","vapor","592","36204589","36204588"
"42265022","1","","","2017-02-16 04:32:50","","0","511","<p><strong>Do we have any unit testing frameworks in Vapor?</strong></p>

<p>I am looking dependencies/framework which will help to do the Unit testing some of my web services and methods in easyway. </p>

<p>I've tried following solutions.</p>

<ul>
<li><a href=""http://seatoncode.com/unit-testing-vapor/"" rel=""nofollow noreferrer"">http://seatoncode.com/unit-testing-vapor/</a></li>
<li><a href=""https://medium.com/@tullio.sebastiani/unit-testing-vapor-toolbox-v-1-0-1-projects-c59a056c3b9b#.qf0kl1pfo"" rel=""nofollow noreferrer"">https://medium.com/@tullio.sebastiani/unit-testing-vapor-toolbox-v-1-0-1-projects-c59a056c3b9b#.qf0kl1pfo</a></li>
</ul>
","2586904","","","","","2017-03-03 05:57:36","Need suggestion for unit testing in Vapor using Swift 3.0","<unit-testing><swift3><vapor>","1","1","","","","42265022","118712","118712","vapor","592","36204589","36204588"
"42469148","1","42598240","","2017-02-26 13:34:32","","2","69","<p>I have just installed Swift 3.0.1 on Ubuntu 14.04 via Vapor tutorial.</p>

<blockquote>
  <p>curl -sL swift.vapor.sh/ubuntu | bash</p>
</blockquote>

<p>Here I received information about that clang version >=3.4 is required.
So I manualy have installed clang 3.5 and linked this to clang.</p>

<p>Next I run swift command and try to run any swift command like:</p>

<ul>
<li>print(""Hello"") </li>
<li>let w = ""hello""</li>
</ul>

<p>But swift ends with segmentation fault.</p>

<blockquote>
  <p>Welcome to Swift version 3.0.1 (swift-3.0.1-RELEASE). Type :help for assistance.</p>
  
  <p>1> print(""Hello"")</p>
  
  <p>Segmentation fault</p>
</blockquote>

<p>Things I have tried</p>

<ul>
<li>different swift versions</li>
<li>different clang versions</li>
<li>chmod -R o+r on swift folder</li>
</ul>

<p>Anyone can help?</p>
","5707347","","","","","2017-03-04 16:18:44","Can't execute commands in Swift on Ubuntu 14.04","<swift><ubuntu-14.04><vapor>","1","2","","","","42469148","118712","118712","vapor","592","36204589","36204588"
"42544529","1","","","2017-03-02 00:07:43","","5","851","<p>Using Xcode it’s quite easy to debug a server side swift (vapor/perfect/kitura) application running on the local machine. Unfortunately it’s not always easy to run a server application on the local workstations cause of datebase connections and various other interactions that are difficult to „emulate“ on a local machine. To make the application behave more like in production use, I would prefer to do some kind of remote debugging of the server side swift (vapor/perfect/kitura) application running on the server.</p>

<p>It seams like llvm is able to support remote-debugging. Is there any option to attache Xcode Debugger to the remote application (running on the server), or is there any other IDE capable of doing this?</p>
","7644347","","","","","2017-11-16 23:59:34","Is there any easy way to remote debug a swift (vapor/perfect/kitura) application running on an (develpoment) server?","<swift><xcode><llvm><vapor><kitura>","1","1","0","","","42544529","118712","118712","vapor","592","36204589","36204588"
"42574623","1","42595838","","2017-03-03 09:04:13","","1","132","<p>I'm trying to query a database using something like this:</p>

<pre><code>let db = drop.database?.driver as? MySQLDriver
let query = ""select \(fields) from \(table) where \(condition)""
let result = try db.raw(query)
</code></pre>

<p>I get the following Node object as result:</p>

<pre><code>array([Node.Node.object([""field_name"": Node.Node.string(""value_info"")])])
</code></pre>

<p>How can I get the <code>value_info</code> into a String variable?</p>
","1884961","","","","","2017-03-05 08:55:21","Extract String value from Node","<swift3><vapor>","1","0","","","","42574623","118712","118712","vapor","592","36204589","36204588"
"42670553","1","42671139","","2017-03-08 11:48:36","","0","305","<p>I am continuously getting this error. </p>

<p>I am confirming that mysql server is running on my MAC machine and I have created a database in mysql server for this project.</p>

<blockquote>
  <ol>
  <li>Below is my main.swift</li>
  </ol>
</blockquote>

<pre><code>import Vapor
import VaporMySQL

let drop = Droplet()

try drop.addProvider(VaporMySQL.Provider.self)

drop.preparations = [Student.self]

let _ = HomeController(drop: drop)

drop.run()
</code></pre>

<blockquote>
  <ol start=""2"">
  <li>Below is my HomeController.swift</li>
  </ol>
</blockquote>

<pre><code>import Vapor
import HTTP
import Foundation

final class HomeController {

    var drop: Droplet

    init(drop: Droplet) {
        self.drop = drop

    let studentsGroup = self.drop.grouped(""/"")
    studentsGroup.get(handler: homePageWithBankList)
    }

    func homePageWithBankList(request: Request) throws -&gt; ResponseRepresentable {

    do {
        var student = Student()
        student.name = ""name""
        try student.save()         // Here error raise
    } catch {
        print(error.localizedDescription)    // Getting error log here
    }

    return """"

    }
}
</code></pre>

<blockquote>
  <ol start=""3"">
  <li>Below is my Student.swift model class</li>
  </ol>
</blockquote>

<pre><code>import Vapor

final class Student: Model {

    var id: Node?
    var exists: Bool = false

    var name: String = """"

    init() {
        self.id = nil
    }

    init(node: Node, in context: Context) throws {
        id = try node.extract(""id"")
        name = try node.extract(""name"")
    }

    public func makeNode(context: Context) throws -&gt; Node {
        return try Node(node:[
            ""id"": id,
            ""name"": name
            ])
    }

    static func prepare(_ database: Database) throws {
        try database.create(""student"") { student in
            student.id()
            student.string(""name"")
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(""student"")
    }

}
</code></pre>

<blockquote>
  <ol start=""4"">
  <li>Below is mysql.json config file</li>
  </ol>
</blockquote>

<pre><code>{
    ""host"": ""localhost"",
    ""user"": ""root"",
    ""password"": ""admin"",
    ""database"": ""studentsDB"",
    ""port"": ""3306"",
    ""encoding"": ""utf8""
}
</code></pre>

<blockquote>
  <ol start=""5"">
  <li>Below are my package dependencies</li>
  </ol>
</blockquote>

<pre><code>    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 5),
        .Package(url: ""https://github.com/vapor/mysql-provider.git"", majorVersion: 1, minor: 1)
    ]
</code></pre>

<blockquote>
  <ol start=""6"">
  <li>Below is running mysql --version on my MAC</li>
  </ol>
</blockquote>

<pre><code>mysql  Ver 14.14 Distrib 5.7.17, for osx10.12 (x86_64) using  EditLine wrapper
</code></pre>

<blockquote>
  <p>EDIT:- I have this project on GitHub <a href=""https://github.com/AnandSuthar/MySQLapp"" rel=""nofollow noreferrer"">>>Here&lt;&lt;</a></p>
</blockquote>
","2949441","","2949441","","2017-03-08 11:54:50","2017-03-08 12:15:59","swift Vapor - The operation couldn’t be completed. (MySQL.Error error 4.)","<mysql><swift><vapor>","1","0","","","","42670553","118712","118712","vapor","592","36204589","36204588"
"42670593","1","42671166","","2017-03-08 11:50:26","","11","7136","<p>When I'm trying to log using <code>NSLog</code>, I'm facing this error:</p>

<blockquote>
<pre><code>remote: /tmp/build_f459d376d1bc10ac2e93e52575ac5ea9/Sources/App/main.swift:368:49: error: argument type 'String' does not conform to expected type 'CVarArg'
remote:                     NSLog(""FILE NOT AVAILABLE"", ""TESTNOTI"")
remote:                                                 ^~~~~~~~~~
remote:                                                            as! CVarArg
</code></pre>
</blockquote>

<p><strong>Here is my code:</strong></p>

<pre><code>if fileManager.fileExists(atPath: (drop.config[""servers"", ""default"", ""KeyURL""]?.string ?? ""default"")) {
    NSLog(""FILE AVAILABLE"", ""TESTNOTI"")
} else {
    NSLog(""FILE NOT AVAILABLE"", ""TESTNOTI"")
}
</code></pre>

<p>Why does this happen and how can I fix it?</p>
","2803960","","4180937","","2019-08-23 02:28:12","2019-08-23 02:28:12","'String' does not conform to expected type 'CVarArg'","<swift><vapor>","2","2","","","","42670593","118712","118712","vapor","592","36204589","36204588"
"42715943","1","42716387","","2017-03-10 10:21:15","","0","230","<p>I have tested everything, all is up and running. However, when I import Vapor in a new file I get a Swift compiler error when I try to build the web app. As soon as I remove <code>import Vapor</code> from my newly created Swift file everything goes back to normal and runs. Can you please explain to my why this happens?</p>

<p>This is the Swift file: </p>

<pre><code>import Foundation
import Vapor



struct apple{
    var id: Int = 0

    init(id: Int){
        self.id = id
    }
}
</code></pre>
","6662600","","","","","2017-03-10 10:43:01","Why do I get a Swift compiler error when importing Vapor?","<swift><xcode><vapor>","1","5","","","","42715943","118712","118712","vapor","592","36204589","36204588"
"42720303","1","42759603","","2017-03-10 14:07:10","","1","557","<p>I have a database with some complex relationships mapped and populated with a large amount of data. My requirement is that I need to use this database with Swift-Vapor server.</p>

<p>So that I created a model object (with Fluent framework constructs) similar to the database schema, in order to handle data flows between the vapor server and db.</p>

<p>When it comes the time to link database table(users table) with the model(User model), I found this method, which should implement inside the model class.</p>

<pre><code>static func prepare(_ database: Database) throws {
    try database.create(""users"") { users in
        users.id()
        users.string(""name"")
    }
}
</code></pre>

<p>Since I don't need to define a schema for already existing db, this prepare method just left unimplemented.</p>

<p>The result is that I just can't interact with db, for any operations like <code>userObj.save()</code></p>

<p>The same thing I achieved with Swift-Perfect Server with the help of the following method implementation inside the model object. This was done with the help <code>MySQLStORM</code> in Perfect.</p>

<pre><code>  // Map the model to the database table ""user""
  override open func table() -&gt; String {
    return ""user""
  }
</code></pre>

<p>What I'm looking for is <code>-&gt;</code> Is there any option like this available in <strong>Vapor</strong> so that I can map model object to a database table?</p>
","3743322","","","","","2017-03-13 08:53:20","Link model object to existing database table in Vapor","<mysql><swift><vapor><perfect>","1","0","","","","42720303","118712","118712","vapor","592","36204589","36204588"
"42729767","1","42729873","","2017-03-11 00:08:28","","0","2105","<p>I have limited exposure to databases. I am learning about web frameworks (Vapor) and all the tutorials add a database provider of some sort to their projects. Can you please explain to me what a database provide is and its role in a web app?</p>

<p>The tutorial I am following is integrating this provider: <a href=""https://github.com/vapor/postgresql-provider"" rel=""nofollow noreferrer"">postgresql-provider</a></p>
","6662600","","","","","2017-03-11 00:23:46","What is a database provider?","<database><vapor>","2","0","","2017-03-11 05:38:30","","42729767","118712","118712","vapor","592","36204589","36204588"
"42761864","1","","","2017-03-13 10:55:35","","1","248","<p>I have a method, which will return a <code>[String: Any]</code> dictionary as below,</p>

<pre><code>  func getDetailDictionary() -&gt; [String: Any] {
    // demo code
    let followers = [1, 2, 3, 4, 5]
    return [
      ""name"": ""sample name"",
      ""followers"": followers
    ]
  }
</code></pre>

<p>I need to convert this object to <code>JSON</code>, so that I can send it back to the client as a <code>ResponseRepresentable</code> object.</p>

<p>I used the following to prepare the JSON object:</p>

<pre><code>let jsonData = try JSON(node: getDetailDictionary())
</code></pre>

<p>But this giving error, telling this doesn't match any available overloads. I don't think <code>[String:Any]</code> type is not handled in <code>JSON(node: )</code> method implementation. Is there any way we can get this issue resolved in Vapor?</p>
","3743322","","5236226","","2017-03-13 14:18:20","2017-03-13 14:18:20","Is there anyway JSON(node: ) can be called with [String: Any] type in Vapor","<swift><vapor><server-side-swift>","1","1","","","","42761864","118712","118712","vapor","592","36204589","36204588"
"42775676","1","42824523","","2017-03-14 00:10:05","","3","774","<p>What I am trying to do is to enable Continuous delivery from GitLab to my compute engine on Google Cloude. I have Ubuntu 16.04 TSL running over there. I did install all components needed to run my project like: Swift, vapor, nginx.
I have manage to install Gitlab runner as well and created a runner whcihc is accessible from my gitlab repo. Everytime I do push on master the runner triggers. What happen is a failure due to: </p>

<p><code>could not create leading directories of '/home/gitlab-runner/builds/2bbbbbd/0/Server/Packages/vapor.git': Permission denied</code></p>

<p>If I change the permissions to <code>chmod -R 777</code> It will hange on <code>running</code> for <code>build</code> stage visible on gitlab pipeline. </p>

<p>I did something like:
<code>sudo chown -R gitlab-runner:gitlab-runner /home/gitlab-runner/builds</code>
<code>sudo chown -R gitlab-runner:gitlab-runner /home/gitlab-runner/cache</code>
but this haven't help, the error is same <code>Permission denied</code></p>

<p>Below you have my <code>.gitlab-ci.yml</code></p>

<pre><code>before_script:
  - swift --version

stages:
  - build
  - deploy

job_build:
  stage: build
  before_script:
  - vapor clean
  script:
  - vapor build --release
  only:
  - master

job_run_app:
  stage: deploy
  script:
    - echo ""Deploy a  API""
    - vapor run --name=App --env=production
  environment:
    name: production

job_run_frontend:
  stage: deploy
  script:
    - echo ""Deploy a  Frontend""
    - vapor run --name=Frontend --env=production
  environment:
    name: production
</code></pre>

<p>But that haven't pass to next stage eg. deploy. I had waited more then 14h for that but with out result. 
And... I have few more questions:</p>

<ol>
<li>Gitlab runner creates builds under location <code>/home/gitlab-runner/builds/</code> in this location every new job have own folder. for eg. <code>/home/gitlab-runner/builds/2bbbbbd/</code> in which is my project and the commands are executed. So what happens when the first one is running and I do deploy new version? the ports are blocked by the first instance and so on?</li>
<li>If I want to enable <code>supervisor</code> how do I do that with this when every time I deploy folder is different?</li>
<li>Can anyone explain or show me or point me to tutorial how do Continuous deployment with out docker?</li>
</ol>
","2308303","","","","","2019-04-11 09:06:59","Gitlab - Google compute engine Continuous delivery","<swift3><gitlab><google-compute-engine><continuous-deployment><vapor>","1","3","","","","42775676","118712","118712","vapor","592","36204589","36204588"
"42778930","1","42780816","","2017-03-14 06:14:21","","1","900","<p>We can apply a simple query filter in vapor with: </p>

<pre><code>// User is my model object connecting corresponding MySQL database table
let aUser = try User.query().filter(""user_email"", ""asd@example.com"")
</code></pre>

<p>How can we chain multiple query filters with AND or OR conditions like we do in SQL queries?</p>

<p>Say for example, if we need to join <code>filter(""user_email"", ""asd@example.com"")</code> and <code>filter(""user_password"", ""123456"")</code> with an <code>AND</code> condition, how can we achieve that?</p>
","3743322","","3743322","","2017-03-14 06:33:13","2017-04-13 15:27:32","Chaining Multiple Query Filters in Vapor - Server Side Swift","<swift><vapor><server-side-swift>","1","0","","","","42778930","118712","118712","vapor","592","36204589","36204588"
"42860341","1","42879680","","2017-03-17 14:39:55","","0","743","<p>I am using Vapor and in my secretes folder I have <code>postgresql.json</code> which contains the following text:</p>

<pre><code>{
    ""host"": ""127.0.0.1"",
    ""user"": ""userName"",
    ""password"": """",
    ""database"": ""friends"",
    ""port"": 5432

}
</code></pre>

<p>The server clearly depends on this file because when I delete this file, it fails to run. However when I include <code>postgresql.json</code> and change the port it has no effect on the server. It always listens on port 8080. How can I change my port?</p>
","6662600","","6075970","","2017-03-17 14:44:43","2017-03-18 20:47:43","How can I change the Postgres listening port?","<postgresql><vapor>","1","5","","","","42860341","118712","118712","vapor","592","36204589","36204588"
"42880594","1","","","2017-03-18 22:23:26","","0","143","<p>While trying to deploy to Heruko, I keep getting the question ""Would you like to deploy to other than US region server?"". If I select n, it displays an error. Not sure why am getting different questions than the tutorial I am following. </p>
","5307354","","","","","2017-03-22 20:31:19","Deploying to Heroku - vapor heroku init command - error","<heroku><vapor><deploying>","1","0","","","","42880594","118712","118712","vapor","592","36204589","36204588"
"42906477","1","42907109","","2017-03-20 14:39:33","","1","166","<p>Being new to Swift and Vapor, I'm experimenting with a Vapor project. It has a simple route, which fetches data from a DB via <a href=""https://github.com/vapor/mysql"" rel=""nofollow noreferrer"">MySQL for Swift</a>, then passes the <code>ResultSet</code> to the Leaf template. Here's what I am attempting:</p>

<pre><code>drop.get(""report"") {req in
    let data = try mysql.execute(""select * from things"")
    return try drop.view.make(""report"", [""data"":data])
}
</code></pre>

<p>But Swift complains with this error:</p>

<pre><code>error: cannot convert value of type '[[String : Node]]' to expected dictionary value type 'Node'
return try drop.view.make(""report"", [""data"":data])
                                            ^~~~
</code></pre>

<p>It feels like I'm missing a type-casting step, but what is it?</p>
","400702","","5236226","","2017-03-20 15:07:11","2017-03-20 16:06:38","How to pass ResultSet from ""MySql for Swift"" to leaf template contest","<mysql><vapor><leaf>","1","0","","","","42906477","118712","118712","vapor","592","36204589","36204588"
"42928145","1","","","2017-03-21 13:09:57","","1","76","<p>I am getting started with Vapor and I am trying to create a model for a <code>class</code> called <code>Intubation</code>. When you are conforming to the <code>NodeInitializable</code> you have to have this function:</p>

<pre><code>init(node: Node, in context: Context) throws {
    intubationID = try node.extract(""intubationID"")
    attempt = try node.extract(""attempt"")
}
</code></pre>

<p>I am getting an error regarding the line <code>attempt = try node.extract(""attempt"")</code> saying</p>

<p><strong>Missing argument for parameter 'transform' in call</strong> </p>

<p>If <code>attempt</code> is an instance of <code>class Attempt</code> how do I go about conforming to <code>NodeInitializable</code> in a correct way</p>
","4171692","","","","","2017-03-22 20:32:53","Conforming to NodeInitializable using try node.extract with transform parameter","<swift><swift3><vapor>","1","1","","","","42928145","118712","118712","vapor","592","36204589","36204588"
"42960601","1","","","2017-03-22 19:06:54","","1","746","<p>Is it possible yet to connect to an Oracle Database using Swift (raw or a Swift framework) on Linux?  What I have done is tried to build a Docker VM, install the Oracle binaries, add the OCILIB package and then connect [tried] using a package called SwiftOracle, which seems unsupported (lots of build issues) and just exposes the OCILIB C code to Swift using a module map and wrapper.  </p>

<p>I tried this using the Kitura framework and none of this seemed to work - Xcode can't compile because it isn't unable to either find the C library or create the module.</p>

<p>Here are the steps that I have tried to no avail:</p>

<p>Build Docker VM (which includes Oracle binaries): <a href=""https://github.com/wnameless/docker-oracle-xe-11g"" rel=""nofollow noreferrer"">https://github.com/wnameless/docker-oracle-xe-11g</a></p>

<p>Download and install OCILIB: <a href=""https://github.com/vrogier/ocilib"" rel=""nofollow noreferrer"">https://github.com/vrogier/ocilib</a></p>

<p>Add SwiftOracle package, fix build issues and try to build.</p>
","3861557","","","","","2018-11-30 16:00:58","Connecting to Oracle Database Using Server Side Swift","<swift><oracle><vapor><perfect><kitura>","1","1","","","","42960601","118712","118712","vapor","592","36204589","36204588"
"42968191","1","","","2017-03-23 05:49:24","","-1","161","<p>When I run in terminal <code>vapor xcode</code> to fetch the packages I get error <code>The dependency graph could not be satisfied (https://github.com/vapor/crypto.git)</code>
What is it caused by and how can I fix it. Package.swift file content is</p>

<pre><code> import PackageDescription

let package = Package(
name: ""StripePayment"",
dependencies: [
    .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 1, minor: 1),
   .Package(url:""https://github.com/siemensikkema/vapor-jwt.git"", majorVersion: 0)



],
exclude: [
    ""Config"",
    ""Database"",
    ""Localization"",
    ""Public"",
    ""Resources"",
    ""Tests"",
]
)
</code></pre>
","5918849","","3736093","","2017-03-23 05:59:16","2017-03-24 11:53:56","error: The dependency graph could not be satisfied Vapor Swift 3","<swift><swift3><vapor>","1","2","","","","42968191","118712","118712","vapor","592","36204589","36204588"
"42970276","1","43007891","","2017-03-23 08:01:49","","1","639","<p>I need to auth on the server that I'm trying to pull data from I currently have it connecting to the server with:</p>

<pre><code>    let urlString = ""\(makeUrl(grammar: grammar))&amp;\(query)""
    let drop = Droplet()

    return try drop.client.get(urlString)
</code></pre>

<p>But I can't seem to figure out how to get creds attached to the get request.  I tried just putting the user and password into the url but found the vapor client doesn't allow that:</p>

<pre><code>    /*
      Userinfo (i.e., username and password) are now disallowed in HTTP and       
      HTTPS URIs, because of security issues related to their transmission
      on the wire.  (Section 2.7.1)
    */
</code></pre>
","642502","","","","","2017-03-24 19:42:25","Vapor Client with Authentication","<swift3><vapor>","2","0","","","","42970276","118712","118712","vapor","592","36204589","36204588"
"42972880","1","42974713","","2017-03-23 10:06:52","","0","341","<p>I am trying to integrate SQLite into a Vapor project. I have added package for <code>Sqlite Provider</code> in the <code>Package.swift</code> file as:</p>

<pre><code>.Package(url: ""https://github.com/vapor/sqlite-provider.git"", majorVersion: 1, minor: 1)
</code></pre>

<p>and created a <code>sqlite.json</code> file, under config directory, containing</p>

<pre><code>{
    ""path"": ""database_name.sqlite""
}
</code></pre>

<p>After that, I ran <code>vapor clean &amp;&amp; vapor xcode</code> to integrate sqlite into the project. Everything worked fine, except now the project shows two <strong>Swift Compiler Error</strong>:</p>

<blockquote>
  <p>Header '/usr/local/opt/sqlite/include/sqlite3.h' not found</p>
</blockquote>

<p>and</p>

<blockquote>
  <p>Could not build Objective-C module 'CSQliteMac'</p>
</blockquote>

<p>Can you help to resolve this issues?</p>
","1459192","","1459192","","2017-03-23 11:55:03","2017-03-23 11:55:03","Failed to integrate SQLite in Vapor project","<swift><sqlite><vapor>","3","1","","","","42972880","118712","118712","vapor","592","36204589","36204588"
"42975237","1","42975652","","2017-03-23 11:51:24","","1","69","<p>When conforming to the Model protocol for a class in vapor I come up with a class like this:</p>

<pre><code>import Foundation
import Vapor
import Fluent

struct Intubation: Model {
    var exists: Bool = false
    var id: Node?
    var intubationID: String
    var residentName: String
    var residentSpec: String
    var date: String
    var attending: String
    var PGY: String
    var medical: String?
    var technique: String
    var reason: String
    var dlifOverall: String
    var dsfOverall: String
    var dpfOverall: String
    var dvfOverall: String
    var dsafOverall: String
    var lowOxySatBefore: Int
    var lowOxySatDuring: Int
    var lowOxySatAfter: Int
    var lowSysBpBefore: Int
    var lowSysBpDuring: Int
    var lowSysBpAfter: Int
    var intubationOverall: String
    var comments: String


init(intubationID: String, date: String, residentName: String, residentSpec: String, attending: String, PGY: String, medical: String? = nil, technique: String, reason: String, dlifOverall: String, dsfOverall: String, dpfOverall: String, dvfOverall: String, dsafOverall: String, intubationOverall: String, comments: String, lowOxySatBefore: Int, lowOxySatDuring: Int, lowOxySatAfter: Int, lowSysBpBefore: Int, lowSysBpDuring: Int, lowSysBpAfter: Int) {

    self.intubationID = intubationID
    self.date = date
    self.residentName = residentName
    self.residentSpec = residentSpec
    self.attending = attending
    self.PGY = PGY
    self.medical = medical
    self.technique = technique
    self.reason = reason
    self.dlifOverall = dlifOverall
    self.dsfOverall = dsfOverall
    self.dpfOverall = dpfOverall
    self.dvfOverall = dvfOverall
    self.dsafOverall = dsafOverall
    self.intubationOverall = intubationOverall
    self.comments = comments
    self.lowSysBpAfter = lowSysBpAfter
    self.lowOxySatAfter = lowOxySatAfter
    self.lowSysBpBefore = lowSysBpBefore
    self.lowOxySatBefore = lowOxySatBefore
    self.lowSysBpDuring = lowSysBpDuring
    self.lowOxySatDuring = lowOxySatDuring
}

init(node: Node, in context: Context) throws {
    id = try node.extract(""id"")
    intubationID = try node.extract(""intubationID"")
    date = try node.extract(""date"")
    residentName = try node.extract(""residentName"")
    residentSpec = try node.extract(""residentSpec"")
    attending = try node.extract(""attending"")
    PGY = try node.extract(""PGY"")
    medical = try node.extract(""medical"")
    technique = try node.extract(""technique"")
    reason = try node.extract(""reason"")
    dlifOverall = try node.extract(""dlifOverall"")
    dsfOverall = try node.extract(""dsfOverall"")
    dpfOverall = try node.extract(""dpfOverall"")
    dvfOverall = try node.extract(""dvfOverall"")
    dsafOverall = try node.extract(""dsafOverall"")
    intubationOverall = try node.extract(""intubationOverall"")
    comments = try node.extract(""comments"")
    lowSysBpAfter = try node.extract(""lowSysBpAfter"")
    lowOxySatAfter = try node.extract(""lowOxySatAfter"")
    lowSysBpBefore = try node.extract(""lowSysBpBefore"")
    lowOxySatBefore = try node.extract(""lowOxySatBefore"")
    lowSysBpDuring = try node.extract(""lowSysBpDuring"")
    lowOxySatDuring = try node.extract(""lowOxySatDuring"")
}


func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [""id"": id,
                           ""intubationID"": intubationID,
                           ""residentName"": residentName,
                           ""residentSpec"": residentSpec,
                           ""attending"": attending,
                           ""PGY"": PGY,
                           ""medical"": medical,
                           ""technique"": technique,
                           ""reason"": reason,
                           ""dlifOverall"": dlifOverall,
                           ""dsfOverall"": dsfOverall,
                           ""dpfOverall"": dpfOverall,
                           ""dvfOverall"": dvfOverall,
                           ""dsafOverall"": dsafOverall,
                           ""intubationOverall"": intubationOverall,
                           ""comments"": comments,
                           ""lowSysBpAfter"": lowSysBpAfter,
                           ""lowOxySatAfter"": lowOxySatAfter,
                           ""lowSysBpBefore"": lowSysBpBefore,
                           ""lowOxySatBefore"": lowOxySatBefore,
                           ""lowSysBpDuring"": lowSysBpDuring,
                           ""lowOxySatDuring"": lowOxySatDuring])
}

static func prepare(_ database: Database) throws {
    try database.create(""intubations"") { intubations in
        intubations.id()
        intubations.string(""intubationID"")
        intubations.string(""residentName"")
        intubations.string(""residentSpec"")
        intubations.string(""attending"")
        intubations.string(""PGY"")
        intubations.string(""medical"")
        intubations.string(""technique"")
        intubations.string(""reason"")
        intubations.string(""dlifOverall"")
        intubations.string(""dsfOverall"")
        intubations.string(""dpfOverall"")
        intubations.string(""dvfOverall"")
        intubations.string(""dsafOverall"")
        intubations.string(""intubationOverall"")
        intubations.string(""comments"")
        intubations.int(""lowSysBpAfter"")
        intubations.int(""lowOxySatAfter"")
        intubations.int(""lowSysBpBefore"")
        intubations.int(""lowOxySatBefore"")
        intubations.int(""lowSysBpDuring"")
        intubations.int(""lowOxySatDuring"")
    }
}

static func revert(_ database: Database) throws {
    try database.delete(""intubations"")
}


}
</code></pre>

<p>This code does not allow Xcode to finish indexing. It gets stuck and does not finish and does not compile because it is busy trying to index. <strong>However!</strong> if it is marked as a <code>struct</code> and not a <code>class</code> it compiles and Xcode finishes indexing</p>
","4171692","","","","","2017-03-23 12:11:21","Xcode will not stop indexing when model is a class when using Vapor","<swift><xcode><vapor>","1","0","","","","42975237","118712","118712","vapor","592","36204589","36204588"
"42994912","1","43071333","","2017-03-24 08:42:37","","1","766","<p>I'm using Vapor to write a server side Swift API, with Fluent to access my Postgres database. It's working well, but I have a couple of questions about Pivots.</p>

<p>I have a Feed model and an Article model. The Feed contains many Articles, and an Article can appear in many Feeds. This is a Sibling relationship as defined by Fluent and I have a Pivot that works nicely for adding Articles to Feeds. However, it is currently possible to add the same Article to the same Feed more than once, since the primary key on the Feed_Article Pivot table is it's own unique id field.</p>

<p>I have two questions:</p>

<ol>
<li><p>How can I identify if a Pivot already exists?</p>

<ul>
<li>Do I need to get the Feed's sibling Articles and go through them to see if the Article's id is already in there? Seems a little painful.</li>
</ul></li>
<li><p>How can I delete a Pivot relationship?</p>

<ul>
<li>Ie. How can I remove an Article from a Feed?</li>
<li>At the moment the only way I can do it is by writing the raw SQL to delete from Feed_Article, but that seems wrong.</li>
</ul></li>
</ol>

<p>I'm using the VaporPostgreSQL driver, so I'm not sure that all of the Fluent implementations are available to me (eg. I can't use UUID ids as they are not part of this driver as yet.)</p>

<p>Thanks all</p>

<p>--TJ</p>

<p>Additional:</p>

<p>I've ended up creating a Pivot extension. It works, but it feels like there should be a nicer way to do this. Anyway, sharing in case it helps others.</p>

<pre><code>extension Pivot {

static func remove(leftId: Node?, rightId: Node?) throws {
    /// Get the database driver
    guard let db = drop.database?.driver as? PostgreSQLDriver else {
        Logger.error(""Failed to get database"")
        return
    }

    /// Check that we have valid id's
    guard let leftId = leftId?.int, let rightId = rightId?.int else {
        Logger.error(""Invalid id's"")
        return
    }

    /// Delete the rows
    let sql = ""DELETE FROM \(name) WHERE \(left.name)_\(left.idKey) = \(leftId) AND \(right.name)_\(right.idKey) = \(rightId)""
    Logger.debug(""SQL: \(sql)"")
    try db.raw(sql)
}

}
</code></pre>
","4222121","","4222121","","2017-03-24 11:44:01","2017-03-28 13:47:00","Deleting a Vapor Fluent Pivot","<swift><pivot><fluent><vapor>","1","0","","","","42994912","118712","118712","vapor","592","36204589","36204588"
"43023015","1","","","2017-03-25 23:09:17","","4","1171","<p>I have a config like this </p>

<pre><code>{
    ""default"": {
        ""port"": ""443"",
        ""host"": ""example.com"",
        ""securityLayer"": ""tls"",
        ""tls"": {
            ""certificates"": ""files"",
            ""certificateFile"": ""/etc/letsencrypt/live/example.com/fullchain.pem"",
            ""privateKeyFile"": ""/etc/letsencrypt/live/example.com/privkey.pem""
        }
    }
}
</code></pre>

<p>On <code>drop</code> startup it prints out this console message:</p>

<pre><code>No TLS signature supplied, defaulting to selfSigned.
</code></pre>

<p>Judging by the code that produces that error message it expects <code>signature</code> field in the config that would be either <code>selfSigned</code>, <code>signedFile</code> or <code>signedDirectory</code></p>

<p><a href=""https://i.stack.imgur.com/gLCGI.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/gLCGI.png"" alt=""enter image description here""></a></p>

<p>I have this files from <code>let's encrypt</code>: </p>

<ul>
<li>cert.pem  </li>
<li>chain.pem  </li>
<li>fullchain.pem  </li>
<li>privkey.pem</li>
</ul>

<p>What do I do to resolve that error message? </p>
","1675788","","1675788","","2017-03-26 11:02:34","2017-11-17 00:05:53","Setup SSL with vapor","<swift><ubuntu><ssl><lets-encrypt><vapor>","1","6","1","","","43023015","118712","118712","vapor","592","36204589","36204588"
"43026676","1","43076185","","2017-03-26 08:33:04","","0","141","<p>I am working on a project using <code>Vapor</code> and <code>Mongodb</code>. <br>
Let's say that at a specific route</p>

<pre><code>    drop.get(""user"", String.self) { request, user in
       // ... query Mongodb
    }
</code></pre>

<p>I want to query the database and see if an input user already exists. <br>
Is it wise to have a singleton <code>MongoManager</code> class that handles all the connection with the database?</p>

<pre><code>drop.get(""user"", String.self) { request, user in
           MongoManager.sharedInstance.findUser(user)
        }
</code></pre>

<p>Do I create a bottleneck with this implementation?</p>
","2713836","","","","","2017-03-28 17:32:15","Server Swift with mongodb manager singleton","<swift><mongodb><vapor>","1","0","1","","","43026676","118712","118712","vapor","592","36204589","36204588"
"43029375","1","43071152","","2017-03-26 13:30:54","","2","499","<p>I see in <code>vapor</code>, there's this <code>crypto.json</code> as part of any project created with <code>vapor toolbelt</code></p>

<pre><code>{
    ""hash"": {
        ""method"": ""sha256"",
        ""key"": ""password""
    },
    ""cipher"": {
        ""method"": ""chacha20"",
        ""key"": ""passwordpasswordpasswordpassword"",
        ""iv"": ""password""
    }
}
</code></pre>

<p>Should any of that be updated for deployment?</p>
","1675788","","","","","2017-03-28 13:38:29","Vapor's crypto.json - deployment-safe?","<swift><encryption><vapor>","1","2","","","","43029375","118712","118712","vapor","592","36204589","36204588"
"43036233","1","43070970","","2017-03-27 00:39:15","","2","153","<p>I am new to Vapor, and trying to get remote IP. Have anyone succeeded doing that? I have checked the request headers, but nothing related to ip showed up. I can't figure it out, so is there any round way I can do?</p>
","4585815","","","","","2017-03-28 13:29:32","How to get remote ip through Vapor","<swift><vapor>","1","0","","","","43036233","118712","118712","vapor","592","36204589","36204588"
"43070534","1","43070535","","2017-03-28 13:10:52","","12","2049","<p>How can I fix these OpenSSL / TLS issues I'm getting with Vapor 2? They are preventing me from compiling my project on the command line and in Xcode.</p>

<p>During SPM build:</p>

<pre><code>note: you may be able to install ctls using your system-packager:

    brew install ctls

note: you may be able to install ctls using your system-packager:

    brew install openssl
</code></pre>

<p>Upon failure of SPM build:</p>

<pre><code>Linking ./.build/debug/Run
ld: library not found for -lcrypto for architecture x86_64
&lt;unknown&gt;:0: error: link command failed with exit code 1 (use -v to see invocation)
&lt;unknown&gt;:0: error: build had 1 command failures
error: exit(1): /Library/Developer/Toolchains/swift-3.1-DEVELOPMENT-SNAPSHOT-2017-03-07-a.xctoolchain/usr/bin/swift-build-tool -f /Users/tanner/Desktop/PackageConfig/.build/debug.yaml
</code></pre>

<p>Also in SPM:</p>

<pre><code>&lt;module-includes&gt;:1:9: note: in file included from &lt;module-includes&gt;:1:
#import ""shim.h""
        ^
/Users/tanner/Desktop/PackageConfigTwo/.build/checkouts/ctls.git-9210868160426949823/shim.h:4:10: error: 'openssl/conf.h' file not found
#include &lt;openssl/conf.h&gt;
         ^
/Users/tanner/Desktop/PackageConfigTwo/.build/checkouts/crypto.git-7980259129511365902/Sources/Crypto/Cipher/Cipher+Method.swift:1:8: error: could not build Objective-C module 'CTLS'
import CTLS
       ^
</code></pre>

<p>In Xcode:</p>

<pre><code>/Users/tanner/PackageConfig/.build/checkouts/ctls.git-9210868160426949823/shim.h:4:10: 'openssl/conf.h' file not found

/Users/tanner/PackageConfig/.build/checkouts/crypto.git-7980259129511365902/Sources/Crypto/Cipher/Cipher+Method.swift:1:8: Could not build Objective-C module 'CTLS'

ld: library not found for -lssl
</code></pre>

<p><a href=""https://i.stack.imgur.com/PJmDe.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/PJmDe.png"" alt=""Xcode Failing with CTLS issues""></a></p>
","1041105","","1041105","","2017-03-29 12:49:07","2017-07-26 07:49:19","openssl / ctls trouble with vapor 2","<ssl><openssl><vapor>","2","0","6","","","43070534","118712","118712","vapor","592","36204589","36204588"
"43071458","1","43071459","","2017-03-28 13:51:47","","12","2168","<p>Vapor toolbox is crashing when trying to use it after upgrading to Swift 3.1.</p>

<pre><code>dyld: lazy symbol binding failed: Symbol not found: __TTSfq4n_s___TFVSS13CharacterView38_measureExtendedGraphemeClusterForwardfT4fromVVSS17UnicodeScalarView5Index_Si
  Referenced from: /usr/local/bin/vapor
  Expected in: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/macosx/libswiftCore.dylib

dyld: Symbol not found: __TTSfq4n_s___TFVSS13CharacterView38_measureExtendedGraphemeClusterForwardfT4fromVVSS17UnicodeScalarView5Index_Si
  Referenced from: /usr/local/bin/vapor
  Expected in: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/macosx/libswiftCore.dylib
</code></pre>
","1041105","","","","","2017-03-30 13:50:57","vapor toolbox broken after upgrading swift","<swift><vapor>","2","0","3","","","43071458","118712","118712","vapor","592","36204589","36204588"
"43077742","1","45949752","","2017-03-28 18:58:28","","0","781","<p>I followed some tutorials with Vapor and despite that I understood how to Get or Put or Patch some JSON values on the server, I have no idea how to send dictionary to Firebase from within the app.</p>

<p>I've tried to write some data on Firebase using Postman and I have no problem, <strong>but I have no idea how to handle the parameters of the request using Vapor ?</strong></p>

<p>Can anyone, please, tell me where I have to put the URL of the database and how to make the request? Or even better, if there's some example on GitHub, I can look at?</p>
","7227567","","5377805","","2017-03-31 20:07:23","2017-10-25 07:14:00","How to post a value in Firebase using Vapor?","<json><firebase><firebase-realtime-database><vapor>","2","0","","","","43077742","118712","118712","vapor","592","36204589","36204588"
"43079475","1","","","2017-03-28 20:37:09","","1","80","<p>Here's the snippet (here mysql is an instance of <a href=""https://github.com/vapor/mysql"" rel=""nofollow noreferrer"">MySQL for Swift</a>):</p>

<pre><code>do {
    try mysql.execute(""INSERT INTO ..."")
} catch {
    print(error) // here will print out the actual MySQL error message
    return error.localizedDescription // return ""The operation couldn’t be completed. (MySQL.Error error 6.)"" The real message from the DB is lost.
}
</code></pre>

<p>In the 1st line of the catch section, the print statement is able to spit out the real error message from DB, but the 2nd line only returns a generic statement:
<code>The operation couldn’t be completed. (MySQL.Error error 6.)</code></p>

<p>How do I access the underlining error message from the database? </p>
","400702","","","","","2017-04-17 08:42:31","How to access DB execution error when using MySQL for Swift","<swift><vapor>","1","0","","","","43079475","118712","118712","vapor","592","36204589","36204588"
"43094188","1","43094189","","2017-03-29 12:56:36","","8","541","<p>I'm getting the following error when trying to install Vapor's CTLS package. </p>

<pre><code>Gertrude:ctls tanner$ brew install ctls
Error: No available formula with the name ""ctls"" 
==&gt; Searching for similarly named formulae...
Error: No similarly named formulae found.
==&gt; Searching taps...
Error: No formulae found in taps.
</code></pre>
","1041105","","","","","2017-03-29 12:56:36","brew: no formula called ctls","<swift><ssl><homebrew><vapor>","1","0","","","","43094188","118712","118712","vapor","592","36204589","36204588"
"43135311","1","","","2017-03-31 07:47:41","","3","439","<p>I've been working with Vapor and Heroku for a few weeks now and it is all going well. Vapor is fab! ;] I have been successfully updating the app on Heroku using <code>git push heroku master</code> until yesterday evening when I started to get this error:</p>

<pre><code>$ git push heroku master
Counting objects: 26, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (24/24), done.
Writing objects: 100% (26/26), 7.37 KiB | 0 bytes/s, done.
Total 26 (delta 15), reused 0 (delta 0)
remote: Compressing source files... done.
remote: Building source:
remote: 
remote: -----&gt; Swift app detected
remote: Cloning into 'swiftenv'...
remote: Swift 3 Heroku Installer
remote: 🔢  Version: 3.0.2
remote: 🖥  Operating System: ubuntu1404
remote: 📦 Installing Swiftenv
remote: Cloning into '/app/.swiftenv'...
remote: 🐦 Installing Swift
remote: Downloading https://swift.org/builds/swift-3.0.2-release/ubuntu1404/swift-3.0.2-RELEASE/swift-3.0.2-RELEASE-ubuntu14.04.tar.gz
remote: /tmp/swiftenv-3.0.2- /tmp/build_577666a1ce2003bd1d820e031bc0f306
remote:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
remote:                                  Dload  Upload   Total   Spent    Left  Speed
remote: 100  113M  100  113M    0     0  8057k      0  0:00:14  0:00:14 --:--:-- 8613k
remote: /tmp/build_577666a1ce2003bd1d820e031bc0f306
remote: 3.0.2 has been installed.
remote: ✅  Done
remote: precompile
remote: -----&gt; Installing toolbox
remote: Downloading...
remote: Compiling...
remote: &lt;unknown&gt;:0: error: build had 1 command failures
remote: swift-build: error: exit(1): /app/.swiftenv/versions/3.0.2/usr/bin/swift-build-tool -f /tmp/build_577666a1ce2003bd1d820e031bc0f306/vapor-toolbox/.build/debug.yaml
remote:  !     Push rejected, failed to compile Swift app.
remote: 
remote:  !     Push failed
remote: Verifying deploy....
remote: 
remote: !   Push rejected to zzzzzzzz.
remote: 
To https://git.heroku.com/zzzzzzzz.git
 ! [remote rejected] master -&gt; master (pre-receive hook declined)
error: failed to push some refs to 'https://git.heroku.com/zzzzzzzz.git'
</code></pre>

<p>The master branch of my repo is clean and up to date with no commits pending from elsewhere (there's only be working on the code).</p>

<p>Any thoughts would be greatly appreciated.</p>

<p>Thanks
--TJ</p>
","4222121","","","","","2017-03-31 11:05:18","Vapor: git push heroku master is failing","<swift><git><heroku><master><vapor>","1","2","1","","","43135311","118712","118712","vapor","592","36204589","36204588"
"43219809","1","","","2017-04-05 00:14:38","","1","127","<p>I just recently updated to Vapor 2.0 beta and I'm receiving this error at run time. What is causing this?</p>

<pre><code>fatal error: Error raised at top level: Configuration error: Key `hash.encoding` in `Config/crypto.json` of type String required.: file /Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-802.0.48/src/swift/stdlib/public/core/ErrorType.swift, line 188
</code></pre>
","3945535","","1041105","","2017-04-18 08:13:45","2017-04-18 08:13:45","key hash.encoding in crypto.json required","<beta><vapor>","1","0","","","","43219809","118712","118712","vapor","592","36204589","36204588"
"43227299","1","43230145","","2017-04-05 09:34:44","","1","2021","<p>I am currently following the small and brief introduction to Swift Vapor by following their ""Hello World"" tutorial on their website. However I keep getting an error from swift-package when I try to build the project where it shows the following.</p>

<pre><code>$ vapor build
No .build folder, fetch may take a while...
Fetching Dependencies [Failed]
Error: swift-package: error: unknown command: --enable-prefetching
</code></pre>

<p>I cannot seem to find out how to resolve this online. Anybody have any idea?</p>
","3340791","","1041105","","2017-04-18 08:14:23","2017-08-07 19:05:08","vapor build command not working with Swift 3.0","<swift><vapor>","4","1","","","","43227299","118712","118712","vapor","592","36204589","36204588"
"43311853","1","43404709","","2017-04-09 20:56:52","","2","978","<h3>Context:</h3>

<p>Recently, I've decided to take up Swift server side development because I think the Vapor framework is extremely cool. I've gotten a bit stuck while experimenting and would like some advice on templating with leaf and vapor.</p>

<p>I've reviewed the documentation several times when it comes to rendering views. Rendering a templated view with variables requires the name of the leaf template and a Response Representable node object containing the variables. </p>

<p>Trying to work out a scenario with templating and the framework itself (because that's how I learn best), I tried to mock a blog format. This is my class/get request:</p>

<pre><code>// MARK: Blog Post Object

final class BlogPost: NodeRepresentable {

    var postId: Int
    var postTitle: String
    var postContent: String
    var postPreview: String

    func makeNode(context: Context) throws -&gt; Node {
        return try Node(node: [
            ""postId"":self.postId,
            ""postTitle"":self.postTitle,
            ""postContent"":self.postContent,
            ""postPreview"":self.postPreview
        ])
    }

    init(_ postId: Int, _ postTitle: String, _ postContent: String) {

        self.postId = postId
        self.postTitle = postTitle
        self.postContent = postContent
        self.postPreview = postContent.trunc(100)
    }
}


// MARK: Blog view request; iterate over blog objects

drop.get(""blog"") { request in
    let result = try drop.database?.driver.raw(""SELECT * FROM Posts;"")

    guard let posts = result?.nodeArray else {
        throw Abort.serverError
    }

    var postCollection = [BlogPost]()


    for post in posts {
        guard let postId = post[""postId""]?.int,
            let postTitle = post[""postTitle""]?.string,
            let postContent = post[""postPreview""]?.string else {
                throw Abort.serverError
        }

        let post = BlogPost(postId, postTitle, postContent)
        postCollection.append(post)
    }

    // Pass posts to be tokenized

    /* THIS CODE DOESN'T WORK BECAUSE ""CANNOT CONVERT VALUE OF TYPE 
     * '[BLOGPOST]' TO EXPECTED DICTIONARY VALUE OF TYPE ""NODE""
     * LOOKING FOR THE BEST METHOD TO PASS THIS LIST OF OBJECTS
     */

    drop.view.make(""blog"", [
        ""posts"":postCollection 
    ])

}
</code></pre>

<p>and this is my <code>blog.leaf</code> file:</p>

<pre><code>#extend(""base"")

#export(""head"") {
    &lt;title&gt;Blog&lt;/title&gt;
}

#export(""body"") {

    &lt;h1 class=""page-header""&gt;Blog Posts&lt;/h1&gt;

    &lt;div class=""page-content-container""&gt;

    #loop(posts, ""posts"") {
        &lt;div class=""post-container""&gt;
            &lt;h3 style=""post-title""&gt;#(posts[""postTitle""])&lt;/h3&gt;
            &lt;p style=""post-preview""&gt;#(posts[""postPreview""])&lt;/h3&gt;
        &lt;/div&gt;
    }

    &lt;/div&gt;

}
</code></pre>

<h3>Problem:</h3>

<p>As you can see, I'm a bit stuck on finding the best method for iterating over objects and templating their properties into the leaf file. Anyone have any suggestions? Sorry for the bad programming conventions, by the way. I'm fairly new in Object/Protocol Oriented Programming. </p>
","4262249","","5236226","","2017-04-11 15:08:24","2018-01-28 08:38:56","What's the best way to return a collection of response representable objects in Swift Vapor?","<swift><vapor><leaf>","3","0","0","","","43311853","118712","118712","vapor","592","36204589","36204588"
"43345727","1","43349630","","2017-04-11 12:19:09","","2","1176","<p>I am new to web development and couldn't find a clear answer.</p>

<p>Is it possible to use Bootstrap in Vapor with Swift 3?</p>
","1051938","","5236226","","2017-04-11 15:02:53","2017-04-11 15:02:53","Use Bootstrap on Vapor","<swift><bootstrap-4><vapor>","1","2","1","","","43345727","118712","118712","vapor","592","36204589","36204588"
"43358706","1","43448119","","2017-04-12 01:23:28","","3","964","<p>In a vapor project, my folder structure is the following:</p>

<pre><code>Package.swift
Sources/
    -App/
    -Module1/
        -File1.swift
        -File2.swift
        -File3.swift
    -Module2/
        -File4.swift
        -File5.swift
        -File6.swift
</code></pre>

<p>After adding the 2 modules in each one of them, I edited the package.swift file to be the following:</p>

<pre><code>let package = Package(
    name: ""myapp"",
    targets: [
        Target(name: ""App"", dependencies: [""Module1"", ""Module2""])
    ],
    dependencies: [
        // Some external dependencies
    ],
    exclude: [
        // Excludes
    ]
)
</code></pre>

<p>Importing the 2 local modules works fine, yet when I try to use any functions / objects contained within them I get an ""unresolved identifier error""</p>

<p>Anything I am missing?</p>
","6616224","","","","","2017-04-17 08:45:43","Swift Package Manager, adding local dependencies","<swift3><vapor><swift-package-manager>","1","0","1","","","43358706","118712","118712","vapor","592","36204589","36204588"
"43497283","1","","","2017-04-19 13:32:37","","2","567","<p>Friend model contain the address reference. Address is saving but not able to retrieve from the end point.</p>

<p><strong>Friend Model</strong></p>

<pre><code>        import Foundation
        import Vapor
        import Fluent

        struct Friend: Model {
            var exists: Bool = false
            var id: Node?
            var name: String
            var age: Int
            var email: String
            var residence: FriendAddress

            init(name: String, age: Int, email: String, residence: FriendAddress) {
                self.name = name
                self.age = age
                self.email = email
                self.residence = residence
            }

            // NodeInitializable
            init(node: Node, in context: Context) throws {
                id = try node.extract(""_id"")
                name = try node.extract(""name"")
                age = try node.extract(""age"")
                email = try node.extract(""email"")
                residence = try node.extract(""residence"")
            }

            // NodeRepresentable
            func makeNode(context: Context) throws -&gt; Node {
                return try Node(node: [""_id"": id,
                                       ""name"": name,
                                       ""age"": age,
                                       ""email"": email,
                                       ""residence"": residence
                    ])
            }

            // Preparation
            static func prepare(_ database: Database) throws {
                try database.create(""friends"") { friends in
                    friends.id()
                    friends.string(""name"")
                    friends.int(""age"")
                    friends.string(""email"")
                    friends.string(""residence"")
                }
            }

            static func revert(_ database: Database) throws {
                try database.delete(""friends"")
            }
        }
</code></pre>

<p>Friend Address Model contains owner_id acting as a foreign key (Friend Model)</p>

<p><strong>Friend Addresss Model</strong></p>

<pre><code>    import Foundation
    import Vapor
    import Fluent

    struct FriendAddress: Model {

        var id: Node?
        var owner_id: Node?
        var address: String
        var address2: String
        var pinCode: Int

        init(address: String, address2: String, pinCode: Int, owner_id: Node? = nil ) {
            self.address = address
            self.address2 = address2
            self.pinCode = pinCode
            self.owner_id = owner_id
        }

        // NodeInitializable
        init(node: Node, in context: Context) throws {
            id = try node.extract(""_id"")
            address = try node.extract(""address"")
            address2 = try node.extract(""address2"")
            pinCode = try node.extract(""pinCode"")
            owner_id = try node.extract(""owner_id"")

        }

        // NodeRepresentable
        func makeNode(context: Context) throws -&gt; Node {

            return try Node(node: [
                        ""_id"": id,
                        ""address"": address,
                        ""address2"": address2,
                        ""pinCode"": pinCode,
                        ""owner_id"": owner_id])
        }

        // Preparation
        static func prepare(_ database: Database) throws {
            try database.create(""friendAddress"") { friendaddress in
                friendaddress.id()
                friendaddress.string(""address"")
                friendaddress.int(""address2"")
                friendaddress.string(""pinCode"")
                friendaddress.parent(Friend.self, optional: false)

            }
        }

        static func revert(_ database: Database) throws {
            try database.delete(""friendAddress"")
        }
    }
</code></pre>

<p><strong>main.swift</strong></p>

<pre><code>import Vapor
import VaporMongo
import Fluent

import Foundation

let drop = Droplet()
//drop.preparations.append(Friend.self)
drop.preparations = [Friend.self, FriendAddress.self, Pivot&lt;Friend, FriendAddress&gt;.self]

do {
    try drop.addProvider(VaporMongo.Provider.self)
} catch {
    assertionFailure(""Error adding provider: \(error)"")
}

let friendController = FriendController()
friendController.addRoutes(drop: drop)

drop.resource(""posts"", PostController())
drop.run()
</code></pre>
","5949679","","","","","2017-04-19 13:32:37","How to make a Nested Json Model in Vapor Swift Server , Below are the Code for the reference..?","<swift><swift3><backend><vapor>","0","2","1","","","43497283","118712","118712","vapor","592","36204589","36204588"
"43504519","1","","","2017-04-19 19:30:22","","12","1711","<p>I'm building a classic database backed, dynamic website, that will allow users to share leads. </p>

<p>I'm a little old school, and want to implement my system using a pure MVC architecture. I'm considering using React in a pure 'V' mode, with Vapor fulfilling the 'M' and 'C' roles. I need some help understanding how to integrate Vapor and React, or more precisely decide where some functionality is best to reside.</p>

<p>My Vapor server side app, handles all security, routing, models (which are stored in  a PostgreSQL DB via Fluent) and model controllers. The model controllers only output pure JSON responses, to requests that will have been through middleware layers that: check a user's permissions to access a 'command' (based on a role profile held in the database, to allow dynamic changes to privilege); verify permission to access the associated record (based on a hierarchy of groups they can be members of); and also to log actions that a user is taking.</p>

<p>Up to this point I've been using the Leaf templating engine to generate the .html files for the web site a user would use. The Leaf template is normally passed only one or two attributes - say the id of the record which is going to be displayed, and then I use some javascript to pull in the data via AJAX calls back to the model controller. The model controller and middleware has access to the cookie for all user auth / session related needs. This keeps a very clean separation between the model and view, and would allow me to more easily build say a mobile app that calls the model RESTful interfaces in the future.</p>

<p>Now I am thinking of using React for the web front end, using the React-Bootstrap library. But to be honest I'm getting a little lost of how to integrate this properly. For example to render a page to display a record - how do I pass over the record id (pseudo code warning!):</p>

<p>a) Should I create a leaf template into which I pass the id as a parameter. The template would simply have a short piece of javascript to pass the parameter onto the react.js script? Vapor side would look something like:</p>

<pre><code>drop.get(""viewRecord"", myObject) { request in
    let parameters = try Node(node:[""objectId"": myObject?.id.makeNode()])
    return try webApp.view.make(""viewObject"", parameters)
}
</code></pre>

<p>And .leaf template would have a bit like:</p>

<pre><code>&lt;script ...&gt;
    var objectID = #(viewObject.id)
&lt;/script&gt;
</code></pre>

<p>b) Or should I make a call such as, where I pass the id as a URL param, which I would then extract with a little javascript and pass into a react component:</p>

<pre><code>drop.get(""viewRecord"", myObject) { request in
     return Response(redirect: ""/viewObject.html"", myObject?.Id)
}
</code></pre>

<p>c) Some other way within Vapor? Am I missing the point with React? I thought it was meant to be focused no the front end and agnostic about backend, but the React Router suggests it wants some backend work too?</p>

<p>d) Abandon React, and say stick with leaf?</p>

<p>On this last point - if I go the React way, would I have a .jsx file (transpiled to .js) for every ""screen"" that I would have built a leaf template for? If so how would I go about reducing the file sizes down by referencing common elements (such as react and react-bootstrap components). At the moment I'm using Webpack to produce a single .js file. Am assuming I would not use React router, as I use Vapor for this.</p>

<p>Sorry, if some of this is quite basic, but I'm more comfortable with the backend, but want the front end to be well engineered too, and to get the split of responsibilities optimal.</p>

<p>Thank you for your considered ideas!</p>
","7820216","","","","","2018-01-23 07:40:27","Integrating Vapor and React","<swift><reactjs><vapor>","2","3","3","","","43504519","118712","118712","vapor","592","36204589","36204588"
"43574035","1","","","2017-04-23 17:01:29","","1","508","<p>I am creating a basic CRUD using Swift and Vapor (server-side). </p>

<p>In my controller I created a new method: “edit”. In this method, it’s possible update user’s password and roles. <strong>IF</strong> the request has a password data, update the password. <strong>IF</strong> the request has a new array of roles, update the roles (sibling relationship wich is not done yet).</p>

<p>This is the ""edit"" method in my Controller:</p>

<pre><code>func edit(request:Request, id:String) throws -&gt; ResponseRepresentable {
    // Check if the password came in POST request:
    let password = request.data[""password""]?.string

    // Check if the request has a new set of roles
    let roles = request.data[""roles""]?.array

    let user:ClinicUser = try ClinicUser.edit(id: id, password: password, roles: roles)
    return user
}
</code></pre>

<p>And in my model the edit method looks like this:</p>

<pre><code>static func edit(id:String, password:String?, roles:Array&lt;NodeRepresentable&gt;?) throws -&gt; ClinicUser {
    guard var user:ClinicUser = try ClinicUser.find(id) else {
        throw Abort.notFound
    }
    // Is it the best way of doing this? Because with ""guard"" I should ""return"" or ""throw"", right?
    if password != nil {
        user.password = try BCrypt.hash(password: password!)
    }

    // TODO: update user's roles relationships

    try user.save()

    return user
}
</code></pre>

<p>In my controller, there is an error pointed by XCode that says <code>Cannot convert value of type '[Polymorphic]?' to expected argument type 'Array&lt;NodeRepresentable&gt;'</code>. And, as fix, Xcode suggests write like this:</p>

<pre><code>let user:ClinicUser = try ClinicUser.edit(id: id, password: password, roles: roles as! Array&lt;NodeRepresentable&gt;)
</code></pre>

<p>I am not sure if this is safe or if this it is a best practice (forcing the unwrap with <strong>!</strong>).</p>

<p>I do not know if in Swift I should ""think"" differently than other languages (like PHP, etc). In the end, what I want is:</p>

<pre><code>static func edit(id:String, fieldA:String?, fieldN:String, etc..) throws -&gt; ClinicUser {
    // If fieldA is available, update fieldA:
    if fieldA != nil {
        model.fieldA = fieldA
    }

    // If fieldN is available, update fieldN:
    if fieldN != nil {
        model.fieldN = fieldN
    }

    // After update all fields, save:
    try model.save()

    // Return the updated model:
    return model
}
</code></pre>
","483510","","","","","2017-05-10 16:25:01","Swift with Vapor: optionally update model field based in reques","<swift><vapor>","1","1","","","","43574035","118712","118712","vapor","592","36204589","36204588"
"43588402","1","","","2017-04-24 12:43:43","","0","553","<p><strong>This is the model and I have to change it to mongo model using mongokitten.</strong></p>

<p>This is my friend Model and I have implemented.
This but not able to make a nested json like structure for this mode.</p>

<pre><code>import Foundation
import Vapor
import Fluent

     struct Friend: Model {
        var exists: Bool = false
        var id: Node?
        var name: String
        var age: Int
        var email: String
        var residence: FriendAddress

        init(name: String, age: Int, email: String ,residence: FriendAddress) {
            self.name = name
            self.age = age
            self.email = email
            self.residence = residence
        }

        // NodeInitializable
        init(node: Node, in context: Context) throws {
            id = try node.extract(""_id"")
            name = try node.extract(""name"")
            age = try node.extract(""age"")
            email = try node.extract(""email"")
            residence = try node.extract(""residence"")
        }

        // NodeRepresentable
        func makeNode(context: Context) throws -&gt; Node {
            return try Node(node: [""_id"": id,
                                   ""name"": name,
                                   ""age"": age,
                                   ""email"": email,
    //                               ""residence"": residence
                ])
        }

        // Preparation
        static func prepare(_ database: Database) throws {
            try database.create(""friends"") { friends in
                friends.id(""_id"")
                friends.string(""name"")
                friends.int(""age"")
                friends.string(""email"")
                friends.string(""residence"")
            }
        }

        static func revert(_ database: Database) throws {
            try database.delete(""friends"")
        }
    }
</code></pre>

<p>basically need a json structure like this,</p>

<p>for eg:</p>

<pre><code>{    
""name"": ""anil"",
 ""age"": 12,
  ""   email"": ""anilklal91@gmail.com"",
     ""residence"": {
    ""address"": ""first address 1"",
    ""address2"": ""second address 2"",
    ""pinCode"" : 110077
     }
 }
</code></pre>
","5949679","","3214843","","2017-04-28 06:56:49","2017-07-28 01:35:25","How to create a model in vapor using Mongokitten","<mongodb><swift3><vapor>","1","2","0","","","43588402","118712","118712","vapor","592","36204589","36204588"
"43623646","1","43624047","","2017-04-26 01:45:36","","2","259","<p>I am using Vapor to write a simple web app. I have an entity to save session info into a database. The code for this entity is as follows:</p>

<pre><code>struct SessionToken: Model{
    var exists: Bool = false
    var id: Node?
    var username: String
    var accessToken: String
    var expiryDate: String

    init(username: String, accessToken: String, expiryDate: String) {
        self.username = username
        self.accessToken = accessToken
        self.expiryDate = expiryDate
    }

    init(node: Node, in context: Context) throws {
        try self.id = node.extract(""id"")
        try self.username = node.extract(""username"")
        try self.accessToken = node.extract(""accessToken"")
        try self.expiryDate = node.extract(""expiryDate"")
    }


    func makeNode(context: Context) throws -&gt; Node {
        let sessionToken = try Node(node:[""id"": id, ""username"": username, ""accessToken"": accessToken, ""expiryDate"": expiryDate])
        return sessionToken
    }


    static func prepare(_ database: Database) throws {
        try database.create(""sessiontokens""){ sessiontokens in
            sessiontokens.id()
            sessiontokens.string(""username"")
            sessiontokens.string(""accessToken"")
            sessiontokens.string(""expiryDate"")

        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(""sessiontokens"")
    }

}
</code></pre>

<p>I enter some fake info into the database, but when I query the database with the following code: </p>

<pre><code>let token = try SessionToken.query().filter(""username"", ""user@email.com"").first()
</code></pre>

<p>I get an error: <code>Could not initialize SessionToken, skipping: unableToConvert(node: nil, expected: ""String"")</code></p>

<p>The funny thing is that when I replace <code>SessionToken</code> with any other entity in the project the code works just fine. The only entity I am having trouble fetching any info from the database is <code>SessionToken</code> and it has been frustrating me since last night! </p>

<p>I would really appreciate it if someone could point me in the right direction to solve this problem.</p>

<p>P.S. I am using Postgres.</p>
","6662600","","6662600","","2017-05-25 23:31:26","2017-05-25 23:31:26","Why does my Vapor query always fail?","<ios><swift><postgresql><vapor>","1","0","","","","43623646","118712","118712","vapor","592","36204589","36204588"
"43629383","1","","","2017-04-26 08:54:54","","4","1630","<p>I am building an iOS application in Swift that needs to be able to validate a JWT token signature with a public key certificate using either RS256 or RS512. </p>

<p>I've been trying to find libraries that support such functionalities but have had issues implementing the ones I have found.</p>

<p>My question is therefore what the recommended way to implement such functionality for a Swift iOS app is?</p>

<p>The ideal scenario is to be able to use one of the recognized frameworks on JWT.io. The only Swift library on JWT.io that supports RS256 or RS512 is the following library:
<a href=""https://github.com/vapor/jwt"" rel=""nofollow noreferrer"">https://github.com/vapor/jwt</a></p>

<p>The functionalities this library supports are ideal, but it however requires implementation through Swift Package Manager, and is built using Vapor. Swift Package manager is currently not supported for iOS, but I've read that there are workarounds to get the swift package manager to work with iOS apps. These are workarounds is willing to take if the Library could function on the the iOS application. However as the library is built for Vapor, my question is if it is even possible to get the library to function on the iOS app I'm building?</p>

<p>If it is not possible use this Library, are there any other libraries that are recommended to use? If not, what is the recommended way to implement this requested functionality? Are there recommended Objective-C libraries that could function on the application?</p>

<p>Thanks in Advance!</p>

<p>Edit:
By validating I mean that I would like to verify that the signature in the token is correct, meaning that the JWT token has been signed with a private key on the server that the public key cert on the application is corresponding to. Not just decode the Base64Check payload.</p>

<p>Edit 2:
What I'm trying to achieve is functionality that supports asymmetric keys, meaning that the secret must <strong>not</strong> be stored on both the server and the client application. I'm trying to achieve that the application is only containing non secret information, hence a public key certificate.</p>
","7497233","","7497233","","2017-04-26 09:24:12","2018-03-08 13:23:23","Validate JWT token with RS256 or RS512 with Swift iOS","<ios><objective-c><swift><jwt><vapor>","1","4","2","","","43629383","118712","118712","vapor","592","36204589","36204588"
"43655456","1","","","2017-04-27 10:41:51","","0","78","<p><a href=""https://i.stack.imgur.com/quRPj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/quRPj.png"" alt=""enter image description here""></a></p>

<p>Database constructor is throwing a complier error when connecting a mongodb server using the mongokitten, image is attached for the reference.</p>
","5949679","","","","","2017-05-09 20:31:52","Error while connecting swift server side with mongokitten","<mongodb><swift3><vapor>","1","0","","","","43655456","118712","118712","vapor","592","36204589","36204588"
"43755472","1","43756687","","2017-05-03 08:56:08","","2","692","<p>using swift vapor and elasticsearch, got a response like:</p>

<p><code>{
    ""_shards"": {
        ""failed"": 0,
        ""successful"": 5,
        ""total"": 5
    },
    ""hits"": {
        ""hits"": [
            {
                ""_id"": ""3"",
                ""_index"": ""items_v1"",
                ""_score"": 1.2029922,
                ""_source"": {
                    ""property1"": ""test"",
                    ""property2"": ""another test"",
                    ...
                },
                ""_type"": ""item""
            },
            ...
</code></p>

<p>inside ""hits"" -> ""hits"" -> ""_source"" I got all the properties of my model ""Item"". How can I create an array of Items ""[Item]"" from this json response?</p>
","2458616","","","","","2017-08-24 13:16:46","swift vapor json response to array","<arrays><swift><elasticsearch><swift3><vapor>","4","0","","","","43755472","118712","118712","vapor","592","36204589","36204588"
"43758621","1","","","2017-05-03 11:21:28","","0","292","<p>I'm working with Vapor in Xcode, deploying to Heroku.
My web app is working perfectly. Really pleased with Vapor and how easy it is to deploy to Heroku.</p>

<p>I'm now trying to create a separate Heroku Worker process in the same project. I've added the new worker to my Heroku Procfile, but I am not clear how I should set up the second target in the Xcode project so that it doesn't get overwritten every time I run <code>vapor xcode</code> to rebuild the project file.</p>

<p>My Procfile looks like this:</p>

<pre><code>web: App --env=production --workdir=./ --config:servers.default.port=$PORT --config:postgresql.url=$DATABASE_URL
worker: Worker --env=production --workdir=./ --config:servers.default.port=$PORT --config:postgresql.url=$DATABASE_URL
</code></pre>

<p>So, as you can see, I simply want a second app executable called <code>Worker</code> that I can start up within a Heroku worker dyno.</p>

<p>Any idea how I can have a web App target and a separate worker target in my Xcode project that won't get overwritten by <code>vapor xcode</code>?</p>

<p>Thanks
--TJ</p>
","4222121","","","","","2017-05-03 15:08:50","Multiple targets in Vapor Xcode project","<swift><heroku><targets><vapor>","1","0","","","","43758621","118712","118712","vapor","592","36204589","36204588"
"43822584","1","44068461","","2017-05-06 16:07:28","","3","780","<p>I would like to have a table with a string column as a primary key without having to use raw SQL syntax.</p>

<p>Here's my fluent ""preparation"":</p>

<pre><code>static func prepare(_ database: Database) throws {    
    try database.create(""roles"") { roles in
        roles.id(""name"")
        roles.string(""readable_name"")
    }
}
</code></pre>

<p>According to both my tests and the docs, resulting query will be similar to:</p>

<pre><code>CREATE TABLE `roles` (`name` INTEGER PRIMARY KEY NOT NULL, `readable_name` TEXT NOT NULL)
</code></pre>

<p>I could not, so far, find a way to have a string (TEXT, VARCHAR, ...) as a primary key without raw SQL syntax and i would like to know whether it's possible to do it or not using the fluent query builder which comes with vapor.</p>
","6041995","","","","","2017-05-19 11:06:41","string primary key with vapor + fluent","<swift><database><backend><vapor>","1","0","","","","43822584","118712","118712","vapor","592","36204589","36204588"
"43837266","1","","","2017-05-07 22:14:01","","0","316","<p>$ curl -sL toolbox.vapor.sh | bash <br> 
This script is deprecated.
Please install through Homebrew or APT</p>

<p>$ eval ""$(curl -sL <a href=""https://apt.vapor.sh"" rel=""nofollow noreferrer"">https://apt.vapor.sh</a>)"" <br>
Only Ubuntu 14.04, 16.04, and 16.10 are supported. <br>
You are running 17.04 </p>

<p>I'm using Ubuntu 17.04 <br>
or i have to wait Vapor support.</p>
","3023834","","","","","2017-05-08 19:27:34","Installing Vapor Toolbox on Ubuntu 17.04","<toolbox><vapor><ubuntu-17.04>","1","0","","","","43837266","118712","118712","vapor","592","36204589","36204588"
"43878252","1","","","2017-05-09 19:22:26","","0","798","<p>I know you can do <code>Model.delete() and Model.save()</code> </p>

<p>Is there a way to update an existing row?</p>
","6616224","","","","","2017-05-23 13:13:33","Swift Vapor Fluent updating an existing row","<swift><fluent><vapor>","2","0","","","","43878252","118712","118712","vapor","592","36204589","36204588"
"43881133","1","43932520","","2017-05-09 23:02:35","","1","323","<p>So I have a <code>vapor</code> \ <code>fluent</code> app that works fine with local mongo instance, here's current <code>mongo.json</code>:</p>

<pre><code>{
    ""database"" : ""vapor"",
    ""port"" : ""27017"",
    ""host"" : ""127.0.0.1"",
    ""user"" : """",
    ""password"" : """"
}
</code></pre>

<p>I've deployed a free <code>MongoDB Atlas</code> 3 replica set and I wonder how do I connect the app to it?</p>
","1675788","","","","","2017-05-12 08:03:07","How to connect vapor to mongodb atlas","<swift><mongodb><vapor><mongodb-replica-set><mongodb-atlas>","2","0","","","","43881133","118712","118712","vapor","592","36204589","36204588"
"43908892","1","44068428","","2017-05-11 07:17:28","","3","1137","<p>When I launch this command line <strong><em>vapor run prepare</em></strong>, I get the correct tables but the foreign key constraints are not added.</p>

<p>I have a Theme class and a Question class :</p>

<p>Theme:
name,
id</p>

<p>Question:
title,
id,
theme_id</p>

<p>This is the prepare Database function in my Question class : </p>

<pre><code>static func prepare(_ database: Database) throws {

        try database.create(""questions"") { questions in
            questions.id()
            questions.string(""title"")
            questions.parent(Theme.self, optional: false)
        }


    }
</code></pre>
","7995795","","","","","2017-07-16 12:33:06","Add Foreign Key Constraint Swift Vapor Fluent with PostgreSQL","<swift><postgresql><foreign-keys><fluent><vapor>","2","0","1","","","43908892","118712","118712","vapor","592","36204589","36204588"
"43980123","1","","","2017-05-15 12:54:44","","1","426","<p>Using swift vapor, on mac it is working fine, on linux my async call with Jobs dies at</p>

<p><code>try FileManager.default.createDirectory(atPath: directoryPath, withIntermediateDirectories: true, attributes: nil)</code></p>

<p>I'm printing the directory path before this line of code (the path is correct so far) and the print statement after this line is not getting executed, instead the log file shows:</p>

<blockquote>
  <p>Jobs caught an error: The operation could not be completed</p>
</blockquote>

<p>The <code>directoryPath</code> is:</p>

<pre><code>/.../FOO/.../Public/images/items/2017/05/15/
</code></pre>

<p>Until the directory <code>2017</code> all dirs exists, but not the last two <code>05</code> and <code>15</code>. On mac if they not exists, they got created. On linux it throws the error mentionend above.</p>
","2458616","","819340","","2017-05-15 13:04:20","2017-06-09 14:38:16","swift FileManager.default.createDirectory() on linux not working","<swift><linux><swift3><vapor>","0","2","0","","","43980123","118712","118712","vapor","592","36204589","36204588"
"44001252","1","","","2017-05-16 12:17:43","","0","224","<p>I'm using the Vapor framework to download a PDF file :</p>

<pre><code>    let logpw = ""myLogin:passWord""
    let url = ""https://someRESTsite/invoices/1.pdf""
    let utf8str = logpw.data(using: String.Encoding.utf8)
    let base64Encoded = utf8str?.base64EncodedString()

    let response = try drop.client.get(url, headers:[""Authorization"":""Basic "" + base64Encoded!])
</code></pre>

<p>this works fine. Note that I'm base64 encoding the login/pw for basic auth and this works for logging in and getting the file. Now I have to embed that PDF into an XML file in base64 using similar code:</p>

<pre><code>if let bodyBytes = response.body.bytes {

    let bodyByteString = try String(bytes: bodyBytes)
    let utf8String = bodyByteString(using: String.Encoding.utf8)
    let base64String = utf8String?.base64EncodedString()
}
</code></pre>

<p>the result is a string that actually really looks like a base64 string, but it's different than converting the same PDF using an online tool (I tried 2 which gave the same result).</p>

<p>Where is my mistake?</p>
","439673","","","","","2017-05-16 12:17:43","Swift base64 not ok","<swift><base64><vapor>","0","2","","","","44001252","118712","118712","vapor","592","36204589","36204588"
"44043977","1","44067827","","2017-05-18 09:34:22","","2","344","<p>I need some help about saving bytes in Vapor : 
I have this Image class :</p>

<pre><code>class Image: Model {
var id: Node?
var datas: Bytes
var name: String
var exists: Bool = false

init(name: String, datas: Bytes) {
    self.name = name
    self.datas = datas
}

// NodeInitializable
required init(node: Node, in context: Context) throws {
    self.id = try node.extract(""id"")
    self.datas = try node.extract(""datas"")
    self.name = try node.extract(""name"")
}

// NodeRepresentable
func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [""id"": id,
                           ""name"": name,
                           ""datas"": datas.string()
                           ])
}

// Preparation
static func prepare(_ database: Database) throws {


    try database.create(""images"") { categories in
        categories.id()
        categories.string(""name"")
        categories.data(""datas"")
    }


}

static func revert(_ database: Database) throws {
    try database.delete(""images"")
}
</code></pre>

<p>}</p>

<p>I'm sending with Postman a POST request with this body : </p>

<p><code>{
    ""name"": ""politique.jpg"",
    ""datas"": [122, 122]
}</code></p>

<p>Then It creates a new line in my Database with datas. </p>

<p>But when i try a GET on this image, i have this error when extracting object :</p>

<blockquote>
  <p>Could not initialize Image, skipping: unableToConvert(node:
  Optional(Node.Node.bytes([101, 110, 111, 61])), expected: ""UInt8"")</p>
</blockquote>

<p>What i'm doing wrong here ? Thanks for all.</p>
","7995795","","","","","2017-05-19 16:45:04","Saving Bytes Vapor Swift","<swift><postgresql><byte><vapor>","1","0","","","","44043977","118712","118712","vapor","592","36204589","36204588"
"44103378","1","44103932","","2017-05-22 01:20:11","","0","338","<p>When I look into my PostreSQL server after preparation I see the relation with the name ""blogdetails"" but when I try to do </p>

<pre><code>try BlogDetails.all()
</code></pre>

<p>I always get the error ""invalidSQL(""Error relation \""blogdetailss\"" does not exist"" spelled this way ending with two Ss which makes no sense to me, Does anyone know what I might be doing wrong, I've tried dropdb and createdb over again and reverting and preparing :(
This is from my main.swift</p>

<pre><code>try? drop.addProvider(VaporPostgreSQL.Provider.self)
drop.preparations = [BlogComment.self, BlogDetails.self]

do {
    try drop.database?.prepare([BlogComment.self, BlogDetails.self])
    print(""Database prepared"")
} catch {
     print(""Prepare failed: \(error.localizedDescription)"")
}
</code></pre>

<p>And this is my model</p>

<pre><code>struct BlogDetails: Model {

var id: Node?
var exists: Bool = false

let title: String
let author: String
let brief: String
let dateString: String

fileprivate static let entityName = ""blogdetails""

init(id: Node? = nil, title: String, author: String, brief: String, dateString: String) {
    self.id = id
    self.title = title
    self.author = author
    self.brief = brief
    self.dateString = dateString
}

init(node: Node, in context: Context) throws {
    self.id = try node.extract(Keys.id)
    self.title = try node.extract(Keys.title)
    self.author = try node.extract(Keys.author)
    self.brief = try node.extract(Keys.brief)
    self.dateString = try node.extract(Keys.dateString)
}

func makeNode(context: Context) throws -&gt; Node {
    return try Node(node: [
        Keys.id: id,
        Keys.title: title,
        Keys.author: author,
        Keys.brief: brief,
        Keys.dateString: dateString
    ])
}
}

extension BlogDetails: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(BlogDetails.entityName) { 👷 in
            👷.id()
            👷.string(Keys.title)
            👷.string(Keys.author)
            👷.string(Keys.brief)
            👷.string(Keys.dateString)
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(BlogDetails.entityName)
    }
}

extension BlogDetails {
    struct Keys {
        static let id = ""id""
        static let title = ""title""
        static let author = ""author""
        static let brief = ""brief""
        static let dateString = ""date_string""
    }
}
</code></pre>
","4166758","","","","","2017-05-22 02:50:05","Vapor db Invalid SQL relation doesn't exist Fluent tries to SELECT from wrong db name","<postgresql><vapor>","1","0","","","","44103378","118712","118712","vapor","592","36204589","36204588"
"44152315","1","","","2017-05-24 07:56:10","","4","1087","<p>I'm using Vapor and a built-in SQLite 3 driver: <a href=""https://github.com/vapor/sqlite"" rel=""nofollow noreferrer"">https://github.com/vapor/sqlite</a></p>

<p>So i changed <code>""driver"": ""memory""</code> to <code>""driver"": ""sqlite""</code> in <strong>fluent.json</strong> and created <strong>sqlite.json</strong>: </p>

<pre><code>{
    ""path"": ""data.sqlite""
}
</code></pre>

<p>But even if I use Spotlight search I cannot find any file called data.sqlite. I cannot also use <code>sqlite-provider</code> which is popular in many tutorials I found because it's not compatible with Vapor 2:
<strong>Could not generate Xcode project: swift-package: error: unsatisfiable</strong></p>

<p>But nevertheless the data is stored somewhere: I can reboot my Mac, run Vapor and see all the data.</p>

<p>I have read a lot of similar questions here but none of authors used Vapor, so those answers hasn't help me. I need to get this data.sqlite file location. What am I doing wrong? </p>

<p><strong>P.S</strong> I'm using Xcode 8.3.2, Swift 3.1, Vapor 2.0.1. SQLite3 is installed. </p>
","6300073","","","","","2019-02-09 17:11:58","Vapor 2.0: Where is the SQLite stored?","<swift><sqlite><vapor>","3","1","2","","","44152315","118712","118712","vapor","592","36204589","36204588"
"44182742","1","","","2017-05-25 14:13:17","","0","375","<p>In vapor 1, the ip address could be accessed with the following code:</p>

<p><code>request.peerAddress?.address()</code></p>

<p>This no longer works with Vapor 2.</p>
","1920977","","","","","2018-01-20 16:41:16","Get IP address from request object in Vapor 2.0?","<swift><vapor>","2","0","","","","44182742","118712","118712","vapor","592","36204589","36204588"
"44196161","1","44356533","","2017-05-26 07:38:53","","1","627","<p>I have 3 <code>Model</code> objects in my project.</p>

<pre><code>drop.preparations.append(Club.self)
drop.preparations.append(ClubPlayers.self)
drop.preparations.append(Player.self)
</code></pre>

<p>for some reason, Club table is not created. this is my <code>prepare</code> method:</p>

<pre><code>static func prepare(_ database: Database) throws {
        try database.create(Club.tableName, closure: { club in
            club.id()
            club.string(Club.nameColumn)
            club.string(Club.urlColumn)
        })

}
</code></pre>

<p>it's built exactly as my other models, but it's the only one that is not being created. I don't receive any warning or error.
I'm using Swift 3.1.1, vapor 1.5 and vapor-toolbox 2</p>
","4231147","","","","","2017-06-04 16:52:11","Vapor with Postgres - table is not getting prepared","<swift><postgresql><vapor>","1","2","","","","44196161","118712","118712","vapor","592","36204589","36204588"
"44201079","1","44219722","","2017-05-26 11:59:11","","0","345","<p>I'm trying to follow the <a href=""https://vapor.github.io/documentation/getting-started/hello-world.html"" rel=""nofollow noreferrer"">vapor tutorial</a>, but I'm having a problem running Hello World project in Xcode.</p>

<p>I typed ""<code>vapor new Hello</code>"", ""<code>cd Hello</code>"", ""<code>vapor xcode</code>"" in terminal.</p>

<p>I pressed y to open in xcode.</p>

<p>In xcode, when I clicked run, it builds but doesn't run. Nothing in the debug console.</p>

<p>When I executed ""vapor run"" in the terminal, it runs though.</p>

<p>I have Xcode 8.3.2, Swift 3.1, Vapor Toolbox 2.0.3, Vapor Framework 2.0.0.</p>

<p>Is there a step I missed in Xcode?</p>

<p>Thanks!  </p>
","5438313","","7766525","","2017-05-26 16:45:39","2018-06-21 01:20:53","Can't Run Hello Vapor Project on Xcode","<xcode><vapor>","2","0","","","","44201079","118712","118712","vapor","592","36204589","36204588"
"44347342","1","","","2017-06-03 18:38:20","","0","90","<p>The changes I make to the leaf templates are not being shown in the browser. I think it's because Vapor is caching the template. How do I disable caching?</p>
","1920977","","1920977","","2017-06-03 18:40:54","2017-06-03 18:40:54","How to disable cache in Vapor?","<vapor><leaf>","1","0","","","","44347342","118712","118712","vapor","592","36204589","36204588"
"44457831","1","","","2017-06-09 12:26:48","","0","271","<p>I'm new to server side swift. I'm using vapor for server side swift. In vapor request I need to get JSON as [String: Any] to check a data type of the value like String, Int or Float. But in request the I can't find the exact data type of the value.</p>

<pre><code>drop.post(""post"") { (request) -&gt; ResponseRepresentable in
     guard let name = request.data[""value""]?.string else {
        throw Abort.badRequest
     }
     return value
}
</code></pre>

<p>In above method, it directly converts and returns the value as String. I need to check it is a String or Int (some other data types too). I can't check by let condition which is given as below.</p>

<pre><code>guard let name = data[""value""] as? String else {
    \\do something
}
</code></pre>

<p>I need to check it is a String or Int (some other data types too). If anyone has the solution, please let me know.</p>
","5019015","","","","","2017-06-13 14:12:15","Can't extract the dictionary as [String : Any] from vapor request context","<swift><vapor>","2","0","","","","44457831","118712","118712","vapor","592","36204589","36204588"
"44500421","1","44523633","","2017-06-12 13:15:13","","1","227","<p>I'm getting familiar with Vapor 2.0 server-side Swift framework, and what confuses me is the extensive use of string literals. For example, implementing the <code>Model</code> protocol you have to parse and serialize rows like this (taken from auto-generated example project):</p>

<pre><code>// Initializes the Post from the database row
init(row: Row) throws {
    content = try row.get(""content"")
}

// Serializes the Post to the database
func makeRow() throws -&gt; Row {
    var row = Row()
    try row.set(""content"", content)
    return row
}
</code></pre>

<p>As you can see, for every property you use its database name twice as a string literal just for this particular protocol. And there's more in other cases — say, <code>Database</code> protocol, your own methods, etc.</p>

<p>Using literal strings as parameters here has obvious disadvantage of static analyser not checking them (just like key-value parameters in Objective-C), making this approach highly error-prone. Is there any best practice I'm missing?</p>
","4320719","","4320719","","2017-06-13 13:07:45","2017-06-13 14:29:48","Database column names in Vapor","<swift><swift3><vapor>","2","0","2","","","44500421","118712","118712","vapor","592","36204589","36204588"
"44524372","1","","","2017-06-13 14:27:42","","5","887","<p>I need to create a complex html-table inside a Swift Vapor App.</p>

<p>Problem is: Leaf doesn't seem to support counting up variables like #(somevar += 1) nor concatenating string variables like #(somevar1 + somevar2)</p>

<p>So I decided to create my complex table inside the App and transfer it to the html template inside a variable. (in php I'm used to doing this all the time)</p>

<p>In the template I'd call the variable like </p>

<pre><code>#(table) 
</code></pre>

<p>but turns out, I'm getting the plain html code as leaf escapes all variables.</p>

<p>But there is the #raw() function to print out plain html as such.</p>

<p>So I do </p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=""de""&gt;
&lt;head&gt;&lt;title&gt;Server&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;..&gt;

&lt;form action=""parameters"" method=""post""&gt;

// here is the thing: leaf gets a html table within the string 'table'.
// If I do it like that lead doesn't recognize #(table) as a leaf variable.
#raw( #(table) )

&lt;button type=""submit""&gt;Save&lt;/button&gt;
&lt;/form&gt;


&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>only to find out that #raw() does not look for variables but just prints out unescaped what is between the {}. So I still get in the website ""#(table)"" instead of my complex html-table.</p>

<p>So now I'm stuck. How do I get App-generated html code into the template as html?</p>

<p>Probably I am doing this all wrong. How do I get html code inside a leaf template at all? Or do I have to send the whole page then myself, as a http stream with a header…?</p>

<p>Thanks in advance,
Tom</p>
","4113711","","4113711","","2017-06-19 10:31:14","2018-10-26 09:17:52","Swift Vapor Leaf deliver html in a variable","<html><swift><vapor><leaf>","2","1","","","","44524372","118712","118712","vapor","592","36204589","36204588"
"44605077","1","","","2017-06-17 13:15:55","","3","71","<p>Is there a way to passing Leaf tag to another Leaf tag?
For example, in my custom Leaf tag I return some html code:</p>

<pre><code>public func run(
        tagTemplate: TagTemplate,
        arguments: ArgumentList) throws -&gt; Node? {

        return .bytes(""&lt;span&gt;#(foo)&lt;/span&gt;"".bytes)
}
</code></pre>

<p>but in my template <code>#(foo)</code> shows as plain text, not render as a Leaf tag, whereas html tags <code>&lt;span&gt;&lt;/span&gt;</code> works properly.</p>
","8175924","","","","","2017-06-17 13:15:55","How to pass Leaf tag to another Leaf tag?","<swift><vapor><leaf>","0","1","","","","44605077","118712","118712","vapor","592","36204589","36204588"
"44762706","1","45363444","","2017-06-26 15:01:55","","4","428","<p>I try to use the Vapor 2 Valid Type, but the compiler only say: ""Use of undeclared type Valid"".</p>

<p>I had read: <a href=""https://docs.vapor.codes/2.0/validation/package/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/2.0/validation/package/</a> + <a href=""https://docs.vapor.codes/2.0/validation/overview/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/2.0/validation/overview/</a></p>

<p>In my my Package.swift I have defined </p>

<ul>
<li>/vapor/vapor.git </li>
<li>/vapor/validation-provider.git </li>
<li>/fluent-provider.git</li>
</ul>

<p>as dependencies.</p>

<p>If I try to use <code>Valid&lt;SomeValidator&gt;</code> the compiler says: ""Use of undeclared type Valid"".</p>

<p>The use of <code>import Validation</code> vs <code>import VaporValidation</code> makes no difference.</p>

<p>Does any one have an idea how I can get Valid to work?</p>

<p>THX for your help.</p>

<p>Edit:
I created a new Vapor project <code>vapor new validtest --api</code>.</p>

<p>Edited the Package.swift:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""validtest"",
    targets: [
        Target(name: ""App""),
        Target(name: ""Run"", dependencies: [""App""]),
    ],
    dependencies: [
        .Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 2),
        .Package(url: ""https://github.com/vapor/validation.git"", majorVersion: 1),
        .Package(url: ""https://github.com/vapor/validation-provider.git"", majorVersion: 1),
        .Package(url: ""https://github.com/vapor/fluent-provider.git"", majorVersion: 1)
    ],
    exclude: [
        ""Config"",
        ""Database"",
        ""Localization"",
        ""Public"",
        ""Resources"",
    ]
)
</code></pre>

<p>Ran <code>vapor fetch</code> and <code>vapor xcode</code>.</p>

<p>In Routes.swift from the example code I tryed this:</p>

<pre><code>import Vapor
import FluentProvider
import Validation
// or and both imports are tested
import VaporValidation

extension Droplet {
    func setupRoutes() throws {
        get(""info"") { req in

            let input: Valid&lt;OnlyAlphanumeric&gt; = try req.data[""input""].validated()
</code></pre>

<p>No matter which import I used, the compiler always say: ""Use of undeclared type Valid"".</p>
","8160189","","8160189","","2017-06-27 08:00:35","2017-07-28 01:26:40","Vapor 2 Validation Valid-Type throws ""Use of undeclared type Valid""","<validation><swift3><vapor>","2","1","","","","44762706","118712","118712","vapor","592","36204589","36204588"
"44783650","1","44786710","","2017-06-27 15:00:30","","1","157","<p>Using the OS X server application, I can point multiple domains to various websites. All domains can use port 80 at the same time and OS X will resolve which website to use.</p>

<p>When I start my kitura server (I suppose the same happens with Vapor and Perfect) I have to start it on a free port (ex. 8080). if I start it on 80 it will create a conflict with the websites and it will probably not answer my calls.</p>

<p>What is the correct way to setup Kitura so that port 80 is used together with other services?</p>

<p>I start kitura server using the following:</p>

<pre><code>do {
    let controller = try Controller()
    Log.info(""Server will be started on '\(controller.url)'."")
    Kitura.addHTTPServer(onPort: controller.port, with: controller.router)
    // Start Kitura-Starter server
    Kitura.run()
} catch let error {
    Log.error(error.localizedDescription)
    Log.error(""Oops... something went wrong. Server did not start!"")
}
</code></pre>

<p>And I get the following on the log:</p>

<pre><code>[2017-06-27T17:57:30.635+03:00] [VERBOSE] [Router.swift:68 init(mergeParameters:)] Router initialized
[2017-06-27T17:57:36.817+03:00] [INFO] [main.swift:37 KiteSpotterServer] Server will be started on 'http://localhost:8080'.
[2017-06-27T17:57:37.588+03:00] [VERBOSE] [Kitura.swift:72 run()] Starting Kitura framework...
[2017-06-27T17:57:38.457+03:00] [VERBOSE] [Kitura.swift:82 start()] Starting an HTTP Server on port 8080...
[2017-06-27T17:57:39.190+03:00] [INFO] [HTTPServer.swift:117 listen(on:)] Listening on port 8080
</code></pre>
","997108","","997108","","2017-07-01 06:42:31","2017-07-01 06:42:31","Point domain to a Web Application running on OS X Server (ex. Kitura, perfect, vapour server)","<swift><osx-server><vapor><perfect><kitura>","2","0","1","","","44783650","118712","118712","vapor","592","36204589","36204588"
"44839430","1","","","2017-06-30 05:50:58","","0","21","<p>I am making a request using the Vapor HTTP Client and the request needs to have form URL encoded data in the body which has a + character in it. When the request is sent the + character is removed.</p>

<pre><code>request.formURLEncoded = try Node(node: [
            ""From"": ""+18881002000""
])
let response = try drop.client.respond(to: request)
</code></pre>
","7260157","","","","","2017-07-28 01:21:00","Node with + Character","<vapor>","1","0","","","","44839430","118712","118712","vapor","592","36204589","36204588"
"44866298","1","","","2017-07-01 23:40:55","","0","116","<p>How can I add clauses to Fluents query builder from inside a loop? I just want to loop through a dictionary array and add the predicates as per dictionary content. For example, for this array:</p>

<pre><code>var data: [[String: String]] = [
        [
                ""name"": ""Joe"",
                ""email"": ""joe@example.com""
        ],
        [
                ""name"": ""John"",
                ""email"": ""john@example.com""
        ]
]
</code></pre>

<p>I would want to produce this query: </p>

<pre><code>var contacts = try Contact.makeQuery().or { orGroup in
        try orGroup.and { andGroup in
            try andGroup.filter(""name"", ""Joe"")
            try andGroup.filter(""email"", ""joe@example.com"")
        }
        try orGroup.and { andGroup in
            try andGroup.filter(""name"", ""John"")
            try andGroup.filter(""email"", ""john@example.com"")
        }
}.all()
</code></pre>

<p>Thanks.</p>
","5972034","","","","","2017-07-28 01:19:05","Adding nested AND groups inside OR group from dictionary array in Fluent (Swift)","<arrays><swift3><fluent><vapor>","1","0","0","","","44866298","118712","118712","vapor","592","36204589","36204588"
"44887221","1","","","2017-07-03 13:47:29","","2","135","<p>How to make a Pivot with the same objects? 
I have this tried but get an mySQL error:</p>

<pre><code>final class UserParent: Model, PivotProtocol {
    var storage = Storage()

    typealias Left = User
    typealias Right = User

    static var leftIdKey: String = ""user_id_parent""
    static var rightIdKey: String = ""user_id_child""

    init(row: Row) throws { }

    func makeRow() throws -&gt; Row {
        let row = Row()
        return row
    }

}

//MARK: - Preparation
extension UserParent: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(self, closure: { builder in
            builder.id()
            builder.int(""user_id_parent"")
            builder.int(""user_id_child"")
        })
    }

    static func revert(_ database: Database) throws {
        try database.delete(self)
    }
}
</code></pre>

<p>and then i have this on my user object</p>

<pre><code>var users: Siblings&lt;User, User, UserParent&gt; {
    return siblings()
}
</code></pre>

<p>but I get this mySQL error</p>

<pre><code>[MySQL Error: Unknown column 'user_parents.user_id' in 'where clause']
</code></pre>
","2502147","","2027279","","2017-09-23 02:48:58","2017-11-27 21:54:53","PivotProtocol in vapor","<vapor>","1","1","","","","44887221","118712","118712","vapor","592","36204589","36204588"
"44906333","1","44911291","","2017-07-04 12:43:20","","4","1082","<p>I have a VPS (Ubuntu 14.04) with Apache2, Swift 3.1.1 and Vapor installed. I want to receive client side requests to my Vapor-Built-Service via HTTPS protocol (on port 8443 for example). I didn't find any newbie helper document to do this, so please help me.<br/>
Thanks.</p>
","2028379","","","","","2017-07-05 14:29:41","Vapor: Handle HTTPS requests?","<swift><ubuntu-14.04><vps><vapor>","1","0","2","","","44906333","118712","118712","vapor","592","36204589","36204588"
"45257273","1","45363288","","2017-07-22 17:19:08","","2","187","<p>I keep getting the error <code>Cannot invoke initializer for type 'posix_spawn_files_actions_t' with no arguments</code> after installing Vapor/MySQL, prompted by this line of code in <code>Terminal.swift</code>: <code>var fileActions = posix_spawn_file_actions_t()</code>. Does anyone know what might prompt this?</p>
","4883617","","","","","2017-07-28 01:01:55","Cannot invoke initializer for type 'posix_spawn_files_actions_t' with no arguments after installing Vapor/MySQL","<mysql><swift><vapor>","1","0","","","","45257273","118712","118712","vapor","592","36204589","36204588"
"45349915","1","","","2017-07-27 11:46:56","","0","45","<p>When I'm trying to run Vapor from Xcode, it shows me an error:</p>

<blockquote>
  <p>/Users/apple/HelloWorld/Packages/Bits-1.0.0/Sources/Bits/ByteSequence+Conversions.swift:9:16:</p>
  
  <p>Value of type '[Byte]' has no member 'withUnsafeBytes'</p>
</blockquote>

<p>Im using</p>

<p><strong>Vapor - 2.0.3</strong></p>

<p><strong>Xcode - 8.2.1</strong></p>

<p><strong>Snapshot used: Swift 3.0 GM CANDIDATE Snapshot 2016-09-08 (a)</strong></p>
","5215474","","3151675","","2017-07-27 11:48:09","2017-08-03 11:40:05","Error in Package-Bits in Vapor","<swift><vapor>","1","4","","","","45349915","118712","118712","vapor","592","36204589","36204588"
"45410115","1","45440711","","2017-07-31 07:46:58","","4","192","<p>I would like to compare a variable with a string in my leaf template. </p>

<p>I get the variable through the controller in my template:</p>

<pre class=""lang-html prettyprint-override""><code>&lt;!-- NAVBAR --&gt;
&lt;!-- #(path) = /database --&gt;
&lt;nav class=""navbar navbar-default""&gt;
    &lt;div class=""container-fluid""&gt;
        &lt;ul class=""nav navbar-nav""&gt;
            #if(path == ""/database"") {
                &lt;h1&gt;Hello, there!&lt;/h1&gt;
            }
            &lt;li&gt;&lt;a href=""#""&gt;Filldatabase&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
        &lt;ul class=""nav navbar-nav navbar-right""&gt;
            &lt;li&gt;&lt;a href=""#""&gt;Contact&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/nav&gt;
&lt;!-- END NAVBAR --&gt;
</code></pre>

<p>I want it so that when I am on the <code>/database</code> page, I get an h1 that says ""Hello, there!"". How can I do it? I think I need to use <code>#if()</code>, but I can't find the proper syntax.</p>
","8392395","","5236226","","2017-08-01 14:12:06","2017-08-01 14:32:07","Vapor Swift - Compare two strings","<vapor><leaf>","1","0","","","","45410115","118712","118712","vapor","592","36204589","36204588"
"45482344","1","45483508","","2017-08-03 11:02:30","","4","976","<p>I am using Mac with Sierra OS (10.12.5). I Installed Vapor using home-brew. If I tried to run command 'vapor build' in terminal it shows following error.</p>

<pre><code>No .build folder, fetch may take a while...
Fetching Dependencies [  •                      ]
Error: backgroundExecute(code: 1, error: ""swift-package: error: unknown command: --enable-prefetching\n"", output: """")
</code></pre>

<p>Please help me.</p>
","5019015","","","","","2017-08-03 11:56:50","Vapor build failure","<swift><macos-sierra><vapor>","2","0","","","","45482344","118712","118712","vapor","592","36204589","36204588"
"45537602","1","45565901","","2017-08-06 23:29:01","","1","60","<p>I have a macOS application written in Objective-C that uploads a file to a server using a multipart request. It stores the file data in a field called 'document and it puts an additional field, 'database' into the header:</p>

<pre><code>[body appendData:[[NSString stringWithFormat:@""Content-Disposition: form-data; name=\""document\""; database=\""%s\""\r\n"", DATABASE] dataUsingEncoding:NSUTF8StringEncoding]];
</code></pre>

<p>I am writing a Vapor replacement for the simplistic scripts I have been using for a few years. In PHP on the server, to extract the value of the field 'database', I use:</p>

<pre><code>$database = $_FILES['document']['database'];
</code></pre>

<p>I cannot find a way of doing the same in Vapor. I can happily unpack the file itself using:</p>

<pre><code>guard let filebytes = req.formData?[""document""]?.part.body else ...
</code></pre>

<p>I have tried changing the order of the fields, etc. Has anyone done this? Or is there a better way of creating the request in the first place? Thanks.</p>

<p><strong>EDIT:</strong></p>

<p>I have made some progress:</p>

<pre><code>req.formData?[""document""]?.part.headers[""Content-Disposition""]
</code></pre>

<p>gives</p>

<pre><code>""form-data; database=\""test\""; name=\""document\""""
</code></pre>

<p>Now just got to extract the bit I'm interested in!</p>
","2070111","","2070111","","2017-08-07 09:58:30","2017-08-08 10:29:31","Unable to access a multipart non-file field in Vapor 2","<php><vapor>","1","0","","","","45537602","118712","118712","vapor","592","36204589","36204588"
"45573712","1","45574471","","2017-08-08 16:38:34","","0","454","<p>I’m having trouble saving a large (~20k) JSON blob into an SQLite database. I created the row with <code>builder.bytes(""data"")</code>, which turned into a <code>blob</code>row in the database file. When I try saving an array of Byte aka Bytes, I get this error:</p>

<p><code>S Q Lite Driver Error: Unsupported Command: Array values not supported.] [Identifier: Fluent.SQLiteDriverError.unsupported] [Possible Causes: using operations not supported by sqlite] [Suggested Fixes: verify data is not corrupt if data type should be supported by sqlite]</code></p>

<p>The error message comes from the switch statement implemented <a href=""https://github.com/vapor-community/sqlite-driver/blob/master/Sources/FluentSQLite/SQLiteDriver.swift#L91"" rel=""nofollow noreferrer"">here</a>.</p>

<p>There’s a separate <code>bytes</code> case defined in the <code>StructuredData</code> enum, which seems to be supported by the SQLDriver, but I don’t know how to get there. </p>

<p>This is how my class is defined:</p>

<p>final class Blob: Model {
   let storage = Storage()</p>

<pre><code>let uuid: String
let revision: Int
let userId: Identifier
let data: Bytes


init(uuid inUuid: String, revision inRevision: Int, data inData: [UInt8], user: User) throws {
    uuid = inUuid
    userId = try user.assertExists()
    revision = inRevision
    data = inData
}

init(row: Row) throws {
    uuid = try row.get(""uuid"")
    userId = try row.get(User.foreignIdKey)
    revision = try row.get(""revision"")
    data = try row.get(""data"")
}

func makeRow() throws -&gt; Row {
    var row = Row()
    try row.set(""uuid"", uuid)
    try row.set(User.foreignIdKey, userId)
    try row.set(""revision"", revision)
    try row.set(""data"", data)
    return row
}
</code></pre>

<p>}</p>

<p>This is using Vapor Toolbox 2.0.3 and Vapor Framework 2.1.3.</p>
","581784","","581784","","2017-08-08 16:58:58","2017-08-08 17:22:21","Vapor: Saving Byte array to SQLite database?","<swift><sqlite><vapor>","1","2","","","","45573712","118712","118712","vapor","592","36204589","36204588"
"45624725","1","45624934","","2017-08-10 23:10:44","","3","956","<p>I'm looking for a Swift counterpart to Django's <a href=""http://www.celeryproject.org/"" rel=""nofollow noreferrer"">Celery</a> which allows a function to execute every given amount of time. </p>

<p>I need a solution that works on server side Swift, meaning not all of Foundation is available, and something that's not for iOS / Mac. </p>

<p>I am using the Vapor framework.</p>
","5572258","","","","","2017-08-10 23:39:48","How to execute a function every n hours in server side swift?","<swift><vapor>","1","1","2","","","45624725","118712","118712","vapor","592","36204589","36204588"
"45626166","1","45626341","","2017-08-11 02:47:40","","1","304","<p>I used the vapor in the <a href=""https://github.com/vapor-community/postgresql-provider"" rel=""nofollow noreferrer"">postgresql</a> ,I want to save a lot of data at once
,but I don't how to use postgresql transaction,Who can give an example.</p>
","6066054","","","","","2017-08-11 03:08:41","How to use PostgreSQL transaction in vapor","<swift><postgresql><vapor>","1","0","","","","45626166","118712","118712","vapor","592","36204589","36204588"
"45713321","1","","","2017-08-16 12:16:07","","1","205","<p>I found two GitHub repositories, but both of them seem to be outdated:</p>

<ul>
<li><p><a href=""https://github.com/vapor-community/gzip-provider"" rel=""nofollow noreferrer"">https://github.com/vapor-community/gzip-provider</a></p></li>
<li><p><a href=""https://github.com/jhonny-me/GzipMiddleware"" rel=""nofollow noreferrer"">https://github.com/jhonny-me/GzipMiddleware</a></p></li>
</ul>

<p>The second solution worked fine before Vapor 2.0 release.</p>

<p>I'm using Vapor 2.1 with Swift 3, how can I enable GZip?</p>
","1796907","","","","","2017-12-29 10:41:21","How to enable GZip in a Vapor app?","<swift><gzip><vapor>","2","0","","","","45713321","118712","118712","vapor","592","36204589","36204588"
"45747581","1","","","2017-08-18 02:26:11","","1","76","<p>App upload through the interface to the server, the server and then upload the picture to the storage space.I know my method is not the best If there are good ways to thank share</p>

<p>code look like this:</p>

<p>with main.swift</p>

<pre><code>let config = try Config()
try config.addProvider(PostgreSQLProvider.Provider.self)

let drop = try Droplet(config)

let fleCrl = FileController();
fleCrl.addRoutest(drop: drop);
drop.resource(""files"", fleCrl);
</code></pre>

<p>with FileController.swift</p>

<pre><code>final class FileController: ResourceRepresentable{

var drop:Droplet?;

public func addRoutest(drop: Droplet) -&gt; Void {
    self.drop = drop;
    let d = drop.grouped(""file"");
    d.post(""updateFile"", handler: updateFile)
}

func updateFile(req:Request) throws -&gt; ResponseRepresentable {

    let picName =  req.data[""name""]?.string ?? String();
    let bytes:[UInt8] = (req.data[""data""]?.bytes)!;
    let request = Request(method:.post,uri:""http://up.qiniu.com"");

    let t = ""image/\(picName)"";
    let token = req.data[""token""]?.bytes;

    request.formData = [
        ""token"":Field(name:""token"",filename:nil,part:Part(headers:[:], body: token!)),
        ""file"":Field(name:""file"",filename:t,part:Part(headers:[""Content-Type"": ""vnd.apple.mpegURL""],body:bytes)),
        ""key"":Field(name:""key"",filename:t,part:Part(headers:[:],body:t.bytes))
    ]

    let resp = try self.drop?.client.respond(to: request);

    return resp?.data[""info""]?.string;
   }

}
</code></pre>

<p>with client</p>

<pre><code>    let data = try Data.init(contentsOf: URL.init(string: ""video.m3u8"")!);

    Alamofire.upload(multipartFormData: { (multipartFormData) in

        multipartFormData.append(data!, withName: ""data"", fileName: ""video"", mimeType:""application/x-mpegURL"")

        multipartFormData.append(""videoName"".data(using: .utf8)!, withName: ""name"")

    }, to: ""http://0.0.0.0:8083/file/updateFile"") { (encodingResult) in

        switch encodingResult {
        case .success(let upload, _, _):
            upload.responseJSON { response in
                debugPrint(response)
            }
        case .failure(let encodingError):
            print(encodingError)
        }
    }
</code></pre>

<p>The server console is reported as follows</p>

<pre><code>[Stream Error: The stream is closed] [Identifier: Transport.StreamError.closed]
</code></pre>
","6066054","","","","","2017-08-18 02:26:11","Vapor client close stream","<client><vapor>","0","0","","","","45747581","118712","118712","vapor","592","36204589","36204588"
"45811063","1","","","2017-08-22 07:08:22","","1","181","<p>Use <a href=""https://github.com/Alamofire/Alamofire"" rel=""nofollow noreferrer"">Alamofire</a> to upload files in the vapor, but <a href=""https://github.com/Alamofire/Alamofire"" rel=""nofollow noreferrer"">Alamofire</a> did not return the results.After debugging, it is found that GCD's DispatchQueue.main.async method does not execute.</p>

<h3>reappear</h3>

<p>with main.swift</p>

<pre><code>let drop = try Droplet()
try drop.setup()
DispatchQueue.main.async {
    print(""---main thead---"")
}
try drop.run()
</code></pre>

<p>the code in the GCD will never be executed.who knows what this is the reason.</p>
","6066054","","6066054","","2017-08-22 08:26:15","2017-08-22 23:58:39","vapor main thread not work","<swift><main><vapor>","1","6","","","","45811063","118712","118712","vapor","592","36204589","36204588"
"45837506","1","45909971","","2017-08-23 10:43:40","","5","694","<p>I am trying to get a Swift Vapor project started. Following the guide <a href=""https://docs.vapor.codes/2.0/getting-started/install-on-macos/"" rel=""noreferrer"">here</a>, it seems that Homebrew is the only option. I already have MacPorts and prefer it in many ways to Homebrew. Unfortunately there is no port for Vapor, so I went for the SPM installation that Vapor people describe <a href=""https://docs.vapor.codes/2.0/getting-started/manual/"" rel=""noreferrer"">here</a>. I had previous success with Kitura, so I thought why not with Vapor. Well, when you go and build your project, you get</p>

<pre><code>$ swift build

[... build stuff ...]

note: you may be able to install ctls using your system-packager:

    brew install ctls

[... more build stuff ...]

&lt;module-includes&gt;:1:9: note: in file included from &lt;module-includes&gt;:1:
#import ""shim.h""
    ^
[... more like that ...]

  /Users/morpheu5/web/vizex/api/.build/checkouts/crypto.git-7980259129511365902/Sources/Crypto/Cipher/Cipher+Method.swift:1:8: error: could not build Objective-C module 'CTLS'
import CTLS
    ^
&lt;unknown&gt;:0: error: build had 1 command failures
error: exit(1):/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f /Users/morpheu5/web/vizex/api/.build/debug.yaml
</code></pre>

<p>Apparently you really need this <code>ctls</code> package, and the only way of getting it appears to be through Homebrew/Tap.</p>

<p>I really don't want or need Homebrew, so how do I get to the bottom of this? I'd really like to give Vapor a try.</p>
","554491","","735926","","2017-08-23 13:59:01","2017-08-27 22:42:01","Installing Vapor on macOS without needing Homebrew","<swift><vapor>","1","1","0","","","45837506","118712","118712","vapor","592","36204589","36204588"
"45897664","1","45906235","","2017-08-26 16:50:53","","2","406","<p>Do you have any example of how to create One to Many relation using Vapor 2?
There are some examples of how to do this, but they use the old version of Vapor.</p>

<p>Thank you for all suggestions.</p>
","3990005","","","","","2017-08-27 14:51:12","Vapor 2, One to Many relation","<swift><vapor><server-side-swift>","1","1","","","","45897664","118712","118712","vapor","592","36204589","36204588"
"45909707","1","45910002","","2017-08-27 21:59:18","","1","267","<p>I am writing to Firebase Database from a Vapor server using the Firebase REST API. Why don't I get a <em>Status code</em> in the header received? This would enable me to check if the write was successful or not. </p>

<blockquote>
  <p>headerReceived items line 83 in
  extensionPutRequestToUsersClaimBookingCleaner are </p>
  
  <p>([Connection: ""keep-alive"",  Cache-Control: ""no-cache"",  Server:
  ""nginx"",  Date: ""Sun,  27 Aug 2017 21:47:25 GMT"",  Content-Type:
  ""application/json;  charset=utf-8"",  Content-Length: ""1027"", 
  Strict-Transport-Security:  ""max-age=31556926;  includeSubDomains; 
  preload"",  Access-Control-Allow-Origin: ""*""])</p>
</blockquote>
","5918849","","","","","2017-08-27 22:48:48","Why don't I get a HTTP status code from Firebase Server? Swift - Vapor server","<swift3><vapor>","1","4","","","","45909707","118712","118712","vapor","592","36204589","36204588"
"45931416","1","","","2017-08-29 05:39:55","","0","1861","<p>I used <a href=""https://github.com/vapor/vapor"" rel=""nofollow noreferrer"">vapor</a> to build a project. create a swift file using xcode.</p>

<p>structure like this:</p>

<pre><code>├── Sources
│   └──App
│   │   └── Controllers
│   │   └── Models
│   │   │   └── File.swift
│   └──Run
│       └── main.swift
└── Package.swift
</code></pre>

<p>with main.swift</p>

<pre><code>let config = try Config()
try config.setup()
let drop = try Droplet(config)
try drop.setup()
File.test()
try drop.run()
</code></pre>

<p>with File.swift</p>

<pre><code>class File {

    class func test() -&gt; Void{
        print(""--\(self)--"");
    }
}
</code></pre>

<p>the above code xcode can run normally. but using the command <code>swift build</code> to get an error.</p>

<p>log:</p>

<pre><code>Compile Swift Module 'App' (6 sources)
Compile Swift Module 'Run' (1 sources)
/Users/xxx/Documents/testServer/Sources/Run/main.swift:25:1: error: use of 
unresolved identifier 'File'
File.test()
^~~~
CoreServices.cFile:1:12: note: did you mean 'cFile'?
public var cFile: OSType { get }
           ^
&lt;unknown&gt;:0: error: build had 1 command failures
error: exit(1):  /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f /Users/xxx/Documents/testServer/.build/debug.yamlhere
</code></pre>
","6066054","","","","","2017-08-30 05:29:03","swift build use of unresolved identifier","<vapor><swift-package-manager><spm>","2","0","","","","45931416","118712","118712","vapor","592","36204589","36204588"
"46022253","1","46023375","","2017-09-03 10:01:52","","2","427","<p>I am trying to add a Skeleton-templated view to a recent Vapor 2 app that, so far, only produces JSON output with a MySQL database. If I use the following minimal code:</p>

<pre><code>    get(""viewTest"")
    { req in
        let params = try Node(node: [ ""name"": ""nick""])
        return try self.view.make(""index"",Node(node:params))
    }
</code></pre>

<p>The file <code>index.leaf</code> exists in the <code>Resources/Views</code> folder and the documentation suggests that omitting the <code>.leaf</code> suffix is fine, but doing so gets:</p>

<pre><code>[Data File Error: unable to load file at path /Users/test/Library/Mobile Documents/com~apple~CloudDocs/Apps/Vapor/testServer/Resources/Views/index]
</code></pre>

<p>However, if I put the suffix in explicitly, <code>self.view.make(""index.leaf"",Node(node:params))</code>, the contents of the file are output without being rendered:</p>

<pre><code>    #extend(""base"") #export(""body"") {#(name)}
</code></pre>

<p>I have tried putting the code directly into Main.swift and that makes no difference and putting it into a handler. I've also tried creating a new Vapor 2 project from scratch (using a fresh install of vapor) and it behaves the same. It seems odd that something so fundamental doesn't work out of the box.</p>
","2070111","","","","","2017-09-03 12:18:54","Vapor not rendering file through Leaf","<swift><vapor><skeleton-css-boilerplate>","1","0","","","","46022253","118712","118712","vapor","592","36204589","36204588"
"46045324","1","","","2017-09-05 00:10:48","","0","381","<p>I'm learning Vapor and got stuck on the proper way to interact with the server. So here's the idea of what I'm doing.. </p>

<p>You upload a XML file to the server, it processes it, turns it to a large list of Model objects, and returns a list of json objects. Using leaf, I populate the models to a table view. example:</p>

<pre><code> #loop(objects, ""object"") {
      &lt;tr&gt;
        &lt;td&gt;#(object.id)&lt;/td&gt;
        &lt;td&gt;#(object.name)&lt;/td&gt;
      &lt;/tr&gt;
    }
</code></pre>

<p>This all works file. Here's where I'm stuck. At the top of my tableview, I have some buttons that will perform actions on the objects array. ie: batch rename objects, or apply some sort of logic to them. Then I want the functionality to download the list of model objects in various formats. </p>

<p>I want all of this logic to live on my vapor server. Where I'm lost is how to pass this very large list back and forth with the Vapor server. Should the server be storing a list of the objects for the current web session? I looked into using Javascript in the HTML, but would I then need to parse the DOM to create my model objects. At that point, nothing would be happening in vapor. (Some of these tasks would be very server intensive. </p>

<p>I was looking at fluent, but then the question was would I have a database for the current session, and delete it when done? Would I be concerned with memory issues with this concept? I would think when you upload the XML, it creates a session ID, and all your requests are based off of that. Then the ID would expire at some point. This is all guessing on which would work best.. </p>

<p>Any ideas on the best way of manipulating the vapor model objects? </p>

<p>Thanks! </p>
","3928263","","","","","2017-11-27 21:46:37","Vapor - Get model from HTML","<swift><fluent><vapor>","1","0","1","","","46045324","118712","118712","vapor","592","36204589","36204588"
"46078902","1","","","2017-09-06 15:16:10","","2","133","<p>In the following snippet test1() compiles, test2() doesn't. How to assign a variable of type <code>Int</code> to a request parameter?</p>

<p>Swift version 3.1.1 (swift-3.1.1-RELEASE)
Target: x86_64-unknown-linux-gnu</p>

<pre><code>import Testing
import HTTP

func test1() throws {
    let req = Request.makeTest(method: .get)
    //OK compiles
    req.parameters[""id""] = 1
}

func test2() throws {
    let req = Request.makeTest(method: .get)
    let id = 1
    // NOK doesn't compile
    // compiler error:
    // /path/to/file.swift:12:28: error: cannot assign value of type 'Int' to type 'Parameters?'
    // req.parameters[""id""] = id
    //                        ^~
    req.parameters[""id""] = id
}
</code></pre>
","344257","","","","","2017-10-10 17:12:12","How to assign an int variable to a request parameter?","<swift><vapor>","2","3","","","","46078902","118712","118712","vapor","592","36204589","36204588"
"46100421","1","","","2017-09-07 15:41:33","","3","566","<p>I would like to update multiple nodes in a single operation using the firebase REST API and Vapor framework. 
When I make <code>.patch</code> request to Firebase I get error from Vapor client: </p>

<blockquote>
  <p>The operation couldn’t be completed. Error 400 Bad Request</p>
</blockquote>

<p>Could anyone tell me if <code>finalDictionary</code> is initialized correctly before being converted in JSON? </p>

<p>Desired output for Users node: </p>

<pre><code> brv-61e24
 Users
  usersUID
    customer
      bookingNumber
       timeStampBookingCancelled
            CleanersUID:""cleanersUID""
            TimeStampBookingClaimed: ""TimeStampBookingClaimed""
            TimeStampBookingCancelledByCleaner: ""TimeStampBookingCancelledByCleaner""

Cleaners
 cleanersUID
   bookingNumber
     timeStampBookingCancelled
         TimeStampBookingClaimed:""TimeStampBookingClaimed""
         TimeStampBookingCancelledByCleaner: ""TimeStampBookingCancelledByCleaner""

Cleaners
 cleanersUID
   bookingNumber
      Claimed: ""ClaimedValue""



var finalJSON:JSON?
func makeFinalDictionary() throws -&gt; JSON? {
    let customer = userStripeIdCustomer
    var finalDictionary = Node([:])

    //create base paths
let path0 = ""Users/\(usersUID!)/\(customer!)/\(bookingNumber!)/timeStampBookingCancelled""
let path1 = ""Cleaners/\(cleanersUID!)/\(bookingNumber!)/timeStampBookingCancelled""
let path2 = ""Cleaners/\(cleanersUID!)/\(bookingNumber!)""

    //create final paths and assign values to keys
   finalDictionary[path0] = try Node(node: [""CleanersUID"": cleanersUID])
   finalDictionary[path0] = try Node(node:[""TimeStampBookingClaimed"":timeStampBookingClaimed])
   finalDictionary[path0] = try Node(node:[""TimeStampBookingCancelledByCleaner"":timeStampBookingCancelledByCleaner])

finalDictionary[path1] = try Node(node:[""TimeStampBookingClaimed"":timeStampBookingClaimed])
finalDictionary[path1] = try Node(node:[""TimeStampBookingCancelledByCleaner"":timeStampBookingCancelledByCleaner])

finalDictionary[path2] = try Node(node:[""Claimed"":claimedValue])

    do {
        finalJSON = try JSON(Node(node:finalDictionary))
    } catch let error as NSError {
        let message = error.localizedDescription
        drop.log.error(message)
        throw NSError(domain: ""errorFirebase"", code: error.code, userInfo: [""error"" : message])
    }
       return finalJSON
}


func writeAsMultiPath(tokenReceived:String!, jsonObject:JSON?) throws -&gt; Void {
    let responseFirebase:Response?
    do{ 
        let token = tokenReceived ?? ""defaultValue""
    let response = try drop.client.patch(
            ""https://brv-61e24.firebaseio.com.json/"", headers: [""Authorization"":""Bearer \(tokenReceived)""], query: [:],
            body: jsonObject!)

        responseFirebase = response
    }catch let error as NSError {
        guard let phrase = error.userInfo[""error""] as? String else {
            throw NSError(domain: ""errorFirebase"", code: error.code, userInfo: [""error"" : error.localizedDescription])
        }
 throw NSError(domain: ""errorFirebase"", code: error.code, userInfo: [""error"" : phrase])
}
    let body = responseFirebase?.body.bytes
    do {
        jsonFromWritingUsers = try JSON(bytes:body!)
    } catch let error as NSError{
        let message = ""jsonFromWritingUsers cannot be converted in JSON line 408 in\(fileName)""
        drop.log.error(message)
        throw NSError(domain: ""errorFirebase"", code: error.code, userInfo: [""error"" : message])
}

        guard responseFirebase?.status.statusCode == 200 else{
          let message1 = ""write as multi-path failed line 410 in\(fileName)""
            drop.log.error(message1)
            let message = ""fail""
            throw NSError(domain: ""errorFirebase"", code: 400, userInfo: [""error"" : message])
        }     
 }
</code></pre>
","5918849","","5918849","","2017-09-07 23:37:22","2017-09-07 23:37:22","How to use multi-path update with the REST API in Firebase? Error 400","<ios><swift><firebase><firebase-realtime-database><vapor>","0","7","","","","46100421","118712","118712","vapor","592","36204589","36204588"
"46186649","1","","","2017-09-12 23:24:54","","2","218","<p>I am creating a Vapor server, but it is processing GET requests in the URL, when enter is not being pressed. See below for an example:</p>

<p>Suppose I have the code <code>get('hello')</code>, and whenever it is entered, it returns hello world in <code>json</code> format. </p>

<p>If I were to run the Vapor server, type <code>localhost:8080/hello</code>, and press enter in my browser, it will return <code>{""hello"":""world""}</code>, which works as intended. On the console, it will print <code>GET /hello</code>, which works as intended. However, if I was to clear hello from the URL, I would have <code>localhost:8080/</code> the output would be empty, printing <code>GET /</code> to the console. If I were to then append h to this: <code>localhost:8080/h</code>, then the URL will autocomplete to <code>localhost:8080/hello</code> because I entered it earlier, printing <code>GET /hello</code> to the console, before I have pressed enter in the URL.</p>

<p>Whenever I type text into the URL, it is sending a request to the Vapor server, and processing the request - even if I don't press enter to send the request. </p>

<p>Why is it doing this, and how can this be prevented?</p>
","8600256","","","","","2017-09-12 23:30:53","Why are Vapor GET requests being processed in the URL","<swift><vapor>","1","0","","","","46186649","118712","118712","vapor","592","36204589","36204588"
"46312635","1","","","2017-09-20 03:10:24","","1","390","<p>I use vapor load a html or leaf,it gives me error message '500'.The server log show me </p>

<pre><code>[Data File Error: unable to load file at path /Users/apple/Desktop/QSSwiftServer/Resources/Views/welcome.leaf]  
 [Identifier: Core.DataFileError.load]  

[Possible Causes: file doesn't exist, missing read permissions at specified path, data read is corrupted, system issue]  

[Suggested Fixes: ensure that file permissions are correct for specified paths]  

[Documentation Links: https://developer.apple.com/reference/foundation/filemanager]
</code></pre>

<p>Here is my code:</p>

<pre><code>get { req in
        return try self.view.make(""welcome.leaf"", [""message"": ""Hello world!""])
    }
</code></pre>

<p>How can I solve this problem？</p>
","8637970","","8637970","","2017-09-20 03:17:37","2017-11-17 00:07:58","vapor can not load html and leaf","<swift><vapor>","1","2","","","","46312635","118712","118712","vapor","592","36204589","36204588"
"46349157","1","46363399","","2017-09-21 16:44:51","","3","148","<p>I was following along a screen cast from Ray Wenderlich (<a href=""https://videos.raywenderlich.com/screencasts/545-server-side-swift-with-vapor-basic-validation"" rel=""nofollow noreferrer"">https://videos.raywenderlich.com/screencasts/545-server-side-swift-with-vapor-basic-validation</a>) (which doesn't have a compilable project) when I tried to type</p>

<pre><code>let input: Valid&lt;OnlyAlphanumeric&gt; = try request.data[""input""].validated()
</code></pre>

<p>And the compiler told me Valid doesn't exist. I tried looking for this and found that Vapor doesn't do the validation like this anymore and that it uses different lines found here: <a href=""https://stackoverflow.com/a/45363444/2305517"">https://stackoverflow.com/a/45363444/2305517</a>
which are:</p>

<pre><code>guard let input = req.data[""input""]?.string else { throw SomeError }
try input.validated(by: OnlyAlphanumeric())
</code></pre>

<p>However strings don't have a function called validated(by:)</p>

<p>I tried importing Validation but the module doesn't exist.</p>

<p>Is there a way to complete the tutorial now? Validation doesn't appear to be in the Vapor code at all.</p>
","2305517","","1677912","","2018-03-04 19:54:29","2018-03-04 19:54:29","undeclared type 'valid', no such module 'Validation'","<validation><vapor>","1","0","","","","46349157","118712","118712","vapor","592","36204589","36204588"
"46396224","1","","","2017-09-25 00:50:57","","7","1930","<p>So I'm trying to <a href=""https://firebase.google.com/docs/database/rest/auth"" rel=""noreferrer"">authenticate the Firebase REST API.</a>
I'm using the <a href=""https://vapor.codes"" rel=""noreferrer"">Vapor framework</a> for server side swift and I installed the <a href=""https://github.com/vapor/jwt"" rel=""noreferrer"">JWT package</a>.</p>

<p>I'm trying to use the data in the <code>serviceAccountKey.json</code> file and JWT to generate an auth token. </p>

<p>Here is the code I've tried:</p>

<pre><code>let payload = try JSON(node: [
        ""iat"": Date().timeIntervalSince1970,
        ""exp"": Date().timeIntervalSince1970 + 3600,
        ""iss"": ""client_email from serviceAccountKey.json"",
        ""aud"": ""https://accounts.google.com/o/oauth2/token"",
        ""scope"": [
            ""https://www.googleapis.com/auth/firebase.database"",
            ""https://www.googleapis.com/auth/userinfo.email""
        ]
    ])
    let privateKey = ""copied from serviceAccountKey.json""

    let signer = try HS256(bytes: privateKey.bytes)

    let jwt = try JWT(payload: payload, signer: signer)
    let token = try jwt.createToken()
    print(token)
</code></pre>

<p>serviceAccountKey.json</p>

<pre><code>{
  ""type"": ""service_account"",
  ""project_id"": """",
  ""private_key_id"": """",
  ""private_key"": """",
  ""client_email"": """",
  ""client_id"": """",
  ""auth_uri"": ""https://accounts.google.com/o/oauth2/auth"",
  ""token_uri"": ""https://accounts.google.com/o/oauth2/token"",
  ""auth_provider_x509_cert_url"": ""https://www.googleapis.com/oauth2/v1/certs"",
  ""client_x509_cert_url"": """"
}
</code></pre>
","1148882","","","","","2017-10-26 09:15:11","How do I generate an auth token using JWT for Google firebase?","<swift><firebase><oauth><jwt><vapor>","2","11","2","","","46396224","118712","118712","vapor","592","36204589","36204588"
"46424346","1","47115024","","2017-09-26 10:45:40","","2","182","<p>I'm using Vapor 2 and trying to create non-final model to subclass it. Is it possible? I have following code for abstract model:</p>

<pre><code>class MongoObject: Model, JSONRepresentable {

    let storage = Storage()

    let creationDate: Date

    init() {
        creationDate = Date()
    }

    required init(row: Row) throws {
        creationDate = try row.get(KeyPath.creationDate)
    }

    func makeRow() throws -&gt; Row {
        var row = Row()
        try row.set(KeyPath.creationDate, creationDate)
        return row
    }

    func makeJSON() throws -&gt; JSON {
        var json = JSON()
        try json.set(KeyPath.id, id)
        try json.set(KeyPath.creationDate, creationDate)
        return json
    }

}

extension MongoObject: Preparation {

    class func prepare(model: Creator) { }

    static func prepare(_ database: Database) throws {
        try database.create(self) { (builder) in
            builder.id()
            builder.date(KeyPath.creationDate)
            prepare(model: builder)
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(self)
    }

}
</code></pre>

<p>but got compilation error:</p>

<blockquote>
  <p>method 'make(for:)' in non-final class 'MongoObject' must return
  <code>Self</code> to conform to protocol 'Parameterizable'</p>
</blockquote>
","4707000","","","","","2017-12-19 22:13:09","Vapor 2, Fluent model subclass","<swift><vapor>","2","0","","","","46424346","118712","118712","vapor","592","36204589","36204588"
"46429079","1","46431522","","2017-09-26 14:23:50","","0","368","<p>I have already gone through the proper way of the fluent provider to build a relation for my <strong>model (Swift)</strong> using <strong>vapor (server side)</strong> and <strong>PostgreSQL provider (database)</strong>, I follow the general method of fluent,  but I don't know where I am doing mistake, in extension for modelName preparation,
below the code of my <strong>modelName.swift</strong> and <strong>main.swift</strong>.</p>

<pre><code> import Foundation
 import Vapor
import FluentProvider
import PostgreSQLProvider


final class modelName: Model {


    let storage = Storage()
    var id: Node?
    var name:String
    var displayName:String
       public var content: String

    init(content: String, displayName:String, name:String) {

        self.content = content
        self.displayName = displayName
        self.name = name
    }

    func forDataBase() {


        let array:[berichtDataPoint] = [intDataPoint(), boolDataPoint(), doubleDataPoint()]

        let _ = array[0] as! intDataPoint
        let _ = array[1] as! doubleDataPoint


        for point in array {

            switch point {
            case is  intDataPoint:
                print(""int"")
            case is doubleDataPoint:
                print(""double"")
            case is boolDataPoint:
                print(""bool"")
            default:
                print(""error"")
            }
        }

    }

  func makeRow() throws -&gt; Row {
        var row = Row()
        try row.set(""id"", idKey)
        try row.set(""displayName"", displayName)
        try row.set(""name"", name)
        return row
    }

    init(row: Row) throws {
        content = try row.get(""content"")
        displayName = try row.get(""displayName"")
        name = try row.get(""name"")
    }

    func makeNode(context: Context) throws -&gt; Node {
        return try Node(node: [
            ""id"": id,
            ""content"": content,
            ""displayName"": displayName,
            ""name"": name
            ])
    }
}


extension modelName: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(self) { modelName in
            modelName.id()
            modelName.string(""displayName"")
            modelName.string(""name"")

        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(self)
    }
}
</code></pre>

<p><strong>main.swift</strong></p>

<pre><code>import App
import Vapor
import FluentProvider
import PostgreSQLProvider

/// We have isolated all of our App's logic into
/// the App module because it makes our app
/// more testable.
///
/// In general, the executable portion of our App
/// shouldn't include much more code than is presented
/// here.
///
/// We simply initialize our Droplet, optionally
/// passing in values if necessary
/// Then, we pass it to our App's setup function
/// this should setup all the routes and special
/// features of our app
///
/// .run() runs the Droplet's commands, 
/// if no command is given, it will default to ""serve""
let config = try Config()
config.preparations.append(modelName.self) \\error is here '(Use of 
unresolved identifier 'modelName')

let drop = try Droplet(config)
try drop.setup()

try drop.run()
</code></pre>
","7880782","","2227743","","2017-09-26 14:33:42","2017-12-15 09:15:23","Error in config.preparations.append(modelName.self) Use of unresolved identifier 'modelName'","<swift><postgresql><generics><fluent><vapor>","2","0","","","","46429079","118712","118712","vapor","592","36204589","36204588"
"46439737","1","46467951","","2017-09-27 04:51:15","","4","1049","<p>I am developing a web app with Swift 4 and Vapor 2.0. I have a method for a <code>POST</code> request which creates a new user: </p>

<pre><code>builder.post(""user"", ""createUser"") { (request) -&gt; ResponseRepresentable in
</code></pre>

<p>But I don't know how to add action for button in the <code>.leaf</code> file to call the <code>createUser</code> method. It easy to add a JavaScript action in a <code>.html</code> file, like that <code>&lt;script  src=""js/index.js""&gt;&lt;/script&gt;</code>. But with Vapor, I didn't see any mention about that in the <a href=""https://docs.vapor.codes/2.0/"" rel=""nofollow noreferrer"">Vapor 2.0 docs</a></p>

<p><strong>Update:</strong></p>

<p>With help from @Caleb Kleveter, now it worked. I updated <code>html</code> page(it's just for test, so that it's not a nice page) with hope: it'll help for newcomer whom face with the same problem when use <code>vapor</code>.</p>

<p>Here is my HTML contents:</p>

<pre><code>    &lt;!DOCTYPE html&gt;
&lt;html &gt;
    &lt;head&gt;
        &lt;meta charset=""UTF-8""&gt;
            &lt;title&gt;Responsive Login Form&lt;/title&gt;


            &lt;link rel='stylesheet prefetch' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css'&gt;

                &lt;link rel=""stylesheet"" href=""styles/app.css""&gt;


                &lt;/head&gt;

                &lt;body&gt;
                &lt;link href='https://fonts.googleapis.com/css?family=Ubuntu:500' rel='stylesheet' type='text/css'&gt;
                &lt;h3&gt;
                &lt;form action=""/user/createUser"" method=""POST"" class=""login-form""&gt;
                &lt;label for=""username""&gt;Username:&lt;/label&gt;
                &lt;input type=""text"" placeholder=""Username"" name=""username""/&gt;
                &lt;label for=""password""&gt;Password:&lt;/label&gt;
                &lt;input type=""password"" placeholder=""Password"" name=""password""/&gt;
                &lt;input type=""submit"" value=""Login"" class=""login-button""/&gt;
                &lt;form&gt;
                &lt;/h3&gt;
                &lt;a class=""sign-up""&gt;Sign Up!&lt;/a&gt;
                &lt;br&gt;
                &lt;h6 class=""no-access""&gt;Can't access your account?&lt;/h6&gt;
                &lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- &lt;div class=""error-page""&gt;
                    &lt;div class=""try-again""&gt;Error: Try again?&lt;/div&gt;
                &lt;/div&gt; --&gt;
                &lt;script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'&gt;&lt;/script&gt;
                    &lt;script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'&gt;&lt;/script&gt;

                    &lt;script  src=""js/index.js""&gt;&lt;/script&gt;

            &lt;/body&gt;
&lt;/html&gt;
</code></pre>
","4327164","","4327164","","2017-10-05 13:06:07","2017-10-05 13:06:07","Add script action for buttons in html with Vapor","<html><swift><vapor><leaf>","1","0","","","","46439737","118712","118712","vapor","592","36204589","36204588"
"46454647","1","46459391","","2017-09-27 18:17:15","","1","78","<p>Sending a JSON to local service, but it does not receive it, why?</p>

<pre><code>let config = try Config()
try config.setup()

let drop = try Droplet(config)
try drop.setup()

drop.get(handler: {req in

    if req.json != nil {

        print(""ass"")
        print(req.json!)
    }

    return ""almaG""
})
</code></pre>

<p><a href=""https://i.stack.imgur.com/e27hM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/e27hM.png"" alt=""enter image description here""></a></p>

<p><a href=""https://i.stack.imgur.com/q1sro.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/q1sro.png"" alt=""enter image description here""></a></p>
","239219","","239219","","2017-09-27 18:44:04","2017-09-28 01:06:32","Why Vapor / Droplet does not receive JSON?","<json><vapor><droplet>","1","0","","","","46454647","118712","118712","vapor","592","36204589","36204588"
"46473245","1","","","2017-09-28 15:40:41","","0","97","<p>Try to connect to <code>mLab</code> with credentials, but I get this error:</p>

<pre><code>fatal error: Error raised at top level: MongoKitten.AuthenticationError.incorrectCredentials: file /Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-900.0.65/src/swift/stdlib/public/core/ErrorType.swift, line 187
</code></pre>

<p>my code:</p>

<pre><code>let server = try Server(""mongodb://xxx:xxx@ds155424.mlab.com:55424"")
let database = server[""db1""]
let document: Document = [""_id"":""asdf""]
try database[""full""].append(document)
</code></pre>
","239219","","239219","","2017-09-28 16:42:30","2017-09-28 16:42:30","Why not able to connect to mLab from Vapor + MongoKitten?","<mongodb><vapor><mongokitten>","0","3","","","","46473245","118712","118712","vapor","592","36204589","36204588"
"46514086","1","","","2017-10-01 15:50:58","","1","135","<p>i created a <a href=""https://github.com/cpageler93/CVServiceRegistry"" rel=""nofollow noreferrer"">Swift library</a> which uses <a href=""https://github.com/IBM-Swift/Kitura-net"" rel=""nofollow noreferrer"">Kitura-Net</a> which uses <a href=""https://github.com/IBM-Swift/Kitura-net/blob/5b1b9b2463633f43f0e9fcee74c8360d6feb8d81/Package%40swift-4.0.swift#L30"" rel=""nofollow noreferrer"">CHTTPParser</a>.</p>

<p>Now i'm trying to use my Library inside a <a href=""https://github.com/vapor/vapor"" rel=""nofollow noreferrer"">Vapor</a> application which uses <a href=""https://github.com/vapor/engine/blob/decf702d774ac630dfe0441ff76b4bb68257b77a/Package%40swift-4.swift#L7"" rel=""nofollow noreferrer"">CHTTP</a>.</p>

<p>My library builds perfectly fine and my Vapor application <strong>without my library</strong> builds fine also.</p>

<p>But when i add my library as a dependency, so it compiles inside the Vapor application i get <strong>duplicate symbols</strong> errors.</p>

<p>It seems like both CHTTP and CHTTPParser implemented the same class: <strong>http_parser</strong></p>

<p>Here is my log after a clean build:</p>

<pre><code>Compile CHTTP http_parser.c
Compile CSQLite sqlite3.c
Compile CHTTPParser utils.c
Compile CHTTPParser http_parser.c
Compile Swift Module 'libc' (1 sources)
Compile Swift Module 'Debugging' (1 sources)
Compile Swift Module 'Bits' (19 sources)
Compile Swift Module 'PathIndexable' (2 sources)
Compile Swift Module 'SwiftyJSON' (2 sources)
Compile Swift Module 'Socket' (3 sources)
Compile Swift Module 'LoggerAPI' (1 sources)
Compile Swift Module 'Core' (23 sources)
Compile Swift Module 'Random' (6 sources)
Compile Swift Module 'Transport' (10 sources)
Compile Swift Module 'Node' (38 sources)
Compile Swift Module 'Console' (35 sources)
Compile Swift Module 'Crypto' (13 sources)
Compile Swift Module 'BCrypt' (9 sources)
Compile Swift Module 'URI' (6 sources)
Compile Swift Module 'Sockets' (22 sources)
Compile Swift Module 'Cache' (2 sources)
Compile Swift Module 'Branches' (3 sources)
Compile Swift Module 'JSON' (9 sources)
Compile Swift Module 'SQLite' (4 sources)
Compile Swift Module 'TLS' (12 sources)
Compile Swift Module 'SMTP' (21 sources)
Compile Swift Module 'Configs' (13 sources)
Compile Swift Module 'Fluent' (70 sources)
Compile Swift Module 'SSLService' (1 sources)
Compile Swift Module 'HTTP' (45 sources)
Compile Swift Module 'KituraNet' (36 sources)
Compile Swift Module 'Cookies' (11 sources)
Compile Swift Module 'WebSockets' (14 sources)
Compile Swift Module 'Multipart' (6 sources)
Compile Swift Module 'Sessions' (7 sources)
Compile Swift Module 'Routing' (10 sources)
Compile Swift Module 'Quack' (4 sources)
Compile Swift Module 'FormData' (4 sources)
Compile Swift Module 'Vapor' (97 sources)
Compile Swift Module 'ConsulSwift' (17 sources)
Compile Swift Module 'Testing' (6 sources)
Compile Swift Module 'FluentProvider' (19 sources)
Compile Swift Module 'CVServiceRegistry' (2 sources)
Compile Swift Module 'App' (5 sources)
Compile Swift Module 'Run' (1 sources)
Linking ./.build/x86_64-apple-macosx10.10/debug/Run
duplicate symbol _http_parser_settings_init in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_init in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_url_init in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_method_str in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_errno_description in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_version in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_parse_url in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_body_is_final in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_message_needs_eof in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_should_keep_alive in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_execute in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_parser_pause in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
duplicate symbol _http_errno_name in:
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTP.build/http_parser.c.o
    /path_on_my_mac/.build/x86_64-apple-macosx10.10/debug/CHTTPParser.build/http_parser.c.o
ld: 13 duplicate symbols for architecture x86_64
&lt;unknown&gt;:0: error: link command failed with exit code 1 (use -v to see invocation)
error: terminated(1): /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f /path_on_my_mac/.build/debug.yaml main
</code></pre>

<p>Does anyone has a solution for me to solve this problem?</p>

<p>Interesting Information: When I build and run the Vapor Application with Xcode, everything works fine.</p>
","5283648","","5283648","","2017-10-01 17:20:57","2018-04-12 21:20:26","Use CHTTP and CHTTPParser in same Swift Project","<swift><linker><vapor><swift-package-manager>","0","0","","","","46514086","118712","118712","vapor","592","36204589","36204588"
"46570459","1","","","2017-10-04 17:07:47","","1","719","<p>I've been trying to install Swift 4 on my Ubuntu 16.04 machine using terminal but I keep getting this error ..</p>

<pre><code>swift: /lib/x86_64-linux-gnu/libtinfo.so.5: no version information available (required by swift)
swift: relocation error: swift: symbol _ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEED2Ev, version GLIBCXX_3.4.21 not defined in file libstdc++.so.6 with link time reference
</code></pre>

<p>I've tried <a href=""https://itsfoss.com/use-swift-linux/"" rel=""nofollow noreferrer"">this tutorial</a>.</p>
","3775227","","","","","2018-10-30 23:34:52","Can't install Swift 4 on Ubuntu 16.04","<ubuntu><ubuntu-16.04><swift4><vapor>","2","1","1","","","46570459","118712","118712","vapor","592","36204589","36204588"
"46576184","1","46591890","","2017-10-05 00:36:56","","7","834","<p>Using Xcode 9 and Swift 4 as well as <code>vapor heroku push</code> / <code>vapor heroku init</code>, I receive:</p>

<pre><code>-----&gt; Swift app detected
Cloning into 'swiftenv'...
Swift 3 Heroku Installer
🔢  Version: 3.1.1
🖥  Operating System: ubuntu1404
📦 Installing Swiftenv
Cloning into '/app/.swiftenv'...
🐦 Installing Swift
Downloading https://swift.org/builds/swift-3.1.1-release/ubuntu1604/swift-3.1.1-RELEASE/swift-3.1.1-RELEASE-ubuntu16.04.tar.gz
/tmp/swiftenv-3.1.1- /tmp/build_d
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
/tmp/build_d
3.1.1 has been installed.
✅  Done
-----&gt; Installing clang-3.7.0
precompile
-----&gt; Building Package ... this will take a while
swift-build: error: Package requires minimum Swift tools version 4.0.0. Current Swift tools version is 3.1.0
 !     Push rejected, failed to compile Swift app.
 !     Push failed
</code></pre>

<p>In the <code>Package.swift</code> file it says: </p>

<pre><code>// swift-tools-version:4.0

import PackageDescription

let package = Package(
    name: ""name"",
    products: [
        .library(name: ""App"", targets: [""App""]),
        .executable(name: ""Run"", targets: [""Run""])
    ],
    dependencies: [
        .package(url: ""https://github.com/vapor/vapor.git"", .upToNextMajor(from: ""2.1.0"")),
        .package(url: ""https://github.com/vapor/fluent-provider.git"", .upToNextMajor(from: ""1.2.0"")),
    ],
    targets: [
        .target(name: ""App"", dependencies: [""Vapor"", ""FluentProvider""],
                exclude: [
                    ""Config"",
                    ""Public"",
                    ""Resources"",
                ]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App"", ""Testing""])
    ]
)
</code></pre>

<p>Other than that it is literally the initial api template project. What am I missing? Help is very appreciated.</p>
","5896501","","","","","2017-11-13 16:05:57","How to push Vapor 2 Swift 4 project to Heroku","<swift><heroku><xcode9><vapor>","3","2","1","","","46576184","118712","118712","vapor","592","36204589","36204588"
"46586146","1","46685770","","2017-10-05 12:54:35","","0","293","<p>I am using postgreSQL database and vapor, fluent for relation.I am trying to make extension ´request´ for ´model´(dataPointStorage) to be in Json formate. i get the error (Argument labels '(node:)' do not match any available overloads).
code.</p>

<h2>dataPointController.swift</h2>

<pre><code>     import Vapor
     import HTTP

    final class dataPointController: ResourceRepresentable{

    func create(request: Request) throws -&gt; ResponseRepresentable{
        var dataPoints = try request.dataPoints()
        try dataPoints.save()
        return dataPoints as! ResponseRepresentable
    }

    func show(request: Request, dataPoints: dataPointStorage) throws -&gt; ResponseRepresentable {
        return dataPoints as! ResponseRepresentable
    }

    func update(request: Request, dataPoints: dataPointStorage) throws -&gt; ResponseRepresentable {
        let new = try request.dataPoints()
        var dataPoints = dataPoints
        dataPoints.name = new.name
        dataPoints.displayName = new.displayName
        dataPoints.content = new.content
        try dataPoints.save()
        return dataPoints as! ResponseRepresentable

    }

    func delete(request: Request, dataPoints: dataPointStorage) throws -&gt; ResponseRepresentable {
        try dataPoints.delete()
        return JSON([:])
    }
    func index(request: Request) throws -&gt; ResponseRepresentable{

        return try JSON(node:dataPointStorage.all())
    }

    func makeResource() -&gt; Resource&lt;dataPointStorage&gt; {
        return Resource(
            index: index,
            store: create,
            show: show,
            destroy: delete
        )
    }
}
extension Request{

    func dataPoints() throws -&gt; dataPointStorage {
        guard let json = json else { throw Abort.badRequest }
        **return try dataPointStorage(node: json)** 'error(Argument labels '(node:)' do not match any available overloads)'
    }

}
</code></pre>

<h2>model.swift</h2>

<pre><code>    import Foundation
             import Vapor
             import FluentProvider
             import PostgreSQLProvider


    final class dataPointStorage: Model, JSONRepresentable, NodeRepresentable {

    //  var _data: dataPointProtocol?
    //    var _data:[dataPointProtocol] = []
        let storage = Storage()
        var id: Node?
        var name:String
        var displayName:String
           public var content: String!


        init(node:Node ,content: String, displayName:String, name:String) {
            self.id = nil
            self.content = content
            self.displayName = displayName
            self.name = name
        }

        struct Keys {
            static let id = ""id""
            static let content = ""content""
        }

        func forDataBase() {


            let array:[berichtDataPoint] = [intDataPoint(), boolDataPoint(), doubleDataPoint()]

            let _ = array[0] as! intDataPoint
            let _ = array[1] as! doubleDataPoint


            for point in array {

                switch point {
                case is  intDataPoint:
                    print(""int"")
                case is doubleDataPoint:
                    print(""double"")
                case is boolDataPoint:
                    print(""bool"")
                default:
                    print(""error"")
                }
            }

        }

      func makeRow() throws -&gt; Row {
            var row = Row()
            try row.set(""id"", id)
            try row.set(""displayName"", displayName)
            try row.set(""name"", name)
            return row
        }

        init(row: Row) throws {
            content = try row.get(""content"")
            displayName = try row.get(""displayName"")
            name = try row.get(""name"")
        }

        func makeNode(context: Context) throws -&gt; Node {
            return try Node(node: [
                ""id"": id,
                ""content"": content,
                ""displayName"": displayName,
                ""name"": name
                ])
        }
    }

    extension dataPointStorage: Preparation {
        static func prepare(_ database: Database) throws {
            try database.create(self) { dataPointStorage in
                dataPointStorage.id()
                dataPointStorage.string(""displayName"")
                dataPointStorage.string(""name"")
                dataPointStorage.string(""content"")

            }
        }

        static func revert(_ database: Database) throws {
            try database.delete(dataPointStorage)
        }
    }

    extension dataPointStorage: JSONConvertible {
        convenience init(json: JSON) throws {
            try self.init(
                **content: json.get(dataPointStorage.content)**
error(Instance member 'content' cannot be used on type 'dataPointStorage')
            )
        }
        func makeJSON() throws -&gt; JSON {
            var json = JSON()
            try json.set(""name"", name)
            try json.set(""displaName"", displayName)
            try json.set(""content"", Content)
            return json
        }
</code></pre>

<p>Also in Model the i am using extension dataPointStorage: JSONConvertible ,in which convenience init is not getting the content while i already defined the var content as public,
I dont know where i am doing mistake.</p>
","7880782","","","","","2017-10-11 10:22:33","Swift,error(Argument labels '(node:)' do not match any available overloads),rest in vapor,model Controller","<json><swift><postgresql><vapor>","1","0","","","","46586146","118712","118712","vapor","592","36204589","36204588"
"46587527","1","","","2017-10-05 13:57:10","","0","97","<p>Using <a href=""https://github.com/matthijs2704/vapor-apns"" rel=""nofollow noreferrer"">vapor-apns</a>. Want to do authentication. Attached <code>APNsAuthKey_AQ34EHZCDQ.p8</code> file to <code>Vapor</code> project, to <code>frozen-sea-***</code>. But I do not know the key path. What you use?</p>

<pre><code>let options = try! Options(topic: ""&lt;your bundle identifier&gt;"", teamId: ""&lt;your team identifier&gt;"", keyId: ""&lt;your key id&gt;"", keyPath: ""/path/to/your/APNSAuthKey.p8"")
let vaporAPNS = try VaporAPNS(options: options)
</code></pre>

<p>Found here a <a href=""https://github.com/matthijs2704/vapor-apns/issues/32"" rel=""nofollow noreferrer"">string</a>, but it do not work.</p>
","239219","","","","","2017-11-27 21:39:56","Which keypath need to send APN message from Vapor + Heroku?","<heroku><apple-push-notifications><vapor>","1","0","","","","46587527","118712","118712","vapor","592","36204589","36204588"
"46590235","1","","","2017-10-05 16:07:59","","0","360","<p>In some reason I need to extract <code>public</code> and <code>private</code> keys from Apple <code>p8</code> certificate. Any idea how?</p>
","239219","","284120","","2018-01-22 01:04:58","2018-01-22 01:04:58","How to extract public and private part from p8 Apple APN certificate?","<apple-push-notifications><vapor>","1","0","","","","46590235","118712","118712","vapor","592","36204589","36204588"
"46639347","1","46655506","","2017-10-09 05:27:22","","1","115","<p>.Package(url: ""<a href=""https://github.com/vapor/mysql-provider"" rel=""nofollow noreferrer"">https://github.com/vapor/mysql-provider</a>"", majorVersion: 1, minor: 0)</p>

<hr>

<pre><code>$ vapor xcode --mysql
</code></pre>

<p>Generating Xcode Project [Failed]
error: unknown option --mysql; use --help to list available options</p>

<p>Error: Could not generate Xcode project: error: unknown option --mysql; use --help to list available options</p>
","2071021","","2071021","","2017-10-09 12:10:30","2017-10-09 21:51:40","could not able to install mysql dependancy in vapor in swift 4","<swift><xcode><vapor>","1","0","","","","46639347","118712","118712","vapor","592","36204589","36204588"
"46665944","1","46687086","","2017-10-10 11:45:20","","0","362","<p>Error Argument labels '(content:)' do not match any available overloads.using postgresql while the rest in vapor to get json representable.The syntax for model controller is as followed, meaning for content in database</p>

<pre><code>import Foundation
import Vapor
import FluentProvider
import PostgreSQLProvider


final class dataPointStorage: Model, JSONRepresentable, NodeRepresentable {

//  var _data: dataPointProtocol?
//    var _data:[dataPointProtocol] = []
    let storage = Storage()
    var id: Node?
    var name:String
    var displayName:String
    var content:String
//    let temp = dataPointStorage()


    init(node:Node ,content: String?, displayName:String, name:String) {
        self.id = nil
        self.displayName = displayName
        self.name = name
    }

        static let idKey = ""id""
        static let contentKey = ""content""



    func forDataBase() {


        let array:[berichtDataPoint] = [intDataPoint(), boolDataPoint(), doubleDataPoint()]

        let _ = array[0] as! intDataPoint
        let _ = array[1] as! doubleDataPoint


        for point in array {

            switch point {
            case is  intDataPoint:
                print(""int"")
            case is doubleDataPoint:
                print(""double"")
            case is boolDataPoint:
                print(""bool"")
            default:
                print(""error"")
            }
        }

    }

  func makeRow() throws -&gt; Row {
        var row = Row()
        try row.set(""id"", id)
        try row.set(""displayName"", displayName)
        try row.set(""name"", name)
        return row
    }

    init(row: Row) throws {
        id = try row.get(""id"")
        displayName = try row.get(""displayName"")
        name = try row.get(""name"")
    }

    func makeNode(context: Context) throws -&gt; Node {
        return try Node(node: [
            ""id"": id,
            ""displayName"": displayName,
            ""name"": name
            ])
    }
}

extension dataPointStorage: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(self) { dataPointStorage in
            dataPointStorage.id()
            dataPointStorage.string(""displayName"")
            dataPointStorage.string(""name"")
            dataPointStorage.string(""content"")

        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(dataPointStorage)
    }
}

extension dataPointStorage: JSONConvertible {
    convenience init(json: JSON) throws {
        try self.init(
       error here¶¶¶ content: json.get(dataPointStorage.contentKey)¶¶¶¶ error
        )
    }

    func makeJSON() throws -&gt; JSON {
        var json = JSON()
        try json.set(""id"", id)
        try json.set(""name"", name)
        try json.set(""displaName"", displayName)
        try json.set(""content"", Content)

        return json
    }
}
</code></pre>

<p>I am following the general context of rest in vapor as JSON representable but didn't get the reason of this simple error to solve.</p>
","7880782","","","","","2017-10-11 11:27:36","Argument labels '(content:)' do not match any available overloads, swift ,vapor,rest in vapor ,using postgresql","<swift><postgresql><rest><fluent><vapor>","1","0","","","","46665944","118712","118712","vapor","592","36204589","36204588"
"46812062","1","46814730","","2017-10-18 14:03:37","","0","208","<p>I make REST calls from my own server running Vapor to a Firebase server and
the response is a JSON object.<br>
How can I get the the elements under ""1508321173"" without knowing the actual value. This represents a timestamp, so this value is always dynamic in the database. </p>

<pre><code>let jsonObject:JSON = [
""EmailAddress"": ""damiena@gmail.com"",
""PhoneNumber"": 07672395038,
""RescheduledByCustomer"": 
     [1508321173:
       [""BookingStatusClient"": ""true"",
      ""DateAndTime"": ""Fri, 20 Oct 2017 18:30""]
  ],
 ""BookingNumber"":""726070304""
   .
   .
   .
] 



let jsonObject:JSON?

if let arrayOfDict:Any = jsonObject?.object?[""RescheduledByCustomer""]{
                print(""arrayOfDict is \(arrayOfDict)"") 
</code></pre>

<blockquote>
  <p>prints:
       arrayOfDict is JSON(node: Node.Node.object([""1508321173"": 
            Node.Node.object([""BookingStatusClient"": Node.Node.string(""true""),<br>
           ""DateAndTime"": Node.Node.string(""Fri, 20 Oct 2017 18:30"")])]))</p>
</blockquote>

<pre><code>    if let underTimeStamp = arrayOfDict as? [[String: Any]]{
       print(""underTstamp is \(underTstamp)"")
            //it does not print anything
   //how can I get the elements under ""1508321173"" ?
                }          
    }
</code></pre>
","5918849","","","","","2017-10-18 16:15:42","How to convert JSON to Dictionary in Swift 3 Vapor","<arrays><json><swift><vapor>","1","0","","","","46812062","118712","118712","vapor","592","36204589","36204588"
"46848017","1","","","2017-10-20 11:17:52","","0","259","<p>I got this error when try to push (after installing Kanna and Leaf Provider packages)</p>

<p><strong>console log:</strong>
warning: error while trying to use pkgConfig flags for CTLS: couldNotFindConfigFile
 !     Push rejected, failed to compile Swift app.
 !     Push failed</p>
","8806194","","2227743","","2017-10-22 13:25:30","2017-10-22 13:25:30","Cannot deploy vapor to heroku (error while trying to use pkgConfig flags for CTLS: couldNotFindConfigFile)","<swift><heroku><push><vapor>","1","1","","","","46848017","118712","118712","vapor","592","36204589","36204588"
"46919517","1","47114941","","2017-10-24 20:31:57","","0","80","<p>I managed to setup Vapor with MongoDB and get it working but if I do a new clean project I get runtime error from MongoKitten. In detail:</p>

<p>I have an outdated vapor project that works fine from 27/07/2017.
I do the same exactly project now 24/10/2017.
When it compiles for the first time I get the following warning (don't know if is relevant to the following error):</p>

<p><a href=""https://i.stack.imgur.com/j3bNj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/j3bNj.png"" alt=""Warning Screenshot""></a></p>

<p>Compilation finishes and I get the following error when I run the project:</p>

<p><a href=""https://i.stack.imgur.com/MfpoQ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/MfpoQ.png"" alt=""Error Screenshot""></a></p>

<p>I only know that this is caused by the preparation step in main.swift e.g. here:</p>

<pre><code>config.preparations.append(User.self)
</code></pre>

<p>Without this step I dont get any runtime error (but fluent connection to mongodb isn't working properly either).</p>

<p>My config is pretty simple:</p>

<p><a href=""https://i.stack.imgur.com/TlvY9.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/TlvY9.png"" alt=""Config Screenshot""></a></p>

<p>This happens in Swift 3.1.1 but same happens in Swift 4.0. Environment is Ubuntu 17.04.</p>

<p>How can I solve this?</p>
","7525223","","7525223","","2017-10-28 23:00:44","2017-11-04 19:50:27","Creating clean Vapor project (using fluent) results in MongoKitten runtime error","<swift><mongodb><fluent><vapor><mongokitten>","1","0","","","","46919517","118712","118712","vapor","592","36204589","36204588"
"46962166","1","46974461","","2017-10-26 19:16:51","","3","521","<p>I have a Persons table and an Events table that are related via an Attends table, such that a record exists the Attends table when I wish to record the fact that a person is due to attend a particular Event in a particular role (e.g. organiser, etc.):</p>

<pre><code>Persons
+----+-------------+
| id | surname     |
+----+-------------+
|  1 | Robinson    |
|  2 | Savage      |
...

Events
+----+-----------------------+
| id | name                  |
+----+-----------------------+
|  1 | Half Term Competition |
|  2 | Christmas Competition |
...

attends
+---------+----------+--------+
| eventId | personId | roleId |
+---------+----------+--------+
|       1 |        1 |      1 |
|       1 |        2 |      6 |
...
</code></pre>

<p>I want to produce a list of who is going and what they are doing at an event, but I can't find a way of doing it using .join() in Vapor query. It seems that you can filter on the joined table, but not include any of the fields. Am I missing something or is this impossible?</p>

<p>I've tried many variations on the theme of:</p>

<pre><code>Person.join(Attends.self).filter(Attends.self,Event.foreignIdKey == eventId)
</code></pre>

<p>I get the correct Person records, but no way of accessing what their 'role' is from the joined Attends record.</p>

<p>If I do a raw query, then it returns a Node representation. I can easily view this using Leaf, but it is not at all obvious how to iterate over it in the way I would like to generate a PDF with images, etc.</p>
","2070111","","","","","2018-08-01 05:25:05","Is it possible to access fields in a joined table in Vapor?","<mysql><vapor>","2","1","","","","46962166","118712","118712","vapor","592","36204589","36204588"
"46995083","1","47520142","","2017-10-28 22:23:59","","3","181","<p>I have registered a custom tag to return true if the index is odd and false if even as follows:</p>

<pre><code>class OddEvenTag: BasicTag {
    let name = ""OddEven""

    func run(arguments: ArgumentList) throws -&gt; Node? {
        guard
            arguments.count == 1,
            let index = arguments[0]?.int
            else { return Node(nil) }
        print(index, index &amp; 1)
        return Node((index &amp; 1) == 1)
    }
}
</code></pre>

<p>The print statement produces satisfyingly good output:</p>

<pre><code>0 0
1 1
2 0
3 1
...
</code></pre>

<p>However, when I use the custom tag inside a #loop in a leaf file, such as </p>

<pre><code>#OddEven(offset){hello}##else(){bye}
</code></pre>

<p>It always instantiates the hello. I've tried hard-coding false into the return statement and it doesn't change the outcome. I have used a (more complex) custom tag before, so I know they can work.</p>

<p>In case you're wondering, I really want to use the tag to alternate the row background colours of a grid!</p>
","2070111","","","","","2017-11-27 21:32:41","Vapor/Leaf Custom Tag not returning correct value","<swift><vapor><leaf>","1","1","1","","","46995083","118712","118712","vapor","592","36204589","36204588"
"47104737","1","47114374","","2017-11-03 21:36:51","","1","1945","<p>When I try to compiled my newly created vapor project with Xcode 9 I get 189 compile errors.  What's the trick to making this work?  I installed vapor and the toolbox, and create via 'vapor new test --template=api' and then 'vapor xcode' to start it up.</p>
","1455351","","","","","2018-11-22 11:34:39","Vapor doesn't work with xcode 9 and swift 4","<swift4><xcode9><vapor>","2","1","2","","","47104737","118712","118712","vapor","592","36204589","36204588"
"47117315","1","","","2017-11-05 01:26:17","","3","315","<p>I added <code>.package(url: ""https://github.com/vapor-community/postgresql-provider.git"", .upToNextMajor(from: ""2.1.0""))</code> to my Package.swift file, ran <code>vapor update</code> and let it regenerate the Xcode project.  When I then add the import of PostgreSQLProvider Xcode can't find it.  I already have postgresql and pkg-config installed via homebrew.</p>

<p>I'm using Xcode 9 and Swift 4</p>
","1455351","","","","","2017-11-15 14:13:31","Add PostgreSQL to vapor project","<vapor>","2","3","","","","47117315","118712","118712","vapor","592","36204589","36204588"
"47243039","1","47268437","","2017-11-11 21:37:04","","4","403","<p>I'm writing my Swift app for Ubuntu using Vapor. And my mission is to have the smallest Docker image for production. I've trimmed down my image significantly but I wanted to know, just out of curiosity, does my final executable need all the compiled <code>.module</code>, <code>.doc</code> and <code>.build</code> files in the same directory?</p>
","2562090","","5236226","","2017-11-13 15:49:28","2017-11-13 15:57:34","Does Swift executable binary need the .swiftmodule, .swiftdoc and .build files to run?","<swift><ubuntu><vapor><server-side-swift>","1","0","","","","47243039","118712","118712","vapor","592","36204589","36204588"
"47243815","1","","","2017-11-11 23:14:49","","5","2622","<p>I have the most recent version of Xcode 9 installed and have reinstalled vapor with brew a couple times now, but I'm still getting the following error whenever I try to build/run/update the project.</p>

<p>Here's what I'm working with </p>

<pre><code>1.) Vapor Toolbox: 3.1.2

2.) Apple Swift version 4.0 (swiftlang-900.0.43 clang-900.0.22.8)
    Target: x86_64-apple-macosx10.9

3.) Xcode 9.0
    Build version 9M136h
</code></pre>

<pre class=""lang-none prettyprint-override""><code>Error: Could not generate Xcode project: error: manifest parse error(s):
/var/folder/60/n3ldjzgs5vsg06v17_1yy44h0000gn/T/TemporaryFile.VwrbJo.swift:41:5
: error: argument 'targets' must preceed argument 'dependencies'
    targets"" [
    ^
error: The product dependency 'Vapor' was not found.
error: The product dependency 'FluentProvider' was not found.
error: The product dependency 'Testing' was not found.
</code></pre>

<p>Here is my Package.swift file. Looking at my original error, I did try switching the 'targets' and 'dependencies' order in which they appear in the file. This didn't solve anything and produced the following error message:  <code>error: argument 'dependencies' must precede argument 'targets'</code></p>

<p><em>Package.swift</em></p>

<pre class=""lang-swift prettyprint-override""><code>let package = Package(
    name: ""test"",
    products: [
        .library(name: ""App"", targets: [""App""]),
        .executable(name: ""Run"", targets: [""Run""])
    ],
    dependencies: [
        .package(url: ""https://github.com/vapor/vapor.git"", .upToNextMajor(from: ""2.1.0"")),
        .package(url: ""https://github.com/vapor/fluent-provider.git"", .upToNextMajor(from: ""1.2.0"")),
    ],
    targets: [
        .target(
            name: ""App"",
            dependencies: [""Vapor"", ""FluentProvider""],
            exclude: [
                    ""Config"",
                    ""Public"",
                    ""Resources"",
                    ]
        ),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App"", ""Testing""])
    ]
)
</code></pre>
","8364675","","3103448","","2017-11-15 00:39:36","2018-11-20 20:54:46","Vapor project not building/running with Swift 4 and Xcode 9","<swift><vapor>","1","9","1","","","47243815","118712","118712","vapor","592","36204589","36204588"
"47244640","1","47256282","","2017-11-12 01:42:57","","5","720","<p>I'm suffering from server problem on both <strong>perfect and vapor</strong> ..</p>

<p>The server working for <strong>only one time</strong> , and once after i update the project and rebuild it, the server response does not update any more.</p>

<p>I got this error ... from vapor in Xcode</p>

<pre><code>No command supplied, defaulting to serve...
Starting server on 0.0.0.0:8080
Serve error: Sockets Error: Failed trying to bind to the address

Identifier: Sockets.SocketsError.bindFailed
Program ended with exit code: 0
</code></pre>

<p>I googled alot , but did not figure out the problem </p>

<p>Finally : when i restart the mac , the server worked good only for one time , and the problem returned the same .</p>
","4034825","","","","","2017-11-13 02:28:54","swift server side server socket error","<swift><vapor><perfect>","2","0","3","","","47244640","118712","118712","vapor","592","36204589","36204588"
"47400866","1","47401595","","2017-11-20 20:53:33","","2","168","<p>I am writing a server using Swift 4 + Vapor framework, Fluent ORM and PostgreSQL as a driver. I've got a User Model which should have subscribers and subscriptions (which are also User Models). I have two options here: 1. store arrays with unique ids of subscriptions/subscribers or 2. build a one-to-many User-User relation. Which one do you think is better and how can I impemplement it? </p>
","4518802","","","","","2017-11-20 21:42:38","Best way to implement [user — subscriptions/subscribers] relation in database","<swift><postgresql><orm><vapor>","1","0","0","","","47400866","118712","118712","vapor","592","36204589","36204588"
"47489310","1","48021243","","2017-11-25 18:34:00","","0","68","<p>I want to update an auto increment field in MongoDB through Vapor and MongoKitten. Not necessarily a unique key.</p>

<p>The goal is to use $inc modifier in order to make it a single atomic operation and get the returned incremented result all in one go.</p>

<p>Is there support for this operation with MongoKitten?</p>

<p>Can I achieve this e.g. by using <strong>findAndUpdate</strong> method?</p>

<p>If yes what would be an example syntax of this?</p>
","7525223","","","","","2017-12-29 10:38:00","MongoKitten support for $inc modifier","<mongodb><vapor><mongokitten>","1","0","","","","47489310","118712","118712","vapor","592","36204589","36204588"
"47517214","1","47520013","","2017-11-27 18:07:35","","1","217","<p>Currently have a class that has two nested vars which are struct types. When I post to the controller I have the JSON validated by mapping the post body to the object using the method below:</p>

<pre><code>extension Request {
func user() throws -&gt; User {
    guard let json = json else { throw Abort.badRequest }
    do {
        return try User(json: json)
    } catch  {
        throw Abort.init(.notAcceptable, metadata: nil, reason: ""\(json.wrapped)"", identifier: nil, possibleCauses: nil, suggestedFixes: nil, documentationLinks: nil, stackOverflowQuestions: nil, gitHubIssues: nil)
    }
}
}
</code></pre>

<p>Which calls:</p>

<pre><code>extension User: JSONInitializable {
  convenience init(json: JSON) throws {
    try self.init(
        type: json.get(""type""),
        person: json.get(""person"")
    )
  }
}
</code></pre>

<p>The problem is that I'm getting a throw error from the Request.user() method. My Model is solid and I've checked the JSON response against the person object. Person at the moment is:</p>

<pre><code>  struct Person {
   var firstName: String
   var lastName: String
   var email: String
   var password: String
   var address: Address 
}

extension Person: JSONInitializable {
 init(json: JSON) throws {
    try self.init(
        firstName: json.get(""firstName""),
        lastName: json.get(""lastName""),
        email: json.get(""email""),
        password: json.get(""password""),
        address: json.get(""address"")
    )
  }
}
</code></pre>

<p>It's very basic so it should pass the mapped validation. Does this struct also need to conform to <code>Vapor Model subclass</code> for it to map correctly or is there something else wrong? </p>

<p>edit: Added User</p>

<pre><code>final class User: Model {

let storage = Storage()
var type: String
var person: Person

init(type: String, person: Person) {
    self.type   = type
    self.person = person
}

//MARK: Parse row from the database
init(row: Row) throws {
    type = try row.get(""type"")
    person = try row.get(""person"")
}

//MARK: Adding a row to the database
func makeRow() throws -&gt; Row {
    var row = Row()
    try row.set(""person"", person)
    try row.set(""type"", type)
    try row.set(""country"", person.address.country)
    return row
}

}

extension User: JSONInitializable {

// MARK: Will be the request in json format
convenience init(json: JSON) throws {
    try self.init(
        type: json.get(""type""),
        person: json.get(""person"")

    )
}
}

extension User: Timestampable, SoftDeletable, JSONConvertible {

//MARK: Convert user to json to pass back
func makeJSON() throws -&gt; JSON {
    var json = JSON()
    try json.set(""id"", id)
    try json.set(""type"", type)
    try json.set(""person"", person)
    return json
}

}

// Fluent DB Preparation
extension User: Preparation {

static func prepare(_ database: Database) throws {
    try database.create(self) { builder in
        builder.id()
        builder.string(""person"")
        builder.string(""type"")
        builder.string(""country"")
    }
}

static func revert(_ database: Database) throws {
    try database.delete(self)
}
}

extension User: ResponseRepresentable, NodeRepresentable {}
</code></pre>
","7684436","","7684436","","2017-11-28 09:59:24","2017-11-28 09:59:24","Vapor 2 Model to JSON failure","<json><model><vapor>","1","0","","","","47517214","118712","118712","vapor","592","36204589","36204588"
"47517674","1","","","2017-11-27 18:38:37","","2","391","<p>I need to set the expiry time for the user session in Vapor 2 (or for cookies in general), but can't see how to do it. Can anyone help?</p>

<p>Thanks,
Andy</p>
","361211","","","","","2017-11-27 22:17:50","Set the user session expiry","<swift><server-side><vapor>","1","2","","","","47517674","118712","118712","vapor","592","36204589","36204588"
"47570043","1","47571469","","2017-11-30 09:32:32","","4","810","<p>I try to deploy hello world app for testing purpose. I check my swift tools version and it's 4.0</p>

<pre><code>acme-iMac:HelloWorldWeb johndoe$ swift --version
Apple Swift version 4.0 (swift-4.0-RELEASE)
Target: x86_64-apple-macosx10.9
</code></pre>

<p>I also use swiftenv and it's point to version 4.0 as well.</p>

<pre><code>acme-iMac:HelloWorldWeb johndoe$ swiftenv version
4.0 (set by /Users/johndoe/Vapor/HelloWorldWeb/.swift-version)
</code></pre>

<p>The Package.swift file also seems fine</p>

<pre><code>// swift-tools-version:4.0

import PackageDescription

let package = Package(
    name: ""HelloWorldWeb"",
    products: [
        .library(name: ""App"", targets: [""App""]),
        .executable(name: ""Run"", targets: [""Run""])
    ],
    dependencies: [
        .package(url: ""https://github.com/vapor/vapor.git"", .upToNextMajor(from: ""2.2.0"")),
        .package(url: ""https://github.com/vapor/leaf-provider.git"", .upToNextMajor(from: ""1.1.0"")),
    ],
    targets: [
        .target(name: ""App"", dependencies: [""Vapor"", ""LeafProvider""],
               exclude: [
                   ""Config"",
                   ""Database"",
                   ""Public"",
                   ""Resources""
               ]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App"", ""Testing""])
    ]
)
</code></pre>

<p>But every time I try to vapor cloud deploy, it always failed.</p>

<pre><code>Creating deployment [Done]
Connecting to build logs ...
Waiting in Queue [Done]
Checkout branch 'master' [Done]
Verifying base folder [Done]
Selected swift version: 3.1.0 [Done]
Selected swift version: 3.1.0 [Done]
Building vapor [Failed]
swift-build: error: Package requires minimum Swift tools version 4.0.0. Current Swift tools version is 3.1.0

Error: deploy failed.
</code></pre>

<p>The app run successfully on local machine.</p>
","1137814","","","","","2018-06-10 13:46:01","Cannot Deploy To Vapor Cloud with Swift 4","<swift><swift4><vapor>","2","0","0","","","47570043","118712","118712","vapor","592","36204589","36204588"
"47598924","1","","","2017-12-01 17:54:42","","0","49","<p>Trying to map a post request json to a model and the try block is passing even though I'm sending nothing in the body. Can't figure out why. Code looks like:</p>

<pre><code>extension Request {
  func localUser() throws -&gt; LocalUser {
    guard let json = json else { throw Abort.badRequest }
    do {
        return try LocalUser(json: json)
    } catch  {
        throw Abort(.notAcceptable, reason: ""\(error)"")
    }
  }
}
</code></pre>

<p>In the model I have the following extension:</p>

<pre><code>extension LocalUser: JSONInitializable {
  convenience init(json: JSON) throws {
    try self.init(
        email: json.get(""email""),
        password: json.get(""password"")
    )
  }
}
</code></pre>

<p>The request line is: <code>let initialUser = try request.LocalUser()</code>. I've tried print calls along the process and the JSONInitializable seems to pass through. Thanks</p>
","7684436","","","","","2017-12-01 17:54:42","Vapor 2 try block not working","<swift><vapor>","0","6","","","","47598924","118712","118712","vapor","592","36204589","36204588"
"47656650","1","","","2017-12-05 15:01:02","","0","42","<p>Trying to allow HTTP <code>method.get</code> and <code>method.delete</code> to be missed in a request check. but it's failing.</p>

<pre><code>func respond(to request: Request, chainingTo next: Responder) throws -&gt; Response {
    if request.method != .get || request.method != .delete {
        guard let contentType = request.headers[""Content-Type""], contentType == ""application/json"" else {
                    return try Response(status: .badRequest, json: JSON(node: [""reason"": ""Invalid data""]))                  
        }
    }
    return try next.respond(to: request)
}
</code></pre>

<p>Expecting to not allow <code>.get</code> or <code>.delete</code> to pass through.</p>

<p>Current result is that it goes straight through to invalid when either <code>.get</code> or <code>.delete</code> to show <code>invalid data</code>. It looks like the || operator is being ignored and I can't figure out why.</p>
","7684436","","3516024","","2018-01-03 16:17:26","2018-01-03 16:17:26","Vapor 2 OR conditional not working on request type check","<swift><logical-operators><vapor>","1","1","","","","47656650","118712","118712","vapor","592","36204589","36204588"
"47717355","1","","","2017-12-08 15:28:33","","5","624","<p>One of the reasons advocates of swift server side give for the use of swift is that it allows iOS developers to develop backends for their apps. But, I do not see many example of this usage pattern. </p>

<p>There is a <a href=""https://github.com/vapor-community/chat-ios-example"" rel=""nofollow noreferrer"">chat-ios</a> example but that is using websockets. </p>

<p>Are there any server and companion iOS app examples available?</p>

<p>One of the difficulties of using a custom server is handling the possible poor comms in iOS app usage. I would like to see if any project out there have handled this well. </p>

<p>One of the reasons for using parse/firebase is the builtin client side support for syncing/retry. Are there any resources/frameworks for client side apps that can be used to give this reliability for custom backends. </p>
","2451592","","294884","","2019-03-24 15:55:07","2019-08-24 19:14:33","Vapor server and companion iOS app examples","<vapor>","2","0","5","","","47717355","118712","118712","vapor","592","36204589","36204588"
"47976863","1","","","2017-12-26 10:03:30","","1","400","<p>After many research and tried, I still cannot resolved the problem. I use <code>Vapor Toolbox: 3.1.2</code> &amp; <code>Vapor Framework: 2.3.0</code> and Swift <code>4.0.3</code>(Xcode 9.2 on macos-high-sierra) to build a simple website(without database). But after run <code>vapor heroku push</code> successful, I try goto <code>heroku dashboard</code> to open my website, but it didn't work. I try to run <code>heroku logs</code> and got the result with crashed:</p>

<pre><code>2017-12-26T09:04:10.000000+00:00 app[api]: Build succeeded
2017-12-26T09:10:00.192686+00:00 heroku[web.1]: Process exited with status 127
2017-12-26T09:10:00.207462+00:00 heroku[web.1]: State changed from starting to crashed
2017-12-26T09:10:00.210981+00:00 heroku[web.1]: State changed from crashed to starting
2017-12-26T09:10:03.369454+00:00 heroku[web.1]: Starting process with command `leeswift --env=production --port=19489`
2017-12-26T09:10:00.072884+00:00 app[web.1]: bash: leeswift: command not found
2017-12-26T09:10:05.460027+00:00 app[web.1]: bash: leeswift: command not found
2017-12-26T09:10:05.560609+00:00 heroku[web.1]: Process exited with status 127
2017-12-26T09:10:05.594754+00:00 heroku[web.1]: State changed from starting to crashed
2017-12-26T09:11:28.858638+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=GET path=""/"" host=leeswift.herokuapp.com request_id=0eab887e-dba0-488e-b3f6-899de07898d6 fwd=""118.69.108.38"" dyno= connect= service= status=503 bytes= protocol=https
</code></pre>

<p>Please help me to fix it.</p>
","4327164","","","","","2020-04-11 15:41:44","Vapor deploy to Heroku with log error code=H10 desc=""App crashed"" method=GET","<heroku><swift4><vapor>","3","1","","","","47976863","118712","118712","vapor","592","36204589","36204588"
"48125599","1","48126115","","2018-01-06 08:29:00","","1","486","<pre><code>func createPoll(on req: Request) throws -&gt; String {
   let poll = try req.content.decode(Poll.self)

   return poll.save(on: req).map(to: Poll.self) {
      return poll
   }
}
</code></pre>

<p>This works only of the Data is sent under a json Object</p>

<pre><code>{
  ""title"": ""Once Poll"",
  ""option1"": ""Black finish"",
  ""option2"": ""Dark Gray finish"",
  ""votes1"": 10,
  ""votes2"": 0
}
</code></pre>

<p>But I can't parse the object if it is sent like this with a key: poll!</p>

<pre><code>{
  ""poll"": {
    ""title"": ""Once Poll"",
    ""option1"": ""Black finish"",
    ""option2"": ""Dark Gray finish"",
    ""votes1"": 10,
    ""votes2"": 0
  }
}
</code></pre>

<p>This is the solution I used using the answer below:</p>

<pre><code>struct PollRequestObject: Content {
let poll: Poll?
</code></pre>

<p>}</p>

<pre><code> func createPoll(on req: Request) throws -&gt; Future&lt;Poll&gt; {
        guard let poll = try req.content.decode(PollRequestObject.self).poll else {
            throw Abort(.badRequest)
        }

        return poll.save(on: req).map(to: Poll.self) {
            return poll
        }
    }
</code></pre>
","9180588","","9180588","","2018-01-06 17:27:32","2018-01-07 14:43:20","How to parse a json object sent in Body(Request)","<swift><vapor>","1","0","","","","48125599","118712","118712","vapor","592","36204589","36204588"
"48147781","1","48148277","","2018-01-08 09:52:12","","1","50","<pre><code>let d3 = try collection.find(""dateModified"" &gt;= lastUpdateCheck, sortedBy: nil, projecting: p)
</code></pre>

<p>How would you create this <code>Query</code> <code>""dateModified"" &gt;= lastUpdateCheck</code>, but based on <code>Document</code> constructor? </p>

<p><a href=""https://i.stack.imgur.com/9b37q.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/9b37q.png"" alt=""enter image description here""></a></p>
","239219","","","","","2018-01-08 10:21:17","How to fetch in Vapor based on Document if you have a date?","<mongodb><vapor>","1","0","","","","48147781","118712","118712","vapor","592","36204589","36204588"
"48197040","1","48248511","","2018-01-10 22:19:37","","0","63","<p>import CTLS</p>

<p>failing on Ubuntu</p>

<p>sudo apt install ctls gives ""ctls is already the newest version (1.0.1).""</p>

<p>Following environment:
Vapor Toolbox: 3.1.2
Vapor Framework: 2.4.2
Swift version 4.0.3 (swift-4.0.3-RELEASE)
openssl is already the newest version (1.0.2g-1ubuntu4.10).</p>

<p>Any help appreciated!</p>
","361211","","361211","","2018-01-10 22:36:47","2018-01-14 10:08:10","vapor 3 (beta) ubuntu import CTLS fails","<ubuntu><vapor>","1","0","","","","48197040","118712","118712","vapor","592","36204589","36204588"
"48214530","1","48214848","","2018-01-11 19:29:24","","2","608","<p>I am working on a Vapor API and while using FluentProvider, I am trying to create a <code>Users</code> table based off of a <code>Users</code> Model in <code>App/Models/Users.swift</code>:</p>

<pre><code>final class Users: Model {
    let storage = Storage()

    // Properties
    let UserUUID:  String
    let FirstName: String
    let LastName:  String
    let EMail:     String
    let Password:  String

    // Initializer
    init( userUUID:  String,
          firstName: String, lastName: String, 
          email:     String, password: String ) 
    {
        self.UserUUID  = userUUID
        self.FirstName = firstName
        self.LastName  = lastName
        self.EMail     = email
        self.Password  = password
    }

    init(row: Row) throws {
        UserUUID  = try row.get(""UserUUID"" )
        FirstName = try row.get(""FirstName"")
        LastName  = try row.get(""LastName"" )
        EMail     = try row.get(""EMail""    )
        Password  = try row.get(""Password"" )
    }

    func makeRow() throws -&gt; Row {
        var row = Row()

        try row.set(""UserUUID"",  UserUUID )
        try row.set(""FirstName"", FirstName)
        try row.set(""LastName"",  LastName )
        try row.set(""EMail"",     EMail    )
        try row.set(""Password"",  Password )

        return row
    }
}
</code></pre>

<p>This is associating with the SQLite provider by default. I would like to use a UUID in String format as the Primary Key for this table.</p>

<p>My issue is that when writing the Preparation for this model, it only wants the primary key to be named ""id"" created with <code>builder.id()</code>. If I try to create a custom column instead and use it as the Primary Key/Identifier, it throws an error. The Preparation code is as follows:</p>

<pre><code>extension Users: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(self) { builder in

            /* builder.id()    &lt;- intentionally omitted. */
            builder.custom( // &lt;- Attempted in place of builder.id()
                ""UserUUID"",  
                 type:""VARCHAR(255) PRIMARY KEY"", 
                 optional: false, 
                 unique: true
            ) 
            builder.string(""FirstName"", optional: false, unique: false)
            builder.string(""LastName"",  optional: false, unique: false)
            builder.string(""EMail"",     optional: false, unique: true)
            builder.string(""Password"",  optional: false, unique: false)
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(self)
    }
}
</code></pre>

<p>The resulting error when calling the associated route from the API:</p>

<pre><code>POST /service/users/new
[SQLite.StatusError: error(""table userss has no column named id"")]
Conform 'SQLite.StatusError' to Debugging.Debuggable to provide more 
debug information.
</code></pre>

<p>If I am understanding correctly, it will only accept an ID column named ""id"", which apparently can only be generated by using the <code>builder.id()</code> method, which only assigns an auto-incremented integer to the ID.</p>

<p>So my questions are:</p>

<ol>
<li><p>Is it possible to use a specific column as the Primary Key/Identifier 
column, and if so, how?</p></li>
<li><p>Would renaming <code>""UserUUID""</code> to <code>""id""</code> but keeping the rest of it's 
properties the same also work as a solution?</p></li>
</ol>
","9205637","","","","","2018-01-18 14:20:49","How to use a stringified UUID as Primary Key in FluentProvider for Vapor - Swift","<swift><sqlite><fluent><vapor>","2","0","1","","","48214530","118712","118712","vapor","592","36204589","36204588"
"48285626","1","48291687","","2018-01-16 16:19:03","","2","156","<p>I'm using vapor framework and created a table with longText type in mysql &amp; store text with html tags in it,</p>

<pre><code>+----+----------------------+
| id |       content        |
+----+----------------------+
|  1 | &lt;b&gt;title&lt;/b&gt;sometext |
+----+----------------------+
</code></pre>

<p>now when i show them in leaf, it's shows with html tags like:  </p>

<pre><code>&lt;b&gt;title&lt;/b&gt;sometext
</code></pre>

<p>My Leaf file:
<a href=""https://i.stack.imgur.com/Tq1oq.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Tq1oq.png"" alt=""My Leaf File""></a>
but i want to show like:  </p>

<p><strong>title</strong> sometext</p>

<p>how can i do this?
thanks</p>
","","user8818243","","user8818243","2018-01-16 16:33:02","2018-01-16 23:56:55","Vapor render html from MySQL","<html><mysql><swift><vapor>","1","8","","","","48285626","118712","118712","vapor","592","36204589","36204588"
"48346372","1","48373349","","2018-01-19 17:20:41","","1","75","<p>Right now I have a <code>base.leaf</code> file that imports the body from other files successfully.</p>

<pre><code>/// base.leaf
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    .
    .
    .
    &lt;!-- Begin page content --&gt;
    &lt;div class=""body-content""&gt;
     #import(""content"")
    &lt;/div&gt;
    .
    .
    .
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>In my <code>report.leaf</code> file I need to display different report templates at the bottom of this page based on the selected option. For example, if the <code>Wire</code> is selected, I want to import that section of the code from the <code>wire.leaf</code> file and so on. In GRAILS GROOVY, importing partial files are done by <code>&lt;g:render template=""/shared/report/wire"" /&gt;</code>. But I can't seem to figure out how to do so in <code>vapor/leaf</code>. </p>

<pre><code>/// report.leaf
#extend(""base"")

#export(""content"") {
  &lt;h2&gt;Generate Report&lt;/h2&gt;
  &lt;section&gt;
    &lt;ul&gt;
      &lt;li&gt;
        &lt;label for=""report""&gt;select report&lt;/label&gt;
        &lt;select name=""report""&gt;
          &lt;option value=""-1""&gt;-- Select Report --&lt;/option&gt;
          &lt;option value=""1""&gt;Purchaser Confirm&lt;/option&gt;
          &lt;option value=""2""&gt;Wire&lt;/option&gt;
          &lt;option value=""3""&gt;Withdrawal Letter&lt;/option&gt;
        &lt;/select&gt;
      &lt;/li&gt;
      &lt;li&gt;
       &lt;input type=""submit"" value=""run  report"" /&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/section&gt;

  /// Display different report templates based on the selected option
  &lt;!-- #export(""report"") { #embed(""section"") } --&gt;
  &lt;!-- #import(""wire"") --&gt;
  &lt;!-- #embed(""section"") --&gt;
  &lt;!-- #import(""report-content"") --&gt;
} 
</code></pre>

<p>Here is my <code>wire.leaf</code> file.</p>

<pre><code>/// wire.leaf
&lt;!-- 
/// Trying the:  #export(""report"") { #embed(""section"") } 
&lt;section&gt;
  &lt;h3&gt;Wire info for Loan # 123456789&lt;/h3&gt;
  &lt;div&gt;
    &lt;ul&gt;
      &lt;li&gt;Name: Marlin Bank&lt;/li&gt;
      &lt;li&gt;CMG: 007&lt;/li&gt;
      &lt;li&gt;MtDt: 005689&lt;/li&gt;
      &lt;li&gt;CUSIP: BDTK001&lt;/li&gt;
      &lt;li&gt;GP: 5&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;input type=""submit"" value=""print"" /&gt;
  &lt;/div&gt;
&lt;/section&gt; 
--&gt;

/// Trying the:  #import(""report-content"")
#export(""report-content"") {
&lt;section&gt;
  &lt;h3&gt;Wire info for Loan # 123456789&lt;/h3&gt;
  &lt;div&gt;
    &lt;ul&gt;
      &lt;li&gt;Name: Marlin Bank&lt;/li&gt;
      &lt;li&gt;CMG: 007&lt;/li&gt;
      &lt;li&gt;MtDt: 005689&lt;/li&gt;
      &lt;li&gt;CUSIP: BDTK001&lt;/li&gt;
      &lt;li&gt;GP: 5&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;input type=""submit"" value=""print"" /&gt;
  &lt;/div&gt;
&lt;/section&gt;
}
</code></pre>

<p>I did read <a href=""https://docs.vapor.codes/2.0/leaf/leaf/#embed-embedtemplate"" rel=""nofollow noreferrer"">this</a> documentation on <code>#embed</code> but I'm still very confused. Any help will be highly appreciated!</p>
","1081016","","1081016","","2018-01-19 17:22:57","2018-01-22 00:53:26","How to include partial templates in child templates","<import><vapor><leaf>","1","0","","","","48346372","118712","118712","vapor","592","36204589","36204588"
"48354590","1","48354882","","2018-01-20 09:37:36","","0","172","<p>I made some minor changes in <code>Vapor</code> / <code>Swift</code> code. Trying to push no <code>Heroku</code>, but get an error.</p>

<pre><code>remote: -----&gt; Downloading curl 7.52.1        
remote: tar: This does not look like a tar archive        
remote: 
remote: gzip: stdin: not in gzip format        
remote: tar: Child returned status 1        
remote: tar: Error is not recoverable: exiting now        
remote:  !     Push rejected, failed to compile curl app.        
remote: 
remote:  !     Push failed        
remote: Verifying deploy...
remote: 
remote: !   Push rejected to frozen-sea-46940.        
remote: 
To https://git.heroku.com/frozen-sea-46940.git
 ! [remote rejected] master -&gt; master (pre-receive hook declined)
error: failed to push some refs to 'https://git.heroku.com/frozen-sea-46940.git'
Completed with errors, see above
</code></pre>

<p><a href=""https://i.stack.imgur.com/zAQ4u.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zAQ4u.png"" alt=""enter image description here""></a></p>

<p>I event called an <code>vapor update</code>, regenerated Xcode project but did not helped. Any idea? </p>

<hr>

<pre><code>Kukoda-MacBook-Pro:frozen-sea-46940 kukodajanos$ heroku buildpacks
=== frozen-sea-46940 Buildpack URLs
1. https://github.com/vzsg/heroku-buildpack-curl-http2.git
2. https://github.com/vapor-community/heroku-buildpack.git
</code></pre>
","239219","","603977","","2018-01-20 15:18:45","2018-01-20 15:18:45","Not able to push Vapor to Heroku","<heroku><vapor>","1","2","","","","48354590","118712","118712","vapor","592","36204589","36204588"
"48450239","1","48450766","","2018-01-25 19:10:10","","13","4979","<p>The Config/server.json file doesn't seem to be read by Vapor 3, and as such I can't configure the hostname and port that a Vapor 3 app binds to.</p>

<p>Does Vapor 3 have a different method for this?</p>
","2471026","","","","","2020-04-27 21:40:53","Changing hostname and port with Vapor 3","<swift><docker><vapor>","10","0","6","","","48450239","118712","118712","vapor","592","36204589","36204588"
"48459487","1","48513379","","2018-01-26 10:23:49","","1","173","<p>I setup Vapor project manually with swift package manager. I follow the documentation. 
It build and runs successfully in my local machine, both for debug and release build.</p>

<p>But it failed to deploy to vapor cloud:</p>

<pre><code>....
....
env: development
db: none
replicas: 1
replica size: free
branch: development
build: clean
Creating deployment [Done]
Connecting to build logs ...
Waiting in Queue [Failed]
Error: Sockets Error: Failed trying to connect to http://redis.eu.vapor.cloud:6379

Identifier: Sockets.SocketsError.connectFailed

Here are some possible causes: 
- The hostname or port is not valid    
</code></pre>

<p>Anyone knows what caused this error?</p>
","1137814","","","","","2018-01-30 03:21:16","Vapor cloud deploy failed: Sockets Error: Failed trying to connect to http://redis.eu.vapor.cloud:6379","<swift><vapor><swift-package-manager>","1","0","","","","48459487","118712","118712","vapor","592","36204589","36204588"
"48508909","1","48524640","","2018-01-29 19:48:42","","-3","1704","<p>Compared to 2.0, to Perfect, or Python franeworks like Django. If usable for anything than small scale projects</p>
","9285540","","","","","2018-01-30 15:11:10","How is (Server-Side Swift framework) Vapor 3.0 vs 2.0 doing performance-wise? Is it anything serious other than for small-scale projects?","<swift><vapor>","1","1","","2018-01-30 15:23:47","","48508909","118712","118712","vapor","592","36204589","36204588"
"48532293","1","","","2018-01-30 23:48:29","","2","174","<p>Are their any alternatives to Vapor's session middleware package? </p>

<p>Our client platform(s) do not support cookies. Vapor uses cookies for it's session management.</p>

<p>Redis has a session store (<a href=""https://redislabs.com/blog/cache-vs-session-store/"" rel=""nofollow noreferrer"">https://redislabs.com/blog/cache-vs-session-store/</a> ) provider, but it doesn't appear that Vapor has support for this yet (please correct me if I'm wrong). </p>

<p>Thanks!  </p>
","843591","","","","","2018-02-02 15:51:11","Vapor Session Middleware Alternatives?","<vapor>","1","0","","","","48532293","118712","118712","vapor","592","36204589","36204588"
"48540520","1","48586241","","2018-01-31 10:59:14","","-1","110","<p>I am learning how to make server-side by Vapor,but I got an error which I don't know why.
<a href=""https://i.stack.imgur.com/B6USC.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/B6USC.jpg"" alt=""enter image description here""></a></p>

<p>It will crash after ""Build Success"" showed.I am using Vapor 3.0.0-beta.0 by the way.</p>

<p><a href=""https://i.stack.imgur.com/Kp4rg.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Kp4rg.jpg"" alt=""enter image description here""></a>
<a href=""https://i.stack.imgur.com/fuYx3.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/fuYx3.jpg"" alt=""enter image description here""></a></p>

<p>you can download the project code from [github]:<a href=""https://github.com/RockyAo/ServerSide/tree/master/JSONPoll"" rel=""nofollow noreferrer"">https://github.com/RockyAo/ServerSide/tree/master/JSONPoll</a></p>
","5938679","","5938679","","2018-01-31 12:02:53","2018-02-02 15:48:57","Vapor3 crash when I use fluent with SQLite","<swift><server-side><vapor>","1","0","","","","48540520","118712","118712","vapor","592","36204589","36204588"
"48574778","1","","","2018-02-02 02:18:19","","1","399","<p>I am trying to figure out how to use my vapor api. What i have seen online and everywhere is mostly creating a website using vapor, but what i haven't been able to see is how to use an api i built with an app i am building. what I want to do is create a mobile app that uses a vapor api that i built myself. I have the api, the problem that i am having is creating the iOS swift app to go along with it. 
I have seen all the example api and swift apps that vapor has on their GitHub, but they are very confusing to understand for me because they have probably 100 controllers and models. I have been creating practice vapor api, and i know they work because i have been testing them on postman, it is just that next step that is confusing me. </p>

<p>If it helps, here is a hypothetical. If I have a simple test api that is using a mysql database that has database that has an id number, names of famous celebrities, and famous quotes they have said. I want to create a swift iOS app that is just a tableview that shows all the celebrity names that i have on my database and when that name is pressed a list of all the quotes appears. </p>

<p>I am sorry for being very repetitive, but i just wanted to be as clear as possible. If i may ask, please be specific with the help, and thank you for all your help. </p>
","7270753","","","","","2018-02-02 15:52:27","How to use a vapor api in a swift iOS app","<ios><swift><api><vapor>","1","2","","","","48574778","118712","118712","vapor","592","36204589","36204588"
"48589290","1","48607557","","2018-02-02 19:03:08","","0","31","<p>My project is based on Vapor.</p>

<p>The aim is to use libclang, build a wrapper on top of it in C language. Then, make this library available from swift.</p>

<p>How can I mix the two? Preferably still building my project from XCode.</p>
","2232305","","","","","2018-02-04 11:27:52","Setting up Vapor and Clang in the same project","<swift><xcode><makefile><llvm-clang><vapor>","1","0","1","","","48589290","118712","118712","vapor","592","36204589","36204588"
"48589415","1","","","2018-02-02 19:12:50","","8","2810","<p>I am trying to find a simple example of how inside a router a person would send a request to the vapor sample endpoint <code>http://example.vapor.codes/json</code>, receive a response and map it to a struct or class.</p>

<p>I've seen examples elsewhere for Vapor 2 but they are no longer relevant with Vapor 3 and the current Vapor 3 beta documentation isn't clear.</p>

<p>Something like...</p>

<pre><code>router.get(""sample"") { req in

  //1. create client
  //2. send get request to sample endpoint at http://example.vapor.codes/json
  //3. handle response and map to a struct or class

}
</code></pre>

<p>My goal is to go grab something off the endpoint, turn it into a struct or class and display it in a leaf view.</p>

<pre><code>{""array"":[0,1,2,3],""dict"":{""lang"":""Swift"",""name"":""Vapor""},""number"":123,""string"":""test""}
</code></pre>

<p>Here is my outline for how I think it is done but I don't understand how to handle the response and process into the struct so that I can use it in my home.leaf in its html (I'm not concerned with the leaf part assume I have all the configuration for all that and imports already).</p>

<pre><code>router.get(""example""){ req -&gt; Future&lt;View&gt; in

    struct ExampleData: Codable {
        var array : [Int]
        var dict : [String : String]
    }

    return try req.make(Client.self).get(""http://example.vapor.codes/json"").flatMap(to: ExampleData.self) { res in
        //not sure what to do to set the values of the ExampleData
    }

    return try req.view().render(""home"", ExampleData())

}
</code></pre>

<p>}</p>
","3612973","","3612973","","2018-02-02 21:46:34","2018-02-28 23:50:23","Vapor 3 Beta Example Endpoint Request","<swift><server-side><beta><vapor>","1","3","4","","","48589415","118712","118712","vapor","592","36204589","36204588"
"48647848","1","48648433","","2018-02-06 16:39:52","","0","74","<p>Trying to build a rating system in Swift and looking for a cleaner way to loop through each of the values. </p>

<pre><code>private func calculateRating(user: String) throws -&gt; String {
    let query = try Rating.makeQuery().filter(""user"", user).all()
    var fiveStars = [Int]()
    var fourStars = [Int]()
    var threeStars = [Int]()
    var twoStars = [Int]()
    var onestar = [Int]()
    if query.count &gt; 1 {

        for rating in query {
            // Check each value and assign it to its associated value
            // insert large if/else condition here :)
        }
        // Perform calculation and return value below
        return """"
    } else {
        // Only one rating has been set
        return query[0].value
    }
}
</code></pre>

<p>Currently I'm looping through each of the values and assigning the rating to it's associated array <code>fiveStars</code> <code>fourStars</code> etc. I will then calculate the rating by the standard multiplication method. Is there a cleaner way to loop through the ratings and assign it to the relevant <code>fiveStars</code> array etc without creating a long if/else conditional?</p>

<p>Thanks</p>

<p>Edit: Sample output would be a single rounded up value out of 5 i.e. ""4"" out of five based on 1000's of multiple ratings.</p>
","7684436","","7684436","","2018-02-07 08:31:51","2018-02-07 21:13:57","Swift rating system loop and assign","<swift><conditional><rating><vapor>","1","2","","","","48647848","118712","118712","vapor","592","36204589","36204588"
"48725561","1","","","2018-02-10 21:05:44","","7","560","<p>I would like to compile Vapor with my code as a MacOS app so I can place it on internal server (drag and click to launch it). I would prefer not to have to install Xcode, swift and other development files on the server. I am new to vapor and swift. I have things running when I build it from xCode. Someone else asked if they could embed it in app, there was yes and no response. The yes did not provide any direction as to how to do it. 
Can it be compiled to a standalone OSX App? 
What do I need to do to make it happen? Point me to docs if you know of any. I have compiled apps that are standalone. Just don't know how to do Vapor. 
Thanks</p>
","9343810","","","","","2020-01-31 16:07:49","Compiling Vapor as Standalone App on MacOS","<swift><macos><vapor>","2","2","2","","","48725561","118712","118712","vapor","592","36204589","36204588"
"48742737","1","","","2018-02-12 09:05:42","","3","691","<p>I write cocoa-app and using Vapor . After starting the server i do get-request from  the application. And and I get a message:
    [User Defaults] Failed to read values in   CFPrefsPlistSource&lt;0x6080000e7500> (Domain: com.apple.PowerManagement,  User: kCFPreferencesAnyUser, ByHost: Yes, Container: (null)): accessing  preferences outside an application's container requires user-preference-read or file-read-data sandbox access, detaching from cfprefsd
    I'm try change SandBox settings, update Xcode(current version is 9.2), create App Groups, reboot my computer. Nothing helps.
   If someone faced with a similar error - please help.</p>
","6663970","","","","","2018-02-12 09:05:42","Failed to read values in CFPrefsPlistSource","<xcode><vapor><get-request>","0","0","","","","48742737","118712","118712","vapor","592","36204589","36204588"
"48799758","1","","","2018-02-15 03:58:47","","0","32","<p>I'm trying to deploy my Vapor app to an ubuntu (16.04) server, but when I run it I'm getting an error</p>

<p><code>Sockets Error: Failed trying to connect to http://www.c-bike.com.tw:80</code></p>

<p>The app runs fine on my local server and on Vapor Cloud. This happens on this line of code</p>

<p><code>let bikesResponse = try drop.client.get(""http://www.c-bike.com.tw/xml/stationlistopendata.aspx"")</code></p>

<p>Does anyone have any idea?</p>

<p>I tried <code>curl http://www.c-bike.com.tw/xml/stationlistopendata.aspx</code> and that worked fine, so it's not blocked. And as mentioned, the app works when I run it locally on my Mac.</p>

<p>Thank you!</p>
","1712184","","","","","2018-02-15 03:58:47","Vapor error on drop.client.get, Sockets Error: Failed trying to connect to","<ubuntu-16.04><swift4><vapor>","0","4","","","","48799758","118712","118712","vapor","592","36204589","36204588"
"48802005","1","48823487","","2018-02-15 07:32:30","","1","571","<p>Now: i am uploading data and saving it to my public folder:</p>

<pre><code>let info = req.data
            guard let fileBytes = info[""photo""]?.bytes
            else {
                var answerJson = JSON();
                try answerJson.set(""success"", ""false"");
                return answerJson
            }

            let dir = URL(fileURLWithPath: self.config.workDir).appendingPathComponent(""Public/FleaMarketProductImages"")
            let dirWithImage = dir.appendingPathComponent(""test3.jpg"")
            let fileManager = FileManager()
            let data = Data(bytes: fileBytes)
            fileManager.createFile(atPath: dirWithImage.path, contents: data, attributes: nil)
</code></pre>

<p>Then on device for downloaing this file i am doing next: </p>

<pre><code> Alamofire.download(url).responseData { response in
            if let data = response.result.value {
                completionHandler(data)
            }
        }
</code></pre>

<p>I am getting some data, but when i do UIImage(data: data), i dont see my image. Where i did something wrong? Maybe there is another way to do it. And files in my public directory dont looks like image. They just files. Maybe do you know how to save it like an image????</p>
","7261191","","","","","2018-02-16 09:58:13","How to use vapor for uploading/downloading image?","<swift><image><server><vapor>","1","1","","","","48802005","118712","118712","vapor","592","36204589","36204588"
"48874931","1","","","2018-02-19 22:07:15","","2","451","<p>I am woking on a web socket app using vapor. I am new to using vapor and server side code in general. Right now I am putting all my main code in the main.swift file in the run folder </p>

<p>Here is my code: </p>

<pre><code>let config = try Config()
try config.setup()
let drop = try Droplet(config)
try drop.setup()

var instance = [(socket: WebSocket, uuid: String)]()

drop.socket(""log"") { req, ws in
    background {
        while ws.state == .open {
            try? ws.ping()
            drop.console.wait(seconds: 10) // every 10 seconds
       }
    }

    ws.onText = { ws, text in
        //print (""log is \(text)"")
        //This is where my code is about to handle data sent and received by the socket. 
        let logMessage:JSON = try JSON(bytes: text.utf8.array)

        guard logMessage != nil else {try ws.send(""issue with json""); return}
        if logMessage == ""pair"" {
            instance.append((ws, ""383485838498""))
        }else if logMessage == ""message"" {
            for sock in instance {
                //send data to all saved socket instances 
            }
        }
    }

    ws.onClose = { ws, _, _, _ in
        print (""log sokcet closeing?"")
        try ws.send(""log socket closed"")
    }
}
</code></pre>

<p>I am saving all my instances of the socket in a local variable called <code>instance</code> above. Then I am sending data as it is received from another socket to those saved instances. I have a feeling I am doing things completely wrong but for now this is working. Is this the best way to do it or is there a better way to do it?</p>

<p>Instead of using an array of type: <code>(socket: WebSocket, uuid: String)</code> I want to use an array of type <code>Instance</code>, the struct that I have defined below. Right now I can't because it says Use of undeclared type 'Instance'. I wanted to use something like this <code>let app = Application()</code> but again, it give me this issue:  <code>Use of unresolved identifier 'Application'</code>.</p>

<p>Here is the struct I want to use </p>

<pre><code>struct Instance {
    var socket:WebSocket?
    var uuid:String?
}
</code></pre>
","7835545","","","","","2018-02-19 22:07:15","How to properly setup sockets using vapor","<swift><websocket><vapor>","0","0","","","","48874931","118712","118712","vapor","592","36204589","36204588"
"48877691","1","","","2018-02-20 04:07:50","","2","81","<p>I've already set up the Models correctly (using Sourcery) but when I try to perform a JOIN, Fluent can't detect the key correctly.</p>

<p>Simplified model:</p>

<ul>
<li>Client: id / company_id</li>
<li>Company: id</li>
<li>FK: Company.id ~ Client.company_id</li>
</ul>

<p>Not working:</p>

<pre><code>let query = try Client.makeQuery()
            .join(Company.self)
</code></pre>

<blockquote>
  <p>[MySQL Error: Unknown column '<strong>company.client_id</strong>' in 'on clause'] [Identifier: MySQL.MySQLError.1054 (badFieldError)]]</p>
</blockquote>

<p>Working:</p>

<pre><code>let query = try Client.makeQuery()
            .join(kind: .outer, Company.self, baseKey: Client.Keys.companyId, joinedKey: Company.Keys.id)
</code></pre>

<p>Why does vapor think the key is <strong>company.client_id</strong> ?</p>

<p>Edit. Using Vapor 2.4.4</p>
","2124535","","2124535","","2018-02-26 14:23:07","2018-02-26 14:23:07","Incorrect key detected when doing JOIN in Vapor's Fluent","<mysql><swift><join><vapor>","0","0","","","","48877691","118712","118712","vapor","592","36204589","36204588"
"48896098","1","","","2018-02-20 23:51:58","","6","1591","<h2>Background</h2>

<p>Given the following sample models (chose 2 simple examples that show a 1-n relationship):</p>

<pre><code>final class Company: MySQLModel {
    var id: Int?
    var name: String
}

final class Client: MySQLModel {
    var id: Int?
    var attr1: Int
    var attr2: String
    var companyId: Company.ID

    static func prepare(on connection: MySQLDatabase.Connection) -&gt; Future&lt;Void&gt; {

        return Database.create(self, on: connection, closure: { builder in
            try addProperties(to: builder)
            builder.addReference(from: \.companyId, to: \Company.id, actions: .update)
        })
    }
}
</code></pre>

<h2>Question</h2>

<p>Is there a way to fetch &amp; return the result of a JOINED query (e.g: Company - Client // One-to-Many) without the need of raw queries ? I tried using Query and Relationships but there's no way to fetch all of them in one try.</p>

<p>Ideally, the returned data would've a nested structure like the following:</p>

<p>Expected:</p>

<pre><code>{
  ""name"": ""Alice"",
  ""id"": 0000000001,
  ""company"": {
    ""id"": 11111111,
    ""name"": ""Stack Overflow""
  }
}
</code></pre>

<hr>

<h2>Solution (aka workaround)</h2>

<p>I did manage to get it ""working"" by using an extra structure (call it Wrapper, Box, Merged, etc.) to hold all the entities and finally use makeJSON to return it inside the Controller.</p>

<pre><code>    let query = try db.query(Client.self)
        .filter(\.attr1 &gt; 123)
        .filter(\.attr2 == ""abc"")
    let client = try query.first()

    // client.company is just an attribute of Client that uses
    // the *parent* method to retrieve it
    if let client = client, let company = try client.company.get() {

        // others uses *children* method
        let others = try client.others.limit(5).all()

        let companyJSON = company.dictionary! // dictionary returns [String:Any] for any Encodable
        let clientJSON = client.dictionary!


        let merged = clientJSON.merging([ ""company"": companyJSON ], uniquingKeysWith: { (first, _) in first })
        return merged
    }
</code></pre>

<hr>

<h2>Final comments</h2>

<p>Is using a wrapper entity the only way to do it (without using raw queries) ? Dealing with multi-level results would be really tedious.</p>

<p>Edit: I've already found a related question <a href=""https://stackoverflow.com/questions/46962166/is-it-possible-to-access-fields-in-a-joined-table-in-vapor"">Is it possible to access fields in a joined table in Vapor?</a> but the answer didn't work in the same way I intended to.</p>

<p>Edit2: I've recently migrated to Vapor3, hence the new code. I think Vapor2 would be the same idea but you'd have to write a bit more code since Vapor3 introduced Codable support.</p>
","2124535","","2124535","","2019-06-16 18:18:37","2019-06-16 18:18:37","Fetching all fields from joined query in Vapor 3","<mysql><swift><vapor>","2","1","","","","48896098","118712","118712","vapor","592","36204589","36204588"
"48928279","1","49112379","","2018-02-22 13:10:13","","2","473","<p>I am trying to deploy a new vapor app build using Vapor 3 beta and Swift 4.1 to Heroku but there is a constant failure in building. I tried adding <code>.swift-version</code> file with <code>4.1</code> in it, but no luck. </p>

<p>Also tried setting a new build pack using 
<code>$ heroku buildpacks:set https://github.com/vapor-community/heroku-buildpack.git</code></p>

<pre><code>$ vapor --version
Vapor Toolbox: 3.1.4
Vapor Framework: 3.0.0-beta.3.1.3`
</code></pre>

<p>These are logs I see in terminal</p>

<pre><code>$ git push heroku master
Counting objects: 50, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (40/40), done.
Writing objects: 100% (50/50), 12.55 KiB | 3.14 MiB/s, done.
Total 50 (delta 11), reused 0 (delta 0)
remote: Compressing source files... done.
remote: Building source:
remote: 
remote: -----&gt; Swift app detected
remote: -----&gt; Installing clang 5.0.0
remote: -----&gt; Installing swiftenv
remote: Cloning into 'swiftenv'...
remote: -----&gt; Installing Swift 4.1
remote: We don't have build instructions for 4.1.
remote:  !     Push rejected, failed to compile Swift app.
remote: 
remote:  !     Push failed
remote: Verifying deploy...
remote: 
remote: !   Push rejected to serene-cliffs-74861.
remote: 
To https://git.heroku.com/serene-cliffs-74861.git
! [remote rejected] master -&gt; master (pre-receive hook declined)
error: failed to push some refs to 'https://git.heroku.com/serene-cliffs-74861.git'`
</code></pre>

<p>In my heroku App, I see the following build logs</p>

<pre><code>-----&gt; Swift app detected
-----&gt; Installing clang 5.0.0
-----&gt; Installing swiftenv
Cloning into 'swiftenv'...
-----&gt; Installing Swift 4.1
We don't have build instructions for 4.1.
!     Push rejected, failed to compile Swift app.
!     Push failed`
</code></pre>

<p>Can someone please help me solve the issue. </p>
","8830357","","","","","2018-03-05 14:12:04","Issue in deploying Vapor 3 beta app to Heroku using Swift 4.1","<swift><heroku><vapor>","1","0","","","","48928279","118712","118712","vapor","592","36204589","36204588"
"48952725","1","","","2018-02-23 16:54:47","","1","69","<p>I am trying to setup a simple vapor web socket. My issue is that I need to maintain the web sockets that are open. In order to do that they need to be stored in a variable. Here is my current code: </p>

<pre><code>import Vapor

var test = [Instance]()

final class Instance {
    var socket:WebSocket
    var message:String = """"
    var id:String = """"
}

extension Droplet {
    func setupRoutes() throws {
        get(""hello"") { req in
            var json = JSON()
            try json.set(""hello"", ""world"")
            return json
        }
    }

    //Socket code goes here as well
}
</code></pre>

<p>I keep getting an error while trying to run my project saying, <code>Use of unresolved identifier 'Instance'</code>, Why am I getting this error and how do I fix it? What is the best practicing while using web sockets with vapor?</p>
","7835545","","","","","2018-02-23 16:54:47","Setting variables with custom class using Websockets and vapor","<swift><vapor>","0","0","","","","48952725","118712","118712","vapor","592","36204589","36204588"
"48956695","1","","","2018-02-23 21:48:05","","0","127","<p>I'm running into a performance bottleneck with Vapor's multi-part parser, when copying an ArraySlice into a new Array. </p>

<p>Presumably the copying is done to allow accessing the slice's first byte at index zero in other parts of the framework.</p>

<p>Giving the huge penalty for copying a few bytes, isn't there a way in Swift to create a subarray without copying who's first index starts at zero, so it can be passed to other components without needing to translate indices?</p>

<p><a href=""https://i.stack.imgur.com/M18P1.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/M18P1.jpg"" alt=""enter image description here""></a></p>

<p>Source: <a href=""https://github.com/vapor/multipart/blob/master/Sources/Multipart/Parser.swift"" rel=""nofollow noreferrer"">https://github.com/vapor/multipart/blob/master/Sources/Multipart/Parser.swift</a></p>
","581784","","581784","","2018-02-23 22:07:12","2018-02-23 22:07:12","Swift ArraySlice with zero-based index","<swift><vapor>","0","6","","","","48956695","118712","118712","vapor","592","36204589","36204588"
"48975590","1","","","2018-02-25 16:12:35","","0","155","<p>I would like to host multiple domains with one Vapor server. In the documentation, I do not see where we can assign domains to routes? Is this possible?</p>
","5233913","","2124535","","2018-02-27 13:47:57","2018-02-27 20:32:01","Vapor - How to assign multiple domains to routes?","<swift><vapor>","1","0","","","","48975590","118712","118712","vapor","592","36204589","36204588"
"49041311","1","49058804","","2018-03-01 01:33:39","","1","58","<p>I have added the <a href=""https://www.w3schools.com/howto/howto_js_scroll_to_top.asp"" rel=""nofollow noreferrer"">Scroll Back To Top Button</a> in my Base template and it's working perfectly. But when I go to any other pages, the button won't work. Why?!</p>

<p>Here is my Base template:</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;

  &lt;body&gt;
    &lt;button onclick=""topFunction()"" id=""myBtn"" title=""Go to top""&gt;Top&lt;/button&gt;
    .
    .
    &lt;div class=""container""&gt;
      #import(""content"") 
    &lt;/div&gt;
    .
    .
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>And I'm using the JavaScript from the above link:</p>

<pre><code>window.onscroll = function() { scrollFunction() };

function scrollFunction() {
  if (document.body.scrollTop &gt; 50 || document.documentElement.scrollTop &gt; 50) {
    $('#myBtn').fadeIn();
  } else {
    $('#myBtn').fadeOut();
  }
}

function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
</code></pre>

<p>The button is only working on the homepage, but not on any other pages even though I see (from View Page Source) <code>&lt;button onclick=""topFunction()"" id=""myBtn"" title=""Go to top""&gt;Top&lt;/button&gt;</code> is in the body. Can anyone please help??</p>
","1081016","","","","","2018-03-01 21:15:33","Scroll To Top Button not working in Child templates","<javascript><scroll><scrolltop><vapor><leaf>","1","2","","","","49041311","118712","118712","vapor","592","36204589","36204588"
"49049734","1","","","2018-03-01 12:27:43","","2","206","<p>I have an issue with sorting date new first using Tag in leaf, vapor. From MySQL database, its showing the date and time but new entry at the end when I use ""get"" in routes.swift and perfectly show date and time in HTML on the webpage. My each entity date and time is successfully fetched from MySQL but new user entity comes at the end after using #loop in leaf. Is there any way possible to #loop in latest time and date first. Below is code.</p>

<p>Custom Tag code </p>

<pre><code>import Leaf
import Fluent

final public class LeafDataPoint: BasicTag {

public var name = ""dataPoint""

public func run(arguments: ArgumentList) throws -&gt; Node? {
    guard
        arguments.count == 3,
        let report = arguments[0],
        let dataPointName = arguments[1]?.string,
        let dateField = arguments[2]?.string
    else {
        return nil
    }
    let point = try DataPointFluent.makeQuery()
        .filter(DataPointFluent.Keys.reportID, 
 report.get(ReportFluent.Keys.id) as String)
        .filter(DataPointFluent.Keys.name, dataPointName.string)
        .first()


    switch dateField {
    case DataPointFluent.Keys.data:
        return point?.data?.makeNode(in: nil)
    case DataPointFluent.Keys.displayName:
        return point?.displayName.makeNode(in: nil)

    default:
        return nil
    }

}
}
</code></pre>

<p>In Routes.swift</p>

<pre><code>  get(""machine"", String.parameter) {req in
        let machineSerial = try req.parameters.next(String.self)
        let reports = try ReportFluent.byMachine(serial: machineSerial)
        return try self.view.make(""machine_overview.leaf"",[""reports"": 
reports,""id"": machineSerial])
    }
</code></pre>

<p>machine_overview.leaf </p>

<pre><code>&lt;table&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;h3&gt;Date&lt;/h3&gt;&lt;/th&gt;
            &lt;th&gt;&lt;h3&gt;Location&lt;/h3&gt;&lt;/th&gt;
            &lt;th&gt;&lt;h3&gt;Link&lt;/h3&gt;&lt;/th&gt;
        &lt;/tr&gt;
        #loop(reports, ""report"") {

        &lt;tr&gt;
            &lt;td&gt;#(report.date)&lt;/td&gt;
            &lt;td&gt;#dataPoint(report, ""ort"", ""data"")&lt;/td&gt;

            &lt;td&gt;&lt;a href=""/bericht/#(report.id)""&gt;Complete Report Data&lt;/a&gt;&lt;/td&gt;

        &lt;/tr&gt;
        }
    &lt;/table&gt;
</code></pre>

<p>I have tried with loop.isFirst but did not succeed.</p>
","7880782","","","","","2018-03-01 12:27:43","Sorting latest time and date using leaf #loop and custom tag using MySql. Vapor, Fluent","<html><swift><fluent><vapor><leaf>","0","2","","","","49049734","118712","118712","vapor","592","36204589","36204588"
"49055478","1","","","2018-03-01 17:29:59","","1","238","<p>I am creating a web socket in my vapor code and saving data that is sent to that socket into a PostgreSQL database. The database and code is all hosted on heroku. Heroku only allows for 20 connections to the database. Creating a web socket using vapor requires a closure and that closure is retaining a connection to my heroku database even once the socket is closed. I don't know why. Here is my code. </p>

<pre><code>func setupRoutes() throws {
    socket(""log"") { req, ws in
        background {
            while ws.state == .open {
                try? ws.ping()
                self.console.wait(seconds: 10) // every 10 seconds
            }
        }

        ws.onText = { ws, text in
            //print (""log is \(text)"")
            let logMessage = try JSON(bytes: text.utf8.array)
            guard let instanceId = logMessage![""serverPlatformId""]?.string else {try ws.send(""no platform sent""); return}
            guard let date = logMessage![""date""]?.double else {print (""no date sent""); try ws.send(""no date sent"");return}
            guard let percent = logMessage![""percent""]?.double else {print (""no percent sent""); try ws.send(""no percent sent"");return}


            let incoming = LogAnalytics(instanceId: instanceId, date: date, percent: percent)
            try incoming.save()
        }

        ws.onClose = { ws, _, _, _ in
            print (""log sokcet closeing"")
            try ws.send(""log socket closed"")
        }
    }
}
</code></pre>

<p>I need to somehow close the connection to the database or release the connection when the socket is closed. I keep reaching my limit on the number of connections to the database and as a result I have to remove all connections and allow the server to reconnect. How do I release the connections to the database as the socket closes or even manually within the code? </p>

<p>Here is now the <code>LogAnalytics</code> class is setup. </p>

<pre><code>final class LogAnalytics:Model, Preparation, RowRepresentable, JSONRepresentable, NodeRepresentable {

        var instanceId:String
        var date:Double
        var percent:Double

        var id: Node?

        let storage = Storage()

        init(row: Row) throws {
            id = try row.get(""id"")
            instanceId = try row.get(""instanceId"")
            percent = try row.get(""percent"")
            date = try row.get(""date"")
        }

        func makeRow() throws -&gt; Row {
            var row = Row()
            try row.set(""id"", id)
            try row.set(""instanceId"", instanceId)
            try row.set(""percent"", percent)
            try row.set(""date"", date)
            return row
        }

        static func prepare(_ database: Database) throws {
            try database.create(self, closure: { (log) in
                log.id()
                log.string(""instanceId"")
                log.double(""date"")
                log.double(""percent"")
            })
        }

        static func revert(_ database: Database) throws {
            try database.delete(self)
        }
}
</code></pre>
","7835545","","","","","2019-11-12 00:12:38","Vapor web socket retaining connection to database","<swift><postgresql><heroku><vapor>","1","0","","","","49055478","118712","118712","vapor","592","36204589","36204588"
"49067575","1","","","2018-03-02 10:47:44","","1","119","<p>Using Vapor for testing json message :</p>

<pre><code>        get(""post"") { req in
        guard let name = req.data[""name""]?.string else {
            throw Abort.badRequest
        }

        return try JSON(json: [
            ""message"": ""Hello, \(name)!""
            ])
    }
</code></pre>

<p>I get this error :</p>

<blockquote>
  <p>Cannot convert value of type 'String' to expected dictionary value type 'JSON'</p>
</blockquote>

<p>How do I solve this issue?</p>
","8593302","","","","","2018-03-02 10:47:44","How to insert swift interpolation in json vapor return message?","<json><swift><vapor>","0","2","","","","49067575","118712","118712","vapor","592","36204589","36204588"
"49072653","1","49089881","","2018-03-02 15:51:15","","1","251","<p><strong>What I am trying to do</strong></p>

<p>I am following the guide to Install Vapor on macOS <a href=""https://docs.vapor.codes/2.0/getting-started/install-on-macos/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/2.0/getting-started/install-on-macos/</a></p>

<p><strong>Verify Swift Installation</strong></p>

<pre><code>eval ""$(curl -sL check.vapor.sh)""
</code></pre>

<blockquote>
  <p>supported Vapor v 2</p>
</blockquote>

<p><strong>Add Homebrew Tap</strong></p>

<pre><code>brew tap vapor/homebrew-tap
brew update
brew install vapor
</code></pre>

<blockquote>
  <p>Vapor Toolbox: 3.1.4 is installed</p>
</blockquote>

<p>My info: </p>

<p>iMac (24-inch, Early 2009)</p>

<p><strong>OS X</strong> El Capitan - Version 10.11.6 </p>

<p>Xcode Version 8.2.1 (8C1002)</p>

<p>Toolchain: Swift 3.1 RELEASE 2017-03-27 (a)</p>

<p><a href=""https://swift.org/builds/swift-3.1-release/xcode/swift-3.1-RELEASE/swift-3.1-RELEASE-osx.pkg"" rel=""nofollow noreferrer"">https://swift.org/builds/swift-3.1-release/xcode/swift-3.1-RELEASE/swift-3.1-RELEASE-osx.pkg</a></p>

<p>** <strong>UPDATE</strong> **</p>

<p><em>I cloned two repositories</em> <a href=""https://github.com/vapor/api-template"" rel=""nofollow noreferrer"">https://github.com/vapor/api-template</a> (b6c7df2) and <a href=""https://github.com/vapor/web-template"" rel=""nofollow noreferrer"">https://github.com/vapor/web-template</a> (d206163)</p>

<blockquote>
  <p>Now I can create a Vapor v2 with Swift 3.1 projects like this:</p>
</blockquote>

<p><strong><em>API Template</em></strong></p>

<pre><code>vapor new ApiTemplate --template=https://github.com/ValeriyKliuk/vapor-2-api-template
cd ApiTemplate/
vapor xcode -y
</code></pre>

<p><strong><em>WEB Template</em></strong></p>

<pre><code>vapor new WebTemplate --template=https://github.com/ValeriyKliuk/vapor-2-web-template
cd WebTemplate/
vapor xcode -y
</code></pre>
","677394","","677394","","2018-03-08 00:18:58","2018-03-08 00:18:58","How to install Vapor 2 for Xcode 8.2.1 with Swift 3.1","<swift3><vapor><xcode8.2>","1","0","","","","49072653","118712","118712","vapor","592","36204589","36204588"
"49212491","1","49218582","","2018-03-10 18:20:04","","1","160","<p>Using Vapor for return model to node :</p>

<pre><code> func indexView(request: Request) throws -&gt; ResponseRepresentable
    {
        let acro = try Acronym.makeQuery().sort(Acronym.idKey, .ascending)

        return try acro.all().makeNode(in: &lt;#T##Context?#&gt;)
    }
</code></pre>

<p>It always return error and don't know how to fixed it. </p>
","8593302","","","","","2018-05-03 19:26:27","What is context in makeNode(in: Context) vapor 3?","<swift><vapor>","2","0","","","","49212491","118712","118712","vapor","592","36204589","36204588"
"49224763","1","","","2018-03-11 20:31:16","","0","44","<p>In Vapor MongoKitten there is an <code>update</code> method which accept array of documents. Is update atomically executed or it is method only for convenient use? <code>MongoDB</code> doc says:</p>

<blockquote>
  <p>When a single write operation modifies multiple documents, the
  modification of each document is atomic, but the operation as a whole
  is not atomic and other operations may interleave.</p>
</blockquote>

<p><a href=""https://docs.mongodb.com/manual/core/write-operations-atomicity/"" rel=""nofollow noreferrer"">https://docs.mongodb.com/manual/core/write-operations-atomicity/</a></p>
","239219","","","","","2018-06-15 13:55:46","MongoKitten batch update is atomic or not?","<mongodb><vapor><mongokitten>","1","0","","","","49224763","118712","118712","vapor","592","36204589","36204588"
"49469545","1","","","2018-03-24 20:24:03","","0","275","<p>How would I go about generating a slug for a <code>SQLiteModel</code> object, and using it in Leaf for Vapor 3? My goal is to provide a search engine friendly link to the detail page of my model (for example, <code>/tag/swift/</code> vs. <code>/tag/0/</code>), rather than link using the <code>id</code>.</p>

<p>I found the <code>Parameter</code> protocol, which means my model has a <code>uniqueSlug</code> property. Unfortunately using it in Leaf <code>#(model.uniqueSlug)</code> doesn't work.</p>

<p><strong>Here's my leaf code:</strong></p>

<pre><code>  #for(tag in tags) {
      &lt;a class=""tag"" href=""tag/#(tag.id)""&gt;#(tag.name)&lt;/a&gt;
  }
</code></pre>

<p><strong>Here's my model:</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Tag: SQLiteModel, Codable {
  var id: Int?
  var name: String
  var description: String

  init(id: Int? = nil, name: String, description: String) {
    self.id = id
    self.name = name
    self.description = description
  }
}

extension Tag: Migration { }

extension Tag: Content { }

extension Tag: Parameter { }
</code></pre>

<p><strong>I also tried adding a computed property to the model:</strong></p>

<pre class=""lang-swift prettyprint-override""><code>var slug: String {
  return ""test""
}
</code></pre>

<p>That also doesn't work.</p>
","1575489","","","","","2018-03-24 20:24:03","How to use a slug in Vapor 3","<swift><vapor>","0","3","","","","49469545","118712","118712","vapor","592","36204589","36204588"
"49489067","1","49494528","","2018-03-26 10:18:03","","4","1178","<p>I'm a vapor beginner and I chose to start with Vapor 3-rc because it seems to break change from Vaport 2. Unfortunately, there isn't a complete documentation for now.</p>

<p>I'm currently trying to upload a simple txt file from Postman to my Vapor 3 local server.</p>

<p>Here's my route</p>

<pre><code>let uploadController = FileUploadController()
router.post(""uploadtxt"", use: uploadController.uploadTXT)
</code></pre>

<p>and my controller</p>

<pre><code>final class FileUploadController {
    func uploadTXT(_ req: Request) throws -&gt; Future&lt;String&gt; {
        return try req.content.decode(MultipartForm.self).map(to: String.self, { form in
            let file = try form.getFile(named: ""txtfile"")
            return file.filename ?? ""no-file""
        })
    }
}
</code></pre>

<p>First, by executing the Postman request, the server returns:</p>

<pre><code>{""error"":true,""reason"":""There is no configured decoder for multipart\/form-data; boundary=...}
</code></pre>

<p>By investigating the source code and the <a href=""https://docs.vapor.codes/3.0/getting-started/content/#configuring-content"" rel=""nofollow noreferrer"">limited documentation</a> on this, it seems that I should declare a decoder to support multipart incoming requests.</p>

<p>So I did:</p>

<pre><code>var contentConfig = ContentConfig.default()
let decoder = FormURLDecoder()
contentConfig.use(decoder: decoder, for: .multipart)
services.register(contentConfig)
</code></pre>

<p>I used <code>FormURLDecoder</code> because it seemed to be the closest class for my needs IMO, implementing <code>BodyDecoder</code></p>

<p>Now it infite-loops into <code>func decode&lt;T&gt;(_ type: T.Type) throws -&gt; T where T: Decodable</code> of <code>FormURLSingleValueDecoder</code>, and I'm stuck here with very few web resource.</p>
","127493","","","","","2019-09-26 07:06:38","How to handle multipart request with Vapor 3","<swift><vapor>","1","0","3","","","49489067","118712","118712","vapor","592","36204589","36204588"
"49489180","1","49497055","","2018-03-26 10:24:46","","0","85","<p>Is it possible to get session value in Leaf?</p>

<p>As <a href=""https://stackoverflow.com/questions/40843100/access-session-in-leaf-template"">this post</a> suggested, I should be able to access session using <code>#(request.session)</code>.</p>

<p>But when I set a value in session:</p>

<pre><code>try request.assertSession().data.set(""foo"", ""bar"")
</code></pre>

<p>I got nothing using:</p>

<pre><code>#(request.session.foo)
</code></pre>

<p>I also tried:</p>

<pre><code>#(foo)
#(session.foo)
#(session.data.foo)
#(request.session.data.foo)
</code></pre>

<p>None of them works.</p>

<p>What am I missing? I'm on Vapor 2.4.4 with Leaf Provider 1.1.0.</p>
","6692025","","","","","2018-03-26 17:15:22","Is it possible to access session value in Leaf?","<vapor><leaf>","1","0","","","","49489180","118712","118712","vapor","592","36204589","36204588"
"49578320","1","49578794","","2018-03-30 16:57:26","","0","132","<p>I am starting out with an almost blank project and I can render a simple page from welcome.leaf using this:</p>

<pre><code>router.get(""view"") { req -&gt; Future&lt;View&gt; in
    let leaf = try req.make(LeafRenderer.self)
    return leaf.render(""welcome"")
}
</code></pre>

<p>However, if I put <strong>#loop</strong> into welcome.leaf I get this message: </p>

<pre><code>[ ERROR ] TemplateError.serialize: No tag named `loop` is registered. in /Users/david/CloudStation/XcodeProjects/Vapor3affordat/Resources/Views/welcome.leaf line: 24 column: 1 range: 580..&lt;785 (TemplateSerializer.swift:59)
</code></pre>

<p>Why does it not recognize the loop leaf command?</p>
","2422271","","","","","2018-03-30 17:34:11","Why doesn't it recognize the Leaf command: #loop","<swift><vapor><leaf>","1","0","","","","49578320","118712","118712","vapor","592","36204589","36204588"
"49594004","1","","","2018-04-01 01:34:13","","1","369","<p>I have a couple of major gaps in my understanding of vapor/leaf/html. I am working from the ""todo"" example that is created using the beta branch of vapor.</p>

<p>First, I made my own fluent model (no problems that I know of):</p>

<pre><code>import FluentSQLite
import Vapor
final class affordatmodel: SQLiteModel {
    var id: Int?
    var propertyCost: String
    var targetEquity: String
    var interestRate: String
    var amortization: String
    var sponsor1: String
    var sponsor2: String
    var rent: String
    var rentInflation: String
    var propertyTaxes: String
    var propertyTaxesInflation: String
    var strataFees: String
    var strataFeesInflation: String
    init(propertyCost: String, targetEquity: String, interestRate: String, amortization: String, sponsor1: String, sponsor2: String, rent: String, rentInflation: String, propertyTaxes: String, propertyTaxesInflation: String, strataFees: String, strataFeesInflation: String) {
        self.propertyCost = propertyCost
        self.targetEquity = targetEquity
        self.interestRate = interestRate
        self.amortization = amortization
        self.sponsor1 = sponsor1
        self.sponsor2 = sponsor2
        self.rent = rent
        self.rentInflation = rentInflation
        self.propertyTaxes = propertyTaxes
        self.propertyTaxesInflation = propertyTaxesInflation
        self.strataFees = strataFees
        self.strataFeesInflation = strataFeesInflation
    }
}
/// Allows to be used as a dynamic migration.
extension affordatmodel: Migration { }
/// Allows to be encoded to and decoded from HTTP messages.
extension affordatmodel: Content { }
/// Allows to be used as a dynamic parameter in route definitions.
extension affordatmodel: Parameter { }
</code></pre>

<p>Then I make an instance and send it to a leaf template:</p>

<pre><code>let defaultData = affordatmodel(propertyCost: ""700000"", targetEquity: ""300000"", interestRate: ""1"", amortization: ""20"", sponsor1: ""500000"", sponsor2: ""200000"", rent: ""1200"", rentInflation: ""1"", propertyTaxes: ""8000"", propertyTaxesInflation: ""1"", strataFees: ""0"", strataFeesInflation: ""0"")
return leaf.render(""welcome"", [""affordat"": defaultData])
</code></pre>

<p>And my Leaf template successfully populates the html with the default data (body shown here):</p>

<pre><code>&lt;body class=""container""&gt;
    &lt;h1&gt;Payment and Principal Calculations&lt;/h1&gt;

    &lt;form action=""/affordat"" method=""POST""&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""propertyCost""&gt;Property Cost&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""propertyCost"" placeholder=""#(affordat.propertyCost)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""targetEquity""&gt;Target Equity&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""targetEquity"" placeholder=""#(affordat.targetEquity)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""interestRate""&gt;Interest Rate&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""interestRate"" placeholder=""#(affordat.interestRate)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""amortization""&gt;Amortization (years)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""amortization"" placeholder=""#(affordat.amortization)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""sponsor1""&gt;Sponsor 1 Funds&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""sponsor1"" placeholder=""#(affordat.sponsor1)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""sponsor2""&gt;Sponsor 2 Funds&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""sponsor2"" placeholder=""#(affordat.sponsor2)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""rent""&gt;Rent&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""rent"" placeholder=""#(affordat.rent)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""rentInflation""&gt;Rent Inflation (will be used exactly)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""rentInflation"" placeholder=""#(affordat.rentInflation)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""propertyTaxes""&gt;Property Taxes (first year est.)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""propertyTaxes"" placeholder=""#(affordat.propertyTaxes)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""propertyTaxesInflation""&gt;Property Taxes Inflation (est.)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""propertyTaxesInflation"" placeholder=""#(affordat.propertyTaxesInflation)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""strataFees""&gt;Strata Fees (first year est.)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""strataFees"" placeholder=""#(affordat.strataFees)""&gt;
                &lt;/div&gt;
        &lt;div class=""form-group""&gt;
            &lt;label for=""strataFeesInflation""&gt;Strata Fees Inflation (est.)&lt;/label&gt;
            &lt;input type=""number"" class=""form-control"" name=""strataFeesInflation"" placeholder=""#(affordat.strataFeesInflation)""&gt;
                &lt;/div&gt;

        &lt;input type=""hidden"" name=""_csrf"" value=""{{csrfToken}}""&gt;
            &lt;button type=""submit"" class=""btn btn-primary""&gt;Refresh Calculations&lt;/button&gt;
            &lt;/form&gt;

&lt;/body&gt;
</code></pre>

<p>Great, so I know how to get fluent data to HTML. My problem is I don't know how to get it back. When the ""Post"" occurs, the data does not seem to get passed to the controller. My route is:</p>

<pre><code>router.post(""affordat"", use: affordatController.create)
</code></pre>

<p>And the relevant part of my controller looks like this:</p>

<pre><code>import Vapor
final class AffordatController {
    func create(_ req: Request) throws -&gt; Future&lt;affordatmodel&gt; {
        return try req.content.decode(affordatmodel.self).flatMap(to: affordatmodel.self) { affordatmodel1 in
            return affordatmodel1.save(on: req)
        }
    }
}
</code></pre>

<p>Which shows me one of my models, with an ID #, but no data. And I kind of understand why because I didn't really seem to send the post data to the controller. <strong>How I am supposed to send the POST data to the controller?</strong> Is the problem in my leaf template, my route, or my controller?</p>
","2422271","","","","","2019-08-16 13:15:14","How to pass data from using POST/form leaf template?","<swift><post><vapor><leaf>","1","2","","","","49594004","118712","118712","vapor","592","36204589","36204588"
"49616734","1","49637348","","2018-04-02 18:32:07","","2","891","<p>macOS Height Sierra 10.13.4<br>
Xcode version 9.3</p>

<pre><code>$ swift --version
Apple Swift version 4.1 (swiftlang-902.0.48 clang-902.0.37.1)
Target: x86_64-apple-darwin17.5.0

$ brew info vapor
vapor/tap/vapor: stable 3.1.4.l
https://vapor.codes
/usr/local/Cellar/vapor/3.1.4.l (4 files, 17.0MB) *
  Built from source on 2018-04-01 at 23:55:47
From: https://github.com/vapor/homebrew-tap/blob/master/vapor.rb
==&gt; Dependencies
Required: ctls ✔, libressl ✔

$ eval ""$(curl -sL check.vapor.sh)""
✅  Xcode 9 is compatible with Vapor 2.
✅  Xcode 9 is compatible with Vapor 3.
✅  Swift 4.1 is compatible with Vapor 2.
✅  Swift 4.1 is compatible with Vapor 3.

$ vapor version
Vapor Toolbox: 3.1.4
</code></pre>

<p>I create new project with:</p>

<pre><code>vapor new Hello --template=api
</code></pre>

<p>and when I try to build it:</p>

<pre><code>vapor build --verbose
</code></pre>

<p>I get the error:</p>

<pre><code>No .build folder, fetch may take a while...
Fetching Dependencies ...
warning: 'fetch' command is deprecated; use 'resolve' instead
/PATH-TO-PROJECT: error: manifest parse error(s):
&lt;module-includes&gt;:5:9: note: in file included from &lt;module-includes&gt;:5:
#import ""copyfile.h""
        ^      
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/include/copyfile.h:36:10: note: in file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Develo. per/SDKs/MacOSX10.13.sdk
/usr/include/copyfile.h:36:
#include &lt;stdint.h&gt;
         ^
/usr/local/include/stdint.h:59:11: note: in file included from /usr/local/include/stdint.h:59:
# include &lt;stdint.h&gt;
          ^
/usr/local/include/stdbool.h:4:10: note: in file included from /usr/local/include/stdbool.h:4:
#include &lt;stdbool.h&gt;
         ^

&lt;unknown&gt;:0: error: could not build Objective-C module 'Darwin'
Building Project [Failed]
Error: execute(1)
</code></pre>

<p>Does anyone have any idea what is going wrong there? Thanks in advance!</p>
","3276007","","3276007","","2018-04-02 18:39:11","2018-10-13 19:15:21","vapor build error: manifest parse error(s)","<swift><swift4.1><vapor>","3","0","1","","","49616734","118712","118712","vapor","592","36204589","36204588"
"49759378","1","","","2018-04-10 17:09:31","","0","186","<p>I have issues rendering leaf templates.</p>

<p>I have set up leaf as documented in vapor docs:</p>

<pre><code>  try services.register(LeafProvider())
  config.prefer(LeafRenderer.self, for: TemplateRenderer.self)
</code></pre>

<p>When routing, variable like #(42) are not rendered correctly. Actually nothing happens it prints the file.leaf as it is.</p>

<pre><code>router.get(""results"") { request -&gt; Future&lt;View&gt; in
  let view = try request.view()
  assert(view is LeafRenderer)
  return try request.view().render(""results"")
}
</code></pre>
","2232305","","1000551","","2018-08-03 09:41:52","2018-08-03 09:41:52","Leaf templated not rendered vapor 3.0","<swift><vapor><leaf>","1","0","","","","49759378","118712","118712","vapor","592","36204589","36204588"
"49768251","1","49784319","","2018-04-11 06:45:51","","0","448","<p>My server can open, but my database does not create the table user, I do not know the problem of my code, all I do is according to vapor document.</p>

<p>I add preparation and addProvider in Config+Setup.swift</p>

<p>the log:</p>

<pre><code>The current hash key ""0000000000000000"" is not secure.
Update hash.key in Config/crypto.json before using in production.
Use `openssl rand -base64 &lt;length&gt;` to generate a random string.
The current cipher key ""AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="" is not secure.
Update cipher.key in Config/crypto.json before using in production.
Use `openssl rand -base64 32` to generate a random string.
[2018-04-11 06:40:12 +0000] SELECT COUNT(*) as _fluent_aggregate FROM `fluent`
[2018-04-11 06:40:12 +0000] CREATE TABLE `fluent` (`id` INTEGER PRIMARY KEY NOT NULL, `name` TEXT NOT NULL, `batch` INTEGER NOT NULL, `created_at` TEXT NOT NULL, `updated_at` TEXT NOT NULL)
[2018-04-11 06:40:12 +0000] SELECT `fluent`.* FROM `fluent` ORDER BY `fluent`.`batch` DESC LIMIT 0, 1
[2018-04-11 06:40:12 +0000] SELECT `fluent`.* FROM `fluent` WHERE `fluent`.`name` = ? LIMIT 0, 1 [Post]
[2018-04-11 06:40:12 +0000] CREATE TABLE `posts` (`id` INTEGER PRIMARY KEY NOT NULL, `content` TEXT NOT NULL)
[2018-04-11 06:40:12 +0000] INSERT INTO `fluent` (`name`, `updated_at`, `id`, `batch`, `created_at`) VALUES (?, ?, ?, ?, ?) [Post, 2018-04-11T06:40:12.762Z, , 1, 2018-04-11T06:40:12.762Z]
[2018-04-11 06:40:12 +0000] SELECT `fluent`.* FROM `fluent` WHERE `fluent`.`name` = ? LIMIT 0, 1 [Users]
[2018-04-11 06:40:12 +0000] CREATE TABLE `userss` (`id` INTEGER PRIMARY KEY NOT NULL, `usename` TEXT NOT NULL, `passWord` INTEGER NOT NULL)
[2018-04-11 06:40:12 +0000] INSERT INTO `fluent` (`name`, `updated_at`, `id`, `batch`, `created_at`) VALUES (?, ?, ?, ?, ?) [Users, 2018-04-11T06:40:12.766Z, , 1, 2018-04-11T06:40:12.766Z]
[2018-04-11 06:40:12 +0000] SELECT `fluent`.* FROM `fluent` WHERE `fluent`.`name` = ? LIMIT 0, 1 [Festival]
[2018-04-11 06:40:12 +0000] CREATE TABLE `festivals` (`id` INTEGER PRIMARY KEY NOT NULL, `date` TEXT NOT NULL, `name` TEXT NOT NULL)
[2018-04-11 06:40:12 +0000] INSERT INTO `fluent` (`name`, `updated_at`, `id`, `batch`, `created_at`) VALUES (?, ?, ?, ?, ?) [Festival, 2018-04-11T06:40:12.770Z, , 1, 2018-04-11T06:40:12.770Z]
Database prepared
No command supplied, defaulting to serve...
Starting server on 0.0.0.0:8080
</code></pre>

<p>this is my model user.swift</p>

<pre><code>import MySQLProvider

final class Users: Model {
    var usename: String
    var passWord: Int
    let storage = Storage()

    init(row: Row) throws {
        usename = try row.get(""name"")
        passWord = try row.get(""passWord"")
    }

    init(usename: String, passWord: Int) {
        self.usename = usename
        self.passWord = passWord
    }


    func makeRow() throws -&gt; Row {
        var row = Row()
        try row.set(""usename"", usename)
        try row.set(""passWord"", passWord)
        return row
    }
}


extension Users: Preparation {
    static func prepare(_ database: Database) throws {
        try database.create(self) { user in
            user.id()
            user.string(""usename"")
            user.int(""passWord"")
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete(self)
    }
}
</code></pre>

<p>mysql.json</p>

<pre><code>{
    ""hostname"": ""localhost"",
    ""user"": ""root"",
    ""password"": ""123456"",
    ""database"": ""User""
}
</code></pre>

<p>my Config+Setup.swift</p>

<pre><code>extension Config {
    public func setup() throws {
        // allow fuzzy conversions for these types
        // (add your own types here)
        Node.fuzzy = [Row.self, JSON.self, Node.self]

        try setupProviders()
        try setupPreparations()
    }

    /// Configure providers
    private func setupProviders() throws {
        try addProvider(FluentProvider.Provider.self)
        try addProvider(MySQLProvider.Provider.self)
    }

    /// Add all models that should have their
    /// schemas prepared before the app boots
    private func setupPreparations() throws {
        preparations.append(Post.self)
        preparations.append(Users.self)
        preparations.append(Festival.self)
    }
}
</code></pre>

<p>I don't know where the problem is, so I really hope you can help me solve this problem </p>
","6593917","","6593917","","2018-04-12 11:47:24","2018-04-12 11:47:24","When i use Vapor with Mysql, My database do not generate the table automatically","<mysql><swift><vapor>","2","3","","","","49768251","118712","118712","vapor","592","36204589","36204588"
"49934346","1","50034290","","2018-04-20 05:04:59","","1","71","<p>In my <code>PostgreSQLModel</code> vapor class I'm using a simple <code>Migration</code> extension to create the database table.</p>

<pre class=""lang-swift prettyprint-override""><code>extension Order: Migration {
    static func prepare(on connection: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: connection) { builder in
            try addProperties(to: builder)
            try builder.addReference(from: \.stationID, to: \Station.id)
        }
    }
}
</code></pre>

<p>The problem I'm having is my <code>Date</code> fields are being created as <code>timestamp without time zone</code> whereas what I really want is just <code>date</code>.  How do I specify this?  Do I have to skip the <code>addProperties</code> and manually call <code>addField</code> on the builder myself for each column?</p>
","1455351","","","","","2018-04-26 03:16:18","Specify type of Date field","<vapor>","1","4","","","","49934346","118712","118712","vapor","592","36204589","36204588"
"49961181","1","50032050","","2018-04-21 23:47:07","","1","188","<p>I am attempting to write a simple scraper with AlamoFire, vis a vis a server-side Vapor back end. AlamoFire appears to be initiated properly, but I'm not getting any action from the callback handler.</p>

<pre><code>import Routing
import Vapor
import Alamofire

public func routes(_ router: Router) throws {
    router.get(""scrape"") { req -&gt; String in
        let stuff = Stuff(id: nil, sourcecode: ""This saves to the database."")
        stuff.save(on: req)
        let q = Alamofire.request(""http://sigh-fi.com/test.txt"").responseString { response in

            // None of this prints to the terminal.
            print(""Success: \(response.result.isSuccess)"")
            print(""Request: \(String(describing: response.response))"")
            print(""Result: \(String(describing: response.result))"")
            print(""String: \(String(describing: response.result.value))"")

            // ideally I'd like to run...
            // let morestuff = Stuff(id: nil, sourcecode: response.result.value)
            let morestuff = Stuff(id: nil, sourcecode: ""This doesn't save to the database, so I'm not even getting that far."")
            morestuff.save(on: req)
        }
        print(q) // prints ""GET http://sigh-fi.com/test.txt"" as expected
        return ""okay""
    }
}
</code></pre>

<p>Unfortunately I can't tell if this is a Vapor problem, an Alamofire or Swift problem. Any suggestions would be greatly appreciated.</p>
","82944","","123632","","2018-05-17 15:03:39","2018-05-17 15:03:39","AlamoFire doesn't appear to be doing anything","<alamofire><vapor>","1","1","","","","49961181","118712","118712","vapor","592","36204589","36204588"
"49992464","1","50044745","","2018-04-24 02:16:16","","8","499","<p>I'm confused on how to query the children of a model object and use it immediately.  My <code>Client</code> contains a number of <code>Station</code> children</p>

<pre class=""lang-swift prettyprint-override""><code>final class Client: PostgreSQLModel {
    var stations: Children&lt;Client, Station&gt; {
        return children(\.clientID)
    }
}
</code></pre>

<p>and then in my controller I have a list of clients that I want to look at and grab their stations.</p>

<pre class=""lang-swift prettyprint-override""><code>func clientIndexHandler(_ req: Request) throws -&gt; Future&lt;View&gt; {
    return Client.query(on: req).all().flatMap(to: View.self) { clients in
        let sorted = clients.sorted { ... }
        let content = try sorted.map { client in
            let stations = try client.stations
                                       .query(on: req)
                                       .all()
                                       .map(to: [String].self) { stations in
                return stations.map { $0.name }
            }

            // Now I want to use the stations for other stuff.

            return ClientIndexContent(client: client, stations: stations, ....)
        }

        let context = ClientIndexContext(clients: content)
        return try req.make(LeafRenderer.self).render(""clients/index"", context)
    }
}
</code></pre>

<p>My problem is that <code>stations</code> is an <code>EventLoopFuture&lt;[String]&gt;</code> instead of a <code>[String]</code>.  Since I'm using Leaf here I need the actual values from the clients and stations so that I can populate the content to pass into the leaf renderer.</p>
","1455351","","2124535","","2018-05-01 21:39:11","2018-05-01 21:39:11","Query child in Fluent+Vapor","<fluent><vapor>","1","0","","","","49992464","118712","118712","vapor","592","36204589","36204588"
"50014647","1","","","2018-04-25 05:30:56","","1","320","<p>How do I execute SQL query like this in Fluent?</p>

<pre><code>SELECT `book`.*
  FROM `book`
  JOIN `book_user` ON `book`.`id` = `book_user`.`bookId`
GROUP BY `book`.`id`
ORDER BY COUNT(`book`.`id`) DESC;
</code></pre>

<p>I tried to achieve this using:</p>

<pre><code>Book.query(on: req)
    .join(UserBookPivot.self, field: \UserBookPivot.bookId, to: \Book.id, method: .inner)
    .group(by: \Book.id)
    .sort(\Book.id, .descending)
    .all()
</code></pre>

<p>which only produced a query like this:</p>

<pre><code>SELECT * 
--     ^
  FROM `book` 
  JOIN `book_user` ON `book`.`id` = `book_user`.`bookId` 
GROUP BY `book`.`id` 
ORDER BY `book`.`id` DESC;
--       ^^^^^^^^^^^
</code></pre>

<p>Still can't find a way to produce <code>ORDER BY COUNT(book.id)</code> and <code>SELECT book.*</code>.</p>

<p>Is it possible to do this in the current version of vapor besides using <code>.simpleQuery(_:)</code> manually?</p>

<p>Env:</p>

<blockquote>
  <p>Vapor: 3.0.0.rc-2.7</p>
  
  <p>Fluent: 3.0.0.rc-2.3.3</p>
  
  <p>Fluent-mysql: 3.0.0.rc-2.3</p>
</blockquote>
","6692025","","2124535","","2018-05-01 23:13:53","2018-05-01 23:13:53","How to sort by dynamic column in Fluent Vapor 3","<mysql><fluent><vapor>","0","2","","","","50014647","118712","118712","vapor","592","36204589","36204588"
"50083628","1","50124414","","2018-04-29 05:19:07","","0","194","<p>I have a <code>Vapor 3</code> project which can upload some content String with format in <code>html</code>. And have function to load this content as a <code>html</code> page. The code looks like:</p>

<pre><code>func newpost(_ reqest: Request) throws -&gt; Future&lt;View&gt; {
    self.getContent(req: reqest) { (content) in
        return try reqest.view().render(""newpost.leaf"", content)
    }

}

func getContent(req:Request, callback: @escaping (String) -&gt; ()) {
   let _ = BlogModel.query(on: req).first().map(to: BlogModel.self) { (blog) -&gt; (BlogModel) in
        callback((blog?.content)!)
        return blog!
    }
}
</code></pre>

<p>But this code lead to error:</p>

<blockquote>
  <p>Invalid conversion from throwing function of type '(_) throws -> _' to non-throwing function type '(String) -> ()'</p>
</blockquote>

<p>If I try <code>return try reqest.view().render(""newpost.leaf"", content)</code> out site the block then I cannot get the <code>content</code>. Please help me for the right way to load it.</p>
","4327164","","1000551","","2018-08-03 09:41:38","2018-08-03 09:41:38","Correct way to load data from database and load it to the view in Vapor 3?","<swift><swift4.1><vapor>","1","0","","","","50083628","118712","118712","vapor","592","36204589","36204588"
"50102528","1","","","2018-04-30 14:24:27","","1","219","<p>I would like to build vapor toolbox with the latest vapor 3.x.</p>

<p>However, Package.swift of vapor toolbox still has Vapor 2.x dependency.</p>

<pre><code>.Package(url: ""https://github.com/vapor/vapor.git"", majorVersion: 2)
</code></pre>

<p>Does anyone knows why?</p>
","9721582","","2124535","","2018-05-03 13:48:09","2018-05-03 13:49:58","How to build vapor toolbox with vapor 3.x","<swift><vapor>","2","0","","","","50102528","118712","118712","vapor","592","36204589","36204588"
"50190421","1","50191578","","2018-05-05 14:18:16","","2","363","<p>That's the error </p>

<blockquote>
  <p>Please choose which ViewRenderer you prefer, multiple are available: PlaintextRenderer, LeafRenderer.</p>
</blockquote>

<p>that's my code in <strong>configure.swift</strong></p>

<pre><code>try services.register(LeafProvider())
config.prefer(LeafRenderer.self, for: TemplateRenderer.self)
</code></pre>

<p>Leaf added to <strong>Package.swift</strong> </p>

<pre><code>.target(name: ""App"", dependencies: [""Vapor"", ""FluentSQLite"", ""Crypto"", ""Leaf""]),
</code></pre>

<p>Although I did <strong>vapor xcode</strong> , <strong>Build</strong> and <strong>Run</strong> as well , But it still refuses to work.</p>
","4034825","","1000551","","2018-08-03 09:41:26","2018-08-03 09:41:26","Swift vapor 3 ViewRenderer error","<swift><vapor><leaf>","1","0","","","","50190421","118712","118712","vapor","592","36204589","36204588"
"50205434","1","","","2018-05-06 23:29:51","","0","253","<p>The new Vapor has come with new upgrades, meaning many imports don't work with the new software.For example, <a href=""https://github.com/BrettRToomey/Jobs"" rel=""nofollow noreferrer"">Jobs</a>, a minimalistic job system in Swift worked perfectly for older version of Vapor but not newer, is there any alternative to create Timers as regular timers don't work for server side Swift?</p>
","6951854","","","","","2018-06-04 14:56:37","Vapor 3 Swift 4 How to Make a Timer","<swift><server-side><jobs><vapor>","1","1","","","","50205434","118712","118712","vapor","592","36204589","36204588"
"50208856","1","50323970","","2018-05-07 07:12:42","","4","147","<p>I want to create a command in which you can create a user (like database seeds).</p>

<p>However, I cannot access a database in a command, my code is like the following:</p>

<pre><code>import Command
import Crypto

struct CreateUserCommand: Command {
    var arguments: [CommandArgument] {
        return [.argument(name: ""email"")]
    }

    var options: [CommandOption] {
        return [
            .value(name: ""password"", short: ""p"", default: """", help: [""Password of a user""]),
        ]
    }

    var help: [String] {
        return [""Create a user with provided identities.""]
    }

    func run(using context: CommandContext) throws -&gt; Future&lt;Void&gt; {
        let email = try context.argument(""email"")
        let password = try context.requireOption(""password"")
        let passwordHash = try BCrypt.hash(password)
        let user = User(email: email, password: password)
        return user.save(on: context.container).map(to: Future&lt;Void&gt;) { user in
            return .done(on: context.container)
        }
    }
}
</code></pre>

<p>Like the above, I want to save users by executing a query on <code>context.container</code>, but I got <code>argument type 'Container' does not conform to expected type 'DatabaseConnectable'</code> Error.</p>

<p>How to access to the database in a command?</p>
","3583377","","","","","2018-05-14 06:58:40","Accessing database in a command","<vapor>","1","0","","","","50208856","118712","118712","vapor","592","36204589","36204588"
"50288957","1","50333494","","2018-05-11 09:14:03","","4","734","<p>I was wondering how to create many-to-many relations in Vapor 3 using Fluent and FluentMySQL as described in the <a href=""https://docs.vapor.codes/2.0/fluent/relations/"" rel=""nofollow noreferrer"">Vapor 2 docs</a></p>

<p>Sadly, the <a href=""https://docs.vapor.codes/3.0/fluent/relations/"" rel=""nofollow noreferrer"">docs for Vapor 3</a> have not been updated yet and the implementation for the <code>Pivot</code> protocol has changed.</p>

<p>Here is what I'm trying to do: I have two classes, <code>User</code> and <code>Community</code>. A <code>Community</code> has <code>members</code> and <code>User</code>s can be members of multiple <code>Community</code>s.</p>

<p>Currently, my code looks like this:</p>

<pre><code>import Vapor
import FluentMySQL

final class Community: MySQLModel {
    var id: Int?
    //Community Attributes here
}

final class User: MySQLModel {
    var id: Int?
    //User Attributes here
}

extension Community {
    var members: Siblings&lt;Community, User, Pivot&lt;Community, User&gt;&gt; {
        return siblings()
    }
}
</code></pre>

<p>However, this causes the following compiler errors:</p>

<p><code>Cannot specialize non-generic type 'Pivot'</code> and <code>Using 'Pivot' as a concrete type conforming to protocol 'Pivot' is not supported</code>.</p>

<p>I have seen that there is a protocol extension called <code>ModifiablePivot</code> but I don't know how to use it since there is no documentation or sample code anywhere.</p>

<p>Any help is appreciated. Thanks in advance!</p>
","1043495","","","","","2018-08-16 14:48:37","Many-to-Many relations in Vapor 3 with Fluent","<mysql><swift><vapor>","3","0","2","","","50288957","118712","118712","vapor","592","36204589","36204588"
"50293040","1","","","2018-05-11 13:07:20","","1","136","<p>I have a Swift/Vapor app running on Ubuntu. It responds to and serves back JSON, i.e. a pure RESTful server.</p>

<p>I am looking to add some functionality where it can produce a PDF file, and then sends this back to the front-end (a web browser) in response to some request.</p>

<p>Could anyone recommend a best way of creating the PDF file on the server for sending back?</p>
","7820216","","5306470","","2018-05-11 14:19:39","2018-05-13 09:31:00","Creating PDF file using Swift on Ubuntu","<swift><pdf><ubuntu-14.04><vapor>","1","2","","","","50293040","118712","118712","vapor","592","36204589","36204588"
"50319602","1","","","2018-05-13 18:55:30","","4","1109","<p>I'm trying to create a simple vapor service so I can upload video files (one at a time) through an api. </p>

<p>From my app I'm uploading the video file using Alamofire:</p>

<pre><code>func uploadVideo(video: URL) {
    Alamofire.upload(videoFileURL, to: ""http://localhost:8080/upload"").responseString { response in
      debugPrint(response)
    }
}
</code></pre>

<p>The vapor controller method is like this (this is where I don't know how to do it):</p>

<pre><code>func upload(_ req: Request) throws -&gt; String {

  let data = try req.content.decode(Data.self).map(to: Data.self) { video in
    try Data(video).write(to: URL(fileURLWithPath: ""/Users/eivindml/Desktop/video.mp4""))
    return Data(video)
  }

  return ""Video uploaded"";
}
</code></pre>

<p>How do I get the video file from the request and into the right format so I can write it do disk? </p>

<p>The method <code>upload()</code> is called correctly etc, as it works if I just have the last return statement. </p>
","901034","","901034","","2018-05-14 05:28:36","2019-03-10 14:30:42","File upload using Swift Vapor 3.0","<swift><alamofire><vapor>","1","0","2","","","50319602","118712","118712","vapor","592","36204589","36204588"
"50334919","1","50343141","","2018-05-14 16:23:38","","0","260","<p>I had this error when trying to build from XCode , albeit it builds from terminal </p>

<blockquote>
  <p>clang: error: no such file or directory: '/Users/++/Desktop/vapor/til/.build/checkouts/sqlite.git--8232814251736334455/Sources/CSQLite/sqlite3.c'
  clang: error: no input files</p>
</blockquote>

<p>I'm using pgsql and this is my configure.swift</p>

<pre><code>// 1
import FluentPostgreSQL
import Vapor

public func configure(
    _ config: inout Config,
    _ env: inout Environment,
    _ services: inout Services
) throws {
    // 2
    try services.register(FluentPostgreSQLProvider())

    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    var middlewares = MiddlewareConfig()
    middlewares.use(ErrorMiddleware.self)
    services.register(middlewares)

    // 1
    var databases = DatabasesConfig()
    // 2
    let hostname = Environment.get(""DATABASE_HOSTNAME"")
        ?? ""localhost""
    let username = Environment.get(""DATABASE_USER"") ?? ""vapor""
    let databaseName = Environment.get(""DATABASE_DB"") ?? ""vapor""
    let password = Environment.get(""DATABASE_PASSWORD"")
        ?? ""password""
    // 3
    let databaseConfig = PostgreSQLDatabaseConfig(
        hostname: hname,
        username: username,
        database: databasesName,
        password: password)
    // 4
    let database = PostgreSQLDatabase(config: databaseConfig)
    // 5
    databases.add(database: database, as: .psql)
    // 6
    services.register(databases)

    var migrations = MigrationConfig()
    // 4
    migrations.add(model: Acronym.self, database: .psql)
    services.register(migrations)
}
</code></pre>

<p>I removed XCode and reinstalled it but no effect</p>
","4034825","","1000551","","2018-08-03 09:41:04","2018-08-03 09:41:04","Xcode error when building Vapor 3 framework","<swift><vapor>","1","0","","","","50334919","118712","118712","vapor","592","36204589","36204588"
"50364359","1","","","2018-05-16 07:03:46","","1","76","<p>Iam Currently New to Vapor Swift Server side initially i have Two Queries</p>

<blockquote>
  <p>1) <strong>Problem</strong></p>
</blockquote>

<p>Vapor build is getting Failed </p>

<blockquote>
  <p>Error:</p>
</blockquote>

<p>Build failed.</p>

<blockquote>
  <p>2)  Question</p>
</blockquote>

<p>While Running i getting localhost:8080/Hello this url works fine in Safari browser</p>

<p>When comes to Ios Application I Calling that URl GET Method i getting </p>

<blockquote>
  <p>Error</p>
</blockquote>

<p>error getting http:0.0.0.0:8080/Hello, HTTP status code 503</p>

<p>how to Test the Vapor Api's Outside of Any languages like Java,Javascript etc</p>
","6799539","","2124535","","2018-05-16 14:40:59","2018-05-16 14:53:28","Vapor Build Getting Failed","<api><vapor><swift4.1>","1","1","1","","","50364359","118712","118712","vapor","592","36204589","36204588"
"50374078","1","","","2018-05-16 14:52:33","","2","245","<p>Trying to write the request handler for the following request:</p>

<p>POST -> <code>/properties/{:propertyId}/issues</code></p>

<p>The handler should create a new Issue for the Property with <code>propertyId</code>. </p>

<p>I've registered the route like so:</p>

<pre><code>router.post(Issue.self, at: ""properties"", Int.parameter, ""issues"", use: createIssueHandler)
</code></pre>

<p>How would I write the handler to take <code>propertyId</code> from the request parameters, rather than requiring it in the JSON body?</p>

<pre><code>func createIssueHandler(_ req: Request, data: Issue) throws -&gt; Future&lt;Issue&gt; {
    let propertyId = try req.parameters.next(Int.self)
    let issue = Issue(
        title: data.title, 
        description: data.description,
        propertyId: propertyId
    )
    return issue.save(on: req)
}
</code></pre>
","5329298","","5329298","","2018-05-16 15:13:13","2018-05-16 15:44:37","How to handle a POST request for one to many relationship in Vapor 3.0?","<swift><rest><vapor>","1","0","1","","","50374078","118712","118712","vapor","592","36204589","36204588"
"50419681","1","50523195","","2018-05-18 21:49:59","","2","909","<p>I'm struggling to figure out how to join my two tables together using fluent.  In essence I want to run this SQL command:</p>

<pre class=""lang-sql prettyprint-override""><code>SELECT p.name, o.amount, o.amount * p.amount total
FROM ""OrderPoints"" o 
INNER JOIN ""Points"" p ON o.points_id = p.id 
WHERE order_id = 10831
</code></pre>

<p>I've got my two models setup like so:</p>



<pre class=""lang-swift prettyprint-override""><code>final class OrderPoint: Codable, PostgreSQLModel, Content, Migration {
    var id: Int? = nil
    var orderID: Order.ID
    var pointID: Point.ID
    var amount: Double = 0

    var point: Parent&lt;OrderPoint, Point&gt; {
        return parent(\.pointID)
    }
}

final class Point: Codable, PostgreSQLModel, Content, Migration {
    var id: Int? = nil
    var name: String
    var abbrev: String
    var amount: Double
}
</code></pre>

<p>So now in my controller I loop over all of the orders that I care about:</p>

<pre class=""lang-swift prettyprint-override""><code>// SELECT * FROM orders WHERE ""month"" = '2018-05-01'
let orders = try Order.query(on: req).filter(\Order.month == month).all()

return orders.flatMap(to: View.self) { orders in
    let content = try orders.map { (order) -&gt; OrderIndexContent in
        let values = try order.orderPoints.query(on: req).all()
</code></pre>

<p>and I think that gets me all the items from <code>order_points</code> for the current ID, but I am just not seeing how to join it with the <code>Points</code> model so that I can do the rest of the query (i.e. get the multiplied amount and the point name)</p>

<p><a href=""https://i.stack.imgur.com/aejie.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aejie.png"" alt=""enter image description here""></a></p>

<ul>
<li>An <code>Order</code> has multiple <code>OrderPoint</code> items.  </li>
<li>An <code>OrderPoint</code> has a <em>single</em> <code>Point</code> item.</li>
<li>A <code>Point</code> could point to many <code>OrderPoint</code> items.</li>
</ul>

<p>So in the way I think fluent refers to things, <code>OrderPoints</code> is <em>not</em> a pivot, as it's not a many to many.</p>

<h1>This can't be right.</h1>

<p>The following seems to be working, but there's no way this is the ""right"" way to do it as this would be massive amounts of extra SQL calls, right?</p>

<pre class=""lang-swift prettyprint-override""><code>_ = try! order.orderPoints
              .query(on: req)
              .all()
              .map(to: Void.self) { pointsForOrder in
                  pointsForOrder.forEach { orderPoint in
                      _ = try! orderPoint.point.get(on: req).map(to: Void.self) {
                          print(""\(order.id!) \(order.name) \($0.abbrev) \(orderPoint.pointID) = \(orderPoint.amount) = \($0.amount * orderPoint.amount)"")
                      }
                  }
          }
</code></pre>
","1455351","","1455351","","2018-05-25 05:26:25","2018-05-25 06:56:24","Doing joins with Fluent in a Vapor application","<fluent><vapor>","1","0","2","","","50419681","118712","118712","vapor","592","36204589","36204588"
"50455816","1","","","2018-05-21 19:59:40","","0","61","<p>I am using Perfect Framework for my server side application running on an AWS EC2 instance. I am using the following code to get client IP address.</p>

<pre><code>open static func someapi(request: HTTPRequest, _ response: HTTPResponse) {

    var clientIP = request.remoteAddress.host }
</code></pre>

<p>This was working fine until I installed ssl certificate on my EC2 instance and start redirecting incoming traffic to port 443. </p>

<p>Now this code gives me the ip of my server, i think due to the redirect, Perfect somehow think request comes from itself.</p>

<p>Is there any other method to get client IP address? Or do i have to try something else? </p>

<p>Thanks!</p>
","6435900","","","","","2018-05-21 20:31:03","SSL redirect changes client IP address read from HTTPResponse","<apache><vapor><perfect>","2","0","","","","50455816","118712","118712","vapor","592","36204589","36204588"
"50479138","1","","","2018-05-23 02:54:26","","0","131","<p>I got this compile issue when compiling using vapor+Xcode:</p>

<p><a href=""https://i.stack.imgur.com/uQmO1.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/uQmO1.png"" alt=""enter image description here""></a></p>

<p>Below are some related info:</p>

<pre><code>$ vapor --version
Vapor Toolbox: 3.1.7
Vapor Framework: 3.0.1

$ swift --version
Apple Swift version 4.1 (swiftlang-902.0.48 clang-902.0.37.1)
Target: x86_64-apple-darwin17.6.0
</code></pre>

<p>According to <a href=""https://github.com/apple/swift-corelibs-foundation/blob/master/Docs/Status.md"" rel=""nofollow noreferrer"">the status</a> this should be OK. Any ideas?</p>
","905260","","","","","2018-05-23 07:01:14","Timer.scheduledTimer no available when using vapor?","<swift><linux><nstimer><vapor><server-side-swift>","1","2","","","","50479138","118712","118712","vapor","592","36204589","36204588"
"50486869","1","50525081","","2018-05-23 11:08:53","","4","2386","<p>I am trying to make a POST request to a Firebase Notifications API using Vapor 1.5 and Firebase Legacy Protocol, but I get failure response. </p>

<blockquote>
  <p>response is JSON(node: Node.Node.object([""multicast_id"":
  Node.Node.number(5936281277445399934), ""failure"": Node.Node.number(0),
  ""canonical_ids"": Node.Node.number(0), ""results"":
  Node.Node.array([Node.Node.object([""message_id"":
  Node.Node.string(""0:1527074314969790%c7ade8b9f9fd7ecd"")])]),
  ""success"": Node.Node.number(1)]))    </p>
</blockquote>

<p><strong>EDIT</strong> 
Making the request through POSTMan fails with error ""The request was missing an Authentication Key (FCM Token).""</p>

<pre><code>class FirebaseRequester {
 let fcmLegacyServerKey = ""AIzaSyDSuXXXXXXkCafTQay5_r8j3snvVos""

 func sendNotification(payLoad: JSON) throws -&gt; Response {

    var response: Response?
    do {
        let responseFCM = try drop.client.post(""https://fcm.googleapis.com/fcm/send"", 
           headers: [""Content-Type"":""application/json"",""Authorization"": ""key\(fcmLegacyServerKey)""], 
           query: [:], 
          body: payLoad.makeBody())

        response = responseFCM

    }catch let error {
        let message = error.localizedDescription
        logErr.prints(message: message)
        throw Abort.custom(status: .badRequest, message: message)
    }

    guard let rsp = response?.json else {


        let message = ""no json received on line \(#line)""
        drop.log.error(message)
        logErr.prints(message: message)
        throw Abort.custom(status: .badRequest, message: message)
     }
  print(""rsp in json format is \(rsp)"")
      return response!
 }//end of sendNotification()
}//end of class FirebaseRequester




      //make another class here and initialize it with  FirebaseRequester
      //get data from Client App 
      // validate data 
      // finally, create the payLoad and call sendNotification(:)
     //request should look like 
{
  ""aps"": {
    ""alert"": ""Breaking News!"",
    ""sound"": ""default"",
    ""link_url"": ""https://raywenderlich.com""
 }
}

     let fcmKeyToSendTo = ""someDeviceTokenKeyReceivedFromClient_biHZNI-e9E53WEkCzrki""

            let data = try Node(node: [""alert"": ""alert"", ""sound"": ""sound"", ""link_url"": ""https://www.someWebsite.com""])

     var payLoadObj = try JSON(node: [""aps"" : data])
     payLoadObj[""to""] = try JSON(node: fcmKeyToSendTo)

            do {
                let _ = try firebaseRequester.sendNotification(payLoad: payLoadObj)
            }catch{
                logErr.prints(message: error.localizedDescription)
            }

            let message = ""notification Sent""
            return try JSON(node:[""success"":message])
</code></pre>

<p><a href=""https://i.stack.imgur.com/y31dj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/y31dj.png"" alt=""enter image description here""></a>
<a href=""https://i.stack.imgur.com/z1bvJ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/z1bvJ.png"" alt=""enter image description here""></a></p>
","5918849","","5918849","","2018-05-23 14:41:24","2018-05-25 08:45:23","How to send a POST request to Firebase Cloud Messaging API in Vapor","<firebase><firebase-cloud-messaging><vapor>","1","2","","","","50486869","118712","118712","vapor","592","36204589","36204588"
"50492163","1","50494079","","2018-05-23 15:26:05","","1","223","<p>I'm following a simple tutorial on using Vapor to setup a local server and it works by going to it in a web browser.  Now I would to know if there is a swift command to end or close this server?</p>

<p>Here is the current state of the terminal: </p>

<pre><code>Last login: Wed May 23 10:06:45 on ttys209
Laurences-MacBook-Air:server laurencewingo$ pwd
/Users/laurencewingo/desktop/server
Laurences-MacBook-Air:server laurencewingo$ swift run
Compile Swift Module 'Server' (1 sources)
Linking ./.build/x86_64-apple-macosx10.10/debug/Server
Started on port 2252
</code></pre>

<p>The command 'swift run' started the server but now I would like to close it.</p>
","6510422","","","","","2018-05-23 20:42:44","How to close a local server connection using Swift in the terminal?","<swift><localhost><vapor>","1","0","","","","50492163","118712","118712","vapor","592","36204589","36204588"
"50497952","1","","","2018-05-23 21:47:15","","1","137","<p>I have a web socket in an app built using Vapor 3 that I have deployed to Heroku. The socket keeps closing. How do I keep the socket alive in Vapor 3? In Vapor 2, I used these lines of code. How would I do the same thing in Vapor 3?</p>

<pre><code>background {
    while ws.state == .open {
        try? ws.ping()
        self.console.wait(seconds: 10) // every 10 seconds
    }
}
</code></pre>
","7835545","","","","","2018-07-19 17:48:39","Keeping Socket Alive with Vapor 3","<swift><heroku><websocket><vapor>","1","0","","","","50497952","118712","118712","vapor","592","36204589","36204588"
"50502003","1","50521431","","2018-05-24 06:01:39","","7","521","<p>Although there used to be some methods to get client IP address (e.g. <code>req.peerHostname</code> ), I cannot figure out how to get it in Vapor 3.0.</p>

<p>Could anyone please let me know how to get client IP address in Vapor 3.0?</p>
","3583377","","","","","2018-05-25 04:11:39","How to get client IP address in Vapor 3.0?","<swift><vapor>","1","0","2","","","50502003","118712","118712","vapor","592","36204589","36204588"
"50518103","1","50752552","","2018-05-24 21:00:50","","6","810","<p>I am learning Vapor, and as part of this process I am building a website using the framework. As part of my application, I would like to make use of the Uber API which makes use of OAuth.</p>

<p>The process of retrieving a User Access Token as outlined <a href=""https://developer.uber.com/docs/riders/guides/authentication/user-access-token"" rel=""noreferrer"">here</a> and it specifically recommends making use of a pre-built library to preform the authorization grant and token exchanges.</p>

<p>For OAuth, I was able to find two libraries, being:</p>

<p><a href=""https://github.com/OAuthSwift/OAuthSwift"" rel=""noreferrer"">OAuthSwift</a>
and
<a href=""https://github.com/p2/OAuth2"" rel=""noreferrer"">p2/OAuth2</a></p>

<p>Both libraries don't seem to be compatible with Swift's Package Manager though and as a result, can't be used with Vapor.</p>

<p>Is there any work around to this? Or would I have to manually create a library to support the OAuth process with Vapor?</p>
","3685709","","4667835","","2018-05-24 21:24:55","2018-06-08 02:35:04","Using a third party OAuth API in Vapor","<swift><oauth-2.0><vapor>","1","0","","","","50518103","118712","118712","vapor","592","36204589","36204588"
"50623979","1","","","2018-05-31 12:09:19","","1","61","<p>I am using a Dockerfile multistage configuration similar to the one below.</p>

<pre><code>FROM swift:4.1

WORKDIR /app
COPY . .
RUN swift build --configuration release &amp;&amp; mv `swift build -c release --show-bin-path` /build/bin

FROM ubuntu:16.04

RUN apt-get -qq update &amp;&amp; apt-get install -y \
  libicu55 libxml2 libbsd0 libcurl3 libatomic1 wget  &amp;&amp; rm -r /var/lib/apt/lists/*
RUN /bin/bash -c ""$(wget -qO- https://apt.vapor.sh)""
RUN wget -q https://repo.vapor.codes/apt/keyring.gpg -O- | apt-key add -
RUN apt-get update &amp;&amp; apt-get install swift vapor -y

WORKDIR /app
COPY --from=builder /build/bin .
COPY --from=builder /build/lib/* /usr/lib/
EXPOSE 3000

ENTRYPOINT ./Run serve -e prod -b 0.0.0.0 -p 3000
</code></pre>

<p>I am currently using this to deploy my service in a virtual server, which due to its low performance takes forever to build the project.</p>

<p>Is it a good practice, and possible, to build and upload to a private repo in docker hub the image result of the builder, so I can do it from my local machine?</p>

<p>Could I then just have the second step in my virtual server? That means:</p>

<pre><code>FROM myPrivateImageBuiltLocally as image

WORKDIR /app
COPY . .

FROM ubuntu:16.04

RUN apt-get -qq update &amp;&amp; apt-get install -y \
  libicu55 libxml2 libbsd0 libcurl3 libatomic1 wget  &amp;&amp; rm -r /var/lib/apt/lists/*
RUN /bin/bash -c ""$(wget -qO- https://apt.vapor.sh)""
RUN wget -q https://repo.vapor.codes/apt/keyring.gpg -O- | apt-key add -
RUN apt-get update &amp;&amp; apt-get install swift vapor -y

WORKDIR /app
COPY --from=builder /build/bin .
COPY --from=builder /build/lib/* /usr/lib/
EXPOSE 3000

ENTRYPOINT ./Run serve -e prod -b 0.0.0.0 -p 3000
</code></pre>
","3750435","","","","","2018-06-04 07:58:26","Private docker container to release","<docker><docker-compose><dockerhub><vapor>","1","0","","","","50623979","118712","118712","vapor","592","36204589","36204588"
"50629913","1","","","2018-05-31 17:40:04","","0","1237","<p>I get error from Vapor 1.5 server deployed to heroku. Swift version installed on heroku Swift 3.1 
JSON could not be serialized because of error: The data couldn't be read because it isn't in the correct format. If I call the server locally, <a href=""http://0.0.0.0:8080/my/route"" rel=""nofollow noreferrer"">http://0.0.0.0:8080/my/route</a> it is not throwing any error. 
How can I fix this?  </p>

<pre><code>===========Error===========
Error Code: 4
Error Messsage: JSON could not be serialized because of error:
The data couldn’t be read because it isn’t in the correct format.
Server Error: &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;meta name=""viewport"" content=""width=device-width, initial-scale=1""&gt;
        &lt;meta charset=""utf-8""&gt;
        &lt;title&gt;Application Error&lt;/title&gt;
        &lt;style media=""screen""&gt;
          html,body,iframe {
            margin: 0;
            padding: 0;
          }
          html,body {
            height: 100%;
            overflow: hidden;
          }
          iframe {
            width: 100%;
            height: 100%;
            border: 0;
          }
        &lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;iframe src=""//www.herokucdn.com/error-pages/application-error.html""&gt;&lt;/iframe&gt;
      &lt;/body&gt;
    &lt;/html&gt;
Alamofire.AFError.responseSerializationFailed(Alamofire.AFError.ResponseSerializationFailureReason.jsonSerializationFailed(Error Domain=NSCocoaErrorDomain Code=3840 ""Invalid value around character 0."" UserInfo={NSDebugDescription=Invalid value around character 0.}))
===========================
</code></pre>

<p>Server logs: </p>

<pre><code>remote: -----&gt; Compressing...
remote:        Done: 93.2M
remote: -----&gt; Launching...
remote:        Released v13
remote:        https://secure-garden-28988.herokuapp.com/ deployed to Heroku
remote: 
remote:  !   Warning: You are running on a deprecated stack.
remote:  !   Please upgrade to the latest stack by following the instructions on:
remote:  !   https://devcenter.heroku.com/articles/upgrading-to-the-latest-stack
remote: 
remote: Verifying deploy... done.
To https://git.heroku.com/secure-garden-28988.git
   c44026d..144abef  master -&gt; master
MacBook-Pro:StripePayment bogdanbarbulescu$ heroku logs
2018-05-30T12:03:01.197383+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=12878`
2018-05-30T12:03:03.094008+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-30T12:03:03.116578+00:00 app[web.1]: No command supplied, defaulting to serve...
2018-05-30T12:03:03.116707+00:00 app[web.1]: No preparations.
2018-05-30T12:03:03.117882+00:00 app[web.1]: Server 'default' starting at 0.0.0.0:12878
2018-05-30T12:03:04.870729+00:00 heroku[web.1]: State changed from starting to up
2018-05-30T12:03:07.989892+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2018-05-30T12:03:07.989934+00:00 app[web.1]: oauthJson line 76 is JSON(node: Node.Node.object([""token_type"": Node.Node.string(""Bearer""), ""access_token"": Node.Node.string(""ya29.c.ElvLBagSETr9DiPFjitMs4XtijYEdFR1OT4jDQx4WpwKkXX1ghZZQ3fMoaK7_07MlMOh8STSFeP4Xr4MpSeXg9_Sjk1xjBC19sLEWFoUhPMMyYKNem4oTOL-qXK_""), ""expires_in"": Node.Node.number(3600)]))
2018-05-30T12:03:07.989936+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.

2018-05-30T12:03:08.147558+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2018-05-30T12:03:08.887563+00:00 heroku[router]: at=info method=POST path=""/cancelbooking/bycleaner"" host=secure-garden-28988.herokuapp.com request_id=c4acdc48-ac25-42ed-9092-97bbc8a05b6c fwd=""90.219.212.108"" dyno=web.1 connect=2ms service=1266ms status=200 bytes=155 protocol=https
2018-05-30T12:39:40.718231+00:00 heroku[web.1]: Idling
2018-05-30T12:39:40.718872+00:00 heroku[web.1]: State changed from up to down
2018-05-30T12:39:42.031561+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2018-05-30T12:39:42.052902+00:00 app[web.1]: response data  is  on  line  135 Optional(Vapor.Content) and response.json is on  line  135 Optional(JSON.JSON(node: Node.Node.object([""LaundryWash"": Node.Node.string(""false""), ""CancelledBy"": Node.Node.object([""1527631309"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 28 minutes, 12 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527631309""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527631309""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""15""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 28 minutes, 12 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""15"")]), ""1527629794"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 53 minutes, 28 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527629794""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527629794""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""15""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 53 minutes, 28 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""15"")]), ""1527631550"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 24 minutes, 11 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527631550""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527631550""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""15""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 24 minutes, 11 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""15"")]), ""1527533036"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 44 hours, 46 minutes, 6 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527533036""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527533036""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""10""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 44 hours, 46 minutes, 6 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""10"")]), ""1527339097"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 98 hours, 38 minutes, 30 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527339097""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527339097""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""0""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 98 hours, 38 minutes, 30 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""0"")]), ""1527539792"": Node.Node.object([""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 42 hours, 53 minutes, 29 seconds before booking start time""), ""DateAndTime"": Node.Node.string(""Wed, 30 May 2018 16:30""), ""BookingStateTimeStamp"": Node.Node.string(""1527539792""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""false""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527539792""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""BookingNumber"": Node.Node.string(""236191463""), ""CostToCancelByCleaner"": Node.Node.string(""10""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 42 hours, 53 minutes, 29 seconds before booking start time""), ""BookingState"": Node.Node.string(""Active""), ""FeeAmountChargedToCleaner"": Node.Node.string(""10"")])]), ""ClaimedBy"": Node.Node.object([""1527339080"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527339080"")]), ""1527630525"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527630525"")]), ""1527631321"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527631321"")]), ""1527631560"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527631560"")]), ""1527539705"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527539705"")]), ""1527629774"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.strin
2018-05-30T12:39:42.052902+00:00 app[web.1]: g(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527629774"")]), ""1527339197"": Node.Node.object([""ProfitForBooking"": Node.Node.string(""11.184""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""RateNumberCleaner"": Node.Node.string(""1""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""RatePriceCleaner"": Node.Node.string(""8""), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""Claimed"": Node.Node.string(""true""), ""TimeStampBookingClaimed"": Node.Node.string(""1527339197"")])]), ""usersUID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""ReasonDebtToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 24 minutes, 11 seconds before booking start time""), ""CleanerUID"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""InsideFridge"": Node.Node.string(""false""), ""BookingNumber"": Node.Node.string(""236191463""), ""ProfitForBooking"": Node.Node.string(""11.184""), ""SuppliesAmount"": Node.Node.string(""0""), ""FeeReasonChargedToCleaner"": Node.Node.string(""Booking cancelled by cleaner 17 hours, 24 minutes, 11 seconds before booking start time""), ""RatePriceCleaner"": Node.Node.string(""8""), ""FeeAmountChargedToCleaner"": Node.Node.string(""15""), ""StripeCustomerID"": Node.Node.string(""cus_CvbxFJcNVbPT6q""), ""SelectedBedRow"": Node.Node.string(""2""), ""PhoneNumber"": Node.Node.string(""07476254556""), ""RateNumberCleaner"": Node.Node.string(""1""), ""BookingCompleted"": Node.Node.string(""false""), ""BookingStateTimeStamp"": Node.Node.string(""1527631550""), ""PaymentID"": Node.Node.string(""ch_1CW1rILCZ34Ur7XGg2wBQa05""), ""RatePriceClient"": Node.Node.string(""11""), ""EmailAddress"": Node.Node.string(""daria@gmail.com""), ""TimeStampBookingSavedInDB"": Node.Node.string(""1527339012""), ""BookingState"": Node.Node.string(""Active""), ""FlatNumber"": Node.Node.string(""12""), ""TimeStampDateAndTime"": Node.Node.string(""1527694200""), ""AmountPaidToCleanerWithoutSuppliesForBooking"": Node.Node.string(""32.0""), ""BookingAmount"": Node.Node.string(""44""), ""RateNumberClient"": Node.Node.string(""1""), ""BookingStatusClient"": Node.Node.string(""true""), ""FullName"": Node.Node.string(""Daniel Orchard""), ""Claimed"": Node.Node.string(""true""), ""SuppliesName"": Node.Node.string(""I have cleaning supplies""), ""FirebaseUserID"": Node.Node.string(""YL6jLbKq04XF2V0AX9PapH2jv8n2""), ""Locality"": Node.Node.string(""Barking""), ""SelectedBathRow"": Node.Node.string(""3""),   ""NumberOfHours"": Node.Node.string(""4.0""), ""ChangesMadeBy"": Node.Node.string(""Cleaner""), ""AmountPaidToCleanerForBooking"": Node.Node.string(""32.0""), ""CancelledByCleaner"": Node.Node.string(""6XkGK4amQ3dmp5DcIEWLWCAChzm1""), ""InsideCabinets"": Node.Node.string(""false""), ""AmountDebtToCleaner"": Node.Node.string(""0""), ""TimeStampBookingCancelledByCleaner"": Node.Node.string(""1527631550""), ""InteriorWindows"": Node.Node.string(""false""), ""BookingStatusAdmin"": Node.Node.string(""false""), ""CostToCancelByCleaner"": Node.Node.string(""15""), ""InsideOven"": Node.Node.string(""false""), ""FrequencyName"": Node.Node.string(""Once""), ""TimeStampBookingClaimed"": Node.Node.string(""1527631560"")])))
2018-05-30T12:39:42.052916+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2018-05-30T12:39:42.052918+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2018-05-30T12:39:42.052920+00:00 app[web.1]: [deprecated] Mozilla certificates have been deprecated and will be removed in future releases. Using 'defaults' instead.
2018-05-30T12:39:42.194492+00:00 heroku[web.1]: Process exited with status 15
2018-05-31T15:09:12.000000+00:00 app[api]: Build started by user bibscy@gmail.com
2018-05-31T15:14:39.000000+00:00 app[api]: Build failed -- check your build logs
2018-05-31T15:23:04.000000+00:00 app[api]: Build started by user bibscy@gmail.com
2018-05-31T15:28:54.000000+00:00 app[api]: Build failed -- check your build logs
2018-05-31T16:31:07.000000+00:00 app[api]: Build started by user bibscy@gmail.com
2018-05-31T16:38:29.385841+00:00 heroku[web.1]: State changed from down to starting
2018-05-31T16:38:29.008353+00:00 app[api]: Deploy c44026db by user bibscy@gmail.com
2018-05-31T16:38:29.008353+00:00 app[api]: Release v12 created by user bibscy@gmail.com
2018-05-31T16:38:29.000000+00:00 app[api]: Build succeeded
2018-05-31T16:38:34.176865+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=44193`
2018-05-31T16:38:36.463541+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T16:38:36.472842+00:00 app[web.1]: ***** Error in `App': munmap_chunk(): invalid pointer: 0x00000000020e6560 *****
2018-05-31T16:38:36.533050+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T16:38:36.613151+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T16:38:36.615245+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T16:38:41.089753+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=43368`
2018-05-31T16:38:42.986794+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T16:38:42.996321+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x000000000294b550 ***
2018-05-31T16:38:43.114123+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T16:38:43.049786+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T16:42:04.373616+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/retrieve/card"" host=secure-garden-28988.herokuapp.com request_id=d9a2ba08-84f3-4351-bafa-917c1e058caa fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T16:44:37.339103+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/update/feedback"" host=secure-garden-28988.herokuapp.com request_id=3312744c-792e-4063-8a63-1d21a10a38fd fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T16:49:48.491755+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=cd3d611a-569b-467c-a1f6-a63bf07de658 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T16:51:13.147039+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=f2ee6735-0306-4009-b8d0-d98c89efe95d fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T16:53:35.866344+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=a4d632db-ca6b-4160-908e-18cf06932b80 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:03:50.853957+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T17:03:55.862276+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=7299`
2018-05-31T17:03:58.278454+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T17:03:58.299536+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T17:03:58.073702+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T17:03:58.084443+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x0000000001869580 ***
2018-05-31T17:04:03.405673+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/retrieve/card"" host=secure-garden-28988.herokuapp.com request_id=b6d7e95e-6f1a-4836-8bef-369469a0fb25 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:04:41.220017+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/retrieve/card"" host=secure-garden-28988.herokuapp.com request_id=9be1b43a-c20b-48e2-ae82-19065b7d4c74 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:21:36.889814+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/claim/booking"" host=secure-garden-28988.herokuapp.com request_id=8cd175e0-f102-47d4-ab4e-0bf5adc1aada fwd=""213.205.251.116"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:21:56.892310+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/claim/booking"" host=secure-garden-28988.herokuapp.com request_id=8ed67298-7192-4737-8c3d-bc7887a77f8a fwd=""213.205.251.116"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:25:04.070396+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/retrieve/card"" host=secure-garden-28988.herokuapp.com request_id=9d84a993-f47f-4d14-b2ae-2d7416a99211 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:26:38.234967+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/retrieve/card"" host=secure-garden-28988.herokuapp.com request_id=82f9c4e8-8905-4f7a-aaf7-7a3cf079f345 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:31:11.556858+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=0085c6f9-56a4-4b1a-aa76-d45c4f2f54d4 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T17:33:08.792953+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=7aaeda34-e0ff-4948-b9fd-b76f5a992ed7 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T18:24:43.737202+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T18:24:47.597999+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=52841`
2018-05-31T18:24:48.702319+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T18:24:48.709006+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x0000000002194570 ***
2018-05-31T18:24:48.754172+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T18:24:48.772888+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T19:02:16.101019+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=POST path=""/charge/stripe"" host=secure-garden-28988.herokuapp.com request_id=deb8aef0-ab45-432f-8b75-b8cc88dc41e9 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T19:08:16.831884+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=GET path=""/"" host=secure-garden-28988.herokuapp.com request_id=460b8d95-a87a-401c-96ba-ed0ebeffe290 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T19:08:17.151541+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=GET path=""/favicon.ico"" host=secure-garden-28988.herokuapp.com request_id=1560fcee-cf87-4c7f-b421-81341a0c115e fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T19:59:04.998941+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=GET path=""/"" host=secure-garden-28988.herokuapp.com request_id=85fe73b9-edf8-4dd9-bd31-b8ee48b99853 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T19:59:05.308604+00:00 heroku[router]: at=error code=H10 desc=""App crashed"" method=GET path=""/favicon.ico"" host=secure-garden-28988.herokuapp.com request_id=c7cd24b0-bbd1-4f24-8c8c-bf6955bf5b43 fwd=""90.219.212.108"" dyno= connect= service= status=503 bytes= protocol=https
2018-05-31T20:07:32.846560+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T20:07:37.609077+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=29169`
2018-05-31T20:07:39.647815+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T20:07:39.665835+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T20:07:39.570953+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T20:07:39.583404+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x0000000001907560 ***
2018-05-31T20:15:15.000000+00:00 app[api]: Build started by user bibscy@gmail.com
2018-05-31T20:23:07.560223+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T20:23:07.109323+00:00 app[api]: Deploy 144abef6 by user bibscy@gmail.com
2018-05-31T20:23:07.000000+00:00 app[api]: Build succeeded
2018-05-31T20:23:07.109323+00:00 app[api]: Release v13 created by user bibscy@gmail.com
2018-05-31T20:23:11.823947+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=39733`
2018-05-31T20:23:14.142014+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T20:23:14.144759+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T20:23:14.064287+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T20:23:14.071214+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x00000000012bb570 ***
2018-05-31T20:23:14.123366+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T20:23:18.372532+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=9281`
2018-05-31T20:23:19.856366+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T20:23:19.803630+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T20:23:19.810069+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x0000000001e4c590 ***
2018-05-31T20:23:19.874068+00:00 heroku[web.1]: State changed from starting to crashed
2018-05-31T20:54:48.666238+00:00 heroku[web.1]: State changed from crashed to starting
2018-05-31T20:54:57.676303+00:00 heroku[web.1]: Starting process with command `App --env=production --workdir=./ --config:servers.default.port=23839`
2018-05-31T20:54:59.225378+00:00 heroku[web.1]: Process exited with status 134
2018-05-31T20:54:59.164261+00:00 app[web.1]: Production mode enabled, disabling informational logs.
2018-05-31T20:54:59.171129+00:00 app[web.1]: *** Error in `App': munmap_chunk(): invalid pointer: 0x0000000001a73590 ***
2018-05-31T20:54:59.300220+00:00 heroku[web.1]: State changed from starting to crashed
MacBook-Pro:StripePayment bogdanbarbulescu$ 
</code></pre>
","5918849","","5918849","","2018-05-31 21:41:37","2018-05-31 21:41:37","JSON could not be serialized because of error: The data couldn't be read because it isn't in the correct format","<heroku><vapor>","0","3","","","","50629913","118712","118712","vapor","592","36204589","36204588"
"50668027","1","","","2018-06-03 15:29:46","","0","337","<p>When i create a new vapor 3 project .
I got this error when building .</p>

<p>I tried it in the beta and non beta versions ..
I reinstalled vapor 
but still have that error.</p>

<pre><code>        No .build folder, fetch may take a while...
        Fetching Dependencies [                 •       ]
        Error: backgroundExecute(code: 1, error: ""warning: \'fetch\' command is deprecated; use \'resolve\' instead\nerror: failed to clone; Cloning into bare repository 
    \'/Users/Mercury/Desktop/vapor/n/.build/repositories/http.git-9159899851620770205\'...\nerror: RPC failed; curl 56 LibreSSL SSL_read: 
error:1409442E:SSL routines:SSL3_READ_BYTES:tlsv1 alert protocol version, errno 0\nfatal: The remote end hung up unexpectedly\n"", output: ""Fetching https://github.com/vapor/validation.git\nFetching 
    https://github.com/apple/swift-nio-zlib-support.git\nFetching https://github.com/vapor/http.git\nFetching https://github.com/vapor/sqlite.git\nFetching 
https://github.com/vapor/console.git\nFetching 
    https://github.com/vapor/core.git\nFetching
 https://github.com/vapor/crypto.git\nFetching 
    https://github.com/vapor/database-kit.git\nFetching 
https://github.com/vapor/routing.git\nFetching https://github.com/vapor/websocket.git\nFetching 
https://github.com/vapor/service.git\nFetching 
    https://github.com/apple/swift-nio.git\nFetching 
https://github.com/apple/swift-nio-ssl-support.git\nFetching https://github.com/vapor/fluent.git\nFetching 
https://github.com/vapor/template-kit.git\nFetching 
    https://github.com/vapor/url-encoded-form.git\nFetching \https://github.com/vapor/multipart.git\nFetching https://github.com/vapor/vapor.git\nFetching 
    https://github.com/apple/swift-nio-ssl.git\nFetching 
    https://github.com/vapor/sql.git\nFetching https://github.com/vapor/fluent-sqlite.git\n"")
</code></pre>
","4034825","","1000551","","2018-08-03 09:40:41","2018-08-03 09:40:41","Swift Vapor 3 build error","<vapor>","0","3","1","","","50668027","118712","118712","vapor","592","36204589","36204588"
"50874767","1","50889185","","2018-06-15 11:33:27","","2","532","<p>i'm using vapor's client to fetch a get request.</p>

<pre><code>func sendGetRequest(req: Request) throws -&gt; Future&lt;Response&gt; {
    let client = try req.make(FoundationClient.self)
    return client.get(""http://example.vapor.codes/json"", headers: [""Accept-Language"" : ""ar""])
        .map(to: Response.self, { clientResponse in
        let response = req.makeResponse()
        response.http.status = clientResponse.http.status
        response.http.body = clientResponse.http.body
        return response
    })
}
</code></pre>

<p>this returns all the json data , i want to filter it to just return 2 attributes, for example in this case (dict,number)</p>

<p>i've created a model for the data </p>

<pre><code>struct ExampleData: Codable {
  //  var array : [Int]
    var dict : [String : String]
    var number : Int
 //   var string : String
}
</code></pre>

<p>the function expects me to return a Future&lt; Response>, but if i change it to  Future&lt; ExampleData> and set the mapping to .map(to: ExampleData.self ..)</p>

<p>i get </p>

<blockquote>
  <p>Cannot convert return expression of type 'Response' to return type
  'TodoController.ExampleData'</p>
</blockquote>
","2145241","","","","","2018-06-16 18:59:09","Filter data From vapor client get","<swift><get><client><vapor><server-side-swift>","1","2","","","","50874767","118712","118712","vapor","592","36204589","36204588"
"50918927","1","","","2018-06-18 23:59:06","","1","334","<p>I'm experimenting with a server-side-Swift project using Vapor and Fluent. The idea for this project is to track athletes and their training plans and workouts. Trying to be protocol-oriented, I have a protocol named ""Workout,"" and then various classes that conform to ""Workout"" such as ""run,"" ""swim,"" etc.</p>

<p>Workout.swift:</p>

<pre><code>import Vapor
import FluentPostgreSQL

protocol Workout {
    var title: String { get set }
    var duration: Int { get set }
}
</code></pre>

<p>And then, for example, Run.swift:</p>

<pre><code>import Vapor
import FluentPostgreSQL

final class Run: Workout, Codable {
    //Conform to Workout
    var title: String
    var duration: Int

    //New Properties
    var distance: Double
    var id: Int?

    init(title: String, duration: Int, distance: Double) {
        self.title = title
        self.duration = duration
        self.distance = distance
    }
}

extension Run: PostgreSQLModel {}
extension Run: Content {}
</code></pre>

<p>When I create the model for ""Training Plan,"" I would like to have the parameter:</p>

<pre><code>var workouts = [Workout]?
</code></pre>

<p>to allow for any type which conforms to Workout.</p>

<p>TrainingPlan.swift:</p>

<pre><code>import Vapor
import FluentPostgreSQL

final class TrainingPlan: Codable {
    var id: Int?
    var title: String
    var workouts: [Workout]?

    init(title: String) {
        self.title = title
    }
}

extension TrainingPlan: PostgreSQLModel {}
extension TrainingPlan: Content {}
</code></pre>

<p>I get the following errors on TrainingPlan.swift:</p>

<blockquote>
  <p>Type 'TrainingPlan' does not conform to protocol 'Decodable'</p>
  
  <p>Type 'TrainingPlan' does not conform to protocol 'Encodable'</p>
</blockquote>

<p>Changing Workout.swift to:</p>

<pre><code>protocol Workout: Codable {
    var title: String { get set }
    var duration: Int { get set }
}
</code></pre>

<p>does not resolve the errors.</p>

<p>What would be the correct way to handle this with Fluent while still staying protocol-oriented in my data modeling? Thank you!</p>

<p><strong>UPDATE (6/20/18):</strong></p>

<p>Setting a generic type in TrainingPlan.swift (for types that conform to Workout) resolves the errors about conforming to Encodable / Decodable:</p>

<pre><code>import Vapor
import FluentPostgreSQL

final class TrainingPlan&lt;W: Workout&gt;: Codable {
    var id: Int?
    var title: String
    var workouts: [W]?

    init(title: String) {
        self.title = title
    }
}

extension TrainingPlan: PostgreSQLModel {}
extension TrainingPlan: Content {}
extension TrainingPlan: Parameter {}
extension TrainingPlan: Migration {}
</code></pre>

<p>However, this implementation causes another error with adding TrainingPlan to the database migration in configure.swift:</p>

<pre><code>migrations.add(model: TrainingPlan.self, database: .psql)
</code></pre>

<p>Produces the error:</p>

<blockquote>
  <p>Generic parameter 'W' could not be inferred</p>
</blockquote>
","9959125","","9959125","","2018-06-20 23:38:59","2018-07-20 12:57:46","Vapor / Fluent - Using Protocol Type in a model","<swift><fluent><vapor>","1","1","","","","50918927","118712","118712","vapor","592","36204589","36204588"
"51053128","1","","","2018-06-27 00:53:07","","1","74","<p>I am frequently needing to pass multiple objects through a series of chained Futures. I have solved the issue with code similar to the below, but it doesn't feel 'right'. Is there a better way to write this?</p>

<p>In particular, the lines beginning <code>return map(to:</code> don't smell right, as I'm taking an actual value <code>a</code> then turning it into a Future <code>conn.future(a)</code> just to be later flatMapped again in the next step.</p>

<p>In the contrived example below, we are creating an <code>A</code>, with a related object <code>B</code>, and optionally a <code>C</code> which is related to <code>B</code>, which is why <code>B</code> must be passed through the chain.</p>

<pre><code>class A {
  id: Int?
}
class B {
  id: Int?
  aId: Int?
}
class C {
  id: Int?
  bId: Int?
}

/// Creates an A and B, with an optionally attached C. Returns the A.
func create(withC: Bool, on conn: MySQLConnection) throws -&gt; Future&lt;A&gt; {
  return try A.create(on: conn)
    // Returning two futures
    .flatMap(to: (A, B).self) { a in
      let futureB = try B(aId: a.requireID()).create(on: conn)
      return map(to: (A, B).self, conn.future(a), futureB) { ($0, $1) }
    }
    // Returning two futures, one optional
    .flatMap(to: (A, C?).self) { a, b in
      guard withC else {
        return map(to: (A, C?).self, conn.future(a), conn.future(nil)) { ($0, $1) }
      }
      let futureC = try C(bId: b.requireId()).create(on: conn)
      return map(to: (A, C?).self, conn.future(a), futureC) { ($0, $1) }
    }
    // Convert back to the future we care about
    .map(to: A.self) { a, _ in return a }
}
</code></pre>
","284120","","","","","2018-06-27 00:53:07","Chaining futures with tuple types","<vapor>","0","0","","","","51053128","118712","118712","vapor","592","36204589","36204588"
"51112076","1","52884497","","2018-06-30 05:41:50","","0","101","<p>I have created backend with <strong>perfectswift</strong>. Now I am trying to deploy that with heroku but I am getting some kind of error while pushing. Help me to solve this issue.</p>

<p><img src=""https://i.stack.imgur.com/9O4SZ.png"" alt=""enter image description here""></p>
","6562108","","6523658","","2018-06-30 15:45:15","2018-10-19 00:57:55","Deploy perfect swift with heroku","<swift><ubuntu><heroku><vapor><perfect>","1","0","1","","","51112076","118712","118712","vapor","592","36204589","36204588"
"51214180","1","51217051","","2018-07-06 16:10:11","","2","537","<p>In Vapor 1.5 I used to convert Dictionary to JSON as shown below.<br>
How should I do it in Vapor 3.1?
 In docs it says I need to create struct type and conform it to codable protocol.<br>
Is there another method that would enable to convert the existing dictionary without creating new struct?  </p>

<pre><code>   func makeCustomJSON(clientData: DataFromClientChargeWithCard, paymentID:String,customer: String) throws -&gt; JSON {



    var dictionaryOfStrings = [String:String]()


    dictionaryOfStrings[""BookingState""] = ""Active""
    dictionaryOfStrings[""BookingStateTimeStamp""] = clientData.TimeStampBookingSavedInDB

    dictionaryOfStrings[""ChangesMadeBy""] = ""User""
    dictionaryOfStrings[""PaymentID""] = paymentID
    dictionaryOfStrings[""DateAndTime""] = clientData.DateAndTime
    dictionaryOfStrings[""RatePriceClient""] = clientData.RatePriceClient
    dictionaryOfStrings[""Locality""] = clientData.Locality
    dictionaryOfStrings[""StripeCustomerID""] = customer

    //some more properties below...

    let response:JSON
    do {
        response = try JSON(node: dictionaryOfStrings)
    }catch let error as NSError {
        let message = ""dictionaryOfStrings can't be converted in JSON""
        drop.log.error(message)
        logErr.prints(message: message, code: error.code)
        throw NSError(domain: ""errorDictionary"", code: 400, userInfo: [""error"" : error.localizedDescription])
    }
    return response
 }
</code></pre>
","5918849","","1000551","","2018-08-03 09:40:30","2018-08-03 09:40:30","How to convert Dictionary to JSON in Vapor 3?","<swift><vapor>","1","3","","","","51214180","118712","118712","vapor","592","36204589","36204588"
"51222934","1","51223853","","2018-07-07 11:50:14","","2","245","<p>In Vapor 1.5 I used to assign the elements of an existing dictionary to a JSON object as shown below. How can I do this Vapor 3?</p>

<pre><code> func makeCustomJSON(jsonFromReading: JSON, clientData: DataFromClient) throws -&gt; JSON{

    var dictionaryOfStrings = [String:String]()

    dictionaryOfStrings[""ChangesMadeBy""] = ""Cleaner""
    dictionaryOfStrings[""BookingNumber""] = clientData.bookingNumber
    dictionaryOfStrings[""Claimed""] = ""false""
     //some 50 properties more...


    //object read from /Users
    var finalJsonObj = jsonFromReading

    //assign the values of dictionaryOfStrings to finalJsonObj
    for i in dictionaryOfStrings {
        let key  = i.key
        let value = i.value
        finalJsonObj[key] = try JSON(node:value)
    }

    //make json from object under CancelledBy and assign it to arrayOfTimeStampObjs
    var arrayOfTimeStampObjs = try jsonFromReading[""CancelledBy""]?.makeJSON() ?? JSON(node:[String:Node]())


    //assign dictionaryOfStrings to current time stamp when booking is claimed
    arrayOfTimeStampObjs[clientData.timeStampBookingCancelledByCleaner] = try JSON(node:dictionaryOfStrings)
    finalJsonObj[""CancelledBy""] = arrayOfTimeStampObjs

    return finalJsonObj

} //end of makeCustomJSON
</code></pre>
","5918849","","1000551","","2018-08-03 09:40:20","2018-08-03 09:40:20","How to assign elements of a dictionary to JSON object in Vapor 3?","<swift><vapor>","1","0","1","","","51222934","118712","118712","vapor","592","36204589","36204588"
"51235345","1","","","2018-07-08 19:29:03","","2","109","<p>In <a href=""https://github.com/vapor/vapor"" rel=""nofollow noreferrer"">Vapor</a>, how does one setup to check and decline an upload request prior to any part of such file being uploaded to the server? </p>

<p>My current attempt in Vapor 3 is with a route handler structured like: </p>

<pre class=""lang-swift prettyprint-override""><code>func imagesUploadOneHandler(_ request: Request) throws -&gt; EventLoopFuture&lt;HTTPResponseStatus&gt; {

    let headers = request.http.headers
    let headersUploadToken: [String] = headers[""Upload-Token""]

    if headersUploadToken.count != 1 || headersUploadToken[0] != aValidToken {
        return HTTPResponseStatus.notAcceptable
    }

    // http body content type: 'application/octet-stream'
    let dataFuture: EventLoopFuture&lt;Data&gt; = request.http.body.consumeData(max: 50_000_000, on: request)

    let futureHTTPResponseStatus = dataFuture.map(to: HTTPResponseStatus.self, {
        (data: Data) -&gt; HTTPResponseStatus in
        // ... other code
        return HTTPResponseStatus.ok
    })

    return futureHTTPResponseStatus
}
</code></pre>

<p>Firstly, the above will not compile.  The line <code>return HTTPResponseStatus.notAcceptable</code> has a compile time error ""return HTTPResponseStatus.notAcceptable"". How to convert <code>HTTPResponseStatus</code> to <code>EventLoopFuture&lt;HTTPResponseStatus&gt;</code> has been elusive.</p>

<p>Secondly, can some code prior to <code>request.http.body.consumeData(...)</code> in a route handler prevent an upload of the file content? Or, is some middleware needed instead to avoid uploading the data content (e.g. some large file) from the <code>http.body</code>?</p>
","3103448","","","","","2018-07-08 19:29:03","Vapor: how to not receive a particular upload?","<swift><vapor>","0","2","","","","51235345","118712","118712","vapor","592","36204589","36204588"
"51250246","1","51250318","","2018-07-09 16:35:53","","2","73","<p>While playing with Vapor Hello sample (<a href=""https://docs.vapor.codes/3.0/getting-started/hello-world/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/getting-started/hello-world/</a>), I've encountered this:</p>

<pre><code>public func routes(_ router: Router) throws {
    ...
    let todoController = TodoController()
    router.get(""todos"", use: todoController.index)
    router.post(""todos"", use: todoController.create)
    router.delete(""todos"", Todo.parameter, use: todoController.delete)
}
</code></pre>

<p>As we can see here, <code>todoController</code> is a local variable of a global <code>routes</code> function. And it should be immediately deallocated after leaving its scope, because reference to it passed to nowhere. References to members are passed, but it's not how ARC works according to my level of understanding. However, <code>todoController</code> is alive during the whole program execution. Where is the trick here?</p>
","961037","","","","","2018-07-09 16:41:18","Strong reference in Vapor Hello sample","<swift><automatic-ref-counting><vapor>","1","0","","","","51250246","118712","118712","vapor","592","36204589","36204588"
"51292840","1","51298957","","2018-07-11 19:21:15","","1","120","<p>I am currently trying to add SwiftDate to a Vapor3 project via the swift package manager. Here is my package file:</p>

<pre><code>// swift-tools-version:4.0
import PackageDescription

let package = Package(
    name: ""timeshare"",
    dependencies: [
        // 💧 A server-side Swift web framework.
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),
        // Custom dependencies
        .package(url: ""https://github.com/malcommac/SwiftDate.git"", from: ""5.0.0""),
    ],
    targets: [
        .target(name: ""App"", dependencies: [""Vapor"", ""SwiftDate""]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App""]),
    ]
)
</code></pre>

<p>However, when I try to build my project I get 82 issues in Xcode (all from the SwiftCalendar module). For example this:</p>

<p><a href=""https://i.stack.imgur.com/t6Sk1.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/t6Sk1.png"" alt=""Example Error""></a></p>

<p>I have no idea how I can possible have caused errors in a third party library. Any input is highly appreciated.</p>

<p>Thanks</p>

<p>More errors can be seen here:</p>

<p><a href=""https://i.stack.imgur.com/Qkg70.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Qkg70.png"" alt=""enter image description here""></a></p>

<p>PS: Sorry for including screenshots, I know they might be hard to read, but I could not find a way to copy the error list as text.</p>
","1143315","","123632","","2018-07-19 19:39:23","2018-07-19 19:39:23","Cannot add SwiftCalendar as a dependency in vapor3 project via package manager","<swift><xcode><vapor><swift-package-manager><swiftdate>","1","0","","","","51292840","118712","118712","vapor","592","36204589","36204588"
"51330424","1","51338054","","2018-07-13 17:48:59","","1","61","<p>Can somebody tell me what I need to use to make user data private that only authenticated user can see their own data. What should I implement to my code ? </p>

<p>I have already basic authentication and I have authorized users but the problem is that all data is available to all authenticated users who have logged in. I'm using PostgreSQL and Vapor 3 and a newbie with backend. </p>

<p>Thanks! </p>
","9491568","","","","","2018-07-29 08:32:42","How to make user data private so only user who owns/created data can see it?","<backend><basic-authentication><vapor>","1","2","","","","51330424","118712","118712","vapor","592","36204589","36204588"
"51340256","1","","","2018-07-14 14:07:49","","1","331","<p>I have tried using the install instructions from <a href=""https://docs.vapor.codes/3.0/install/macos/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/install/macos/</a>. But this doesn't seem to work properly.</p>

<p>It works on my PC though. Just not on my raspberry pi</p>
","5458240","","","","","2018-07-14 14:07:49","How to build Vapor3 on raspberry pi with docker?","<swift><docker><vapor>","0","6","1","","","51340256","118712","118712","vapor","592","36204589","36204588"
"51434745","1","51474954","","2018-07-20 03:42:05","","1","657","<p>I want to create login and logout methods and routes. I've done already basic authentication but now I'm stuck how to continue. How should I do that, should I use sessions? </p>

<p>I'm using Vapor 3, Swift 4 and PostgreSQL and followed this tutorial <a href=""https://medium.com/rocket-fuel/basic-authentication-with-vapor-3-c074376256c3"" rel=""nofollow noreferrer"">https://medium.com/rocket-fuel/basic-authentication-with-vapor-3-c074376256c3</a>. I'm total newbie so I appreciate a lot if you can help me! </p>

<p>my User model</p>

<pre><code>struct User : Content, PostgreSQLModel, Parameters {

var id : Int?
private(set) var email: String
private(set) var password: String

}

extension User: BasicAuthenticatable {

static let usernameKey: WritableKeyPath&lt;User, String&gt; = \.email
static let passwordKey: WritableKeyPath&lt;User, String&gt; = \.password

}
</code></pre>

<p>UserController.swift, registering user. </p>

<pre><code>private extension UserController {

func registerUser(_ request: Request, newUser: User) throws -&gt; Future&lt;HTTPResponseStatus&gt; {

    return try User.query(on: request).filter(\.email == newUser.email).first().flatMap { existingUser in

    guard existingUser == nil else {
            throw Abort(.badRequest, reason: ""a user with this email already exists"" , identifier: nil)
        }

        let digest = try request.make(BCryptDigest.self)
        let hashedPassword = try digest.hash(newUser.password)
        let persistedUser = User(id: nil, email: newUser.email, password: hashedPassword)

    return persistedUser.save(on: request).transform(to: .created)
  }
 }
}
</code></pre>
","9491568","","","","","2018-07-23 08:54:45","How to Create login and logout using Vapor (Basic Authentication)","<login><backend><basic-authentication><logout><vapor>","1","0","","","","51434745","118712","118712","vapor","592","36204589","36204588"
"51436396","1","51475044","","2018-07-20 06:33:17","","0","145","<p>How would I catch all 404 errors and redirect to /app/index.html (I'm trying to satisfy Angular's need to forward all not found resources to index.html) ? I thought implementing my own middleware would work, but not sure I'm doing it right</p>

<pre><code>public final class ForwardToAngularMiddleware: Middleware {
    public func respond(to req: Request, chainingTo next: Responder) throws -&gt; EventLoopFuture&lt;Response&gt; {
        do {
            let response: Future&lt;Response&gt; = try next.respond(to: req)
            return response
        } catch let error as AbortError {
            if error.status == .notFound &amp;&amp; req.http.url.path.starts(with: ""/app"") {
                return Future.map(on: req) { req.redirect(to: ""/index.html"") }
            }
            throw error
        }
    }
}
</code></pre>

<p>My program never hits the catch block no matter what URL I send. I am configuring my middleware like this:</p>

<pre><code>middlewares.use(FileMiddleware.self)
middlewares.use(ForwardToAngularMiddleware())
middlewares.use(ErrorMiddleware.self)
middlewares.use(SessionsMiddleware.self)
services.register(middlewares)
</code></pre>
","202431","","2463616","","2018-07-20 06:34:44","2018-07-23 09:00:01","How to redirect all 404 errors","<swift><vapor>","1","0","","","","51436396","118712","118712","vapor","592","36204589","36204588"
"51446483","1","51700805","","2018-07-20 16:06:08","","8","778","<p>Just started with Vapor 3 along with a MySQL database and I am having hard time figuring out the Relations part.</p>

<p>I have created 2 models so far: <code>Movie</code> and <code>Actor</code>.
A <code>Movie</code> can have many <code>Actor</code>s and an <code>Actor</code> can have many <code>Movie</code>s.</p>

<p><code>Movie</code> Model:</p>

<pre><code>import Vapor
import FluentMySQL

final class Movie: Codable {

    var id: Int?
    var name: String
    var synopsis: String
    var dateReleased: Date
    var totalGrossed: Float

    init(id: Int? = nil, name: String, synopsis: String, dateReleased: Date, totalGrossed: Float) {
        self.id = id
        self.name = name
        self.synopsis = synopsis
        self.dateReleased = dateReleased
        self.totalGrossed = totalGrossed
    }

}

extension Movie {
    var actors: Siblings&lt;Movie, Actor, MovieActor&gt; {
        return siblings()
    }
}

extension Movie: Content {}
extension Movie: Parameter {}
extension Movie: MySQLModel {}

extension Movie: MySQLMigration {
    static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
        return MySQLDatabase.create(self, on: conn) { builder in
            builder.field(for: \.id, isIdentifier: true)
            builder.field(for: \.name)
            builder.field(for: \.synopsis)
            builder.field(for: \.dateReleased, type: .date)
            builder.field(for: \.totalGrossed, type: .float)
        }
    }
}
</code></pre>

<p><code>Actor</code> Model:</p>

<pre><code>import Vapor
import FluentMySQL

final class Actor: Codable {

    var id: Int?
    var firstName: String
    var lastName: String
    var fullName: String {
        return firstName + "" "" + lastName
    }
    var dateOfBirth: Date
    var story: String

    init(id: Int? = nil, firstName: String, lastName: String, dateOfBirth: Date, story: String) {
        self.id = id
        self.firstName = firstName
        self.lastName = lastName
        self.dateOfBirth = dateOfBirth
        self.story = story
    }

}

extension Actor {
    var actors: Siblings&lt;Actor, Movie, MovieActor&gt; {
        return siblings()
    }
}

extension Actor: Content {}
extension Actor: Parameter {}
extension Actor: MySQLModel {}

extension Actor: MySQLMigration {
    static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
        return MySQLDatabase.create(self, on: conn) { builder in
            builder.field(for: \.id, isIdentifier: true)
            builder.field(for: \.firstName)
            builder.field(for: \.lastName)
            builder.field(for: \.dateOfBirth, type: .date)
            builder.field(for: \.story, type: .text)
        }
    }
}
</code></pre>

<p>And I have also created a <code>MovieActor</code> model as a <code>MySQLPivot</code> for the relationship:</p>

<pre><code>import Vapor
import FluentMySQL

final class MovieActor: MySQLPivot {

    typealias Left = Movie
    typealias Right = Actor

    static var leftIDKey: LeftIDKey = \.movieID
    static var rightIDKey: RightIDKey = \.actorID

    var id: Int?

    var movieID: Int
    var actorID: Int

    init(movieID: Int, actorID: Int) {
        self.movieID = movieID
        self.actorID = actorID
    }

}

extension MovieActor: MySQLMigration {}
</code></pre>

<p>And have added them to the migration section in the configure.swift file:</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Movie.self, database: .mysql)
migrations.add(model: Actor.self, database: .mysql)
migrations.add(model: MovieActor.self, database: .mysql)
services.register(migrations)
</code></pre>

<p>All the tables in the database are being created just fine, but I am not receiving the relationship when calling the <code>get all movies</code> service. I am just receiving the <code>Movie</code>'s properties:</p>

<pre><code>final class MoviesController {

    func all(request: Request) throws -&gt; Future&lt;[Movie]&gt; {

        return Movie.query(on: request).all()
    }

}

[
    {
        ""id"": 1,
        ""dateReleased"": ""2017-11-20T00:00:00Z"",
        ""totalGrossed"": 0,
        ""name"": ""Star Wars: The Last Jedi"",
        ""synopsis"": ""Someone with a lightsaber kills another person with a lightsaber""
    },
    {
        ""id"": 3,
        ""dateReleased"": ""1970-07-20T00:00:00Z"",
        ""totalGrossed"": 0,
        ""name"": ""Star Wars: A New Hope"",
        ""synopsis"": ""Someone new has been discovered by the force and he will kill the dark side with his awesome lightsaber and talking skills.""
    },
    {
        ""id"": 4,
        ""dateReleased"": ""2005-12-20T00:00:00Z"",
        ""totalGrossed"": 100000000,
        ""name"": ""Star Wars: Revenge of the Sith"",
        ""synopsis"": ""Anakin Skywalker being sliced by Obi-Wan Kenobi in an epic dual of fates""
    }
]
</code></pre>

<p>Your help would be appreciated! Thank you very much :)</p>
","1478520","","1478520","","2018-07-20 16:39:47","2020-04-15 13:02:29","Vapor 3, Fluent 3 and Many-to-Many relations not working as expected","<swift><vapor>","2","0","2","","","51446483","118712","118712","vapor","592","36204589","36204588"
"51452103","1","","","2018-07-21 01:39:14","","0","451","<p>How can computation flow branch out of a sequence of multiple <code>Future</code> actions, in a single Vapor route, to return a simple <code>String</code> <code>Response</code> which indicates which stage was exited?</p>

<p>Is this possible in Swift 4 based Vapor 3?</p>

<p><code>Future</code> methods <code>catch(_:)</code>, <code>catchMap(on:_:)</code>, and <code>catchFlatMap(_:)</code> can execute if a error is thrown; however, my experiments so far with any catch approach have <em>not</em> been able to branch out the sequence of <code>Future</code> actions. (see <a href=""https://api.vapor.codes/core/latest/Async/Extensions/Future.html"" rel=""nofollow noreferrer"">API</a> &amp; <a href=""https://docs.vapor.codes/3.0/async/overview/"" rel=""nofollow noreferrer"">Docs</a>)</p>

<p><em>Note: Since <a href=""https://github.com/vapor/core/tree/master/Sources/Async"" rel=""nofollow noreferrer"">Vapor 3 Async core</a> is built on top of <a href=""https://github.com/apple/swift-nio"" rel=""nofollow noreferrer"">swift-nio</a>, a SwiftNIO solution would also be of interest.</em></p>

<h2>Example</h2>

<p>For example, consider a <code>Future</code> sequence which will <code>create</code> a db entry, <code>update</code> the same db entry, <code>query</code> (read) the db entry, and then return some <code>String</code> response. </p>

<p><strong>Structure for Posting</strong></p>



<pre><code>{
  ""number"": 0
}
</code></pre>



<pre><code>public struct ExamplePipe: Codable {
  public var id: UUID?
  public var number: Int

  init(number: Int) {
    self.number = number
  }

  public func description() -&gt; String {
    return """"""
    UUID: \(id?.uuidString ?? ""nil.....-....-....-....-............"") 
    {number:\(number)}
    """"""
  }
}

// Database model for fetching and saving data via Fluent. 
extension ExamplePipe: SQLiteUUIDModel {}
// Content convertable to/from HTTP message.
extension ExamplePipe: Content {}
// Database migration
extension ExamplePipe: Migration {}
// Dynamic HTTP routing parameter: `id`
extension ExamplePipe: Parameter {}

struct ExamplePipeController: RouteCollection {
  func boot(router: Router) throws {
    let pipelineRoutes = router.grouped(""api"", ""pipeline"")

    // POST http://localhost:8080/api/pipeline/linear
    pipelineRoutes.post(ExamplePipe.self, at: ""linear"", use: linearPost)

    // POST http://localhost:8080/api/pipeline/nested
    pipelineRoutes.post(ExamplePipe.self, at: ""nested"", use: nestedPost)
  }
  // …
}
</code></pre>

<p><strong>Scenario: <code>map</code> Linear Sequence</strong></p>



<pre><code>// POST http://localhost:8080/api/example/pipeline/basic
func linearPost(_ request: Request, _ pipelineData: ExamplePipe)
               throws -&gt; Future&lt;String&gt; { 
  var s = ""##### Linear Pipeline Data #####\n""

  let mutableA = pipelineData
  s += ""## STAGE_A \(mutableA.description())\n""
  let futureA: Future&lt;ExamplePipe&gt; = mutableA.create(on: request)

  let futureB: Future&lt;ExamplePipe&gt; = futureA.flatMap(to: ExamplePipe.self) { 
    (nonmutableB: ExamplePipe) -&gt; Future&lt;ExamplePipe&gt; in
    var mutableB = nonmutableB
    mutableB.number += 1
    if mutableB.number == 2 {
      print(""POSSIBLE TO EXIT SEQUENCE AT STAGE B??"")
    }
    s += ""## STAGE_B \(mutableB.description())\n""
    let futureB: Future&lt;ExamplePipe&gt; = mutableB.update(on: request)
    return futureB
    }

  let futureC: Future&lt;ExamplePipe?&gt; = futureB.flatMap { 
    (nonmutableC: ExamplePipe) -&gt; Future&lt;ExamplePipe?&gt; in
    s += ""## STAGE_C \(nonmutableC.description())\n""
    if nonmutableC.id == nil {
      print(""POSSIBLE TO EXIT SEQUENCE AT STAGE C??"")
    }
    let uuid = nonmutableC.id!
    let futureC: Future&lt;ExamplePipe?&gt; = ExamplePipe
      .query(on: request)
      .filter(\ExamplePipe.id==uuid)
      .first()
    return futureC      
  }

  let futureD: Future&lt;String&gt; = futureC.map(to: String.self) { 
    (nonmutableD: ExamplePipe?) -&gt; String in
    guard var mutableD = nonmutableD else {
      s += ""## STAGE_D ExamplePipe is NIL\n""
      s += ""#################################\n""
      print(s)
      return s
    }
    mutableD.number += 1
    s += ""## STAGE_D \(mutableD.description())\n""
    s += ""#################################\n""
    print(s)
    return s
  }

  return futureD
}
</code></pre>

<p><strong>Scenario: <code>map</code> Nested Sequence</strong></p>



<pre><code>// POST http://localhost:8080/api/example/pipeline/nested
func nestedPost(_ request: Request, _ pipelineData: ExamplePipe)
                throws -&gt; Future&lt;String&gt; { 
  var s = ""##### Nested Pipeline Data #####\n""

  let mutableA = pipelineData
  s += ""## STAGE:A \(mutableA.description())\n""
  let futureA: Future&lt;ExamplePipe&gt; = mutableA.create(on: request)

  let futureD: Future&lt;String&gt; = futureA.flatMap { 
    (nonmutableB: ExamplePipe) -&gt; Future&lt;String&gt; in
    var mutableB = nonmutableB
    mutableB.number += 1
    if mutableB.number == 2 {
      print(""POSSIBLE TO EXIT SEQUENCE AT STAGE B??"")
    }
    s += ""## STAGE:B \(mutableB.description())\n""
    let futureB: Future&lt;ExamplePipe&gt; = mutableB.update(on: request)

    let futureDD: Future&lt;String&gt; = futureB.flatMap { 
      (nonmutableC: ExamplePipe) -&gt; Future&lt;String&gt; in
      s += ""## STAGE:C \(nonmutableC.description())\n""
      if nonmutableC.id == nil {
        print(""POSSIBLE TO EXIT SEQUENCE AT STAGE C??"")
      }
      let uuid = nonmutableC.id!
      let futureC: Future&lt;ExamplePipe?&gt; = ExamplePipe
        .query(on: request)
        .filter(\ExamplePipe.id==uuid)
        .first()

      let futureDDD: Future&lt;String&gt; = futureC.map(to: String.self) { 
        (nonmutableD: ExamplePipe?) -&gt; String in
        guard var mutableD = nonmutableD else {
          s += ""## STAGE:D ExamplePipe is `nil`\n""
          s += ""#################################\n""
          print(s)
          return s
        }
        mutableD.number += 1
        s += ""## STAGE:D \(mutableD.description())\n""
        s += ""#################################\n""
        print(s)
        return s
      }
      return futureDDD
    }
    return futureDD
  }
  return futureD
}
</code></pre>
","3103448","","3103448","","2018-07-25 05:06:11","2018-07-26 19:33:20","How to branch out of a 'Future' sequence in a single Vapor route?","<swift><swift4><vapor><swift-nio>","1","0","","","","51452103","118712","118712","vapor","592","36204589","36204588"
"51476048","1","51608653","","2018-07-23 09:56:26","","11","1317","<p>I'm following this guys <a href=""https://medium.com/@martinlasek/tutorial-how-to-implement-image-upload-f8ef5a2af869"" rel=""noreferrer"">Martin Lasek</a> Tutorials and now i'm at ""image upload"". 
It seems that no one has the answer to the question ""How do you upload images i Vapor 3"" </p>

<p>Db connection is ok, all the other values are saved.</p>

<p>This is mye create method:</p>

<pre><code>    func create(_ req: Request) throws -&gt; Future&lt;Response&gt; {

    return try req.content.decode(Question.self).flatMap { question in
        return question.save(on: req).map { _ in

            return req.redirect(to: ""/form"")
        }
    }
}
</code></pre>

<p>and Model:</p>

<pre><code>final class Question: PostgreSQLModel {

var id: Int?
var questionText: String
var answers: [String]
var theme: String?
var imageName: String?
var imageData: File?

init(id: Int? = nil, questionText: String, answers: [String], theme: String, imageName: String?, imageData: File?) {

    self.id = id
    self.questionText = questionText
    self.answers = answers
    self.theme = theme
    self.imageName = imageName
    self.imageData = imageData
}
</code></pre>

<p>}</p>

<p>and Leaf template:</p>

<pre><code>&lt;form action=""/save"" method=""POST"" enctype=""multipart/form-data"" id=""upload-form""&gt;
&lt;input type=""file"" accept=""image/png,image/jpg"" name=""image""&gt;
&lt;input class=""btn btn-success btn-block"" type=""submit"" value=""Legg til""&gt;
&lt;/form&gt;
</code></pre>

<p>I know a method for managing files is needed and the raw image bytes to,</p>

<p>But how do i get there?</p>
","9484859","","1000551","","2018-08-03 09:43:03","2018-08-03 09:43:03","Image Upload in Vapor 3 using PostgreSQL","<swift><multipartform-data><vapor><leaf>","3","0","2","","","51476048","118712","118712","vapor","592","36204589","36204588"
"51484138","1","51578475","","2018-07-23 17:16:22","","1","180","<p>I'm trying to obtain data from a mysql database joining two of my tables (usuarios and colegios) with the function alsodecode(). </p>

<p>My code looks like this: </p>

<pre><code>func usuariosHandler(_ req: Request) throws -&gt; Future&lt;View&gt; {
        return Usuario.query(on: req).join(\Colegio.id, to: \Usuario.colegioId).alsoDecode(Colegio.self).all().flatMap(to: View.self) { usuarios in
            let contexto = UsuariosContext(title: ""Usuarios de la aplicación"", usuarios: usuarios)
            return try req.view().render(""usuarios"", contexto)
        }
    }
</code></pre>

<p>The problem is that the result of the query is a tuple that I have to send to a view through leaf. In addition, this is the error into the compiler: Cannot convert value of type '[(Usuario, Colegio)]' to expected argument type '[Usuario]'</p>

<p>I'm a beginner of Swift and Vapor. Can anybody help me with this? </p>

<p>Thanks!</p>
","2239414","","","","","2018-07-29 08:12:55","vapor - Obtaining data from mysql using alsodecode()","<fluent><vapor>","1","0","","","","51484138","118712","118712","vapor","592","36204589","36204588"
"51527686","1","51533336","","2018-07-25 21:09:07","","0","71","<p>I want to display the result of a <code>join</code> query (which debug shows is working) in a leaf template:</p>

<pre><code>persons.get(""/persons"")
{ request -&gt;Future&lt;View&gt; in
    return Title.query(on:request).join(\Person.titleId, to:\Title.id)
                .alsoDecode(Person.self).all().flatMap(to: View.self)  { pers in
        let context = APContext(title: ""Demo"", personnel: pers)
        let leaf = try request.make(LeafRenderer.self)
        return leaf.render(""persons"", context)
    }
}
</code></pre>

<p>I haven't been able to find a way of passing the context directly as an array (like in Vapor 2). So, I am trying to use the codable structure:</p>

<pre><code>struct APContext: Encodable {
    let title: String
    let personnel: [(Title,Person)]
}
</code></pre>

<p>The <a href=""https://docs.vapor.codes/3.0/leaf/basics/"" rel=""nofollow noreferrer"" title=""here"">documentation</a> is out-of-date as it suggests creating the <code>personnel</code> property as <code>EncodableStream</code> will work, but this has been removed. If the <code>struct</code> above is used it gives a compilation error:</p>

<blockquote>
  <p>Type 'APContext' does not conform to protocol 'Encodable'</p>
</blockquote>

<p>If I simplify the query so the the definition becomes:</p>

<pre><code>let personnel = [Person]
</code></pre>

<p>Then it works.</p>

<p>So, I suppose my question boils down to: how do I make <code>[(Title,Person)]</code> encodable?</p>
","2070111","","1000551","","2018-08-03 09:39:36","2018-08-03 09:39:36","Cannot find a way to make a joined query result encodable in Vapor 3","<swift><vapor>","1","2","","","","51527686","118712","118712","vapor","592","36204589","36204588"
"51561620","1","51574690","","2018-07-27 16:00:47","","2","317","<h1>Routing problem</h1>

<p>I’m using the latest version of Vapor and trying to learn it. </p>

<p>I’m trying to create a route in a controller. I have registered the controller in the routes.swift file. I now need to correctly register the routes in the controller file.</p>

<p>I have  extended the class using RouteCollection and am writing a route for a post request. I intend to pass a JSON object and have a class which is extended from Content to make it easier to create the object from JSON data.</p>

<p>The post request then submits data to a FoundationDB database. I have it reading and writing when I hard code it but now need to use requests to send data.</p>

<p>This is what I have. </p>

<pre><code>func boot(router: Router) throws {
        router.post(  ) { // need to send JSON data in the request to the createCountry function


    }

func createCountry( ) { // I need to put the JSON data into a class called Country which has three string fields; country_name, Timezone and default_location. This will then be written to the foundationDB


    }
</code></pre>

<p>How should the <strong>router.post()</strong> be formatted and how should the <strong>createCountry( )</strong> function stub be formatted? I have been typing in req: Request and various -> to no avail. I’m obviously doing something wrong at a fundamental level.</p>
","1845395","","1000551","","2018-08-03 09:39:27","2018-08-03 09:39:27","Vapor 3 Routing","<swift><vapor>","1","0","","","","51561620","118712","118712","vapor","592","36204589","36204588"
"51575230","1","","","2018-07-28 21:01:26","","1","127","<p>I am trying to make an ephemeral service that reinitializes on each request.</p>

<p>I think this is the write way of doing so</p>

<pre><code>// Services File
struct StackOverflowUrlService: Service {
  let baseUrlString = ""https://api.stackexchange.com/2.2/questions?order=desc&amp;site=stackoverflow&amp;sort=activity""

  func requestForQuestions(for tag: String, timeAgo: TimeInterval) -&gt; URLRepresentable {
    return baseUrlString + ""&amp;tagged=\(tag)"" + ""fromdate=\(timeAgo)""
  }
}

extension StackOverflowUrlService: ServiceType {
  static func makeService(for worker: Container) throws -&gt; StackOverflowUrlService {
    return .init()
  }
}

//Configure File
services.register(StackOverflowUrlService.self)
</code></pre>

<p>is there a better way?</p>
","10149530","","","","","2018-07-28 21:01:26","In vapor what is the proper way to create an ephemeral service?","<vapor>","0","0","","","","51575230","118712","118712","vapor","592","36204589","36204588"
"51576981","1","51578198","","2018-07-29 03:35:11","","1","631","<p>I'm attempting to use Vapor3 to perform <em>raw</em> SQL queries. The supplied documentation for this kind of thing is pretty vague on the website unfortunately. </p>

<p>Essentially I want to do something like:</p>

<pre><code>router.get(""example"") { req -&gt; Future&lt;View&gt; in
    let leaf = try request.make(LeafRenderer.self)

    // I can't get this next bit to work. Does anyone have any ideas how to do this? I seem to get all sorts of Xcode errors with .mysql, closures etc.
    let users = try request.withNewConnection(to: .mysql) { connection -&gt; EventLoopFuture&lt;[User]&gt; 
       return try connection.raw(""select * from users"").all(decoding: User.self)
    }

    var context = [String: String]()
    context[""user""] = users

    return leaf.render(""example"", context)
}
</code></pre>

<p>Any help on want I'm doing wrong here would be greatly appreciated.</p>

<p>Thanks in advance,
Matt</p>
","84431","","","","","2018-07-29 07:39:41","Swift Vapor3 Raw SQL query with new connection","<mysql><sql><swift><fluent><vapor>","1","0","","","","51576981","118712","118712","vapor","592","36204589","36204588"
"51609382","1","51610065","","2018-07-31 08:57:28","","3","674","<p>I am writing a Vapor 3 project that writes to a FoundationDB database in key:value pairs. I have the following code the uses a struct called Country which extends Content. I want to save the Country data as a JSON String which then will be converted to Bytes to be saved. </p>

<pre><code>func createCountry(req: Request, country: Country) throws -&gt; Future&lt;Country&gt;{

    return try req.content.decode(Country.self).map(to: Country.self) { country in

        let dbConnection = FDBConnector()
        let CountryKey = Tuple(""iVendor"", ""Country"", country.country_name).pack()
        let countryValue = COUNTRY_TO_JSON_TO_STRING_FUNCTION
        let success = dbConnection.writeRecord(pathKey: CountryKey, value: countryValue )

        if success {

            return country
       } //else {

            return country
        }
    }
}
</code></pre>

<p>How can I convert the struct to a JSON stored as a string?</p>
","1845395","","1000551","","2018-08-03 09:39:16","2018-08-03 09:39:16","Vapor 3 Content to JSON to String","<json><swift><vapor>","1","0","","","","51609382","118712","118712","vapor","592","36204589","36204588"
"51609899","1","","","2018-07-31 09:23:30","","2","576","<p>I have been trying for days to add the fluent-mysql dependancy to my vapor project in order to query my separate mysql database from within the project. However I always seem to get some sort of error e.g. when I try <code>vapor update</code> it never completes. (I have left it for hours in the past), I also tried <code>swift package update</code> but that had the same error. I am now at the point where <code>vapor update</code> works however I am still getting two errors 
        <code>'mysql/udf_registration_types.h' file not found with &lt;angled&gt; include; use ""quotes"" instead</code></p>

<p>and 
        <code>Could not build Objective-C module 'CMySQL'</code></p>

<p>the only thing I have changed from the vapor web template is <code>package.swift</code> which is now this:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""iPadLocator"",
    products: [
        .library(name: ""App"", targets: [""App""]),
        .executable(name: ""Run"", targets: [""Run""])
    ],
    dependencies: [
        .package(url: ""https://github.com/vapor/vapor.git"", .upToNextMajor(from: ""2.2.0"")),
        .package(url: ""https://github.com/vapor/leaf-provider.git"", .upToNextMajor(from: ""1.1.0"")),
        .package(url: ""https://github.com/vapor/fluent-mysql.git"", .upToNextMajor(from: ""2.0.0""))

    ],
    targets: [
        .target(
            name: ""App"",
            dependencies: [""Vapor"", ""LeafProvider"", ""MySQLDriver""],
            exclude: [""Config"", ""Database"", ""Public"", ""Resources""]
        ),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App"", ""Testing""])
    ]
)
</code></pre>

<p>Thanks in advance for any help in advance. This is my first stackOverflow question so sorry if it is awful. I am running <code>vapor Toolbox 3.1.7</code> and <code>Vapor framework 2.4.4</code>, I have both <code>mysql</code> and <code>cmysql</code> installed and up to date.</p>
","9735059","","9735059","","2018-07-31 09:29:54","2018-07-31 12:57:09","Using FluentMySQL with vapor 3","<mysql><swift><vapor>","2","0","","","","51609899","118712","118712","vapor","592","36204589","36204588"
"51625050","1","51628920","","2018-08-01 03:42:24","","5","626","<p>This might be a can of worms, I'll do my best to describe the issue. We have a long running data processing job. Our database of actions is added to nightly and the outstanding actions are processed. It takes about 15 minutes to process nightly actions. In Vapor 2 we utilised a lot of raw queries to create a PostgreSQL cursor and loop through it until it was empty.</p>

<p>For the time being, we run the processing via a command line parameter. In future we wish to have it run as part of the main server so that progress can be checked while processing is being performed.</p>

<pre><code>func run(using context: CommandContext) throws -&gt; Future&lt;Void&gt; {
    let table = ""\""RecRegAction\""""
    let cursorName = ""\""action_cursor\""""
    let chunkSize = 10_000


    return context.container.withNewConnection(to: .psql) { connection in
        return PostgreSQLDatabase.transactionExecute({ connection -&gt; Future&lt;Int&gt; in

            return connection.simpleQuery(""DECLARE \(cursorName) CURSOR FOR SELECT * FROM \(table)"").map { result in
                var totalResults = 0
                var finished : Bool = false

                while !finished {
                    let results = try connection.raw(""FETCH \(chunkSize) FROM \(cursorName)"").all(decoding: RecRegAction.self).wait()
                    if results.count &gt; 0 {
                        totalResults += results.count
                        print(totalResults)
                        // Obviously we do our processing here
                    }
                    else {
                        finished = true
                    }
                }

                return totalResults
            }
        }, on: connection)
    }.transform(to: ())
}
</code></pre>

<p>Now this doesn't work because I'm calling <strong>wait()</strong> and I get the error <strong>""Precondition failed: wait() must not be called when on the EventLoop""</strong> which is fair enough. One of the issues I face is that I have no idea how you even get off the main event loop to run things like this on a background thread. I am aware of BlockingIOThreadPool, but that still seems to operate on the same EventLoop and still causes the error. While I'm able to theorise more and more complicated ways to achieve this, I'm hoping I'm missing an elegant solution which perhaps somebody with better knowledge of SwiftNIO and Fluent could help out with.</p>

<p>Edit: To be clear, the goal of this is obviously not to total up the number of actions in the database. The goal is to use the cursor to process every action synchronously. As I read the results in, I detect changes in the actions and then throw batches of them out to processing threads. When all the threads are busy, I don't start reading from the cursor again until they complete. </p>

<p>There are a LOT of these actions, up to 45 million in a single run. Aggregating promises and recursion didn't seem to be a great idea and when I tried it, just for the sake of it, the server hung.</p>

<p>This is a processing intensive task that can run for days on a single thread, so I'm not concerned about creating new threads. The issue is that I cannot work out how I can use the wait() function inside a <strong>Command</strong> as I need a container to create the database connection and the only one I have access to is <strong>context.container</strong> Calling wait() on this leads to the above error. </p>

<p>TIA</p>
","600871","","600871","","2018-08-01 10:39:12","2018-08-03 08:58:38","Creating and consuming a cursor with Vapor 3","<swift><vapor><swift-nio>","1","2","1","","","51625050","118712","118712","vapor","592","36204589","36204588"
"51669564","1","51672416","","2018-08-03 09:32:15","","4","1495","<p>I'm using Vapor 3 and linking to a FoundationDB database, so Im not using Fluent. I have a method that searches for a record, but it will obviously crash if it does not return a record (because I force unwrap the value).</p>

<p>I want to guard the reading from the database and return a response if no record is found. This will however not be the record as was expected in the Future. I was thinking that I should return a different response, but am unsure how to change the result that is expected.</p>

<pre><code>//creates a specific country
func getCountry( req: Request) throws -&gt; Future&lt;Country&gt; {
    // get Country name from get parameter string
    let countryString = try req.parameters.next(String.self)


    // get record from Database. This could fail and so needs to be guarded. What response should be returned as the Future requires a Country datatype?

       let record =  FDBConnector().getRecord(path: Subspace(""iVendor"").subspace([""Countries"", countryString]))



    let newCountry = try JSONDecoder().decode(Country.self, from: record!)
    // return Country Struct
    return Future.map(on: req) {return newCountry }

}
</code></pre>
","1845395","","5236226","","2018-08-04 18:17:02","2018-08-04 18:17:02","Vapor 3 - Returning a different Future when a search fails?","<swift><vapor>","1","0","","","","51669564","118712","118712","vapor","592","36204589","36204588"
"51722567","1","","","2018-08-07 08:47:39","","1","252","<p>I would like to implement a server app in Swift, with two listening (server) sockets with different functionality sets exposed. The app itself is a kind of smart proxy - transformer of data between the two sockets, with a little persistence thrown in. I have tried to prototype the app in Vapor, but it seems that multiple server sockets in a single app is somewhat an unexpected use case. <a href=""https://docs.vapor.codes/3.0/getting-started/application/"" rel=""nofollow noreferrer"">Doc suggests</a> that <code>Application</code> container is a singleton, it has a single <code>runningServer</code> property, and it takes a single <code>Services</code> struct where <code>Router</code> is registered - where i would need practically two separate routers. Now i'm having some ideas, involving either multiple Vapor Applications inside ""my application"", or some usage of <code>subContainer</code>s, though i don't know how exactly the service registry sharing works. Or maybe something around Providers which i don't fully understand either. But in any case, it all feels like that i'm fighting against a clean design decision of ""1 app = 1 server"". Anyone prove me wrong?</p>
","886653","","886653","","2018-08-07 09:22:17","2018-08-07 09:22:17","Vapor 3: multiple server sockets in one app","<swift><vapor>","0","2","","","","51722567","118712","118712","vapor","592","36204589","36204588"
"51745305","1","","","2018-08-08 11:14:52","","3","90","<p>I'm making a form for adding questions to a quizapp, using Vapor 3.</p>

<p>What i want to do is:</p>

<ul>
<li>send the question to the ""Question"" table on the Database (Done)</li>
<li>update a second table with ""DB version"" simultaneous/right after</li>
</ul>

<p>The form is presented with Leaf</p>

<pre><code>&lt;form action=""/save"" method=""POST"" class=""form-horizontal"" enctype=""multipart/form-data"" id=""upload-form""&gt;
</code></pre>

<p>And uses Vapor Route to fire a create method </p>

<pre><code>func create(_ req: Request) throws -&gt; Future&lt;Response&gt; {

    return try req.content.decode(ImageUpload.self).flatMap { image in

        if image.image?.filename != """", let img = image.image {

            let uploadDir = try req.sharedContainer.make(DirectoryConfig.self).workDir + ""Public/Uploads/""

            let uploadURL = URL(fileURLWithPath: uploadDir + img.filename)
            try image.image?.data.write(to: uploadURL)

        }

        return try req.content.decode(Question.self).flatMap { question in

            if image.image?.filename != """", let img = image.image{
                question.imageName = img.filename
            }

            question.timestamp = Date()

            return question.save(on: req).map { _ in
                return req.redirect(to: ""/dbVersion"")
            }
        }

    }
</code></pre>

<p>And a Update method </p>

<pre><code>func update(_ req: Request) throws -&gt; Future&lt;Response&gt; {



    return try req.parameters.next(Question.self).flatMap { question in
        return try req.content.decode(questionForm.self).flatMap { questionForm in
            question.questionText = questionForm.questionText
            question.answers[0] = questionForm.alt0
            question.answers[1] = questionForm.alt1
            question.answers[2] = questionForm.alt2
            question.answers[3] = questionForm.alt3
            question.theme = questionForm.theme
            question.subject = questionForm.subject
            question.timestamp = Date()

            return question.save(on: req).map { _ in
                return req.redirect(to: ""/form"")
            }
        }
    }
}
</code></pre>

<p>How can i run update/create db version inside these methods?</p>

<p>Or could i just run these consecutively, on the same action? :</p>

<pre><code>protectedRouter.post(""save"", use: questionController.create)
protectedRouter.post(""save"", use: databaseController.create)
</code></pre>
","9484859","","1041105","","2018-10-30 19:20:48","2018-10-30 19:20:48","Check if application has newest data using Vapor 3","<postgresql><fluent><vapor>","1","3","","","","51745305","118712","118712","vapor","592","36204589","36204588"
"51763211","1","","","2018-08-09 09:17:33","","1","56","<p>I am creating a single page web app, but for development I am writing it in sections. I want Leaf to serve up a base file which then includes the separate sections pulled from the different partial leaf template files.</p>

<p>I can use #get in a base template and #set in the include but I can only get this to work as a one on one link. I've seen there is a to import but I can't seem to get it to work.
This is the code I currently have in my routes.swift</p>

<pre><code>router.get(""/test"") { req -&gt; Future&lt;View&gt; in
    let leaf = try req.make(LeafRenderer.self)
    let context = ""Some data""
    return leaf.render(""test"", context)
} 
</code></pre>

<p>This is the code I have in my base.leaf file.</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

#get(test)

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>And this is the code I have in the test.leaf file.</p>

<pre><code>#set('test'){
&lt;h1&gt; Hello there&lt;/h1&gt;
}
#embed('base')
</code></pre>

<p>I thought I could use multiple #get commands but that does not seem to work as the route has to specify the partial for it to work (I think).</p>

<p>For example, I want to embed 3 child pages into one base template.
In the base template I have the following code inside the  tag.</p>

<pre><code>#get(section1)
#get(section2)
#get(section3)
</code></pre>

<p>And I have three corresponding leaf templates for each section. How to I make sure that all sections get injected?</p>
","1845395","","1041105","","2018-10-30 19:20:36","2018-10-30 19:20:36","Trouble importing partials into a Leaf template","<vapor><leaf>","0","2","","","","51763211","118712","118712","vapor","592","36204589","36204588"
"51771922","1","51774423","","2018-08-09 16:26:16","","1","71","<p>I have a webpage that is sending the following JS Object via Ajax to a Vapor handler. The JS object has a Bool variable, as does the receiving struct in Vapor.</p>

<p>When I stringify the JS Object to create a JSON then it Stringifies the true to ""true"". The Vapor app crashes because it is expecting a bool. The JS object also has am array.</p>

<p>How can I send a JSON that contains non string elements such as Bool or numbers that then can be mapped to a Struct with the same data type?</p>
","1845395","","1041105","","2018-10-30 19:20:25","2018-10-30 19:20:25","Vapor 3 receiving stringified JSON that contains a BOOL","<javascript><json><swift><vapor>","1","1","","","","51771922","118712","118712","vapor","592","36204589","36204588"
"51793724","1","51794625","","2018-08-10 20:32:34","","1","75","<p>I am sending a request to my vapor 1.5 server via Alamofire with body of type [String:Any] where Any type is a dictionary of String:String</p>

<p>When the request is received on the server I convert it to JSON type  </p>

<pre><code> guard let reqJson = request.json else {return}
</code></pre>

<p>How can I loop through this JSON object and convert it to an array of <code>[String:Any]</code>  </p>

<p>The body of the request I send from the client app looks like this: </p>

<pre><code> [""DHSKL3920JFLSKXFgs"": 
   [""title"": “some title”, 
    ""body"": “some body”, 
    ""DHSKL3920JFLSKXFgs"": ""DHSKL3920JFLSKXFgs"", 
    ""unreadMessagesCount"": 3], 

 ""PKF993AVG59gkCM"": 
   [""title"": “some title”, 
    ""body"": “some body”,  
    ""DHSKL39"": ""DHSKL39"", 
     ""unreadMessagesCount"": 3]] 
</code></pre>
","5918849","","","","","2018-08-11 04:47:28","How to loop through a JSON object in Vapor 1.5 and convert it to [String:Any]?","<arrays><swift><vapor>","3","0","","","","51793724","118712","118712","vapor","592","36204589","36204588"
"51796245","1","51796966","","2018-08-11 03:37:28","","4","1171","<p>I'm using Vapor, the server-side Swift 4 framework for creating web servers. I have a migration that I'd like to apply that reads in from a JSON file; however, most if not all Swift tutorials I see on this indicate using <code>Bundle</code>, which to my knowledge, isn't available when developing server-side swift applications, which means attempts like this don't work:</p>

<pre><code>if let path = Bundle.main.url(forResource: ""myFile"", withExtension: ""json"") {
...
</code></pre>

<p>This begs the question, given a relative file path, how can I read in a file using server-side Swift?</p>
","1064923","","","","","2018-08-11 06:06:21","Swift Vapor: How to read a JSON file?","<swift><vapor>","1","3","2","","","51796245","118712","118712","vapor","592","36204589","36204588"
"51873680","1","51875681","","2018-08-16 09:23:18","","2","122","<p>i have one weird problem. I'm running vapor inside docker on a digital ocean machine.
All my requests are working as expected except of PATCH and DELETE requests.</p>

<p>In the following code <code>patch enter</code> will be logged but not <code>parameter decode</code>.
The HTTP request appears to run forever and other requests in parallel are not possible</p>

<pre><code>func patch(_ req: Request) throws -&gt; Future&lt;Manufacturer&gt; {
    let logger = try req.make(Logger.self)
    logger.info(""patch enter"")
    return try req.parameters.next(Manufacturer.self).flatMap { manufacturer in
        logger.info(""parameter decode"")
        return try req.content.decode(Manufacturer.self).flatMap { patchManufacturer in
            logger.info(""content decode"")
            manufacturer.name = patchManufacturer.name
            return manufacturer.save(on: req)
        }
    }
}
</code></pre>

<p>Every other method with <code>req.parameters.next(ModelName.self).flatMap</code> is also not working inside my digital ocean docker machine.</p>

<p>Something like a simple create works:</p>

<pre><code>func create(_ req: Request) throws -&gt; Future&lt;Manufacturer&gt; {
    return try req.content.decode(Manufacturer.self).flatMap { manufacturer in
        return manufacturer.save(on: req)
    }
}
</code></pre>

<p>So i thought there must be something wrong with:</p>

<pre><code>return try req.parameters.next(Manufacturer.self).flatMap { manufacturer in
</code></pre>

<p>The weird part is: when i start the same docker compose configuration on my mac,
everything works as expected - no hung up http request.</p>

<p>I dont know what to do to find the mistake, can somebody help me?
If there is some file which i should provide to solve the problem, please leave a short note and i will update the post.</p>

<p>Thanks!</p>
","5283648","","","","","2018-08-16 11:12:36","Vapor parameter decoding hangs up HTTP request","<swift><http><docker><digital-ocean><vapor>","1","0","1","","","51873680","118712","118712","vapor","592","36204589","36204588"
"51933190","1","","","2018-08-20 14:40:31","","2","118","<p>ERROR: Repository not found.
fatal: Could not read from remote repository.</p>

<p>Please make sure you have the correct access rights
and the repository exists.</p>

<p>Error: deploy failed.</p>

<p><img src=""https://i.stack.imgur.com/pp2LS.png"" alt=""Error Screenshot""></p>
","10250490","","580627","","2018-08-20 14:46:06","2019-01-13 17:15:29","Vapor Deployment -> ERROR: Repository not found","<swift><git><vapor><server-side-swift>","1","1","","","","51933190","118712","118712","vapor","592","36204589","36204588"
"51936855","1","51937528","","2018-08-20 18:49:58","","1","96","<p>I'm trying to add a POST endpoint on my <strong>Vapor 3</strong> server to create a new resource, but I want to have 3 different JSON formats that can create that resource. So I have 3 different <code>Content</code> structs that are each fairly similar.</p>

<pre><code>struct IDJson: Content, DeckConvertible {
    var name: String?
    var format: Int
    var hero: Int
    var cards: [Int]
}

struct NameJson: Content, DeckConvertible  {
    var name: String?
    var format: Int
    var hero: String
    var cards: [String]
}

struct DeckstringJson: Content, DeckConvertible  {
    var name: String?
    var deckstring: String
}
</code></pre>

<p>And I would like to add them all to my router like this </p>

<pre><code>class DeckRouteController: RouteCollection {
    func boot(router: Router) throws {
        router.post(IDJson.self, at: ""user"", ""collection"", use: createDeckHandler)
        router.post(NameJson.self, at: ""user"", ""collection"", use: createDeckHandler)
        router.post(DeckstringJson.self, at: ""user"", ""collection"", use: createDeckHandler)
    }
}
...

private extension DeckRouteController {
    func createDeckHandler(_ request: Request, container: DeckConvertible) throws -&gt; Future&lt;Response&gt; {
        // Create deck
    }
}
</code></pre>

<p>Is this possible? at the moment only the last one gets used but is there a way I can do this with some middleware handler or something? </p>
","4139707","","","","","2018-08-20 19:42:29","Handle different kinds of json on the same route with vapor 3","<swift><rest><vapor>","1","0","","","","51936855","118712","118712","vapor","592","36204589","36204588"
"51937991","1","51972208","","2018-08-20 20:21:11","","3","379","<p>This is what I want to do (using postgresql):</p>

<p>select H.""name"", A.""name""</p>

<p>FROM ""Matches"" M</p>

<p>JOIN ""Teams"" H ON M.""homeTeamID"" = H.id</p>

<p>JOIN ""Teams"" A ON M.""awayTeamID"" = A.id</p>

<pre><code>//This will give me an error

return Matches.query(on: request)
.join(\Teams.id, to: \Matches.homeTeamID)
.alsoDecode(Teams.self)
.join(\Teams.id, to: \Matches.awayTeamID)
.alsoDecode(Teams.self)
</code></pre>

<p>Here is the error:</p>

<p>{</p>

<p>error: true,</p>

<p>reason: ""table name ""Teams"" specified more than once""</p>

<p>}</p>

<p>Any help is appreciated! Thanks!</p>
","9034808","","1041105","","2018-10-30 19:20:15","2019-05-18 09:09:55","How to do two JOIN query from the same table in Vapor 3 using Fluent?","<postgresql><fluent><vapor>","3","0","2","","","51937991","118712","118712","vapor","592","36204589","36204588"
"51954148","1","51955131","","2018-08-21 17:49:01","","10","2075","<p>Basically the title. I want to know how to use url query parameters in <strong>Vapor 3</strong>. I can't seem to find anything in the docs on it. </p>

<p>e.g. <code>/objects?fancy=true</code>, how do I access the <code>fancy</code> parameter.</p>
","4139707","","1041105","","2018-10-30 19:19:57","2018-10-30 19:19:57","How to access query parameters in vapor 3","<swift><rest><query-parameters><vapor>","1","0","","","","51954148","118712","118712","vapor","592","36204589","36204588"
"51975381","1","51982631","","2018-08-22 21:26:53","","3","625","<p>I just want to have a controller action that is basically doing the same as accessing an image directly through the <code>Public/</code> folder. The difference is that the route can be whatever you want and the returned image will be the one that is determined inside of the controller function. But how to create a proper response?</p>

<p>My approach looks like this:</p>

<pre><code>import Vapor

final class ImageController {
    func read(_ req: Request) throws -&gt; Future&lt;Data&gt; {
        let directory = DirectoryConfig.detect()
        let promise = req.eventLoop.newPromise(Data.self)
        req.eventLoop.execute {
            do {
                let data = try Data(contentsOf: URL(fileURLWithPath: directory.workDir)
                    .appendingPathComponent(""Public"", isDirectory: true)
                    .appendingPathComponent(""image.png""))
                promise.succeed(result: data)
            } catch {
                promise.fail(error: error)
            }
        }
        return promise.futureResult
//        try req.content.encode(data, as: .png)
    }
}
</code></pre>

<p>But it seems to me I'm overcomplicating it, do I?</p>
","1120481","","","","","2018-08-23 17:04:55","How to respond with an image using Vapor?","<swift><vapor>","2","0","1","","","51975381","118712","118712","vapor","592","36204589","36204588"
"51976583","1","","","2018-08-22 23:45:43","","1","421","<p>Currently, we are creating a server application (Deploy to VaporCloud) that communicates browser's JavaScript and WebSocket with Vapor 3.0.8 and Swift4.1.
In that case, although we can connect websocket, even if we are not leaving the message as it is, onClose will occur on the JavaScript side in about 30 seconds and the connection will be lost.
How can we maintain a connection?</p>

<p>[Server side source   Sources/App/configure.swift)]</p>

<pre><code>    public func configure(_ config: inout Config, _ env: inout Environment, _ 
services: inout Services) throws {
        let wss = NIOWebSocketServer.default() 
        wss.get(at:[""chat""], use:{ ws,req in
          ws.onText({ (ws, text) in
          .....　   
          ws.send(""test"")
          .....
        })
        .....
        })　  
        services.register(wss, as: WebSocketServer.self)
        .....
</code></pre>

<p>[Javascript side source]</p>

<pre><code>ws = new WebSocket('wss://hostname');
ws.onopen = function() {
    .....
    ws.send(""test connect"");
};
$('form').on('submit', function(e) {
  e.preventDefault();
  ws.send(""test"");
});
ws.onmessage = function(event) {
  console.log(""data="" + event.data);
  .....
}
ws.onclose = function (e) {
  console.log(""Close Code = "" + e.code); // return 1006
  console.log(""Close Reason = "" + e.reason); // null
  .....
}
</code></pre>
","10260342","","1041105","","2018-10-30 19:19:49","2018-10-30 19:19:49","When doing websocket with vapor 3.0.8, the connection immediately becomes timeout","<swift><websocket><vapor>","1","0","","","","51976583","118712","118712","vapor","592","36204589","36204588"
"52087549","1","","","2018-08-30 00:00:07","","0","206","<p>Given a controller method which accepts a request body which conforms to some or all of the properties in an entity in Vapor, is there a means of updating the entity without manually assigning all of it's properties? Currently, I'm having to do this:</p>

<pre><code>func update(_ req: Request) throws -&gt; Future&lt;Mission&gt; {
    let mission = try req.parameters.next(Mission.self)
    let content = try req.content.decode(Mission.self)

    return flatMap(to: Mission.self, mission, content) { (mission, content) in
       mission.propertyA = content.propertyA
       mission.propB = content.propB
       mission.propC = content.propC
       return mission.save(on: req)
    }
}
</code></pre>

<p>This isn't very scalable as it requires me to manually assign each property. What I'm looking for is something like this:</p>

<pre><code>func update(_ req: Request) throws -&gt; Future&lt;Mission&gt; {
    let mission = try req.parameters.next(Mission.self)
    let content = try req.content.decode(Mission.self)

    return mission.save(on: content)
}
</code></pre>

<p>However this yields the error <code>Argument type 'EventLoopFuture&lt;Mission&gt;' does not conform to expected type 'DatabaseConnectable'</code>.</p>

<p>What is a good solution here?</p>
","1064923","","1064923","","2018-08-30 01:23:06","2018-09-02 09:00:19","Concise method of updating a model to match a request body with Swift?","<swift><vapor>","2","0","","","","52087549","118712","118712","vapor","592","36204589","36204588"
"52088355","1","","","2018-08-30 02:17:40","","11","181","<p>I'm following the <a href=""https://docs.vapor.codes/3.0/mysql/getting-started/#config"" rel=""noreferrer""><em>Getting started</em> section for the MySQL package on the Vapor Documentation</a>, which I'm able to follow step by step and, as a result, I have successfully established a connection to the MySQL database, using custom database credentials like this:</p>

<pre><code>/// Register providers first
try services.register(FluentMySQLProvider())

// MySQL database
let mySQLConfig = MySQLDatabaseConfig(hostname: ""localhost"",
                                      port: 3306,
                                      username: ""root"",
                                      password: ""thisismyrootpassword"",
                                      database: ""lol_database"",
                                      capabilities: .default,
                                      characterSet: MySQLCharacterSet.utf8_general_ci,
                                      transport: MySQLTransportConfig.cleartext)

services.register(mySQLConfig)
</code></pre>

<p><a href=""https://api.vapor.codes/mysql/latest/MySQL/Structs/MySQLDatabaseConfig.html"" rel=""noreferrer"">Based on the <code>MySQLDatabaseConfig</code> object's documentation</a> I'm unable to find if it is possible to connect to a MySQL database based on a Unix Socket configuration.</p>

<p>What I'll be able to provide to the application under the production environment it's just the database name, the username, password and the Socket path, which will be in the form <code>/cloudsql/project1:us-central1:instance1</code></p>

<p>For more reference, what I'm trying to do is connect from a Google Cloud App Engine flexible environment to a SQL database based on this tutorial: <a href=""https://cloud.google.com/appengine/docs/flexible/nodejs/using-cloud-sql#setting_up_your_local_environment"" rel=""noreferrer"">https://cloud.google.com/appengine/docs/flexible/nodejs/using-cloud-sql#setting_up_your_local_environment</a> The environment of course will be Vapor still that's the only way for a database client to establish connection to the database server.</p>

<p>Thank you for your help.</p>
","3158329","","","","","2018-09-01 04:19:11","FluentMySQL connection using Unix Socket","<mysql><swift><vapor>","0","1","1","","","52088355","118712","118712","vapor","592","36204589","36204588"
"52124063","1","52142454","","2018-09-01 00:59:52","","0","115","<p>I'm trying to get my feet wet with server side swift, and specifically Swift Vapor by trying the Ray Wenderlich HelloVapor tutorial.</p>

<p>Basically performed the following steps so far using (my swift -version on Apple command prompt is Apple Swift version 4.1.2) </p>

<p>Here are the steps I've followed to setup Vapor and try the sample.</p>

<ol>
<li>On command prompt</li>
</ol>

<p><a href=""https://i.stack.imgur.com/jiXgQ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/jiXgQ.png"" alt=""enter image description here""></a></p>

<ol start=""2"">
<li>Open browser to <a href=""https://brew.sh"" rel=""nofollow noreferrer"">https://brew.sh</a> for instructions to setup homebrew (Copy and paste the following in a command prompt on terminal)</li>
</ol>

<p><a href=""https://i.stack.imgur.com/zuRNK.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zuRNK.png"" alt=""enter image description here""></a></p>

<ol start=""3"">
<li>Then run  the following commands to install vapor and the vapor sample app HelloVapor in folder vaporsample.</li>
</ol>

<p><a href=""https://i.stack.imgur.com/ULt3k.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ULt3k.png"" alt=""enter image description here""></a></p>

<ol start=""4"">
<li>However when I try to build the run target I get the following compile errors:</li>
</ol>

<p><a href=""https://i.stack.imgur.com/yKkgP.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/yKkgP.png"" alt=""enter image description here""></a></p>

<p>It appears it cant find the modules. Or perhaps an incorrect version of swift (I am on Swift version 4.1.2 on my Mac). I'm confused and would like to seek the advise of the erudite crowd here. </p>
","1376844","","1376844","","2018-09-01 01:21:13","2018-09-03 02:15:08","Swift Vapor Sample Not compiling","<swift><compiler-errors><vapor><build-settings><server-side-swift>","1","8","","","","52124063","118712","118712","vapor","592","36204589","36204588"
"52208011","1","52210765","","2018-09-06 15:54:06","","1","440","<p>I'm having trouble dealing with multiple parameters. I'm Ok with passing one, but am unsure about passing in multiple ones. I have this JS code in a webpage:</p>

<pre><code>$.getJSON('api/vendor/countryVendors/'+country+'&amp;'+resourceType,    function(result){} 
</code></pre>

<p>And the following in my Vapor controller:</p>

<pre><code>func getcountryVendors(_ req: Request) throws -&gt; Future&lt;[Vendor]&gt; {
    let countryString = try req.parameters.next(String.self)
    let resourceTypeString = try req.parameters.next(String.self) 
</code></pre>

<p>not sure if the URL I've created is wrong or my Swift code or both</p>
","1845395","","5236226","","2018-09-06 19:15:26","2018-09-06 19:15:26","Vapor with multiple parameters","<javascript><query-parameters><vapor>","1","0","","","","52208011","118712","118712","vapor","592","36204589","36204588"
"52232746","1","52239535","","2018-09-08 06:40:56","","5","1053","<p>I have an API, written in Vapor. I would like to follow the JSON API Spec. </p>

<p>I am struggling with understanding how I can create my response object in the correct format. </p>

<p>For example, I would like my responses to be structured as so...</p>

<pre><code>{
  ""links"": {
    ""self"": ""http://example.com/dish"",
    ""next"": ""http://example.com/dish?page=2"",
    ""last"": ""http://example.com/dish?page=10""
  },
  ""data"": [{
    ""title"": ""Spag Bol"",
    ""course"": ""main"",
    ""description"": ""BasGetti"",
    ""price"": 3.9900000000000002
  },
  {
    ""title"": ""Ice Cream"",
    ""course"": ""desert"",
    ""description"": ""Vanilla"",
    ""price"": 0.98999999999999999
  }]
}
</code></pre>

<p>I can return the contents of data quite simply if <code>POST</code> to this endpoint (pseudo code)</p>

<pre><code>router.post(Dish.self, at: ""api/dish"") { req, data -&gt; Future&lt;Dish&gt; in
    return Future.map(on: req, { () -&gt; Dish in
        data.id = 001
        return data
    })
}
</code></pre>

<p>I tried creating an <code>ApiResponse</code> class and passing in the data so I could structure the response but this did not work with the error <code>Cannot convert return expression of type 'ApiResonse' to return type 'Dish'</code></p>

<pre><code>   router.post(Dish.self, at: ""api/dish"") { req, data -&gt; Future&lt;Dish&gt; in
        return Future.map(on: req, { () -&gt; Dish in
            data.id = 001
            return ApiResonse(links: Links(self: ""http://google.com"", next: ""http://google.com"", last: ""http://google.com""), data: data)
        })
    }
</code></pre>

<p>I am not sure how I can do this. These are the attempted classes</p>

<pre><code>final class Dish: Content {
    var id: Int?
    var title: String
    var description: String
    var course: String
    var price: Double

    init(title: String, description: String, course: String, price: Double) {
        self.title = title
        self.description = description
        self.course = course
        self.price = price
    }
}

struct Links {
    var `self`: String?
    var next: String?
    var last: String?
}

class ApiResonse {
    var links: Links?
    var data: Any

    init(links: Links, data: Any) {
        self.links = links
        self.data = data
    }
}
</code></pre>

<p>Do I need to use Generics to set up the response class? Is anyone able to provide an example?</p>
","7579156","","","","","2018-09-09 16:55:50","Making Vapor API response JSON API Spec compliant","<swift><generics><vapor>","2","0","1","","","52232746","118712","118712","vapor","592","36204589","36204588"
"52292747","1","","","2018-09-12 10:13:12","","0","106","<p>I'm trying to create a webAPI and a Worker process (on Heroku) with Vapor 3, XCode 9.4.1, Swift 4.1 but can't get the solution working that's described in SO ""Multiple targets in Vapor Xcode project"". The webAPI is working fine but how do I create the Worker ?</p>

<p>Thanks for any advice, </p>

<p>Frank</p>
","485083","","","","","2018-09-17 11:27:27","How to create Heroku Worker process with Vapor 3 / Swift 4.1.2","<swift><vapor><xcode9.1>","1","2","","","","52292747","118712","118712","vapor","592","36204589","36204588"
"52336760","1","","","2018-09-14 17:31:11","","2","95","<p>OK, so, I've been struggling with Vapor/Fluent and the more complex returns of data.</p>

<p>I am basically trying to return the following query in fluent-mysql:</p>

<pre class=""lang-sql prettyprint-override""><code>select e.*,
    et.description,
    es.description
from
    e inner join et on e.tid = et.id
    inner join e.sid=es.id
where e.deleted=0
</code></pre>

<p>Fairly standard.  So, the func I am using has this 'query':</p>



<pre class=""lang-swift prettyprint-override""><code>return Equipment.query(on: req)
    .filter(\Equipment.deleted==false)
    .join(\Equipment.typeid, to: \EquipmentTypes.id )
    .join(\Equipment.seriesid, to: \EquipmentSeries.id )
    .alsoDecode(EquipmentTypes.self)
    .alsoDecode(EquipmentSeries.self)
    .all()
</code></pre>

<p>I know that I can't have the function return a basic model a la:</p>

<pre class=""lang-swift prettyprint-override""><code>return Equipment.query(on: req).decode(Equipment.self).all()
</code></pre>

<p>So I need to 'map' or 'flatMap' to a struct, so I defined one (ignore the init for now):</p>

<pre class=""lang-swift prettyprint-override""><code>struct EquipmentArray: Encodable {
     let id: Int
     let description: String
     let seriesid: Int
     let series: String
     let typeid: Int
     let type: String
     let mintime: Int
     let maxtime: Int
     let room_length: Double
     let room_width: Double
     let lamps_bottom: Bool
     let lamps_top: Bool
     let lamps_facial: Bool
     let lamps_shoulder: Bool
     let lamps_neck: Bool
     let deleted: Bool

     init(id: Int){
      self.id = id
     }

}
</code></pre>

<p>and that gives me the function header to use as:</p>

<pre class=""lang-swift prettyprint-override""><code>func getAllHandler(_ req: Request) throws -&gt; Future&lt;[EquipmentArray]&gt;{
</code></pre>

<p>Here is where I am hung up - I can see examples of where to flatMap/map 1 result to a struct, but not an example of mapping a tuple (?) to struct.  Basically mapping <code>[((Equipment, EquipmentType), EquipmentSeries)] -&gt; [EquipmentArray]</code>  </p>

<p>Has anyone got any good examples of how to do this?  </p>
","1336531","","2124535","","2018-09-30 21:27:36","2018-09-30 21:27:36","Mapping fluent result with joins to struct","<dictionary><tuples><fluent><vapor><flatmap>","0","0","","","","52336760","118712","118712","vapor","592","36204589","36204588"
"52369282","1","52407836","","2018-09-17 13:47:56","","4","451","<p>I want to be able to bulk add records to a nosql database in Vapor 3.</p>

<p>This is my Struct.</p>

<pre><code>struct Country: Content {

   let countryName: String
   let timezone: String
   let defaultPickupLocation: String

}
</code></pre>

<p>So I'm trying to pass an array of JSON objects but I'm not sure how to structure the route nor how to access the array to decode each one.</p>

<p>I have tried this route:</p>

<pre><code>    let countryGroup = router.grouped(""api/country"")

    countryGroup.post([Country.self], at:""bulk"", use: bulkAddCountries)
</code></pre>

<p>with this function:</p>

<pre><code> func bulkAddCountries(req: Request, countries:[Country]) throws -&gt;  Future&lt;String&gt; {
    for country in countries{
    return try req.content.decode(Country.self).map(to: String.self) { countries in



        //creates a JSON encoder to encode the JSON data
        let encoder = JSONEncoder()
        let countryData:Data
        do{
            countryData = try encoder.encode(country) // encode the data
        } catch {
            return ""Error. Data in the wrong format.""
        }
        // code to save data
    }
    }
}
</code></pre>

<p>So how do I structure both the Route and the function to get access to each country?</p>
","1845395","","1041105","","2018-10-30 19:19:41","2020-02-01 02:17:12","Insert multiple records into database with Vapor3","<arrays><json><record><vapor>","2","0","","","","52369282","118712","118712","vapor","592","36204589","36204588"
"52504114","1","","","2018-09-25 17:52:37","","2","509","<p>I'm having a play with Swift Vapor and want to build a web API using microservices.</p>

<p>What's the best way for sending messages between microservices built with Vapor and a message queue such as RabbitMQ?</p>
","2471026","","","","","2018-09-26 00:53:17","Vapor Swift Client for a Message Queue / RabbitMQ","<rabbitmq><microservices><message-queue><vapor>","2","2","","","","52504114","118712","118712","vapor","592","36204589","36204588"
"52543502","1","52543503","","2018-09-27 18:58:27","","16","2660","<p>I'm new to backend Swift and thought I'd use Vapor to get up-and-running on a side project fast...
I ran <code>vapor new WebServer --template=auth-template</code>, and now I'm trying to figure out what something like <code>return \.email</code> means.
For more context, I'm looking in WebServer > Sources > App > Models > Users.swift:</p>

<pre class=""lang-swift prettyprint-override""><code>import Authentication
import FluentSQLite
import Vapor

/// Allows users to be verified by basic / password auth middleware.
extension User: PasswordAuthenticatable {
    /// See `PasswordAuthenticatable`.
    static var usernameKey: WritableKeyPath&lt;User, String&gt; {
        return \.email
    }

// ...
}
</code></pre>

<p>And here is the definition of the User class:</p>

<pre class=""lang-swift prettyprint-override""><code>/// A registered user, capable of owning todo items.
final class User: SQLiteModel {
    // {omit extra code} ...

    var email: String

    // {omit extra code} ...

    /// Creates a new `User`.
    init(id: Int? = nil, name: String, email: String, passwordHash: String) {
        // {omit extra code} ...
        self.email = email
        // {omit extra code} ...
    }
}
</code></pre>

<p>What does this backslash-dot notation mean?</p>
","3773048","","","","","2018-09-27 18:58:27","Swift: What does backslash dot ""\."" mean?","<swift><authentication><vapor>","1","0","3","","","52543502","118712","118712","vapor","592","36204589","36204588"
"52549270","1","52565005","","2018-09-28 06:04:36","","2","224","<p>I'm trying to build APIs using Swift and I've chosen to use Vapor. </p>

<p>I've created a SQLite database and am able to connect to it using a DB client. </p>

<p>Now I want my Swift Vapor project to connect to it as well using the FluentSQLite package. </p>

<p>I've created my database in the root folder of my project: </p>

<p><code>/Users/rutgerhuijsmans/Documents/runk-3.0</code></p>

<p>My database is called <code>runk-3.0-database</code></p>

<p>The folder looks like this: </p>

<p><a href=""https://i.stack.imgur.com/GeZYb.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/GeZYb.png"" alt=""enter image description here""></a></p>

<p>I try to connect to my DB using the following configuration:</p>

<pre><code>import FluentSQLite
import Vapor

/// Called before your application initializes.
public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
    /// Register providers first
    try services.register(FluentSQLiteProvider())

    /// Register routes to the router
    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    /// Register middleware
    var middlewares = MiddlewareConfig() // Create _empty_ middleware config
    /// middlewares.use(FileMiddleware.self) // Serves files from `Public/` directory
    middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
    services.register(middlewares)

    let sqlite: SQLiteDatabase?
    do {
        sqlite = try SQLiteDatabase(storage: .file(path: ""runk-3.0-database""))
        print(""data base connected"") // This gets printed

        /// Register the configured SQLite database to the database config.
        var databases = DatabasesConfig()
        databases.add(database: sqlite!, as: .sqlite)
        services.register(databases)

        /// Configure migrations
        var migrations = MigrationConfig()
        migrations.add(model: User.self, database: .sqlite)
        services.register(migrations)
    } catch {
        print(""couldn't connect"") // This doesn't get printed
    }
}
</code></pre>

<p>What am I doing wrong?</p>
","4624236","","1041105","","2018-10-30 19:19:22","2018-10-30 19:19:22","Setting up database connection using Vapor framework","<swift><sqlite><vapor>","2","0","","","","52549270","118712","118712","vapor","592","36204589","36204588"
"52565063","1","52573537","","2018-09-29 04:16:53","","2","151","<p>I'm trying to create a user and access token record in my database. </p>

<p>However I can't figure out how to do this. </p>

<p>My code looks like this: </p>

<pre><code>// Create new user
func create(_ req: Request) throws -&gt; Future&lt;AccessToken&gt; {
    return try req.content.decode(User.self).flatMap { user in
        user.pushToken = """"
        user.create(on: req).map {_ -&gt; EventLoopFuture&lt;AccessToken&gt; in
            let accessToken = AccessToken(accessToken: UUID().uuidString, userID: user.id!)
            return accessToken.create(on: req)
        }
    }
}
</code></pre>

<p>I create a user (this works well) then I want to create an access token tied to that user (through user ID) </p>

<p>Because of this I need to know the user ID of the user that I just created. However this code doesn't seem to compile. </p>

<p>Xcode is giving me: <code>Missing return in a closer expected to return EventLoopFuture&lt;AccessToken&gt;</code></p>
","4624236","","","","","2018-09-30 00:07:53","Creating and returning database records with Vapor","<swift><vapor>","1","0","","","","52565063","118712","118712","vapor","592","36204589","36204588"
"52575564","1","","","2018-09-30 07:16:38","","2","348","<p>I'm trying to write a function using Swift and Vapor but I don't understand why one statement gets printed before the other: </p>

<pre><code>// Logout user
func logout(_ req: Request) throws -&gt; Future&lt;APIResponseMessage&gt; {
    let userID = self.checkAccessToken(req: req)

    // Delete access token here

    let apiResponseMessage = APIResponseMessage()
    apiResponseMessage.message = ""success""
    apiResponseMessage.userID = userID
    return apiResponseMessage.create(on: req)
}

func checkAccessToken(req: Request) -&gt; Int {
    let bearerAuthorization = req.http.headers.bearerAuthorization
    guard let _bearerAuthorization = bearerAuthorization else {
        // Works fine
        print(""no bearer incluced"")
        return 0
    }

    let _ = AccessToken.query(on: req).filter(\.accessToken == _bearerAuthorization.token).first().map(to: Int.self) { queriedAccessToken in
        // This should be first
        print(""This gets printed second"")
        return queriedAccessToken!.userID!
    }

    // This should be second
    print(""This gets printed first"")
    return 0
}
</code></pre>

<p>Can anyone tell me how to make the second print statement wait until the first one is completed?</p>

<p>Right now it's causing my logout function to run with <code>userID == 0</code> when this shouldn't be the case </p>
","4624236","","2124535","","2018-09-30 21:22:00","2018-10-01 11:30:24","Querying and mapping using Vapor","<swift><vapor>","1","3","","","","52575564","118712","118712","vapor","592","36204589","36204588"
"52576061","1","52585359","","2018-09-30 08:20:01","","5","799","<p>How can I update an array of models into <code>mysql</code> using <code>transactions</code>? and return <code>Ok</code> response after successful operation</p>
","2226919","","2226919","","2018-09-30 09:41:04","2018-10-01 06:04:22","request, that save array of models in vapor 3","<fluent><vapor>","1","2","1","","","52576061","118712","118712","vapor","592","36204589","36204588"
"52596175","1","52596176","","2018-10-01 17:37:54","","1","212","<p>I am trying to create a model (<code>MySQLStringModel</code>)  and set an id(of <code>String ?</code> type) to it. There is no errors or any other message in console, and <code>save(on: req)</code> works successfully , but model doesn't appear in Table of the database.  Whats can be wrong?</p>

<pre><code>func create(_ req: Request, person: Person) throws -&gt; Future&lt;Person&gt; {
    return Person(id: person.id, name: person.name).save(on: req)
}
</code></pre>

<p><strong>P.s.</strong>: All works when I use  MySQLModel with  <code>Int?</code> id, and I don't set this id directly (it sets automatic with autoincreament )</p>
","2226919","","","","","2018-10-01 17:37:54","vapor 3, fluent model doesn't create raw in DB","<vapor>","1","0","","","","52596175","118712","118712","vapor","592","36204589","36204588"
"52684010","1","52684625","","2018-10-06 22:51:46","","1","75","<p>In Vapor 3, in a synchronous function this works:</p>

<pre><code>return try Process.execute( ""/usr/local/bin/demo"", [ ""p1"", ""p2"" ] )
</code></pre>

<p>However, if I try to use Futures and closures in a route such as:</p>

<pre><code>router.get(""async"") { request -&gt; Future&lt;String&gt; in
    return Process.asyncExecute( ""/usr/local/bin/demo"", [ ""p1"", ""p2"" ], on:request ).flatMap(to:String) { output in
            switch output {
                case .stdout(let data): return(String(data: data, encoding: .utf8) ?? """")
                case .stderr(let data): return(String(data: data, encoding: .utf8) ?? """")
            }
    }
}
</code></pre>

<p>I get a compiler error <code>Missing argument for parameter #4 in call</code> shown at the end of <code>request</code> in the <code>asyncExecute</code> call in line 2 of the code above. I have tried replacing the <code>flatMap</code> with <code>transform</code> but it doesn't change the error.</p>

<p>I have used similar constructions in the past and can't see why this one isn't working.</p>
","2070111","","1041105","","2018-10-30 19:13:55","2018-10-30 19:13:55","Missing argument for parameter #4 in call ignores closure","<swift><vapor>","1","0","","","","52684010","118712","118712","vapor","592","36204589","36204588"
"52764366","1","","","2018-10-11 15:59:20","","2","63","<pre><code>class Foobar: Model {}
extension Foobar: Migration {}
</code></pre>

<p>When you just create a new model and you also want to create a table in database then these two lines might be enough already.</p>

<p>If you want to provide more properties with primitive types like <code>var id: Int?</code> Vapor know how to handle it.</p>

<p>But what if you have something like this ...</p>

<pre><code>enum FancyType: String, Codable {
    case awesome
    // ...
}
</code></pre>

<p>... and your model is expecting a default value for initialization and table creation?</p>

<pre><code>class Foobar: Model {
    let fancy: FancyType

    init(fancy: FancyType = .awesome) {
        self.fancy = fancy
    }
}
</code></pre>

<p>In my case it just crashes with a fatal error saying:</p>

<blockquote>
  <p>DecodingError: Cannot initialize Foobar from invalid String value 0</p>
</blockquote>

<p>With that I'm curious how to actually configure default values on table creation.</p>
","1120481","","1041105","","2018-10-30 19:13:44","2018-10-30 19:13:44","How to provide default values on model migration / table creation?","<swift><migration><vapor>","0","1","","","","52764366","118712","118712","vapor","592","36204589","36204588"
"52788438","1","52790503","","2018-10-13 00:16:15","","1","125","<p>I'm trying to organize my Leaf views inside the <code>Views</code> directory, but am unable to create nested directories inside <code>Views</code>. I have a header like this</p>

<pre><code>&lt;header&gt;
    &lt;nav&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;a href=""/test""&gt;Test&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/nav&gt;
&lt;/header&gt;
</code></pre>

<p>The <code>/test</code> is actually contained in <code>Views/TestFolder</code>, because I maybe thought it recursively searched inside the <code>Views</code> folder, but which was not the case. If I try accessing the <code>test</code> page I get the following error (which I guess makes perfectly sense):</p>

<pre><code>{
  ""error"": true,
  ""reason"": ""No file was found at path: /Users/eirik/Documents/Utvikling/Jobb/AaseSoftware/Resources/Views/test.leaf""
}
</code></pre>

<p>I also don't know how I should define the route for this in <code>routes.swift</code>. Right now I'm just doing this:</p>

<pre><code>router.get(""/test"") { req -&gt; Future&lt;View&gt; in
    return try req.view().render(""test"")
}
</code></pre>

<p>but I guess it only looks for a <code>test.leaf</code> file directly inside <code>Views</code>. How can I put Leaf files in nested folders inside <code>Views</code>?</p>
","5609988","","","","","2018-10-13 07:17:52","Find nested folders inside /Views in Vapor","<swift><vapor>","1","0","","","","52788438","118712","118712","vapor","592","36204589","36204588"
"52824349","1","52977258","","2018-10-15 20:31:12","","2","93","<p>I am having a problem right now and don't know how to solve it.</p>

<p>I wrote a controller for managing my users. The following code is an excerpt from my registration function, where a key is generated for encrypting user data that is later stored in the database. The key (ekey) is stored in the database, too. So I need to encrypt the key and therefore I use a hash of the users password.</p>

<p>I'm getting this error on the last line:</p>

<pre><code>Error: AES256GCM.encrypt: expression type 'Data' is ambiguous without more context
</code></pre>

<p>I don't know what is wrong with that.</p>

<pre><code>// generate key for encrypting data
let ekey = try URandom().generateData(count: 32).base64EncodedString()

// generate digest for password and encrypt 'ekey'
let key: Data = try SHA256.hash(user.password)
let iv: Data = try URandom().generateData(count: 12)
let (encrKey, tag) = try AES256GCM.encrypt(ekey, key: key, iv: iv)
</code></pre>
","9603073","","5236226","","2018-10-16 20:46:38","2018-10-24 20:12:08","Vapor Crypto: expression type 'Data' is ambiguous without more context","<swift><cryptography><sha256><vapor>","1","3","","","","52824349","118712","118712","vapor","592","36204589","36204588"
"52899225","1","","","2018-10-19 20:05:52","","4","259","<p>I have a project that I am working on that has <code>Posts</code> and <code>Comments</code>. I link a comment to a post using a foreign key (postId). However, this foreign key was not added to my Comment class until after the first time I had built the project with the Comment class.</p>

<p>After adding the <code>postId</code> field to the comment class, I attempted to run the project and create a comment. The project builds and runs fine, but when I attempt to create a comment, I get the error: <code>table Comment has no column named postId</code></p>

<p>Is this some sort of migration issue within Vapor? </p>
","10365158","","","","","2019-02-07 01:39:34","Add Column to Existing Table in Vapor","<swift><sqlite><vapor><server-side-swift>","1","0","1","","","52899225","118712","118712","vapor","592","36204589","36204588"
"52911881","1","52916842","","2018-10-21 03:26:34","","2","563","<p>I've built a simple Vapor 3 API that I'd like to deploy on Heroku. I'd like it to be backed by a PostgreSQL database which is also attached to another Heroku app (I have successfully attached the DB in the Heroku dashboard – and the DB works correctly in the other application). However, my Vapor app never completes starting up, crashing with the following error:</p>

<pre><code>Fatal error: Error raised at top level: ⚠️ PostgreSQL Error: no pg_hba.conf entry for host ""[the IP addr]"", user ""[heroku postgres username here]"", database ""[heroku psql db here]"", SSL off
- id: PostgreSQLError.server.fatal.ClientAuthentication
</code></pre>

<p>I used <code>vapor heroku init</code> to set up the Heroku app. I've Googled around, and tried adding a <code>Procfile</code> and messing with <code>configure.swift</code>, but so far no luck. Here are all the relevant files I can think of:</p>

<p>Procfile:</p>

<pre><code>web: Run serve --env production --hostname 0.0.0.0 --port $PORT --config:postgresql.url $DATABASE_URL
</code></pre>

<p>configure.swift:</p>

<pre><code>import FluentPostgreSQL
import Vapor

/// Called before your application initializes.
public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
    /// Register providers first
    try services.register(FluentPostgreSQLProvider())

    var contentConfig = ContentConfig.default()

    /// Create custom JSON encoder
    let jsonEncoder = JSONEncoder()
    if #available(OSX 10.12, *) {
        jsonEncoder.dateEncodingStrategy = .iso8601
    } else {
        jsonEncoder.dateEncodingStrategy = .millisecondsSince1970
    }
//    jsonEncoder.keyEncodingStrategy = .convertToSnakeCase

    /// Register JSON encoder and content config
    contentConfig.use(encoder: jsonEncoder, for: .json)
    services.register(contentConfig)

    /// Register routes to the router
    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    /// Register middleware
    var middlewares = MiddlewareConfig() // Create _empty_ middleware config
    /// middlewares.use(FileMiddleware.self) // Serves files from `Public/` directory
    middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
    services.register(middlewares)

    // Configure a database
    let dbConfig: PostgreSQLDatabaseConfig
    if let url = Environment.get(""DATABASE_URL""), let psqlConfig = PostgreSQLDatabaseConfig(url: url) {
        dbConfig = psqlConfig
    } else {
        dbConfig = PostgreSQLDatabaseConfig(hostname: ""localhost"", port: 5432, username: ""admin"", database: ""development"", password: nil)
    }
    let postgresql = try PostgreSQLDatabase(config: dbConfig)

    /// Register the configured SQLite database to the database config.
    var databases = DatabasesConfig()
    databases.add(database: postgresql, as: .psql)
    services.register(databases)

    /// Configure migrations
    var migrations = MigrationConfig()
    migrations.add(model: Visit.self, database: .psql)
    services.register(migrations)
}
</code></pre>

<p>Package.swift:</p>

<pre><code>// swift-tools-version:4.0
import PackageDescription

let package = Package(
    name: ""SubwayNyc"",
    dependencies: [
        // 💧 A server-side Swift web framework.
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),

        // 🔵 Swift ORM (queries, models, relations, etc) built on PostgreSQL.
        .package(url: ""https://github.com/vapor/fluent-postgresql.git"", from: ""1.0.0""),

        .package(url: ""https://github.com/vapor/sql.git"", from: ""2.1.0"")
    ],
    targets: [
        .target(name: ""App"", dependencies: [""FluentPostgreSQL"", ""Vapor""]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App""])
    ]
)
</code></pre>

<p>How can I get PostgreSQL hooked up to my Vapor 3 app on Heroku?</p>
","1799154","","1041105","","2018-10-30 19:13:32","2020-04-12 11:44:01","Configure PostgreSQL DB with Vapor 3 on Heroku","<swift><heroku><heroku-postgres><vapor>","2","2","2","","","52911881","118712","118712","vapor","592","36204589","36204588"
"52920886","1","52922768","","2018-10-21 23:50:06","","3","476","<p>Suppose I have a model called <code>Estimate</code>. I have a Vapor 3 API that I want to return a list of these models, filtered by query parameters. Doing so currently returns a <code>Future&lt;[Estimate]&gt;</code>, which results in the API returning JSON that looks like this:</p>

<pre><code>[{estimate object}, {estimate object}, ...]
</code></pre>

<p>Instead, I'd like make it return something this:</p>

<pre><code>{""estimates"": [{estimate object}, {estimate object}, ...]}
</code></pre>

<p>So, the same thing as before, but wrapped in a JSON object with a single key, <code>""estimates""</code>. </p>

<p><a href=""https://docs.vapor.codes/3.0/vapor/content/#dynamic-properties"" rel=""nofollow noreferrer"">According to the documentation</a>, any time I want to return something non-default, I should make a new type for it; this suggests to me I should create a type like:</p>

<pre><code>final class EstimatesResponse: Codable {
  var estimates: [Estimate]?
}
</code></pre>

<p>However, after filtering I get a <code>Future&lt;[Estimate]&gt;</code> and NOT a pure <code>[Estimate]</code> array, meaning that I couldn't assign it to my <code>EstimatesResponse</code> <code>estimates</code> property. It seems weird to make the type of <code>estimates</code> be <code>Future&lt;[Estimate]&gt;</code>, and I'm not sure how that'd turn out.</p>

<p>How, then, can I return JSON of the correct format?</p>
","1799154","","1041105","","2018-10-30 19:13:25","2018-10-30 19:13:25","Vapor 3 API: embed Future<Model> in response object","<swift><vapor>","1","0","1","","","52920886","118712","118712","vapor","592","36204589","36204588"
"53017227","1","","","2018-10-26 22:55:47","","1","124","<p>I am trying to create a model that has various timestamps (createdAt, updatedAt, deletedAt), with default values. How can this be achieved? I tried playing around with the <code>prepare</code> method, but to no avail. Thank you in advance.</p>

<p>This is my current class:
<a href=""https://i.stack.imgur.com/OEAcw.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/OEAcw.png"" alt=""enter image description here""></a></p>
","10220111","","","","","2018-12-04 20:05:58","Vapor MySQL Timestamps Default Values","<mysql><swift><xcode><vapor>","1","0","","","","53017227","118712","118712","vapor","592","36204589","36204588"
"53019534","1","53028175","","2018-10-27 07:05:31","","1","69","<p>I have a Vapor 3 API up on Heroku. Unfortunately, it's not handling dates correctly. Originally, I thought I could just treat dates like strings for simplicity in Vapor, like so:</p>

<pre><code>struct MyModel {
  var time: String?
}
</code></pre>

<p>But whenever I fetch <code>MyModel</code>s from the db and return it, the <code>time</code> key doesn't appear at all (while other keys and values have no problems). I thought I might be able to just change <code>time</code>'s type to <code>Date</code>, but that resulted in the same thing, and I've already used <code>ContentConfig</code> to set the <code>JsonEncoder.dateEncodingStrategy</code> to <code>.iso8601</code> (again, no luck – perhaps because <code>dateEncodingStrategy</code> only supports millis on Linux, which is what Heroku uses?).</p>

<p>How do I convert Postgres dates to ISO8601 in json with Vapor 3 running on Heroku?</p>
","1799154","","1041105","","2018-10-30 19:12:55","2020-03-28 00:58:03","How do I convert Postgres dates to ISO8601 in JSON responses with Vapor 3 running on Heroku?","<postgresql><heroku><heroku-postgres><vapor>","1","0","","","","53019534","118712","118712","vapor","592","36204589","36204588"
"53023892","1","53026826","","2018-10-27 16:15:07","","4","510","<p>It looks like in Vapor 2 you could do something like:</p>

<pre><code>let query = &lt;some fluent query object&gt;
logger?.debug(query)
</code></pre>

<p>and it would print out the full SQL statement, but I'm not seeing any documentation of how to do that now in Vapor 3.</p>

<p>How can I see what SQL is being generated by my <code>QueryBuilder</code>?</p>
","1799154","","1041105","","2018-10-30 19:12:40","2018-10-30 19:12:40","How do I log SQL statements in Vapor 3/Fluent?","<postgresql><vapor>","1","3","1","","","53023892","118712","118712","vapor","592","36204589","36204588"
"53030158","1","53785912","","2018-10-28 09:42:53","","3","478","<p>I'd like to query a model such that Fluent generates SQL that looks like this:</p>

<pre><code>SELECT DISTINCT ON(&lt;my columns&gt;) * FROM my_table...
</code></pre>

<p>How do I do that?</p>
","1799154","","1041105","","2018-10-30 19:12:26","2018-12-14 19:36:03","Vapor 3/Fluent for Postgres: How do I make a SELECT DISTINCT query?","<postgresql><fluent><vapor>","1","2","","","","53030158","118712","118712","vapor","592","36204589","36204588"
"53056799","1","53058401","","2018-10-30 03:05:44","","4","426","<p>I am using Vapor 3 to try and create just a sample project where I have a dish, the parent, and the reviews for the dish, the child. All the tutorials that I have been seeing haven't been very clear on how to create the relationship or they are using it in conjecture with leaf. I do not want to use leaf for this, I just want to be able to show all the reviews when for the dish when I give it's id,  and it seems that it is different than it was for vapor 2. 
My 2 models are Dish and Review
Dish.swift: The parent,</p>

<pre><code>import Foundation
import Vapor
import FluentSQLite

final class Dish: Content {
    var id: Int?
    var name: String
    var course: String
    var price: Double
    var imageURL: String
    var description: String

    init(name: String, course: String, price: Double, imageURL: String, description: String) {
        self.name = name
        self.course = course
        self.price = price
        self.imageURL = imageURL
        self.description = description

    }

}

extension Dish {
    var reviews: Children&lt;Dish, Review&gt; {
        return children(\.dishId)
    }
}

extension Dish: Parameter { }

extension Dish: SQLiteModel {
    static let entity: String = ""Dishes""
}

extension Dish: Migration { }
</code></pre>

<p>Review.swift, the child,</p>

<pre><code>import Foundation
import Vapor
import FluentSQLite

final class Review: Content {

    var id: Int?
    var title: String
    var body: String
    var dishId: Dish.ID

    init(title: String, body: String, dishId: Dish.ID) {
        self.title = title
        self.body = body
        self.dishId = dishId
    }

}

extension Review {
    var dish: Parent&lt;Review, Dish&gt; {
        return parent(\.dishId)
    }
}

extension Review: Migration { }

extension Review: SQLiteModel {
    static let entity: String = ""Reviews""
}

extension Review: Parameter { }
</code></pre>

<p>the controller for Dish, DishController, </p>

<pre><code>import Foundation
import Vapor
import FluentSQLite

class DishesController: RouteCollection {

    func boot(router: Router) throws {
        let dishesRoutes = router.grouped(""api/dishes"")
        dishesRoutes.get(""/"", use: getAll)
        dishesRoutes.get(Dish.parameter, use: getById)
        dishesRoutes.post(Dish.self, at: ""/"", use: createDish)
        dishesRoutes.delete(Dish.parameter, use: deleteDish)
    }

    func deleteDish(req: Request) throws -&gt; Future&lt;Dish&gt; {
        return try req.parameters.next(Dish.self).delete(on: req)
    }


    func createDish(req: Request, dish: Dish) -&gt; Future&lt;Dish&gt; {
        return dish.save(on: req)
    }

    func getAll(req: Request) -&gt; Future&lt;[Dish]&gt; {
        return Dish.query(on: req).all()
    }

    func getById(req: Request) throws -&gt; Future&lt;Dish&gt; {
        return try req.parameters.next(Dish.self)
    }


}
</code></pre>

<p>and the controller for reviews. ReviewController,</p>

<pre><code>import Foundation
import Vapor
import FluentSQLite

class ReviewController: RouteCollection {
    func boot(router: Router) throws {
        let reviewRoutes = router.grouped(""api/reviews"")


        reviewRoutes.get(""/"", use: getAll)
        reviewRoutes.get(Review.parameter, use: getById)
        reviewRoutes.post(Review.self, at: ""/"", use: createReview)
        reviewRoutes.delete(Review.parameter, use: deleteReview)

    }


    func deleteReview(req: Request) throws -&gt; Future&lt;Review&gt; {
        return try req.parameters.next(Review.self).delete(on: req)
    }

    func createReview(req: Request, review: Review) -&gt; Future&lt;Review&gt; {
        return review.save(on: req)
    }


    func getAll(req: Request) -&gt; Future&lt;[Review]&gt; {
        return Review.query(on: req).all()
    }

    func getById(req: Request) throws -&gt; Future&lt;Review&gt; {
        return try req.parameters.next(Review.self)
    }
}
</code></pre>

<p>this is the routes.swift,</p>

<pre><code>import Vapor


/// Register your application's routes here.
public func routes(_ router: Router) throws {


    router.get(""/reviews"", Dish.parameter,""dish"") { request -&gt; Future&lt;Dish&gt; in

        return try request.parameters.next(Review.self).flatMap(to: Dish.self) { review in

            return review.dish.get(on: request)
        }
    }


    let dishesController = DishesController()
    try router.register(collection: dishesController)
    let reviewController = ReviewController()
    try router.register(collection: reviewController)

}
</code></pre>

<p>I just want a simple one to many relationship where one dish can have many reviews, but when I use postman to try and access the reviews for the particular dish, all I get is an error. I know that I used the correct syntax in postman because I can use all the other requests from the controllers just fine, just not any for the relationships. Please tell me what i am missing, because I am getting confused as to what I am doing wrong. If there is anything else I can add please ask. 
Thank you very much</p>
","7270753","","1041105","","2018-10-30 19:12:02","2018-10-30 19:12:02","creating a parent child relationship in vapor 3","<swift><parent-child><vapor>","1","0","","","","53056799","118712","118712","vapor","592","36204589","36204588"
"53120997","1","","","2018-11-02 15:00:03","","0","232","<p>I am wondering if there is a possibility to create file-handling code in Vapor ? (Swift)</p>

<p>For example, I want to create a folder on the server, then copy an existing file from one location on the server to this folder.</p>

<p>Is this possible in Vapor ?</p>

<p>I did the file-copying in <code>php</code> as can be seen in the below function that actually copies a file from source to destination :</p>

<pre><code>&lt;?php
function copyr($source, $dest, $permissions = 0701)
{
    // Check for symlinks
    if (is_link($source)) {
        return symlink(readlink($source), $dest);
    }

    // Simple copy for a file
    if (is_file($source)) {
        copy($source, $dest);
        return chmod($dest, 0204);
    }

    // Make destination directory
    if (!is_dir($dest)) {
        mkdir($dest, $permissions);
    }

    // Loop through the folder
    $dir = dir($source);
    while (false !== $entry = $dir-&gt;read()) {
        // Skip pointers
        if ($entry == '.' || $entry == '..') {
            continue;
        }

        // Deep copy directories
        copyr(""$source/$entry"", ""$dest/$entry"", $permissions);
    }

    // Clean up
    $dir-&gt;close();
    return true;
}
?&gt;
</code></pre>
","3826232","","","","","2018-11-04 03:10:54","file handling in vapor","<php><swift><vapor>","1","0","","","","53120997","118712","118712","vapor","592","36204589","36204588"
"53147253","1","53160661","","2018-11-05 01:38:10","","3","95","<p>Using numerous tutorials on Vapor 3 I've failed to figure out how I can edit output JSON, f.e. to get particular User object I create route:</p>

<pre><code>protectedRouter.get(""users"", User.parameter, use: userController.user)
</code></pre>

<p>And method in <code>UserController</code>:</p>

<pre><code>func user(_ req: Request) throws -&gt; Future&lt;User&gt; {
    return try req.parameters.next(User.self)
}
</code></pre>

<p>And it, of course, sends everything that inside the User object, including email and hashed password. Great. How can I avoid this? I mean I want to send only public information about the user (name, nick, id etc...).</p>
","961037","","","","","2018-11-05 19:09:16","Vapor 3 GET route for sensitive data","<swift><vapor>","1","0","1","","","53147253","118712","118712","vapor","592","36204589","36204588"
"53180337","1","53196227","","2018-11-06 21:31:15","","2","102","<p>Is this possible to use in-memory FluentSQLite provider for testing purpose and FluentPostgreSQL for app's models?</p>
","961037","","","","","2018-11-07 19:11:25","Testing Vapor 3 with different database provider","<swift><vapor>","1","0","","","","53180337","118712","118712","vapor","592","36204589","36204588"
"53249821","1","53252197","","2018-11-11 14:44:47","","2","587","<p>How can i decode the following json-array (which is part of a http-request)</p>

<pre><code>[ 
  { ""id"": 0, ""name"": ""darth maul"" }, 
  { ""id"": 1, ""name"": ""darth sidious"" } 
]
</code></pre>

<p>in swift vapor 3 with the decode function?</p>

<p>vapor code: </p>

<pre><code>struct User: Content {
    var id: Int
    var name: String
}

router.put(""user"") { request -&gt; Future&lt;HTTPStatus&gt; in
    return try request.content.decode(User.self).map({ (user) -&gt; (HTTPStatus) in
        // process ...
        return .ok
    })
}
</code></pre>
","6766743","","","","","2018-11-11 19:07:51","decode array of objects in vapor","<json><swift><httprequest><decode><vapor>","1","2","","","","53249821","118712","118712","vapor","592","36204589","36204588"
"53267125","1","53269102","","2018-11-12 17:23:04","","3","402","<p>I have a route handler which returns a Future for my login page, defined as follows :</p>

<pre><code>func boot(router: Router) throws {
    let authSessionRoutes = router.grouped(User.authSessionsMiddleware())
    authSessionRoutes.get(""/login"", use: loginHandler)
}

func loginHandler(_ req: Request) throws -&gt; Future&lt;View&gt; {
    return try req.view().render(""loginPage"")
}
</code></pre>

<p>This works well when the user is not connected, but I'd like to add logic so that any authenticated user trying to access this page would be redirected to their homepage instead.</p>

<p>Here's what I tried :</p>

<pre><code>func loginHandler(_ req: Request) throws -&gt; Future&lt;View&gt; {

    if let _ = try req.authenticated(User.self) {
        return req.redirect(to: ""/"") &lt;&lt;&lt; Cannot convert return expression of type 'Response' to return type 'EventLoopFuture&lt;View&gt;'
    }

    return try req.view().render(""loginPage"")
}
</code></pre>

<p>This tells me that since my loginHandler is expected to return a <code>Future&lt;View&gt;</code>, returning a <code>Response</code> does not conform to the method's definition.</p>

<p>What would be the best way to handle this case?</p>

<p><strong>EDIT :</strong></p>

<p>Thanks for the answer !
My final code looks like so :</p>

<pre><code>func loginHandler(_ req: Request) throws -&gt; Future&lt;Response&gt; {
    if let _ = try req.authenticated(User.self) {
        return req.future().map() {
            return req.redirect(to: ""/"")
        }
    }
    return try req.view().render(""loginPage"").encode(for: req)
}
</code></pre>
","2700551","","2700551","","2018-11-12 21:13:20","2018-11-12 21:13:20","Returning redirect response instead of expected leaf view","<swift><routing><vapor><server-side-swift>","1","0","","","","53267125","118712","118712","vapor","592","36204589","36204588"
"53284468","1","","","2018-11-13 15:37:54","","0","115","<p>I have a program that I deploy onto Ubuntu (Vapor 2.4.5 based server app). Up to this point it's been compiling under Swift 4.1 without issue.</p>

<p>Today, I applied a few patches to my UAT server (hosted on AWS). I noticed  Swift got updated to 4.2. Now the Swift build process fails, with the following message:</p>

<blockquote>
  <p>swift: /home/buildnode/jenkins/workspace/oss-swift-4.2-package-linux-ubuntu-16_04/llvm/lib/IR/Instructions.cpp:2565: static llvm::CastInst *llvm::CastInst::Create(Instruction::CastOps, llvm::Value *, llvm::Type *, const llvm::Twine &amp;, llvm::Instruction *): Assertion `castIsValid(op, S, Ty) &amp;&amp; ""Invalid cast!""' failed.</p>
</blockquote>

<p>Any ideas what this might be?</p>

<p>I rolled my server back to its prior state, and no problems the code compiles.</p>

<p>Phil</p>
","7820216","","","","","2018-11-13 15:37:54","Swift 4.2 Compiling Vapor 2.4.5 On Ubuntu 16.04.5","<swift><ubuntu><vapor>","0","2","","","","53284468","118712","118712","vapor","592","36204589","36204588"
"53298296","1","","","2018-11-14 10:41:48","","9","1004","<p>I deployed my vapor project to Ubuntu. And made the configuration of supervisor and Nginx.</p>

<p>When I invoke my server. first call is success but When I try second call I get 502 bad gateway error from browser. When I check error log, the error is </p>

<pre><code>""Fatal error: Error raised at top level: bind(descriptor:ptr:bytes:) failed: Address already in use (errno: 98) : file /home/buildnode/jenkins/wo$""
</code></pre>

<p>If I kill the port(8080) process. And after, I try to connect again first try is success then get fail again.</p>

<p>What should I do to get rid of this error?</p>
","4050289","","100297","","2019-08-14 11:12:12","2019-12-15 10:14:35","vapor: Address already in use (errno: 98)","<swift><ubuntu><nginx><supervisord><vapor>","2","5","2","2019-08-14 11:12:15","","53298296","118712","118712","vapor","592","36204589","36204588"
"53306475","1","","","2018-11-14 18:16:44","","6","444","<p>Here is my Fluent Model</p>

<pre><code>struct Ailment: PostgreSQLModel {

enum Frequency: String , Content {
    case regular = ""Regular""
    case occasional = ""Occasional""
    case incidentFound = ""Incident Found""
}

var id: Int?

var ailment: String

var frequency: Frequency

var dateIdentified: Date?

var underMedication: Bool

var breifDescription: String

}
</code></pre>

<p>I am able to create Fluent Model with <code>Int Enum</code>, but it does not work with <code>String Enum</code>,</p>

<p>I am getting below Exception</p>

<pre><code>Fatal error: Error raised at top level: ⚠️ DecodingError: Cannot initialize Frequency from invalid String value 1
</code></pre>

<p>Thanks in advance :)</p>
","9715034","","452584","","2018-11-15 10:36:37","2019-06-17 06:42:12","Create Fluent Model with String Enum","<fluent><vapor>","1","1","","","","53306475","118712","118712","vapor","592","36204589","36204588"
"53333076","1","53344265","","2018-11-16 07:13:04","","2","200","<p>I want to inspect a list of all routes, that Vapor app is serving. Is there a script or a run-time command that will generate the list for me?</p>

<p>I'm looking for something similar to <code>rake routes</code> in Ruby on Rails</p>
","2777364","","","","","2018-11-18 09:31:14","List all routes in Vapor","<swift><routing><vapor>","2","0","","","","53333076","118712","118712","vapor","592","36204589","36204588"
"53381955","1","53400685","","2018-11-19 20:12:24","","5","528","<p>I want to write some integration tests for Vapor 3 server and I need to have clean Postgre database each time I run my tests. How can I achieve this? It seems migrations isn't the right way to go as they've been running once if database doesn't exist yet.</p>
","961037","","961037","","2018-11-19 22:57:45","2020-01-14 08:54:34","Deleting test database in Vapor 3","<swift><vapor>","3","3","","","","53381955","118712","118712","vapor","592","36204589","36204588"
"53440216","1","53440305","","2018-11-23 03:09:52","","3","420","<p>'m pretty stuck after a few days of trying to get this working and I could use some help.</p>

<p>I have a vapor API that works fine. I created a route and can access it from <a href=""http://localhost:8080/backend/returnA"" rel=""nofollow noreferrer"">http://localhost:8080/backend/returnA</a> in a browser on the server. It returns some JSON.</p>

<p>Where I'm stuck is in trying to configure Nginx to server as a proxy. Can anyone help me understand how the <a href=""http://localhost:8080/backend/returnA"" rel=""nofollow noreferrer"">http://localhost:8080/backend/returnA</a> URL translates into a working URL accessible from the LAN?</p>

<p>I'm pretty confused as the Nginx.conf asks for a root URL but I don't know what to put in. If I leave it blank it defaults to /usr/local/Cellar/nginx/1.15.6/html/backend/returnA/index.html which obviously won't work. If I set it to the public folder in the Vapor app directory this also doesn't work. In both instances I get a ""No such file or directory"".</p>

<p>I've gone through countless Nginx conf settings found online, tried adding a proxy location, nothing works. Trying <a href=""http://172.16.1.25/backend/returnA/"" rel=""nofollow noreferrer"">http://172.16.1.25/backend/returnA/</a> always returns a 404 from the Nginx server.</p>

<p>How do I point Nginx to my Vapor route when it's not serving a static file like index.html, and instead retuning JSON?</p>

<p>Any help is much appreciated.</p>

<p>Here's the config, edited to include Thanh's code, old location commented out:</p>

<pre><code>#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

    http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local]       ""$request"" '
    #                  '$status $body_bytes_sent ""$http_referer"" '
    #                  '""$http_user_agent"" ""$http_x_forwarded_for""';
    #access_log  logs/access.log  main;
    sendfile        on;
    #tcp_nopush     on;
    #keepalive_timeout  0;
    keepalive_timeout  65;
    #gzip  on;

    server {
    server_name 172.16.1.25;
    listen       80  default_server;

    root /Users/localadmin/Developer/server/MedicapAPI/Public/;

    # location @proxy {
    #    proxy_pass http://127.0.0.1:8080;
    #    proxy_pass_header Server;
    #    proxy_set_header Host $host;
    #    proxy_set_header X-Real-IP $remote_addr;
    #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #    proxy_pass_header Server;
    #    proxy_connect_timeout 3s;
    #    proxy_read_timeout 10s;
    # }

    location  / {
        proxy_ignore_client_abort on;
        proxy_pass http://localhost:8080/;
        proxy_redirect off;
    }    
    }
        include servers/*;
    }
</code></pre>
","10687805","","10687805","","2018-11-23 04:00:19","2020-03-03 20:11:56","Configuring Nginx as a proxy for a Vapor API","<macos><nginx><vapor>","2","3","","","","53440216","118712","118712","vapor","592","36204589","36204588"
"53453913","1","53461571","","2018-11-23 23:38:59","","3","291","<p>I'm developing a simple web API with Vapor. To give more context, I'm newbie in backend development.</p>

<p>The consumer of the API is going to be an iOS app. Currently, I don't need the users to sign up to use the app. And I would like to keep it like that.</p>

<p>On the other hand, I would like to have some authentication to avoid that anyone could use the API I'm developing.</p>

<p>Looking for information I've found how implement authentication. But the examples I've seen are based on creating users in the backend for each user of the app. What I don't want to do. I would like to use an api-key as we do normally when we use third-party api's.</p>

<p>How could I have ""api-key authentication"" with Vapor ??</p>

<p>Or, should I just create an unique user/password that it's shared by all the users of the iOS app (that use the API) and then use basic or token authentication?</p>

<p>Thank you very much!</p>

<p>Carlos</p>
","896118","","","","","2019-01-20 19:18:24","Using API-Key in Vapor","<vapor>","2","0","","","","53453913","118712","118712","vapor","592","36204589","36204588"
"53536298","1","53540647","","2018-11-29 09:59:48","","6","880","<p>This is my route :</p>

<pre><code>router.get(""answers"",""delete"", Int.parameter) { req -&gt; Future&lt;Response&gt; in

        let answerID = try req.parameters.next(Int.self)
        guard let _ = getUsername(req) else {
            throw Abort(.unauthorized)
        }
        return Message.query(on: req).filter(\.id == answerID).first().map(to: Response.self) { answer in
            guard let answer = answer else {
                throw Abort(.notFound)
            }
            return answer.delete(on: req).map(to: Response.self) { _ in
                return req.redirect(to: ""/answers"")
            }
        }
    }
</code></pre>

<p>But for xCode this is Ambiguous without more context <code>.filter(\.id == answerID)</code></p>

<p>And this is my struct  Message :</p>

<pre><code>struct Message: Content, SQLiteUUIDModel, Migration {
var id: UUID?
var username: String
var content: String
var category: String
var question: String
var date: Date
</code></pre>

<p>}</p>

<p>I don't understand because I use filters on ids in many other routes and it's the first time I show this error.</p>

<p>I googled this and it seems that the errors shows up when Fluent is not imported but I've already <code>import Fluent</code> at the top.</p>
","10721767","","10721767","","2018-11-29 10:25:55","2018-11-29 13:55:42","Vapor Swift Fluent : Type of expression is ambiguous without more context","<swift><fluent><vapor>","1","4","","","","53536298","118712","118712","vapor","592","36204589","36204588"
"53631110","1","53639125","","2018-12-05 11:19:45","","6","202","<p>I've been trying to render a computed property using the templating engine Leaf with Vapor 3, but so far no luck. If the same property is stored, everything works fine. If I make it computed, nothing is displayed in the web page. I can understand the reasons why such solution wouldn't be working, but I'd like to know if there's any way to make it working.</p>

<p><strong>Code for the element to render</strong>: 
</p>

<pre><code>struct SocialLinkContext: Encodable, CSSStyleable {
    let hyperlinkURI: String
    let classes: [String]
    //let styleClasses: String

    init(hyperlinkURI: String, classes: [String]) {
        self.hyperlinkURI = hyperlinkURI
        self.classes = classes
        //self.styleClasses = classes.joined(separator: "" "")
    }

    //Seems not to be supported by Leaf
    var styleClasses: String {
        return self.classes.joined(separator: "" "")
    }
}
</code></pre>

<p>Part of the <em>main_page.leaf</em> file:</p>

<pre><code>...
&lt;div class=""row banner""&gt;
    &lt;div class=""banner-text""&gt;
        &lt;h1 class=""responsive-headline""&gt;Hello, world!&lt;/h1&gt;
        &lt;hr /&gt;
    &lt;/div&gt;
    #embed(""social_links"")
&lt;/div&gt;
...
</code></pre>

<p>The <em>social_links.leaf</em> file:</p>

<pre><code>&lt;ul class=""social""&gt;
    #for(socialContext in socialLinks) {
        &lt;li&gt;
            &lt;a href=""#(socialContext.hyperlinkURI)""&gt;
                &lt;i class=""#(socialContext.styleClasses)""&gt;&lt;/i&gt;
            &lt;/a&gt;
        &lt;/li&gt;
    }
&lt;/ul&gt;
</code></pre>

<p>The <em>PersonalPageContext</em> to be passed to the View Renderer:</p>

<pre><code>struct PersonalWebPageContext: Encodable {
    ...
    let socialLinks: [SocialLinkContext] = [...]
    ...
}
</code></pre>

<p>And finally, the <em>PersonalWebPageViewController</em> controller:</p>

<pre><code>private func serveWebPage(req: Request) throws -&gt; Future&lt;View&gt; {
    return try req.view().render(""main_page"", PersonalWebPageContext())
}
</code></pre>
","4048201","","","","","2018-12-05 19:05:44","Cannot render a computed property with Leaf in Vapor 3","<swift><vapor><leaf>","1","0","0","","","53631110","118712","118712","vapor","592","36204589","36204588"
"53709868","1","","","2018-12-10 16:34:51","","0","204","<p>I am new with Vapor and I am confused about how to make a url request in Vapor Web. </p>

<p>I'd like to use the Vapor web API from cryptocompare.com. Is the best solution to use Swift URLSession or to use JavaScript in the web page?</p>
","7541583","","641914","","2018-12-10 22:12:17","2018-12-10 22:12:17","Vapor 3 - URLSession or AJAX?","<swift><web><vapor>","0","3","","","","53709868","118712","118712","vapor","592","36204589","36204588"
"53715064","1","","","2018-12-10 23:07:54","","1","93","<p>I have the next function on Vapor:</p>

<pre><code>func getPartidosHandler(_ req: Request) throws -&gt; Future&lt;[PartidoWSData]&gt; {
    return Partido.query(on: req).filter(\.estado == nil).all().map(to: [PartidoWSData].self) { partidos in
        var partidosWS: [PartidoWSData] = []
        for partido in partidos {

            // Something here

        }
        return partidosWS
    }
}
</code></pre>

<p>And the next struct PartidoWSData: </p>

<pre><code>struct PartidoWSData: Content {
    let idPartido: String
    let fecha: String
    let sede1: Future&lt;Sede&gt;
    let sede2: Future&lt;Sede&gt;
}
</code></pre>

<p>My model Partido has two references to Sede, ""sede1"" and ""sede2"". </p>

<p>What I want is that the function gives an array of PartidoWSData struct, where I can see two properties of ""Partido"", ""idPartido"" and ""fecha"", and the two Sede related to the model.</p>

<p>How can I do that?</p>

<p>Thanks!</p>
","2239414","","","","","2018-12-12 19:17:56","Vapor Swift - Obtaining data from two Models","<swift><vapor>","1","0","","","","53715064","118712","118712","vapor","592","36204589","36204588"
"53756732","1","","","2018-12-13 07:12:43","","1","88","<p>Python: <code>setproctitle</code>
How to do the same thing in Swift?</p>
","4382771","","","","","2018-12-13 15:51:46","How to change process title in Swift on Linux?","<swift><vapor><perfect><kitura>","1","0","","","","53756732","118712","118712","vapor","592","36204589","36204588"
"53786970","1","53818052","","2018-12-14 21:14:55","","4","246","<p>I am experimenting with a standalone script that will query a Postgres database using Vapor and Fluent. In a normal Vapor API application this is simply done by: </p>

<pre><code>router.get(""products"") { request in
    return Product.query(on: request).all()
}
</code></pre>

<p>However, in a standalone script, since there is no ""request"", I get stuck on what to replace the ""request"" or <code>DatabaseConnectable</code> with. Here's where I get stuck on:</p>

<pre><code>import Fluent
import FluentPostgreSQL

let databaseConfig = PostgreSQLDatabaseConfig(hostname: ""localhost"",
                                              username: ""test"",
                                              database: ""test"",
                                              password: nil)

let database = PostgreSQLDatabase(config: databaseConfig)

let foo = Product.query(on: &lt;??WhatDoIPutHere??&gt;)
</code></pre>

<p>I tried creating an object that conforms to <code>DatabaseConnectable</code>, but couldn't figure out how to correctly get that object to conform.</p>
","3904601","","5236226","","2018-12-17 15:16:08","2019-03-11 20:59:14","Is is possible to use Vapor 3 Postgres Fluent in a standalone script?","<swift><vapor>","2","0","1","","","53786970","118712","118712","vapor","592","36204589","36204588"
"53839103","1","53839513","","2018-12-18 18:30:34","","2","236","<p>The <a href=""https://docs.vapor.codes/3.0/mysql/getting-started/#customizing-config"" rel=""nofollow noreferrer"">Vapor 3 documentation</a> doesn't say much about database configuration other than to ""register a <code>DatabasesConfig</code> struct to your services.""</p>

<p>Tutorials (such as <a href=""https://medium.com/@martinlasek/tutorial-how-to-use-mysql-b0d6d5bd0bcd"" rel=""nofollow noreferrer"">this one</a>) suggest that you implement the configuration in the <code>App/configure.swift</code> file like this:</p>

<pre><code>let mysqlConfig = MySQLDatabaseConfig(
    hostname: ""127.0.0.1"",
    port: 3306,
    username: ""root"",
    password: ""root"",
    database: ""mycooldb""
)
services.register(mysqlConfig)
</code></pre>

<p>But my <code>configure.swift</code> file is being tracked by git, and I don't want to commit my username and password.</p>

<p>How do I supply an external configuration file for handling the database connection?</p>

<p>It appears that earlier versions of Vapor used JSON configuration files. Is this functionality completely gone? I can't find any mention of it in the current documentation.</p>
","3377150","","","","","2018-12-18 19:03:11","How do I configure a Fluent/MySQL database connection without putting my password in configure.swift in Vapor 3?","<swift><vapor>","2","0","","","","53839103","118712","118712","vapor","592","36204589","36204588"
"53875458","1","53889866","","2018-12-20 20:17:39","","3","58","<p>Is there a way to get access to a REPL on Heroku in Vapor 3? If so, how?</p>

<p>I've tried <code>heroku run swift run --repl</code>, but Heroku replies: <code>bash: swift: command not found</code>.</p>
","1799154","","","","","2018-12-21 19:28:35","Vapor 3 on Heroku: REPL?","<swift><heroku><vapor>","1","0","","","","53875458","118712","118712","vapor","592","36204589","36204588"
"53883704","1","53888311","","2018-12-21 11:05:33","","2","167","<p>How to add data to SQLite database manually in Vapor project so that at startup there's already some data in it?</p>
","3990005","","","","","2019-01-21 14:39:38","Creating data in SQLite database manually in Vapor","<swift><sqlite><vapor><server-side-swift>","1","2","","","","53883704","118712","118712","vapor","592","36204589","36204588"
"53917339","1","53933317","","2018-12-24 20:07:23","","5","209","<p>I'm working on a Vapor 3 app that uses the requesting path as the argument for the method that responds. For instance:</p>

<p><a href=""http://localhost:8080/monitor/some/test/path"" rel=""noreferrer"">http://localhost:8080/monitor/some/test/path</a></p>

<p>That can be handled by a single endpoint, the <code>monitor</code> endpoint in this case, which would then ideally give me access to the rest of the URL, <code>/some/test/path</code>.</p>

<p>I've composed a route in Vapor that doesn't work using wildcard variables, and tried the <code>group</code> mechanic as described in the docs, to no avail. My expectation from using other web frameworks is that something like ""/monitor/*"" should do the job but I can't find anything in the documentation to suggest it.</p>

<p>Any assistance would be appreciated!</p>
","105728","","105728","","2018-12-24 20:17:25","2018-12-26 14:21:56","Vapor 3: Route with arbitrary path segments","<swift><vapor>","1","0","2","","","53917339","118712","118712","vapor","592","36204589","36204588"
"53922957","1","53957446","","2018-12-25 13:46:35","","1","87","<p>I'm starting a new vapor project and one of my own swift packages has a min deployment target of macOS 10.12. </p>

<p>The swift build tool itself accepts specifying the target version as follows:</p>

<pre><code>swift build -Xswiftc -target -Xswiftc x86_64-apple-macosx10.12
</code></pre>

<p>Is it possible to specify the macOS target when building with the vapor toolbox?</p>
","677987","","","","","2018-12-29 18:27:31","Set a macOS version in a Vapor project","<vapor>","1","0","","","","53922957","118712","118712","vapor","592","36204589","36204588"
"53958654","1","53963205","","2018-12-28 12:29:38","","3","54","<p>I have a simple Leaf template that I'd like to display Hello World in.</p>

<pre><code>#if(false) {
&lt;title&gt; All hail Apodron.&lt;/title&gt;
} #else {
&lt;title&gt; Hello World &lt;/title&gt;
}
</code></pre>

<p>the page has no title and displays as:</p>

<p><code>#else {Helloward}</code></p>

<p>However, if I change this to:</p>

<pre><code>#if(true) {
&lt;title&gt; All hail Apodron.&lt;/title&gt;
} #else {
&lt;title&gt; Hello World &lt;/title&gt;
}
</code></pre>

<p>then the title does display, but the page STILL shows up as:</p>

<p><code>#else {Helloward}</code></p>

<p>I also tried various syntaxes, such as:</p>

<p><code>##else {
    &lt;title&gt; Hello World &lt;/title&gt;
    }</code> and <code>#else() {
    &lt;title&gt; Hello World &lt;/title&gt;
    }</code> or even <code>##else() {
    &lt;title&gt; Hello World &lt;/title&gt;
    }</code></p>

<p>This seemed very basic, and I believe I followed the <a href=""https://docs.vapor.codes/2.0/leaf/leaf/#leafs-built-in-tags"" rel=""nofollow noreferrer"">documentation</a>.</p>
","10842907","","","","","2018-12-28 19:05:00","Using Leaf, the else condition isn't properly executed though the if one is","<if-statement><vapor><leaf>","1","2","","","","53958654","118712","118712","vapor","592","36204589","36204588"
"53983542","1","53987658","","2018-12-31 04:19:47","","1","261","<p>I am trying to implement a REST-ful API using Vapor 3, and I'd prefer to use what seems like a fairly standard creation pattern in other web frameworks: I'd like the entity creation controllers to return a 201 <code>Created</code> response status, with a <code>Location</code> response header that contains the full URL of the newly-created resource.</p>

<p>All of the Vapor 3 documentation I can find shows a create pattern that instead returns a 200 <code>OK</code> status, and includes the full resource in the response body. But I can't find any examples that use a 201 response even though that tends to be the more standard REST-ful API approach in my experience.</p>

<p>I have found that I can manually create a 201 response in my controller, and I assume there's a way to set arbitrary headers in that response. If so, is there a convenient way of getting the full URL of the resource I've just created so that I can set a <code>Location</code> header in the response?</p>

<p>I'm sure there are ways I can ""brute force"" this to get what I want but I am hoping that Vapor defines an idiomatic way to do this, much like the Java and Rails frameworks I've used provide.</p>
","830760","","","","","2019-01-07 22:56:52","Returning a 201 (Created) with location header in Vapor 3","<vapor>","1","0","0","","","53983542","118712","118712","vapor","592","36204589","36204588"
"53999535","1","","","2019-01-01 22:45:27","","1","68","<p>I try to request some data from mySQL to render a table with leaf. </p>

<p>Because of the Futures I don't know how to combine FluentMySQL and Leaf.</p>

<pre><code>import Vapor

final class IndexController {
    func index(_ req: Request) throws -&gt; EventLoopFuture&lt;View&gt;{
        let futureEvents = try Event.query(on: req).all()

        // Here I want to add the querys results to 'renderParameters'
        var renderParameters = ...

        return try req.view().render(""index"", renderParameters)
    }
}
</code></pre>
","347741","","2070111","","2019-01-20 22:29:32","2019-01-20 22:29:32","How to execute a query with FluentMySQL to render results with Leaf","<fluent><vapor><leaf>","1","0","","","","53999535","118712","118712","vapor","592","36204589","36204588"
"54029856","1","57909985","","2019-01-03 21:10:28","","4","238","<p>I know that when using Swift on iOS or macOS you can use SecKeyGeneratePair, but the Security library is unavailable on Linux. Short of falling back on Process to use the the OpenSSL CLI interface, is there any way to generate an RSA key pair in Swift.</p>

<p>FYI, I'm using Vapor 3 to build a web API.</p>
","5919644","","","","","2019-09-12 15:26:20","How can I generate an RSA key pair in Swift on Linux?","<swift><linux><rsa><vapor>","2","2","","","","54029856","118712","118712","vapor","592","36204589","36204588"
"54066666","1","54080052","","2019-01-06 22:55:21","","3","283","<p>I'm building a basic authentication setup similar to how it's used in Vapor's <code>auth-template</code> template (from <a href=""https://docs.vapor.codes/3.0/getting-started/toolbox/#templates"" rel=""nofollow noreferrer"">here</a>). I have everything set up the same way as in the template.</p>

<p>However, I would like to add salt. I can generate a salt for a user upon creation:</p>

<pre><code>static func create(_ req: Request, newUserRequest user: CreateUserRequest) throws -&gt; Future&lt;User.Public&gt; {
    return User.query(on: req).filter(\.username == user.username).first().flatMap { existingUser in
        guard existingUser == nil else {
            throw Abort(.badRequest, reason: ""A user with the given username already exists."")
        }

        guard user.password == user.passwordVerification else {
            throw Abort(.badRequest, reason: ""Given passwords did not match."")
        }

        let count = 16
        var pw_salt_data = Data(count: count)
        let _ = pw_salt_data.withUnsafeMutableBytes { mutableBytes in
            SecRandomCopyBytes(kSecRandomDefault, count, mutableBytes)
        }
        let pw_salt = try BCrypt.hash(pw_salt_data.base64EncodedString())

        let pw_hash = try BCrypt.hash(pw_salt + user.password)

        return User(id: nil, username: user.username, pw_hash: pw_hash, pw_salt: pw_salt, email: user.email).save(on: req).toPublic()
    }
}
</code></pre>

<p>But there's no way to retrieve that salt when performing authentication during login:</p>

<pre><code>static func login(_ req: Request) throws -&gt; Future&lt;UserToken&gt; {
    let user = try req.requireAuthenticated(User.self)
    let token = try UserToken.create(userID: user.requireID())
    return token.save(on: req)
}
</code></pre>

<p>I want the salt to be randomly generated for each user and stored in the database as a separate column from the hashed password to be used later during authentication.</p>

<p>Is there a standardized way to handle salting a password hash in Vapor 3?</p>
","3377150","","","","","2019-01-08 09:28:48","How do I handle salting a password hash in Vapor 3?","<swift><vapor>","2","0","","","","54066666","118712","118712","vapor","592","36204589","36204588"
"54099982","1","54117233","","2019-01-08 21:28:48","","3","401","<p>I can't figure out how to follow redirects from an external URL. The URL I am accessing is for some reason giving me 301, even though I don't get it in postman. I am wondering how I can get HTTPClient to follow the redirect or if I am doing anything wrong in order to get a 301.</p>

<p>I did read <a href=""https://github.com/vapor/vapor/pull/1480"" rel=""nofollow noreferrer"">this PR</a>, but I don't think it is relevant anymore. Nor does the <a href=""https://docs.vapor.codes/3.0/http/client/"" rel=""nofollow noreferrer"">HTTPClient documentation</a> cover redirects.
In the example below I've set the User-Agent to the same as Postman, in order to mimic Postman's request as much as possible.</p>

<p>My code so far:</p>

<pre><code>import Vapor
import HTTP

protocol DataFetching {
  func getFromURL(_ url: URL, on worker: Worker) throws -&gt; Future&lt;HTTPResponse&gt;
}

class DataFetcher: DataFetching {

  enum Error: Swift.Error {
    case unknown
  }

  func getFromURL(_ url: URL, on worker: Worker) throws -&gt; Future&lt;HTTPResponse&gt; {

    guard let host = url.host else { throw Error.unknown }

    var headers = HTTPHeaders()
    headers.replaceOrAdd(name: .userAgent, value: ""PostmanRuntime/7.4.0"")
    headers.replaceOrAdd(name: .accept, value: ""*/*"")
    headers.replaceOrAdd(name: .cacheControl, value: ""no-cache"")
    headers.replaceOrAdd(name: .applyToRedirectRef, value: ""true"")
    headers.replaceOrAdd(name: .acceptEncoding, value: ""gzip, deflate"")

    let httpRequest = HTTPRequest(method: .GET, url: url, version: HTTPVersion(major: 1, minor: 1), headers: headers)

    return HTTPClient.connect(hostname: host, on: worker).flatMap { client in
      return client.send(httpRequest)
    }
  }
}
</code></pre>

<p>What am I missing?</p>
","406677","","406677","","2019-01-08 21:43:57","2019-01-09 19:43:33","Vapor HTTPClient follow redirect","<swift><vapor>","1","2","","","","54099982","118712","118712","vapor","592","36204589","36204588"
"54157167","1","54165927","","2019-01-12 06:01:24","","1","181","<p>I have a type of data like a folder, and folders can be arbitrarily nested inside one another — a many-to-many relation. To support this, I've built a pivot table (I'm using MySQL) relating <code>parent_folder_id</code> to <code>child_folder_id</code> (foreign keys on the <code>folders</code> table). In Fluent, I've modeled this as a <code>FolderToSubfoldersPivot</code> in the same way as my other pivot classes.</p>

<p>I now want to extend my <code>Folder</code> type to have a <code>subfolders</code> attribute using <a href=""https://api.vapor.codes/fluent/latest/Fluent/Structs/Siblings.html"" rel=""nofollow noreferrer"">Siblings</a>. The code looks like:</p>

<pre class=""lang-swift prettyprint-override""><code>extension Folder {
    var subFolders: Siblings&lt;Folder, Folder, FoldersToSubfoldersPivot&gt; {
        return siblings()
    }
}
</code></pre>

<p>This is similar to how I've written <code>Siblings</code>-typed attributes for other custom types, which all work. However, for this case Xcode gives the following error:</p>

<blockquote>
  <p>Ambiguous use of 'siblings(related:through:)'</p>
</blockquote>

<p>I assume this is because of the two uses of the <code>Folder</code> type in the type declaration for the <code>Siblings</code>. I have tried getting around this a few ways (type aliases, explicit call on the <code>siblings(related:through:)</code> method with parameters, etc.) to no avail.</p>

<p>How can I get the <code>siblings()</code> functionality to work correctly? Or will I need to re-implement the <a href=""https://github.com/vapor/fluent/blob/master/Sources/Fluent/Relations/Siblings.swift"" rel=""nofollow noreferrer"">Siblings struct</a> from scratch to do what I want?</p>
","3377150","","","","","2019-01-31 01:43:48","How do I declare a Siblings extension on a Fluent model in Vapor 3 where the base and related types are the same?","<swift><vapor>","2","0","","","","54157167","118712","118712","vapor","592","36204589","36204588"
"54173080","1","54173442","","2019-01-13 20:48:49","","2","390","<p>I'm trying to create a chain of requests to third-party API with the following code:</p>

<pre><code>import Vapor

final class APIController: RouteCollection {

    private let baseULR = ""...""

    func boot(router: Router) throws {
        router.post(""login"", use: validate)
    }

    func validate(_ req: Request) throws -&gt; Future&lt;Response&gt; {
        // Get the phone number of the user
        let phoneNumber = try req.content.syncGet(String.self, at: ""phone_number"")
        return try req.client().post(""\(baseUrl)/..."", beforeSend: { post in
            try post.content.encode(json: [""phone_number"": phoneNumber])
        })
    }
}
</code></pre>

<p>But when testing request, I'm getting an error: </p>

<pre><code>[ ERROR ] Abort.415: Unsupported Media Type (ContentCoders.swift:95)
[ DEBUG ] Suggested fixes for Abort.415: Register an `DataDecoder` using `ContentConfig`. Use one of the decoding methods that accepts a custom decoder. (ErrorMiddleware.swift:26)
</code></pre>

<p>That, unfortunately, I don't understand how to fix.</p>
","1281250","","","","","2019-10-08 07:10:30","Accessing `Request` body parameters","<swift><vapor>","2","0","","","","54173080","118712","118712","vapor","592","36204589","36204588"
"54213302","1","54220358","","2019-01-16 08:51:50","","1","426","<p>I'm new at Vapor and I wanted to try to connect my MySQL database. I found on official documentation how to do it but when I try to send a query it throws an error:</p>

<p><code>No services are available for 'DatabaseConnectionPoolCache'. (Container.swift:112)</code></p>

<p>I just copy-paste the code from documentation and it doesn`t work. Could someone help me to found out why?</p>

<p>I have <strong>MySQL@5.7</strong> on <strong>Mojave</strong>. Actually simple requests work well, for example :</p>

<pre><code>router.get(""hey"") { req in
    return ""Stas, hey""
}
</code></pre>

<p>Code in configure.swift :</p>

<pre><code>import FluentSQLite
import MySQL
import Vapor

/// Called before your application initializes.
public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
    /// Register providers first
    try services.register(FluentSQLiteProvider())
    try services.register(MySQLProvider())

    /// Register routes to the router
    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    /// Register middleware
    var middlewares = MiddlewareConfig() // Create _empty_ middleware config
    /// middlewares.use(FileMiddleware.self) // Serves files from `Public/` directory
    middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
    services.register(middlewares)

    // Configure a SQLite database
    let sqlite = try SQLiteDatabase(storage: .memory)

    /// Register the configured SQLite database to the database config.
    var databases = DatabasesConfig()
    databases.add(database: sqlite, as: .sqlite)
    services.register(databases)

    /// Configure migrations
    var migrations = MigrationConfig()
    migrations.add(model: Todo.self, database: .sqlite)
    services.register(migrations)

    //Configure a MySQL database
    let mysql = try MySQLDatabase(config: MySQLDatabaseConfig(
        hostname: ""127.0.0.1"",
        port: 3306,
        username: ""root"",
        password: ""7374"",
        database: ""WORK_TIME""))

    ///Register to the congig
    var mysqlDatabases = DatabasesConfig()
    mysqlDatabases.add(database: mysql, as: .mysql)
    services.register(mysqlDatabases) 
}
</code></pre>

<p>My query in main.swift :</p>

<pre><code>public struct MySQLVersion: Codable {
    let version: String
}

router.get(""sql"") { req in
    return req.withPooledConnection(to: .mysql) {conn in
        return conn.raw(""SELECT @@version as version"")
            .all(decoding: MySQLVersion.self)
        }.map { rows in
            return rows[0].version
    }
}
</code></pre>

<p>It should return the version of my MySQL but it throws a strange error.</p>
","10786408","","5236226","","2019-01-16 15:31:33","2019-01-17 19:05:26","Can`t connect my MySQL database in Vapor project","<swift><vapor><fluent-orm>","2","0","1","","","54213302","118712","118712","vapor","592","36204589","36204588"
"54251010","1","","","2019-01-18 09:29:40","","2","530","<p>In Vapor 2 it was possible to access a session when connecting a new websocket. </p>

<p>For example:</p>

<pre><code>setupRoutes(){

  socket(""ws"") { request, websocket in
    let session = try request.assertSession()
    guard let userId = session.data[""user_id""]?.string else {
      ..
    }
}
</code></pre>

<p>In Vapor 3 configure.swift:</p>

<pre><code>let wss = NIOWebSocketServer.default()
  wss.get(""ws"") { websocket, request in

    --get session information--

    websocket.onText { websocket, text in
      websocket.send(text)
    }
 }
 services.register(wss, as: WebSocketServer.self)
</code></pre>

<p>With Vapor 3 the SessionMiddleware will not be invoked before passing the HTTP upgrade request to the WebsocketServer.
So how can I access session information? </p>
","10932510","","5236226","","2019-01-18 21:12:35","2019-05-10 20:10:49","Vapor 3 Websocket with Sessions","<websocket><vapor>","1","1","","","","54251010","118712","118712","vapor","592","36204589","36204588"
"54281604","1","","","2019-01-20 22:32:03","","3","129","<p>I'm trying to schedule the query of a random element every minute in my database. </p>

<p>The schedule part works but I don't find a way to pick an item from the database... </p>

<p>I'm a swift beginner. Maybe I missed something important !</p>

<p>Let me know if you need more informations</p>

<p>This is my code from boot.swift</p>

<pre><code>import Fluent
import FluentSQLite

func foo(on container: Container) {
    let future = container.withPooledConnection(to: .sqlite) { db in
        return Future.map(on: container){ }
    }
    future.do{ msg in

        let allQuotes = QuoteOfTheDay.query(on: ).all().wait()
        quoteOfTheDay = allQuotes.randomElement()

        }.catch{ error in
            print(""\(error.localizedDescription)"")
    }
}

/// Called after your application has initialized.
public func boot(_ app: Application) throws {
    // your code here

    func runRepeatTimer() {

        app.eventLoop.scheduleTask(in: TimeAmount.minutes(1), runRepeatTimer)
        foo(on: app)
    }

    runRepeatTimer()

}


</code></pre>
","10721767","","","","","2019-02-19 22:48:00","How to query database on boot?","<swift><vapor>","2","5","","","","54281604","118712","118712","vapor","592","36204589","36204588"
"54292759","1","54293436","","2019-01-21 15:09:07","","2","326","<p>I'm trying to setup a Vapor 3 project with SQLite.<br>
In the <code>configure.swift</code> file, I have the following setup related to sqlite:</p>

<pre><code>try services.register(FluentSQLiteProvider())

...

// Get the root directory of the project
// I have verified that the file is present at this path
let path = DirectoryConfig.detect().workDir + ""db_name.db""
let sqlite: SQLiteDatabase
do {
    sqlite = try SQLiteDatabase(storage: .file(path: path))
    print(""connected"") // called
} catch {
    print(error) // not called
    return
}

var databases = DatabasesConfig()
databases.add(database: sqlite, as: .sqlite)
services.register(databases)
</code></pre>

<p>In the database, I have a table called <code>posts</code>, that I want to query and return all entries from:</p>

<p><a href=""https://i.stack.imgur.com/KVIuB.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/KVIuB.png"" alt=""database table""></a></p>

<p>This is the <code>Post</code> implementation inside <em>/Sources/App/Models/</em>:</p>

<pre><code>final class Post: Content {
    var id: Int?
    var title: String
    var body: String

    init(id: Int? = nil, title: String, body: String) {
        self.id = id
        self.title = title
        self.body = body
    }
}
extension Post: SQLiteModel, Migration, Parameter { }
</code></pre>

<p>I have also added the migration in <code>configure.swift</code>:</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Post.self, database: .sqlite)
services.register(migrations)
</code></pre>

<p>In <code>routes.swift</code>, I define the <code>posts</code> route as follows:</p>

<pre><code>router.get(""posts"") { req in
    return Post.query(on: req).all()
}
</code></pre>

<p>Now, when calling <code>localhost:8080/posts</code>, I get:</p>

<pre><code>[]
</code></pre>

<p>Have I not properly connected the database?<br>
Have I missed something?</p>
","3397217","","3103448","","2019-01-22 16:41:23","2019-01-22 16:41:23","Vapor connect to SQLite Database","<swift><sqlite><vapor><vapor-fluent>","1","0","","","","54292759","118712","118712","vapor","592","36204589","36204588"
"54304666","1","54304704","","2019-01-22 09:05:31","","2","263","<p>I want to connect a MySQL database on my machine with a Vapor 3 app.<br>
My current <code>configure.swift</code> file looks as follows:</p>

<pre><code>try services.register(FluentMySQLProvider())

...

let mysqlConfig = MySQLDatabaseConfig(
    username: ""dev"",
    password: """",
    database: ""test""
)
let mysql = MySQLDatabase(config: mysqlConfig)

var databases = DatabasesConfig()
databases.add(database: mysql, as: .mysql)
services.register(databases)
</code></pre>

<p>This works just fine. However, since I need to add my Model to the migration configuration, I also need to add:</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Posts.self, database: .mysql)
services.register(migrations)
</code></pre>

<p>When running the app this time, I'm seeing an error saying:</p>

<blockquote>
  <p>Full authentication not supported over insecure connections.</p>
</blockquote>

<p>After some research, it seems that this error can be overcome by changing the password logic from <code>caching_sha2_password</code> to <code>mysql_native_password</code>.<br>
However, that leaves me with the error saying:</p>

<blockquote>
  <p>Unrecognized basic packet.</p>
</blockquote>

<p>How do I fix this?</p>
","3397217","","7568116","","2019-03-19 08:02:01","2019-03-19 08:02:01","MySQL & Vapor 3: unrecognized basic packet, full auth not supported","<swift><vapor><vapor-fluent><fluent-mysql>","1","0","1","","","54304666","118712","118712","vapor","592","36204589","36204588"
"54336547","1","54353768","","2019-01-23 22:16:54","","2","261","<p>Let's say I have Vapor configured with a database. I have two tables with a parent-child relationship. As an example let's use Team as parent table and Player as child one.</p>

<p>With Fluent it is easy to return a json with all the players of a team. It is also easy to return a json with the team of a player. But, which is the easiest way to return a json with the team properties and an array of players?</p>

<p>And the opposite. Given a json with the team properties and an array of players, which is the easiest way to create teams and players from that json?</p>

<p>Can Fluent help with that or should we manage it by ourselves?</p>

<p>Thank you very much!</p>

<p>Carlos</p>
","896118","","","","","2019-01-24 21:40:36","Returning a JSON containing an array in Vapor","<vapor>","1","0","","","","54336547","118712","118712","vapor","592","36204589","36204588"
"54389866","1","54408370","","2019-01-27 15:41:36","","4","304","<p>I am currently struggling with doing an upsert with vapor/fluent. I have a model something like this:</p>

<pre class=""lang-swift prettyprint-override""><code>struct DeviceToken: PostgreSQLModel {
    var id: Int?
    var token: String
    var updatedAt: Date = Date()

    init(id: Int? = nil, token: String, updatedAt: Date = Date()) {
        self.id = id
        self.token = token
        self.updatedAt = updatedAt
    }
}

struct Account: PostgreSQLModel {
    var id: Int?
    let username: String
    let service: String
    ...
    let deviceTokenId: DeviceToken.ID

    init(id: Int? = nil, service: String, username: String, ..., deviceTokenId: DeviceToken.ID) {
        self.id = id
        self.username = username
        ....
        self.deviceTokenId = deviceTokenId
    }
}
</code></pre>

<p>From the client something like</p>

<pre><code>{
    ""deviceToken"": {
        ""token"": ""ab123"",
        ""updatedAt"": ""01-01-2019 10:10:10""
    },
    ""account"": {
        ""username"": ""user1"",
        ""service"": ""some service""
    }
}
</code></pre>

<p>is send.</p>

<p>What I'd like to do is to insert the new models if they do not exist else update them. I saw the <code>create(orUpdate:)</code> method however this will only update if the id is the same (in my understanding). Since the client does not send the id i am not quite sure how to handle this. </p>

<p>Also I can't decode the model since the account is send without the <code>deviceTokenId</code> and therefore the decoding will fail. I guess I can address the latter problem by overriding <code>NodeCovertible</code> or by using two different models (one for decoding the json without the id and the actual model from above). However the first problem still remains. </p>

<p>What I exactly want to do is:</p>

<ol>
<li><p>Update a DeviceToken if an entry with token already exists else create it</p></li>
<li><p>If an account with the combination of username and service already exists update its username, service and deviceTokenId else create it. DeviceTokenId is the id returned from 1.</p></li>
</ol>

<p>Any chance you can help me out here ? </p>
","720133","","","","","2019-01-28 19:00:21","Using vapor-fluent to upsert models","<swift><vapor><server-side-swift>","1","0","2","","","54389866","118712","118712","vapor","592","36204589","36204588"
"54600531","1","54603743","","2019-02-08 21:32:09","","2","324","<p>I'm coming from using tooling such as SuperTest with NodeJS and looking for relevant equivalents to support testing with Vapor 3 and server side swift.</p>

<p>I see a pattern of using making a testable application with Vapor 3 to do testing of endpoints, examples being <a href=""https://github.com/raywenderlich/vapor-til/blob/master/Tests/AppTests/Application%2BTestable.swift"" rel=""nofollow noreferrer"">https://github.com/raywenderlich/vapor-til/blob/master/Tests/AppTests/Application%2BTestable.swift</a> and the write-up at <a href=""https://medium.com/swift2go/vapor-3-series-iii-testing-b192be079c9e"" rel=""nofollow noreferrer"">https://medium.com/swift2go/vapor-3-series-iii-testing-b192be079c9e</a>.</p>

<p>When using these in tests, the format generally looks something like:</p>

<pre class=""lang-swift prettyprint-override""><code>func testGettingASingleUserFromTheAPI() throws {
    let user = try User.create(name: usersName, username: usersUsername, on: conn)
    let receivedUser = try app.getResponse(to: ""\(usersURI)\(user.id!)"", decodeTo: User.Public.self)

    XCTAssertEqual(receivedUser.name, usersName)
    XCTAssertEqual(receivedUser.username, usersUsername)
    XCTAssertEqual(receivedUser.id, user.id)
  }
</code></pre>

<p>(from <a href=""https://github.com/raywenderlich/vapor-til/blob/master/Tests/AppTests/UserTests.swift#L87-L94"" rel=""nofollow noreferrer"">Vapor-TIL example code</a>)</p>

<p>In all of these examples, the return values are really set to be handed back to something decodable (the <code>decodeTo:</code> kind of setup). In some cases in my Vapor 3 code, I want to just validate some non-JSON encoded results - just simple strings, and validate the results - but I've not found the methods to get into the content or convenient ways to validate it with XCTAssert.</p>

<p><code>response.content</code> is available, a container around the overall response (of type <a href=""https://api.vapor.codes/vapor/latest/Vapor/Structs/ContentContainer.html"" rel=""nofollow noreferrer"">ContentContainer</a>). Are there some examples or good ways at getting to the underlying content representation to validate them directly?</p>
","19477","","","","","2019-02-09 06:13:48","How to access the raw content from a response in Vapor 3 unit test?","<swift><vapor>","1","0","","","","54600531","118712","118712","vapor","592","36204589","36204588"
"54621070","1","","","2019-02-10 21:05:24","","1","170","<p>I've got a Vapor server app (hosted on Heroku), that connects to an external API service through a URLSession dataTask. </p>

<p>So far it has been working perfectly (and still works fine when ran locally on my Mac), but since last server restart the dataTask throws the following error every time: <code>URLError(_nsError: The operation could not be completed)</code>. </p>

<p>I've heard Swift on Linux had problems with URLSession in the past, but they were mostly resolved. Does anyone have any solution for this? Thank you!</p>

<p>Code:</p>

<pre><code>func foo(task: RepeatedTask) {

        // get request to ZTM API
        guard let client = try? app.client() else {
            return
        }
        var urlComponents = URLComponents(string: Globals.API_URL)!
        urlComponents.queryItems = [
            URLQueryItem(name: ""resource_id"", value: Globals.RESOURCE_ID),
            URLQueryItem(name: ""apikey"", value: Globals.API_KEY),
            URLQueryItem(name: ""type"", value: ""1"")]
        let url = urlComponents.url
        let response = client.get(url!)


        let tempModel = response.flatMap(to: Model.self) { response -&gt; EventLoopFuture&lt;Model&gt; in
            return try response.content.decode(Model.self)
            }.map(to: Model.self) { tempModel -&gt; Model in
                tempModel.busArray.forEach {
                    $0.vehicleID = $0.Lines! + $0.Brigade!
                    $0.angle = 0
                }
                if Globals.myModel.busArray.isEmpty {
                    Globals.myModel.busArray = tempModel.busArray
                } else {
                    // add &amp; remove buses
                    Globals.myModel.busArray.updateVehicleArray(using: tempModel.busArray)

                    // update coordinates + angle
                    Globals.myModel.busArray.updateCoordinates(using: tempModel.busArray)
                }
                return tempModel
        }
}
</code></pre>

<p>The url produced from <code>urlComponents</code> is <code>https://api.um.warszawa.pl/api/action/busestrams_get/?resource_id=f2e5503e-927d-4ad3-9500-4ab9e55deb59&amp;apikey=a86c68be-0117-4a88-838c-bcc2f6ba85f4&amp;type=1</code></p>
","10208284","","10208284","","2019-02-11 22:57:35","2019-02-11 22:57:35","URLError(_nsError: The operation could not be completed) error when trying to start dataTask","<swift><nsurlsession><vapor><urlsession>","0","3","1","","","54621070","118712","118712","vapor","592","36204589","36204588"
"54672314","1","54675283","","2019-02-13 14:16:44","","1","96","<p>I'm just getting started with programming and vapor and have the following querying problem.</p>

<p>When a user makes a request to /api/trip/new to create a new trip, I want to retrieve the first driver from the database and assign their ID to a Trip object. Then I want to save both the trip and trip request in the database.</p>

<p>I have the following code:</p>

<pre><code>func newTripHandler(_ req: Request, data: TripRequestCreateData) throws -&gt; Future&lt;TripRequest&gt; {
let passenger = try req.requireAuthenticated(Passenger.self)
let tripRequest = try TripRequest(pickupLat: data.pickupLat,
                                  pickupLng: data.pickupLng,
                                  destLat: data.destLat,
                                  destLng: data.destLng,
                                  pickupAddress: data.pickupAddress,
                                  destAddress: data.destAddress,
                                  passengerId: passenger.requireID())

//Passenger's location
let lat = tripRequest.pickupLat
let lng = tripRequest.pickupLng

//Passenger's destination
let toLat = tripRequest.destLat
let toLng = tripRequest.destLng

let trip = Trip(passengerId: tripRequest.passengerId!,
                pickupLat: lat,
                pickupLng: lng,
                destLat: toLat,
                destLng: toLng,
                pickupAddress: tripRequest.pickupAddress,
                destAddress: tripRequest.destAddress)

let driver = Driver.query(on: req).first().unwrap(or: Abort(.notFound))

let driverId = driver.map(to: Driver.self) { driver in
  return driver.id
}

trip.driverId = driverId

print(trip)

return tripRequest.save(on: req)
}

struct TripRequestCreateData: Content {
  let pickupLat: Double
  let pickupLng: Double
  let destLat: Double
  let destLng: Double
  let pickupAddress: String
  let destAddress: String
}
</code></pre>

<p>I’m not sure how to save two models and how to properly retrieve the driver from the database. The driverId constant is of type EventLoopFuture instead of Driver so I can't assign the ID to trip's driverId property. </p>

<p>How can I adjust my code to achieve this?</p>
","11042303","","9223839","","2019-02-13 16:56:38","2019-02-13 17:00:49","Problem saving two models and retrieving a record from the database with Fluent","<swift><vapor><fluent-orm>","1","0","","","","54672314","118712","118712","vapor","592","36204589","36204588"
"54692362","1","54697621","","2019-02-14 14:09:46","","1","93","<p>I'm new to software development in general, and I'm writing a backend for a simple ride-sharing iOS application (which I'll develop later). I'm using Vapor to create the backend. </p>

<p>When a user makes a trip request to the API, I want to create a new trip and establish a websocket session between the user and a driver. The problem I'm having is how can I notify a driver that a request is in and add him to the session? </p>

<p>Here's what I've come up with so far, although I'm not sure if it's going to work:</p>

<p>When a trip request comes in, I would create a session and a trip object with the session id. When a driver visits the ""Trip requests"" tab in the app he would make a get request to retrieve active trip requests. When he then clicks on one of the trip requests, he would make a request with the session id of that particular trip to be added to that session.</p>

<p>The problems I'm seeing with the above solution is that that would make the User the Poster, and the Driver the Observer, which I'm not sure is the way to go since I want the driver to act as a poster (to send location updates so that the user can track the driver on the map in real time). </p>

<p>Another problem is that users would have to wait indefinitely before a driver accepts their request.</p>

<p>Is there a better way to notify the driver of a trip request? How can I go about achieving this? </p>
","11042303","","","","","2019-02-14 19:18:21","How can I notify a client of a request initiated by another client with websocket?","<websocket><client-server><real-time><api-design><vapor>","1","0","","","","54692362","118712","118712","vapor","592","36204589","36204588"
"54695893","1","","","2019-02-14 17:22:30","","0","60","<p>Trying to deploy this repository to heoku using the deploy to heroku button.
<a href=""https://github.com/abdulkhaliq92/FaxServer"" rel=""nofollow noreferrer"">https://github.com/abdulkhaliq92/FaxServer</a>
I have a valid app.json file:</p>

<pre><code>{
    ""name"": ""FaxServer"",
    ""scripts"": {},
    ""env"": {},
    ""formation"": {},
    ""addons"": [],
    ""buildpacks"": [
        {
            ""url"": ""https://github.com/kylef/heroku-buildpack-swift""
        }
    ]
}
</code></pre>

<p>The following error occurs while deploying.</p>

<pre><code>Downloading swift-corelibs-libdispatch (swift-4.1-RELEASE)
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
     0 --:--:-- --:--:-- --:--:-- 1729k
Building Swift
This may take a very long time...
Building Swift failed
Check out the logfile for more information: /app/tmp/cache/swiftenv/tmp/swiftenv-build-4.1/swiftenv-build.20190214170118.272.log
You can inspect or delete the working tree at: /app/tmp/cache/swiftenv/tmp/swiftenv-build-4.1
 !     Push rejected, failed to compile Swift app.
 !     Push failed
</code></pre>

<p>EDIT:
Still getting the same error.
Here is the Package.swift file : <a href=""https://github.com/abdulkhaliq92/FaxServer/blob/master/Package.swift"" rel=""nofollow noreferrer"">https://github.com/abdulkhaliq92/FaxServer/blob/master/Package.swift</a></p>
","4080591","","4080591","","2019-02-16 15:33:43","2019-02-16 15:33:43","Having problem deploying github repository to heoku","<swift><mongodb><heroku><vapor>","0","4","1","","","54695893","118712","118712","vapor","592","36204589","36204588"
"54724090","1","54726811","","2019-02-16 14:27:06","","3","325","<p>I've two Models, Trip and Location. I would return a custom response with some field of trip and the number of Location that has the tripID equal to id of Trip. There is my code(not working). The field locationCount is always empty.</p>

<pre><code>func getList(_ request: Request)throws -&gt; Future&lt;Response&gt; {

    let deviceIdReq = request.parameters.values[0].value
    let queryTrips = Trip.query(on: request).filter(\.deviceId == deviceIdReq).all()
    var tripsR = [TripCustomContent]()
    var trips = [Trip]()

    return queryTrips.flatMap { (result) -&gt; (Future&lt;Response&gt;) in
        trips = result

        var count = 0
        for t in trips {
            let tripIdString = String(t.id!)
            let v = Location.query(on: request).filter(\.tripID == tripIdString).count().map({ (res) -&gt; Int in
                return res
            })/*.map{ (result) -&gt; (Int) in
             count = result
             return result
             }*/
            let tripCustomContent = TripCustomContent.init(startTimestamp: t.startTimestamp, endTimestamp: t.endTimestamp, deviceId: t.deviceId, locationCount: v)
            tripsR.append(tripCustomContent)
        }
        let jsonEncoder = JSONEncoder()
        let data = try jsonEncoder.encode(tripsR)
        let response = HTTPResponse.init(status: .ok, version: HTTPVersion.init(major: x, minor: y), headers: HTTPHeaders.init(), body: data)
        let finalResponse = Response.init(http: response, using: request)
        return try g.encode(for: request)
    }
}
</code></pre>

<p>and this is my custom content struct:</p>

<pre><code>struct TripCustomContent: Encodable {
var startTimestamp: String?
var endTimestamp: String?
var deviceId: String
var locationCount: Future&lt;Int&gt;
}
</code></pre>

<p>any suggestions?</p>
","6761616","","","","","2019-02-16 22:05:31","Swift Vapor add additional info to custom response","<swift><vapor>","1","0","","","","54724090","118712","118712","vapor","592","36204589","36204588"
"54765084","1","54775755","","2019-02-19 11:19:23","","2","231","<p>I'm very new to Vapor and server-side swift, with a background in iOS development (6 years developing apps). I'm trying to build a simple API for device management which amongst other things includes a ""job"" (Timer whatever you want to call it) which checks every hour or so for the last time a device ""Checked In"".</p>

<p>To do this I've setup the Jobs package, however I'm struggling to work out how I can access a service (<a href=""https://github.com/vapor-community/ferno"" rel=""nofollow noreferrer"">Ferno</a>) to hit my Firebase Realtime database to get info about when devices last logged in. It seems that according to the docs you need an implementer of <code>Container</code> to create/access a <code>Service</code> but there doesn't seem to be any kind of global container I can use.</p>

<p>Should I be attempting to create my own <code>Request</code> just to access a <code>Ferno</code> service? Or is there a way I can access the global <code>app</code>?</p>

<p>The below is what I have so far, but what I'm doing seems horribly wrong! Surely there must be a way to achieve this?</p>

<pre><code>Jobs.add(interval: (60*30).seconds) { [weak devicesController] in
    devicesController?.checkForNotSeenDevices()
}
</code></pre>

<pre><code>func checkForNotSeenDevices() throws {

    let client = try app(.detect()).make(FernoClient.self)
    client.ferno.retrieve(req: ???, queryItems: [], appendedPath: [""devices""])
}
</code></pre>
","1155032","","","","","2019-02-20 10:33:22","Access a service from a Job in Vapor 3","<swift><client-server><vapor><server-side-swift>","2","0","","","","54765084","118712","118712","vapor","592","36204589","36204588"
"54789587","1","54792154","","2019-02-20 15:14:55","","2","239","<p>I've forked a server-side swift package for Firebase realtime db connectivity: <a href=""https://github.com/vapor-community/ferno"" rel=""nofollow noreferrer"">ferno</a> and I'm trying to use it as a dependency in my <code>Package.swift</code> like so:</p>

<pre><code>.package(url: ""git@github.com:3sidedcube/ferno.git"", .branch(""jwt3"")),
</code></pre>

<p>however when running <code>vapor xcode</code> I get an error like so:</p>

<pre><code>Error: Could not generate Xcode project: Completed resolution in 8.33s
error: terminated(128): git -C /Users/simonmitchell/Coding/Device-Monitor/.build/checkouts/ferno.git--4002215034454709000 checkout -f 155fa23f2f2d985dbee20072e560b095f61d7b63 output:
</code></pre>

<p>I've checked the docs for swift packages and this should all be kosher, so why isn't it working? Is this a limitation of swift package manager? Or of Vapor?</p>
","1155032","","3103448","","2019-02-20 17:30:48","2019-05-15 16:36:37","Using a forked swift package as a dependency for Vapor project","<swift><git><vapor><swift-package-manager>","2","3","","","","54789587","118712","118712","vapor","592","36204589","36204588"
"54875500","1","","","2019-02-25 22:13:03","","0","77","<p>I'm starting to use Vapor (the server-side Swift framework) and I saw the driver named Theo made for Vapor. But I am wondering how I would  deploy a project with Theo into Vapor Cloud 2? Does Vapor Cloud 2 support it?</p>

<p><strong>Update:</strong>
Here's the link for Theo 5.0 from Neo4j: <a href=""https://github.com/Neo4j-Swift/Neo4j-Swift"" rel=""nofollow noreferrer"">https://github.com/Neo4j-Swift/Neo4j-Swift</a></p>
","5573179","","5573179","","2019-09-04 01:11:21","2019-09-04 01:11:21","Deploy a project with Theo into Vapor cloud v2","<neo4j><vapor><vapor-cloud>","1","1","","","","54875500","118712","118712","vapor","592","36204589","36204588"
"54894342","1","54895086","","2019-02-26 21:25:09","","4","446","<p>I'm struggling with understanding how to perform a batch save of fetched objects and store them to the database. After I have stored the objects to the database I want to return the result of a query. 
I can't understand how to do this with EventLoopFuture since when I call <code>.wait()</code> I get the error message:</p>

<blockquote>
  <p>Precondition failed: BUG DETECTED: wait() must not be called when on an EventLoop.</p>
</blockquote>

<p>As an example of my problem:</p>

<ul>
<li>I need to fetch an entity from an external endpoint (let's say flights for an airport)</li>
<li>The result of that call needs to be saved to a database. If the flight exists in the database, it needs to be updated otherwise created.</li>
<li>When completed, a list of all the flights in from the database needs to be returned.</li>
</ul>

<p>This is what I got so far, but which gives me the bug:</p>

<pre><code>func flights(on conn: DatabaseConnectable, customerName: String, flightType: FlightType) throws -&gt; Future&lt;[Flight]&gt; {

    return Airport.query(on: conn).filter(\.customerName == customerName).first().flatMap(to: [Flight].self) { airport in
      guard let airport = airport else {
        throw Abort(.notFound)
      }

      guard let airportId = airport.id else {
        throw Abort(.internalServerError)
      }

      // Update items for customer
      let fetcher: AirportManaging?

      switch customerName.lowercased() {
      case ""coolCustomer"":
        fetcher = StoreOneFetcher()
      default:
        fetcher = nil
        debugPrint(""Unhandled customer to fetch from!"")
        // Do nothing
      }

      let completion = Flight.query(on: conn).filter(\.airportId == airportId).filter(\.flightType == flightType).all

      guard let flightFetcher = fetcher else { // No customer fetcher to get from, but still return whats in the DB
        return completion()
      }

      return try flightFetcher.fetchDataForAirport(customerName, on: conn).then({ (flights) -&gt; EventLoopFuture&lt;[Flight]&gt; in
        flights.forEach { flight in
          _ = try? self.storeOrUpdateFlightRecord(flight, airport: airport, on: conn).wait()
        }
        return completion()
      })
    }
  }

  func storeOrUpdateFlightRecord(_ flight: FetcherFlight, airport: Airport, on conn: DatabaseConnectable) throws -&gt; EventLoopFuture&lt;Flight&gt; {
    guard let airportId = airport.id else {
      throw Abort(.internalServerError)
    }

    return Flight.query(on: conn).filter(\.itemName == flight.itemName).filter(\.airportId == airportId).filter(\.flightType == flight.type).all().flatMap(to: Flight.self) { flights in
      if let firstFlight = flights.first {
        debugPrint(""Found flight in database, updating..."")
        return flight.toFlight(forAirport: airport).save(on: conn)
      }

      debugPrint(""Did not find flight, saving new..."")
      return flight.toFlight(forAirport: airport).save(on: conn)
    }
  }
</code></pre>

<p>So the problem in on line <code>_ = try? self.storeOrUpdateFlightRecord(flight, airport: airport, on: conn).wait()</code>. I can't call <code>wait()</code> since it'll block the eventLoop but if I call <code>map</code> or <code>flatMap</code> I need in turn return an <code>EventLoopFuture&lt;U&gt;</code> (<code>U</code> being <code>Flight</code>), which I am totally uninterested in. </p>

<p>I want <code>self.storeOrUpdateFlightRecord</code> to be called and the result ignored. How can I do that?</p>
","406677","","406677","","2019-02-27 20:17:11","2019-02-27 20:17:11","Vapor 3: Eventloop bug detected when using wait()","<swift><future><event-loop><vapor><vapor-fluent>","1","0","","","","54894342","118712","118712","vapor","592","36204589","36204588"
"54921390","1","54932613","","2019-02-28 08:34:02","","-1","292","<p>i noticed a very bad performance of Fluent when i run a query written in Swift in Vapor. When i run a raw query in this way: </p>

<pre><code> SELECT *  FROM ""Model""
</code></pre>

<p>the time of response is about 20-30 ms. If i run the query in this way: </p>

<pre><code>Model.query(on: request).all()
</code></pre>

<p>the time of response is increased tenfold. Why? What's the problem? </p>
","6761616","","","","","2019-02-28 19:06:49","Vapor Swift Fluent very very slow query","<swift><api><backend><vapor>","1","7","","","","54921390","118712","118712","vapor","592","36204589","36204588"
"54951788","1","54953920","","2019-03-01 20:24:11","","3","106","<p>I have a controller using a get handler that returns a <code>Future&lt;Content&gt;</code>. I would like to add a header to the response (Cache-Control to be specific). I was thinking that it should be easy but I'm not finding how to do it. Which would be the way to add a header in this case? When we are working with <code>Content</code> instead of <code>Response</code></p>
","896118","","","","","2019-03-02 00:03:09","How to add a header to a Vapor response (Cache-Control)","<vapor>","1","0","","","","54951788","118712","118712","vapor","592","36204589","36204588"
"54969009","1","","","2019-03-03 12:53:42","","2","372","<p>Using Vapor 3, is there an easy way to switch databases, while the server is running?</p>

<p>For example, a user logs in using the 'login' db. I then set 
the db for that user in their cookie. Any subsequent requests from that user then use the db identified in the cookie (the 'user' in this scenario would really be a company).</p>

<p>All db's would be from the same db family (eg MySQL). 
This would keep every companies data in their own db, and limit
the size of each db (and hopefully, overall, db operations would be faster).
Also, any need to restore a db would only impact one company, and backups would be simpler.</p>

<ol>
<li>How to achieve this?</li>
<li>Would this be very inefficient?</li>
</ol>

<p>Are there other better ways to achieve this?</p>
","361211","","","","","2019-03-03 21:48:52","Vapor 3: Using multiple databases","<database><vapor>","1","0","0","","","54969009","118712","118712","vapor","592","36204589","36204588"
"54998287","1","55022184","","2019-03-05 08:22:26","","1","184","<p>When I am saving my object to the database, it stores the id of the object with +10. The autoincrement for the table increments by default with 1. When I manually add something to the database, it'll increment with 1. </p>

<p>Am I missing (or my misstake, setting) a setting for FluentMySQL?</p>

<pre><code>  func storeOrUpdateItemRecord(_ item: FetcherItem, store: Store, on conn: DatabaseConnectable) throws -&gt; EventLoopFuture&lt;Item&gt; {
    guard let storeId = store.id else {
      throw Abort(.internalServerError)
    }

    let calendar = Calendar.current
    let fromDate = calendar.startOfDay(for: Date())
    guard let endDate = calendar.date(bySettingHour: 23, minute: 59, second: 59, of: Date()) else { throw Abort(.internalServerError) }

    return Item.query(on: conn)
      // Bunch of filters
      .filter(\.scheduledDate &lt; endDate)
      .all()
      .flatMap(to: Flight.self) { flights in
        if var firstItem = flights.first {
          debugPrint(""Found item, updating..."")
          // Update a bunch of values
          return firstItem.save(on: conn)
        }

        debugPrint(""Did not find item, saving new..."")
        return item.toItem(forStore: store).save(on: conn)
    }
  }
</code></pre>

<p>The <code>toItem</code> func does nothing more then initiate a new <code>Item</code>:</p>

<pre><code>extension FetcherItem {

  func toItem(forStore store: Store) -&gt; Item {
    return Item.init(
      id: nil,
      // Set a bunch of values
      actualDate: actualDateTime)
  }
}
</code></pre>

<p>As you can see, the <code>id</code> is set to <code>nil</code>... which I would guess should store using <code>null</code> while making the insert query. </p>

<p>The result in the database:</p>

<p><a href=""https://i.stack.imgur.com/f89Dn.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/f89Dn.png"" alt=""MySQL db result""></a></p>

<p>What am I missing?</p>

<p><em>Update</em>:
After following suggestions from <a href=""https://stackoverflow.com/questions/53023892/how-do-i-log-sql-statements-in-vapor-3-fluent"">this page</a> I've added logging for the queries... and they seem to work as they should.
Example of what fluent runs for query:</p>

<pre><code>[mysql] [2019-03-06 08:49:44 +0000] INSERT INTO `Items` (`company`, `name`, `storeId`, [...] `scheduledDate`) VALUES (?, ?, ?, ?, ?, ?, ?, ?) [string(""A company""), string(""abc123""), integer8(1), [...] time(2019-3-6 16:25:0.0)]
</code></pre>

<p>As you can see, it doesn't set the <code>id</code> in any way. Maybe a MySQL problem?</p>
","406677","","406677","","2019-03-06 09:51:22","2019-03-06 11:36:21","Vapor 3 Fluent MySQL: save on model adds 10 to auto_increment","<mysql><swift><vapor><vapor-fluent>","1","0","","","","54998287","118712","118712","vapor","592","36204589","36204588"
"55002304","1","","","2019-03-05 11:55:41","","0","28","<p>For serverside swift i am using vapor.</p>

<p><strong>Error on main.swift:</strong>
Thread 1: </p>

<blockquote>
  <p>Fatal error: Error raised at top level:
  VaporS3Signer.Provider.S3ProviderError.config(""no vapor-S3Signer.json
  config file"")</p>
</blockquote>

<p>log:</p>

<p>Fatal error: Error raised at top level: VaporS3Signer.Provider.S3ProviderError.config(""no vapor-S3Signer.json config file""): file /BuildRoot/Library/Caches/com.apple.xbs/Sources/swiftlang_Fall2018/swiftlang_Fall2018-1000.11.42/src/swift/stdlib/public/core/ErrorType.swift, line 191</p>

<p>My code(main.swift):</p>

<pre><code>import App


let config = try Config()
try config.setup()

let drop = try Droplet(config)
try drop.setup()

try drop.run()
</code></pre>

<p>When I am running the app in Xcode10.1 error is coming on app launch.</p>

<p><a href=""https://i.stack.imgur.com/c8FPD.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/c8FPD.png"" alt=""""></a></p>
","4395049","","","","","2019-03-05 11:55:41","Vapor app crashed on launching. VaporS3Signer.Provider.S3ProviderError.config(""no vapor-S3Signer.json config file"")","<vapor><xcode10.1><server-side-swift>","0","7","","","","55002304","118712","118712","vapor","592","36204589","36204588"
"55082828","1","55083065","","2019-03-09 23:02:20","","2","269","<p>I am brand new to the Vapor framework, and am trying to protect multiple routes. Basically, I want to make sure that all routes under <code>/campaigns/:id</code> can only be accessed if the user actually has access to that particular campaign with that ID. So that I can't just enter any ID into the url and access any campaign.</p>

<p>Now, instead of adding logic for this to every single route (already 6 so far), I figured I'd use a middleware for this. This is what I came up with so far, with the help of some friendly folk over at the Vapor Discord:</p>

<pre class=""lang-swift prettyprint-override""><code>final class CampaignMiddleware: Middleware {
  func respond(to request: Request, chainingTo next: Responder) throws -&gt; EventLoopFuture&lt;Response&gt; {
    let user = try request.requireAuthenticated(User.self)
    return try request.parameters.next(Campaign.self).flatMap(to: Response.self) { campaign in
      guard try campaign.userID == user.requireID() else {
        throw Abort(.forbidden, reason: ""Campaign doesn't belong to you!"")
      }
      return try next.respond(to: request)
    }
  }
}

struct CampaignController: RouteCollection {
  func boot(router: Router) throws {
    let route = router.grouped(""campaigns"")

    let tokenAuthMiddleware = User.tokenAuthMiddleware()
    let guardMiddleware = User.guardAuthMiddleware()
    let tokenAuthGroup = route.grouped(tokenAuthMiddleware, guardMiddleware)

    tokenAuthGroup.get(use: getAllHandler)
    tokenAuthGroup.post(CampaignCreateData.self, use: createHandler)

    // Everything under /campaigns/:id/*, CampaignMiddleware makes sure that the campaign actually belongs to you
    let campaignRoute = tokenAuthGroup.grouped(Campaign.parameter)
    let campaignMiddleware = CampaignMiddleware()
    let protectedCampaignRoute = campaignRoute.grouped(campaignMiddleware)

    protectedCampaignRoute.get(use: getOneHandler)
    protectedCampaignRoute.delete(use: deleteHandler)
    protectedCampaignRoute.put(use: updateHandler)

    // Add /campaigns/:id/entries routes
    let entryController = EntryController()
    try protectedCampaignRoute.register(collection: entryController)
  }

  func getAllHandler(_ req: Request) throws -&gt; Future&lt;[Campaign]&gt; {
    let user = try req.requireAuthenticated(User.self)
    return try user.campaigns.query(on: req).all()
  }

  func getOneHandler(_ req: Request) throws -&gt; Future&lt;Campaign&gt; {
    return try req.parameters.next(Campaign.self)
  }

  // ...deleted some other route handlers...
}
</code></pre>

<p>The problem here is that the middleware is ""eating up"" the campaign parameter by doing <code>request.parameters.next(Campaign.self)</code>. So in <code>getOneHandler</code>, where it <em>also</em> tries to access <code>req.parameters.next(Campaign.self)</code>, it fails with error ""Insufficient parameters"". Which makes sense, since <code>.next</code> actually removes that param from the internal array of parameters.</p>

<p>Now, how can I write a middleware, that uses the parameter, without eating it up? Do I need to use the raw values and query the Campaign model myself? Or can I somehow reset the parameters after using <code>.next</code>? Or is there another better way to deal with model authorization in Vapor 3?</p>
","403425","","403425","","2019-03-10 09:20:33","2019-03-10 15:25:59","How to read a parameter in a Vapor middleware without consuming it","<vapor><server-side-swift>","1","0","","","","55082828","118712","118712","vapor","592","36204589","36204588"
"55089886","1","55090130","","2019-03-10 16:32:11","","3","523","<p>I have a model Campaign, that has multiple Months:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Campaign: Content, SQLiteModel {
  var id: Int?
  var name: String
  var months: Children&lt;Campaign, Month&gt; {
    return children(\.campaignID)
  }
}
</code></pre>

<p>When I want to return a Campaign in the most basic way, it doesn't include the Months, as computed properties are not Codable as I understand.</p>

<pre class=""lang-swift prettyprint-override""><code>func getOneHandler(_ req: Request) throws -&gt; Future&lt;Campaign&gt; {
  return try req.parameters.next(Campaign.self)
}
</code></pre>

<p>So, I made a new struct to hold the full object I want to return</p>

<pre class=""lang-swift prettyprint-override""><code>struct FullCampaignData: Content {
  let id: Int
  let name: String
  var months: [Month]?
}
</code></pre>

<p>And then modified my route handler like this:</p>

<pre class=""lang-swift prettyprint-override""><code>func getOneHandler(_ req: Request) throws -&gt; Future&lt;FullCampaignData&gt; {
  return try req.parameters.next(Campaign.self).flatMap(to: FullCampaignData.self) { campaign in
    return try campaign.months.query(on: req).all().map(to: FullCampaignData.self) { months in
      return try FullCampaignData(id: campaign.requireID(), name: campaign.name, months: months)
    }
  }
}
</code></pre>

<p>This does work. However, it seems like a lot of work and a lot of boilerplate to do this. What's the normal Swifty ""Vapory"" way to deal with child objects, or other computed objects in general? Right now it seems to come down to a bunch of different versions of your models (for creation, for returning, the actual full internal one) and then converting between them, but I am hoping there is something I am missing here? Because it's so easy to forget to add a newly added model property also to that special public model. </p>

<p>Or at the very least, if converting between models in indeed the recommended way, is there a way doesn't need all these nested maps/flatmaps in the route handler?</p>
","403425","","","","","2019-03-10 16:56:53","Vapor 3: when returning a model, how to easily also return child objects","<swift><vapor><vapor-fluent>","1","2","","","","55089886","118712","118712","vapor","592","36204589","36204588"
"55109757","1","","","2019-03-11 20:19:18","","2","104","<p>Is it possible to subclass models and inherit the superclass's properties
so in the end I have the models:</p>

<p>class User 
<br>
- class Student : User
<br>
- class Teacher : User</p>

<p><br>
<br>
With the intention of creating this: <a href=""https://ryanbigg.com/2008/09/multiple-user-access-levels"" rel=""nofollow noreferrer"">https://ryanbigg.com/2008/09/multiple-user-access-levels</a></p>
","8513575","","8513575","","2019-03-11 20:27:55","2019-03-11 20:40:10","Server Side Swift Vapor - Model inheritance","<swift><vapor><server-side-swift>","1","3","","","","55109757","118712","118712","vapor","592","36204589","36204588"
"55131593","1","55131794","","2019-03-12 22:31:01","","6","238","<p>I want to upload multiple images in one POST request. Currently, the part of my request related to the file upload is taking one file and looks like this:</p>

<pre><code>return try req.content.decode(File.self).flatMap(to: Image.self) { (file) in
    try file.data.write(to: URL(fileURLWithPath: DirectoryConfig.detect().workDir + localImageStorage + file.filename))
    return try Image(userID: user.requireID(), url: imageStorage + file.filename, filename: file.filename).save(on: req)
}
</code></pre>

<p>This works just fine. Now, I tried to change <code>.decode(File.self)</code> to <code>.decode([File].self)</code>, and do a loop for all files.<br>
When trying to upload images using the <code>data[]</code> parameter in Postman, I get the following error:</p>

<blockquote>
  <p>Nested form-data decoding is not supported.</p>
</blockquote>

<p>How do I solve this?</p>
","3397217","","","","","2019-03-12 23:18:54","Vapor upload multiple files at once","<swift><file-upload><vapor>","1","1","2","","","55131593","118712","118712","vapor","592","36204589","36204588"
"55172907","1","55183318","","2019-03-14 22:23:19","","1","640","<p>In my Vapor 3 app, I have an <code>Event</code> model, which has the properties <code>startDate: Date</code> and <code>endDate: Date</code>.<br>
Now, I'm wondering how to pass those date values in a POST request. In Postman, I tried the following in <code>x-www-form-urlencoded</code>:</p>

<pre><code>startDate -&gt; 2019-03-14
</code></pre>

<p>This returns the error below:</p>

<blockquote>
  <p>Could not convert to <code>Double</code>: str(\""2019-03-14\"")</p>
</blockquote>

<p>Apparently, <code>Date</code> turns into <code>Double</code>.<br>
So, instead, what value do I need to pass?</p>

<hr>

<h3>Note</h3>

<p>I know, that, in Postman, I can insert <code>{{$timestamp}}</code>, but 1) this doesn't answer my question when using the API outside Postman and 2) this doesn't allow me to enter a date other than <em>now</em>.</p>
","3397217","","3397217","","2019-03-14 22:28:44","2019-03-15 15:14:13","Vapor pass date parameter","<swift><date><vapor>","2","3","","","","55172907","118712","118712","vapor","592","36204589","36204588"
"55201301","1","55241302","","2019-03-16 20:41:42","","3","219","<p>I have a <code>User</code> model which I want to add a <code>friends</code> property to. Friends, are supposed to be other <code>User</code>s.</p>

<p>I created the <code>UserFriendsPivot</code>:</p>

<pre><code>final class UserFriendsPivot: MySQLPivot, ModifiablePivot {
    var id: Int?
    var userID: User.ID
    var friendID: User.ID

    typealias Left = User
    typealias Right = User

    static var leftIDKey: WritableKeyPath&lt;UserFriendsPivot, Int&gt; {
        return \.userID
    }

    static var rightIDKey: WritableKeyPath&lt;UserFriendsPivot, Int&gt; {
        return \.friendID
    }

    init(_ user: User, _ friend: User) throws {
        self.userID   = try user  .requireID()
        self.friendID = try friend.requireID()
    }
}

extension UserFriendsPivot: Migration {
    public static var entity: String {
        return ""user_friends""
    }
}
</code></pre>

<p>I added the <code>friends</code> property to <code>User</code>:</p>

<pre><code>var friends: Siblings&lt;User, User, UserFriendsPivot&gt; {
    return siblings()
}
</code></pre>

<p>Now, I'm seeing the following error on the line with <code>return siblings()</code>:</p>

<blockquote>
  <p>Ambiguous use of 'siblings(related:through:)'</p>
</blockquote>

<p>I tried to replace it with:</p>

<pre><code>return siblings(related: User.self, through: UserFriendsPivot.self)
</code></pre>

<p>...without any luck.</p>

<p>I know that the two code snippets <em>should</em> work, because I straight-up copied them from another siblings relationship I built between <code>Event</code> and <code>User</code> that is working just fine.<br>
The only difference I'm seeing is that I'm trying to build a relationship between the same models.</p>

<p>What can I do?</p>
","3397217","","","","","2019-03-19 12:40:16","Siblings relationship between same models in Vapor","<swift><relationship><vapor>","2","0","","","","55201301","118712","118712","vapor","592","36204589","36204588"
"55205247","1","55205248","","2019-03-17 08:35:38","","2","475","<p>I'm seeing the following error when trying to run my Vapor 3 application:</p>

<blockquote>
  <p>Thread 1: Fatal error: Error raised at top level: NIO.ChannelError.connectFailed(NIO.NIOConnectionError(host: ""127.0.0.1"", port: 3306, dnsAError: nil, dnsAAAAError: nil, connectionErrors: [NIO.SingleConnectionFailure(target: [IPv4]127.0.0.1/127.0.0.1:3306, error: connection reset (error set): Connection refused (errno: 61))]))</p>
</blockquote>

<p>It used to work just fine.<br>
What can I do?</p>
","3397217","","","","","2019-03-17 08:43:25","Vapor Connection refused (errno 61)","<swift><vapor>","1","0","","","","55205247","118712","118712","vapor","592","36204589","36204588"
"55245418","1","55246094","","2019-03-19 16:09:05","","7","1652","<p>How do you send an API request in Vapor 3 with the <code>HTTPRequest</code> struct?</p>

<p>I tried variations of the following code..</p>

<pre><code>var headers: HTTPHeaders = .init()
let body = HTTPBody(string: a)            
let httpReq = HTTPRequest(
    method: .POST,
    url: URL(string: ""/post"")!,
    headers: headers,
    body: body)

let httpRes: EventLoopFuture&lt;HTTPResponse&gt; = HTTPClient.connect(hostname: ""httpbin.org"", on: req).map(to: HTTPResponse.self) { client in
    return client.send(httpReq)
}
</code></pre>

<p>The compile error <code>Cannot convert value of type '(HTTPClient) -&gt; EventLoopFuture&lt;HTTPResponse&gt;' to expected argument type '(HTTPClient) -&gt; _'</code></p>

<p>I have tried other variations of code that worked.</p>

<p><a href=""https://stackoverflow.com/questions/48589415/vapor-3-beta-example-endpoint-request"">Vapor 3 Beta Example Endpoint Request</a></p>

<pre><code>let client = try req.make(Client.self)

let response: Future&lt;Response&gt; = client.get(""http://example.vapor.codes/json"")
</code></pre>

<p>I read and re-read:</p>

<ul>
<li><a href=""https://api.vapor.codes/http/latest/HTTP/Structs/HTTPRequest.html"" rel=""noreferrer"">https://api.vapor.codes/http/latest/HTTP/Structs/HTTPRequest.html</a></li>
<li><a href=""https://api.vapor.codes/http/latest/HTTP/Classes/HTTPClient.html"" rel=""noreferrer"">https://api.vapor.codes/http/latest/HTTP/Classes/HTTPClient.html</a></li>
<li><a href=""https://docs.vapor.codes/3.0/http/client/"" rel=""noreferrer"">https://docs.vapor.codes/3.0/http/client/</a></li>
</ul>
","5562045","","","","","2019-03-22 07:50:37","Vapor 3 - send a HTTPRequest","<vapor><server-side-swift>","2","2","1","","","55245418","118712","118712","vapor","592","36204589","36204588"
"55275018","1","55277971","","2019-03-21 06:39:59","","1","280","<p>How to use fluent-mysql to join query and limit query in Vapor 3? eg:</p>

<p><code>SELECT a.*, b.* ON a.id = b.aid LIMIT 0,10</code></p>

<p>I am not find such examples and documents.</p>
","10898359","","452584","","2019-03-21 15:09:35","2019-03-21 15:09:35","vapor 3 fluent-mysql join query","<vapor><vapor-fluent><fluent-mysql>","1","3","1","","","55275018","118712","118712","vapor","592","36204589","36204588"
"55277823","1","","","2019-03-21 10:00:14","","1","297","<p>I'd like to make a custom leaf page when I get 404 in Vapor 3.1.0. I've searched the web for it and even in the docs, I couldn't find out.
How could I do it?</p>

<p>Thank you 😊</p>
","11169590","","","","","2019-03-21 21:35:11","making custom 404 page Vapor 3","<swift><vapor><leaf>","1","1","","","","55277823","118712","118712","vapor","592","36204589","36204588"
"55282303","1","55283560","","2019-03-21 14:07:22","","2","511","<p>I tried to make the most basic example that I could think of for my problem. I have a <code>Course</code> model and a many-to-many table to <code>User</code> that also stores some extra properties (the <code>progress</code> in the example below).</p>

<pre class=""lang-swift prettyprint-override""><code>import FluentPostgreSQL
import Vapor

final class Course: Codable, PostgreSQLModel {
  var id: Int?
  var name: String
  var teacherId: User.ID

  var teacher: Parent&lt;Course, User&gt; {
    return parent(\.teacherId)
  }

  init(name: String, teacherId: User.ID) {
    self.name = name
    self.teacherId = teacherId
  }
}

struct CourseUser: Pivot, PostgreSQLModel {
  typealias Left = Course
  typealias Right = User

  static var leftIDKey: LeftIDKey = \.courseID
  static var rightIDKey: RightIDKey = \.userID

  var id: Int?
  var courseID: Int
  var userID: UUID
  var progress: Int

  var user: Parent&lt;CourseUser, User&gt; {
    return parent(\.userID)
  }
}
</code></pre>

<p>Now, when I return a <code>Course</code> object, I want the JSON output to be something like this:</p>

<pre><code>{
  ""id"": 1,
  ""name"": ""Course 1"",
  ""teacher"": {""name"": ""Mr. Teacher""},
  ""students"": [
    {""user"": {""name"": ""Student 1""}, progress: 10},
    {""user"": {""name"": ""Student 2""}, progress: 60},
  ]
}
</code></pre>

<p>Instead of what I would normally get, which is this:</p>

<pre><code>{
  ""id"": 1,
  ""name"": ""Course 1"",
  ""teacherID"": 1,
}
</code></pre>

<p>So I created some extra models and a function to translate between them:</p>

<pre class=""lang-swift prettyprint-override""><code>struct PublicCourseData: Content {
  var id: Int?
  let name: String
  let teacher: User
  let students: [Student]?
}

struct Student: Content {
  let user: User
  let progress: Int
}

extension Course {
  func convertToPublicCourseData(req: Request) throws -&gt; Future&lt;PublicCourseData&gt; {
    let teacherQuery = self.teacher.get(on: req)
    let studentsQuery = try CourseUser.query(on: req).filter(\.courseID == self.requireID()).all()

    return map(to: PublicCourseData.self, teacherQuery, studentsQuery) { (teacher, students) in
      return try PublicCourseData(id: self.requireID(),
                                  name: self.name,
                                  teacher: teacher,
                                  students: nil) // &lt;- students is the wrong type!
    }
  }
}
</code></pre>

<p>Now, I am <em>almost</em> there, but I am not able to convert <code>studentsQuery</code> from <code>EventLoopFuture&lt;[CourseUser]&gt;</code> to <code>EventLoopFuture&lt;[Student]&gt;</code>. I tried multiple combinations of <code>map</code> and <code>flatMap</code>, but I can't figure out how to translate an array of Futures to an array of different Futures.</p>
","403425","","403425","","2019-03-21 14:29:12","2019-03-21 16:48:28","Vapor 3: transform array of Future object to an array of Future other objects","<vapor><vapor-fluent>","1","0","","","","55282303","118712","118712","vapor","592","36204589","36204588"
"55284584","1","","","2019-03-21 16:01:01","","1","881","<p>I am trying to figure out how to wait for multiple Futures to complete.
I know how to asynchronously wait for them with: 
<code>summaryFuture.whenSuccess {}</code> but that just handles one case. I need to wait for both summaryFuture and sponsorFuture to finish, then work with both before sending back a Response.</p>

<pre><code>  let summaryFuture = client.post(summaryURL) { post in
        post.http.headers.add(name: ""authtoken"", value: token)
        }.flatMap(to: SummaryModel.self) { (response) in
            return try response.content.decode(SummaryModel.self)
    }

  let sponsorEnrollerFuture = client.post(sponsporEnroller) { post in
        post.http.headers.add(name: ""authtoken"", value: token)
        }.flatMap(to: SponsorEnrollerModel.self) { (response) in
            return try response.content.decode(SponsorEnrollerModel.self)
    }
</code></pre>
","6942360","","","","","2019-03-21 16:27:46","How to wait for multiple futures to complete in Vapor Swift?","<swift><xcode><vapor>","2","0","","","","55284584","118712","118712","vapor","592","36204589","36204588"
"55297389","1","","","2019-03-22 10:15:26","","1","245","<pre class=""lang-swift prettyprint-override""><code>let param = uploadObject
do {
    return try req.make(Client.self)
        .post(""https://up-z2.quiniup.com"", 
            headers: HTTPHeaders([(""ContentType"",""multipart/form-data"")]),
            beforeSend: { (post) in
                try post.content.encode(param)
        })
} catch {
    throw Abort(.internServerError, reason: ""Unable to upload file to quiniu.com.
        Underlying error \(error)"")
}
</code></pre>

<p>I want to upload file via third party API. Call it in a request I get an error:</p>

<blockquote>
  <p>SecTaskLoadEntitlements failed error=22 cs_flags=20, pid=12915</p>
</blockquote>

<p>Can anyone help me ?</p>
","6343270","","3103448","","2019-03-22 17:48:51","2019-03-22 17:48:51","what wrong with SecTaskLoadEntitlements failed error","<macos><vapor>","0","0","","","","55297389","118712","118712","vapor","592","36204589","36204588"
"55308678","1","55319299","","2019-03-22 22:38:26","","1","237","<p>In my backend, I have <code>Post</code>s and a <code>PostController</code>. A post may be <code>visibleToFriendOnly</code>.<br>
In <code>GET /posts</code>, I want to return all posts that the current user is allowed to see.<br>
The <code>User</code> model has a <code>friends</code> property, that is a pivot of <code>User, User</code> with the columns <code>userID</code> and <code>friendID</code>.</p>

<p>I currently get posts like this:</p>

<pre><code>/// /posts
func all(req: Request) throws -&gt; Future&lt;[Post]&gt; {
    let authenticated = try req.requireAuthenticated(User.self)
    return Post.query(on: req)
        .filter(\Post.visibleForUserType == authenticated.type)
        // FIXME: respect .visibleForFriendsOnly
        .all()
}
</code></pre>

<p>I'm having a hard time with this because for each <code>Post</code>, I'd have to get the <code>userID</code> and then the <code>User</code> (who is the author) and then query the user's <code>friends</code> and see whether the current user is in that list.<br>
Is there a feasible way of doing this? Maybe a join or something?</p>
","3397217","","","","","2019-03-23 23:23:44","Combine multiple joins with filters in Vapor","<mysql><swift><join><vapor>","1","3","","","","55308678","118712","118712","vapor","592","36204589","36204588"
"55308735","1","","","2019-03-22 22:45:38","","0","68","<p>I would like to return a partial object in a response for another object type.</p>

<p>For example, I have a UserProfile model:</p>

<pre><code>  var id: Int?
  var email: String
  var firstName: String?
  var lastName: String?
</code></pre>

<p>and an Adult model:</p>

<pre><code>  var id: Int?
  var nickname: String
  var type: String
  var user: User.UserProfile
  var family: Family
</code></pre>

<p>Say I would like to return just the UserProfile's email address in the Adult response, what is the way to go about that?</p>

<p>I have tried an approach with child/parent relationships, where my Adult model is more like:</p>

<pre><code>  var id: Int?
  var nickname: String
  var type: String
  var user: User.ID
  var family: Family
</code></pre>

<p>..but then my response just contains an object ID, but I really want to return a partial (or even full in some cases) object.</p>

<p>Thanks in advance.</p>
","3551654","","","","","2019-03-23 20:28:05","Return partial object in Vapor 3","<swift><vapor>","1","0","","","","55308735","118712","118712","vapor","592","36204589","36204588"
"55316694","1","","","2019-03-23 17:51:58","","1","75","<pre><code>func loadBy(_ req: Request) throws -&gt; Future&lt;[News]&gt; {
    let parentId = try req.parameters.next(String.self)
    let parent = try self.findParentBy(req, parentId: parentId)
    var childNews: [News] = []

    let qq = parent.map(to: [News].self) { parentNews in
        for chilId in parentNews!.childIds {
            let ch = News.query(on: req).filter(\News.newsId == chilId).first().map(to: News?.self) { child in
                if let child = child {
                    childNews.append(child)
                }
                return child
            }
        }
        return childNews
    }

    return qq.flatMap(to: [News].self) { childNews in
        return childNews.map { news in
            Future.map(on: req) { news }
        }.flatten(on: req)
    }
}
</code></pre>

<p>returned before the values will be obtained</p>

<p>I would like to wait until the desired values are obtained and then return them</p>
","6805466","","","","","2019-03-23 20:10:57","Async execution in vapor. How to control the cycle for in","<swift><vapor>","1","2","","","","55316694","118712","118712","vapor","592","36204589","36204588"
"55383680","1","","","2019-03-27 17:53:58","","1","216","<p>I'm using <code>Vapor 3</code> and <code>FluentMySQL</code> for my new project and want to change maximum length of a field (<code>varchar(N)</code>) via migration. How can I do this?</p>

<p>I have a Model named <code>Word</code> in my project and one of its fields is <code>sourceIdentifier</code> that is <code>String</code> and have maximum length of 12. The model is something like this:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Word: MySQLModel {
    ...other properties

    var sourceIdentifier: String

    ...other properties
}
</code></pre>

<p>At the beginning, I thought 5 is enough for the field and used this code to create <code>Table</code> for this model:</p>

<pre class=""lang-swift prettyprint-override""><code>static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
    return MySQLDatabase.create(Word.self, on: conn) { builder in
        ...other fields...

        builder.field(for: \.sourceIdentifier, type: .varchar(5, characterSet: nil, collate: nil))

        ...other fields...
    }
}
</code></pre>

<p>As you see above, the table created with field <code>sourceIdentifier</code> and its type is <code>.varchar(5, characterSet: nil, collate: nil)</code>.</p>

<p>Now I want to increase maximum length of the field via migration. </p>

<p>I also tried <code>MySQLDatabase.update</code> like this:</p>

<pre class=""lang-swift prettyprint-override""><code>static func prepare(on conn: MySQLConnection) -&gt; Future&lt;Void&gt; {
    return MySQLDatabase.update(Word.self, on: conn) { builder in
        builder.field(for: \.sourceIdentifier, type: .varchar(12, characterSet: nil, collate: nil))
    }
}
</code></pre>

<p>and it didn't work; Nothing happened.</p>

<p>How can I change structure of the table via <code>Vapor</code>, <code>FluentMySQL</code> and migrations?</p>
","2894482","","","","","2020-02-12 08:11:53","Change a VARCHAR field via migration in Vapor Fluent-MySQL","<swift><vapor><vapor-fluent><fluent-mysql>","2","0","","","","55383680","118712","118712","vapor","592","36204589","36204588"
"55472136","1","55472627","","2019-04-02 10:09:07","","0","188","<p>I have developed an iOS App and would like to create a web API with some parts of my code. This API will send an UIImage generated from a UIView.
The problem I have with Vapor is that I only managed to use AppKit, not UIKit. Certainly because the Xcode project with Vapor is a MacOS project.
Is there a way to use UIKit or iOS Swift code with Vapor or any other solutions like Kitura ???</p>

<p>Thanks for your help :)</p>

<p>Regards,</p>
","5864646","","","","","2019-04-02 10:33:39","Use UIKit with Vapor or Kitura","<swift><server-side><vapor><kitura>","1","1","","","","55472136","118712","118712","vapor","592","36204589","36204588"
"55500917","1","55504217","","2019-04-03 17:25:40","","5","491","<p>Currently building a package to test some devOps configurations with AWS. Building an application with Swift Vapor3, PostgreSQL 11, Docker. Given my <a href=""https://github.com/marcusjwhelan/swiftDevOpsTester"" rel=""nofollow noreferrer"">github Repo</a> the project builds/tests/runs just fine with <code>vapor build</code> <code>vapor test</code> <code>vapor run</code> given that you have a local installation of postgresql installed with a <code>username: test, password: test</code></p>

<p>However my api is not connecting to my DB and am worried my configuration is wrong.</p>

<pre><code>version: ""3.5""
services:
  api:
    container_name: vapor_it_container
    build:
      context: .
      dockerfile: web.Dockerfile
    image: api:dev
    networks:
      - vapor-it
    environment:
      POSTGRES_PASSWORD: 'test'
      POSTGRES_DB: 'test'
      POSTGRES_USER: 'test'
      POSTGRES_HOST: db
      POSTGRES_PORT: 5432
    ports:
      - 8080:8080
    volumes:
      - .:/app
    working_dir: /app
    stdin_open: true
    tty: true
    entrypoint: bash
    restart: always
    depends_on:
      - db

  db:
    container_name: postgres_container
    image: postgres:11.2-alpine
    restart: unless-stopped
    networks:
      - vapor-it
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: test
      POSTGRES_PASSWORD: test
      POSTGRES_HOST: db
      POSTGRES_PORT: 5432
      PGDATA: /var/lib/postgresql/data
    volumes:
      - database_data:/var/lib/postgresql/data

  pgadmin:
    container_name: pgadmin_container
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: test@test.com
      PGADMIN_DEFAULT_PASSWORD: admin
    volumes:
      - pgadmin:/root/.pgadmin
    ports:
      - ""${PGADMIN_PORT:-5050}:80""
    networks:
      - vapor-it
    restart: unless-stopped

networks:
  vapor-it:
    driver: bridge

volumes:
  database_data:
  pgadmin:
  #  driver: local
</code></pre>

<p>Also while reading the Docker postgres docs I came across this in the ""Caveats"" section. </p>

<blockquote>
  <p>If there is no database when postgres starts in a container, then postgres will create the default database for you. While this is the expected behavior of postgres, this means that it will not accept incoming connections during that time. This may cause issues when using automation tools, such as docker-compose, that start several containers simultaneously.<a href=""https://hub.docker.com/_/postgres/#how-to-extend-this-image"" rel=""nofollow noreferrer"">postgres dockerhub</a></p>
</blockquote>

<p>I have not made those changes because I am not sure how to go about making that file or how the configuration would look. Has anyone done something like this that has some experience with connecting to Postgresql and using vapor as a back end?</p>
","4807889","","13302","","2019-04-06 08:01:39","2019-04-06 08:01:39","Swift Vapor 3 + PostgreSQL + Docker-Compose Correct configuration?","<postgresql><docker><docker-compose><vapor>","1","0","1","","","55500917","118712","118712","vapor","592","36204589","36204588"
"55601797","1","55601993","","2019-04-09 21:45:38","","5","561","<p>I'd like to make a post call with some parameters in Vapor 3.</p>

<pre><code>POST: http://www.example.com/example/post/request

title: How to make api call
year: 2019
</code></pre>

<p>Which package/function can be used?</p>
","6392347","","","","","2019-04-10 07:07:23","How to make a third party api call in Vapor 3?","<swift><api><vapor>","1","0","1","","","55601797","118712","118712","vapor","592","36204589","36204588"
"55755667","1","55764419","","2019-04-19 01:58:44","","2","120","<p>I am making a server with Swift 5 and Vapor 3. When setting up a route I want to call a function from my controller that returns an optional like so:</p>

<pre class=""lang-swift prettyprint-override""><code>//Person.swift

struct Person: Content {
    ...
}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>//PersonController.swift

func update(_ request: Request) throws -&gt; Future&lt;Person&gt; {
    let uuid = try request.parameters.next(UUID.self)

    return try request.content.decode(Person.self).flatMap { content in
        request.withPooledConnection(to: DatabaseIdentifier&lt;PostgreSQLDatabase&gt;.psql) { connection in
            /*
            *  No code completion beyond this point,
            *  even connection appears as type '_' instead of
            *  PostgreSQLConnection (not relevant to the question tho,
            *  just worth noting)
            */
            if content.lastName != nil {
                return connection.raw(""Very long SQL query..."")
                .binds([...])
                .first(decoding: Person.self)
            }

            return connection.raw(""Other long SQL query"")
            .binds([...])
            .first(decoding: Person.self)
        }
    }

}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>router.put(""people"", UUID.parameter, use: personController.update)
</code></pre>

<p>But then I get this error</p>

<pre><code>Cannot convert value of type '(Request) throws -&gt; EventLoopFuture&lt;Person?&gt;' to expected argument type '(Request) throws -&gt; _'
</code></pre>

<p>I see many instances when working with Vapor in which Xcode just gives up on autocompleting, and everything is just typed as <code>_</code>. Mostly inside closures that are used as callbacks. It is VERY annoying, and quite frankly I am unsure if it is caused because of Vapor, Swift, or Xcode. It is a huge PITA but it all gets resolved once I compile, the types just get sorted out. However in this case it is just not working.</p>

<p>So the question is: Why is does Xcode say the expected type is <code>(Request) throws -&gt; _</code> when the actual definition for <code>Request.put(_:use:)</code> requires a <code>(Request) throws -&gt; T</code> and how does that make a difference between <code>T</code> being <code>Future&lt;Person&gt;</code> and <code>Future&lt;Person?&gt;</code>?</p>
","6465042","","6756852","","2019-04-19 06:53:53","2019-04-19 15:48:19","Why Xcode keeps substituting generics with '_'","<swift><xcode><generics><vapor><server-side-swift>","1","5","","","","55755667","118712","118712","vapor","592","36204589","36204588"
"55872428","1","","","2019-04-26 17:27:49","","1","47","<p>I'm building an RPC based application, so incoming post data will have a general format of</p>

<pre class=""lang-swift prettyprint-override""><code>struct Message: Content {
   let function: String
   let parameters: ParameterValues
}
</code></pre>

<p>Assuming I have many different message types where ParameterValues is different for all of them how do I determine what kind of message has been sent in so I can decode it?  I think I need some kind of if/else tree but if a decode fails it throws and never get's passed the first if.</p>

<pre class=""lang-swift prettyprint-override""><code>if let message = request.content.decode(MessageOne) {
  // do something
} else if let message = request.content.decode(MessageTwo) {
  // do something else
}
</code></pre>

<p>Is there a better way to handle this?</p>

<p>Side note I am attempting to implement a common protocol to abstract the parameters type so I don't have a ton of duplicate structs.  So we can assume all messages conform to the same protocol.</p>

<p>Thanks
Derek</p>
","11375271","","11375271","","2019-04-30 04:18:02","2019-04-30 04:18:02","How do I determine the type of an incoming post data?","<vapor>","0","1","","","","55872428","118712","118712","vapor","592","36204589","36204588"
"55891140","1","55891715","","2019-04-28 14:15:28","","2","586","<p>I'm writing a web service using Vapor framework in Swift.</p>

<p>In my app, I have User model. The following is how I route a get request for all users. </p>

<pre><code>router.get(""users"") { request in
    return User.query(on: request).all()
}
</code></pre>

<p>After running the server locally, to get the users, I can make a request like <code>localhost:8080/users</code></p>

<p>Now, I want to add parameter to the request to get users above the given age. The request will look like <code>localhost:8080/users?above_age=25</code></p>

<p>How to add the parameter in the request using the Vapor framework?
I tried with the <a href=""https://docs.vapor.codes/3.0/routing/overview/"" rel=""nofollow noreferrer"">available docs</a> but I can't figure it. </p>

<p>Since I am now starting with Server Side Swift using Vapor, any reference to resources using Vapor 3 will also be of help for other issues I might face. Thanks!</p>
","9308052","","9308052","","2019-04-28 14:20:40","2019-04-28 22:00:20","How to pass parameters in request while routing (Server Side Swift using Vapor)","<swift><vapor><server-side-swift>","2","0","","","","55891140","118712","118712","vapor","592","36204589","36204588"
"55893199","1","55893277","","2019-04-28 18:13:18","","2","107","<p>I'm writing a web service in Swift using Vapor framework. </p>

<p>I use FluentSQLite to save data. I have a User Model which conforms to the SQLiteModel and Migration. I have added routes to create new user via a post methods and return the list of users via a get method like below. </p>

<p><a href=""https://i.stack.imgur.com/nSEAR.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/nSEAR.png"" alt=""enter image description here""></a></p>

<p>When I hit the get API for first time, it returns an empty array. After I post some users, I am able to get them. But when I stop the service and run again, I am unable to get the previously saved users.</p>

<p>Since I am new to Vapor, I can't figure out what I am missing here and all the online searches and docs didn't help. Initially I did not have a save or query inside a transaction, after seeing that in the docs I tried that also, but same issue. </p>
","9308052","","","","","2019-04-28 18:22:54","Unable to persist data across instances of web service in Swift using Vapor-Fluent","<swift><vapor><server-side-swift><vapor-fluent>","1","2","","","","55893199","118712","118712","vapor","592","36204589","36204588"
"55897286","1","","","2019-04-29 05:12:25","","3","392","<p>I am developing server using Vapor 3. I want to support SSL. But I can't find any tutorial or documentation for this. Can Anyone offer some idea?</p>
","9217658","","1226963","","2019-04-29 05:13:06","2020-02-11 18:17:08","Setup SSL with Vapor 3","<ssl><vapor>","1","0","1","","","55897286","118712","118712","vapor","592","36204589","36204588"
"55899009","1","","","2019-04-29 07:49:01","","0","106","<p>I have two models and they have one-many relation. Here are my classes.</p>

<p><strong>Booking</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Booking: PostgreSQLModel {
    /// The unique identifier for this `Todo`.
    var id: Int?

    /// A title describing what this `Todo` entails.
    var user_id: User.ID
    var product_id: Product.ID
    var count: Int

    /// Creates a new `Todo`.
    init(id: Int? = nil, user_id: User.ID, product_id: Product.ID, count: Int) {
        self.id = id
        self.user_id = user_id
        self.product_id = product_id
        self.count = count
    }
}
extension Booking {
    var user: Parent&lt;Booking, User&gt; {
        return parent(\.user_id)
    }
    var product: Parent&lt;Booking, Product&gt; {
        return parent(\.product_id)
    }
}
</code></pre>

<p><strong>Product</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Product: PostgreSQLModel {
    /// The unique identifier for this `Todo`.
    var id: Int?

    /// A title describing what this `Todo` entails.
    var name: String
    var image_url: String
    var description: String
    var price: Int?

    /// Creates a new `Todo`.
    init(id: Int? = nil, name: String, image_url: String, description: String, price: Int) {
        self.id = id
        self.name = name
        self.image_url = image_url
        self.description = description
        self.price = price
    }
}
extension Product {
    var bookings: Children&lt;Product, Booking&gt; {
        return children(\.product_id)
    }
}
</code></pre>

<p>Now i want to fetch all bookings of a user and with each booking i want to fetch the product information as well. So for this i have tried to join <code>Booking</code> and <code>Product</code> table but this throws an exception.</p>

<blockquote>
  <p>Fatal error: 'try!' expression unexpectedly raised an error: ⚠️ CoreError: <code>Parent&lt;Booking, Product&gt;</code> does not conform to <code>ReflectionDecodable</code>.
  - id: CoreError.ReflectionDecodable
  : file /BuildRoot/Library/Caches/com.apple.xbs/Sources/swiftlang_Fall2018/swiftlang_Fall2018-1000.11.42/src/swift/stdlib/public/core/ErrorType.swift, line 184
  Program ended with exit code: 9</p>
</blockquote>

<p>Here is my code for join.</p>

<pre class=""lang-swift prettyprint-override""><code>let booking = Booking.query(on: req).join(\Product.bookings, to:\Booking.product).filter(\.user_id == userID).decode(BookingM.self).all()
</code></pre>
","2626237","","","","","2019-05-31 14:08:47","Crash on Join with Fluent in Vapor","<swift><postgresql><join><vapor><vapor-fluent>","1","0","","","","55899009","118712","118712","vapor","592","36204589","36204588"
"55907023","1","","","2019-04-29 16:03:12","","2","141","<p>I'm writing a web service in Swift using Vapor 3. I'm using <code>FluentPostgreSQL</code> for data persistence. I have a user model which conforms to both <code>PostgreSQLModel, PostgreSQLMigration</code>. The app builds correctly. However, when I run the app, I am getting the following error.</p>

<pre><code>Fatal error: Error raised at top level: ⚠️ PostgreSQL Error: database ""trialService"" does not exist
- id: PostgreSQLError.server.fatal.InitPostgres
</code></pre>

<p>This is how my <code>configure.swift</code> looks like. </p>

<pre><code>try services.register(FluentPostgreSQLProvider())

let configPSQL = PostgreSQLDatabaseConfig(hostname: ""localhost"", username: ""imthath"", database: ""trialService"")
let psql = PostgreSQLDatabase(config: configPSQL)

var databases = DatabasesConfig()
databases.add(database: sqlite, as: .sqlite)
databases.add(database: psql, as: .psql)
services.register(databases)
</code></pre>

<p>As you can see I was earlier using SQLite and now I am trying to use PostgreSQL for some models including User. I did not get any error when I was only SQLite. </p>
","9308052","","9308052","","2019-04-29 16:12:30","2019-04-29 16:12:30","database does not exist - PostgreSQL in Server Side Swift using Vapor 3 and Fluent","<swift><postgresql><fluent><vapor><server-side-swift>","1","0","","","","55907023","118712","118712","vapor","592","36204589","36204588"
"55944410","1","55946899","","2019-05-02 00:55:52","","0","593","<p>I'm writing a web service in Swift using Vapor framework. </p>

<p>I have model named <code>Item</code>. Intially it has only name and id properties. </p>

<pre><code>typealias VaporModel = Content &amp; PostgreSQLModel &amp; Parameter
final class Item: VaporModel {
    var id: Int?
    var name: String
}
</code></pre>

<p>After I configure a controller for the model and add the routes, when I hit the post Item request, I get the error as <code>Model.defaultDatabase is required to use as DatabaseConnectable</code>. I think the error is because I have not added <code>Item</code> to <code>Migrations</code> in <code>configure.swift</code> and I do the same after conforming <code>Item</code> to <code>PostgreSQLMigration</code>.</p>

<pre><code>var migrations = MigrationConfig()
migrations.add(model: Item.self, database: .psql)
services.register(migrations)
</code></pre>

<p>Now, I am able to hit the post request and create items in the database. </p>

<p>So I understand that <code>Migration</code> protocol creates the default schema for a model and adds a new table to the database with the model's properties as columns.</p>

<p>Now I want to add a property such as <code>price</code> to my Item class. Now when I hit the post request, I get the error as <code>column ""price"" of relation ""Item"" does not exist</code>. 
I assume the Migration protocol will be able to identify the schema changes and the column to my table (that's what I was used to in while using Realm for my iOS apps). But I am wrong and I read through the Migration docs and implement the <code>prepare</code> and <code>revert</code> methods in migration like below.</p>

<pre><code>extension Item: PostgreSQLMigration {
    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: conn) { creator in
            creator.field(for: \.price)
        }
    }

    static func revert(on connection: PostgreSQLConnection) -&gt; EventLoopFuture&lt;Void&gt; {
        return Future.map(on: connection) { }
    }
} 
</code></pre>

<p>I'm still struck with the same error <code>column ""price"" of relation ""Item"" does not exist</code>. What am I missing here? Is my migration code correct?</p>

<p>Also, I understand that if am not making any changes to the Model, I can comment out the migration config, because they need not run every time I run the service. Is that correct?</p>
","9308052","","9308052","","2019-05-02 01:07:04","2019-05-02 09:04:41","Understanding Migrations in Vapor-Fluent (Server side Swift)","<swift><postgresql><fluent><vapor><server-side-swift>","1","0","","","","55944410","118712","118712","vapor","592","36204589","36204588"
"55975575","1","","","2019-05-03 18:46:46","","3","429","<p>I have a problem sending a POST request with Vapor 3 with the body including JSON. I am using <a href=""https://docs.postman-echo.com/"" rel=""nofollow noreferrer"">https://docs.postman-echo.com/</a> to test this, where it responds back with the same JSON it is sent.</p>

<p>I have viewed answers on <a href=""https://stackoverflow.com/questions/55245418/vapor-3-send-a-httprequest"">here</a>, but got errors with encoding and content types.</p>

<pre class=""lang-swift prettyprint-override""><code>router.get(""hooray"") { req -&gt; Future&lt;View&gt; in

  var postHeaders: HTTPHeaders = .init()
  postHeaders.add(name: .contentType, value: ""application/json"")
  postHeaders.add(name: .accept, value: ""*/*"")
  postHeaders.add(name: .acceptEncoding, value: ""gzip, deflate"")

  let oneField = singleGet(foo: ""barfoobar"")

  // { foo: ""barfoobar"" } - JSON string

  let encoder = JSONEncoder()
  encoder.outputFormatting = .prettyPrinted

  let jsonData = try encoder.encode(oneField)
  let jsonString = String(data: jsonData, encoding: .utf8)!
  let postBody = HTTPBody(string: jsonString)

  let httpReq = HTTPRequest(method: .POST, url: ""/post"")

  let httpRes = HTTPClient.connect(hostname: ""postman-echo.com"", on: req)
                  .flatMap(to: singleGet.self) { client in
                    req.http.headers = postHeaders
                    req.http.contentType = .json
                    req.http.body = postBody
                    return client.send(httpReq).flatMap(to: singleGet.self) { res in
                      return try req.content.decode(singleGet.self)
                    }
                  }

  return try req.view().render(""test"", httpRes)
}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>struct singleGet: Content {
    let foo: String
}
</code></pre>

<p>I am getting the correct response with this code, but I was wondering when I rework the code to match <a href=""https://stackoverflow.com/questions/55245418/vapor-3-send-a-httprequest"">this answer</a>, why do I get errors?</p>

<p>I've added the headers and body to the request and comment them out inside the closure, but it won't work this way.</p>

<pre class=""lang-swift prettyprint-override""><code>let httpReq = HTTPRequest(method: .POST, url: ""/post"", headers: postHeaders, body: postBody)
</code></pre>
","10095543","","452584","","2019-05-06 12:34:13","2019-05-06 12:34:13","Swift - POST request, sending JSON with Vapor 3","<json><swift><http><vapor>","0","1","","","","55975575","118712","118712","vapor","592","36204589","36204588"
"55979670","1","56018076","","2019-05-04 05:14:40","","0","226","<p>While learning how to use Swift and Vapor to create a REST api, while testing this API using postman, I am unable to make an API Post request, the error I receive is: </p>

<pre class=""lang-swift prettyprint-override""><code>{
    ""error"": true,
    ""reason"": ""Value of type 'String' required for key 'email'.""  
}
</code></pre>

<p>I am using a PostgreSQL database reference the model. I feel something is wrong with my model.</p>

<p>Here is the model I am using:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Todo: PostgreSQLModel {
    var id: Int?
    var email: String
    var password: String
    var name_first: String
    var name_last: String
    var username: String

    init(id: Int?, email: String, name_first: String, name_last: String, username:String, password: String) {
        self.id = id
        self.email = email
        self.name_first = name_first
        self.name_last = name_last
        self.username = username
        self.password = password
    }
}
</code></pre>
","9970706","","452584","","2019-05-08 12:54:27","2019-05-08 12:54:27","Creating REST API in Swift using vapor unable to make a POST request","<swift><rest><vapor>","1","2","","","","55979670","118712","118712","vapor","592","36204589","36204588"
"56055213","1","","","2019-05-09 08:26:24","","1","120","<p>I am trying to pre populate tables with Vapor 3 and Vapor fluent. I am new to Vapor</p>

<p>I'm trying to populate <code>Sharedkeys</code> with data from <code>Platform</code>. I have managed to query <code>Platform</code>. However, I am struggling to populate <code>SharedKeys</code></p>

<p>So every <code>platform</code> will have a <code>shared key</code> </p>

<p>I have included an example below, with this I have no luck. </p>

<p>On this line
<code>let sharedKeys = platforms.map { platform in</code> 
I get an compile error 
<code>Unable to infer complex closure return type: add explicit type to disambiguate</code></p>

<p>I then realised that <code>map</code> is returning <code>[T]</code>, can't figure out a way to create <code>Future&lt;SharedKey&gt;</code> instead of <code>[SharedKey]</code></p>

<p>Here is an example of my coding, feel free to criticise!</p>

<p>Platform Model</p>

<pre class=""lang-swift prettyprint-override""><code>struct Platform : Codable {
    var id : Int?
    /// Type of platform, i.e. iPhone, iPad, Android etc...
    var platform : String

    init(platform : String) {
        self.platform = platform
    }
}

extension Platform : PostgreSQLModel, Content {}
extension Platform : PostgreSQLMigration {

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: conn) { builder in
            try addProperties(to: builder)
            builder.unique(on: \.platform)
        }
    }
}
</code></pre>

<p>SharedKey Model</p>

<pre class=""lang-swift prettyprint-override""><code>final class SharedKey: Codable {
    var id : Int?
    /// platform
    var platID : Platform.ID?
    /// shared key
    var key : String

    init(key: String, platform : Platform) {
        self.key    = key
        self.platID = platform.id
    }
}

extension SharedKey : PostgreSQLModel, Content {}
extension SharedKey : PostgreSQLMigration {

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.create(self, on: conn) { builder in
            try addProperties(to: builder)
            builder.unique(on: \.key)
        }
    }
}
</code></pre>

<p>Trying to populate <code>sharedKey</code></p>

<pre class=""lang-swift prettyprint-override""><code>        let p = Platform.query(on: conn).all()
        let keysFuture = p.flatMap(to: [SharedKey].self) { platforms in

            let sharedKeys = platforms.map { platform in
                let key = SharedKey(key: ""&lt;random key&gt;"", platform: platform)
                return key.save(on: conn)
            }

            return sharedKeys
        }


</code></pre>

<p>What I am expecting is the variable <code>keysFuture</code> to be type <code>Future&lt;[SharedKey]&gt;</code> NOT <code>[SharedKey]</code></p>

<p>Edit:</p>

<p>I have used this example to pre populate <code>Platform</code>:
<a href=""https://mihaelamj.github.io/Pre-populating%20a%20Database%20with%20Data%20in%20Vapor/"" rel=""nofollow noreferrer"">https://mihaelamj.github.io/Pre-populating%20a%20Database%20with%20Data%20in%20Vapor/</a></p>

<p>Populating strings into a table is easy but trying to populate <code>shared key</code> with <code>platform</code> is a challenge for me.</p>

<p>I realised that I need Sharedkeys to be <code>[EventLoopFuture&lt;Void&gt;]</code> 
I did updated the following:</p>

<pre class=""lang-swift prettyprint-override""><code>   let pp = Platform.query(on: conn).all()
        let op = pp.map { platforms in

           return platforms.map { p in
                return SharedKey(key: ""random"", platform: p).create(on: conn).map(to: Void.self) { _ in return }
            }
        }
</code></pre>

<p>However, this returns as <code>EventLoopFutrue&lt;[EventLoopFutrue&lt;Void&gt;]&gt;</code> is there a way of unwrapping this?</p>

<p>I just need to append <code>[EventLoopFutrue&lt;Void&gt;]</code> to <code>futures</code> from the link above (<a href=""https://mihaelamj.github.io"" rel=""nofollow noreferrer"">https://mihaelamj.github.io</a>)</p>
","5246430","","5246430","","2019-05-10 12:07:46","2019-05-10 12:07:46","Vapor 3, Pre populate table with data from another table","<swift><database><postgresql><vapor><vapor-fluent>","0","7","","","","56055213","118712","118712","vapor","592","36204589","36204588"
"56116895","1","","","2019-05-13 17:05:16","","0","90","<p>Im trying to create a vapor API to my app. On my local machine ( Mac OS ) All my code and my API works perfectly but when i upload it to my ubuntu server it crashes...</p>

<p>I already did the following code:</p>

<p><code>vapor clean</code>
<code>vapor update</code>
<code>vapor build</code></p>

<p>None of these commands return any type of errors but when i run vapor the following happens:</p>

<p><code>root@rt-server:/usr/local/uprising/server# vapor run
Running server ...
root@rt-server:/usr/local/uprising/server#</code></p>

<p>Searching a bit and making some trys to fix my problem i figgured out that if i comment the following code ( configure.swift ), i can make vapor runs:</p>

<pre><code>//     Register Mongo Client
let client = try! MongoClient()
let db = client.db(""myDB"")
let collection:MongoCollection&lt;Document&gt;
do {
    collection = try db.createCollection(""myCollection"")
} catch {
    collection = db.collection(""myCollection"")
}
// Create an unique index on timestamp
// because I expect only one daily
let indexOptions = IndexOptions(name: ""timestamp"", unique: true)
let model = IndexModel(keys: [ ""timestamp"": 1] , options: indexOptions)
do {
    try collection.createIndex(model)
} catch {
    print(""Index already exist!"")
}
services.register(client)
</code></pre>

<p>I have some questions that maybe help me figgure out how solve my problem:</p>

<ul>
<li><p>How do i debug vapor using command line on ubuntu? In my mac its easy when i use xcode...</p></li>
<li><p>Can i test if my MongoDB C Driver is properly installed?</p></li>
<li><p>Does anyone knows what am i doing wrong? it works perfectly on my mac...</p></li>
</ul>

<p>Sorry for my bad engish... If anyone knows how to help me i would appreciate that!</p>
","10923929","","","","","2019-06-16 19:19:58","Vapor crashes when uses MongoSwift on ubuntu","<swift><mongodb><ubuntu><vapor>","2","1","","","","56116895","118712","118712","vapor","592","36204589","36204588"
"56246038","1","56246379","","2019-05-21 20:39:52","","1","115","<p>I am trying to implement a simple login request API. 
As you can see in the coding sample below, I have <code>LoginRequest</code> which is the data I get from the client (iOS, Android etc). With this I check if <code>User</code> exists in the DB, then I check if the user's password is correct.</p>

<p>However, what I am struggling with is how do I return a model that doesn't exist in the DB. In the example below I have <code>LoginResponse</code>. I don't want to reveal the full <code>User</code> &amp; <code>AuthToken</code> (models in DB) data to the client, hence I have create the <code>LoginResponse</code> model. The only data i want to reveal to the client is the <code>LoginResponse</code>'s <code>authToken</code> if everything was successful. </p>

<p>What I expect from the user: username and password</p>

<pre class=""lang-swift prettyprint-override""><code>struct LoginRequest : Codable, Content {
    var username: String
    var password : String
}
</code></pre>

<p>The response I give back to the user: success (with authToken), incorrect password or user doesn't exists. </p>

<pre class=""lang-swift prettyprint-override""><code>/// Response model for user login.
struct LoginResponse : Codable, Content {

    enum LoginResultType : String, Codable {
        case success
        case incorrectPassword
        case noUser
    }

    var authToken : String?
    var state : LoginResultType

    init(state : LoginResultType) {
        authToken  = nil
        self.state = state
    }
}}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>func login(_ req : Request) throws -&gt; Future&lt;LoginResponse&gt; {
        return try req.content.decode(LoginRequest.self).flatMap(to: LoginResponse.self) { loginRequest in
            return User.query(on: req).filter(\.username == loginRequest.username)
                .first().map(to: LoginResponse.self) { user in

                    /// check if we have found a user, if not then return LoginResponse with noUser
                    guard let u = user else {
                        return LoginResponse(state: .noUser)
                    }
                    /// if the password isn't the same, then we tell the user
                    /// that the password is incorrect.
                    if u.password != loginRequest.password {
                        return LoginResponse(state: . incorrectPassword)
                    }


                    /// If username and password are the same then we create a random authToken and save this to the DB.
/// Then I need to return LoginResponse with success and authToken.
                    let authToken = AuthToken(token: ""&lt;Random number&gt;"")
                    authToken.user = u.id
                    return authToken.create(on: req).flatMap(to: LoginResponse.self){ auth in
                        var lr       = LoginResponse(state: .success)
                        lr.authToken = auth.token
                        return lr
                    }
            }
        }
    }
</code></pre>

<p>The coding below is a headache, this will not let me return a LoginResponse after I have created a new authToken in the DB. </p>

<pre class=""lang-swift prettyprint-override""><code>                    return authToken.create(on: req).flatMap(to: LoginResponse.self){ auth in
                        var lr       = LoginResponse(state: .success)
                        lr.authToken = auth.token
                        return lr
                    }
</code></pre>

<p>Once I have created an authToken I want to reveal the authToken in the LoginResponse model with success state, how do I achieve this?</p>
","5246430","","1226963","","2019-05-21 22:57:13","2019-05-21 22:57:13","Vapor 3 - Trying to map Login request with model that does not exits in database","<swift><database><vapor>","1","0","","","","56246038","118712","118712","vapor","592","36204589","36204588"
"56246857","1","56259019","","2019-05-21 21:57:23","","1","47","<p>I have a <code>User</code> model that users can use to create accounts in my Vapor (Swift) application.<br>
<code>User</code> implements the <code>Migration</code> protocol as follows:</p>

<pre><code>static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
    return Database.create(self, on: conn) { (builder) in
        try addProperties(to: builder)
        builder.unique(on: \.email)
    }
}
</code></pre>

<p>Now, this works just fine, but if a user <em>(soft-)deletes</em> their account and tries to sign up with the same email address again, they cannot, because the email has already been used.</p>

<p>How can I tell the <code>builder</code> to ignore values from deleted entries when evaluating uniqueness?</p>
","3397217","","3397217","","2019-05-22 14:02:44","2019-05-22 14:20:53","Database constraints to ignore soft-deleted entries when evaluating uniqueness","<swift><constraints><vapor>","1","10","","","","56246857","118712","118712","vapor","592","36204589","36204588"
"56303381","1","","","2019-05-25 09:09:02","","1","131","<p>I'm creating a <code>database</code> transaction with several insertions inside it. Results are saving as <code>array</code> of Future. Then I'm looking for the operation results in <code>do{..}.catch{..}</code> construction. And here is the </p>

<blockquote>
  <p>issue: if I'm returning failed future from do block then all transaction is rolling back - good, but if I'm returning the same failed future from ""catch"" block then some records are committing to the database.</p>
</blockquote>

<pre><code>    func save(on req: Request) -&gt; Future&lt;Confirmation&gt;
    {
      return req.transaction(on: .psql) { conn in
      let promise = conn.eventLoop.newPromise(Confirmation.self)
      var futures = [Future&lt;Bool&gt;]()
       for i in 0 ..&lt; 20 
       {
         let g1 = Group()
         g1.name = ""\(i)""
         let f1 = g1.save(on: conn).then { _ -&gt; Future&lt;Bool&gt; in
         if i == 15
         {
//          return conn.eventLoop.newSucceededFuture(result: false) //1
            return conn.eventLoop.newFailedFuture(error: SyncError.nullPrimaryKey) // 2
          } 
          else 
          {
            return conn.eventLoop.newSucceededFuture(result: true)
          }
        }
        futures.append(f1)
      }

      futures.do(on: conn){ results in
        var res = true
        results.forEach { e in
          res = res &amp;&amp; e
        }
        if res {
          promise.succeed(result: Confirmation())
        } 
        else {
          promise.fail(error: SyncError.nullPrimaryKey) // 3
         }
        }.catch { e in
         promise.fail(error: e) // 4
     }
     return promise.futureResult
    }
  }
}
</code></pre>

<p>In this example <strong>promise</strong> is fulfilled with failure in the line 4 (block <strong>catch</strong>), and I have the issue of not-reverted transaction.
But if I comment out line 1 and uncomment line 2 then <strong>promise</strong> is fulfilled in line 3 (block <strong>do</strong>), and entire transaction is reverted correctly.</p>

<p>Is it my fault somewhere in code, or is it Fluent bug?</p>
","2063620","","11077258","","2019-05-25 10:47:49","2019-05-27 04:52:08","Vapor Fluent Database transaction is not atomic","<swift><vapor>","1","0","","","","56303381","118712","118712","vapor","592","36204589","36204588"
"56305228","1","56329684","","2019-05-25 13:23:37","","0","168","<p>I have set up AWS S3 bucket and I'm able to upload files there using Vapor 3 and Postman. I can also get files using Vapor 3 and Postman but I have a hard time to get and actually display files(png -images) on my browser (I'm using leaf). </p>

<p>So how can I display image files on the view? I'm new with HTML, AWS S3 and Vapor. </p>

<p>I'm using:   </p>

<ul>
<li>Vapor 3</li>
<li>AWS S3 </li>
<li>Leaf package</li>
<li>S3 package</li>
<li>VaporExt package</li>
</ul>

<p>I followed this tutorial to set up everything (except the get request and the bucket policies): <a href=""https://fivedottwelve.com/blog/using-amazon-s3-with-vapor/"" rel=""nofollow noreferrer"">https://fivedottwelve.com/blog/using-amazon-s3-with-vapor/</a> </p>

<p>Here are my Vapor code: </p>

<pre class=""lang-swift prettyprint-override""><code>/// GET reguest
func preparePresignedImageUrl(request: Request) throws -&gt; String {

    let baseUrl = awsConfig.url
    let imagePath = awsConfig.imagePath
    let fileName = ""x.png""


    guard var url = URL(string: baseUrl) else {
        throw Abort(.internalServerError)
    }
    url.appendPathComponent(imagePath)
    url.appendPathComponent(fileName)

    print(""url is \(url)"")
    let headers = [""x-amz-acl"" : ""public-read""]


    let s3 = try request.makeS3Signer()
    let result = try s3.presignedURL(for: .GET, url: url, expiration: Expiration.hour, headers: headers)
    /// Retrieve file data from S3

    guard let presignedUrl = result?.absoluteString else {
        throw Abort(.internalServerError)
    }

    return presignedUrl

}
</code></pre>

<p>The route:</p>

<pre class=""lang-swift prettyprint-override""><code>// GET request
 group.get(""aws"", ""image"", use: preparePresignedImageUrl) 
</code></pre>

<p>And in the Postman when I make a GET request to that <code>presignedURL</code> it gives me a status code 200OK. </p>

<p>My <code>showImage.leaf</code> file: </p>

<pre class=""lang-html prettyprint-override""><code>#set(""content"") {
&lt;h1&gt;#(title)&lt;/h1&gt;

// Here some html to get the image path and display the image?
  &lt;img&gt;

}

#embed(""base"")
</code></pre>
","9491568","","5236226","","2019-05-27 16:38:40","2019-05-27 16:38:40","How to display image using AWS S3 and Vapor 3 and Leaf","<image><amazon-web-services><amazon-s3><vapor><leaf>","1","1","2","","","56305228","118712","118712","vapor","592","36204589","36204588"
"56372209","1","","","2019-05-30 05:35:38","","1","223","<p>I have set up AWS S3 bucket and I'm able to upload files there using Vapor 3 and Postman (PUT -request and with headers: [""x-amz-acl"" : ""public-read""]) but I would like to do that from the browser (I'm using leaf).</p>

<p>So how can I upload image files from the browser? I'm new with HTML, AWS S3 and Vapor.</p>

<p>I'm using:</p>

<ul>
<li>Vapor 3</li>
<li>AWS S3</li>
<li>Leaf package</li>
<li>S3 package</li>
<li>VaporExt package</li>
</ul>

<p>I followed this tutorial to set up everything (except the get request and the bucket policies): <a href=""https://fivedottwelve.com/blog/using-amazon-s3-with-vapor/"" rel=""nofollow noreferrer"">https://fivedottwelve.com/blog/using-amazon-s3-with-vapor/</a></p>

<p>Get the url:</p>

<pre><code>func preparePresignedUrl(request: Request) throws -&gt; String {

    let baseUrl = awsConfig.url
    let imagePath = awsConfig.imagePath
    let newFilename = UUID().uuidString + "".png""


    guard var url = URL(string: baseUrl) else {
        throw Abort(.internalServerError)
    }
    url.appendPathComponent(imagePath)
    url.appendPathComponent(newFilename)

    let headers = [""x-amz-acl"" : ""public-read""]

    let s3 = try request.makeS3Signer()
    let result = try s3.presignedURL(for: .PUT, url: url, expiration: Expiration.hour, headers: headers)

    guard let presignedUrl = result?.absoluteString else {
        throw Abort(.internalServerError)
    }

    return presignedUrl
}
</code></pre>

<p>A route handler: </p>

<pre><code>func ImagesHandler(_ req: Request) throws -&gt; Future&lt;View&gt; {

    let presignedUrl = try preparePresignedUrl(request: req)
    let context = PostImageContext(title: ""Add Image"", url: presignedUrl)
    return try req.view().render(""addImage"", context)
}
</code></pre>

<p>A context that contains the data for the Leaf variables: </p>

<pre><code>struct PostImageContext: Encodable {
    let title : String
    let url : String
}
</code></pre>

<p>The Leaf file (addImage.leaf):</p>

<pre><code>#set(""content"") {

    &lt;h1&gt;#(title)&lt;/h1&gt;

    &lt;form method=""PUT"", action=""#(url)"", enctype=""multipart/form-data""&gt;

    &lt;div class=""form-group""&gt;
    &lt;label&gt;
        Choose Image
    &lt;/label&gt;
    &lt;input type=""file""
    class=""form-control-file""/&gt;
    &lt;/div&gt;

    &lt;button type=""submit"" class=""btn btn-primary""&gt;
        Upload
    &lt;/button&gt;   
    &lt;/form&gt;
}

#embed(""base"")
</code></pre>

<p>And it returns an error:</p>

<pre><code>""NoSuchKeyThe specified key does not exist""
</code></pre>

<p>I learnt that the only valid values for the method attribute are get and post what means that  is invalid HTML and will be treated like , i.e. send a GET request (explains the error I got).</p>

<p>How can I work around this using Vapor? Thank you for your help!</p>
","9491568","","","","","2019-05-30 05:35:38","How to upload images from the browser to Amazon S3 using Vapor and Leaf?","<swift><amazon-web-services><amazon-s3><vapor><leaf>","0","1","","","","56372209","118712","118712","vapor","592","36204589","36204588"
"56440328","1","","","2019-06-04 08:42:34","","1","214","<p>I'm a Swift beginner, working in the Vapor framework, developing a signup process which requires several steps in series to work. I'm encountering an issue with the following code, which Xcode indicates an error exists on the marked line:</p>

<pre><code>func signup(_ req: Request) throws -&gt; Future&lt;RecordA&gt; {
    return try req.content.decode(RecordACreation.self).flatMap(to: RecordACreation.self) { recordACreation in

        // Prevent a recordA email from being used twice.
        RecordA(on: req).filter(\.email == recordACreation).first().map(to: RecordA.self) { optionalExistingRecordAByEmail in
            if let _ = optionalExistingRecordAByEmail {
                throw Abort(.unprocessableEntity, reason: ""RecordA email already exists"")
            }

        }.flatMap { // Xcode indicates there's an error here.
            // Prevent an recordB email from being used twice.
            return RecordB.query(on: req).filter(\.email == recordACreation.recordBEmail).first().map(to: RecordA.self) { optionalExistingRecordBByEmail in
                if let _ = optionalExistingRecordBByEmail {
                    throw Abort(.unprocessableEntity, reason: ""RecordB email already exists."")
                }
            }

        }.flatMap {
            // If the recordB's password could not be successfully hashed.
            guard let recordBPassword = try? BCrypt.hash(recordACreation.recordBPassword) else {
                throw Abort(.unprocessableEntity, reason: ""Password was unhashed"")
            }

            // Ensure a verification token is generated successfully.
            guard let optionalVerificationToken = try? VerificationTokenService.generate(), let verificationToken = optionalVerificationToken else {
                throw Abort(.unprocessableEntity, reason: ""Verification token could not be generated."")
            }

            let recordA = RecordA(name: recordACreation.recordAName, email: recordACreation.recordAEmail)

            return req.transaction(on: .sqlite) { conn in
                // TODO: Send email on signup success.

                return recordA.save(on: conn).map(to: RecordA.self) { savedRecordA in
                    guard let recordAId = recordA.id else {
                        throw Abort(.unprocessableEntity, reason: ""Verification token could not be generated."")
                    }

                    _ = RecordB(name: recordACreation.recordBName, email: recordACreation.recordBEmail, password: recordBPassword, recordAId: recordAId, verificationToken: verificationToken).save(on: conn)
                    return savedRecordA
                }
            }
        }
    }
}

</code></pre>

<p>The error reads:</p>

<blockquote>
  <p>Cannot invoke 'flatMap' with an argument list of type '(() -> EventLoopFuture)'</p>
</blockquote>

<p>I don't entirely understand the mechanisms between an appropriate selection of <code>map</code> and <code>flatMap</code>, so that may be the cause of the issue here. Thoughts?</p>
","1064923","","","","","2019-06-04 20:23:02","Confusion over map vs. flatMap: Cannot invoke 'flatMap' with an argument list of type '(() -> EventLoopFuture)'","<swift><future><vapor>","1","2","","","","56440328","118712","118712","vapor","592","36204589","36204588"
"56511297","1","56732634","","2019-06-09 01:22:35","","0","96","<p>I have the following section of code in a controller, which queries MailGun to send an email, and then should ideally wait for a response before returning in the controller. As configured right now, this <strong>should</strong> fail as I have intentionally broken my MailGun configuration. But currently the controller is returning a success status, because the <code>.catchMap</code> functionality is not being properly awaited, and I'm not sure how to correctly structure my code so that it is. </p>

<pre class=""lang-swift prettyprint-override""><code>return emailTemplate.render(emailData, on: req).map { message -&gt; Future&lt;Response&gt; in
    let deliveryService = try req.make(EmailDeliveryService.self)
    return try deliveryService.send(message, on: req)
}.catchMap { error in
    /// this is not being awaited, and no abort is thrown before the request returns
    throw Abort(.internalServerError, reason: ""Error sending email."")
}.transform(to: savedObj)
</code></pre>

<p>The function that should be properly awaited, <code>deliverService.send</code>, has the method signature:</p>

<pre class=""lang-swift prettyprint-override""><code>func send(_ message: EmailMessage, on container: Container) throws -&gt; Future&lt;Response&gt;
</code></pre>

<p>How can I appropriately structure this code to correctly catch an error that is returned by the result of the <code>deliveryService.send</code> method?</p>
","1064923","","","","","2019-06-24 08:28:57","Swift Vapor: catchMap not being awaited","<swift><future><vapor>","1","0","","","","56511297","118712","118712","vapor","592","36204589","36204588"
"56548963","1","","","2019-06-11 17:31:55","","0","164","<p>I've a Swift Vapor app which works fine locally. I've tested the endpoints with Postman.</p>

<p>When I try to deploy the app to Google Cloud, I get the following error.</p>

<blockquote>
  <p>ERROR: (gcloud.app.deploy) Error Response: [9] 
      Application startup error:
      Fatal error: Error raised at top level:</p>
  
  <p>NIO.ChannelError.connectFailed(NIO.NIOConnectionError(host:
  ""localhost"", port: 5432, dnsAError: nil, dnsAAAAError: nil,
  connectionErrors: [NIO.SingleConnectionFailure(target:
  [IPv6]localhost/::1:5432, error: connect(descriptor:addr:size:)
  failed: Cannot assign requested address (errno: 99)),
  NIO.SingleConnectionFailure(target: [IPv4]localhost/127.0.0.1:5432,
  error: connection reset (error set): Connection refused (errno:
  111))])): file
  /home/buildnode/jenkins/workspace/oss-swift-5.0-package-linux-ubuntu-14_04/swift/stdlib/public/core/ErrorType.swift,
  line 200</p>
</blockquote>

<p>I have no clue what I am missing. This is my dockerfile. </p>

<pre><code>FROM ibmcom/swift-ubuntu:latest

LABEL Description=""App (swift) running on Docker"" Vendor=""Imthath"" Version=""1.0""


# Expose default port for App Engine
EXPOSE 7070

# Add app source
ADD . /app
WORKDIR /app

# Build release
RUN swift build --configuration release

ENTRYPOINT .build/release/Run
</code></pre>

<p>This is my app.yaml.</p>

<pre><code>runtime: custom
env: flex
</code></pre>

<p>What am I missing here? Some google searches with just the error shows that Postgres might be missing. I am using FluentPostgreSQL in my app. In that case, how to install postgres in my container? or what else should I do?</p>
","9308052","","","","","2019-06-11 17:42:24","Unable to deploy Swift Vapor app in gCloud","<swift><google-app-engine><gcloud><vapor><server-side-swift>","1","0","","","","56548963","118712","118712","vapor","592","36204589","36204588"
"56603180","1","56603373","","2019-06-14 18:03:13","","5","456","<p>I have a web app developed using server side swift vapor 3 running locally on my Mac. I want to access it using my iPhone on the same wifi as my Mac. How can I do that. I tried using <code>http://&lt;the ip of my Mac on local network&gt;:8080</code> but didn't work, even with firewall completely off. Thanks in advance.</p>
","7649191","","","","","2019-06-22 19:39:18","connecting to the vapor server running on Mac using iPhone","<swift><localhost><vapor>","2","0","1","","","56603180","118712","118712","vapor","592","36204589","36204588"
"56660814","1","","","2019-06-19 05:52:12","","1","160","<p>I've successfully gotten my Vapor app to read and write collections and documents from Firestore, but I now have a use case where a query is required.  I've followed the documentation for Firestore Queries and am using them in my iOS client successfully, which utilizes the iOS Firestore library not the REST API, but on the server I've haven't been unable to figure out how to execute the same query. The Firestore documentation seems incomplete in this area.</p>

<p>This API endpoint tool from Google does allow me to submit queries but there appears to be very little documentation on how to format the fields in the request body for the RunQuery endpoint.</p>

<p><a href=""https://developers.google.com/apis-explorer/#search/firestore/firestore/v1/firestore.projects.databases.documents.runQuery"" rel=""nofollow noreferrer"">https://developers.google.com/apis-explorer/#search/firestore/firestore/v1/firestore.projects.databases.documents.runQuery</a></p>

<p>Does anyone have experience to share on how to format the request body to create a well formed query to Firestore with the REST API?</p>

<p>FWIW, this Medium post was awesome for getting started with the REST API but stops just short of the richer Firestore requests.
<a href=""https://medium.com/rocket-fuel/getting-started-with-firebase-for-server-side-swift-93c11098702a"" rel=""nofollow noreferrer"">https://medium.com/rocket-fuel/getting-started-with-firebase-for-server-side-swift-93c11098702a</a></p>
","551551","","","","","2019-11-21 12:08:54","Are there any good examples of tutorials of the Firestore REST API RunQuery endpoint?","<google-cloud-firestore><vapor>","0","0","1","","","56660814","118712","118712","vapor","592","36204589","36204588"
"56663542","1","56664250","","2019-06-19 08:43:24","","2","974","<p>I am currently developing a Swift backend using Vapor. My iOS client uses the new iOS 13 feature ""Sign in with Apple"". When the user signs in I get an identity token (access token) which is a valid JWT token signed by Apple. This is send to the server in all ongoing communication to authenticate some routes the server provides.</p>

<p>On the server I'd like to validate that the sent token was indeed signed by Apple and is not specifically crafted by some malicious user by verifying the token signature. Apple provides a HTTP endpoint to retrieve the public key to do this: <a href=""https://developer.apple.com/documentation/signinwithapplerestapi/fetch_apple_s_public_key_for_verifying_token_signature"" rel=""nofollow noreferrer"">Apple Documentation</a>.</p>

<p>However what I am not sure about how often I have to query this endpoint to retrieve the modulus and exponent from the API and build the public key to then verify the signature. <strong>Is it sufficient enough to query this once and store the public key on the server to use this or would I need to query the HTTP endpoint in my middleware before verifying the signature (for every protected route)?</strong></p>

<p>Basically I am not sure whether the modulus and exponent will change from time to time.</p>
","720133","","","","","2019-06-19 09:21:27","Verify JWT Token Signature","<ios><swift><jwt><rsa><vapor>","1","6","1","","","56663542","118712","118712","vapor","592","36204589","36204588"
"56717976","1","","","2019-06-22 18:14:40","","2","45","<p>I am currently using Vapor for a database and have run into a roadblock I could use some help with. </p>

<p>I currently have a <code>Business</code> object, which has <code>[AccessPoint]</code> children. Each <code>AccessPoint</code>, itself has a number of <code>[AccessPointContactMethod]</code>.</p>

<p>An <code>AccessPointContactMethod</code> can reference its parent <code>AccessPoint</code> by inspecting its <code>accessPointID</code> property which is set by Vapor when creating a parent child relationship.</p>

<p>In fact, I use this to make sure that when a new <code>AccessPointContactMethod</code> is created, if the parent <code>AccessPoint</code> already has a child with the same address, we abort the post request:</p>

<pre><code>return AccessPointContactMethod.query(on: req).group(.and) { and in
            and.filter(\.contactMethodAddress == contactMethod.contactMethodAddress)
            and.filter(\.accessPointID == contactMethod.accessPointID)
            }.all()
            .flatMap(to: AccessPointContactMethod.self) { methods in
                if methods.isEmpty {
                    return contactMethod.save(on: req)
                }
                else {
                    let duplicateContactMethodStatus = HTTPResponseStatus.custom(code: 600, reasonPhrase: ""Duplicate Contact Method"")
                    throw Abort(duplicateContactMethodStatus)
                }
        }
</code></pre>

<p>So this leads me to the problem I'm having. At the moment, I only check if there are duplicate addresses in that one <code>AccessPoint</code>, but what I want to do is check all the <code>AccessPoint</code> objects belonging to the one <code>Business</code>, and if there is any <code>AccessPoint</code> that contains an <code>AccessPointContactMethod</code> with the same address, then we abort the request.</p>

<p>Therefore, it seems to me, that I need a way of getting to the <code>Business</code> grandparent object and iterating over the <code>[AccessPoint]</code> children for any duplicates.</p>

<p>Vapor, reactive programming, databases are all quite new to me, so I'm sure I haven't described this question wonderfully but if anyone can understand what I'm trying to do and has any ideas, I'd be highly appreciative!</p>
","8796676","","","","","2019-06-22 18:14:40","Finding grandparents in Vapor","<ios><swift><vapor>","0","0","","","","56717976","118712","118712","vapor","592","36204589","36204588"
"56726960","1","","","2019-06-23 18:59:07","","1","75","<p>I am making a backend using Vapor 3 and Swift 5.
On some part I'm trying to use a <code>KeyPath</code> on an associatedtype like so:</p>

<pre class=""lang-swift prettyprint-override""><code>protocol MyProtocol {
  associatedType T: Model &amp; Parameter
  // Some more declarations
}

extension MyProtocol where T.ID: Parameter {
  func myFunction(_ req: Request) throws -&gt; Future&lt;T&gt; {
    return try req.content.decode(T.self).flatMap { t in
      //Do some stuff
      let myId = t[keyPath: T.ID] //Value of type Self.T has no subscripts
                                  //Cannot create a single-element tuple with an element label
      //Do some more stuff
    }
  }
}
</code></pre>

<p>But I get that <code>Value of type Self.T has no subscripts</code> error. I looked and according to this: <a href=""https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md"" rel=""nofollow noreferrer"">https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md</a> the <code>keyPath</code> subscript is defined on an extension to <code>Any</code>, and I would asume a <code>T</code> should also be an <code>Any</code>.</p>

<p>In <code>Any</code> way (&lt;- I had to 😝), I'm sure I've seen <code>keyPath</code>s being used on generics (I don't fully understand how generics and associatedtypes are different). So does anyone have an idea what might cause the <code>keyPath</code> subscript to be unavailable in this case? Is it just because it is an associatedtype, is there any way I can make this work?</p>

<p><strong>Update</strong></p>

<p>If I erase the type of <code>t</code> by casting it to <code>Any</code> I still get the <code>no subscripts</code> error, if I cast it to <code>AnyObject</code> I don't get the subscripts error but I still get the <code>Cannot create a single-element tuple</code> which I don't understand, since I am not trying to make a tuple, I'm using a subscript.</p>
","6465042","","6465042","","2019-06-24 13:30:41","2019-06-24 13:30:41","Using KeyPaths on associatedtype objects","<swift><generics><vapor><associated-types><swift-keypath>","0","0","","","","56726960","118712","118712","vapor","592","36204589","36204588"
"56732283","1","","","2019-06-24 08:05:15","","2","913","<p>I created a swift package manager library, deployed on my gitlab with a tag number 0.1.0. I'm now trying to add this package to my new vapor project adding .package(url: ""<a href=""http://mygit.git/"" rel=""nofollow noreferrer"">http://mygit.git/</a>"", from: ""0.1.0""). When I try to make a ""vapor update"" I get a backgroundExecute error saying that my spm has no manifrst for version 0.1.0... Any idea ? Thanks in advance!</p>
","3756317","","","","","2019-06-24 08:05:15","Swift package manager - Has no manifest error","<swift><git><vapor><swift-package-manager>","0","4","","","","56732283","118712","118712","vapor","592","36204589","36204588"
"56744892","1","56747894","","2019-06-24 22:54:04","","3","682","<p>I want to make an iOS app using Vapor 3 as my backend. The model I am creating to represent my object contains some properties that will be files such as a .png and .plist files. I'm having trouble understanding how to use multipart in order to grab those files and send them to my model endpoint whenever I do a POST request.</p>

<p>I'm also confused on what data type I should be setting those file properties to be in my Model class. In the multipart docs (<a href=""https://docs.vapor.codes/3.0/multipart/overview/#content"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/multipart/overview/#content</a>) under the ""Content"" section, they say to make a Struct and they set their image to be of type Data, but also say you can make it of type File. I've also seen examples where they make it of type String. </p>

<p>I was hoping someone could clarify what exactly I should set those properties' data types to be and how I could upload those files in my Controllers/ModelController where I do the saving and call .post() in my boot(router: Router) function</p>

<p>I have already looked through the Multipart vapor docs and read through these stackoverflow posts but still don't understand what I should be doing when I try to use the post method:
- <a href=""https://stackoverflow.com/questions/55131593/vapor-upload-multiple-files-at-once"">Vapor upload multiple files at once</a>
- <a href=""https://stackoverflow.com/questions/49489067/how-to-handle-multipart-request-with-vapor-3"">How to handle multipart request with Vapor 3</a>
- <a href=""https://stackoverflow.com/questions/51476048/image-upload-in-vapor-3-using-postgresql"">Image Upload in Vapor 3 using PostgreSQL</a></p>

<p>This is my model class:</p>

<pre><code>import Vapor
import FluentMySQL

final class AppObject: Codable {
  var id: Int?
  var plistFile: String // file
  var imageFile: String // file
  var notes: String
  var name: String

  init(ipaFile: String, plistFile: String, imageFile: String, notes: String, name: String) {
    self.ipaFile = ipaFile
    self.plistFile = plistFile
    self.imageFile = imageFile
    self.notes = notes
    self.name = name
  }
}

extension AppObject: MySQLModel {}
extension AppObject: Content {}
extension AppObject: Migration {}
extension AppObject: Parameter {}
</code></pre>

<p>This is my Controller for the above model:</p>

<pre><code>import Vapor
import Fluent

struct AppObjectsController: RouteCollection {


    func boot(router: Router) throws {
        let appObjectsRoute = router.grouped(""api"", ""apps"")
        appObjectsRoute.get(use: getAllHandler)
        appObjectsRoute.post(AppObject.self, use: createHandler)
    }

    func getAllHandler(_ req: Request) throws -&gt; Future&lt;[AppObject]&gt; {
        return AppObject.query(on: req).all()
    }

    // what else should I be doing here in order to upload actual files?
    func createHandler(_ req: Request, appobject: AppObject) throws -&gt; Future&lt;AppObject&gt; {
         return appobject.save(on: req)
    }
}

</code></pre>

<p>some of the examples i've seen deal with uploading for a web app and they return a Future&lt; View > but since I am doing an iOS app, I don't know if I should be returning an HTTPResponseStatus or my model object. </p>

<p>Please help, I tried my best to word this well, I am new to Vapor</p>
","8828017","","8828017","","2019-06-24 23:46:43","2019-06-25 19:29:31","How to upload files for a model using vapor 3 for an iOS app","<swift><file-upload><multipartform-data><vapor>","1","0","","","","56744892","118712","118712","vapor","592","36204589","36204588"
"56756494","1","","","2019-06-25 14:35:03","","1","62","<p>I have users and groups in my system. Users belong to groups using a sibling relationship. I need to transform the Users/Groups into an Array of users/groups to return to the client. When I lookup a user I get a Future, if I then map the use and attempt to access its groups I get a Future.  </p>

<p>What is the best way of handling nested futures so I can get to the actual data and munge it?</p>

<pre class=""lang-swift prettyprint-override""><code>struct ReturnUserStruct {
   var userId: Int
   var primaryGroupName: String
}

let futureUsers = Users.query(on: request).all()

futureUsers.map { users in
    var returnUsersArray&lt;returnUserStruct&gt; = []

    users.ForEach { user in
      var returnUserStruct: ReturnUserStruct
      returnUserStruct.userId = user.id

// This a sibling relationship that returns a Future 
      primaryGroupFuture = user.primaryGroup
      primaryGroupFuture.map { group in 
        returnUserStruct.primaryGroupName = group.name
      }

      returnUsersArray.append(returnUserStruct)
   }

return returnUsersArray

</code></pre>

<p>This code doesn't work.  The map call are obviously scheduled asynchronously and returnUsersArray ends up empty.  I can rearrange this and get the user ids into the return array but haven't figured out a good way to get the groupName.</p>
","11375271","","11375271","","2019-06-25 14:54:39","2019-06-26 20:20:01","What is the best way to handle nested futures?","<fluent><vapor>","1","3","","","","56756494","118712","118712","vapor","592","36204589","36204588"
"56765102","1","","","2019-06-26 04:17:51","","2","249","<p>I am writing an API using the server side swift framework Vapor. My model is very simple. I have a <code>Workout</code> table, which has a to many relationship to the <code>Circuit</code> table, which has a to many relationship with the <code>Exercise</code> table. When the api consumer creates a workout, the json contains all circuits and exercises in the workout. Here is an example:</p>

<pre><code>{
    ...
    circuits: [{
        ...,
        exercises: [{
            ""title"": ...
        }, {
            ""title"": ...
        }]
    }, {
        ...,
        exercises: [{
            ""title"": ...
        }, {
            ""title"": ...
        }]
    }]
}
</code></pre>

<p>The problem I am running into is duplicate exercises being created, when the user has the same exercise in multiple circuits. I query the db before creating a new exercise, but it seems like the saves are all happening asynchronously, which prevents me from detecting an existing exercise with the same id/title in the db before saving a new one. Here is my code:</p>

<pre><code>private func saveExercise(on conn: DatabaseConnectable, with content: WorkoutCreateExerciseContent, for authUser: User) throws -&gt; Future&lt;Exercise&gt; {

        if let exerciseId: UUID = content.id {

            return Exercise.find(exerciseId, on: conn)
                .unwrap(or: Abort(.badRequest, reason: ""No exercise for id: \(exerciseId.uuidString)""))

        } else if let title: String = content.title, let isPublicallyVisible: Bool = content.isPublicallyVisible {

            return Exercise.query(on: conn).filter(\.title == title).filter(\.directions == content.directions).first().flatMap({ (possibleMatchingExercise: Exercise?) -&gt; Future&lt;Exercise&gt; in

                if let matchingExercise: Exercise = possibleMatchingExercise {

                    return conn.future(matchingExercise)

                } else {
                    print(""xxx Found no match for \(title)"")
                    let newExercise: Exercise = Exercise(
                        title: title,
                        directions: content.directions,
                        isPublicallyVisible: isPublicallyVisible
                    )
                    newExercise.userId = authUser.id
                    return newExercise.save(on: conn)

                }

            })

        } else {

            throw Abort(.badRequest, reason: """"""
                Bad data for exercise. Expecting either of the following:
                {
                    /""id/"": /""some id/""
                }
                or
                {
                    /""title/"": /""some title/""
                    /""directions/"": /""(optional)/"",
                    /""isPublicallyVisible/"": false
                }
                id takes priority over other properties.
            """""")
        }

    }

    private func saveCircuit(on conn: DatabaseConnectable, with content: CircuitCreateContent, order: Int, workoutId: UUID, authUser: User) throws -&gt; Future&lt;Circuit&gt; {

        return try content.exercises.map({ (exerciseContent: WorkoutCreateExerciseContent) throws -&gt; Future&lt;Exercise&gt; in

            let createdExercise: Future&lt;Exercise&gt; = try self.saveExercise(
                on: conn,
                with: exerciseContent,
                for: authUser
            )

            return createdExercise

        })
        .flatten(on: conn)
        .flatMap({ (exercises: [Exercise]) -&gt; Future&lt;Circuit&gt; in

            let circuit: Circuit = Circuit(
                workoutId: workoutId,
                order: order,
                exerciseDuration: content.exerciseDuration,
                restDuration: content.restDuration,
                exerciseIDs: exercises.compactMap({ $0.id })
            )

            return circuit.save(on: conn)

        })

    }

    func saveWorkout(_ conn: DatabaseConnectable,  _ authentiatedUser: User, _ content: WorkoutCreateContent) throws -&gt; Future&lt;Workout&gt; {

        let workout: Workout = content.makeWorkout()

        workout.userId = authentiatedUser.id

        // First save the exercises

        let createdWorkout: Future&lt;Workout&gt; = workout.save(on: conn).flatMap({ (savedWorkout: Workout) -&gt; Future&lt;Workout&gt; in

            let createdCircuits: Future&lt;[Circuit]&gt; = try content.circuits.enumerated().map({ (order: Int, circuitContent: CircuitCreateContent) throws -&gt; Future&lt;Circuit&gt; in

                let createdCircuit: Future&lt;Circuit&gt; = try self.saveCircuit(
                    on: conn, with: circuitContent,
                    order: order,
                    workoutId: savedWorkout.id!,
                    authUser: authentiatedUser
                )

                return createdCircuit

            })
            .flatten(on: conn)

            return createdCircuits.then({ _ -&gt; Future&lt;Workout&gt; in
                return conn.future(savedWorkout)
            })

        })

        return createdWorkout

    }
</code></pre>

<p>Does anyone see what I'm missing here? Is there a way to wait for a <code>Future</code> to fulfill before starting a new <code>Future</code>? I am new to Vapor, so I'm not that familiar with Vapor's fluent api.</p>
","1402027","","1402027","","2019-06-26 05:28:38","2020-02-18 17:30:49","Wait for async task to complete in request in Vapor","<swift><fluent><vapor><server-side-swift><vapor-fluent>","1","0","","","","56765102","118712","118712","vapor","592","36204589","36204588"
"56871705","1","56899036","","2019-07-03 13:51:58","","2","62","<p>I'm having issues importing multiple private repositories, I seem to be able to do it with 1.
So I am wondering if anyone can tell me what it is I'm doing wrong.
My Project structure is like this:
Inside the root of the project where Package.swift resides:</p>

<pre><code>--.ssh
    --config
    --model
    --model.pub
    --service
    --service.key
</code></pre>

<p>Contents of package.swift:</p>

<pre><code>import PackageDescription

let package = Package(
    name: ""Server"",
    products: [
        .library(name: ""Seerver"", targets: [""App""]),
    ],
    dependencies: [
        // 💧 A server-side Swift web framework.
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),

        // 🔵 Swift ORM (queries, models, relations, etc) built on SQLite 3.
        .package(url: ""https://github.com/vapor/fluent-sqlite.git"", from: ""3.0.0""),

        .package(url: ""git@github.com:SwiftEverywhere/Model.git"", .branch(""master"")),

        .package(url: ""git@service.github.com:SwiftEverywhere/Service.git"", .branch(""master""))
    ],
    targets: [
        .target(name: ""App"", dependencies: [""FluentSQLite"", ""Vapor"", ""Model"", ""Service""]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [""App""])
    ]
)
</code></pre>

<p>Contents of config:</p>

<pre><code>Host github.com
    HostName github.com
    User git
    IdentityFile ./.ssh/model
Host service.github.com
    HostName github.com
    User git
    IdentityFile ./.ssh/service
</code></pre>

<p>I added the keys to their respective repositories as deploy keys. I am not able to use the same key on different repositories. I thought I was able to do it by changing the host to service.github.com to make it use the other key but it seems to not be working like this. I also tried changing the user and the hostname but it's not doing the trick.</p>

<p>The error I'm receiving when running 'vapor update' is ""Could not read from remote repository. Please make sure you have the correct access rights and the repository exists""</p>

<p>If I remove the service dependency it does work, so that must be where I made a mistake. Thanks in advance!</p>

<p>tldr; Basically I need to know how to configure the config file and/or the package.swift to use the right deploy key.</p>
","11734773","","11734773","","2019-07-04 05:17:30","2019-07-08 07:31:17","Error importing multiple private repositories with vapor","<swift><ssh><vapor><swift-package-manager>","1","2","","","","56871705","118712","118712","vapor","592","36204589","36204588"
"57017116","1","57019932","","2019-07-13 07:35:55","","1","141","<p>When using Vapor to build a API, always use a method to fetch a object, </p>

<p><code>request.parameters.next(type.self)</code></p>

<p>It seems a method to extract the url parameter, why it return the result from the database ? Could not found any clues from the framework's source code. How can I find the answer ? Thanks.</p>
","1122446","","","","","2019-07-13 15:26:16","How does request.parameters.next work in Vapor mechanism?","<vapor>","1","4","","","","57017116","118712","118712","vapor","592","36204589","36204588"
"57096321","1","","","2019-07-18 14:00:19","","1","129","<p>I have this insert:</p>

<pre><code>conn.insert(into: MyModel.self).values(rates).run()
</code></pre>

<p>Where <code>MyModel</code> conforms to <code>PostgreSQLModel</code> and <code>rates</code> is <code>[MyModel]</code>. I cannot grok the syntax for upsert which I have found solutions to <a href=""https://stackoverflow.com/a/54408370/6444"">here</a> in the context of inserting multiple rows.</p>

<p>Thanks for any assistance.</p>
","6444","","6444","","2019-07-18 14:37:30","2019-07-18 14:37:30","How to “upsert” multiple records at once with Vapor 3 / PostgresSQL","<swift><postgresql><fluent><vapor>","0","1","","","","57096321","118712","118712","vapor","592","36204589","36204588"
"57129968","1","","","2019-07-21 02:39:47","","1","75","<p>Can't save to postgreSQL Database while in a Vapor Websocket request</p>

<p>I have tried converting to json, parsing json, and implementing normal routing save methods.</p>

<pre><code>//TODO:- Connection Websockets to Models
    socketServer.get(""api/channel"") { ws, req in
        print(""Channel Connected \(req)"")

//Attempted with On Text Method
        ws.onText { ws, text in
            ws.send(""This is pure text \(text)"")
            print(text)

        }

//Attempted with On Binary Method
    ws.onBinary { (ws, data) in
        ws.send(""data \(data)"")
        print(data)

        do {
            let received = try JSONDecoder().decode(ChannelCreateData.self, from: data)

            let account = try ws.requireAuthenticated(CreateAccount.self)

            let channel = try Channel(imageString: received.imageString ?? """", channel: received.channel, createAccountID: account.requireID())
            return channel.save(on: ws)


        } catch {
            print(""error"")
        }
    }
}
</code></pre>

<p>I expect that when data is received from the user using the websocket that data will be saved to my .psql database.</p>
","10478097","","","","","2019-07-21 02:39:47","How to save to a database in a Vapor Websocket","<swift><database><postgresql><websocket><vapor>","0","0","","","","57129968","118712","118712","vapor","592","36204589","36204588"
"57211288","1","","","2019-07-25 23:26:27","","1","278","<p>I have a <strong>Group</strong>, <strong>User</strong> and an <strong>App</strong> model. Within my Group model, I have a property <code>var apps: [App]</code> and I create a sibling relationship bw Group and User. </p>

<p>In my WebsiteController, I have 2 handlers: </p>

<ol>
<li><code>createGroupHandler</code> which handles the <strong>GET</strong> request at <strong>/groups/create</strong></li>
<li><code>createGroupPostHandler</code> which handles the <strong>POST</strong> request at <strong>/groups/create</strong></li>
</ol>

<p>My problem is that after selecting app objects in my form in my <strong>createGroup.leaf</strong> template, when I create my new group no apps are being populated into my apps array. </p>

<p>I created structs to represent the context being rendered in my <code>createGroupHandler</code> and to handle the data being passed in the post request for <code>createGroupPostHandler</code></p>

<pre><code>struct CreateGroupContext: Encodable {
    let title = ""Create Group""
    let users: Future&lt;[User]&gt;
    let apps: Future&lt;[App]&gt;
}

struct CreateGroupData: Content {
    let name: String
    let apps: [App]
    let users: [String]?
}
</code></pre>

<p>The apps are properly loaded into the form but despite selecting them like in the image below, they aren't added to the array <a href=""https://i.stack.imgur.com/HN5gs.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/HN5gs.png"" alt=""enter image description here""></a></p>

<p>My <code>createGroupPostHandler</code> looks like below. <strong>I don't know how to grab the selected apps and populate my <code>apps: [App]</code> array when I create my group is my issue</strong>, I feel like this is where I should be doing that, but I don't know how to grab that from the Leaf template.</p>

<pre><code>func createGroupPostHandler(_ req: Request, data: CreateGroupData) throws -&gt; Future&lt;Response&gt; {
        let group = Group(name: data.name, apps: data.apps)
        return group.save(on: req).flatMap(to: Response.self) { group in
            guard let id = group.id else {
                throw Abort(.internalServerError)
            }

            var userSaves: [Future&lt;Void&gt;] = []
            for user in data.users ?? [] {
                try userSaves.append(User.addUser(user, to: group, on: req))
            }

            let redirect = req.redirect(to: ""/groups/\(id)"")
            return userSaves.flatten(on: req).transform(to: redirect)
        }
    }
</code></pre>

<p>This is what my createGroup.leaf looks like: <a href=""https://i.stack.imgur.com/Jyqmc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Jyqmc.png"" alt=""enter image description here""></a></p>
","8828017","","8828017","","2019-07-26 17:05:19","2019-08-20 09:18:38","Vapor 3 - How to populate array property of model from Leaf template form","<swift><forms><vapor><server-side-swift><leaf>","1","1","","","","57211288","118712","118712","vapor","592","36204589","36204588"
"57233795","1","57250547","","2019-07-27 16:00:15","","0","161","<p>I am trying to call a 3rd Party API when a Client goes to a specific route using Swift and Vapor 3; however, I am met with errors despite being able to make the call.</p>

<p>I have taken steps to ensure the error is caused by the get request to the API. Currently, I do nothing with the request other than print the response. Removing the request stops the error from happening.</p>

<pre><code>// Route the user to HomePage
router.get { req -&gt; Future&lt;View&gt; in
    let token: String = ""THATS_MY_TOKEN""
    let client = try req.client()
    let bcmsrequest = try client.get(""https://api.buttercms.com/v2/posts/?page=1&amp;page_size=10&amp;auth_token="" + token)
    print(bcmsrequest)
    print(""This line prints."")
    // Removing the above get request stops the error below from happening
    return try req.view().render(""welcome"")
}

// Here is the stdout printed by the server process:
Server starting on http://localhost:8080
NIO.EventLoopFuture&lt;Vapor.Response&gt;
This line prints.
2019-07-27 11:49:12.249196-0400 Run[6348:121267] [] nw_endpoint_get_type called with null endpoint
2019-07-27 11:49:12.249420-0400 Run[6348:121267] [] nw_endpoint_get_type called with null endpoint, dumping backtrace:
        [x86_64] libnetcore-1872
    0   libnetwork.dylib                    0x00007fff6d188fc8 __nw_create_backtrace_string + 120
    1   libnetwork.dylib                    0x00007fff6ce12af4 nw_endpoint_get_type + 180
    2   libboringssl.dylib                  0x00007fff6b6e3af2 nw_protocol_boringssl_get_subject_name + 178
    3   libboringssl.dylib                  0x00007fff6b6e6997 nw_protocol_boringssl_connected + 916
    4   libnetwork.dylib                    0x00007fff6ce5d145 nw_socket_handle_socket_event + 1733
    5   libdispatch.dylib                   0x00000001017fd82f _dispatch_client_callout + 8
    6   libdispatch.dylib                   0x0000000101800689 _dispatch_continuation_pop + 585
    7   libdispatch.dylib                   0x0000000101816608 _dispatch_source_invoke + 2135
    8   libdispatch.dylib                   0x0000000101807665 _dispatch_workloop_invoke + 3477
    9   libdispatch.dylib                   0x0000000101813025 _dispatch_workloop_worker_thread + 676
    10  libsystem_pthread.dylib             0x000000010188f343 _pthread_wqthread.cold.1 + 125
    11  libsystem_pthread.dylib             0x0000000101889196 _pthread_wqthread + 203
    12  libsystem_pthread.dylib             0x0000000101889057 start_wqthread + 15
</code></pre>

<p>I can see that a Future Object is being printed out, I would expect to see response content (a JSON string) - but I believe that the response has no content and is actually failing to make a request at all.</p>
","8156559","","8387516","","2019-07-28 13:52:36","2019-07-29 09:09:53","Failing To Call 3rd Party API in Vapor Route","<swift><get><response><vapor>","1","1","","","","57233795","118712","118712","vapor","592","36204589","36204588"
"57269353","1","","","2019-07-30 10:14:59","","0","105","<p>I am making a web application in Vapor. </p>

<p>I have an array of things, e.g : </p>

<blockquote>
  <p>[""thing"", ""other thing"", ""third thing""]</p>
</blockquote>

<p>I want to make empty string variables with the same names but <code>"" ""</code> replaced with <code>""+""</code> in a struct.</p>

<p>I cannot use a dictionary or an array as vapor wants individual variables in strings. The reason I cannot write them all manually is that I want to be able to add things to my array and not have to also add them somewhere else. </p>

<p>I can do the replacing by myself, I just need to know if it is possible to make variables out of the array elements.</p>

<p>I am new to Swift, I do not know where to start.</p>

<p>Thanks for helping</p>
","11160293","","10495029","","2019-07-30 11:37:30","2019-08-04 07:57:56","Swift Array elements to variables","<swift><vapor>","2","7","","","","57269353","118712","118712","vapor","592","36204589","36204588"
"57335147","1","57335972","","2019-08-03 02:59:08","","1","278","<p>I have Vapor 3 server api and iOS app. 
When I do requests to server and throw an error for example like this (I throw it on server): </p>

<pre><code>throw Abort(.badRequest)
</code></pre>

<p>in iOS app in response <code>error == nil</code>, and if I transform the response data to a string, I can see:</p>

<blockquote>
  <p>{""error"":true,""reason"":""Bad Request""}</p>
</blockquote>

<p>I tried to add <code>ErrorMiddleware</code> to services. That did not work for me.</p>

<pre><code>// Request on iOS side:
func saveComment(post: Post, text: String, completion: @escaping (Result&lt;Comment, Error&gt;) -&gt; Void) {

    var cmps = urlComps
    cmps.path = ""/api/save-post""

    let url = cmps.url!

    var request = URLRequest(url: url)
    request.httpMethod = HTTPMethod.post
    request.setValue(""application/json"", forHTTPHeaderField: ""Content-Type"")

    struct NewComment: Codable {
        let postId: String
        let text: String
    }

    let newComment = NewComment(postId: post.id.uuidString, text: text)
    let body = try! JSONEncoder().encode(newComment)

    request.httpBody = body

    let session = URLSession.shared.dataTask(with: request) { data, response, err in
        // this error comes as nil
        if let err = err {
            completion(.failure(err))
            return
        }

        // if I do String(data: data!, encoding: .utf8)!
        // it becomes: {""error"":true,""reason"":""Bad Request""}

        do {
            let comment = try JSONDecoder().decode(Comment.self, from: data!)
            completion(.success(comment))

        } catch {
            completion(.failure(error))
        }
    }

    session.resume()
}
</code></pre>

<pre><code>// Response on Vapor server side:
func addComment(req: Request) throws -&gt; Future&lt;Comment.FormattedComment&gt; {

    let user = try req.requireAuthenticated(User.self)

    guard user.canAddComments &gt; 0 else { throw Abort(.badRequest) }
// here I throw error 

    return try req.content.decode(Comment.NewComment.self).flatMap(to: Comment.FormattedComment.self) { comment in

        let newComment = Comment(id: nil, userId: user.id!, postId: comment.postId, text: comment.text, date: Date(), isGiven: false)
        return newComment.save(on: req).map {
            return $0.formatted()
        }

    }
}
</code></pre>

<p>I would like to get error as an error from request. Not in data.</p>
","7234482","","2598316","","2019-08-03 03:01:40","2019-08-03 06:23:30","Errors throws from Vapor server come as String, not as Error in response","<swift><error-handling><vapor>","1","0","","","","57335147","118712","118712","vapor","592","36204589","36204588"
"57373950","1","57389747","","2019-08-06 10:25:56","","0","78","<p>In writing tests for my Vapor 3 app, I've run into an issue where a certain framework is reliant on checking the incoming requests hostname</p>

<pre><code>guard let peerHostName = request.http.remotePeer.hostname else {
            throw Abort(
                .forbidden,
                reason: ""Unable to verify peer""
            )
        }
</code></pre>

<p>It would seem that when testing a request like below</p>

<pre><code>let emails = (0...10).map { ""email@test.co""}
let responder = try app.make(Responder.self)
let request = HTTPRequest(method: .POST, url: URL(string: ""\(usersURI)/create"")!, headers: headers)
let wrappedRequest = Request(http: request, using: app)
try wrappedRequest.content.encode(createUserReq)
try responder.respond(to: wrappedRequest)
</code></pre>

<p>Then the requests hostname is empty and thus an error is thrown. Is there any way I can manually set the hostname of the request? The <code>hostname</code> property is get only, so I can't set it that way</p>
","2422230","","","","","2019-08-07 08:08:57","Set hostname on HTTPRequest for testing","<swift><vapor>","1","1","","","","57373950","118712","118712","vapor","592","36204589","36204588"
"57390714","1","57390767","","2019-08-07 09:04:17","","-1","63","<p>Vapor 3 uses the variable name defined in the model as the column name in the database. This is not ideal as for Swift I'd like to use standard lower camel case notation and for the database lower case with underscores.</p>

<p>Is there a way to define the column names in Vapor separately from the variable name?</p>
","10826194","","","","","2019-08-07 09:07:01","How to customize column name?","<swift><postgresql><vapor>","1","1","","","","57390714","118712","118712","vapor","592","36204589","36204588"
"57398309","1","57401477","","2019-08-07 15:59:28","","-1","107","<p>I'm trying to add a column index to a PostgreSQL table using Vapor. I found several tutorial doing this, but none of those code snippets work with the current version.</p>
","10826194","","9223839","","2019-08-07 16:01:47","2019-08-08 05:39:03","How to add an index to a postgres table?","<postgresql><vapor>","2","0","","","","57398309","118712","118712","vapor","592","36204589","36204588"
"57422469","1","57436591","","2019-08-09 01:30:52","","2","169","<p>I use docker to compose Vapor, PostgreSQL and Nginx for a project, my docker-compose.yml like this:</p>

<pre><code>version: ""3.6""

services:
    vapor:
        build:
            context: ./vapor
        image: ${CURRENT_VAPOR_IMG}
        ports:
            - 8080:8080
        volumes:
            - ${HOST_ROOT}:${CONTAINER_ROOT}
        working_dir: ${CONTAINER_ROOT}
        tty: true
        entrypoint: bash
        networks:
            - x-net

    nginx:
        build:
            context: ./nginx
        image: ${CURRENT_NGINX_IMG}
        ports:
            - ${HOST_HTTP_PORT}:80
        volumes:
            - ${HOST_ROOT}:${CONTAINER_ROOT}
        networks:
            - x-net

    psql:
        image: ${CURRENT_DB_IMG}
        ports:
            - 5432:5432
        environment:
            - POSTGRES_DB=xxx
            - POSTGRES_USER=xxx
            - POSTGRES_PASSWORD=pass
        volumes:
            - ~/x/x-db:/var/lib/postgresql/data
    networks:
        - x-net

networks:
    x-net:
         driver: bridge
</code></pre>

<p>After I start all the container by running docker-compose up, then enter to vapor's container to build &amp;&amp; run the project, it will prompt an error to the console:</p>

<pre><code>NIO.ChannelError.connectFailed(NIO.NIOConnectionError(host: ""localhost"", port: 5432, dnsAError: nil, dnsAAAAError: nil, connectionErrors: [NIO.SingleConnectionFailure(target: [IPv6]localhost/::1:5432, error: connection reset (error set): Connection refused (errno: 61)), NIO.SingleConnectionFailure(target: [IPv4]localhost/127.0.0.1:5432, error: connection reset (error set): Connection refused (errno: 61))]))
</code></pre>

<p>Then I run the vapor project on local machine and keep the psql container running, it works normally, such as finished the first migration with models.</p>

<p>Is there any mistakes on my configuration of docker or any others?</p>
","1122446","","1122446","","2019-08-10 10:43:43","2019-08-10 10:43:43","Vapor + PostgreSQL + Nginx build on Docker not operation properly","<vapor><vapor-fluent>","2","0","","","","57422469","118712","118712","vapor","592","36204589","36204588"
"57449948","1","57451376","","2019-08-11 12:29:35","","3","225","<p>So I'm trying to call a second endpoint in one of my Vapor endpoints. I have one endpoint that is just a get and works good:</p>

<pre><code>router.get(""status"") { req -&gt; Future&lt;ConnectionResponse&gt; in
  let client = try req.make(Client.self)
  let response = client.get(""https://url.com/endpoint/"")

  return response.flatMap(to: ConnectionResponse.self, { response in
    return try response.content.decode(ConnectionResponse.self)
  })
}
</code></pre>

<p>This returns correctly a ConnectionResponse json. When I try to do the same, but in a POST that needs some parameters, I can't figure out why the compiler doesn't let me run:</p>

<pre><code>router.post(""purchase"") { req -&gt; Future&lt;ConnectionResponse&gt; in
  return try req.content.decode(PurchaseRequest.self).map(to: ConnectionResponse.self, { response in
    let client = try req.make(Client.self)
    let response = client.get(""https://url.com/endpoint/"")

    return response.flatMap(to: ConnectionResponse.self, { response in
      return try response.content.decode(ConnectionResponse.self)
    })
  })
}
</code></pre>

<p>It fails on the <code>flatMap</code> saying <code>Cannot convert return expression of type 'EventLoopFuture&lt;ConnectionResponse&gt;' to return type 'ConnectionResponse'</code>.</p>

<p>As you can see, the <code>purchase</code> GET call is the same as the <code>status</code> apart from the initial decoding of the POST parameters. What am I doing wrong? </p>
","2982767","","","","","2019-08-17 09:15:52","Vapor: Call REST API inside router POST call with parameters","<swift><vapor>","1","0","1","","","57449948","118712","118712","vapor","592","36204589","36204588"
"57499340","1","57529349","","2019-08-14 17:21:53","","2","135","<p>I have a middleware which fetches a token if there is no one to be found in Redis.</p>

<pre class=""lang-swift prettyprint-override""><code>struct TokenMiddleware: Middleware, TokenAccessor {

  func respond(to request: Request, chainingTo next: Responder) throws -&gt; Future&lt;Response&gt; {
    guard let _ = request.http.headers.firstValue(name: HTTPHeaderName(""Client-ID"")) else {
      throw Abort(.badRequest, reason: ""missing 'Client-ID' in header"")
    }
    guard request.clientID.isEmpty == false else {
      throw Abort(.badRequest, reason: ""'Client-ID' in header is empty"")
    }
    guard let _ = request.http.headers.firstValue(name: HTTPHeaderName(""Client-Secret"")) else {
      throw Abort(.badRequest, reason: ""missing 'Client-Secret' in header"")
    }
    /// getToken fetches a new Token and stores it in Redis for the controller to use
    return try self.getToken(request: request).flatMap(to: Response.self) { token in
      return try next.respond(to: request)
    }

  }

}

extension TokenMiddleware: Service {}
</code></pre>

<p>But this causes multiple processes fetching new tokens on their own and therefore a race condition.</p>

<p>How can I handle this in vapor?</p>
","766747","","","","","2019-08-16 18:18:12","Vapor: How to coordinate multiple requests until one central one is done","<swift><vapor>","1","0","1","","","57499340","118712","118712","vapor","592","36204589","36204588"
"57548334","1","57552322","","2019-08-18 21:00:29","","1","56","<p>I have a Vapor app where I want some values to be specified by the user in a POST request, and other values to be computed based on the user-specified values.</p>

<p>For example, suppose the user patches in some new values, and each time that happens the table should automatically update a column with the current time.</p>

<p>I was looking at trying to store the computed properties in the database, but when I modified the model to know about the computed properties, all my POST requests began expecting those to be specified.</p>

<p>What's the most idiomatic way to have columns in a table that don't have to be specified by the post requests?</p>
","4943322","","4943322","","2019-08-18 23:12:33","2019-08-19 07:55:50","How to have columns in table that don't have to be specified in post request","<vapor>","2","0","","","","57548334","118712","118712","vapor","592","36204589","36204588"
"57549145","1","57553432","","2019-08-18 23:46:13","","1","47","<p>How can I use my own domain when hosting on vapor cloud?</p>

<p>I have never written an API before and just started playing around with Vapor, I purchased a domain from godaddy and would like my API to use that for my routes instead of the domain Vapor is creating ex ""appname.vapor.cloud""</p>
","4109016","","","","","2019-08-19 08:57:42","How can I use my own domain with vapor cloud","<vapor><vapor-cloud>","1","0","","","","57549145","118712","118712","vapor","592","36204589","36204588"
"57582966","1","","","2019-08-21 00:19:15","","1","77","<p>I'm using Vapor for an API, with the PostgreSQL driver (no fluent). In my controller, I want to return the inserted/updated item, I found there is a <code>returning</code> function in the driver which takes an object of type <code>PostgreSQLSelectExpression</code>.  Vapor's documentation is terrible, and I've found no examples on how to use this function. </p>

<p>So I'd like to know what should I pass to the function if I wanted to get all columns, one column, and multiple (but not all) columns, and also if it is possible to give aliases to the columns.</p>

<p>To be clear: I understand how the <code>returning</code> clause works using raw SQL, but I really prefer to use the query builder if there is a built in way to do this.</p>

<p><strong>Update</strong></p>

<p>To be more specific about what I'm asking here: I want to know is how do I get a <code>PostgreSQLSelectExpression</code> since the documents for it are really confusing. I tried using <code>KeyPath</code>s but it doesn't work.</p>

<p>So the question is: how do I get a <code>PostgreSQLSelectExpression</code> that gets me back (a) all the columns (b) a single column and (c) multiple but not all columns.</p>

<p>Given:</p>

<pre class=""lang-swift prettyprint-override""><code>//MyModel.swift
struct MyModel: SQLTable {
    var id: Int?
    var name: String
    var age: Int
}

//MyModelController.swift
connection.insert(into: MyModel.self)
.value(myModel)
.returning(/*what should I use here to get a, b, and c?*/)
</code></pre>
","6465042","","6465042","","2019-08-21 03:46:29","2019-08-21 03:46:29","How to use returning with Vapor's PostgreSQL driver","<swift><postgresql><vapor><sql-returning>","0","1","","","","57582966","118712","118712","vapor","592","36204589","36204588"
"57586149","1","57586300","","2019-08-21 07:02:23","","-1","217","<p>I need an advise from an experienced Swift developer who have used Vapor framework. </p>

<p>I was planning to use php to create a control panel for an iOS and Android apps, but I was told to use Vapor <code>http://vapor.codes/</code> instead of it. </p>

<p>Can anyone answer this question I have about Vapor? Searching internet didn't give me much answers and created some confusion.</p>

<ul>
<li>When Vapor is ready, will we have a front end for it? I mean a user interface. Like I would have if the backend was created using php, and it's frontend using Bootstrap?</li>
</ul>
","10608828","","","","","2019-08-21 07:12:07","Using Swift Vapor instead of PHP","<ios><swift><vapor>","1","3","","2019-08-21 08:56:44","","57586149","118712","118712","vapor","592","36204589","36204588"
"57676112","1","57681055","","2019-08-27 13:48:05","","0","165","<p>How do I add a default value for a non-optional field in a fluent migration?
I currently have this error:</p>

<pre><code>⚠️ PostgreSQL Error: column ""firstName"" contains null values
</code></pre>

<p>my only options are</p>

<pre><code>public func field&lt;T&gt;(for key: KeyPath&lt;Self.Model, T&gt;, isIdentifier: Bool? = nil)
public func field&lt;T&gt;(for key: KeyPath&lt;Self.Model, T&gt;, type: Self.Model.Database.SchemaFieldType)
</code></pre>

<p><strong>EDIT:</strong> Thanks to Tim's answer, the solution is:</p>

<pre><code>static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return Database.update(User.self, on: conn) { builder in
            builder.field(for: \User.firstName, type: .text, .default(.literal("""")))
        }
    }
</code></pre>
","743923","","743923","","2019-08-28 10:28:26","2019-08-28 10:28:26","Add a default value in migration in Vapor","<swift><vapor><vapor-fluent>","1","1","","","","57676112","118712","118712","vapor","592","36204589","36204588"
"57698195","1","","","2019-08-28 18:27:40","","0","55","<p>One of my Vapor app endpoints needs to be able to receive arbitrary JSON and output it to the logs. Once I have the logs, I can go back through and set up Codables structs and do the typical Vapor workflow.</p>
","4943322","","","","","2019-08-31 13:30:37","How to output any JSON sent to endpoint?","<vapor>","2","0","","","","57698195","118712","118712","vapor","592","36204589","36204588"
"57751925","1","","","2019-09-02 05:44:14","","2","288","<p>I have a Vapor backend that I wrote a few tests for.</p>

<p>The test code looks like this:</p>

<pre class=""lang-swift prettyprint-override""><code>    func testFollowUser() throws {
        user = try user.save(on: conn).wait()

        let userToFollow = try User(firstName: ""Friedrich"", lastName: ""Nietzsche"", email: ""f.nietzsche@gmail.com"", passwordHash: User.TestValues.passwordHash).save(on: conn).wait()

        let req = UserListRequest(ids: [userToFollow.id!])

        XCTAssert(try user.followers.query(on: conn).count().wait() == 0)
        XCTAssert(try userToFollow.followees.query(on: conn).count().wait() == 0)

        let res = try app.sendRequest(to: ""/me/following"", method: .PUT, body: req, isLoggedInRequest: true)

        //sleep(4)

        XCTAssert(res.http.status == .noContent, ""Returned \(res.http.status)"")
        XCTAssert(try user.followers.query(on: conn).count().wait() == 1)
        XCTAssert(try userToFollow.followees.query(on: conn).count().wait() == 1)
        XCTAssert(try user.followers.query(on: conn).first().wait()?.id == userToFollow.id)

        _ = userToFollow.delete(on: conn)
    }
</code></pre>

<p>(The sendRequest(to:method:body:isLoggedInRequest) waits for the request to finish using .wait())</p>

<p>And the function beeing tested looks like this:</p>

<pre class=""lang-swift prettyprint-override""><code>    func followUsers(_ req: Request) throws -&gt; Future&lt;HTTPStatus&gt; {
        let user = try req.requireAuthenticated(User.self)
        return try req.content.decode(UserListRequest.self).flatMap { userListRequest -&gt; EventLoopFuture&lt;HTTPStatus&gt; in
            userListRequest.ids.map { idToFollow -&gt; EventLoopFuture&lt;User?&gt; in
                return User.find(idToFollow, on: req)
            }.flatten(on: req).map {
                maybeUsersToFollow -&gt; Future&lt;[FollowPivot]&gt; in
                var futureArray: [Future&lt;FollowPivot&gt;] = []
                for maybeUserToFollow in maybeUsersToFollow {
                    if let userToFollow = maybeUserToFollow {
                        let pivot = try FollowPivot(user, userToFollow).save(on: req)
                        futureArray.append(pivot)
                    }
                }
                return futureArray.flatten(on: req)
            }.transform(to: req.future(HTTPStatus(statusCode: 204)))
        }
    }
</code></pre>

<p>When I execute the test it fails. If I add ""sleep(4)"" in the test method the tests passes. I therefore assume, that the Postgres operation within the database is not finished when the XCTAssert is executed.</p>

<p>I changed the function code above to:</p>

<pre class=""lang-swift prettyprint-override""><code>    func followUsers(_ req: Request) throws -&gt; Future&lt;HTTPStatus&gt; {
        let user = try req.requireAuthenticated(User.self)
        return try req.content.decode(UserListRequest.self).flatMap { userListRequest -&gt; EventLoopFuture&lt;HTTPStatus&gt; in
            userListRequest.ids.map { idToFollow -&gt; EventLoopFuture&lt;User?&gt; in
                return User.find(idToFollow, on: req)
            }.map { maybeUserToFollowFuture -&gt; Future&lt;Void&gt; in
                maybeUserToFollowFuture.then {
                    maybeUserToFollow in
                    if let userToFollow = maybeUserToFollow {
                        do {
                            return try FollowPivot(user, userToFollow)
                                .save(on: req)
                                .transform(to: req.future())
                        } catch {}
                    }
                    return req.future()
                }
            }.flatten(on: req)
            .transform(to: req.future(HTTPStatus(statusCode: 204)))
        }
    }
</code></pre>

<p>The test now succeeds, but in my opinion the code is rather bad.</p>

<p>How do I properly process an <code>[EventLoopFuture&lt;Type&gt;]</code> to <code>[EventLoopFuture&lt;OtherType&gt;]</code> while guaranteeing that succeeding map transformation operations are only executed after all the futures within the array have been fulfilled? 
Why does my first <code>followUser(on:)</code> not work properly? Do I need an explicit <code>.then()</code> operation to guarantee fulfillment? </p>
","7038838","","7038838","","2019-09-02 07:07:19","2019-09-02 07:07:19","How to map Array of EventLoopFuture<Type> to Array of EventLoopFuture<OtherType> in Vapor","<swift><future><vapor>","0","2","","","","57751925","118712","118712","vapor","592","36204589","36204588"
"57763023","1","58146682","","2019-09-02 21:56:03","","0","75","<p>I have a Vapor app that needs to do most things authenticated via HTTPS, but also needs to receive unauthenticated PUT requests via HTTP.</p>

<p>Can I conditionalize my route definitions based on the server's host name or authentication type? How can I capture that information from the server?</p>
","4943322","","","","","2019-09-28 13:17:13","How to expose only some routes depending on host","<vapor>","1","3","","","","57763023","118712","118712","vapor","592","36204589","36204588"
"57836251","1","","","2019-09-07 18:02:32","","3","61","<p>Right now I have the following two classes:</p>

<pre><code>final class Song: MySQLModel {
    var id: Int?
    var lyrics: String
    var artist: String
    var title: String
    var strummingPattern: String

    init(id: Int? = nil, title: String, lyrics: String, artist: String, strummingPattern: String) {

        self.id = id
        self.lyrics = lyrics
        self.title = title
        self.artist = artist
        self.strummingPattern = strummingPattern

    }
}

extension Song {
    var chords: Children&lt;Song, SongChord&gt;{
        return children(\.songID)
    }
}

final class SongChord: MySQLModel {
    var id: Int?
    var songID: Int
    var chord: String
    var position: Int

    init(id: Int? = nil, chord: String, position: Int, songID: Int) {
        self.songID = songID
        self.id = id
        self.chord = chord
        self.position = position
    }
}

extension SongChord {
    var chords: Parent&lt;SongChord, Song&gt;{
        return parent(\.songID)
    }
}
</code></pre>

<p>I want to return a list of all <code>Song</code>s with their respective <code>SongChord</code> children. So far I've come up with:</p>

<pre><code>return Song.query(on: req)
            .join(\SongChord.songID, to: \Song.id)
            .alsoDecode(SongChord.self)
            .all()
</code></pre>

<p>But this returns an error of ""Cannot convert value of type 'EventLoopFuture&lt;[(Song, SongChord)]>' to closure result type '_'"". Some people online were suggesting doing a flatmap, but this was still producing an error. Any suggestions on how to retrieve the children would be appreciated.</p>
","12035369","","","","","2019-09-07 19:31:15","Is it possible to return Fluent children in a GET request?","<mysql><swift><vapor>","1","0","","","","57836251","118712","118712","vapor","592","36204589","36204588"
"57879195","1","","","2019-09-10 23:06:29","","0","74","<p>I’m getting a weird error when trying to deploy my Vapor project onto GCP App Engine. I was able to deploy it previously but this error just began out of nowhere. I believe it has something to do with my Fluent Migrations but don’t seem to know how to pinpoint this issue… does anyone have any idea as to why my migration might suddenly fail when it worked before? I followed this tutorial to get it up on App Engine: <a href=""https://medium.com/swift2go/serverless-google-app-engine-flex-docker-runtime-cloud-sql-backend-with-swift-vapor-web-alfian-c8310acfea0d"" rel=""nofollow noreferrer"">https://medium.com/swift2go/serverless-google-app-engine-flex-docker-runtime-cloud-sql-backend-with-swift-vapor-web-alfian-c8310acfea0d</a></p>

<p>I already looked at this stackOverflow question but it is not the same as my issue: <a href=""https://stackoverflow.com/questions/44676231/google-app-engine-deploy-error-code-9"">Google App Engine Deploy Error Code 9</a></p>

<p><a href=""https://i.stack.imgur.com/JraJA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/JraJA.png"" alt=""enter image description here""></a></p>
","8828017","","","","","2019-09-10 23:06:29","Vapor 3 - Error Response 9 on Fluent MySQL when deploying to GCP App Engine","<mysql><google-app-engine><google-cloud-platform><vapor><vapor-fluent>","0","2","","","","57879195","118712","118712","vapor","592","36204589","36204588"
"57881305","1","57881801","","2019-09-11 02:36:46","","1","123","<p>I'm using Vapor 3 for some server-side Swift, with the Fluent add-in for handling database/model management, with MySQL underneath.</p>

<p>I'm working in development and wanted to force the migrator to recreate a table, so I went into mysql on the command line and did:</p>

<pre><code>mysql&gt; drop table SomeTableName;
</code></pre>

<p>However, re-running, the migration doesn't re-create the table.  It has a zillion columns and lots of constraints, so I don't really want to do it manually.</p>
","4044855","","","","","2019-09-14 16:25:31","Force Fluent migration to re-create dropped table -- Using Fluent with Vapor 3 iOS Swift MySQL","<mysql><vapor><vapor-fluent>","1","0","","","","57881305","118712","118712","vapor","592","36204589","36204588"
"58070748","1","58073588","","2019-09-23 22:05:40","","1","48","<p>I´m trying to create an entity Task and one children using the same request object</p>

<pre><code>func create(_ req: Request) throws -&gt; Future&lt;Response&gt; {
    return try req.content.decode(Task.TaskForm.self).flatMap { taskForm in
        let user = try req.requireAuthenticated(User.self)
        let task = Task(name: taskForm.name, userId: user.id!)
        return task.save(on: req).map { t in
            let interval = try Interval(taskId: t.requireID())
            let t = interval.save(on: req)
            return t.save(on: req).map { _ in
                return req.redirect(to: ""/dashboard"")
            }
        }
    }
}
</code></pre>

<p>The error that I'm getting is this one:</p>

<p>Cannot convert return expression of type 'EventLoopFuture' to return type 'Response'.</p>

<p>Any ideas on what's the problem?</p>
","4708337","","","","","2019-09-24 05:27:16","Create parent entity and children and redirect request in fluent vapor","<fluent><vapor>","1","0","","","","58070748","118712","118712","vapor","592","36204589","36204588"
"58101960","1","","","2019-09-25 15:33:32","","0","50","<p>I have a receipt server in vapor swift, when I call my server without SSL (http) I don't have any issues. But when I call the same function vía (https) the server returns an error that the </p>

<blockquote>
  <p>network connection was lost</p>
</blockquote>

<p>I'm using the following function to call the iTunes server on </p>

<blockquote>
  <p><a href=""https://buy.itunes.apple.com/verifyReceipt"" rel=""nofollow noreferrer"">https://buy.itunes.apple.com/verifyReceipt</a></p>
</blockquote>

<pre><code>public func validateReceipt(url: String, jsonData: Data, completion: @escaping (_ status: NSDictionary) throws -&gt; ()) {
    let request = NSMutableURLRequest(url: NSURL(string: url)! as URL)

    request.httpMethod = ""POST""
    request.httpBody = jsonData

    URLSession.shared.dataTask(with: request as URLRequest, completionHandler: { data, response, error in
        if let dataR = data {
            self.handleData(responseDatas: dataR as NSData, comp: { status in
                try completion(status)
            })
        }
    }).resume()
}




public func handleData(responseDatas: NSData, comp: (_ status: NSDictionary) throws -&gt; ()) {
    if let json = try? JSONSerialization.jsonObject(with: responseDatas as Data, options: .mutableLeaves),
        let dic = json as? NSDictionary {
        //            print(dic)
        try? comp(dic)
    }
}
</code></pre>

<p>The server is running Mac OS High Sierra
Summing up:</p>

<ul>
<li>When I call the function without HTTPS it works </li>
<li>When I call the function with HTTPS it doesn't   </li>
<li>When I call the function with HTTPS without calling apple server it
works</li>
</ul>

<p>What could be the issue here ?</p>
","433950","","","","","2019-09-25 15:33:32","Vapor Swift Server loses connection when calling iTunes server","<xcode><https><macos-high-sierra><vapor><receipt-validation>","0","0","","","","58101960","118712","118712","vapor","592","36204589","36204588"
"58311066","1","58311666","","2019-10-09 19:31:41","","0","167","<p>I am developing a REST API using <strong>Vapor 3</strong>. This API uses another API to create content that will later be consumed by an app.
So I created a function that fetches content from this API (Leagues and Seasons) and store them on my MySQL DB. The response from the API also contains nested objects that I would want to store too, if it possible all in the same request. Here is the API response:</p>

<pre><code>{
""data"": [
         {
             ""id"": 271,
             ""name"": ""Superliga"",
             ""current_season_id"": 16020,
             ""season"": {
                 ""data"": {
                     ""id"": 16020,
                     ""name"": ""2019/2020"",
                     ""league_id"": 271,
                 }
             }
        }
    ]
}
</code></pre>

<p>Here are the model:</p>

<pre><code>final class League: MySQLModel {

    var id: League.ID?

    var name: String

    var current_season_id: Season.ID

    var currentSeason: Parent&lt;League, Season&gt; {
        return parent(\League.current_season_id)
    }
}

final class Season: MySQLModel {

    var id: Season.ID?

    var name: String

    var league_id: League.ID

    var league: Parent&lt;Season, League&gt; {
        return parent(\.league_id)
    }
}
</code></pre>

<p>Here is the function performing the request and storing on the DB. </p>

<pre><code>func getLeagues(using context: CommandContext) throws -&gt; EventLoopFuture&lt;Void&gt; {
    guard let url = URL(string: ""SOME_API_URL"") else { return .done(on: context.container) }

    let client = try context.container.client()
    return client.get(url).flatMap({ (response) -&gt; EventLoopFuture&lt;Void&gt; in // do the request
        let leagues = response.content.get([League].self, at: ""data"") // get the array of EventLoopFuture&lt;[League]&gt;

        return context.container.requestPooledConnection(to: .mysql).flatMap({ (connection) -&gt; EventLoopFuture&lt;Void&gt; in // connecto to DB

            let savedLeagues = leagues.flatMap(to: [League].self, { (flattenLeagues) -&gt; EventLoopFuture&lt;[League]&gt; in
                return flattenLeagues.map { (league) -&gt; EventLoopFuture&lt;League&gt; in

                    return league.create(orUpdate: true, on: connection) // save on the DB

                }.flatten(on: context.container)
            })

            return savedLeagues.flatMap { (_) -&gt; EventLoopFuture&lt;Void&gt; in
                return .done(on: context.container)
            }
        })
    })
}
</code></pre>

<p>The question would be: it is possible to save a Parent-Child relation? Do I have to do it manually using decode/encode functions?
I did implemented encode/decode and created the League, but don't know how to create te Season and how all can be saved when doing <code>league.create(orUpdate: true, on: connection)</code></p>

<p>Any help would be appriciated.</p>
","4905076","","","","","2019-10-09 20:17:41","How to save Parent-Child relation from a JSON response in Vapor 3","<swift><vapor><vapor-fluent>","1","0","","","","58311066","118712","118712","vapor","592","36204589","36204588"
"58458514","1","58461166","","2019-10-18 21:38:36","","3","398","<p>I'm new to vapor and I just installed in on MacOS, I'm getting following error when I build it. Does anyone know how to fix it? I've searched but most of the solution mentioned are for iOS rather than MacOS. </p>

<pre><code>While building module 'Darwin' imported from /Users/imac1/ROOT/Vapor/Hello/.build/checkouts/swift-nio/Sources/CNIOHTTPParser/include/c_nio_http_parser.h:35:
In file included from &lt;module-includes&gt;:357:
In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/usr/include/ncurses.h:141:
/opt/local/include/unctrl.h:60:63: error: unknown type name 'SCREEN'
NCURSES_EXPORT(NCURSES_CONST char *) NCURSES_SP_NAME(unctrl) (SCREEN*, chtype);
                                                              ^
/opt/local/include/unctrl.h:60:53: error: function cannot return function type 'char *(int *, chtype)' (aka 'char *(int *, unsigned int)')
NCURSES_EXPORT(NCURSES_CONST char *) NCURSES_SP_NAME(unctrl) (SCREEN*, chtype);
                                                    ^
/opt/local/include/unctrl.h:60:54: error: a parameter list without types is only allowed in a function definition
NCURSES_EXPORT(NCURSES_CONST char *) NCURSES_SP_NAME(unctrl) (SCREEN*, chtype);
                                                     ^
In file included from /Users/imac1/ROOT/Vapor/Hello/.build/checkouts/swift-nio/Sources/CNIOHTTPParser/c_nio_http_parser.c:24:
/Users/imac1/ROOT/Vapor/Hello/.build/checkouts/swift-nio/Sources/CNIOHTTPParser/include/c_nio_http_parser.h:35:10: fatal error: could not build module 'Darwin'
#include &lt;stddef.h&gt;
 ~~~~~~~~^
4 errors generated.
[0/20] Compiling CNIOHTTPParser c_nio_http_parser.c
[1/20] Compiling CNIOLinux shim.c
[2/20] Compiling CNIOZlib empty.c
[3/20] Compiling CNIOLinux ifaddrs-android.c
[3/20] Compiling CNIOOpenSSL shims.c
[3/20] Compiling CNIOOpenSSL helpers.c
[3/20] Compiling CNIODarwin shim.c
[3/20] Compiling CNIOSHA1 c_nio_sha1.c
</code></pre>
","12114641","","4667835","","2019-10-18 22:09:11","2019-10-19 06:38:02","fatal error: could not build module 'Darwin'","<swift><macos><vapor>","1","0","","","","58458514","118712","118712","vapor","592","36204589","36204588"
"58466181","1","58471904","","2019-10-19 17:21:47","","2","297","<p>I would like to create a route to let users update their data (e.g. changing their email or their username). To make sure a user cannot use the same username as another user, I would like to check if a user with the same username already exists in the database.</p>

<p>I have already made the username unique in the migrations.</p>

<p>I have a user model that looks like this:</p>

<pre><code>struct User: Content, SQLiteModel, Migration {
    var id: Int?
    var username: String
    var name: String
    var email: String
    var password: String

    var creationDate: Date?

    // Permissions
    var staff: Bool = false
    var superuser: Bool = false

    init(username: String, name: String, email: String, password: String) {
        self.username = username
        self.name = name
        self.email = email
        self.password = password
        self.creationDate = Date()
    }
}
</code></pre>

<p>This is the piece of code where I want to use it:</p>

<pre><code>func create(_ req: Request) throws -&gt; EventLoopFuture&lt;User&gt; {
    return try req.content.decode(UserCreationRequest.self).flatMap { userRequest in

        // Check if `userRequest.email` already exists
        // If if does -&gt; throw Abort(.badRequest, reason: ""Email already in use"")
        // Else -&gt; Go on with creation

        let digest = try req.make(BCryptDigest.self)
        let hashedPassword = try digest.hash(userRequest.password)
        let persistedUser = User(name: userRequest.name, email: userRequest.email, password: hashedPassword)

        return persistedUser.save(on: req)
    }
}
</code></pre>

<p>I could do it like this (see next snippet) but it seems a strange option as it requires a lot of nesting when more checks for e.g. uniqueness would have to be performed (for instance in the case of updating a user).</p>

<pre><code>func create(_ req: Request) throws -&gt; EventLoopFuture&lt;User&gt; {
    return try req.content.decode(UserCreationRequest.self).flatMap { userRequest in
        let userID = userRequest.email
        return User.query(on: req).filter(\.userID == userID).first().flatMap { existingUser in
            guard existingUser == nil else {
                throw Abort(.badRequest, reason: ""A user with this email already exists"")
            }

            let digest = try req.make(BCryptDigest.self)
            let hashedPassword = try digest.hash(userRequest.password)
            let persistedUser = User(name: userRequest.name, email: userRequest.email, password: hashedPassword)

            return persistedUser.save(on: req)
        }
    }
}
</code></pre>

<hr>

<p>As one of the answers suggested I've tried to add Error middleware (see next snippet) but this does not correctly catch the error (maybe I am doing something wrong in the code - just started with Vapor).</p>

<pre><code>import Vapor
import FluentSQLite

enum InternalError: Error {
    case emailDuplicate
}

struct EmailDuplicateErrorMiddleware: Middleware {
    func respond(to request: Request, chainingTo next: Responder) throws -&gt; EventLoopFuture&lt;Response&gt; {
        let response: Future&lt;Response&gt;

        do {
            response = try next.respond(to: request)
        } catch is SQLiteError {
            response = request.eventLoop.newFailedFuture(error: InternalError.emailDuplicate)
        }

        return response.catchFlatMap { error in
            if let response = error as? ResponseEncodable {
                do {
                    return try response.encode(for: request)
                } catch {
                    return request.eventLoop.newFailedFuture(error: InternalError.emailDuplicate)
                }
            } else {
                return request.eventLoop.newFailedFuture(error: error)
            }
        }
    }
}
</code></pre>
","11760491","","11760491","","2019-10-20 12:08:08","2019-10-21 11:55:03","Vapor 3 - How to check for similar email before saving object","<swift><rest><vapor><vapor-fluent>","2","4","0","","","58466181","118712","118712","vapor","592","36204589","36204588"
"58714631","1","","","2019-11-05 15:33:27","","0","55","<p>I've got some code that creates a node in the Firebase Realtime Database when a button is pressed on my app. I want to delete this node 24 hours from its creation time (something similar to the stories feature in Social media platforms nowadays). This deletion should take place even if the app isn't running, is this possible with Vapor? If not, is there any way I could achieve this? Appreciate the feedback!</p>
","12327010","","","","","2019-11-05 15:33:27","Is it possible to run a task using vapor even if the app isn’t running?","<swift><firebase-realtime-database><cron><vapor>","0","8","","","","58714631","118712","118712","vapor","592","36204589","36204588"
"58755538","1","60081235","","2019-11-07 19:16:06","","2","244","<p>I am creating backend based on Vapor 3.1.10 using Xcode 11.2 and Swift 5.1, database is PostgreSQL 12. I have a question: how to interact with database (CRUD) without POST and GET requests. All tutorials show how to CRUD only based on Request through HTTPS. But what if my app needs to save something in database without interacting with network? Look at my code:</p>

<pre class=""lang-swift prettyprint-override""><code>import Vapor
import FluentPostgreSQL

final class Device: PostgreSQLModel {        
    var id: Int?
    var isWorking: Bool
    var serial: Int

    init(isWorking: Bool, serial: Int) {
        self.isWorking = isWorking
        self.serial = serial
    }    
}
extension Device: Content {}
extension Device: Migration {}
extension Device: Parameter {}
</code></pre>

<p>classical method to write or read is:</p>

<pre class=""lang-swift prettyprint-override""><code>import Vapor

final class DeviceController {        
    func readAll(_ req: Request) throws -&gt; Future&lt;[Device]&gt; {
        return Device.query(on: req).all()
    }

    func create(_ req: Request) throws -&gt; Future&lt;Device&gt; {
        return try req.content.decode(Device.self).flatMap { device in
            return device.save(on: req)
        }
    }
}
</code></pre>

<p>How to replace <code>req</code> to another background, safe thread, which I can create locally?</p>

<p>For example:</p>

<pre class=""lang-swift prettyprint-override""><code>let device = Device(isWorking: true, serial: 54321)
device.save(on: &lt;#T##DatabaseConnectable#&gt;)
</code></pre>

<p>How to replace <code>&lt;#T##DatabaseConnectable#&gt;</code> ?</p>

<p>I will be thankful for any help or advice.</p>
","4716121","","1001057","","2019-11-08 12:26:18","2020-02-05 17:36:46","Vapor 3 PostgreSQL CRUD without requests http","<swift><xcode><postgresql><vapor><vapor-fluent>","2","3","","","","58755538","118712","118712","vapor","592","36204589","36204588"
"58785695","1","","","2019-11-10 04:19:43","","1","79","<p>I’m having trouble installing the Neo4j Theo SDK dependency into my Vapor 3 project (Swift 4.2). I have configured my Package.swift file like this: </p>

<pre><code>// swift-tools-version:4.2
import PackageDescription
let package = Package(
...
    dependencies: [
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.3.1""),
        .package(url: ""https://github.com/vapor/fluent.git"", from: ""3.2.1""),
        .package(url: ""https://github.com/vapor/fluent-postgresql.git"", from: ""1.0.0""),
        .package(url: ""https://github.com/vapor/auth.git"", from: ""2.0.4""),
        .package(url: ""https://github.com/vapor/console.git"", from: ""3.1.1""),
        .package(url: ""https://github.com/vapor-community/pagination.git"", from: ""1.0.9""),
        .package(url: ""https://github.com/Jinxiansen/Guardian.git"", from: ""3.0.0""),
        .package(url: ""https://github.com/SwiftyBeaver/SwiftyBeaver-Vapor.git"", from: ""1.1.0""),
        .package(url: ""https://github.com/SwiftyBeaver/SwiftyBeaver.git"", .exact(""1.6.0"")),
        .package(url: ""https://github.com/Neo4j-Swift/Neo4j-Swift.git"", .exact(""4.0.2"")),
    ],
...
)
</code></pre>

<p>However when I try to fetch the Swift dependencies I receive this error: </p>

<pre><code>Updating https://github.com/Neo4j-Swift/Neo4j-Swift.git
error: dependency graph is unresolvable; found these conflicting requirements:
Dependencies: 
    https://github.com/Neo4j-Swift/Neo4j-Swift.git @ 4.0.2
</code></pre>

<p>I wonder what I'm doing wrong here? I have also tried the latest version of Theo (Swift 5.0) and receive the same error. Any help on integrating the Theo package into a SPM project would be much appreciated.</p>
","3788997","","","","","2019-11-10 11:01:51","Dependency Graph resolution problem with Neo4j-Swift (Theo)","<swift><neo4j><vapor>","1","0","","","","58785695","118712","118712","vapor","592","36204589","36204588"
"58846901","1","","","2019-11-13 22:57:51","","0","79","<p>I'm trying to pull a file from GCP Storage bucket in my <code>WebsiteController.swift</code> and temporarily store it in a local directory in order to render the file into one of my Leaf Template endpoints and serve it using <code>request.streamFile(at:)</code> .</p>

<p>I am using the Google Cloud Storage Library under the vapor-community github to pull the file data from the bucket (<a href=""https://github.com/vapor-community/GoogleCloudKit/tree/master/Storage/Sources"" rel=""nofollow noreferrer"">https://github.com/vapor-community/GoogleCloudKit/tree/master/Storage/Sources</a>)</p>

<p>I call <code>let imageData = try gcs.object.getMedia(bucket:,objectName:,queryParameters:)</code> </p>

<p>which returns and stores a <strong>Future&lt; Data ></strong> object into <code>imageData</code>. I then call <code>imageData.flatMap()</code> in order to unwrap the Future&lt; Data > into just <strong>Data</strong> but my code crashes before going into the flatMap closure and gives me the following error:</p>

<p><code>[ ERROR] HTTPError.contentType: HTTP message did not have JSON-compatible content-type. (HTTPMessafeCoder.swift:100)</code></p>

<p>I get the same error even when I call <code>imageData.flatMap(to: Response.self) { data in ...}</code></p>

<p>I tried manually creating a <code>response</code> object using this answer: <a href=""https://stackoverflow.com/a/51989950/8828017"">https://stackoverflow.com/a/51989950/8828017</a> and returning that, however I still got the same error and never reached the flatMap closure.</p>

<p>I never end up reaching <strong>line 96</strong> in the following screenshot. I don't quite understand why flatMap is not working here, could someone explain what I might be doing wrong and how I could fix it? </p>

<p>Thanks!</p>

<p><a href=""https://i.stack.imgur.com/u0LH6.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/u0LH6.png"" alt=""Handler function to serve the image""></a></p>
","8828017","","8828017","","2019-11-13 23:04:51","2019-11-13 23:04:51","Vapor 3 HTTP message did not have JSON-compatible content-type Error when flatMapping Future<Data> object","<swift><google-cloud-storage><content-type><vapor><leaf>","0","0","","","","58846901","118712","118712","vapor","592","36204589","36204588"
"58920230","1","58982291","","2019-11-18 17:44:13","","0","81","<p>I'm trying to pass an array of objects inside another object</p>

<pre><code>struct CreationData: Encodable {
  enum CodingKeys: String, CodingKey {
    case property1
    case amount
    case participants
    case code
  }

  var property1: String?
  var amount: Double?
  var tipAmount: Double?
  var participants: [Participant]
  var currency: Currency

  init() {
    name = nil
    property1 = nil
    participants = []
    tipAmount = nil
    currency = .hryvna
  }

  func encode(to encoder: Encoder) throws {
    var container = encoder.container(keyedBy: CodingKeys.self)
    if let name = name {
      try container.encode(name, forKey: .name)
    }
    if let property1 = property1 {
      try container.encode(property1, forKey: .property1)
    }
    if let tipAmount = tipAmount {
      try container.encode(tipAmount, forKey: .tipAmount)
    }
    if !participants.isEmpty {
      try container.encode(participants, forKey: .participants)
    }
    try container.encode(currency, forKey: .currencyCode)
  }
}
</code></pre>

<p>where object in array is</p>

<pre><code>struct Participant: Hashable, Encodable {
  enum CodingKeys: String, CodingKey {
    case amount
    case id
  }

  var image: Data?
  var displayName: String
  var amount: Double? = 100
  var id: Int?

  var name: String?

  var isSelected: Bool = false

  func encode(to encoder: Encoder) throws {
    var container = encoder.container(keyedBy: CodingKeys.self)
    try container.encode(amount, forKey: .amount)
    try container.encode(id, forKey: .id)
  }

}

</code></pre>

<p>so my JSON looks something like this</p>

<pre><code>{
  ""property1"" : 123,
  ""code"" : ""zen"",
  ""name"" : ""No name"",
  ""participants"" : [
    {
      ""amount"" : 100,
      ""id"" : 1
    }
  ]
}
</code></pre>

<p>On the backend I use this handler</p>

<pre><code>func createHandler(_ req: Request, splitCreate: Create) throws -&gt; Future&lt;SplitResponse&gt; {
    let logger = try req.make(Logger.self)
    let user = try req.requireAuthenticated(User.self)
    guard let id = user.id else {
      throw Abort(.badRequest, reason: ""Couldn't get an id for current user"")
    }

    ...
</code></pre>

<p>with this request content object</p>

<pre><code>struct Create: Content {
    struct Participant: Content {
      var id: Int?
      var amount: Double?
    }

    var amount: Double?
    var tipAmount: Double?
    var name: String?
    var participants: [Participant]
    var currencyCode: String
  }
</code></pre>

<p>I create pivots by the participants array, and the problem is that instead of getting a single participant from an array like so</p>

<pre><code>[App.Create.Participant(id: Optional(1), amount: Optional(100.0))]
</code></pre>

<p>on the backend from the specified JSON I get these participants</p>

<pre><code>[App.Create.Participant(id: Optional(1), amount: nil), App.Create.Participant(id: Optional(1), amount: Optional(100.0))]
</code></pre>

<p>Seems like my array json is being decoded incorrectly, but I'm unable to find a way to fix it</p>
","7191706","","7191706","","2019-11-18 20:09:12","2019-11-21 19:20:20","Swift Vapor wrong decoding of array of objects","<arrays><json><swift><vapor>","1","2","","","","58920230","118712","118712","vapor","592","36204589","36204588"
"58944547","1","","","2019-11-19 23:43:31","","0","42","<p>I'm attempting to write a server with Vapor, that communicates with another server.
On an incoming call, /auth, I need to call another server which requires the request to be signed with a certificate.
Right now I just want to return the status code and the body.</p>

<p>Let's say the certificate is named test_cert.pfx and has the password ""test_pass"".
How can I attach that so my requests succeeds?</p>

<pre><code>router.get(""auth"") { req -&gt; Future&lt;String&gt; in
    var headers: HTTPHeaders = .init()
    headers.add(name: .contentType, value: ""application/json"")
    let bodyString = ""{\""someKey\"": \""someValue\""}""
    let body = HTTPBody(string: bodyString)
    let httpReq = HTTPRequest(
        method: .POST,
        url: URL(string: ""/auth"")!,
        headers: headers,
        body: body)
    let client = HTTPClient.connect(hostname: ""https://server.require.cert.com"", on: req)
    let httpRes = client.flatMap(to: HTTPResponse.self) { client in
        return client.send(httpReq)
    }

    let data = httpRes.map(to: String.self) { httpResponse in
        return ""\(httpResponse.status.code.description) \(httpResponse.body.description)""
    }
    return data
}
</code></pre>

<p>This is what happens right now:</p>

<blockquote>
  <p>[ ERROR ] connectFailed(NIO.NIOConnectionError(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80, dnsAError: Optional(NIO.SocketAddressError.unknown(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80)), dnsAAAAError: Optional(NIO.SocketAddressError.unknown(host: ""<a href=""https://server.require.cert.com"" rel=""nofollow noreferrer"">https://server.require.cert.com</a>"", port: 80)), connectionErrors: [])) (ErrorMiddleware.swift:26)
  [ DEBUG ] Conform <code>ChannelError</code> to <code>Debuggable</code> for better debug info. (ErrorMiddleware.swift:26)</p>
</blockquote>
","1329799","","","","","2019-11-19 23:43:31","POST request from Vapor with .pfx certificate","<swift><ssl><nio><vapor><vapor-cloud>","0","0","","","","58944547","118712","118712","vapor","592","36204589","36204588"
"58949957","1","","","2019-11-20 08:38:33","","0","89","<p>I have a websocket server set up with vapor swift. Now I want to force the connection to use the <code>websocket secure</code> protocol from the server side. It's not enough to use a URL like <code>wss://url:8080</code> because then the client controlls wheter the connection is secure or not.</p>

<pre><code>webSocketServer.get(""link"") { (socket, request) in
    // check if the connection is secure?
    // or force a secure connection?
}
</code></pre>

<p>How is it possible to force vapor to use the secure version of websocket?</p>

<p>Or better, how could I check if the connection is secure?</p>
","10551293","","10551293","","2019-11-20 08:49:27","2019-11-20 08:49:27","How can I force a secure websocket connection with vapor swift?","<swift><websocket><vapor>","0","1","","","","58949957","118712","118712","vapor","592","36204589","36204588"
"58970278","1","","","2019-11-21 08:22:00","","0","33","<p>In a Cocoa menu bar app, i am trying to connect to a Unix Domain socket by using the BlueSocket library. But when i call the <code>.connectToDaemon</code> method inside the <code>AppDelegate</code> Class it doesn't make a connection, there's also no need to have multiple threads, it'll just be one single client connecting so, it should just make the connection write some data on the socket and block on a read call until the server writes back something and so on.</p>

<p>Below is the class, but as mentioned before when i call the <code>.connectToDaemon()</code> function it doesn't actually connect. What am i doing wrong?</p>

<pre class=""lang-swift prettyprint-override""><code>import Foundation
import Socket

class DaemonCommander {
    var daemonSocket: Socket? = nil
    var socketPath: String
    static var bufferSize = 1024

    init(sockPath: String) {
        self.socketPath = sockPath
    }

    deinit {
        self.daemonSocket?.close()
    }
    // connect sets up the socket and connects to the daemon sokcet
    public func connectToDaemon() {
        do {
            print(""Connect to daemon called"")
            // Create an unix socket...
            try self.daemonSocket = Socket.create(family: .unix, type: .stream, proto: .unix)

            guard let socket = self.daemonSocket else {
                print(""Unable to unwrap socket..."")
                return
            }
            self.daemonSocket = socket
            try daemonSocket?.connect(to: self.socketPath)
        } catch let error {
            guard error is Socket.Error else {
                print(""Unexpected error..."")
                return
            }
        }
    }

    public func sendCommand(command: String) -&gt; String {
        let readData = Data(capacity: DaemonCommander.bufferSize)
        do {
            try self.daemonSocket?.write(from: command)
            print(readData)
        } catch let error {
            guard error is Socket.Error else {
                return ""Unexpected error whilw connection""
            }
        }
        return String(decoding: readData, as: UTF8.self)
    }
}
</code></pre>

<p>In the <code>AppDelegate.swift</code> file:</p>

<pre><code>import Cocoa

let socketPath: String = ""/tmp/daemon.sock""

@NSApplicationMain
class AppDelegate: NSObject, NSApplicationDelegate {
    let statusItem = NSStatusBar.system.statusItem(withLength:NSStatusItem.squareLength)

    func applicationDidFinishLaunching(_ aNotification: Notification) {
        if let button = statusItem.button {
            button.image = NSImage(named:NSImage.Name(""Eye""))
        }
        statusItem.menu = self.menu
        populateMenuState()
    }

    func applicationWillTerminate(_ aNotification: Notification) {
        // Insert code here to tear down your application
    }

    @IBAction func buttonOnMenuClicked(_ sender: Any) {
        setupConnection()
    }

    func setupConnection() {
        print(""connection setup"")
        let daemonConnection = DaemonCommander(sockPath: socketPath)
        daemonConnection.connectToDaemon()
        let reply = daemonConnection.sendCommand(command: ""show"")
        print(reply)
    }
}
</code></pre>
","9634325","","","","","2019-11-21 08:22:00","How to Connect to a Socket from a Cocoa app using IBM BlueSocket","<swift><cocoa><vapor><kitura>","0","0","","","","58970278","118712","118712","vapor","592","36204589","36204588"
"59006602","1","59184347","","2019-11-23 10:21:04","","144","71421","<p>I installed vapor via homebrew and then immediately wanted to jump into a project by executing <code>vapor new Hello</code> but then got the following message back in the terminal:</p>

<pre><code>dyld: Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib
Referenced from: /usr/local/bin/vapor
Reason: image not found
zsh: abort      vapor new Hello
</code></pre>

<p>I tried some approaches to fix this like uninstalling and reinstalling openssl via brew but that didn't work . Also tried something I found in the internet but nothing worked. I assume it has something to do with vapor only working with version 1.0.0 but not 1.1.1 and that's what I have. I guess I need to downgrade to 1.0.0 but how'd I do that? I'm on MacOS Catalina if that matters. Thanks in advance.</p>
","4853899","","4853899","","2019-11-23 10:28:28","2020-04-21 02:27:17","dyld: Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib","<swift><macos><openssl><homebrew><vapor>","16","3","38","","","59006602","118712","118712","vapor","592","36204589","36204588"
"59023131","1","","","2019-11-24 22:38:30","","1","77","<p>I'm using Vapor on a Ubuntu server to connect to my DigitalOcean-managed PostgreSQL database.</p>

<p>From the command-line, running the following works fine: </p>

<pre><code>psql postgresql://user:password@host:port/dbname?sslmode=require
</code></pre>

<p>But running the equivalent with the following code gives me: </p>

<pre><code>Fatal error: Error raised at top level: NIOOpenSSL.NIOOpenSSLError.handshakeFailed(NIOOpenSSL.OpenSSLError.sslError([Error: 337047686 error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed])): file /home/buildnode/jenkins/workspace/oss-swift-5.1-package-linux-ubuntu-18_04/swift/stdlib/public/core/ErrorType.swift, line 200
</code></pre>

<p>Here is the code: </p>

<pre class=""lang-swift prettyprint-override""><code>    let postgres = PostgreSQLDatabase(config: PostgreSQLDatabaseConfig(
        hostname: Environment.get(""POSTGRESQL_HOSTNAME"")!,
        port: Int(Environment.get(""POSTGRESQL_PORT"")!)!,
        username: Environment.get(""POSTGRESQL_USERNAME"")!,
        database: Environment.get(""POSTGRESQL_DATABASE"")!,
        password: Environment.get(""POSTGRESQL_PASSWORD"")!,
        transport: .standardTLS
    ))
</code></pre>

<p>Switching the transport argument to <code>.unverifiedTLS</code> works.</p>

<p>I need help to let Vapor work out the SSL connection fine, but I have no idea where to start.</p>
","455016","","","","","2019-11-24 22:38:30","How can I help Vapor successfully SSL-handshake my PostgreSQL server?","<swift><postgresql><ssl><vapor><vapor-fluent>","0","2","","","","59023131","118712","118712","vapor","592","36204589","36204588"
"59030199","1","59030773","","2019-11-25 10:57:31","","3","145","<p>After installing vapor i am getting below error</p>

<p><code>dyld: Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib
  Referenced from: /usr/local/bin/vapor
  Reason: image not found
Abort trap: 6</code></p>

<p>Here lies my issue, I have no idea how to solve that.even I am not able to create new project.
Please help.</p>
","10030620","","","","","2019-12-04 00:48:09","Vapor Installation Issues (First time using Vapor) using Swift 5","<ios><swift><vapor>","2","1","1","","","59030199","118712","118712","vapor","592","36204589","36204588"
"59044677","1","","","2019-11-26 06:02:47","","-2","79","<p>Hello Here I got an error starting new project with vapor, I've ben follow the instruction from documentation here <a href=""https://docs.vapor.codes/3.0/getting-started/hello-world/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/getting-started/hello-world/</a>
when I going to step vapor xcode there is an error apear, like bellow :</p>

<blockquote>
  <p>backgroundExecute(code: 1, error: ""The file /Users/*.xcodeproj does not exist.\n"", output: """")</p>
</blockquote>

<p>please kindly help me, thankyou.</p>
","12094511","","","","","2019-11-26 09:05:25","How to open vapor project on macOS","<ios><swift><macos-mojave><vapor>","2","0","","","","59044677","118712","118712","vapor","592","36204589","36204588"
"59061471","1","","","2019-11-27 00:45:23","","0","66","<p>I just installed <code>Vapor</code> as how-to ask here: <a href=""https://docs.vapor.codes/3.0/install/macos/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/install/macos/</a></p>

<pre><code>brew tap vapor/tap
brew install vapor/tap/vapor
</code></pre>

<p>But can not run </p>

<p><code>vapor --help</code></p>

<p>Got this:</p>

<pre><code>kukodajanos@Kukoda-MacBook-Pro ~ % vapor --help
dyld: Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib
  Referenced from: /usr/local/bin/vapor
  Reason: image not found
zsh: abort      vapor --help
</code></pre>

<p>Do you have any idea?</p>
","239219","","239219","","2019-11-27 00:51:58","2019-11-27 00:51:58","""vapor --help"" raise error though it was installed","<vapor><macos-catalina>","0","1","","","","59061471","118712","118712","vapor","592","36204589","36204588"
"59086479","1","59086624","","2019-11-28 10:18:19","","1","57","<p>How to return user if based on facebook user ID it already exist, and create a new user if not exist in <code>Vapor</code>? You can see how I tried fetch data, but get error.</p>

<pre><code>final class User: Content {
    var id: Int?
    var fbId: String

    init(id: Int? = nil, fbId: String) {
        self.id = id
        self.fbId = fbId
    }
}

router.get(""user"") { (request) -&gt; Future&lt;User&gt; in
    return Future.map(on: request) { () -&gt; User in
        let fbId = try request.query.get(String.self, at: ""fbId"")
        return User.query(on: request).filter(\.fbId == fbId).first().map { (user) -&gt; (U) in
            if user == nil {
                user = User(fbId: fbId)
            }
            return user
        }
    }
}
</code></pre>

<p><a href=""https://i.stack.imgur.com/bawnY.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/bawnY.png"" alt=""enter image description here""></a></p>
","239219","","","","","2019-11-28 10:27:02","How query works in Vapor?","<filter><future><vapor>","2","0","","","","59086479","118712","118712","vapor","592","36204589","36204588"
"59104856","1","59105002","","2019-11-29 12:29:57","","0","52","<p>More Ids are received by router in a JSON. A query need to execute for each Id. Then do some manipulation of the original data and return it. But I get some error. And how to manage <code>Futures</code>? Each query will return a unique future? I need to check when all <code>Futures</code> finished? Do I need to use DispathGroup, or how?</p>

<p>I made like this:</p>

<pre><code>router.post([Page].self, at: ""/releases"") { (request, pages) -&gt; [Page] in
    for page in pages {
        for event in page.events {
            let release = Release.query(on: request).filter(\.fbId == event.id).first().flatMap { (release) -&gt; EventLoopFuture&lt;Release?&gt; in
                return request.future(release)
            }
            if let release2 = release {
                event.started = release2.started
            }
        }
    }
    return pages
}
</code></pre>

<p>But it raise some error:</p>

<p><a href=""https://i.stack.imgur.com/css0o.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/css0o.png"" alt=""enter image description here""></a></p>

<hr>

<p>used following JSON:</p>

<pre><code>[
    {
        ""id"": ""107120697426006"",
        ""name"": ""Teszt Színház"",
        ""events"": [
            {
                ""id"": ""802128100247740"",
                ""name"": ""Teszt Esemény""
            },
            {
                ""id"": ""1378145475685730"",
                ""name"": ""Teszt Esemény 2""
            }
        ]
    }
]
</code></pre>
","239219","","239219","","2019-11-29 23:55:06","2019-11-30 09:15:59","How to query more records and process them with Vapor?","<grand-central-dispatch><vapor>","1","1","","","","59104856","118712","118712","vapor","592","36204589","36204588"
"59108658","1","","","2019-11-29 16:57:52","","0","49","<p>I want to deploy a Vapor app on my server to use it as backend for my iOS app.</p>

<p>I'm pretty new to this topic. The only thing I did before was deploying a Django backend on the same server. I rebuild my server to set up the Vapor backend.</p>

<p>To begin, I wanted to deploy a Vapor app as basic as possible.
I followed this tutorial (it's short):
<a href=""https://medium.com/@ankitank/deploy-a-basic-vapor-app-with-nginx-and-supervisor-1ef303320726"" rel=""nofollow noreferrer"">https://medium.com/@ankitank/deploy-a-basic-vapor-app-with-nginx-and-supervisor-1ef303320726</a></p>

<p>I followed the steps and didn't get errors.</p>

<p>The problem is, when I try to call <code>[IP]/hello</code> like in the tutorial, I get <code>502 Bad Gateway</code> as answer.</p>

<p>Nginx gives me this error:</p>

<pre><code>connect() failed (111: Connection refused) while connecting to upstream, client: [IP], server: _, request: ""GET /hello HTTP/1.1"", upstream: ""http://127.0.0.1:8080/hello"", host: ""[IP]""
</code></pre>

<p>I hope you can help me with this. :)</p>

<hr>

<p><strong>Update 1:</strong></p>

<p>I changed the config to this:</p>

<pre><code>server {
    listen  80;
    listen  [::]:80;
    server_name  [DOMAIN];

    error_log   /var/log/[DOMAIN]_error.log warn;
    access_log  /var/log/[DOMAIN]_access.log;

    add_header Strict-Transport-Security ""max-age=31536000; includeSubdomains;"";

    large_client_header_buffers 8 32k;

    location / {
        # redirect all traffic to localhost:8080;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_pass http://127.0.0.1:8080/;
        proxy_redirect off;
        proxy_read_timeout 86400;

        # enables WS support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection ""upgrade"";

        # prevents 502 bad gateway error
        proxy_buffers 8 32k;
        proxy_buffer_size 64k;

        reset_timedout_connection on;

        tcp_nodelay on;

        client_max_body_size 10m;
    }

    location ~* ^.+.(jpg|jpeg|gif|css|png|js|ico|xml|html|mp4)$ {
      access_log        off;
      expires           30d;
      root /home/[AppName]/Public;
    }
}
</code></pre>

<p>Unfortunately I still get this one:</p>

<pre><code>2019/12/01 14:48:04 [error] 6801#6801: *1 connect() failed (111: Connection refused) while connecting to upstream, client: [IP], server: [DOMAIN], request: ""GET /hello HTTP/1.1"", upstream: ""http://127.0.0.1:8080/hello"", host: [DOMAIN]
</code></pre>

<p><strong>Update 2:</strong></p>

<p>The error was related to this line:
<code>proxy_pass http://127.0.0.1:8080/;</code></p>

<p>I had to change it to this:
<code>proxy_pass http://localhost:8080/;</code></p>

<p>It seems like localhost is not the same.</p>

<p>Now I can run the app via ""vapor run"" and I can access it. :)</p>

<p>Big thanks to @imike for all the help!!!</p>
","8415898","","8415898","","2019-12-01 16:06:58","2019-12-01 16:21:36","Can't access my Vapor app from tutorial on my web server","<nginx><vapor>","2","10","","","","59108658","118712","118712","vapor","592","36204589","36204588"
"59108951","1","59109543","","2019-11-29 17:23:44","","1","62","<p>why this works when directly in router.swift</p>

<pre><code>router.delete(""users"", User.parameter, ""books"", Book.parameter, ""favourite"") { req -&gt; Future&lt;HTTPStatus&gt; in
    try req.parameters.next(User.self).flatMap { user in
        try req.parameters.next(Book.self).flatMap { book in
            UserBookWatched.query(on: req).filter(\.userID == user.id!).filter(\.bookID == book.id!).first().flatMap { books in
                if let books = books {
                    return books.delete(on: req).transform(to: HTTPStatus.noContent)
                }

                return req.future().transform(to: HTTPStatus.notFound)
            }
        }
    }
}
</code></pre>

<p>and this one does not work in route controller</p>

<pre><code>// userid hardcoded, book from Book.parameter 
func removeBookFromFavourited(_ req: Request) throws -&gt; Future&lt;HTTPStatus&gt; {
    let user = User(id: StaticUser.id)

    try req.parameters.next(Book.self).flatMap(to: HTTPStatus.self) { book in
        UserBookFavourited.query(on: req)
            .filter(\.userID == user.id!)
            .filter(\.bookID == book.id!)
            .first().flatMap { books in
            if let books = books {
                return books.delete(on: req).transform(to: HTTPStatus.noContent)
            }

            return req.future().transform(to: HTTPStatus.notFound)
        }
    }
}
</code></pre>

<p>it drops error that   <code>.filter(\.userID == user.id!)</code> ""Type of expression is ambiguous in this context""</p>

<p>models are properly defined as pivot</p>

<p>thx in advance for help(edytowane)
static user will be replaced with JWT token sent in request headers</p>
","1285959","","","","","2019-11-29 18:25:34","Vapor filters are ambiguous in context","<swift><vapor><vapor-fluent>","1","9","","","","59108951","118712","118712","vapor","592","36204589","36204588"
"59129540","1","59129923","","2019-12-01 20:11:44","","2","71","<p>According to answer from question: <a href=""https://stackoverflow.com/questions/51484138/vapor-obtaining-data-from-mysql-using-alsodecode"">vapor - Obtaining data from mysql using alsodecode()</a> I was able to reproduce this for my model with multiple joins.</p>

<p>This resulted with multiple nested tuples which I have to access to get joined values. Is it possible to make other type of join or flatten this tuple structure to one level?</p>

<pre><code>struct MyTuple: Encodable, Content {
    let title: String
    let publicationDate: Date
    let authorID: Author.ID
    let authorName: String
    let categoryID: Category.ID
    let categoryName: String
    let language: String
}

struct MyContext: Encodable {
    let title: String
    let books: [MyTuple]
}

func getBooks(_ req: Request) throws -&gt; Future&lt;[MyTuple]&gt; {
    return Book.query(on: req)
        .join(\Category.id, to: \Book.categoryID)
        .join(\Language.id, to: \Book.languageID)
        .join(\ProgrammingLanguage.id, to: \Book.programmingLanguageID)
        .join(\Author.id, to: \Book.authorID)
        .alsoDecode(Category.self)
        .alsoDecode(Language.self)
        .alsoDecode(ProgrammingLanguage.self)
        .alsoDecode(Author.self)
        .sort(\Book.publicationDate, .descending).all().flatMap(to: [MyTuple].self) { tuples in
            print(tuples)
            var tempTuples: [MyTuple] = []
            for tuple in tuples {
                tempTuples.append(try MyTuple(
                        title: tuple.0.0.0.0.title,
                        publicationDate: tuple.0.0.0.0.publicationDate,
                        authorID: tuple.1.requireID(),
                        authorName: ""\(tuple.1.name) \(tuple.1.surname)"",
                        categoryID: tuple.0.0.0.1.requireID(),
                        categoryName: tuple.0.0.0.1.name, language: tuple.0.0.1.code ) )
            }

            return Future.map(on: req) {
                tempTuples
            }
        }
}
</code></pre>
","1285959","","","","","2019-12-01 21:47:44","Vapor join and alsoDecode produces lots of nested tuples","<swift><vapor><vapor-fluent>","1","0","","","","59129540","118712","118712","vapor","592","36204589","36204588"
"59147566","1","","","2019-12-02 22:26:31","","0","81","<p>I have only a simple route. BE and FE is in different domains, how to call BE from FE to get response? FE is React.</p>

<p>I tried to add setting specified here: <a href=""https://github.com/vapor/documentation/blob/master/3.0/docs/vapor/middleware.md"" rel=""nofollow noreferrer"">https://github.com/vapor/documentation/blob/master/3.0/docs/vapor/middleware.md</a> without any luck.</p>

<p>FE refuse call without HTTP status error code. Cleared cache in browser.</p>

<p><a href=""https://i.stack.imgur.com/i09PO.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/i09PO.png"" alt=""enter image description here""></a></p>

<p>I tried to add those line to the route, without luck:</p>

<pre><code>public func routes(_ router: Router) throws {

    router.grouped(CORSMiddleware()).post([Page].self, at: ""/releases"") { (req, pages) -&gt; Future&lt;[Page]&gt; in
       req.response().http.headers.add(name: ""Access-Control-Expose-Headers"", value:""Access-Control-Allow-Origin"")
        req.response().http.headers.add(name: ""Access-Control-Allow-Origin"", value:""*"")

</code></pre>

<p>When BE is called from <code>Postman</code>, it works, not from FE. Breakpoint is not even hit from FE.</p>

<p>I see some errors in browser, and no response at all from BE:</p>

<p><a href=""https://i.stack.imgur.com/r6CtD.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/r6CtD.png"" alt=""enter image description here""></a></p>

<p><a href=""https://i.stack.imgur.com/GKbBZ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/GKbBZ.png"" alt=""enter image description here""></a></p>
","239219","","239219","","2019-12-03 10:47:46","2019-12-03 12:40:41","How to call Vapor from different domain?","<cors><vapor>","0","1","","","","59147566","118712","118712","vapor","592","36204589","36204588"
"59216136","1","","","2019-12-06 15:37:31","","2","38","<p>I have noticed that in my vapor swift app the websocket connection to a client ends after a specific timeout. How do I change that timout, more specific, how do I disable it?</p>

<p>I have found resources for other technologies, but not for vapor.</p>
","10551293","","","","","2019-12-06 15:37:31","How do I set the timeout for a WebSocket connection in a vapor swift app?","<swift><websocket><backend><vapor>","0","0","","","","59216136","118712","118712","vapor","592","36204589","36204588"
"59254723","1","59256863","","2019-12-09 18:32:58","","1","92","<p>I have a Vapor API that has a route to register users. This route recibes a nested object in JSON format like this:</p>

<pre><code>{
    ""name"": ""Test"",
    ""email"": ""test1@test.com"",
    ""password"": ""Test1"",
    ""phone"": {
        ""numberString"": ""+52 999 999 9999"",
        ""countryCode"": 52,
        ""nationalNumber"": 9999999999,
    }
}
</code></pre>

<p>This JSON is converted into a Content/Codable Object:</p>

<pre><code>final class Create: Codable, Content {
    let name: String!
    let email: String!
    let password: String
    let phone: PhoneNumber!

    init(name: String, email: String, password: String, phone: PhoneNumber) {
        self.name = name
        self.email = email
        self.password = password
        self.phone = phone
    }
}
</code></pre>

<p>I have tried this route sending the JSON string as raw via Postman and the route worked perfectly but the problem is when I try to send it via URLSession in my iOS counterpart the ErrorMiddleware throws a DecodingError:</p>

<p><em>DecodingError: Value of type 'String' required for key 'password'.</em></p>

<p>At first I thought that the problem was the JSON generation until, for test purpose I send the same JSON as in the example and the Vapor API is still throwing the Error.</p>

<pre><code>let urlStr = ""\(BaseURL)/api/student/register""

guard let url = URL(string: urlStr) else { return }

var urlRequest = URLRequest(url: url, cachePolicy:
    .reloadIgnoringLocalAndRemoteCacheData, timeoutInterval: 30.0)


let raw = ""{\""name\"":\""Prueba\"",\""email\"":\""prueba1@hotmail.com\"",\""password\"":\""Prueba1\"",\""phone\"":{\""numberString\"":\""+52 999 271 5671\"",\""countryCode\"":52,\""nationalNumber\"":9992715671}}""

urlRequest.httpMethod = ""POST""
urlRequest.httpBody = raw.data(using: .utf8)

urlRequest.addValue(""application/json"", forHTTPHeaderField: ""Accept"")

URLSession.shared.dataTask(with: urlRequest) { (data, response, error) in
    ...
}.resume()
</code></pre>

<p>Can you even send this types of JSON's via URLSession or do I need to change my logic so it will receive a flat array?</p>
","8473109","","1265393","","2019-12-09 18:36:39","2019-12-11 19:57:38","How to send nested raw JSON in URLSession to Vapor API?","<json><swift><vapor><urlsession>","2","2","","","","59254723","118712","118712","vapor","592","36204589","36204588"
"59257086","1","59297085","","2019-12-09 21:41:24","","1","86","<p>I'm trying to do a nested query in Vapor 3 and Fluent. The point is I need to get all the users, from each team where the teams have a specific eventID. Teams are children of Event. Users are children of Teams. Thanks in advance for your help.
There are only 15 teams per event, but 12 users per team</p>

<p>Here is the Event model:</p>

<pre class=""lang-swift prettyprint-override""><code>final class Event: Codable {    
    var id: Int?
    var name: String
}

extension Event {
    var teams: Children&lt;Event, Team&gt; {
        return children(\.eventID)
    }
}
</code></pre>

<p>Here is the Team model</p>

<pre class=""lang-swift prettyprint-override""><code>final class Team: Codable {    
    var id: Int?
    var name: String
    var icon: String
    var eventID: Event.ID
}

extension Team {
    var user: Parent&lt;Team, Event&gt; {
        return parent(\.eventID)
    }
}

extension Team {
    var users: Children&lt;Team, User&gt; {
        return children(\.teamID)
    }
}
</code></pre>

<p>Here is the User model.</p>

<pre class=""lang-swift prettyprint-override""><code>final class User: Codable {
    var id: UUID?
    var name: String
    var email: String
    var eventID: Event.ID
    var teamID: Team.ID
}

extension User {
    var user: Parent&lt;User, Team&gt; {
        return parent(\.teamID)
    }
}
</code></pre>

<p>I need to send an event ID and I want it to return all the users in all the teams</p>

<pre class=""lang-swift prettyprint-override""><code>func getUsersForEvent(_ req: Request) throws -&gt; Future&lt;[User]&gt; {        
    return try req.parameters.next(Event.self).flatMap(to: [User].self) { event in
        return try event.teams.query(on: req).all().flatMap(to: [User].self) { team in
            return try team.users.query(on: req).all()
        }
    }
}
</code></pre>
","496193","","1001057","","2019-12-09 21:50:02","2019-12-12 02:59:37","Vapor 3 and Fluent - nested query","<vapor><vapor-fluent>","2","0","","","","59257086","118712","118712","vapor","592","36204589","36204588"
"59259963","1","","","2019-12-10 03:53:29","","1","108","<p>I'm writing a backend app in <code>Xcode 11.2</code> using <code>Vapor3</code> and <code>Fluent</code> with <code>SQLite</code>.  I have a route for a <code>POST</code> request to update a record in Table1, but before I save the record, I need to pull values from another table with a key that's in one of the fields I'm passing in.  The part that I'm getting stuck on is accessing that data from the other table.</p>

<p>What I have so far:</p>

<p><strong>Table for staff</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Staff: Content, SQLiteUUIDModel, Migration, Parameter { 
  var id: UUID? 
  var staffID: String (value that's in the other table to match)
  var value1: Int (one of the values I'm trying to fetch)
  var value2: Int (another value I'm trying to fetch)
  ...(additional variables and Init
</code></pre>

<p><strong>Table for assignments</strong></p>

<pre class=""lang-swift prettyprint-override""><code>final class Assignments: Content, SQLiteUUIDModel, Migration, Parameter {
  var id: UUID?
  var staffID: String 
  ...(additional variables and Init
</code></pre>

<p><strong>Route for incoming POST request to update existing Assignment:</strong></p>

<pre class=""lang-swift prettyprint-override""><code>router.post(""update"", Assignments.parameter) { req -&gt; Future&lt;Assignments&gt; in
  return try req.parameters.next(Assignments.self).flatMap { Assignment in
  return try req.content.decode(Assignments.self).flatMap { updatedAssignment in

  (Code where I perform calculations on the incoming 'Assignment' and save to 'updatedAssignment' before calling:)

  return WorkOrder.save(on: req)
</code></pre>

<p>The route I have works, incoming data is modified and written to the SQLite database, however there are a couple of fields that I need to perform calculations on or set to values stored in the Staff table.  IE: </p>

<pre class=""lang-swift prettyprint-override""><code>
editedAssignment.variable = (variable) * (value1 from staff table for matching staffID)
editedAssignment.variable = (value2 from staff table for matching staffID)
</code></pre>

<p><strong>What I've tried so far</strong></p>

<pre><code>let staffData = Staff.query(on: req).filter(\.staffID == staffID).all() before the calculations
(adding as a Future as:)
router.post(...) { req -&gt; Future&lt;Staff&gt; in return try Staff.query(on: req).filter ...(rest of query)  
</code></pre>

<p>-- this method throws off the whole request, the values of the incoming request are just lost.</p>

<p>Ideally, if I could call a query and save as a dictionary in the calculations, that would be ideal, I just can't seem to ""figure it out"".</p>
","12508716","","12508716","","2019-12-10 04:39:14","2019-12-17 18:57:17","Swift & Vapor/Fluent : How to pull values from another table during a post router request","<swift><sqlite><vapor><vapor-fluent>","1","0","","","","59259963","118712","118712","vapor","592","36204589","36204588"
"59287825","1","","","2019-12-11 14:18:42","","1","59","<p>When I generate a new vapor project:</p>

<pre><code>vapor new test
cd test
vapor xcode -y
</code></pre>

<p>And then run this project in xcode without changing anything and then request the root route a few times using <code>curl</code>, the memory graph in the xcode debugging tools climbs up, but doesn't go back down again.</p>

<pre><code>curl http://localhost:8080
</code></pre>

<p>Is this a problem with vapor? Because it happens in the default project?</p>

<p>How can I fix this issue?</p>
","10551293","","","","","2019-12-15 17:08:56","What can I do about a memory leak in a default vapor swift project?","<swift><debugging><memory><vapor>","1","1","","","","59287825","118712","118712","vapor","592","36204589","36204588"
"59305722","1","","","2019-12-12 13:29:05","","1","77","<p><a href=""https://i.stack.imgur.com/4VCpc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4VCpc.png"" alt=""enter image description here""></a></p>

<p>I have this request:</p>

<pre><code>router.get(""/fetchOngoingReleases"") { (request) -&gt; Future&lt;[ReleaseOut]&gt; in
        return Release.query(on: request).filter(\.inprogress == true).all().map { releases in
                var result: [ReleaseOut] = []
                for r in releases {
                    var pageEvents: [Event] = []

                    let num = r.releaseUsers.query(on: request).filter(\.user.fbId ~~ ""something"").count()

                    var needAuthentication: Bool
                    if num == 0 {
                        needAuthentication = true
                    } else {
                        needAuthentication = false
                    }
                    let rOut = ReleaseOut(fbId: r.fbId, name: r.name, purpose: r.purpose, needAuthentication: needAuthentication)
                    result.append(rOut)
                }
                return result
        }
    }
}
</code></pre>

<p>It says <strong>I can not access (???)</strong> <code>releaseUser.user.fbId</code> in the query?</p>

<p>Here the data model:</p>

<p><a href=""https://i.stack.imgur.com/7BhHs.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/7BhHs.png"" alt=""enter image description here""></a></p>

<p>and in code</p>

<pre><code>
final class Release: Content {
    var id: Int?
    var fbId: String
    var inprogress: Bool?
    var name: String
    var purpose: String

    /// Creates a new `Release`.
    init(id: Int? = nil, fbId: String, name: String, purpose: String = ""normal selling"") {
        self.id = id
        self.fbId = fbId
        self.name = name
        self.purpose = purpose
    }
}

extension Release {
    var releaseUsers: Children&lt;Release, ReleaseUser&gt; {
        return children(\.releaseId)
    }
}

final class ReleaseUser: Content {
    var id: Int?
    var releaseId: Release.ID
    var userId: User.ID

    init(id: Int? = nil, releaseId: Release.ID, userId: User.ID) {
        self.id = id
        self.releaseId = releaseId
        self.userId = userId
    }
}

extension ReleaseUser {
    var user: Parent&lt;ReleaseUser, User&gt; {
        return parent(\.userId)
    }
}

final class User: Content {
    var id: Int?
    var fbId: String
    var name: String

    init(id: Int? = nil, fbId: String, name: String) {
        self.id = id
        self.fbId = fbId
        self.name = name
    }
}
</code></pre>
","239219","","239219","","2019-12-12 13:42:04","2019-12-14 12:47:04","How to filter other parent of child with Vapor?","<vapor>","2","0","","","","59305722","118712","118712","vapor","592","36204589","36204588"
"59336265","1","59394194","","2019-12-14 15:03:11","","1","125","<p>Have following code:</p>

<pre><code>router.get(""/fetchOngoingReleases"", String.parameter) { (request) -&gt; Future&lt;[ReleaseWithUser]&gt; in
    return Release.query(on: request).filter(\.inProgress == true).all().flatMap { (ra) -&gt; EventLoopFuture&lt;[ReleaseWithUser]&gt; in
        let userId = try request.parameters.next(String.self)
        return User.query(on: request).filter(\.fbId == userId).first().flatMap { (user) -&gt; EventLoopFuture&lt;[ReleaseWithUser]&gt; in
            let a = ra.map { (r) -&gt; ReleaseWithUser in
                // some condition and logic here
            }

            return a. //need this to make future
        }
    }
}
</code></pre>

<p>I checked all the possible method calls but none of converts <code>[ReleaseWithUser]</code> to <code>Future&lt;[ReleaseWithUser]&gt;</code>. Do you have any idea?</p>
","239219","","239219","","2019-12-18 05:07:16","2019-12-18 14:29:28","How to make ""future"" from an array in Vapor?","<swift><vapor>","1","4","1","","","59336265","118712","118712","vapor","592","36204589","36204588"
"59344229","1","59344940","","2019-12-15 13:14:45","","0","94","<p>I am using Vapor 3, Swift 5.1, PostgreSQL 12 and Postico 1.5.10 for my Backend. Question is: how to store Date (I mean Swift Date()) and Dictionary (example, [String : Int])? </p>

<p>To work with PostgeSQL, I am using Postico (I am quite newbie in PostgreSQL, that's why), please look at screenshot:
<a href=""https://i.stack.imgur.com/35632.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/35632.png"" alt=""enter image description here""></a></p>

<p>And, I just have seen how to store Arrays, but where I can find other types to store? For example, Enum?</p>

<p>I will be thankful for any help or advice!</p>
","4716121","","","","","2019-12-15 14:42:04","How to store Swift types (Date, Dictionary and others) in PostgreSQL with Vapor 3?","<swift><xcode><postgresql><vapor><postico>","1","7","","","","59344229","118712","118712","vapor","592","36204589","36204588"
"59350921","1","59361552","","2019-12-16 05:22:01","","2","105","<p>I am trying to write an API based on Project2 from Server Side Swift by Paul Hudson
<a href=""https://www.hackingwithswift.com/store/server-side-swift"" rel=""nofollow noreferrer"">https://www.hackingwithswift.com/store/server-side-swift</a></p>

<p>I am running:</p>

<p>Swift version 5.0 (swift-5.0-RELEASE)
Target: x86_64-unknown-linux-gnu</p>

<p>and</p>

<p>Vapor Toolbox: 3.1.10</p>

<p>on Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-66-generic x86_64)</p>

<p>The idea is to use Fluent and SQLite to maintain (CRUD) property records.</p>

<p>The relevant part of configure.swift is:</p>

<pre><code>let directoryConfig = DirectoryConfig.detect()
    services.register(directoryConfig)

    try services.register(FluentSQLiteProvider())

    var databaseConfig = DatabasesConfig()
    let db = try SQLiteDatabase(storage: .file(path: ""\(directoryConfig.workDir)properties.db""))
    databaseConfig.add(database: db, as: .sqlite)
    services.register(databaseConfig)

    var migrationConfig = MigrationConfig()
    migrationConfig.add(model: Property.self, database: .sqlite)
    services.register(migrationConfig)
</code></pre>

<p>In Routes.swift I have this:</p>

<pre><code>    router.post(Property.self, at: ""properties"", ""create"") { req, property -&gt; Future&lt;Property&gt; in
        return property.save(on: req)
    }

    router.get(""properties"", ""list"") { req -&gt; Future&lt;[Property]&gt; in
        return Property.query(on: req).all()
    }
</code></pre>

<p>And Property.swift is this:</p>

<pre><code>//  Property.swift
//
//  Created by Peter Matthews on 07/12/2019.
//

import Fluent
import FluentSQLite
import Foundation
import Vapor

enum TenureType: String, Codable {
    case freehold
    case cross_lease
    case unit_title
    //    etc...
}

enum PropertyType: String, Codable {
    case commercial
    case office
    case industrial
    case retail
    //    etc...
}

struct Property: Content, SQLiteUUIDModel, Migration {

    var id: UUID?
    var tenureType: TenureType?     //  var tenureType: String?
    var propertyType: PropertyType? //  var propertyType: String?
    //    etc...
}
</code></pre>

<p>When <code>tenureType</code> and <code>propertyType</code> are defined as <code>String?</code> everything works fine, but I think there is a strong case for using enums to specify the possible values for <code>tenureType</code> and <code>propertyType</code>.</p>

<pre><code>Terminal output:

pm@PHQ:~/PropertyHQ$ vapor run
Running PropertyHQ ...
[ INFO ] Migrating 'sqlite' database (/home/pm/PropertyHQ/.build/checkouts/fluent/Sources/Fluent/Migration/MigrationConfig.swift:69)
[ INFO ] Migrations complete (/home/pm/PropertyHQ/.build/checkouts/fluent/Sources/Fluent/Migration/MigrationConfig.swift:73)
Running default command: .build/debug/Run serve
</code></pre>

<p>The problem is that when I try to use enums for <code>tenureType</code> and <code>propertyType</code>, the app builds just fine but when I run the vapor server I get this error.</p>

<pre><code>Terminal output:

pm@PHQ:~/PropertyHQ$ vapor run
Running PropertyHQ ...
[ INFO ] Migrating 'sqlite' database (/home/pm/PropertyHQ/.build/checkouts/fluent/Sources/Fluent/Migration/MigrationConfig.swift:69)
[ INFO ] Preparing migration 'Property' (/home/pm/PropertyHQ/.build/checkouts/fluent/Sources/Fluent/Migration/Migrations.swift:111)
⚠️ [DecodingError.dataCorrupted: Cannot initialize TenureType from invalid String value 1]
Error: Run failed.
pm@PHQ:~/PropertyHQ$
</code></pre>

<p>When I specify <code>tenureType</code> and <code>propertyType</code> as optional (which I think they should be) the error value is 1 - when they are not optional the error value is 0.</p>

<p>I should add that this error only occurs when I run the server for the first time ie: when it creates the (empty) database. If I run it for the first time with <code>tenureType</code> and <code>propertyType</code> defined as <code>String?</code> it runs OK and then I can change them to enums and it continues to work OK.</p>
","5830829","","1839439","","2019-12-25 17:08:32","2019-12-25 17:08:32","Serverside Swift and Vapor on Ubuntu","<swift><sqlite><server><enums><vapor>","1","0","","","","59350921","118712","118712","vapor","592","36204589","36204588"
"59362850","1","59486758","","2019-12-16 19:06:10","","1","167","<p>I am using Vapor 3, Swift 5.1, PostgreSQL 12, and Postico 1.5.10 for my Backend. In the PostgreSQL database, there is a field with the name <code>eventDate</code> of type <code>timestamp without time zone</code>.
Please, look at screenshot:</p>

<p><a href=""https://i.stack.imgur.com/OZuv9.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/OZuv9.png"" alt=""enter image description here""></a></p>

<p>In Vapor, there is a model:</p>

<pre><code>import Vapor
import FluentPostgreSQL

final class TestModel: PostgreSQLModel {

    var id: Int?
    var eventDate: Date

    init(eventDate: Date) {
        self.eventDate = eventDate
    }

}

extension TestModel: Content {
}

extension TestModel: Migration {
}

extension TestModel: Parameter {
}
</code></pre>

<p>But when I am trying to save <code>Date</code> (Swift) to <code>timestamp without time zone</code> Vapor gives me error:</p>

<pre><code>[ ERROR ] DecodingError.typeMismatch: Value of type 'String' required for key 'eventDate.date'. (NIOServer.swift:104)
</code></pre>

<p>If, in model, I am changing <code>Date</code> to <code>String</code>, Vapor gives me this error:</p>

<pre><code>[ ERROR ] PostgreSQLError.server.error.transformAssignedExpr: column ""eventDate"" is of type timestamp without time zone but expression is of type text (NIOServer.swift:104)
</code></pre>

<p>So the question is: how to transfer <code>Date</code> and <code>String</code> to <code>timestamp without time zone</code> (or <code>timestamp with time zone</code>)?</p>

<p>I will be thankful for any help or advice!</p>
","4716121","","12417531","","2019-12-16 20:32:22","2019-12-26 10:01:57","How to convert Swift Date or String to timestamp without time zone of PostgreSQL?","<swift><xcode><postgresql><vapor><postico>","2","0","","","","59362850","118712","118712","vapor","592","36204589","36204588"
"59397283","1","59406428","","2019-12-18 17:27:16","","2","99","<p>I  am trying to get a very simple result from a leaf renderer for a for loop with swift vapor.</p>

<p>I am uploading leaf file HTML as it is not accepting the code here in correct format - </p>

<p><a href=""https://i.stack.imgur.com/XFCaf.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/XFCaf.png"" alt=""enter image description here""></a></p>

<p>pizza.swift code below -</p>

<pre><code>   import Foundation
   import Vapor

  struct pizza: Encodable, Content, Decodable  {
  var id:  Int?
  var name: String
  var description: String
  var  price: Int
  }
</code></pre>

<p>routes.swift code below -</p>

<pre><code>   import Routing
   import Vapor

   public func routes(_ router: Router) throws {
   router.get { req -&gt; Future &lt;View&gt; in
   let Newyorker = pizza(id: 5, name: ""statinisland"", description: ""impracticaljokers"", price: 55)
    let Traditional = pizza(id: 5, name: ""rome"", description: ""pope"", price: 55)
    return try req.view().render(""welcome"",[""Pizza"":[Newyorker,Traditional]])
}



// Example of configuring a controller
  let todoController = TodoController()
  router.get(""todos"", use: todoController.index)
  router.post(""todos"", use: todoController.create)
  router.delete(""todos"", Todo.parameter, use: todoController.delete)
  }
</code></pre>

<p>what I expect is -</p>

<p>Pizza</p>

<p>Welcome to best pizza in the world </p>

<pre><code>  .statinisland
  .rome
</code></pre>

<p>what I get is -</p>

<p>Pizza</p>

<p>Welcome to best pizza in the world</p>

<pre><code>.#for (pizza in pizza) {
.
} 
</code></pre>

<p>If you need more information I can upload. Any help will be appreciated.</p>

<p>edit - I  am also adding configure.swift code below -</p>

<pre><code>import FluentSQLite
import Vapor
import Leaf // added
 /// Called before your application initializes.
 public func configure(_ config: inout Config, _ env: inout      Environment, _ services: inout Services) throws {
    // Register providers first
   try services.register(FluentSQLiteProvider())

 // Register routes to the router
 let router = EngineRouter.default()
 try routes(router)
 services.register(router, as: Router.self)

 // Register middleware
 var middlewares = MiddlewareConfig() // Create _empty_ middleware config
 // middlewares.use(FileMiddleware.self) // Serves files from `Public/`  directory
  middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
  services.register(middlewares)

 // Configure a SQLite database
 let sqlite = try SQLiteDatabase(storage: .memory)

 // Register the configured SQLite database to the database config.
 var databases = DatabasesConfig()
 databases.add(database: sqlite, as: .sqlite)
 services.register(databases)

 // Configure migrations
 var migrations = MigrationConfig()
 migrations.add(model: Todo.self, database: .sqlite)
services.register(migrations)
let leafProvider = LeafProvider()    // added
try services.register(leafProvider)  // added
config.prefer(LeafRenderer.self, for: ViewRenderer.self)// added
// http://localhost:8080/ already in use so adding new server  http://localhost:8080/ below -
 let serverConfigure = NIOServerConfig.default(hostname: ""0.0.0.0"", port: 9090)
services.register(serverConfigure)
}
</code></pre>
","7444874","","7444874","","2019-12-19 06:01:14","2019-12-19 09:11:15","swift vapor leaf loop","<swift><loops><vapor><leaf>","1","6","","","","59397283","118712","118712","vapor","592","36204589","36204588"
"59420542","1","59422088","","2019-12-20 06:04:26","","2","118","<p>I am doing an e-commerce tutorial from Paul Hudson on YouTube. I am getting following errors in <code>configure.swift</code>:</p>

<pre class=""lang-swift prettyprint-override""><code>import FluentSQLite
import Vapor
import Leaf // added
/// Called before your application initializes.
public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
    // Register providers first
    try services.register(FluentSQLiteProvider())

    // Register routes to the router
    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    // Register middleware
    var middlewares = MiddlewareConfig() // Create _empty_ middleware config
    // middlewares.use(FileMiddleware.self) // Serves files from `Public/` directory
    middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
    services.register(middlewares)

    // Configure a SQLite database
    let sqlite = try SQLiteDatabase(storage: .memory)
    // Register the configured SQLite database to the database config.
    var databases = DatabasesConfig()
    databases.add(database: sqlite, as: .sqlite)
    services.register(databases)

    // Configure migrations
    var migrations = MigrationConfig()
    migrations.add(model: Todo.self, database: .sqlite)
    services.register(migrations)
    let leafProvider = LeafProvider()    // added
    try services.register(leafProvider)  // added
    config.prefer(LeafRenderer.self, for: ViewRenderer.self)// added
      // http://localhost:8080/ already in use so adding new server http://localhost:8080/ below -
    let serverConfigure = NIOServerConfig.default(hostname: ""0.0.0.0"", port: 9090)
    services.register(serverConfigure)

    let directoryConfig = DirectoryConfig.detect()
    services.register(directoryConfig)
    try services.register(FluentSQLiteProvider())
    var databaseConfig = DatabasesConfig()
    let db =    try SQLiteDatabase(storage: .file(path:   ""\(directoryConfig.workDir)pizza.db""))
     databaseConfig.add(model: db, database: as .sqlite)
    /**
    The line just above shows errors - 
    errror 1 -&gt; Cannot invoke 'add' with an argument list of type '(model:      
    SQLiteDatabase)'
    error 2 -&gt; Expected expression in list of expressions 
    */       
    services.register(databaseConfig)
    var migrationConfig =  MigrationConfig()
    migrationConfig.add(model: pizza.self,  database: sqlite)
    /**
    The line just above shows error -&gt; Cannot invoke 'add' with an argument list of type     '(model: pizza.Type, database: SQLiteDatabase)'
    */
    services.register(migrationConfig)
} 
// configure.swift ends here
</code></pre>

<p>I am also pasting my Package.swift code for reference -</p>

<pre><code> // swift-tools-version:4.0

import PackageDescription

let package = Package(
name: ""vv"",
products: [
    .library(name: ""vv"", targets: [""App""]),
],
dependencies: [
    // 💧 A server-side Swift web framework.
    .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),

    // 🔵 Swift ORM (queries, models, relations, etc) built on SQLite 3.
    .package(url: ""https://github.com/vapor/fluent-sqlite.git"", from: ""3.0.0""),
.package(url: ""https://github.com/vapor/leaf.git"", from: ""3.0.0""),
],
targets: [
    .target(name: ""App"", dependencies: [""Leaf"", ""Vapor"",""FluentSQLite""]),
 .target(name: ""Run"", dependencies: [""App""]),
    .testTarget(name: ""AppTests"", dependencies: [""App""])
]
)
</code></pre>

<p>pizza.swift file -</p>

<pre><code> import Foundation
 import Vapor
 import FluentSQLite

 struct pizza: Encodable, Content, Decodable, SQLiteModel {
     var id:  Int?
     var name: String
     var description: String
     var  price: Int
 }
</code></pre>

<p>I am unable to figure out what the above errors mean! Thanks.</p>

<p>routes.swift file -  </p>

<pre><code>import Routing
import Vapor
import FluentSQLite

public func routes(_ router: Router) throws {
router.get { req -&gt; Future &lt;View&gt; in
let Newyorker = Pizza(id: 5, name: ""statinisland"", description: ""impracticaljokers"", price: 55)
    let Traditional = Pizza(id: 5, name: ""rome"", description: ""pope"", price: 55)
    return try req.view().render(""welcome"",[""pizza"":[Newyorker,Traditional]])
}

 router.post(Pizza.self, at: ""add"") { req, pizza -&gt;
     Future&lt;Response&gt; in
    return Pizza.save(on:req).map(to:Response.self) {Pizza
        in
        return req.redirect(to: ""/"")
    }
   }
/*Error - Type 'Pizza' has no member 'save'; did you mean 'name'?
 Replace 'save' with 'name' */  
 }
</code></pre>
","7444874","","7444874","","2019-12-21 11:57:31","2019-12-21 11:57:31","Swift Vapor - 'Cannot invoke 'add' with an argument list of type...' errors in configure.swift","<swift><vapor><leaf>","1","0","","","","59420542","118712","118712","vapor","592","36204589","36204588"
"59429133","1","","","2019-12-20 17:19:47","","1","112","<p>As I want the assets to be distributed on <code>Cloudfront</code> upon deployment with the correct URLs. </p>

<p>I am not using <code>blade</code> so I can’t use the asset helper. There’s no documentation on this either. </p>
","1239189","","6655126","","2019-12-20 20:51:47","2020-02-14 14:10:48","How do I reference assets in .vue files when using Vapor?","<laravel><vue.js><vapor>","1","7","1","","","59429133","118712","118712","vapor","592","36204589","36204588"
"59437264","1","","","2019-12-21 15:06:54","","1","51","<p>I am getting following errors in routes.swift -
I can also post other files if you need -</p>

<pre><code>import Routing
import Vapor
import FluentSQLite

 public func routes(_ router: Router) throws {
 router.get { req -&gt; Future &lt;View&gt; in
 let Newyorker = Pizza(id: 5, name: ""statinisland"", description: ""impracticaljokers"", price: 55)
let Traditional = Pizza(id: 5, name: ""rome"", description: ""pope"", price: 55)
return try req.view().render(""welcome"",[""pizza"":[Newyorker,Traditional]])
}

 router.post(Pizza.self, at: ""add"") { req, pizza -&gt;
 Future&lt;Response&gt; in
return Pizza.save(on:req).map(to:Response.self) { Pizza
    in
    return req.redirect(to: ""/"")
  }
 }
 /*Error - Type 'Pizza' has no member 'save'; did you mean 'name'?
Replace 'save' with 'name' */  
  }
</code></pre>

<p>unable to figure out the solution.</p>
","7444874","","","","","2019-12-21 16:58:39","swift vapor routes error - Type has no member 'save'","<swift><routes><vapor>","2","0","","","","59437264","118712","118712","vapor","592","36204589","36204588"
"59464699","1","","","2019-12-24 06:28:16","","1","61","<p>When I click on add button it shows error - error   true
reason  ""Not Found""</p>

<p>configure.swift code - </p>

<pre><code>import FluentSQLite
import Vapor
import Leaf // added
public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
// Register providers first
try services.register(FluentSQLiteProvider())

// Register routes to the router
let router = EngineRouter.default()
try routes(router)
services.register(router, as: Router.self)

// Register middleware
var middlewares = MiddlewareConfig() // Create _empty_ middleware config
// middlewares.use(FileMiddleware.self) // Serves files from `Public/` directory
middlewares.use(ErrorMiddleware.self) // Catches errors and converts to HTTP response
services.register(middlewares)

let directoryConfig = DirectoryConfig.detect()
services.register(directoryConfig)
let sqlite = try SQLiteDatabase(storage: .file(path:""\(directoryConfig.workDir)pizza.db""))
var databases = DatabasesConfig()
databases.add(database: sqlite, as: .sqlite)
services.register(databases)

var migrations = MigrationConfig()
migrations.add(model: Todo.self, database: .sqlite)
migrations.add(model: Pizza.self, database: .sqlite)
services.register(migrations)

let leafProvider = LeafProvider()    // added
try services.register(leafProvider)  // added
config.prefer(LeafRenderer.self, for: ViewRenderer.self)// added
let serverConfigure = NIOServerConfig.default(hostname: ""0.0.0.0"", port: 9090)
services.register(serverConfigure)
 }
</code></pre>

<p>pizza.swift code -</p>

<p>import Foundation
  import Vapor
  import FluentSQLite</p>

<pre><code>struct Pizza: SQLiteModel, Content, SQLiteMigration, Migration {
    var id:  Int?
    var name: String
    var description: String
    var  price: Int
}
</code></pre>

<p>routes.swift code -</p>

<pre><code>import Routing
import Vapor
import FluentSQLite
public func routes(_ router: Router) throws {
    router.get { req -&gt; Future &lt;View&gt; in
        let Newyorker = Pizza(id: 5, name: ""statinisland"", description: ""impracticaljokers"", price: 55)
        let Traditional = Pizza(id: 5, name: ""rome"", description: ""pope"", price: 55)
        return try req.view().render(""welcome"",[""pizza"":[Newyorker,Traditional]])
    }
    router.post(Pizza.self, at: ""add"") { req, pizza in
        return pizza
    }
}
</code></pre>

<p>welcome leaf screenshot - </p>

<p><a href=""https://i.stack.imgur.com/dXYGB.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dXYGB.png"" alt=""enter image description here""></a></p>

<p>localhost screenshot -</p>

<p><a href=""https://i.stack.imgur.com/By0FM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/By0FM.png"" alt=""enter image description here""></a></p>

<p>error screenshot -</p>

<p><a href=""https://i.stack.imgur.com/V8rhY.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/V8rhY.png"" alt=""enter image description here""></a></p>

<p>unable to figure out. Thanks.</p>

<p>Edit 1.  I have pasted the leaf file -</p>

<pre><code> &lt;!DOCTYPE html&gt;
 &lt;html&gt;
 &lt;body&gt;
  &lt;h1&gt; Pizza &lt;/h1&gt;
  &lt;p&gt; Welcome to best pizza in the  world  &lt;/p&gt;
 &lt;ul&gt;
   #for(pizza in pizza)  {
  &lt;li&gt;(pizza.name)&lt;/li&gt;
  }
  &lt;/ul&gt;
 &lt;/body&gt;
 &lt;/html&gt;

 &lt;form method=""post"" action=""/add""&gt;
 &lt;p&gt;Name: &lt;input type=""text"" name = ""name"" /&gt;&lt;/p&gt;
 &lt;p&gt;Descrition: &lt;input type=""text"" name = ""description"" /&gt;&lt;/p&gt;
 &lt;p&gt;Price: &lt;input type=""number"" name = ""price"" /&gt;&lt;/p&gt;
 &lt;button type=""submit""&gt;Add&lt;/button&gt;
 &lt;/form&gt;
</code></pre>
","7444874","","7444874","","2019-12-24 10:20:36","2019-12-24 10:20:36","swift vapor ""add"" button is showing error","<swift><vapor><leaf>","0","11","","","","59464699","118712","118712","vapor","592","36204589","36204588"
"59471266","1","59472190","","2019-12-24 16:14:21","","1","61","<p>I have a parent-child relationship, and the children need to wrap into array how can I do it?</p>

<pre><code>
event.testPrices = release.testPrices

final class Event: Content {
    var id: String
    var inProgress: Bool?
    var name: String
    var purpose: String?
    var testPrices: [TestPrice]

    init(id: String, name: String) {
        self.id = id
        self.name = name
    }
}

extension Release { 
    var testPrices: Children&lt;Release, TestPrice&gt; {
        return children(\.releaseId)
    }
}
</code></pre>

<p>The assignment gives the error:</p>

<blockquote>
  <p>Cannot assign value of type 'Children' to type '[TestPrice]'</p>
</blockquote>
","239219","","2070111","","2019-12-24 18:36:43","2019-12-24 18:36:43","How to wrap relationship children into array in Vapor?","<swift><vapor>","1","0","","","","59471266","118712","118712","vapor","592","36204589","36204588"
"59472699","1","","","2019-12-24 19:15:01","","0","56","<p>I have following route:</p>

<pre><code>router.post([Page].self, at: ""/fetchStatusOfManagedReleases"") { (req, pages) -&gt; Future&lt;[Page]&gt; in
    let eventIds = pages.map { $0.events }.flatMap { $0 }.map { $0.id }
    return Release.query(on: req).filter(\.fbId ~~ eventIds).all().map { releases in
        var result: [Page] = []
        for p in pages {
            let page = p
            var pageEvents: [Event] = []
            for e in p.events {
                let event = e
                if let release = releases.first(where: { $0.fbId == e.id }) {
                    event.inProgress = release.inProgress
                    event.purpose = release.purpose
                    _ = try release.testPrices.query(on:req).all().map { testP in
                        event.testPrices = testP // &lt;--- this line is not applied
                    }
                } else {
                    event.inProgress = false
                }
                pageEvents.append(event)
            }
            page.events = pageEvents
            result.append(page)
        }
        return result
    }
}
</code></pre>

<p>Unfortunatelly <code>event.testPrices = testP</code> is not applied, it will e not part of the response. What can I do? At some cases I do not need to postpone ""return"". How can I dissolve scheduling issue?</p>
","239219","","","","","2019-12-25 13:45:58","Vapor: route return before all modification done","<future><vapor>","1","2","","","","59472699","118712","118712","vapor","592","36204589","36204588"
"59479650","1","","","2019-12-25 15:16:43","","0","59","<p>This code with <code>id</code> is accepted:</p>

<pre><code>router.post([Page].self, at: ""/fetchStatusOfManagedReleases"") { (req, pages) -&gt; Future&lt;[Page]&gt; in
    let eventIds = pages.map { $0.events }.flatMap { $0 }.map { $0.id }
    return Release.query(on: req).filter(\.fbId ~~ eventIds).all().flatMap { releases in
        let releaseInnerIds = releases.map {$0.id}

        return TestPrice.query(on: req).filter(\.id ~~ releaseInnerIds).all().flatMap { testPrices in
            return req.future([])
        }
</code></pre>

<p>but this here with <code>releaseId</code> is not:</p>

<pre><code>router.post([Page].self, at: ""/fetchStatusOfManagedReleases"") { (req, pages) -&gt; Future&lt;[Page]&gt; in
    let eventIds = pages.map { $0.events }.flatMap { $0 }.map { $0.id }
    return Release.query(on: req).filter(\.fbId ~~ eventIds).all().flatMap { releases in
        let releaseInnerIds = releases.map {$0.id}

        return TestPrice.query(on: req).filter(\.releaseId ~~ releaseInnerIds).all().flatMap { testPrices in
            return req.future([])
        }
</code></pre>

<p>TestPrice model:</p>

<pre><code>final class TestPrice: Content {
    var id: Int?
    var price: String
    var releaseId: Release.ID

    init(id: Int?, price: String, releaseId: Release.ID) {
        self.id = id
        self.price = price
        self.releaseId = releaseId
    }
}
</code></pre>

<p>Why? What workaround I need to do?</p>
","239219","","","","","2019-12-25 15:16:43","Based on which field can be filtered in Vapor?","<swift><vapor>","0","4","","","","59479650","118712","118712","vapor","592","36204589","36204588"
"59501047","1","59514959","","2019-12-27 12:48:37","","2","834","<p>I had this error when I was doing a tutorial. I could not solve the problem. So, I deleted the project and made a new simple project to figure-out the issue,but still having the same issue. I am posting relevant code -</p>

<p>package.swift code -</p>

<pre><code>// swift-tools-version:4.0
import PackageDescription

let package = Package(
name: ""dep"",
products: [
    .library(name: ""dep"", targets: [""App""]),
],
dependencies: [
    // 💧 A server-side Swift web framework.
    .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),

    // 🔵 Swift ORM (queries, models, relations, etc) built on SQLite      3.
    .package(url: ""https://github.com/vapor/fluent-sqlite.git"", from: ""3.0.0""),
        .package(url: ""https://github.com/vapor/leaf.git"", from: ""3.0.0""),

],
targets: [
    .target(name: ""App"", dependencies: [""Leaf"",""FluentSQLite"", ""Vapor""]),
    .target(name: ""Run"", dependencies: [""App""]),
    .testTarget(name: ""AppTests"", dependencies: [""App""])
]
</code></pre>

<p>)</p>

<p>When I do ""vapor build"" in <strong>terminal</strong> and press enter, the terminal shows error  - "" ""/Users/apple/dep: error: package at \'/Users/apple/dep\' is using Swift tools version 3.1.0 which is no longer supported; use 4.0.0 or newer instead\n"", output: """")""</p>

<p>I have done the usual stuff like clean-build folder, cleaning derived data etc.
Now, what should I do next. If you need any further information, I can post code(s) or screenshot(s). </p>
","7444874","","7444874","","2019-12-27 15:58:13","2020-01-10 15:05:20","terminal vapor update is using Swift tools version 3.1.0 which is no longer supported; use 4.0.0 or newer instead\n"", output:","<swift><vapor><leaf>","3","4","","","","59501047","118712","118712","vapor","592","36204589","36204588"
"59515713","1","","","2019-12-28 23:24:04","","1","68","<p>Here's the call that works with my API, but I need to render the result in leaf. This currently works fine with the API. Just not sure how where I'm grabbing the teams.</p>

<pre class=""lang-swift prettyprint-override""><code>func getTeamsWithUsersForEvent(_ req: Request) throws -&gt; Future&lt;[TeamWithUsers]&gt; {
        let currentID =  try req.parameters.next(Int.self)
        print(""currentID \(currentID)"")
        return Team.query(on: req).filter(\Team.eventID == currentID).sort(\Team.rawScore, .descending).range(..&lt;5).all().flatMap(to: [TeamWithUsers].self) { team in
            try team.map { team in
                try team.users.query(on: req).all().map { users in
                    var score: Int
                    if users.isEmpty {
                        score = 0
                    }else{
                        score = team.rawScore / users.count
                    }
                    return TeamWithUsers(
                        id: team.id,
                        name: team.name,
                        icon: team.icon,
                        eventID: team.eventID,
                        rawScore: team.rawScore,
                        //users: users,
                        count: users.count,
                        teamScore: score
//                        teamScore: team.rawScore / users.count
                    )
                }
            }.flatten(on: req)
        }
    }

struct TeamWithUsers: Content {
    let id: Int?
    let name: String
    let icon: String
    let eventID: Event.ID
    let rawScore: Int
    //let users: [User]
    let count: Int?
    let teamScore: Int
}
</code></pre>

<p>Here's the what I've started. This is my context.</p>

<pre class=""lang-swift prettyprint-override""><code>struct AllTeamsContext: Encodable {
  let title: String
  let teams: [TeamWithUsers]
}
</code></pre>

<p>And I've created the Leaf template called ""Leaders"" which just shows a table with TeamWithUsers per row.</p>

<pre class=""lang-html prettyprint-override""><code>#if(count(teams) &gt; 0) {
  &lt;table class=""table table-bordered table-hover""&gt;
    &lt;thead class=""thead-light""&gt;
      &lt;tr&gt;
        &lt;th&gt;Name&lt;/th&gt;
        &lt;th&gt;Icon&lt;/th&gt;
        &lt;th&gt;Score&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      #for(team in teams) {
        &lt;tr&gt;
          &lt;td&gt;#(team.name)&lt;/td&gt;
          &lt;td&gt;#(team.icon)&lt;/td&gt;
          &lt;td&gt;#(team.teamScore)&lt;/td&gt;
        &lt;/tr&gt;
      }
    &lt;/tbody&gt;
  &lt;/table&gt;
} else {
  &lt;h2&gt;There aren’t any teams yet.&lt;/h2&gt;
}
</code></pre>
","496193","","3103448","","2020-01-02 17:37:02","2020-01-02 17:42:24","Vapor 3 rendering complex call in Leaf","<vapor><leaf>","1","0","","","","59515713","118712","118712","vapor","592","36204589","36204588"
"59545558","1","59552214","","2019-12-31 14:49:34","","1","125","<p>// This is a continuation of the questions I have asked from a tutorial by Paul Hudson on youtube -</p>

<p>I have tried to add items to a database (see image below) -</p>

<p><a href=""https://i.stack.imgur.com/5ZPrv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/5ZPrv.png"" alt=""enter image description here""></a></p>

<p>When I should click on the ""Add"" button on the image above, the boxes should become EMPTY (See image below). Though .Quantum Pizza will not be added to the list of .Statin Island Pizza and .Country pizza, because I have not done further coding), but it should be as the image below -</p>

<p><a href=""https://i.stack.imgur.com/XVseC.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/XVseC.png"" alt=""enter image description here""></a></p>

<p>but, the result is as follows - </p>

<p><a href=""https://i.stack.imgur.com/xfv36.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/xfv36.png"" alt=""enter image description here""></a></p>

<p>Now, I am posting the codes -----</p>

<p>configure.swift -</p>

<pre class=""lang-swift prettyprint-override""><code>import  Fluent
import FluentSQLite
import Vapor
import Leaf // added

public func configure(_ config: inout Config, _ env: inout Environment, _ services: inout Services) throws {
    // Register routes to the router
    let router = EngineRouter.default()
    try routes(router)
    services.register(router, as: Router.self)

    let leafProvider = LeafProvider()    // added
    try services.register(leafProvider)  // added
    config.prefer(LeafRenderer.self, for: ViewRenderer.self)// added

    let directoryConfig = DirectoryConfig.detect()
    services.register(directoryConfig)
    try services.register(FluentSQLiteProvider())
    var databaseConfig = DatabasesConfig()
    let db = try SQLiteDatabase(storage: .file(path:""\(directoryConfig.workDir)pizza.db""))

    databaseConfig.add(database: db, as: .sqlite)
    services.register(databaseConfig)

    var migrationConfig = MigrationConfig()
    migrationConfig.add(model: Pizza.self, database: .sqlite)
    services.register(migrationConfig)
    let serverConfigure = NIOServerConfig.default(hostname: ""0.0.0.0"", port: 9090)
    services.register(serverConfigure)
}
</code></pre>

<p>routes.swift -</p>

<pre class=""lang-swift prettyprint-override""><code>import Routing
import Vapor
import FluentSQLite

public func routes(_ router: Router) throws {
    router.get { req -&gt; Future &lt;View&gt; in
        let Newyorker = Pizza(id: 5, name: ""Statin Island Pizza"", description: ""Impractical Jokers Funny Pizza"", price: 55)
        let Traditional = Pizza(id: 5, name: ""Country Pizza "", description: ""Johny Cash Special"", price: 55)

        return try req.view().render(""welcome"",[""pizza"":[Newyorker,Traditional]])
    }

    router.post(Pizza.self, at: ""add"") { req, pizza -&gt; Future&lt;Response&gt; in
        return pizza.save(on:req).map(to:Response.self) { Pizza in
            return req.redirect(to: ""/"")
        }
    }
}
</code></pre>

<p>pizza.swift -</p>

<pre class=""lang-swift prettyprint-override""><code>import Foundation
import Vapor
import FluentSQLite

struct Pizza: Encodable, Content, Decodable, SQLiteModel, Migration {
    var id:  Int?
    var name: String
    var description: String
    var price: Int
}
</code></pre>

<p>leaf screenshot (I tried to paste code, but couldn't, in the correct format. So  adding screeshot) -</p>

<p><a href=""https://i.stack.imgur.com/zYGVz.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zYGVz.png"" alt=""enter image description here""></a></p>

<p>Edit 1: screenshot after I click on the Add button -</p>

<p><a href=""https://i.stack.imgur.com/192PR.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/192PR.png"" alt=""enter image description here""></a></p>

<p>Ill be happy to provide you any further information if you need. 
Also, I would like to know if the title of my question should be modfied or anyhing should be added to it. Thank you.</p>
","7444874","","7444874","","2020-01-04 14:37:08","2020-01-06 03:18:00","Not able to add Items to Database","<swift><vapor><leaf>","2","3","","","","59545558","118712","118712","vapor","592","36204589","36204588"
"59567389","1","59571473","","2020-01-02 17:18:18","","1","76","<p>I'm trying to run a SQL Raw Query in a Vapor application, and decoded to a MySQLModel but apparently it returns an error.</p>

<pre><code>final class ClassA: MySQLModel {    
    var id: Int?
    var title: String
    var description: String
}
</code></pre>

<p>But when I run a simple Select From raw query it returns a decoding error: ""Value of type 'String' required for key 'title'."" with it's weird because the sql run in the MySQL console does run correctly. The thing is when I decode the same query but instead of using a MySQLModel I use a Content like this:</p>

<pre><code>final class ClassB: Content {    
    var id: Int?
    var title: String
    var description: String
}
</code></pre>

<p>And this is actually ends up decoding without errors. </p>

<p><strong>Edit:</strong> The ClassA works perfectly with the regular ORM, it is only when I try to decode from Raw Query that it fails.</p>

<p><strong>Edit:</strong> As ask by @Nick the sql does affect the response, when run:</p>

<pre><code>SELECT * FROM ClassA
</code></pre>

<p>The return comes back with no error, but my sql includes a complex Subquery like this: </p>

<pre><code>SELECT c.* FROM ClassA c WHERE c.id IN (SELECT id FROM ...);
</code></pre>

<p>Note: When run in MySQL Console the query returns no Error and as said the query can be decoded to a Content class exactly like ClassA Example: ClassB.</p>

<p><strong>Edit:</strong> The code for running and decoding the raw query is simply: </p>

<pre><code>return request.withNewConnection(to: .mysql) { (con) -&gt; EventLoopFuture&lt;[ClassA]&gt; in
    return con.raw(sql).all(decoding: ClassA.self).map { (classes) -&gt; [ClassA] in
        return classes
    }
}
</code></pre>
","8473109","","8473109","","2020-01-02 23:28:50","2020-01-02 23:47:03","Decoding Vapor raw query to MySQLModel","<swift><vapor>","1","5","","","","59567389","118712","118712","vapor","592","36204589","36204588"
"59586284","1","59589490","","2020-01-03 22:53:32","","1","57","<p>I am trying to render a template in Vapor 3 with Leaf. Most of my HTML is in my base.leaf. In the <code>login.leaf</code> template, I need to add a JS script. Trouble is when it gets to the function it breaks and renders the function. Can anyone tell me how to add these properly? Thanks for your help in advance. Here's what is giving me problems:</p>

<pre class=""lang-html prettyprint-override""><code>#set(""content"") {
  &lt;h1&gt;#(title)&lt;/h1&gt;
&lt;div id=""logo""&gt;&lt;img src=""images/global/journey_trax_logo.png"" alt=""""/&gt;&lt;/div&gt;
&lt;div id=""sheet1"" class=""form_sheet""&gt;
    &lt;input type=""text"" class=""text_input"" id=""name_field"" placeholder=""NAME""&gt;
    &lt;input type=""password"" class=""text_input"" id=""password_field"" placeholder=""PASSWORD""&gt;
    &lt;div id=""continue_btn1"" class=""text_btn"" onClick=""logIn();""&gt;Continue&lt;/div&gt;
    &lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/div&gt;
&lt;script&gt;
    var user_name = readCookie(""user_name"");
    var user_password = readCookie(""user_password"");
    document.getElementById(""user_name"").value = user_name;
    document.getElementById(""user_password"").value = user_password;

    function logIn() {
        var baseURL = window.top.location.href;
        if (baseURL.indexOf(""#"") != -1) {
            baseURL = window.location.href.split(""#"")[0];
        }
        var url = baseURL + ""login"";
        console.log(""[logIn] post to URL: ""+url);
        console.log(""[logIn] name: ""+user_name+"", password: ""+user_password);
        $.post( url,
          {
              name: user_name,
              password: user_password
          },
          function(data) {
            // Do something with the return data?
            console.log(""[logIn] callback data: ""+data);
            console.log(""[logIn] handle succes or error"");
            //
            parent.loadHTML('screens/home.html');
          }
       );
    }
&lt;/script&gt;
    &lt;style&gt;
        .text_input, select {
            width: 100%;
            margin-bottom: 30px;
        }

        .text_btn {
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
        }
    &lt;/style&gt;
}
#embed(""base"")
</code></pre>
","496193","","2070111","","2020-01-04 09:35:10","2020-01-04 09:57:21","Vapor 3 Rendering leaf template with script inline","<vapor><leaf>","1","0","","","","59586284","118712","118712","vapor","592","36204589","36204588"
"59601648","1","59602616","","2020-01-05 16:01:22","","1","93","<p>I want to use FluentMySQL in Vapor to save data but I cannot read UUIDs properly.</p>

<p>If I use the UUID() function delivered by MariaDB, everything is fine, but if I Use FluentMySQL, the UUID is scrambled:
(first record: Usage of UUID(), second record: Vapor)</p>

<pre><code>MariaDB [someDB]&gt; select * from Poll;
+--------------------------------------+-------+---------+---------+--------+--------+
| id                                   | title | option1 | option2 | votes1 | votes2 |
+--------------------------------------+-------+---------+---------+--------+--------+
| 88a18a58-2fcd-11ea-9f62-e283e8014c79 | test  | bla     | bla     |      0 |      0 |
| 7??/.?E??*_P?v                     | bla   | option1 | option2 |      1 |      2 |
+--------------------------------------+-------+---------+---------+--------+--------+
2 rows in set (0.00 sec)
</code></pre>

<p>This is my model:</p>

<pre><code>import Foundation
import FluentMySQL
import Vapor

struct Poll: Content, MySQLUUIDModel, Migration {
    typealias ID = UUID
    static let entity: String = ""Poll""

    var id: UUID?
    var title: String
    var option1: String
    var option2: String
    var votes1: Int
    var votes2: Int
}
</code></pre>

<p>this is my table:</p>

<pre><code>MariaDB [someDB]&gt; describe Poll;
+---------+--------------+------+-----+---------+-------+
| Field   | Type         | Null | Key | Default | Extra |
+---------+--------------+------+-----+---------+-------+
| id      | varchar(191) | YES  |     | NULL    |       |
| title   | varchar(191) | YES  |     | NULL    |       |
| option1 | varchar(191) | YES  |     | NULL    |       |
| option2 | varchar(191) | YES  |     | NULL    |       |
| votes1  | int(10)      | YES  |     | NULL    |       |
| votes2  | int(10)      | YES  |     | NULL    |       |
+---------+--------------+------+-----+---------+-------+
6 rows in set (0.00 sec)
</code></pre>

<p>But if use Vapor to fetch the data, everything seems to be fine. What am I doing wrong?</p>

<p>Output via curl: </p>

<pre><code>curl http://locurl http://localhost:8080/polls/list
[{""option1"":""bla"",""id"":""38386131-3861-3538-2D32-6663642D3131"",""title"":""test"",""option2"":""bla"",""votes1"":0,""votes2"":0},{""option1"":""option1"",""id"":""373F3F2F-2E3F-453F-3F0E-2A5F503F7607"",""title"":""bla"",""option2"":""option2"",""votes1"":1,""votes2"":2}]
</code></pre>

<p>Thank you for helping in advance.</p>
","12657017","","","","","2020-01-05 17:58:45","saving an UUID in MariaDB for use with Vapor","<swift><mariadb><fluent><vapor>","1","2","","","","59601648","118712","118712","vapor","592","36204589","36204588"
"59638972","1","","","2020-01-08 03:20:43","","1","45","<p>I have an Xcode project Pizaco which gives error - </p>

<pre><code>import UIKit

class ViewController: UITableViewController {
    var pizzas = pizza() // Error - Use of unresolved identifier 'Pizza'
    override func viewDidLoad() {
        super.viewDidLoad()
    }
</code></pre>

<p>The ""Pizza"" in the aforementioned error is from the vapor project (which works fine), would you care to see - <a href=""https://stackoverflow.com/questions/59545558/not-able-to-add-items-to-database/59552214#59552214"">Not able to add Items to Database</a></p>

<p>when I try to create a package file( because I want to create models), which gives the following error - </p>

<pre><code>   // swift-tools-version:4.2
  // The swift-tools-version declares the minimum version of Swift required to build this package.

     import PackageDescription // error -  No such module 'PackageDescription'
     import UIKit
     import vapor

    let package = Package(
    name: ""Pizaco"",
     products: [
    .library(name: ""Pizaco"", targets: [""App""]),
     ],
     dependencies: [
    // 💧 A server-side Swift web framework.
    .package(url: ""https://github.com/vapor/vapor.git"", from: ""3.0.0""),

    // 🔵 Swift ORM (queries, models, relations, etc) built on SQLite      3.
    .package(url: ""https://github.com/vapor/fluent-sqlite.git"", from: ""3.0.0""),
    .package(url: ""https://github.com/vapor/leaf.git"", from: ""3.0.0""),

    ],
   targets: [
    .target(name: ""App"", dependencies: [""Leaf"",""FluentSQLite"", ""Vapor""]),
    .target(name: ""Run"", dependencies: [""App""]),
    .testTarget(name: ""AppTests"", dependencies: [""App""])
  ]
  )
</code></pre>

<p>I know the above (No such module 'PackageDescription') error is not there in Xcode 11 (but I have Xcode 10 and I do not want to upgrade to 11 due to some reasons)
So, someone in the discordapp.com (vapor chat) forum told me to copy models directly from the vapor app to iOS app. So, one of my main questions is how to copy models to current project from vapor app?</p>

<p>Is there any other simple way to link IOS and vapor projects?</p>
","7444874","","1033581","","2020-01-09 13:03:06","2020-01-09 13:03:06","How to link vapor to ViewController / how to copy vapor models to IOS / how to import vapor package to IOS project (Xcode 10)","<ios><swift><xcode><model><vapor>","0","2","","","","59638972","118712","118712","vapor","592","36204589","36204588"
"59652708","1","","","2020-01-08 19:34:59","","3","49","<p>I want to configure Package.swift so that one target would be an extension to another, both of them should share the same code from the one folder, but for the ""extended"" version there is an additional subfolder. But configuration I try with <code>path</code> fails with ""overlapping sources"" error. So, how can I make two target with the same source folder?</p>

<pre><code>.target(name: ""App"", dependencies: [ ""Vapor"" ... ], exclude: [ ""Subfolder"" ])
.target(name: ""Extended"", dependencies: [ ""Vapor"", ... ], path: ""./Sources/App"")

swift build ... error: target 'Extended' has sources overlapping sources...
</code></pre>
","961037","","961037","","2020-01-08 20:53:19","2020-01-10 06:06:33","Two almost identical targets in Vapor Xcode project","<swift><vapor><swift-package-manager>","1","0","","","","59652708","118712","118712","vapor","592","36204589","36204588"
"59698461","1","59740633","","2020-01-11 20:39:09","","2","87","<p>I have a Javascript function in a leaf page using Vapor 3 the function should trigger a post to an api to save a customers card detials and return a token representing that card. I would normally do this in swift on our vapor server but to be PCI complient we are not allowed to take the customers credit card detials onto our server they must go directly to Sum Up (payment provider) I have no experiance with javascript and after lots of googling this it the fucntion I came up with.  </p>

<pre><code>    &lt;script&gt;
            function savecard() {

                var name = document.getElementById(""nameonCard"").value
                var cardNo = document.getElementById(""cardNumber"").value
                var expiry_year = document.getElementById(""expiryMonth"").value
                var expiry_month = document.getElementById(""expiryYear"").value
                var cvv = document.getElementById(""cvc"").value
                var body = `{""type"":""card"",""card"":{""name"":""${name}"",""number"":""${cardNo}"", ""expiry_month"": ""${expiry_month}"", ""expiry_year"": ""${expiry_year}"",""cvv"": ""${cvv}""}}`
                return fetch(""https://api.sumup.com/v0.1/customers/"" + #(sumCustId) + ""/payment-instruments"", {
                  method: ""POST""
                  headers: {
                    ""Authorization"": ""Basic "" + #(auth),
                    ""Content-Type"": ""application/json""
                  },
                  data: body,
                })
                .then(function(response){
                      document.getElementById(""response"").value = response.text()
                      return response.text();
                })
                .then(function(data){
                    console.log(data)//text version
                    var data_obj = JSON.parse(data);
                    document.getElementById(""data_obj"").value = data_obj
                    return data_obj
                })
            }
        &lt;/script&gt;
</code></pre>

<p>I don't appear to be getting anything back but I'm not sure where I am going wrong, any help is much appreciated.</p>

<p>Here is the entire leaf page. </p>

<pre class=""lang-html prettyprint-override""><code>&lt;!doctype html&gt;
&lt;html lang=""en""&gt;
    &lt;!-- Bootstrap CSS --&gt;
    &lt;link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous""&gt;

        &lt;title&gt;Pay for Membership&lt;/title&gt;
        &lt;body&gt;
            &lt;div class=""card bg-dark text-white h-100""&gt;
                &lt;img class=""card-img bg-dark img-fluid"" src=""https://images.unsplash.com/photo-1575151772039-542722abbf63?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format"" alt=""Card image""&gt;
                    &lt;div class=""card-img-overlay""&gt;
                        &lt;div class=""card-deck""&gt;
                        &lt;div class=""card bg-transparent border-warning align-self-start ""&gt;
                        &lt;div class=""card-header""&gt;
                            &lt;h4 class=""card-title text-center""&gt;Order Summary&lt;/h4&gt;
                        &lt;/div&gt;
                        &lt;div class=""card-body""&gt;
                            &lt;ul&gt;
                                #for(sum in orderSum){
                                    #if(isLast == false){
                                    &lt;li class=""list-group-item bg-transparent d-flex justify-content-between align-items-centert""&gt;#noam(sum)
                                    &lt;span class=""badge badge-info badge-pill text-right align-self-center""&gt;#am(sum)&lt;/span&gt;
                                    &lt;/li&gt;
                                    }
                                }
                            &lt;/ul&gt;
                        &lt;/div&gt;
                        &lt;div class=""card-footer text-center""&gt;
                            #for(sum in orderSum){
                                #if(isLast){
                                    &lt;h5&gt;#(sum)&lt;/h5&gt;
                                }
                            }
                        &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div class=""card bg-dark border-warning""&gt;
                            &lt;div class=""card-header""&gt;
                                &lt;h4 class=""card-title""&gt;Payment Details&lt;/h4&gt;
                            &lt;/div&gt;
                            &lt;div class=""card-body""&gt;
                                &lt;form method=""post"" action=""/completedsumupmember"" id=""paymentForm""&gt;
                                &lt;div class=""row form-group"" hidden&gt;
                                &lt;input type=""number"" class=""form-control"" id=""amount"" name=""amount"" value =#(amount) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""currency"" name=""currency"" value =#(currency) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""orderId"" name=""orderId"" value =#(orderId) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""desc"" name=""desc"" value =#(desc) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""type"" name=""type"" value =#(type) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""orgId"" name=""orgId"" value =#(orgId) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""payToEmail"" name=""payToEmail"" value =#(payToEmail) hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""auth"" name=""auth"" value =#(auth) hidden&gt;
                                &lt;input type=""hidden"" class=""form-control"" id=""response"" name=""response"" value ="""" hidden&gt;
                                &lt;input type=""hidden"" class=""form-control"" id=""data_obj"" name=""data_obj"" value ="""" hidden&gt;
                                &lt;input type=""text"" class=""form-control"" id=""customerId"" name=""customerId"" value =#(sumCustId) hidden&gt;
                            &lt;/div&gt;
                            &lt;div class=""row form-group""&gt;
                                &lt;div class = ""col-md""&gt;
                                    &lt;label for=""nameonCard""&gt;Name on the Card&lt;/label&gt;
                                    &lt;input type=""text"" class=""form-control"" id=""nameonCard"" name=""nameonCard"" placeholder=""John Smith"" required&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class =""row form-group""&gt;
                                &lt;div class =""col-lg""&gt;
                                    &lt;label for=""cardNumber""&gt;Card Number&lt;/label&gt;
                                    &lt;input type=""number"" class=""form-control"" id=""cardNumber"" name=""cardNumber"" placeholder=""1111 2222 3333 4444"" required&gt;
                            &lt;/div&gt;
                            &lt;/div&gt;
                                &lt;div class = ""row form-group""&gt;
                                    &lt;div class = ""col-md""&gt;
                                        &lt;label for=""expiryMonth""&gt;Expriy Month&lt;/label&gt;
                                        &lt;input type=""text"" class=""form-control"" id=""expiryMonth"" name=""expiryMonth"" placeholder=""mm"" required&gt;
                                    &lt;/div&gt;
                                    &lt;div class = ""col-md""&gt;
                                        &lt;label for=""expiry""&gt;Expriy Year&lt;/label&gt;
                                        &lt;input type=""text"" class=""form-control"" id=""expiryYear"" name=""expiryYear"" placeholder=""yy"" required&gt;
                                    &lt;/div&gt;
                                    &lt;div class = ""col-md""&gt;
                                        &lt;label for=""cvc""&gt;CVV&lt;/label&gt;
                                        &lt;input type=""text"" class=""form-control"" id=""cvc"" name=""cvc"" placeholder=""000"" required&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                &lt;div class=""card-footer text-center""&gt;
                                    &lt;button class=""btn btn-warning btn-block"" type=""submit"" onclick=""savecard()""&gt;Pay Now&lt;/button&gt;
                                &lt;/div&gt;
                                &lt;/form&gt;
                            &lt;/div&gt;


                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;/div&gt;


            &lt;!-- Optional JavaScript --&gt;
            &lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;
            &lt;script src=""https://code.jquery.com/jquery-3.2.1.slim.min.js"" integrity=""sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"" crossorigin=""anonymous""&gt;&lt;/script&gt;
            &lt;script src=""https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"" integrity=""sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"" crossorigin=""anonymous""&gt;&lt;/script&gt;
            &lt;script src=""https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"" integrity=""sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"" crossorigin=""anonymous""&gt;&lt;/script&gt;
            &lt;script&gt;
                function savecard() {

                    console.log('do something ')
                    var name = document.getElementById(""nameonCard"").value
                    var cardNo = document.getElementById(""cardNumber"").value
                    var expiry_year = document.getElementById(""expiryMonth"").value
                    var expiry_month = document.getElementById(""expiryYear"").value
                    var cvv = document.getElementById(""cvc"").value
                    var body = `{""type"":""card"",""card"":{""name"":""${name}"",""number"":""${cardNo}"", ""expiry_month"": ""${expiry_month}"", ""expiry_year"": ""${expiry_year}"",""cvv"": ""${cvv}""}}`
                    return fetch(""https://api.sumup.com/v0.1/customers/"" + #(sumCustId) + ""/payment-instruments"", {
                      method: ""POST""
                      headers: {
                        ""Authorization"": ""Basic "" + #(auth),
                        ""Content-Type"": ""application/json""
                      },
                      data: body,
                    })
                    .then(function(response){
                          document.getElementById(""response"").value = response.text()
                          return response.text();
                    })
                    .then(function(data){
                        console.log(data)//text version
                        var data_obj = JSON.parse(data);
                        document.getElementById(""data_obj"").value = data_obj
                        return data_obj
                    })
                }
            &lt;/script&gt;
        &lt;/body&gt;
    &lt;/html&gt; 
</code></pre>

<p>I have finally managed to get a function that works, which is below. </p>

<pre class=""lang-js prettyprint-override""><code>    &lt;script&gt;
        function savecard() {
            let customerId = document.getElementById(""customerId"").value;
            let url = ""https://api.sumup.com/v0.1/customers/"" + customerId + ""/payment-instruments""
            let auth = "" Basic "" + document.getElementById(""auth"").value;
            alert(auth);

            let cardBody = {
                type:""card"",
                card: {
                name: document.getElementById(""nameonCard"").value,
                cardNo: document.getElementById(""cardNumber"").value,
                expiry_year: document.getElementById(""expiryMonth"").value,
                expiry_month: document.getElementById(""expiryYear"").value,
                cvv: document.getElementById(""cvc"").value
                }
                };
            alert(cardBody.card.name);
            let options = {
                //mode: 'no-cors',
                method: 'POST',
                body: JSON.stringify(cardBody),
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': auth
                }
            }

            fetch(url, options)
            .then(res =&gt; res.json())
            .then(res =&gt; alert(res))
            .catch(err =&gt; alert(`Error with message: ${err}`));;
        }
    &lt;/script&gt; 
</code></pre>

<p>However I am now getting an error in the catch </p>

<p><code>SyntaxError: JSON.parse: unexpected end of data at line 1 column 1 of the JSON data</code></p>

<p>Seems like this is a simple typo, but I've been looking at it to long to see what it is. </p>
","7301801","","7301801","","2020-01-13 21:10:56","2020-01-14 19:37:41","Javascript function in vapor 3 leaf - Help Need","<javascript><vapor><leaf>","1","7","","","","59698461","118712","118712","vapor","592","36204589","36204588"
"59749447","1","","","2020-01-15 10:25:15","","1","59","<p>I've created migration for adding a field to the Postgres table, it works as expected on the existing database. But when I want to run the same vapor server with a new database it crashes on the migration with the ""field already exists"" message, which is, of course, understandable. But how to maintain the server code so it could work both with existing and new databases?</p>

<pre><code>Fatal error: Error raised at top level: PostgreSQL Error: column ""the_coloumn"" of relation ""User"" already exists
- id: PostgreSQLError.server.error.check_for_column_name_collision
: file /BuildRoot/Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-1100.8.280/swift/stdlib/public/core/ErrorType.swift, line 200
</code></pre>
","961037","","","","","2020-01-15 19:51:44","Avoiding Vapor migrations on a new database","<swift><vapor><vapor-fluent>","1","0","","","","59749447","118712","118712","vapor","592","36204589","36204588"
"59810669","1","59812211","","2020-01-19 13:52:49","","1","54","<p>I have a temple that render a table using a struct that represents all the data. </p>

<p>The template look like this. </p>

<pre><code>&lt;div class=""card shadow mb-4""&gt;
&lt;div class=""card-header py-3""&gt;
  &lt;h6 class=""m-0 font-weight-bold text-primary""&gt;DataTables Example&lt;/h6&gt;
&lt;/div&gt;
&lt;div class=""card-body""&gt;
  &lt;div class=""table-responsive""&gt;
    &lt;table class=""table table-bordered"" id=""dataTable"" width=""100%"" cellspacing=""0""&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          #for(colums in page.table.columns) {
              &lt;th&gt;#(colums)&lt;/th&gt;
          }
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tfoot&gt;
        &lt;tr&gt;
          #for(colums in page.table.columns) {
              &lt;th&gt;#(colums)&lt;/th&gt;
          }
        &lt;/tr&gt;
      &lt;/tfoot&gt;
      &lt;tbody&gt;
          #for(row in page.table.rows) {
            &lt;tr&gt;
            #for(data in row.datas) {
               &lt;td&gt;#(data)&lt;/td&gt;
            }
            &lt;/tr&gt;&gt;
          }
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>For this scenario this works. But let's say in another page I have a different data structure. So not <code>page.table</code> but <code>page.grid.table</code> how can I still use this template?</p>

<p>My initial though was to change the template ta use <code>table.columns</code> instead of <code>page.table.columns</code> and then ""assign"" the the table variable right before I embed the template. This way you could also have multiple table if you like and just re-assign the <code>table</code> before you embed it. </p>

<p>I'm not very experience with web-development so maybe I'm just thinking of this wrong. </p>
","805316","","","","","2020-01-20 17:35:57","How to assign variable in Vapor leaf?","<swift><vapor><leaf>","1","0","","","","59810669","118712","118712","vapor","592","36204589","36204588"
"59847423","1","59847567","","2020-01-21 18:48:14","","1","46","<p>I want to return a file via a route that I don't want public. My users will need to use a URL with a unique and one time code. Because of that I don't want to use the public folder via the FileMiddleware.</p>

<p>This is a binary executable, not a text file. I can grab the file as data with FileManager, but it seems like <code>Future&lt;Data&gt;</code> is not a valid return type for a route.</p>

<p>After searching StackOverflow, the only thing I've found is this reply to a similar question: <a href=""https://stackoverflow.com/questions/41917803/how-do-i-download-a-file-and-send-a-file-using-vapor-server-side-swift/41974725#41974725"">How do I download a file and send a file using Vapor server side swift?</a></p>

<p>But that doesn't really fill in much on HOW to accomplish it.</p>
","5919644","","5919644","","2020-01-21 20:47:16","2020-01-21 20:47:16","Returning a binary file from a custom route (not FileMiddeleware's public folder)","<swift><vapor>","1","0","","","","59847423","118712","118712","vapor","592","36204589","36204588"
"59856121","1","59856498","","2020-01-22 09:12:23","","1","59","<p>I've created a basic backend written in Swift using the Vapor framework. I am running it locally on my machine, so it can be reached at <code>http://localhost:8080</code>.<br>
For the project I'm working on, I'm also building the frontend, which is built using ReactJS and can be reached at <code>http://localhost:3000</code>.</p>

<p>When calling my backend in <strong>Postman</strong>, with the following info, the request works fine and the user is created in the database:</p>

<p><strong>Method</strong><br>
POST /user</p>

<p><strong>Headers</strong><br>
Content-Type: application/json
Accept: application/json</p>

<p><strong>Body</strong></p>

<pre><code>{
    email: ""email@example.com
    password: ""12345""
}
</code></pre>

<p>Now, when calling that same method with the same body &amp; headers from within the local frontend, my request immediately fails, without any response:</p>

<p><img src=""https://i.stack.imgur.com/NqdMP.png"" alt=""failed response""></p>

<p>When I inspect the response, I see that all body &amp; headers were sent properly, but there was no response.<br>
I googled a little and realized that Postman (&amp; similar) behave differently than browsers and that I should check whether the method works with <code>OPTIONS</code>, instead of <code>POST</code>. I called the method again: <code>OPTIONS /user</code> and it failed in Postman as well:</p>

<p><a href=""https://i.stack.imgur.com/NkDyw.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/NkDyw.png"" alt=""failed options call""></a></p>

<p>The only difference is, in Postman, I receive a response, being <em>""Result not found""</em> as you can see in the screenshot.</p>

<p>I thought, it may have something to do with <code>localhost</code> in the API call's url, since the frontend is also running on localhost. So I used ngrok to forward my port 8080 (backend) and then called the <code>*.ngrok.io</code> url, instead of <code>localhost:8080</code>. No luck.<br>
I also tried using my machine's network IP address, instead of <code>localhost</code>. Still no luck.</p>

<p>What can I do about this?</p>
","3397217","","3397217","","2020-01-22 20:43:52","2020-03-20 19:35:31","Preflight requests (OPTIONS) failing for local vapor project","<swift><vapor><preflight>","1","3","","","","59856121","118712","118712","vapor","592","36204589","36204588"
"59975829","1","","","2020-01-29 21:28:55","","1","110","<p>I am trying to upload an image (.jpg) to a Vapor server as a binary file (no multipart form). Currently I have the following route:</p>

<pre><code>router.put(""images"") { (req) -&gt; Future&lt;HTTPStatus&gt; in
    // Don't do anything with the decoded file for now...
    return try req.content.decode(File.self).transform(to: .ok)
}
</code></pre>

<p>The problem is when I upload a jpg image with Insomnia (/Postman) the following error occurs:</p>

<pre><code>[ ERROR ] Abort.httpDecoder: Unsupported Media Type (ContentCoders.swift:60)
[ DEBUG ] Suggested fixes for Abort.httpDecoder: Register an `HTTPMessageDecoder` using `ContentConfig`. Use one of the decoding methods that accepts a custom decoder. (ErrorMiddleware.swift:26)
</code></pre>

<p>In Insomnia (/Postman) the...</p>

<p>...HTTP-Body is configured as a binary file (no multiform!)</p>

<p>...Content-Type is set to image/jpeg</p>

<p>In <code>configure.swift</code> I tried to register a HTTPMessageDecoder like the error message told me, but I don't know exactly how to do it:</p>

<pre><code>var contentConfig = ContentConfig()
contentConfig.use(dataDecoder: &lt;#T##DataDecoder#&gt;, for: .jpeg)
services.register(contentConfig)
</code></pre>
","6912779","","","","","2020-01-29 21:28:55","Vapor 3: Upload and decode image as binary file","<swift><xcode><vapor><server-side-swift><vapor-fluent>","0","4","","","","59975829","118712","118712","vapor","592","36204589","36204588"
"60018572","1","","","2020-02-01 15:57:17","","2","87","<p>I am following the book ""Server Side Swift Vapor Edition"" and I am trying to work on the exercises at page 174. </p>

<p>I have a struct called Poll, defined this way:</p>

<pre><code>struct Poll: Content, SQLiteUUIDModel, Migration {
    var id: UUID?
    var title: String
    var option1: String
    var option2: String
    var votes1: Int
    var votes2: Int
}
</code></pre>

<p>It is mapped into a SQLite database with Fluent, and I am trying to write a route that given a post request like this one: </p>

<p>localhost:8080/polls/delete/</p>

<p>Is able to find the poll object in the database, return an error if it doesn't exist, or delete if it exists. This is how I am solving the problem at the moment:</p>

<pre><code>router.post(""polls"", ""delete"", UUID.parameter) { req -&gt; Future&lt;Poll&gt; in
    let id = try req.parameters.next(UUID.self)

    return Poll.find(id, on: req).map(to: Poll.self) { poll in
        guard let poll = poll else {
            throw Abort(.notFound)
        }

        poll.delete(on: req)

        return poll
    }
}
</code></pre>

<p>Let's break it down:</p>

<ol>
<li>I read for the UUID passed in the post request (e.g. <a href=""http://localhost:8080/polls/delete/FBF7FDC2-0ECB-4C1F-AD8F-A62DE68E531B"" rel=""nofollow noreferrer"">http://localhost:8080/polls/delete/FBF7FDC2-0ECB-4C1F-AD8F-A62DE68E531B</a>)</li>
<li>I try to find the poll</li>
<li>If the poll object is nil (which means that it was not found), I throw a 404 not found error</li>
<li>If I find it, I delete the poll and I return it</li>
</ol>

<p>This works. I am able to delete polls by using this route.
But I have some questions in my mind:</p>

<ol>
<li>Can it be that the delete method still fails? (e.g. because of an internal SQLite error)</li>
<li>If yes, can I wait until the poll is actually deleted before returning it?</li>
</ol>

<p>The problem is that the delete method returns an object of type EventLoopFuture. If it was an object of tupe EventLoopFuture, I would be able to easily map it to a poll. But being that the template argument is Void, if I modify the code this way:</p>

<pre><code>router.post(""polls"", ""delete"", UUID.parameter) { req -&gt; Future&lt;Poll&gt; in
    let id = try req.parameters.next(UUID.self)

    return Poll.find(id, on: req).flatMap(to: Poll.self) { poll in
        guard let poll = poll else {
            throw Abort(.notFound)
        }

        return poll.delete(on: req).flatMap(to: Poll.self) { poll -&gt; EventLoopFuture&lt;Poll&gt; in
            return poll
        }
    }
}
</code></pre>

<p>I get a syntax error: ""Cannot convert value of type 'Void' to closure result type 'EventLoopFuture'"". It looks like I am not able to map an EventLoopFuture object to EventLoopFuture. The problem is just that I want to wait for the delete operation to complete before returning. Any solution?</p>
","570339","","","","","2020-02-01 17:24:14","How to wait on a future that returns void?","<swift><fluent><vapor><fluentsqlite>","1","3","","","","60018572","118712","118712","vapor","592","36204589","36204588"
"60030774","1","60030948","","2020-02-02 21:31:18","","1","42","<p>I am writing backend using Vapor 3 and macOS 10.15 (Mac Mini). The project is ready and working. Problem is how to protect code. I don't want to store code on server unprotected. Question is: how to protect code from anyone who can access to this server (direct, physical access too: someone, who know password can clone it to flash drive)? I heard that it's impossible to build or compile Vapor app in Xcode like iOS application (Product -> Archive) (<a href=""https://stackoverflow.com/questions/48725561/compiling-vapor-as-standalone-app-on-macos"">Compiling Vapor as Standalone App on MacOS</a>). If it's possible, please let me know. Code hardening (make code hardly readable) is easy to breach (at least, my version of hardening). Maybe, can I store code (some files with .swift extension) in some cloud storage (Github, Google Drive)? Or, is there any other way to protect code? </p>

<p>Thank you for any help or advice!</p>
","4716121","","","","","2020-02-02 21:51:16","Hot to protect Vapor code from access (any type of access, even physical)?","<macos><security><cloud><hosting><vapor>","1","0","","","","60030774","118712","118712","vapor","592","36204589","36204588"
"60030978","1","60065199","","2020-02-02 21:55:06","","3","41","<p>I have a controller whose create action I want to accept JSON either like this:</p>

<pre><code>{ ""foo"": ""bar"" }
</code></pre>

<p>OR like this:</p>

<pre><code>{ ""widget"": { ""foo"": ""bar"" } }
</code></pre>

<p>That is, I want to accept either the widget or the widget wrapped in a containing object. Currently, the create action for my controller looks a lot like this: </p>

<pre><code>func createHandler(_ req: Request) throws -&gt; Future&lt;Widget&gt; {
  do {
    return try req.content.decode(WidgetCreateHolder.self).flatMap(to: Widget.self) {
      return createWidget(from: $0.widget)
    }
  } catch DecodingError.keyNotFound {
    return try req.content.decode(WidgetCreateObject.self).flatMap(to: Widget.self) {
      return createWidget(from: $0)
    }
  }
}
</code></pre>

<p>where <code>WidgetCreateObject</code> looks something like:</p>

<pre><code>struct WidgetCreateObject { var foo: String? }
</code></pre>

<p>and where <code>WidgetCreateHolder</code> looks like:</p>

<pre><code>struct WidgetCreateHolder { var widget: WidgetCreateObject }
</code></pre>

<p>That is, my create action should <code>try</code> to create a holder, but if that fails it should catch the error and try just creating the inner object (a <code>WidgetCreateObject</code>). However, when I deploy this code to Heroku and make a request with just the inner object JSON, I get this in my logs:</p>

<pre><code>[ ERROR ] DecodingError.keyNotFound: Value required for key 'widget'. (ErrorMiddleware.swift:26)
</code></pre>

<p>even though I am trying to catch that error!</p>

<p>How can I get my create action to accept two different formats of JSON object?</p>
","1799154","","1799154","","2020-02-04 20:37:49","2020-02-04 20:37:49","Vapor 3 decoding content: do/catch for multiple post formats?","<swift><vapor><vapor-fluent>","1","1","","","","60030978","118712","118712","vapor","592","36204589","36204588"
"60104516","1","","","2020-02-06 22:29:07","","2","63","<p>I've been trying to link up my PostgreSQL database to a Swift Vapor project so I create routes to it. The first table I want to access is a table in <code>my_database</code> calls <code>users</code>. It has the properties <code>user_id</code> (primary integer key) and <code>created_on</code> (timestamp with time zone).</p>

<p>I've linked my Vapor project to <code>my_database</code> so that I can create new models. However, what if I want access to the pre-existing table <code>users</code>. Here's what I've cobbled together from the documentation and a few tutorials:</p>

<p><strong>My initial model:</strong></p>

<pre><code>final class Users: Model {

static let name = ""users""

typealias ID = Int
typealias Database = PostgreSQLDatabase

static let idKey: WritableKeyPath&lt;Users, Int?&gt; = \.user_id

var user_id: Int?
var created_on: Date
}

extension Users: Content { }
</code></pre>

<p><strong>My migration (which I think is just a 'blank' migration, just to hook the project to the table?):</strong></p>

<pre><code>struct FirstMigration: PostgreSQLMigration {
static func prepare(on conn: PostgreSQLConnection) -&gt; EventLoopFuture&lt;Void&gt; {
    return conn.future()
}

static func revert(on conn: PostgreSQLConnection) -&gt; EventLoopFuture&lt;Void&gt; {
    return Future&lt;Void&gt;.done(on: conn)
   }
}
</code></pre>

<p><strong>And my configuration:</strong></p>

<pre><code>var migrations = MigrationConfig()
migrations.add(migration: FirstMigration.self, database: .psql)
services.register(migrations)
</code></pre>

<p>Any guidance much appreciated!</p>
","5954887","","","","","2020-02-07 10:39:17","Linking my Fluent model to a pre-existing database table","<swift><postgresql><vapor><server-side-swift><vapor-fluent>","1","0","","","","60104516","118712","118712","vapor","592","36204589","36204588"
"60194626","1","","","2020-02-12 18:12:20","","1","55","<p>I'm trying to run vapor hello project via terminal. Didn't touch any code. </p>

<p>Building is ok, but it doesn't run.</p>

<p>Already tried </p>

<ul>
<li>clean and rebuild</li>
<li>force reinstall vapor</li>
<li>check that libsqlite3.dylib is loaded</li>
</ul>

<p>Here's terminal output:</p>

<pre><code>MacBook-Air-Dmitrij:Hello dev$ vapor run
Running Hello ...
[ INFO ] Migrating 'sqlite' database (/Users/dev/Hello/.build/checkouts/fluent.git-6251908308727715749/Sources/Fluent/Migration/MigrationConfig.swift:69)
dyld: lazy symbol binding failed: Symbol not found: _sqlite3_column_table_name
  Referenced from: /Users/dev/Hello/.build/debug/Run
  Expected in: /usr/lib/libsqlite3.dylib

dyld: Symbol not found: _sqlite3_column_table_name
  Referenced from: /Users/dev/Hello/.build/debug/Run
  Expected in: /usr/lib/libsqlite3.dylib
</code></pre>

<p>Do you have any idea, what's going on?</p>

<ul>
<li>MacOS 10.12.6</li>
<li>Swift 4.1.3</li>
<li>Xcode 9.3</li>
<li>Vapor Toolbox: 3.1.10</li>
<li>Vapor Framework: 3.3.1</li>
</ul>
","8253977","","8253977","","2020-02-12 18:52:26","2020-02-12 18:52:26","Why does a vapor ""hello"" project crush right after start on Sierra?","<macos-sierra><vapor><dyld>","0","3","","","","60194626","118712","118712","vapor","592","36204589","36204588"
"60197612","1","","","2020-02-12 22:07:38","","1","41","<p>I have this server running LEMP hosted on Digital Ocean. I use it for 2 reasons:</p>

<ol>
<li>My personal website - Regular Web pages such as index.html</li>
<li>My game (app) backend using PHP, and PHPMyAdmin with SQL tables and some json files.</li>
</ol>

<p>I would like to migrate to Vapor. But I have questions as to how it works.</p>

<ol>
<li>The current server already supports https, and I don't want it to change. If I stop my server, all my users will be in the dark.</li>
<li>I need the old system (php) to keep running and working as usual while I am testing and developing the vapor app, even if the vapor app runs in a different directory than the PHP backend. - The requests that keep coming looking for the php files have to keep working.</li>
</ol>

<p><strong>Old and running PHP version</strong></p>

<p>A user is usually accessing: example.com/news_service.php</p>

<p><strong>New Vapor version</strong></p>

<p>I would like to create a similar ""get"" address: example.com/news/service</p>

<p><strong>Questions:</strong></p>

<p>Does anyone know if by installing Swift and Vapor, I could mess up my old system? 
Would I have to get another droplet to build this new system?
Is it possible to re-direct all requests to a certain folder, and ONLY that folder will run the Vapor app (get the requests) while everything else is running on LEMP?</p>
","1043802","","22820","","2020-02-16 16:20:22","2020-02-21 02:12:37","Vapor on top of LEMP","<php><swift><nginx><vapor>","1","1","","","","60197612","118712","118712","vapor","592","36204589","36204588"
"60223999","1","","","2020-02-14 09:58:39","","2","29","<p>I am mostly interested in the general concept, but specifically I need to understand this concept in order to learn server side programming with Swift/Vapor. But it's fine to get a generic answer even if you don't know Swift/Vapor.</p>

<p>I found out that in order to connect to a database, I can use these two methods:</p>

<pre><code>func requestPooledConnection&lt;Database&gt;(to dbid: DatabaseIdentifier&lt;Database&gt;) -&gt; Future&lt;Database.Connection&gt;

func requestCachedConnection&lt;Database&gt;(to database: DatabaseIdentifier&lt;Database&gt;) -&gt; Future&lt;Database.Connection&gt;
</code></pre>

<p>Now what I understand from the documentation (Source: <a href=""https://docs.vapor.codes/3.0/database-kit/overview/#pools"" rel=""nofollow noreferrer"">https://docs.vapor.codes/3.0/database-kit/overview/#pools</a>) is:</p>

<ul>
<li>With pooling I can reuse an existing connection, or create a new one if none exists</li>
<li>With pooling connections are not shared between event loops, in order to prevent race conditions</li>
<li>There is <strong>usually</strong> one pool per database per event loop</li>
<li>With caching, you get one connection per database ID</li>
</ul>

<p>Now that's a bit confusing, specially the term 'usually' and I also tried to search more documentation about the general concept (e.g. <a href=""https://en.wikipedia.org/wiki/Connection_pool"" rel=""nofollow noreferrer"">https://en.wikipedia.org/wiki/Connection_pool</a>), and it looks like the words 'caching' and 'pooling' are used interchangeably sometimes. Now I am interested in understanding the difference because this would be useful in order to optimise correctly my web services. But to me it looks like - at least for how I understand Vapor's documentation - they're very similar concepts, and I don't get the difference. Can somebody clarify that?</p>
","570339","","","","","2020-02-14 10:02:57","What is the difference between database caching and pooling","<database><sqlite><vapor>","1","0","","","","60223999","118712","118712","vapor","592","36204589","36204588"
"60278510","1","","","2020-02-18 10:16:24","","1","49","<p>I need to use embedded array in <code>Fluent</code> Postgres table. </p>

<pre class=""lang-swift prettyprint-override""><code>final class TempUser: Content {
    var id: Int?
    var Uuid: String
    var bookedSeats: [BookedSeat] // &lt;- HERE
</code></pre>

<p>and </p>

<pre class=""lang-swift prettyprint-override""><code>struct BookedSeat: Content {
    var price: String
    var sectorInd: Int
    var rowInd: Int
    var seatInd: Int
    var bookedUntil: Date
}
</code></pre>

<p>But get an error and warning:</p>

<pre class=""lang-none prettyprint-override""><code>[WARNING] [PostgreSQL] Could not determine PostgreSQL array data type: Array&lt;BookedSeat&gt;
[ ERROR ] PostgreSQLError.server.error.array_recv: wrong element type (ErrorMiddleware.swift:26)
</code></pre>

<p>I did a custom solution, doing encoding decoding of the array manually:</p>

<pre class=""lang-swift prettyprint-override""><code>func setBookedSeatsArray(bs: [BookedSeat]) {
    let encoder = JSONEncoder()
    let data = try! encoder.encode(bs)
    let ret = String(data: data, encoding: .utf8)!
    self.bookedSeats = ret
}

func getGookedSeatsArray() -&gt; [BookedSeat] {
    let decoder = JSONDecoder()
    let ret = try! decoder.decode([BookedSeat].self, from: self.bookedSeats)
    return ret
}
</code></pre>

<p>but I do not really like this solution.</p>

<p>Someone said: I need to conform entity to <code>PostgreSQLDataTypeStaticRepresentable</code>.</p>

<p>But I can not figure out how?</p>

<p><a href=""https://i.stack.imgur.com/9ufAL.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/9ufAL.png"" alt=""enter image description here""></a> </p>

<p><a href=""https://i.stack.imgur.com/AHGKA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/AHGKA.png"" alt=""enter image description here""></a></p>
","239219","","3103448","","2020-02-18 17:29:58","2020-02-18 17:29:58","How to use embedded array in Vapor Postgres table?","<postgresql><vapor>","0","0","","","","60278510","118712","118712","vapor","592","36204589","36204588"
"60292259","1","","","2020-02-19 02:46:50","","2","39","<p>I have a table in a PostgreSQL database used by a Vapor Swift app.  One of the columns in the table is an array of strings.</p>

<pre class=""lang-sql prettyprint-override""><code>CREATE TABLE ""Code"" (
    id uuid PRIMARY KEY,
    name text NOT NULL,
    lines text[] NOT NULL
);
</code></pre>

<p>I'd like to select some rows, pulling only the first four items from the array.  The raw SQL is this:</p>

<pre><code>SELECT id, name, lines[1:4] FROM ""Code""
</code></pre>

<p>Is there a way to specify the array subset via Vapor's Fluent syntax?  I would also be happy using a raw SQL query, that can then be decoded by the model (like <code>alsoDecode</code> with joins).</p>

<p>This is the model, fwiw:</p>

<pre class=""lang-swift prettyprint-override""><code>struct Snippet: Codable, PostgreSQLUUIDModel {
    var id: UUID?
    var name: String
    var lines: [String]
}
</code></pre>

<p>Thanks!</p>
","690043","","","","","2020-02-19 02:46:50","Is there a way to select a subset of an array in Vapor/Fluent?","<postgresql><vapor><vapor-fluent>","0","3","","","","60292259","118712","118712","vapor","592","36204589","36204588"
"60340296","1","60353920","","2020-02-21 14:09:30","","1","85","<p>I'm very new to Vapor and backend logic in general.
I'm building a simple web app with Leaf and I'm trying to read data from a psql database and display them in a html/css (leaf) page. 
The problem is that when I pass my parameters to the page, it doesn't load the css and the images. </p>

<p>This is the function in my controller</p>

<pre><code>my project configuration:

App
├── Package.swift
├── Resources
│   ├── Views
│   │   └── index.leaf
├── Public
│   ├── images (images resources)
│   ├── styles (css resources)
└── Sources
    ├── App
         ├── Controllers
         │        └── PoesiaController.swift
         ├── Models
               └── Poesia.swift

final class PoesiaController {

func createView(_ req: Request) throws -&gt; Future&lt;View&gt; {
        let id: Int = try req.parameters.next(Int.self)
        return Poesia.find(id, on: req).unwrap(or: NSError(domain: ""errore"", code: 1, userInfo: nil)).flatMap(to: View.self) { p in
            return try req.view().render(""index"", [""title"": p.title, ""content"":p.content])
        }
    }

}
</code></pre>

<p>and I created a route as</p>

<pre><code>let poesieController = PoesiaController()
router.get(""poesia"", Int.parameter, use: poesieController.createView)
</code></pre>

<p>when I run the page has the correct data but no css or images are loaded.</p>

<p>my index.leaf file</p>

<pre><code>
&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;link href=""https://fonts.googleapis.com/css?family=Long+Cang&amp;display=swap"" rel=""stylesheet""&gt;
    &lt;meta name=""viewport"" content=""width=device-width, initial-scale=1, viewport-fit=cover""&gt;
    &lt;link rel=""stylesheet"" href=""styles/poesie.css""&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;!--Frontpage image with overlay--&gt;
    &lt;div class=""container""&gt;
          &lt;img class=""frontpage"" id= 'frontpage' src=""images/alle-scoperte.jpg""/&gt;
          &lt;div class=""overlay""&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;!--Sticky Title with overlay--&gt;
    &lt;div class=""title""&gt;
          &lt;div class=""sticky"" style=""background-image: url('images/alle-scoperte.jpg'); background-position: center bottom; background-size: cover;""&gt;
              &lt;span id=""titleText""&gt;#(title)&lt;/span&gt;
              &lt;img class=""nav"" src=""images/icons/menu.png"" onclick=""openMenu()"" /&gt;
              &lt;div class=""menu""&gt;
                  &lt;img src=""images/icons/home.png""&gt;
                  &lt;img src=""images/icons/poesie.png""&gt;
                  &lt;img src=""images/icons/lib.png""&gt;
                  &lt;img src=""images/icons/collab.png""&gt;
                  &lt;img src=""images/icons/book.png""&gt;
                  &lt;img src=""images/icons/chem.png""&gt;
              &lt;/div&gt;
          &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--Three Columns, left and right for author notes and center for text--&gt;
    &lt;div class=""row""&gt;
      &lt;div id=""column_left"" class=""column""&gt;
          &lt;div id=""note1"" class=""note""&gt;
              &lt;span class=""left""&gt;Conoscere una persona significa aprirsi ad un mondo.&lt;/span&gt;
          &lt;/div&gt;
          &lt;div id=""note2"" class=""note""&gt;
              &lt;span class=""left""&gt;Tutto racchiuso nell'unicit&amp;agrave; dei primi incontri.&lt;/span&gt;
          &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=""column_center"" class=""column""&gt;
        &lt;div class= ""content""&gt;
            &lt;div class=""sheet""&gt;
               #(content)
            &lt;/div&gt;
            &lt;div class='hint'&gt;
                &lt;div id = ""rotate""&gt;
                    &lt;img src=""images/icons/rotate.png""&gt;
                &lt;/div&gt;
                Ruota il dispositivo per vedere il commento.
            &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=""column_right"" class=""column""&gt;
          &lt;div id=""note3"" class=""note""&gt;
            &lt;span class=""right""&gt;Una terra nuova da scoprire attraverso la curiosit&amp;agrave; ed il piacere.&lt;/span&gt;
          &lt;/div&gt;
          &lt;div id=""note4"" class=""note""&gt;
              &lt;span class=""right""&gt;Commento&lt;/span&gt;
          &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=""footer""&gt;
        &amp;copy;Luis Claudio Pantaleone | Designed and Developed by Simone Deriu | Credits
    &lt;/div&gt;
&lt;/body&gt;
&lt;script src=""js/jquery-3.4.1.min.js""&gt;&lt;/script&gt;
&lt;script src=""js/main.js""&gt;&lt;/script&gt;

&lt;/html&gt;
</code></pre>

<p>the strange thing is that if i create a route to display the page without variables, or outside the object mapping, it shows normally.</p>

<pre><code> router.get(""index"") {req -&gt; Future&lt;View&gt; in
        return try req.view().render(""index"")
    }
</code></pre>

<p>UPDATE: I find out that the problem is rendering a leaf page in call with parameters. If I try to render a page using a route without parameters it works but if I do the same thing inside a route with parameters it doesn't load css and images.</p>
","12938634","","12938634","","2020-02-22 14:53:45","2020-02-22 15:54:18","Leaf & Vapor 3 - Can't load css and images on view","<swift><vapor><leaf>","1","1","","","","60340296","118712","118712","vapor","592","36204589","36204588"
"60342547","1","60353482","","2020-02-21 16:16:35","","4","84","<p>I am trying to write a route that returns all the posts written by users who are followed by a particular user. This is the data model that I'm using:</p>

<pre><code>struct Follow: Content, SQLiteModel, Migration {
    var id: Int?
    var follower: String
    var following: String
}

struct Post: Content, SQLiteModel, Migration {
    var id: Int?
    var username: String
    var message: String
}

struct User: Content, SQLiteStringModel, Migration {
    var id: String?
    var password: String
}
</code></pre>

<p>And this is the route:</p>

<pre><code>router.get(String.parameter, ""timeline"") { req -&gt; Future&lt;[Post]&gt; in
    let username = try req.parameters.next(String.self)

    return Follow.query(on: req).filter(\Follow.follower == username).join(\Follow.following, to: \Post.username).alsoDecode(Post.self).all().map { tuples in
        return tuples.map { tuple in
            return tuple.1
        }
    }
}
</code></pre>

<p>The code compiles, but at runtime I get this JSON error dictionary:</p>

<pre><code>{""error"":true,""reason"":""ambiguous column name: main.Follow.id""}
</code></pre>

<p>And I also have an idea that the problem is that since I am making a join, then there is a duplicate id field (Follow.id, Post.id), but how to solve this problem? in sql I would just specify something like 'as followId' in order to rename the field, but how to do this in FluentSQLite?</p>

<p><strong>Update</strong></p>

<p>This is how I modified the ""timeline"" route in the end:</p>

<pre><code>return User.find(username, on: req).flatMap { user in
    guard let user = user else {
        throw Abort(.notFound)
    }

    return try user.followers.query(on: req)
        .join(\Post.username, to:\FollowUp.following)
        .alsoDecode(Post.self).all()
        .flatMap { tuples in
        return tuples.map { tuple in
            return tuple.1
        }
    }
}
</code></pre>

<p>I get this error: ""Cannot convert value of type '[Post]' to closure result type 'EventLoopFuture&lt;[Post]>'""</p>
","570339","","570339","","2020-03-08 17:50:00","2020-03-08 17:56:36","Ambiguous column name when joining tables with FluentSQLite","<swift><fluent><vapor><fluentsqlite>","1","0","","","","60342547","118712","118712","vapor","592","36204589","36204588"
"60362241","1","60362375","","2020-02-23 12:36:40","","1","36","<p>I'm trying to add some seed data to a table in a migration. For this table I don't want the id value to be generated automatically, but I want to set it manually for each record. How can this be done? My current code looks like the bellow, but the record isn't inserted to the database and no error is thrown when the migration runs.</p>

<p>Model class:</p>

<pre><code>import Foundation
import FluentPostgreSQL
import Vapor

final class PropertyType: PostgreSQLModel {
    var id: Int?
    var name: String

    init(id: Int, name: String) {
        self.id = id
        self.name = name
    }
}

extension PropertyType: Migration { }
extension PropertyType: Content { }
extension PropertyType: Parameter { }
</code></pre>

<p>Migration class:</p>

<pre><code>import FluentPostgreSQL
import Vapor

struct AddPropertyTypes: Migration {
    typealias Database = PostgreSQLDatabase

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        let propertyType1 = PropertyType(id: 1, name: ""Einfamilienhaus"")
        return propertyType.save(on: conn).transform(to: ())
    }

    static func revert(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        let futures = [1].map { id in
            return CodePropertyType.query(on: conn).filter(\CodePropertyType.id == id)
                .delete()
        }
        return futures.flatten(on: conn)
    }
}
</code></pre>
","10826194","","","","","2020-02-23 12:53:30","How to save a model with a specific id in Vapor 3","<swift><vapor><vapor-fluent>","1","0","","","","60362241","118712","118712","vapor","592","36204589","36204588"
"60380918","1","60381029","","2020-02-24 17:16:59","","1","36","<p>I'd like to have an index controller function that returns an array of entities if no request parameter is set or a single entity if the id parameter is set. However, I'd like to always receive an array, in the latter case it just contains only one element.</p>

<p>Here's my function:</p>

<pre><code>final class AddressController {
    func index(_ req: Request) throws -&gt; Future&lt;[Address]&gt; {
        if let id = try? req.query.get(UUID.self, at: ""id"") {
            // THIS IS NOT WORKING...
            return Address.find(id, on: req)
        } else {
            return Address.query(on: req).all()
        }
    }
}
</code></pre>
","10826194","","","","","2020-02-24 17:24:40","How to always return an array in Vapor 3 and Fluent (even for single entity requests)","<swift><vapor>","1","1","","","","60380918","118712","118712","vapor","592","36204589","36204588"
"60388910","1","60389877","","2020-02-25 06:48:01","","2","62","<p>When I'm adding a model to the database using create, Vapor fluent doesn't throw an exception when one of the foreign keys is violated. It's also not inserted, the create function just returns as normal.</p>

<p>Is this the standard behavior of Vapor Fluent?</p>

<p>I'm using Vapor 3 with PostgreSQL.</p>

<p>This is my migration to add the foreign key constraints:</p>

<pre><code>struct AddAddressForeignKeys: Migration {
    typealias Database = PostgreSQLDatabase

    static func prepare(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return PostgreSQLDatabase.update(Address.self, on: conn) { builder in
            builder.reference(from: \.regionId, to: \CodeRegion.id)
            builder.reference(from: \.countryId, to: \CodeCountry.id)
        }
    }

    static func revert(on conn: PostgreSQLConnection) -&gt; Future&lt;Void&gt; {
        return PostgreSQLDatabase.update(Address.self, on: conn) { builder in
            builder.deleteReference(from: \.regionId, to: \CodeRegion.id)
            builder.deleteReference(from: \.countryId, to: \CodeCountry.id)
        }
    }
}
</code></pre>

<p>Update: I've added enableReferences as mentioned in the answer of Jacob Relkin, but there's still no exception thrown. H </p>

<pre><code>// Configure database
let config = PostgreSQLDatabaseConfig(hostname: ""localhost"", port: 5432, username: ""postgres"", database: ""test"", password: nil, transport: .cleartext)
let postgres = PostgreSQLDatabase(config: config)

// Register the configured database to the database config.
var databases = DatabasesConfig()
databases.add(database: postgres, as: .psql)
databases.enableReferences(on: .psql)
services.register(databases)
</code></pre>
","10826194","","10826194","","2020-02-25 12:07:18","2020-02-25 12:07:18","Vapor fluent doesn't throw upon violating foreign key constraint","<swift><vapor>","1","0","","","","60388910","118712","118712","vapor","592","36204589","36204588"
"60389851","1","60577017","","2020-02-25 07:54:53","","1","30","<p>I'm getting the following crash when using docker-compose with Vapor &amp; FluentMySQL.</p>

<pre><code>api_1  | [ INFO ] Migrating 'mysql' database (/app/.build/checkouts/fluent/Sources/Fluent/Migration/MigrationConfig.swift:69)
    api_1  | Fatal error: Error raised at top level: NIO.ChannelError.connectFailed(NIO.NIOConnectionError(host: ""db"", port: 3309, dnsAError: nil, dnsAAAAError: nil, connectionErrors: [NIO.SingleConnectionFailure(target: [IPv4]db/172.27.0.2:3309, error: connection reset (error set): Connection refused (errno: 111))])): file /home/buildnode/jenkins/workspace/oss-swift-5.1-package-linux-ubuntu-18_04/swift/stdlib/public/core/ErrorType.swift, line 200
</code></pre>

<p>Migration fails when using:</p>

<p><code>migrations.add(model: Model.self, database: .mysql)</code></p>

<p>If I remove that so no Models are migrated the app builds without errors and I am able to access it at <a href=""http://localhost/"" rel=""nofollow noreferrer"">http://localhost/</a>.</p>

<p>My docker-compose.yml looks like this:</p>

<pre><code>version: ""3.7""
services:
  api:
    image: vaporapiimage
    ports:
      - 80:8080
    environment:
      MYSQL_HOST: db
      MYSQL_USER: user
      MYSQL_PASSWORD: password
      MYSQL_DATABASE: dbname
      SLEEP_LENGTH: 7
      MYSQL_PORT: 3309
    depends_on:
        - db
  db:
    image: mysql:8.0.1
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: dbname
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    ports:
      - ""3309:3306""
</code></pre>

<p>It builds and runs as expected locally from Xcode (as in without Docker).</p>

<p>If the <code>api</code> service is commented out then the <code>db</code> service will run on its own and create the database on first run.</p>

<p>Any help would be greatly appreciated.</p>

<p>UPDATE:
Replacing the <code>api</code> with Adminer results in being able to access the <code>db</code> through Adminer in the browser. So the <code>db</code> service is accessible and it seems as if the issue is with Vapor/Fluent (or rather my use of them):</p>

<pre><code>  admin:
    image: adminer
    ports:
      - 8080:8080
</code></pre>
","4082459","","4082459","","2020-02-25 09:18:57","2020-03-07 11:24:32","FluentMySQL migration fails when building with docker-compose but not when building from Xcode","<docker-compose><vapor><fluent-mysql>","1","0","","","","60389851","118712","118712","vapor","592","36204589","36204588"
"60403340","1","60403547","","2020-02-25 21:21:46","","1","46","<p>I'm trying to write a controller function to insert a model with a child model at the same time and get the same JSON response in return, but filled with the data added from the database (i.e. the automatically generated id).</p>

<p>For the bellow simplified example the JSON request body would look like this:</p>

<pre><code>{
    ""field1"": ""blabla"",
    ""subContent"": {
        ""field2"": ""lalala""
    }
}
</code></pre>

<p>I'm expecting the following response:</p>

<pre><code>{
    ""id"": 5,
    ""field1"": ""blabla"",
    ""subContent"": {
        ""id"": 44,
        ""field2"": ""lalala""
    }
}
</code></pre>

<p>The below code unfortunately doesn't compile, the error message says ""Cannot convert expression of type 'EventLoopFuture' to return type 'Response'. This occurs on line</p>

<pre><code>return subModel.create(on: req).flatMap { savedSubModel -&gt;
</code></pre>

<p>Here's the code:</p>

<pre><code>struct MainContent: Content {
    var id: UUID?
    var field1: String
    var subContent: SubContent
}

struct SubContent: Content {
    var id: UUID?
    var field2: String
}

final class Controller {
    func create(_ req: Request) throws -&gt; EventLoopFuture&lt;Response&gt; {
        return try req.content.decode(MainContent.self).map { request in
            let subModel = SubModel(
                field2: request.subContent.field2
            )
            return subModel.create(on: req).flatMap { savedSubModel -&gt; EventLoopFuture&lt;Response&gt; in
                let mainModel = mainModel(
                    subModelId: savedSubModel.id!,
                    field1: request.field1
                )
                return mainModel.create(on: req).flatMap { savedMainModel -&gt; EventLoopFuture&lt;Response&gt; in
                    let content = MainContent(
                        id: savedMainModel.id,
                        field1: savedMainModel.field1,
                        subContent: SubContent(
                            id: savedSubContent.id,
                            field2: savedSubContent.field2
                        )
                    )
                    return content.encode(status: .created, for: req)
                }
            }
        }
    }
}
</code></pre>
","10826194","","","","","2020-02-25 21:37:11","How to save a model with a child and get the saved model with child back as a response in Vapor 3","<swift><vapor>","1","7","","","","60403340","118712","118712","vapor","592","36204589","36204588"
"60443583","1","60590161","","2020-02-28 00:14:45","","1","49","<p>I've got a Vapor 3 app in which I need to determine is 2 users share any common groups.</p>

<p>So I have 2 models User and Group.  A user can belong to many groups.  But I have a permission check that if both users share a common group they can send a messages to each other.</p>

<pre><code>final public class User: PostgreSQLModel {
    public var id: Int?
    var firstName: String
    var lastName: String
}

extension User {
    var containers: Siblings&lt;User, Group, UserGroups&gt; {
        return siblings()
    }
}

final public class Group: PostgreSQLModel {
    public var id: Int?
    var name: String
}
</code></pre>

<p>What I'd like to do is this</p>

<pre><code>UserGroups.query(to: request).group(.or) { $0.filter(\.userId == user.id!).filter(\.userId == user.id!) }.flatMap { ... }
</code></pre>

<p>plus a filter that says where groupId == groupId.</p>

<p>Any thoughts or suggestions?</p>
","11375271","","","","","2020-03-08 17:27:22","Need help doing a many <-> many match with Fluent in Vapor 3","<vapor><vapor-fluent>","1","0","","","","60443583","118712","118712","vapor","592","36204589","36204588"
"60451936","1","","","2020-02-28 12:41:54","","1","34","<p>When I send large amount of JSON over a WebSocket connection to a vapor swift server, the connection closes with the following error:</p>

<blockquote>
  <p>invalidFrameLength</p>
</blockquote>

<p>The error description is:</p>

<blockquote>
  <p>The operation couldn’t be completed. (NIOWebSocket.NIOWebSocketError error 0.)</p>
</blockquote>

<p>My configure.swift looks like this:</p>

<pre><code>let webSocketServer: NIOWebSocketServer = NIOWebSocketServer.default()
try sockets(webSocketServer)
services.register(webSocketServer, as: WebSocketServer.self)
</code></pre>

<p>And the socket function:</p>

<pre><code>public func sockets(_ webSocketServer: NIOWebSocketServer) throws {
    webSocketServer.get(""example"") { (webSocket: WebSocket, request: Request) in

    }
}
</code></pre>

<p>How would I increase the frame length on the server side to be able to sent large JSON?</p>
","10551293","","10551293","","2020-02-28 14:31:19","2020-02-28 14:31:19","How do I increase the frame length of a websocket?","<swift><websocket><vapor>","0","4","","","","60451936","118712","118712","vapor","592","36204589","36204588"
"60513584","1","","","2020-03-03 18:36:09","","1","76","<p>Configurations:</p>

<p><strong>Vapor 4 | Updated beta version &amp; packages | macOS Catalina v.10.15.3 | XCode 11.4 beta 2 | Bootstrap CDN 4.4.1</strong></p>

<p>I'm unable to toggle my navbar button. I'm not sure if it's a bug in Leaf. I've implemented Bootstrap and CSS in the right order. Try and run this code. Don't forget to resize your browser window to mobile or tablet view in order to show navbar toggle button. 
Here's my leaf code:</p>

<blockquote>
  <p>// base.leaf</p>
</blockquote>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=""en""&gt;
    &lt;head&gt;
        &lt;meta charset=""utf-8""/&gt;
        &lt;meta name=""viewport"" content=""user-scalable=no, width=device-width, initial-scale=1.0""/&gt;
        &lt;meta name=""apple-mobile-web-app-capable"" content=""yes"" /&gt;
    &lt;!--    &lt;link rel=""stylesheet"" href=""/styles/bootstrap.min.css""/&gt;--&gt;
        &lt;link rel=""stylesheet"" href=""/fonts/fa/css/all.min.css""/&gt;
        &lt;link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"" integrity=""sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"" crossorigin=""anonymous""&gt;
        &lt;link rel=""stylesheet"" href=""/styles/main.css""/&gt;
        &lt;link rel=""stylesheet"" href=""/styles/header.css""/&gt;
        &lt;link rel=""stylesheet"" href=""/styles/footer.css""/&gt;
        &lt;title&gt;#(metaContent.title)&lt;/title&gt;
        &lt;meta name=""description"" content=""#(metaContent.description)""/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;
            &lt;nav class=""navbar navbar-expand-md navbar-dark fixed-top bg-dark""&gt;
              &lt;a class=""navbar-brand"" href=""#""&gt;Carousel&lt;/a&gt;
              &lt;button class=""navbar-toggler"" type=""button"" data-toggle=""collapse"" data-target=""#navbarCollapse"" aria-controls=""navbarCollapse"" aria-expanded=""false"" aria-label=""Toggle navigation""&gt;
                &lt;span class=""navbar-toggler-icon""&gt;&lt;/span&gt;
              &lt;/button&gt;
              &lt;div class=""collapse navbar-collapse"" id=""navbarCollapse""&gt;
                &lt;ul class=""navbar-nav mr-auto""&gt;
                  &lt;li class=""nav-item active""&gt;
                    &lt;a class=""nav-link"" href=""#""&gt;Home &lt;span class=""sr-only""&gt;(current)&lt;/span&gt;&lt;/a&gt;
                  &lt;/li&gt;
                  &lt;li class=""nav-item""&gt;
                    &lt;a class=""nav-link"" href=""#""&gt;Link&lt;/a&gt;
                  &lt;/li&gt;
                  &lt;li class=""nav-item""&gt;
                    &lt;a class=""nav-link disabled"" href=""#"" tabindex=""-1"" aria-disabled=""true""&gt;Disabled&lt;/a&gt;
                  &lt;/li&gt;
                &lt;/ul&gt;
                &lt;form class=""form-inline mt-2 mt-md-0""&gt;
                  &lt;input class=""form-control mr-sm-2"" type=""text"" placeholder=""Search"" aria-label=""Search""&gt;
                  &lt;button class=""btn btn-outline-success my-2 my-sm-0"" type=""submit""&gt;Search&lt;/button&gt;
                &lt;/form&gt;
              &lt;/div&gt;
            &lt;/nav&gt;    
        &lt;/header&gt;

        &lt;main&gt;
            #import(""main"")
        &lt;/main&gt;

        &lt;footer id=""myFooter""&gt;
            &lt;div class=""bg-secondary"" style=""height:3px;""&gt;
            &lt;/div&gt;
            &lt;div class=""footer-copyright footer-brand""&gt;
                &lt;h6 class=""mt-2 text-light""&gt;© 2020 Company. All Rights Reserved.&lt;/h6&gt;
            &lt;/div&gt;
        &lt;/footer&gt;

       &lt;script src=""https://code.jquery.com/jquery-3.4.1.slim.min.js"" integrity=""sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"" crossorigin=""anonymous""&gt;&lt;/script&gt;
        &lt;script src=""https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"" integrity=""sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"" crossorigin=""anonymous""&gt;&lt;/script&gt;
        &lt;script src=""https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"" integrity=""sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"" crossorigin=""anonymous""&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<blockquote>
  <p>// index.leaf</p>
</blockquote>

<pre><code>#extend(""base""):
    #export(""main""):
    &lt;div class=""container mt-3""&gt;
        &lt;h1&gt;#(metaContent.title)&lt;/h1&gt;
        &lt;p&gt;#(body.content)&lt;/p&gt;
     &lt;/div&gt;
    #endexport
#endextend
</code></pre>

<p>In Safari's Inspect element, my html document is rendered in the right order. But, I've no clue why the click on navbar toggle isn't working.</p>
","6348709","","","","","2020-03-03 18:36:09","Server Side Swift: Navbar Toggle not working in Vapor 4 Leaf + Bootstrap","<swift><twitter-bootstrap><vapor><server-side-swift><leaf>","0","0","","","","60513584","118712","118712","vapor","592","36204589","36204588"
"60574239","1","60574947","","2020-03-07 03:55:13","","1","67","<p>In Vapor 4, I'm processing a post request by calling a request on a 3rd party API and returning a value based on the result I get back.  The following code results in the error: ""Invalid conversion from throwing function ... to non-throwing function""</p>

<pre><code> app.post(""activate"") { req -&gt; EventLoopFuture&lt;ActivationRequestResponse&gt; in

        return req.client.post(""https://api.example.com/activation"", headers: HTTPHeaders(), beforeSend: { (req) in
            try req.content.encode(RequestBody(value: someValue), as: .json)
        })

        .map { (response) -&gt; ActivationRequestResponse in

            let response = try response.content.decode(ResponseModel.self)
            return ActivationRequestResponse(success: true, message: ""success"")

        }

    }
</code></pre>

<p>I can't seem to use <code>try</code> in my chained <code>map()</code> after getting the API result.  The above code will work if I add a <code>!</code> to the <code>try</code> in <code>let response = try response.content.decode(ResponseModel.self)</code> inside the map, but ideally I want to catch this error.  The first <code>try</code> used when creating the response body seems to be implicitly passed back up the chain, but not the second. </p>

<p>What am I doing wrong?  How do I catch the error when decoding the response content?  Why is the first <code>try</code> caught but not the second?</p>
","245948","","245948","","2020-03-07 04:04:01","2020-03-07 06:21:36","Chained Throwing Futures in SwiftNIO & Vapor","<swift><xcode><vapor><swift5.2><swift-nio>","1","0","","","","60574239","118712","118712","vapor","592","36204589","36204588"
"60578723","1","","","2020-03-07 14:46:00","","1","88","<p>I need to do lots of queries to different tables and return the results in one single response. I'm wondering ow could I flatten the extremely nested function?</p>

<pre><code>final class CodeController {
    internal func indexCodes(_ req: Request) throws -&gt; EventLoopFuture&lt;Response&gt; {
        CodeCountry.query(on: req).sort(\.name).all().flatMap { countries -&gt; EventLoopFuture&lt;Response&gt; in
            CodeFloor.query(on: req).sort(\.name).all().flatMap { floors -&gt; EventLoopFuture&lt;Response&gt; in
                CodeRegion.query(on: req).sort(\.name).all().flatMap { regions -&gt; EventLoopFuture&lt;Response&gt; in
                    CodeObjectType.query(on: req).sort(\.name).all().flatMap { objectTypes -&gt; EventLoopFuture&lt;Response&gt; in
                        CodePropertyType.query(on: req).sort(\.name).all().flatMap { propertyTypes -&gt; EventLoopFuture&lt;Response&gt; in
                            CodeRooms.query(on: req).sort(\.name).all().flatMap { rooms -&gt; EventLoopFuture&lt;Response&gt; in
                                let codes = CodesContent(
                                    countries: countries,
                                    floors: floors,
                                    regions: regions,
                                    objectTypes: objectTypes,
                                    propertyTypes: propertyTypes,
                                    rooms: rooms
                                )

                                return codes.encode(status: .ok, for: req)
                            }
                        }
                    }
                }
            }
        }
    }
}
</code></pre>
","10826194","","","","","2020-03-30 07:38:08","How to flatten multiple queries in Vapor","<swift><vapor><vapor-fluent>","2","3","","","","60578723","118712","118712","vapor","592","36204589","36204588"
"60582425","1","60590660","","2020-03-07 21:37:17","","2","54","<p>Trying to send data into my postgreSQL database using Vapor and Swift.</p>

<p>Here is example code (Swift Struct as Request Body)</p>

<pre><code>struct ToDoResponseModel: Codable {
   var id: Int
   var Name: String
   var isComplete: Bool
}

let url = URL(string: ""http://localhost:8080/todos"")
guard let requestUrl = url else { fatalError() }
var request = URLRequest(url: requestUrl)
request.httpMethod = ""POST""

// Set HTTP Request Header
request.setValue(""application/json"", forHTTPHeaderField: ""Accept"")
request.setValue(""application/json"", forHTTPHeaderField: ""Content-Type"")

let newTodoItem = ToDoResponseModel(id: 300, Name: ""Urgent task 2"", isComplete: true)

do {
    let jsonData = try JSONEncoder().encode(newTodoItem)
    request.httpBody = jsonData
}catch let jsonErr{
    print(jsonErr)
}

let task = URLSession.shared.dataTask(with: request) { (data, response, error) in

    if let error = error {
        print(""Error took place \(error)"")
        return
    }
    guard let data = data else {return}

    do {
        let todoItemModel = try JSONDecoder().decode(ToDoResponseModel.self, from: data)
        print(""Response data:\n \(todoItemModel)"")
        print(""todoItemModel Name: \(todoItemModel.Name)"")
        print(""todoItemModel id: \(todoItemModel.id )"")
    } catch let jsonErr {
        print(jsonErr)
    } 
}
task.resume()
</code></pre>

<p>But I faced the next error:</p>

<blockquote>
  <p><em>keyNotFound(CodingKeys(stringValue: ""id"", intValue: nil), Swift.DecodingError.Context(codingPath: [], debugDescription: ""No
  value associated with key CodingKeys(stringValue: \""id\"", intValue:
  nil) (\""id\"")."", underlyingError: nil))</em></p>
</blockquote>

<p>Error fixed on this line:</p>

<pre><code>let todoItemModel = try JSONDecoder().decode(ToDoResponseModel.self, from: data)
</code></pre>

<p>and Vapor sends me :</p>

<blockquote>
  <p><em>[ ERROR ] DecodingError.keyNotFound: Value required for key 'IsComplete'. (ErrorMiddleware.swift:26)</em></p>
</blockquote>
","6260777","","2070111","","2020-03-08 12:23:30","2020-03-12 11:12:16","Swift Struct as Request Body","<json><swift><postgresql><vapor><decodable>","1","1","","","","60582425","118712","118712","vapor","592","36204589","36204588"
"60655892","1","","","2020-03-12 14:12:30","","0","58","<p>I’ve a server application with Vapor 3, I set up three models Book, Author, Publisher, relative routers and controllers with CRUD and relationships (both Author and Publisher have a Sibling relationship with book).
All would be fine was not for the incoming data: the Json I receive has a different data structure, where the publishers and authors are stored in arrays inside the book.</p>

<p>I cannot decode on Book.self because I would lose the data relevant to publishers and authors, so I created BookTotal, which has no representation on the database (no migration) so I could</p>

<p><code>req.content.decode(BookTotal.self).flatMap</code></p>

<p>At this point I would like to call the save or update functions on the Publisher and Author controllers passing the BookTotal.Publisher and BookTotal.Author array.</p>

<p>But, while I can reach the methods either with something like</p>

<pre><code>`PublisherController.Save()`
</code></pre>

<p>Or</p>

<pre><code>    let client = req.make(Client.self)
    let response = client(“path/for/the/router”)
</code></pre>

<p>I don’t know how to pass them the data. The CRUD methods inside the controllers have Request as parameter but I don’t know how to build one.</p>

<pre><code>let newReq = Request()
newReq.content = BookTotal.Author
</code></pre>

<p>Would be my guess, but Request wants a Container and I don’t know how I should go about that.
I searched around but couldn't find any example/tutorial on such issue.
Am I even on the right path with this?</p>
","13051814","","","","","2020-03-13 15:25:13","Swift Vapor 3 calling a router from inside another","<swift><vapor>","1","0","","","","60655892","118712","118712","vapor","592","36204589","36204588"
"60700497","1","60700669","","2020-03-16 04:54:19","","1","26","<p>Vapor/Future newbie here, who's fighting with the type system. </p>

<p>I'd like to do some processing on query results:<br />
1) Do query.<br />
2) Change/save results.<br />
3) Return changed results. <br /></p>

<p>For example:</p>

<pre><code>func myIndex(_ req: Request) throws -&gt; Future&lt;[Todo]&gt; {
    return Todo.query(on: req)
            .all()
            .flatMap { allToDos in
                allToDos.flatMap { toDo in
                    // change toDoch
                    return toDo.save(on: req).flatMap { $0 }
                }
    }
}
</code></pre>

<p>Which results in:
<a href=""https://i.stack.imgur.com/0QtJM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/0QtJM.png"" alt=""enter image description here""></a></p>

<p>So what's the correct pattern for this kind of thing?</p>

<p>Thanks.</p>
","1110894","","","","","2020-03-16 05:17:23","Vapor: Post processing on a query result?","<ios><future><vapor>","1","0","","","","60700497","118712","118712","vapor","592","36204589","36204588"
"60741636","1","","","2020-03-18 14:30:08","","1","43","<p>Just started learning Vapor and cannot find this anywhere:</p>

<p>I need to upload the image file to the server, do some image processing, return processed image back to iOS. (No need to store it with db) </p>

<p>I don't need to display it with Leaf, or anything, the file is sent directly from the app and back to the app.</p>

<p>I couldn't find any image upload/download examples on the net with Vapor3.  </p>

<p>Can anyone please provide me some guidance. </p>
","10007342","","","","","2020-03-18 14:30:08","How to upload and download image file in Vapor 3","<swift><vapor>","0","2","","","","60741636","118712","118712","vapor","592","36204589","36204588"
"60848663","1","60848728","","2020-03-25 12:16:07","","2","178","<p>On a fresh install of Vapor (from <code>homebrew</code>) I call:</p>

<ul>
<li><code>vapor new Bridge</code> -> success</li>
<li><code>vapor xcode</code> -> success</li>
<li><code>y</code> (asks if I want to open the project in Xcode) -> opens Xcode project</li>
<li><code>vapor --version</code> -> 3.1.10</li>
<li><code>vapor build</code> -> fails</li>
</ul>

<p>The error I get is:</p>

<pre><code>[1/3] Compiling App configure.swift
/Users/josh/Applications/Xcode/Projects/Bridge/Sources/App/configure.swift:31:49: error: reference to member 'sqlite' cannot be resolved without a contextual type
    migrations.add(model: Todo.self, database: .sqlite)
                                               ~^~~~~~
[2/3] Compiling App app.swift
</code></pre>

<p>Version Numbers:</p>

<ul>
<li>macOS: <code>10.15.3 (19D76)</code></li>
<li>Xcode: <code>11.4 (11E146)</code></li>
<li>Vapor: <code>3.1.10</code></li>
<li>Swift: <code>5.2</code></li>
</ul>

<p>Any help figuring out how to solve this error is appreciated! Let me know if I can provide any more information. Thanks!</p>
","9447565","","","","","2020-04-29 11:10:49","Vapor Swift Error ""Reference to member 'sqlite' cannot be resolved without a contextual type""","<swift><vapor>","2","0","","","","60848663","118712","118712","vapor","592","36204589","36204588"
"60854545","1","","","2020-03-25 17:51:58","","1","36","<p>How can I customize error message in <code>Swift</code> Tried this:</p>

<pre class=""lang-swift prettyprint-override""><code>catch {
   promise.fail(error: error)
}
</code></pre>

<p>-></p>

<pre class=""lang-swift prettyprint-override""><code>catch {
   promise.fail(error: AddFBDataAndGetPagesError.invalidFacebookAccessToken)
}
</code></pre>

<p>It has no effect, same standard error message is received in FE.</p>
","239219","","","","","2020-03-25 17:51:58","How to raise custom error message in Swift / Vapor?","<swift><vapor>","0","1","","","","60854545","118712","118712","vapor","592","36204589","36204588"
"60902937","1","","","2020-03-28 15:42:50","","1","31","<p>So i'm trying out Vapor and so far it's kinda simple <a href=""https://medium.com/flatiron-labs/persisting-data-with-vapor-3-and-postgresql-246386ac1448"" rel=""nofollow noreferrer"">This guide</a>. </p>

<p>There were actually only 1 thing that was outdated:</p>

<p><code>migrations.add(model: User.self, database: DatabaseIdentifier&lt;User.Database&gt;.psql)</code></p>

<p>is required instead of:</p>

<p><code>databases.add(database: postgres, as: .psql)</code></p>

<p>Then i tested to add a row manually as described in the guide. Made a get request and i got the response nice and clean as it should look.</p>

<p>Then i was going to do a POST and i thought everything worked fine since i got the model in response when making the POST-request.</p>

<p>I noticed tho after making another GET request nothing was saved. I know there are a lot of areas in code to cover, but in general, anyone know what i'm missing?</p>

<pre><code>router.post(""user"", use: userController.create)

func create(_ req: Request) throws -&gt; Future&lt;User&gt; {
    return try req.content.decode(User.self).flatMap { user in
        return user.save(on: req)
    }
}
</code></pre>
","4757272","","","","","2020-03-28 15:42:50","Swift vapor POST gives response but doesn't save","<swift><postgresql><post><get><vapor>","0","3","1","","","60902937","118712","118712","vapor","592","36204589","36204588"
"60969552","1","60971944","","2020-04-01 11:10:54","","2","76","<p>In Vapor 4 I have created a user and it has ""gear"" as such: </p>

<pre><code>final class User: Model, Content {

    init() {}

    static var schema: String = ""user""

    @ID(key: .id)
    var id: UUID?

    @Field(key: ""name"")
    var name: String?

    @Children(for: \.$user)
        var gear: [Gear]
}


final class Gear: Model, Content {

    init() {}

    static var schema: String = ""gear""

    @ID(key: .id)
    var id: UUID?

    @Parent(key: ""userId"")
    var user: User
}
</code></pre>

<p>Then when I get this data I do:</p>

<pre><code>func index(req: Request) throws -&gt; EventLoopFuture&lt;[User]&gt; {
    return User.query(on: req.db).with(\.$gear).all()
}
</code></pre>

<p>Rather smooth and simple. Except that ID is being forced to be an UUID while the table in the database can only take the type ""text"" so I get the error:</p>

<pre><code>{
    ""error"": true,
    ""reason"": ""server: operator does not exist: text = uuid (op_error)"" 
}
</code></pre>

<p>So anyone have a clue of how to solve this?</p>

<p>The structure I want in response is similar to:</p>

<pre><code>{
    ""id"": ""w32423tsdg3w"",
    ""name"": ""username"",
    ""gear"": [{
        ""id"": ""1""
        },
        {
        ""id"": ""2""
        }
    ]
}
</code></pre>
","4757272","","4370109","","2020-04-01 11:50:43","2020-04-01 13:26:26","Vapor 4 parent child relationship","<swift><relationship><vapor><vapor-fluent>","1","1","","","","60969552","118712","118712","vapor","592","36204589","36204588"
"60979749","1","60993141","","2020-04-01 20:28:46","","1","24","<p>I'm trying to push a Swift package to Heroku using the Vapor buildpack (<a href=""https://github.com/vapor-community/heroku-buildpack/tree/master"" rel=""nofollow noreferrer"">https://github.com/vapor-community/heroku-buildpack/tree/master</a>), but I keep getting this error:</p>

<p><code>error: terminated(1): /app/tmp/cache/heroku-18/swiftenv/versions/4.2/usr/bin/swift-build-tool -f /tmp/build_1041959f11306dce64ad9d4712e1d962/.build/debug.yaml main output:</code></p>

<p>I wrote the package using Swift 5.2, but Heroku insists on using Swift 4.2. I have confirmed that the buildpack is compatible with Swift 5.2, and I've set the .swift-version file to 5.2, as well as the first line of my Package.swift file. </p>

<p>Here is the Package.swift file:</p>

<pre><code>    // swift-tools-version:5.2
    // The swift-tools-version declares the minimum version of Swift required to build this package.

    import PackageDescription

    let package = Package(
name: ""TurnipBot"",
dependencies: [
    // Dependencies declare other packages that this package depends on.
    .package(url: ""https://github.com/Azoy/Sword"", .branch(""master""))

],
targets: [
    // Targets are the basic building blocks of a package. A target can define a module or a test suite.
    // Targets can depend on other targets in this package, and on products in packages which this package depends on.
    .target(
        name: ""TurnipBot"",
        dependencies: [""Sword""]),
    .testTarget(
        name: ""TurnipBotTests"",
        dependencies: [""TurnipBot""]),
]
    )
</code></pre>
","12211593","","","","","2020-04-02 13:50:20","Can't push swift package to Heroku using Vapor","<swift><heroku><discord><vapor>","1","0","","","","60979749","118712","118712","vapor","592","36204589","36204588"
"61174764","1","","","2020-04-12 16:36:07","","1","20","<p>I've been trying to build my Vapor Project using Docker. I am using the default web.Dockerfile. 
However I am running into this error:</p>

<p><code>/App/.build/checkouts/SwiftyBeaver/Sources/FileDestination.swift:135:27: error: use of unresolved identifier 'NSFileCoordinator'</code></p>

<p>I am using <code>https://github.com/vapor-community/swiftybeaver-provider</code> as well (however I the error is from SwiftyBeaver itself). The error seems to be from building for Linux - it builds find locally out of Docker. Any help would be much appreciated!</p>
","11388990","","","","","2020-04-12 16:36:07","Vapor Linux Build with SwiftyBeaver Failing","<docker><vapor><swiftybeaver>","0","1","","","","61174764","118712","118712","vapor","592","36204589","36204588"
"61188325","1","61190520","","2020-04-13 12:52:44","","2","30","<p>I have created a new vapor project using terminal. When I try building the project I get an error ""Redefination of Module"" for multiple modules. I tried cleaning the build did everything possible but unable to figure out the error. If anyone had the same issue and was able to fix it, please let me know. below is the attached screen shot<a href=""https://i.stack.imgur.com/1vSBy.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/1vSBy.jpg"" alt=""enter image description here""></a></p>
","805133","","","","","2020-04-13 14:51:57","Vapor 3.1.10 Xcode-11.3.1 Compile issue","<ios><iphone><xcode><vapor>","1","0","0","","","61188325","118712","118712","vapor","592","36204589","36204588"
"61208034","1","61210032","","2020-04-14 12:45:19","","2","40","<p>I am new to Vapor and server-side swift and have some trouble setting it up. When I follow the documentation of Vapor about how to set it up, <a href=""https://docs.vapor.codes/3.0/getting-started/hello-world/"" rel=""nofollow noreferrer"">can be found here</a> everything works as expected in the terminal but when I try to build it, there are a lot of errors, as you can see in the attached screenshot. <a href=""https://i.stack.imgur.com/Er0rb.jpg"" rel=""nofollow noreferrer"">Image of the errors showing in Xcode</a>.</p>

<p>I have tried to delete Xcode and reinstall it and spending some hours trying to find a solution on google. I did not find something that solved this problem. </p>

<p>I have done this multiple times with different projects and have used templates as well as just initializing it with: (The first to code snippets to not generate any errors)</p>

<pre class=""lang-sh prettyprint-override""><code>vapor new ProjectName
</code></pre>

<p>And then opening it in Xcode using</p>

<pre class=""lang-sh prettyprint-override""><code>vapor Xcode
</code></pre>

<p>When I am in the right folder. I have also tried to build it from the terminal using this command but similar error appears: </p>

<pre class=""lang-sh prettyprint-override""><code>vapor build
</code></pre>

<p>This as well is runned when inside the folder. </p>

<p>Here are the versions that I have:</p>

<pre><code>Vapor: 3.1.10
Homebrew: 2.2.12
Swift: 5.2
MacOS: 10.15.4
Xcode: 11.4
</code></pre>

<p>Thanks for your effort!</p>

<p>SOLUTION - THANKS TO 0xTim</p>

<p>Update the homebrew version to 2.2.13 and it works.</p>

<p>You do it using the following command in the terminal</p>

<pre class=""lang-sh prettyprint-override""><code>brew update
</code></pre>

<p>If you want to check your current version then you could use</p>

<pre class=""lang-sh prettyprint-override""><code>brew --version
</code></pre>

<p>Thanks for the answer 0xTime!</p>
","13064661","","3103448","","2020-04-14 16:54:04","2020-04-17 09:06:24","Server-side swift Vapor - redefinition of module Error","<ios><swift><server-side><vapor>","2","0","","","","61208034","118712","118712","vapor","592","36204589","36204588"
"61344881","1","","","2020-04-21 13:35:15","","2","39","<p>Running <code>swift test</code> with Swift 5.1 or later complains about missing LinuxMain.swift file.</p>

<pre><code>$ swift test
error: missing LinuxMain.swift file in the Tests directory
</code></pre>
","1041105","","","","","2020-04-21 13:35:15","missing LinuxMain.swift file","<swift><vapor>","1","0","","","","61344881","118712","118712","vapor","592","36204589","36204588"
"61353497","1","61353607","","2020-04-21 21:23:31","","1","29","<p>My application uses Vapor 4.3 and has a simple route that sends an HTML snippet as a response:</p>

<pre class=""lang-swift prettyprint-override""><code>import Vapor

func routes(_ app: Application) throws {
  app.get(""hello"") { _ -&gt; String in
    ""&lt;html&gt;&lt;body&gt;Hello, world!&lt;/body&gt;&lt;/html&gt;""
  }
}
</code></pre>

<p>Unfortunately, this response doesn't have a correct <code>Content-Type</code> HTTP header set on it, so it doesn't render as proper HTML when this route is opened in a browser. What's the best way to set the <code>Content-Type</code> header on this response?</p>
","442427","","442427","","2020-04-22 10:16:15","2020-04-22 10:16:15","How to set the Content-Type response header in Vapor 4?","<swift><httpresponse><content-type><vapor>","1","0","","","","61353497","118712","118712","vapor","592","36204589","36204588"
"61363681","1","61368428","","2020-04-22 11:11:01","","1","32","<p>I have a vapor 4 application. I do a query from database for getting some items and I want to perform some manual calculation based on the returned values before finishing the request. here a sample code of what I am trying to achieve.</p>

<pre class=""lang-swift prettyprint-override""><code>final class Todo: Model, Content {

    static var schema: String = ""todos""

    @ID(custom: .id)
    var id: Int?

    @Field(key: ""title"")
    var title: String

    var someValue: Int?

}

/// Allows `Todo` to be used as a dynamic migration.
struct CreateTodo: Migration {
    func prepare(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        database.schema(Todo.schema)
            .field(""id"", .int, .identifier(auto: true))
            .field(""title"", .string, .required)
            .create()
    }

    func revert(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        database.schema(Todo.schema).delete()
    }
}
</code></pre>

<pre class=""lang-swift prettyprint-override""><code>final class TodoController:RouteCollection{

    func boot(routes: RoutesBuilder) throws {

        routes.get(""tmp"", use: temp)
    }

    func temp(_ req:Request) throws -&gt; EventLoopFuture&lt;[Todo]&gt; {

        Todo.query(on: req.db).all().map { todos in

            todos.map {
                $0.someValue = (0...10).randomElement()!
                return $0
            }
        }
    }

}
</code></pre>

<p><strong>The problem is that those manual changes, aren't available in response. In this case <code>someValue</code> property.</strong></p>

<p>Thanks.</p>

<pre class=""lang-js prettyprint-override""><code>[
    {
        ""title"": ""item 1"",
        ""id"": 1
    },
    {
        ""title"": ""item 2"",
        ""id"": 2
    }
]
</code></pre>
","7649191","","3103448","","2020-04-22 20:56:52","2020-04-22 20:56:52","Manually modifying model property values in vapor 4 response","<swift><vapor><server-side-swift><vapor-fluent>","1","0","","","","61363681","118712","118712","vapor","592","36204589","36204588"
"61395940","1","","","2020-04-23 20:00:15","","0","26","<p>I was able to write a query that filters some Post objects by their title or body:</p>

<pre><code>router.get(""posts"", ""list"") { req -&gt; Future&lt;[Post]&gt; in 

    let searchText = req.query[String.self, at: ""searchText""]!

    return Post.query(on: req).group(.or, closure: { query in
        query.filter(\Post.title ~~ searchText)
        query.filter(\Post.body ~~ searchText)
    })
}
</code></pre>

<p>It works, in the sense that I can verify that all the posts that don't contain the searchText parameter in their title or body are filtered out. Now for my next step, I would like to sort these results by their relevance. </p>

<p>Example data:<br>
1) Title: ""Hello, world!"", body: ""test msg"".<br>
2) Title: ""Hello!"", body: ""...""<br>
3) Title: ""Hi"", body: ""!""     </p>

<p>What I would like is to have an 'affinity search' query, such that the results are not strictly filtered, and they are ordered by relevance. So with the above data, if I search for the string ""Hello!"", I would like to get something like:<br>
2) Title: ""Hello!"", body: ""...""<br>
1) Title: ""Hello, world!"", body: ""test msg""     </p>

<p>And the 3rd post would be filtered out from the search, because the relevance is not high enough. I understand that this is not really a deterministic, and well-specified problem. But I would like to understand if there is already something in fluent, and if not, what is a good approach to follow in order to solve this problem.</p>
","570339","","","","","2020-04-23 20:00:15","Fluent: How to sort filtered entities by relevance?","<swift><fluent><vapor>","0","1","","","","61395940","118712","118712","vapor","592","36204589","36204588"
"61407112","1","61411836","","2020-04-24 11:17:13","","1","30","<p>How can I force Xcode to load <code>.env</code> file when running <code>Run</code> scheme of Vapor project?</p>

<p>I have added <code>--env production</code> to run arguments in scheme configuration but it also did not change behaviour. only setting below Xcode environment variables works (but it is not my goal as they are reset when I rebuild vapor project outside of Xcode.</p>

<p>I have defined there few variables but they fail to load when project runs (key does not exist)</p>

<p>edit:</p>

<p>Updated question to state that I use Vapor 3</p>
","1285959","","1285959","","2020-04-24 23:24:46","2020-04-25 09:45:24","Unable to load .env file when running Vapor 3 project inside Xcode","<xcode><vapor>","1","0","","","","61407112","118712","118712","vapor","592","36204589","36204588"
"61445205","1","","","2020-04-26 17:35:59","","2","36","<p>My context:</p>

<ul>
<li>macOS Catalina version 10.15.3</li>
<li>Xcode 11.4</li>
<li>Swift 5.2</li>
<li>Vapor4</li>
</ul>

<p>I'm creating a new Vapor project with <code>vapor-beta new myProjectName</code></p>

<p>It asks if I want to use Fluent, which I agree to (y) and asks what kind of database do I want (1. postgreSQL   2. MySql   3. SQLite).
I went with option 3; SQLite is what I need.</p>

<p>It then proceeds to download a template and supposedly customise it with my above selected options.
It stops / freezes at </p>

<pre><code>Generating project files
+ Package.Swift
</code></pre>

<p>Nothing happens after this line, even after 10 minutes of waiting.</p>

<p>When I look in my application folder, there's a hidden .vapor-template folder that seems to contain the folder structure of an app.
I can't simply start using it, because many files seem to be...unfinished, in some way.
For instance, here's how Package.swift looks like:</p>

<pre><code>let package = Package(
    name: ""{{name}}"",
    platforms: [
       .macOS(.v10_15)
    ],
    dependencies: [
        // 💧 A server-side Swift web framework.
        .package(url: ""https://github.com/vapor/vapor.git"", from: ""4.0.0-rc""){{#fluent}},
        .package(url: ""https://github.com/vapor/fluent.git"", from: ""4.0.0-rc""),
        .package(url: ""https://github.com/vapor/fluent-{{fluent.db.url}}-driver.git"", from: ""{{fluent.db.version}}-rc""){{/fluent}}
    ],
    targets: [
        .target(name: ""App"", dependencies: [{{#fluent}}
            .product(name: ""Fluent"", package: ""fluent""),
            .product(name: ""Fluent{{fluent.db.module}}Driver"", package: ""fluent-{{fluent.db.url}}-driver""),{{/fluent}}
            .product(name: ""Vapor"", package: ""vapor"")
        ]),
        .target(name: ""Run"", dependencies: [""App""]),
        .testTarget(name: ""AppTests"", dependencies: [
            .target(name: ""App""),
            .product(name: ""XCTVapor"", package: ""vapor""),
        ])
    ]
)
</code></pre>

<p>As you can see, the name of the project is not set (I'm referring to the <code>name: ""{{name}}""</code> thing), and there are plenty of weird references to <code>{{#fluent}}</code> or <code>""{{fluent.db.version}}-rc"")</code> that freak out the compiler. 
It looks like the ""vapor new"" command had some more customisation work to do that it simply did not get a chance to finish.
Same story repeats in configure.swift and routes.swift.</p>

<p>I did comb through all of them, deleting the weird placeholders only to bump into some configure.swift situation where it complains about .sqlite not being recognised or something.
I did look it up on google / stackoverflow, tried some fixes that didn't work...until I took a step back an realised that hell...I shouldn't be doing all this SherlokHolmes-ing...the ""vapor new"" command should simply work and successfully finish...There's plenty of work for me afterwards...This simple, helloWorld-ish step should simply work...</p>

<p>If anyone has some insights into successfully creating a Vapor4 project, I'll be grateful...(simply following the steps at <a href=""https://docs.vapor.codes/4.0/hello-world/"" rel=""nofollow noreferrer"">https://docs.vapor.codes/4.0/hello-world/</a>  is not conducive to a working project)</p>

<p>L.E: thanks to imike's suggestion, I headed over to Vapor's community on Discord and found my solution.
My project's folder path happened to contain some spaces and dashes. Removing those allowed the process to finish correctly.
Great, helpful community!</p>
","3411322","","3411322","","2020-04-28 22:22:44","2020-04-28 22:22:44","Not able to create a valid, working, new project while using Vapor4","<swift><vapor><vapor-fluent>","1","0","","","","61445205","118712","118712","vapor","592","36204589","36204588"
"61501550","1","","","2020-04-29 12:13:11","","1","21","<p>Is it possible to have custom validation error messages for the built-in <code>Validatable</code> protocol?<br>
I have this validation:</p>

<pre><code>static func validations() throws -&gt; Validations&lt;NewsletterListItem&gt; {
    var validations = Validations(NewsletterListItem.self)
    validations.add(\.email, at: [""email""], .email)
    return validations
}
</code></pre>

<p>and it yields this message:</p>

<blockquote>
<pre><code>{
  ""error"": true,
  ""reason"": ""duplicate key value violates unique constraint \""uq:newsletter_list.email\""""
}
</code></pre>
</blockquote>

<p>...which I'd like to improve.</p>
","3397217","","","","","2020-04-29 12:58:18","Custom validation error message for Validatable model","<swift><validation><vapor>","1","0","","","","61501550","118712","118712","vapor","592","36204589","36204588"
"61545989","1","","","2020-05-01 15:55:55","","0","16","<p>I wrote a scalable admin worker for my Hasura GraphQL backend in Swift, using Apollo GraphQL subscriptions.  Runs great locally on mac, but unfortunately it seems that deploying it into my dokku server (or heroku) fails as there doesn't seem to be a Swift Server build pack that works with the ApolloClient dependencies (either failing on zlib, or swift version), including the latest 5.2 vapor/vapor buildpack. I am aware of possible high effort work arounds (re-writting in node, using a direct postgres subsription, making my own buildpack, deploying a standalone swift server and hacking together the swift tools to work), but was hoping that there was a buildpack out there that I missed. </p>
","285694","","","","","2020-05-01 15:55:55","Heroku buildpack that supports Apollo Swift client?","<swift><heroku><apollo-client><vapor><hasura>","0","0","","","","61545989","118712","118712","vapor","592","36204589","36204588"
"61547177","1","","","2020-05-01 17:08:10","","1","20","<p>I've deployed my Vapor app to Heroku, but when I try to make a request, it fails with the error:</p>

<p><code>at=error code=H10 desc=""App crashed"" method=GET path=""/feed"" host=detect-api.herokuapp.com request_id=970e4005-58b0-4b34-8489-715dc9cd5e19 fwd=""5.228.26.4"" dyno= connect= service= status=503 bytes= protocol=https</code></p>

<p>Also, when I run this script - <code>heroku ps:scale web=1</code>, I get the next logs:</p>

<pre><code>State changed from crashed to starting
State changed from starting to crashed
</code></pre>

<p>My Procfile contains the next code:</p>

<p><code>web: Run serve --env production --hostname 0.0.0.0 --port $PORT</code></p>

<p>In the <code>configure.swift</code> file I added this code:</p>

<pre><code>let nioServerConfig = NIOServerConfig.default(
    hostname: ""0.0.0.0"",
    port: Int(Environment.get(""PORT"") ?? """") ?? 8080
)
services.register(nioServerConfig)
</code></pre>

<p>How to fix this issue?</p>
","9325833","","","","","2020-05-02 20:05:31","A problem with Vapor app deployed to Heroku","<swift><xcode><heroku><vapor>","0","0","","","","61547177","118712","118712","vapor","592","36204589","36204588"
"61557416","1","","","2020-05-02 09:53:15","","2","13","<p>how can I add WHERE x LIKE $xyz to query builder?</p>

<p>i started with </p>

<pre><code>let searchQuery = try? request.query.get(String.self, at: ""s"")
...
query.where(\Talk.title, SwifQL.like(searchQuery))
</code></pre>

<p>but what next I want to search for case insensitive string I have error: </p>

<p><code>[ ERROR ] PostgreSQLError.server.error.scanner_yyerror: GET /testroute?s=Swift syntax error at or near ""$8"" (ErrorMiddleware.swift:26)</code></p>
","1285959","","","","","2020-05-02 10:44:16","How to use LIKE in WHERE clause in SwifQL","<vapor><vapor-fluent>","1","0","","","","61557416","118712","118712","vapor","592","36204589","36204588"
"61564666","1","","","2020-05-02 18:48:25","","1","13","<p>I've tried deploying an init vapor 4 project on Heroku and Digital Ocean and keep getting the same error:</p>

<pre><code>error: https://github.com/vapor/vapor.git has no Package.swift manifest for version 4.4.1
</code></pre>

<p>my swift package is pointing to:</p>

<pre><code>"".package(url: ""https://github.com/vapor/vapor.git"", from: ""4.5.0"")""
</code></pre>
","507299","","","","","2020-05-02 18:48:25","Deploying init vapor 4 project causing error","<swift><vapor><server-side-swift>","0","0","","","","61564666","118712","118712","vapor","592","36204589","36204588"